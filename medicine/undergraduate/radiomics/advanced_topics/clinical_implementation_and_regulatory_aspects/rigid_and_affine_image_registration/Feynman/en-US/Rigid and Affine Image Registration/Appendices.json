{
    "hands_on_practices": [
        {
            "introduction": "Understanding the fundamental difference between rigid and affine transformations is the first step toward mastering image registration. While both are linear transformations, a rigid transform preserves all distances and angles, whereas an affine transform does not. This exercise provides a definitive, hands-on demonstration of this key distinction by asking you to apply a simple anisotropic scaling (an affine map) to a sphere and prove that the result is an ellipsoid—a shape that cannot be produced from a sphere by any rigid motion. ",
            "id": "4559313",
            "problem": "In a three-dimensional radiomics registration scenario, consider a segmented lesion whose true shape in the source image can be modeled as a sphere of radius $r$ centered at the origin, given by the set $S_{r} = \\{ \\mathbf{x} \\in \\mathbb{R}^{3} : \\| \\mathbf{x} \\|_{2} = r \\}$. A rigid transformation is defined as $\\mathcal{R}(\\mathbf{x}) = \\mathbf{R}\\mathbf{x} + \\mathbf{t}$, where $\\mathbf{R} \\in \\mathbb{R}^{3 \\times 3}$ satisfies $\\mathbf{R}^{\\top}\\mathbf{R} = \\mathbf{I}$ and $\\det(\\mathbf{R}) = \\pm 1$, and an affine transformation is defined as $\\mathcal{A}(\\mathbf{x}) = \\mathbf{A}\\mathbf{x} + \\mathbf{b}$ with $\\mathbf{A} \\in \\mathbb{R}^{3 \\times 3}$ invertible. In the context of aligning a target image that exhibits anisotropic voxel scaling, you are asked to construct a counterexample that separates the representational power of affine registration from rigid registration.\n\nPerform the following:\n\n1. Using only the core definitions above and the Euclidean norm properties, take the specific anisotropic linear map $\\mathbf{A} = \\mathrm{diag}(2, 1, 1)$ and translation $\\mathbf{b} = \\mathbf{0}$. Derive the implicit quadratic form satisfied by $\\mathbf{y} = \\mathcal{A}(\\mathbf{x})$ with $\\mathbf{x} \\in S_{r}$, and show that the image is an ellipsoid whose principal semi-axes are aligned with the coordinate axes.\n\n2. Using only the length-preserving property of rigid transformations, give a contradiction-based argument that no rigid transformation can map $S_{r}$ onto the ellipsoid you obtained in part $1$.\n\n3. Consider the planar cross-section of the ellipsoid from part $1$ at $z = 0$, which is an ellipse in the $x$–$y$ plane. Compute the eccentricity $e$ of this ellipse, defined by $e = \\sqrt{1 - \\frac{b^{2}}{a^{2}}}$ where $a$ and $b$ are the semi-major and semi-minor axes of the ellipse, respectively. Express your final answer as an exact expression with no rounding and no units. Provide only the value of $e$ as your final answer.",
            "solution": "The problem defines a source object as a sphere $S_r$ of radius $r$ centered at the origin, given by the set of points $\\mathbf{x} = (x_1, x_2, x_3)^{\\top} \\in \\mathbb{R}^{3}$ such that its squared Euclidean norm is constant:\n$$\n\\|\\mathbf{x}\\|_{2}^{2} = x_1^{2} + x_2^{2} + x_3^{2} = r^{2}\n$$\n\n**Part 1: Derivation of the Affine-Transformed Shape**\n\nWe are given a specific affine transformation $\\mathcal{A}(\\mathbf{x}) = \\mathbf{A}\\mathbf{x} + \\mathbf{b}$ with the linear map $\\mathbf{A} = \\mathrm{diag}(2, 1, 1)$ and the translation vector $\\mathbf{b} = \\mathbf{0}$. Let $\\mathbf{y} = (y_1, y_2, y_3)^{\\top}$ be a point in the transformed set, such that $\\mathbf{y} = \\mathcal{A}(\\mathbf{x})$ for some $\\mathbf{x} \\in S_r$. With $\\mathbf{b} = \\mathbf{0}$, this simplifies to $\\mathbf{y} = \\mathbf{A}\\mathbf{x}$.\n\nSince the matrix $\\mathbf{A}$ is given as:\n$$\n\\mathbf{A} = \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nthe relationship between the components of $\\mathbf{y}$ and $\\mathbf{x}$ is:\n$$\ny_1 = 2x_1, \\quad y_2 = x_2, \\quad y_3 = x_3\n$$\nTo find the implicit equation satisfied by the components of $\\mathbf{y}$, we must express the components of $\\mathbf{x}$ in terms of the components of $\\mathbf{y}$ and substitute them into the equation of the sphere $S_r$. The matrix $\\mathbf{A}$ is invertible, and its inverse is $\\mathbf{A}^{-1} = \\mathrm{diag}(1/2, 1, 1)$. Thus, $\\mathbf{x} = \\mathbf{A}^{-1}\\mathbf{y}$, which gives:\n$$\nx_1 = \\frac{1}{2}y_1, \\quad x_2 = y_2, \\quad x_3 = y_3\n$$\nSubstituting these expressions into the sphere equation $x_1^{2} + x_2^{2} + x_3^{2} = r^{2}$, we obtain the equation for the transformed surface:\n$$\n\\left(\\frac{y_1}{2}\\right)^{2} + (y_2)^{2} + (y_3)^{2} = r^{2}\n$$\nThis simplifies to:\n$$\n\\frac{y_1^{2}}{4} + y_2^{2} + y_3^{2} = r^{2}\n$$\nTo express this in the standard form of a quadric surface, we divide by $r^{2}$ (assuming $r > 0$, which is implicit for a sphere of non-zero radius):\n$$\n\\frac{y_1^{2}}{4r^{2}} + \\frac{y_2^{2}}{r^{2}} + \\frac{y_3^{2}}{r^{2}} = 1\n$$\nThis can be rewritten as:\n$$\n\\frac{y_1^{2}}{(2r)^{2}} + \\frac{y_2^{2}}{r^{2}} + \\frac{y_3^{2}}{r^{2}} = 1\n$$\nThis is the implicit quadratic form defining an ellipsoid centered at the origin. The equation contains only squared terms of $y_1$, $y_2$, and $y_3$, meaning there are no cross-product terms (e.g., $y_1y_2$). This indicates that the principal axes of the ellipsoid are aligned with the coordinate axes. The lengths of the principal semi-axes are given by the square roots of the denominators, which are $2r$, $r$, and $r$.\n\n**Part 2: Contradiction Argument for Rigid Transformation Infeasibility**\n\nA rigid transformation $\\mathcal{R}(\\mathbf{x}) = \\mathbf{R}\\mathbf{x} + \\mathbf{t}$ is defined by the property that the matrix $\\mathbf{R}$ is orthogonal, i.e., $\\mathbf{R}^{\\top}\\mathbf{R} = \\mathbf{I}$. A fundamental property of such transformations is that they are isometries, meaning they preserve the Euclidean distance between any two points. For any $\\mathbf{p}, \\mathbf{q} \\in \\mathbb{R}^{3}$:\n$$\n\\|\\mathcal{R}(\\mathbf{p}) - \\mathcal{R}(\\mathbf{q})\\|_{2} = \\|(\\mathbf{R}\\mathbf{p} + \\mathbf{t}) - (\\mathbf{R}\\mathbf{q} + \\mathbf{t})\\|_{2} = \\|\\mathbf{R}(\\mathbf{p} - \\mathbf{q})\\|_{2} = \\sqrt{(\\mathbf{p} - \\mathbf{q})^{\\top}\\mathbf{R}^{\\top}\\mathbf{R}(\\mathbf{p} - \\mathbf{q})} = \\sqrt{(\\mathbf{p} - \\mathbf{q})^{\\top}\\mathbf{I}(\\mathbf{p} - \\mathbf{q})} = \\|\\mathbf{p} - \\mathbf{q}\\|_{2}\n$$\nThis shows that distance is preserved. We will use this length-preserving property to formulate a proof by contradiction.\n\nAssume, for the sake of contradiction, that there exists a rigid transformation $\\mathcal{R}$ that maps the sphere $S_r$ onto the ellipsoid $E$ derived in Part 1.\nLet $\\mathbf{x}$ be any point on the sphere $S_r$. The distance from $\\mathbf{x}$ to the center of the sphere (the origin $\\mathbf{0}$) is $\\|\\mathbf{x} - \\mathbf{0}\\|_{2} = r$.\nLet $\\mathbf{y} = \\mathcal{R}(\\mathbf{x})$ be the corresponding point on the ellipsoid $E$. The center of the sphere $\\mathbf{0}$ is mapped to the point $\\mathbf{c} = \\mathcal{R}(\\mathbf{0}) = \\mathbf{R}\\mathbf{0} + \\mathbf{t} = \\mathbf{t}$.\nBecause $\\mathcal{R}$ is an isometry, the distance between the transformed point $\\mathbf{y}$ and the transformed center $\\mathbf{c}$ must be the same as the distance between the original point $\\mathbf{x}$ and the original center $\\mathbf{0}$.\n$$\n\\|\\mathbf{y} - \\mathbf{c}\\|_{2} = \\|\\mathcal{R}(\\mathbf{x}) - \\mathcal{R}(\\mathbf{0})\\|_{2} = \\|\\mathbf{x} - \\mathbf{0}\\|_{2} = r\n$$\nThis equality must hold for every point $\\mathbf{y}$ on the ellipsoid $E$. The equation $\\|\\mathbf{y} - \\mathbf{c}\\|_{2} = r$ is the definition of a sphere of radius $r$ centered at $\\mathbf{c}$. Therefore, the assumption that a rigid transformation maps $S_r$ to $E$ implies that $E$ must be a sphere of radius $r$.\n\nHowever, from Part 1, we determined that $E$ is an ellipsoid with principal semi-axes of lengths $2r$, $r$, and $r$. A surface is a sphere if and only if all its principal semi-axes are equal. In our case, since $r > 0$, we have $2r \\neq r$. Thus, the ellipsoid $E$ is not a sphere.\n\nThis leads to a contradiction: our assumption implies that $E$ must be a sphere, but the properties of $E$ show it is not a sphere. Consequently, the initial assumption must be false. No rigid transformation can map the sphere $S_r$ onto the ellipsoid $E$.\n\n**Part 3: Calculation of Eccentricity**\n\nWe are asked to compute the eccentricity of the planar cross-section of the ellipsoid at $z = 0$. In our coordinate system, this corresponds to setting $y_3 = 0$. Using the ellipsoid equation from Part 1:\n$$\n\\frac{y_1^{2}}{(2r)^{2}} + \\frac{y_2^{2}}{r^{2}} + \\frac{y_3^{2}}{r^{2}} = 1\n$$\nSetting $y_3=0$ yields the equation of the cross-section in the $y_1$-$y_2$ plane:\n$$\n\\frac{y_1^{2}}{(2r)^{2}} + \\frac{y_2^{2}}{r^{2}} = 1\n$$\nThis is the standard equation of an ellipse centered at the origin. The semi-axes are the square roots of the denominators.\nThe semi-axis along the $y_1$-axis is $\\sqrt{(2r)^{2}} = 2r$.\nThe semi-axis along the $y_2$-axis is $\\sqrt{r^{2}} = r$.\n\nThe semi-major axis, denoted by $a$, is the larger of the two, and the semi-minor axis, denoted by $b$, is the smaller. Since $r > 0$, we have $2r > r$. Therefore:\n- Semi-major axis: $a = 2r$\n- Semi-minor axis: $b = r$\n\nThe eccentricity $e$ of an ellipse is given by the formula $e = \\sqrt{1 - \\frac{b^{2}}{a^{2}}}$. Substituting the values of $a$ and $b$:\n$$\ne = \\sqrt{1 - \\frac{r^{2}}{(2r)^{2}}} = \\sqrt{1 - \\frac{r^{2}}{4r^{2}}}\n$$\nThe term $r^{2}$ cancels out from the fraction:\n$$\ne = \\sqrt{1 - \\frac{1}{4}} = \\sqrt{\\frac{3}{4}}\n$$\nSimplifying the expression gives the final exact value for the eccentricity:\n$$\ne = \\frac{\\sqrt{3}}{2}\n$$",
            "answer": "$$\\boxed{\\frac{\\sqrt{3}}{2}}$$"
        },
        {
            "introduction": "Theoretical transformations must be applied carefully within the practical context of digital images, which are composed of a grid of voxels that may have non-uniform physical dimensions (anisotropic spacing). A common and significant error is to apply a rotation directly to the voxel coordinates (index space) instead of the real-world physical space, leading to unwanted distortions. This practice problem guides you through deriving the mathematical origin of this distortion and, more importantly, constructing the correct transformation matrix that ensures a rotation in physical space is accurately represented in index space. ",
            "id": "4559278",
            "problem": "In radiomics workflows, rigid and affine image registration must respect the Euclidean geometry of physical space, not the implicit grid of voxel indices. Consider a three-dimensional image volume with anisotropic voxel spacings along the coordinate axes given by $s_{x}$, $s_{y}$, and $s_{z}$ (in millimeters). Index-space coordinates are denoted by $\\mathbf{i} \\in \\mathbb{R}^{3}$, and physical-space coordinates are given by $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$, where $\\mathbf{S} = \\mathrm{diag}(s_{x}, s_{y}, s_{z})$. Suppose one wishes to apply a rigid rotation by an angle $\\theta$ about the $z$-axis in physical space.\n\nA naive implementation applies the rotation matrix $\\mathbf{R}_{z}(\\theta)$ directly in index space, mapping $\\mathbf{i} \\mapsto \\mathbf{R}_{z}(\\theta)\\,\\mathbf{i}$, and then converts to physical space. In contrast, a correct implementation applies the rotation in physical space, or equivalently composes a corrected index-space affine transform that is consistent with the physical rotation.\n\nUsing only the definitions of the Euclidean norm in physical space, the index-to-physical mapping $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$, and the property that rigid rotations in physical space preserve Euclidean lengths, do the following:\n\n1. For the index-space unit vector $\\mathbf{v} = (1, 0, 0)^{\\top}$ and a rotation by angle $\\theta$ about the $z$-axis, derive from first principles the expression for the ratio $r(\\theta)$ of the physical-space length of the naively transformed vector to the original physical-space length. Your derivation must start from $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$ and the Euclidean norm, and must not assume any specialized formula beyond those definitions.\n\n2. Derive the corrected index-space linear transformation matrix $\\mathbf{M}$ that, when applied to index coordinates as $\\mathbf{i} \\mapsto \\mathbf{M}\\,\\mathbf{i}$, yields the same physical-space effect as applying $\\mathbf{R}_{z}(\\theta)$ in physical space. Show from the definitions that this corrected transformation preserves the physical length of $\\mathbf{v}$.\n\n3. Evaluate the distortion magnitude $d = r(\\theta) - 1$ for $s_{x} = 0.8$ millimeters, $s_{y} = 2.0$ millimeters, and $\\theta = 30$ degrees. Express the final answer as a dimensionless number and round your answer to four significant figures. State the angle in degrees as specified; no conversion is required in your final numeric evaluation.",
            "solution": "### Part 1: Derivation of the Ratio $r(\\theta)$\n\nLet the index-space coordinates be $\\mathbf{i} = (i_x, i_y, i_z)^{\\top}$ and the physical-space coordinates be $\\mathbf{x} = (x, y, z)^{\\top}$. The mapping between them is given by $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$, where $\\mathbf{S}$ is the diagonal scaling matrix $\\mathbf{S} = \\mathrm{diag}(s_{x}, s_{y}, s_{z})$. The Euclidean norm of a vector $\\mathbf{u} = (u_1, u_2, u_3)^{\\top}$ is $\\|\\mathbf{u}\\| = \\sqrt{u_1^2 + u_2^2 + u_3^2}$.\n\nThe initial index-space vector is given as $\\mathbf{i}_{\\text{orig}} = \\mathbf{v} = (1, 0, 0)^{\\top}$.\nThe corresponding original physical-space vector, $\\mathbf{x}_{\\text{orig}}$, is found by applying the scaling matrix $\\mathbf{S}$:\n$$\n\\mathbf{x}_{\\text{orig}} = \\mathbf{S}\\,\\mathbf{i}_{\\text{orig}} = \\begin{pmatrix} s_x & 0 & 0 \\\\ 0 & s_y & 0 \\\\ 0 & 0 & s_z \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} s_x \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThe physical-space length (Euclidean norm) of this original vector is:\n$$\n\\|\\mathbf{x}_{\\text{orig}}\\| = \\sqrt{s_x^2 + 0^2 + 0^2} = s_x\n$$\n(We assume $s_x > 0$ as it represents a physical spacing).\n\nThe naive implementation applies the rotation directly in index space. The rotation matrix for an angle $\\theta$ about the $z$-axis is:\n$$\n\\mathbf{R}_{z}(\\theta) = \\begin{pmatrix} \\cos\\theta & -\\sin\\theta & 0 \\\\ \\sin\\theta & \\cos\\theta & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nThe naively transformed index-space vector, $\\mathbf{i}_{\\text{naive}}$, is:\n$$\n\\mathbf{i}_{\\text{naive}} = \\mathbf{R}_{z}(\\theta)\\,\\mathbf{i}_{\\text{orig}} = \\begin{pmatrix} \\cos\\theta & -\\sin\\theta & 0 \\\\ \\sin\\theta & \\cos\\theta & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\\\ 0 \\end{pmatrix}\n$$\nThis naively transformed index-space vector is then converted to physical space to get $\\mathbf{x}_{\\text{naive}}$:\n$$\n\\mathbf{x}_{\\text{naive}} = \\mathbf{S}\\,\\mathbf{i}_{\\text{naive}} = \\begin{pmatrix} s_x & 0 & 0 \\\\ 0 & s_y & 0 \\\\ 0 & 0 & s_z \\end{pmatrix} \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} s_x \\cos\\theta \\\\ s_y \\sin\\theta \\\\ 0 \\end{pmatrix}\n$$\nThe physical-space length of this naively transformed vector is:\n$$\n\\|\\mathbf{x}_{\\text{naive}}\\| = \\sqrt{(s_x \\cos\\theta)^2 + (s_y \\sin\\theta)^2 + 0^2} = \\sqrt{s_x^2 \\cos^2\\theta + s_y^2 \\sin^2\\theta}\n$$\nThe ratio $r(\\theta)$ is the physical-space length of the naively transformed vector divided by the original physical-space length:\n$$\nr(\\theta) = \\frac{\\|\\mathbf{x}_{\\text{naive}}\\|}{\\|\\mathbf{x}_{\\text{orig}}\\|} = \\frac{\\sqrt{s_x^2 \\cos^2\\theta + s_y^2 \\sin^2\\theta}}{s_x}\n$$\nThis can be simplified to:\n$$\nr(\\theta) = \\sqrt{\\frac{s_x^2 \\cos^2\\theta + s_y^2 \\sin^2\\theta}{s_x^2}} = \\sqrt{\\cos^2\\theta + \\left(\\frac{s_y}{s_x}\\right)^2 \\sin^2\\theta}\n$$\n\n### Part 2: Derivation of the Corrected Transformation Matrix $\\mathbf{M}$\n\nA correct implementation applies the rotation in physical space. Let $\\mathbf{x}$ be a physical-space vector corresponding to an index-space vector $\\mathbf{i}$ (so $\\mathbf{x} = \\mathbf{S}\\mathbf{i}$). The correctly rotated physical-space vector, $\\mathbf{x}_{\\text{corr}}$, is:\n$$\n\\mathbf{x}_{\\text{corr}} = \\mathbf{R}_{z}(\\theta)\\,\\mathbf{x} = \\mathbf{R}_{z}(\\theta)(\\mathbf{S}\\mathbf{i})\n$$\nWe seek a corrected index-space transformation matrix $\\mathbf{M}$ such that the new index-space vector $\\mathbf{i}_{\\text{corr}} = \\mathbf{M}\\mathbf{i}$ maps to the correctly rotated physical vector $\\mathbf{x}_{\\text{corr}}$. That is, $\\mathbf{x}_{\\text{corr}} = \\mathbf{S}\\mathbf{i}_{\\text{corr}} = \\mathbf{S}(\\mathbf{M}\\mathbf{i})$.\n\nEquating the two expressions for $\\mathbf{x}_{\\text{corr}}$:\n$$\n\\mathbf{S}\\mathbf{M}\\mathbf{i} = \\mathbf{R}_{z}(\\theta)\\mathbf{S}\\mathbf{i}\n$$\nSince this must hold for any vector $\\mathbf{i}$, we can equate the matrices:\n$$\n\\mathbf{S}\\mathbf{M} = \\mathbf{R}_{z}(\\theta)\\mathbf{S}\n$$\nTo solve for $\\mathbf{M}$, we multiply from the left by the inverse of $\\mathbf{S}$. Since $\\mathbf{S}$ is a diagonal matrix with non-zero entries (physical spacings), its inverse is $\\mathbf{S}^{-1} = \\mathrm{diag}(1/s_x, 1/s_y, 1/s_z)$.\n$$\n\\mathbf{M} = \\mathbf{S}^{-1}\\mathbf{R}_{z}(\\theta)\\mathbf{S}\n$$\nWe now compute this product explicitly:\n$$\n\\mathbf{M} = \\begin{pmatrix} \\frac{1}{s_x} & 0 & 0 \\\\ 0 & \\frac{1}{s_y} & 0 \\\\ 0 & 0 & \\frac{1}{s_z} \\end{pmatrix} \\left[ \\begin{pmatrix} \\cos\\theta & -\\sin\\theta & 0 \\\\ \\sin\\theta & \\cos\\theta & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} s_x & 0 & 0 \\\\ 0 & s_y & 0 \\\\ 0 & 0 & s_z \\end{pmatrix} \\right]\n$$\n$$\n\\mathbf{M} = \\begin{pmatrix} \\frac{1}{s_x} & 0 & 0 \\\\ 0 & \\frac{1}{s_y} & 0 \\\\ 0 & 0 & \\frac{1}{s_z} \\end{pmatrix} \\begin{pmatrix} s_x \\cos\\theta & -s_y \\sin\\theta & 0 \\\\ s_x \\sin\\theta & s_y \\cos\\theta & 0 \\\\ 0 & 0 & s_z \\end{pmatrix}\n$$\n$$\n\\mathbf{M} = \\begin{pmatrix} \\cos\\theta & -\\frac{s_y}{s_x}\\sin\\theta & 0 \\\\ \\frac{s_x}{s_y}\\sin\\theta & \\cos\\theta & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}\n$$\nThis is the corrected index-space linear transformation matrix.\n\nTo show that this transformation preserves the physical length of $\\mathbf{v}$, we consider the length of the physical vector after the corrected transformation. The original physical vector is $\\mathbf{x}_{\\text{orig}} = \\mathbf{S}\\mathbf{v}$. Its length is $\\|\\mathbf{S}\\mathbf{v}\\|$. The transformed physical vector is $\\mathbf{x}_{\\text{corr}} = \\mathbf{S}(\\mathbf{M}\\mathbf{v})$. From our derivation, we know $\\mathbf{S}\\mathbf{M} = \\mathbf{R}_z(\\theta)\\mathbf{S}$, so we can write:\n$$\n\\mathbf{x}_{\\text{corr}} = (\\mathbf{S}\\mathbf{M})\\mathbf{v} = (\\mathbf{R}_z(\\theta)\\mathbf{S})\\mathbf{v} = \\mathbf{R}_z(\\theta)(\\mathbf{S}\\mathbf{v}) = \\mathbf{R}_z(\\theta)\\mathbf{x}_{\\text{orig}}\n$$\nWe are given that rigid rotations in physical space preserve Euclidean lengths. The mapping from $\\mathbf{x}_{\\text{orig}}$ to $\\mathbf{x}_{\\text{corr}}$ is precisely the rigid rotation $\\mathbf{R}_z(\\theta)$ applied in physical space. Therefore, by the premise of the problem:\n$$\n\\|\\mathbf{x}_{\\text{corr}}\\| = \\|\\mathbf{R}_z(\\theta)\\mathbf{x}_{\\text{orig}}\\| = \\|\\mathbf{x}_{\\text{orig}}\\|\n$$\nThis confirms that the corrected transformation preserves the physical length of the vector.\n\n### Part 3: Evaluation of Distortion Magnitude $d$\n\nThe distortion magnitude is defined as $d = r(\\theta) - 1$. Using the expression for $r(\\theta)$ from Part 1:\n$$\nd = \\sqrt{\\cos^2\\theta + \\left(\\frac{s_y}{s_x}\\right)^2 \\sin^2\\theta} - 1\n$$\nWe are given the values $s_x = 0.8$, $s_y = 2.0$, and $\\theta = 30^\\circ$.\nFirst, we compute the ratio of voxel spacings:\n$$\n\\frac{s_y}{s_x} = \\frac{2.0}{0.8} = 2.5\n$$\nThe trigonometric function values for $\\theta = 30^\\circ$ are:\n$$\n\\cos(30^\\circ) = \\frac{\\sqrt{3}}{2}, \\quad \\sin(30^\\circ) = \\frac{1}{2}\n$$\nTheir squares are:\n$$\n\\cos^2(30^\\circ) = \\frac{3}{4} = 0.75\n$$\n$$\n\\sin^2(30^\\circ) = \\frac{1}{4} = 0.25\n$$\nSubstituting these values into the expression for $d$:\n$$\nd = \\sqrt{0.75 + (2.5)^2 (0.25)} - 1\n$$\n$$\nd = \\sqrt{0.75 + (6.25)(0.25)} - 1\n$$\n$$\nd = \\sqrt{0.75 + 1.5625} - 1\n$$\n$$\nd = \\sqrt{2.3125} - 1\n$$\nCalculating the numerical value:\n$$\n\\sqrt{2.3125} \\approx 1.5206906...\n$$\n$$\nd \\approx 1.5206906 - 1 = 0.5206906...\n$$\nRounding the final answer to four significant figures, we get:\n$$\nd \\approx 0.5207\n$$\nThe dimensionless distortion magnitude is approximately $0.5207$, which corresponds to a length increase of about $52.07\\%$.",
            "answer": "$$\\boxed{0.5207}$$"
        },
        {
            "introduction": "After understanding the properties of transformations, the central task of registration is to find the *optimal* transformation that aligns two datasets. For landmark-based registration, where corresponding points are identified in two images, this problem has an elegant and exact solution known as the Kabsch algorithm. This exercise will walk you through the complete derivation of this foundational method, showing how to decouple translation and rotation using centroids and then solve for the optimal rotation using the Singular Value Decomposition (SVD) of a cross-covariance matrix. ",
            "id": "4559281",
            "problem": "In radiomics, robust extraction of intensity and texture features across imaging sessions relies on accurate inter-scan alignment. Consider two two-dimensional feature maps from the same patient acquired in successive Magnetic Resonance Imaging (MRI) scans. You are given three corresponding landmark points extracted from lesions in both scans, modeled as point sets $\\{x_{i}\\}_{i=1}^{3}$ and $\\{y_{i}\\}_{i=1}^{3}$ in $\\mathbb{R}^{2}$, assumed to be related by a rigid transformation. The rigid registration problem seeks a rotation matrix $R \\in \\mathrm{SO}(2)$ (the special orthogonal group in two dimensions, i.e., $R^{\\top}R=I$ and $\\det(R)=1$) and a translation vector $t \\in \\mathbb{R}^{2}$ minimizing the squared error objective\n$$\n\\sum_{i=1}^{3} \\|R x_{i} + t - y_{i}\\|^{2}.\n$$\nStarting only from the definitions of least squares optimization, centroids, and orthonormal matrices, and the well-tested fact that any real matrix admits a Singular Value Decomposition (SVD), derive the procedure to obtain the optimal $R$ and $t$ in the sense of minimizing the above objective. Your derivation must include: (i) elimination of the translation via centroids, (ii) reduction of the problem to an optimization over $R$ that depends on a cross-covariance matrix of the centered data, and (iii) identification of the optimizer $R$ using the SVD of that cross-covariance matrix together with the constraint $\\det(R)=1$. Do not assume or quote any pre-existing registration formula; derive each step from the stated foundations.\n\nThen, apply your derived method to the following specific landmark sets:\n$$\nx_{1}=\\begin{pmatrix}0 \\\\ 0\\end{pmatrix}, \\quad x_{2}=\\begin{pmatrix}1 \\\\ 0\\end{pmatrix}, \\quad x_{3}=\\begin{pmatrix}0 \\\\ 1\\end{pmatrix},\n$$\n$$\ny_{1}=\\begin{pmatrix}2 \\\\ -1\\end{pmatrix}, \\quad y_{2}=\\begin{pmatrix}2 \\\\ 0\\end{pmatrix}, \\quad y_{3}=\\begin{pmatrix}1 \\\\ -1\\end{pmatrix}.\n$$\nCompute the optimal rotation matrix $R$ and translation vector $t$ that minimize $\\sum_{i=1}^{3} \\|R x_{i} + t - y_{i}\\|^{2}$. Report the six numbers $R_{11}, R_{12}, R_{21}, R_{22}, t_{1}, t_{2}$ in this order, expressed exactly (no rounding). Provide the final answer as a single row matrix using the $\\mathrm{pmatrix}$ environment, with no units.",
            "solution": "Let the two sets of $N=3$ points be $\\{x_i\\}_{i=1}^3$ and $\\{y_i\\}_{i=1}^3$, where $x_i, y_i \\in \\mathbb{R}^2$. The objective is to find the rotation matrix $R \\in \\mathrm{SO}(2)$ and translation vector $t \\in \\mathbb{R}^2$ that minimize the cost function:\n$$E(R, t) = \\sum_{i=1}^{3} \\|R x_{i} + t - y_{i}\\|^{2}$$\n\nThe derivation proceeds in three stages as required by the problem statement.\n\n**(i) Elimination of the translation via centroids**\n\nTo find the optimal translation vector $t$ for a given rotation $R$, we must find the value of $t$ that minimizes $E(R, t)$. This occurs at a stationary point of $E$ with respect to $t$, i.e., where the gradient $\\nabla_t E$ is zero.\nThe cost function can be written as a sum of dot products:\n$$E(R, t) = \\sum_{i=1}^{3} (R x_i + t - y_i)^\\top (R x_i + t - y_i)$$\nThe gradient with respect to the vector $t$ is:\n$$\\nabla_t E = \\frac{\\partial E}{\\partial t} = \\sum_{i=1}^{3} 2(R x_i + t - y_i) = 2 \\left( \\sum_{i=1}^{3} R x_i + \\sum_{i=1}^{3} t - \\sum_{i=1}^{3} y_i \\right)$$\nSetting the gradient to the zero vector gives:\n$$\\sum_{i=1}^{3} R x_i + 3t - \\sum_{i=1}^{3} y_i = 0$$\nSolving for $t$:\n$$3t = \\sum_{i=1}^{3} y_i - R \\sum_{i=1}^{3} x_i$$\n$$t = \\frac{1}{3}\\sum_{i=1}^{3} y_i - R \\left(\\frac{1}{3}\\sum_{i=1}^{3} x_i\\right)$$\nLet us define the centroids (mean vectors) of the point sets as:\n$$\\bar{x} = \\frac{1}{3}\\sum_{i=1}^{3} x_i \\quad \\text{and} \\quad \\bar{y} = \\frac{1}{3}\\sum_{i=1}^{3} y_i$$\nThe optimal translation vector $t$ can thus be expressed in terms of the centroids and the rotation matrix $R$:\n$$t = \\bar{y} - R\\bar{x}$$\nThis shows that the optimal translation aligns the centroid of the rotated source points, $R\\bar{x}$, with the centroid of the target points, $\\bar{y}$.\n\n**(ii) Reduction of the problem to an optimization over R**\n\nWe substitute the expression for the optimal $t$ back into the cost function $E$ to obtain an objective function that depends only on $R$.\n$$E(R) = \\sum_{i=1}^{3} \\|R x_i + (\\bar{y} - R\\bar{x}) - y_i\\|^2$$\nRearranging the terms inside the norm:\n$$E(R) = \\sum_{i=1}^{3} \\|(R x_i - R\\bar{x}) - (y_i - \\bar{y})\\|^2 = \\sum_{i=1}^{3} \\|R(x_i - \\bar{x}) - (y_i - \\bar{y})\\|^2$$\nLet's define the centered point coordinates as $x'_i = x_i - \\bar{x}$ and $y'_i = y_i - \\bar{y}$. The cost function simplifies to:\n$$E(R) = \\sum_{i=1}^{3} \\|R x'_i - y'_i\\|^2$$\nWe expand the squared norm:\n$$E(R) = \\sum_{i=1}^{3} \\left( (R x'_i)^\\top (R x'_i) - 2(R x'_i)^\\top y'_i + (y'_i)^\\top y'_i \\right)$$\nSince $R$ is a rotation matrix, it is orthogonal, meaning $R^\\top R = I$. Therefore, the first term becomes:\n$$(R x'_i)^\\top (R x'_i) = (x'_i)^\\top R^\\top R x'_i = (x'_i)^\\top I x'_i = (x'_i)^\\top x'_i = \\|x'_i\\|^2$$\nThe cost function is now:\n$$E(R) = \\sum_{i=1}^{3} \\|x'_i\\|^2 - 2 \\sum_{i=1}^{3} (R x'_i)^\\top y'_i + \\sum_{i=1}^{3} \\|y'_i\\|^2$$\nThe first and third terms, $\\sum \\|x'_i\\|^2$ and $\\sum \\|y'_i\\|^2$, are constant with respect to $R$. Minimizing $E(R)$ is therefore equivalent to maximizing the middle term:\n$$\\underset{R \\in \\mathrm{SO}(2)}{\\mathrm{maximize}} \\sum_{i=1}^{3} (R x'_i)^\\top y'_i$$\nLet's analyze this term. Each $(R x'_i)^\\top y'_i$ is a scalar. We can use the property that for a scalar $s$, $s = \\mathrm{Tr}(s)$, and the cyclic property of the trace, $\\mathrm{Tr}(ABC) = \\mathrm{Tr}(CAB)$.\n$$\\sum_{i=1}^{3} (R x'_i)^\\top y'_i = \\sum_{i=1}^{3} (x'_i)^\\top R^\\top y'_i = \\sum_{i=1}^{3} \\mathrm{Tr}((x'_i)^\\top R^\\top y'_i) = \\sum_{i=1}^{3} \\mathrm{Tr}(R^\\top y'_i (x'_i)^\\top)$$\nUsing the linearity of the trace operator:\n$$\\mathrm{Tr}\\left(R^\\top \\sum_{i=1}^{3} y'_i (x'_i)^\\top\\right)$$\nLet us define the cross-covariance matrix $H_{yx} = \\sum_{i=1}^{3} y'_i (x'_i)^\\top$. The problem reduces to maximizing $\\mathrm{Tr}(R^\\top H_{yx})$ over $R \\in \\mathrm{SO}(2)$. This is equivalent to maximizing $\\mathrm{Tr}((R^\\top H_{yx})^\\top) = \\mathrm{Tr}(H_{yx}^\\top R) = \\mathrm{Tr}(H R)$, where $H = H_{yx}^\\top = \\sum_{i=1}^{3} x'_i (y'_i)^\\top$. So, we seek to solve:\n$$\\underset{R \\in \\mathrm{SO}(2)}{\\mathrm{maximize}} \\quad \\mathrm{Tr}(R H)$$\n\n**(iii) Identification of the optimizer R using SVD**\n\nLet the Singular Value Decomposition (SVD) of the $2 \\times 2$ cross-covariance matrix $H$ be $H = U S V^\\top$, where $U, V \\in O(2)$ are orthogonal matrices and $S = \\mathrm{diag}(s_1, s_2)$ is a diagonal matrix of non-negative singular values, with $s_1 \\geq s_2 \\geq 0$.\nThe objective function is $\\mathrm{Tr}(R H) = \\mathrm{Tr}(R U S V^\\top)$. Using the cyclic property of the trace:\n$$\\mathrm{Tr}(R U S V^\\top) = \\mathrm{Tr}(S V^\\top R U)$$\nLet $M = V^\\top R U$. Since $V^\\top$, $R$, and $U$ are orthogonal matrices, their product $M$ is also an orthogonal matrix. We must also consider the determinant constraint. As $R \\in \\mathrm{SO}(2)$, $\\det(R)=1$. Therefore,\n$$\\det(M) = \\det(V^\\top) \\det(R) \\det(U) = \\det(V) \\det(U)$$\nWe want to maximize $\\mathrm{Tr}(S M) = s_1 M_{11} + s_2 M_{22}$ subject to $M$ being orthogonal and $\\det(M) = \\det(U)\\det(V)$. Since $M$ is orthogonal, its entries satisfy $|M_{ij}| \\le 1$. To maximize the sum, we want $M_{11}$ and $M_{22}$ to be as large as possible.\n\nCase 1: $\\det(U)\\det(V) = 1$. The constraint on $M$ is $\\det(M)=1$, so $M$ is a rotation. The choice $M=I$ (the identity matrix) satisfies this constraint. For $M=I$, $M_{11}=1$ and $M_{22}=1$, which maximizes the trace to $s_1+s_2$. Thus, the optimal $M$ is $I$.\n$$V^\\top R U = I \\implies R = V U^\\top$$\nThe determinant is $\\det(R) = \\det(V U^\\top) = \\det(V)\\det(U) = 1$, so this $R$ is in $\\mathrm{SO}(2)$.\n\nCase 2: $\\det(U)\\det(V) = -1$. The constraint on $M$ is $\\det(M)=-1$, so $M$ must be a reflection. We want to maximize $s_1 M_{11} + s_2 M_{22}$ for a reflection matrix $M$. The orthogonal matrix $M$ that has $\\det(M)=-1$ and maximizes this trace is $M = \\mathrm{diag}(1, -1)$. The maximum trace value is $s_1 - s_2$.\n$$V^\\top R U = \\begin{pmatrix} 1 & 0 \\\\ 0 & -1 \\end{pmatrix} \\implies R = V \\begin{pmatrix} 1 & 0 \\\\ 0 & -1 \\end{pmatrix} U^\\top$$\nLet's check the determinant: $\\det(R) = \\det(V) \\det(\\mathrm{diag}(1,-1)) \\det(U^\\top) = \\det(V)(-1)\\det(U) = -(\\det(V)\\det(U))$. Since we are in the case where $\\det(V)\\det(U)=-1$, we get $\\det(R) = -(-1) = 1$. This $R$ is in $\\mathrm{SO}(2)$.\n\n**Application to the Given Data**\n\nThe landmark sets are:\n$x_{1}=\\begin{pmatrix}0 \\\\ 0\\end{pmatrix}, x_{2}=\\begin{pmatrix}1 \\\\ 0\\end{pmatrix}, x_{3}=\\begin{pmatrix}0 \\\\ 1\\end{pmatrix}$\n$y_{1}=\\begin{pmatrix}2 \\\\ -1\\end{pmatrix}, y_{2}=\\begin{pmatrix}2 \\\\ 0\\end{pmatrix}, y_{3}=\\begin{pmatrix}1 \\\\ -1\\end{pmatrix}$\n\n1.  **Centroids:**\n    $\\bar{x} = \\frac{1}{3}\\left(\\begin{pmatrix}0 \\\\ 0\\end{pmatrix} + \\begin{pmatrix}1 \\\\ 0\\end{pmatrix} + \\begin{pmatrix}0 \\\\ 1\\end{pmatrix}\\right) = \\begin{pmatrix}1/3 \\\\ 1/3\\end{pmatrix}$\n    $\\bar{y} = \\frac{1}{3}\\left(\\begin{pmatrix}2 \\\\ -1\\end{pmatrix} + \\begin{pmatrix}2 \\\\ 0\\end{pmatrix} + \\begin{pmatrix}1 \\\\ -1\\end{pmatrix}\\right) = \\begin{pmatrix}5/3 \\\\ -2/3\\end{pmatrix}$\n\n2.  **Centered points:**\n    $x'_{1} = \\begin{pmatrix}-1/3 \\\\ -1/3\\end{pmatrix}, x'_{2} = \\begin{pmatrix}2/3 \\\\ -1/3\\end{pmatrix}, x'_{3} = \\begin{pmatrix}-1/3 \\\\ 2/3\\end{pmatrix}$\n    $y'_{1} = \\begin{pmatrix}1/3 \\\\ -1/3\\end{pmatrix}, y'_{2} = \\begin{pmatrix}1/3 \\\\ 2/3\\end{pmatrix}, y'_{3} = \\begin{pmatrix}-2/3 \\\\ -1/3\\end{pmatrix}$\n\n3.  **Cross-covariance matrix $H = \\sum_{i=1}^{3} x'_{i} (y'_{i})^{\\top}$:**\n    $H = \\begin{pmatrix}-1/3 \\\\ -1/3\\end{pmatrix}\\begin{pmatrix}1/3 & -1/3\\end{pmatrix} + \\begin{pmatrix}2/3 \\\\ -1/3\\end{pmatrix}\\begin{pmatrix}1/3 & 2/3\\end{pmatrix} + \\begin{pmatrix}-1/3 \\\\ 2/3\\end{pmatrix}\\begin{pmatrix}-2/3 & -1/3\\end{pmatrix}$\n    $H = \\frac{1}{9}\\begin{pmatrix}-1 & 1 \\\\ -1 & 1\\end{pmatrix} + \\frac{1}{9}\\begin{pmatrix}2 & 4 \\\\ -1 & -2\\end{pmatrix} + \\frac{1}{9}\\begin{pmatrix}2 & 1 \\\\ -4 & -2\\end{pmatrix} = \\frac{1}{9}\\begin{pmatrix}3 & 6 \\\\ -6 & -3\\end{pmatrix} = \\frac{1}{3}\\begin{pmatrix}1 & 2 \\\\ -2 & -1\\end{pmatrix}$\n\n4.  **SVD of $H$:** $H = U S V^\\top$.\n    The eigenvalues of $HH^\\top$ are $s_1^2=1$ and $s_2^2=1/9$, so the singular values are $s_1=1, s_2=1/3$. So $S=\\begin{pmatrix}1 & 0 \\\\ 0 & 1/3\\end{pmatrix}$.\n    The eigenvectors of $HH^\\top$ form $U$:\n    For $s_1^2=1$: eigenvector is $\\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 \\\\ -1\\end{pmatrix}$.\n    For $s_2^2=1/9$: eigenvector is $\\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 \\\\ 1\\end{pmatrix}$.\n    Let's choose $U = \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 & 1 \\\\ -1 & 1\\end{pmatrix}$. We can check that $\\det(U)=1$.\n    The columns of $V$ are found by $v_i = \\frac{1}{s_i} H^\\top u_i$.\n    $v_1 = \\frac{1}{1}\\frac{1}{3}\\begin{pmatrix}1 & -2 \\\\ 2 & -1\\end{pmatrix}\\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 \\\\ -1\\end{pmatrix} = \\frac{1}{3\\sqrt{2}}\\begin{pmatrix}3 \\\\ 3\\end{pmatrix} = \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 \\\\ 1\\end{pmatrix}$.\n    $v_2 = \\frac{1}{1/3}\\frac{1}{3}\\begin{pmatrix}1 & -2 \\\\ 2 & -1\\end{pmatrix}\\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 \\\\ 1\\end{pmatrix} = \\frac{1}{\\sqrt{2}}\\begin{pmatrix}-1 \\\\ 1\\end{pmatrix}$.\n    So $V = \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 & -1 \\\\ 1 & 1\\end{pmatrix}$. We check that $\\det(V)=1$.\n\n5.  **Compute optimal rotation $R$:**\n    Since $\\det(U)\\det(V) = (1)(1)=1$, we are in Case 1. The optimal rotation is $R=VU^\\top$.\n    $U^\\top = \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 & -1 \\\\ 1 & 1\\end{pmatrix}$.\n    $R = V U^\\top = \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 & -1 \\\\ 1 & 1\\end{pmatrix} \\frac{1}{\\sqrt{2}}\\begin{pmatrix}1 & -1 \\\\ 1 & 1\\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix}1-1 & -1-1 \\\\ 1+1 & -1+1\\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix}0 & -2 \\\\ 2 & 0\\end{pmatrix} = \\begin{pmatrix}0 & -1 \\\\ 1 & 0\\end{pmatrix}$.\n    This is a valid rotation with $\\det(R)=1$.\n    The components are $R_{11}=0, R_{12}=-1, R_{21}=1, R_{22}=0$.\n\n6.  **Compute optimal translation $t$:**\n    $t = \\bar{y} - R\\bar{x} = \\begin{pmatrix}5/3 \\\\ -2/3\\end{pmatrix} - \\begin{pmatrix}0 & -1 \\\\ 1 & 0\\end{pmatrix}\\begin{pmatrix}1/3 \\\\ 1/3\\end{pmatrix}$\n    $t = \\begin{pmatrix}5/3 \\\\ -2/3\\end{pmatrix} - \\begin{pmatrix}-1/3 \\\\ 1/3\\end{pmatrix} = \\begin{pmatrix}5/3+1/3 \\\\ -2/3-1/3\\end{pmatrix} = \\begin{pmatrix}6/3 \\\\ -3/3\\end{pmatrix} = \\begin{pmatrix}2 \\\\ -1\\end{pmatrix}$.\n    The components are $t_1=2, t_2=-1$.\n\nThe six numbers are $R_{11}=0, R_{12}=-1, R_{21}=1, R_{22}=0, t_1=2, t_2=-1$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & -1 & 1 & 0 & 2 & -1\n\\end{pmatrix}\n}\n$$"
        }
    ]
}