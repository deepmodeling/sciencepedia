{
    "hands_on_practices": [
        {
            "introduction": "掌握影像组学质量评分 (RQS) 的第一步是学习如何应用它。本练习将引导你扮演审稿人的角色，对一项设计精良的影像组学研究进行逐项评分。通过这项实践，你将熟悉RQS清单中的关键组成部分，并学会如何依据最佳实践标准，系统地评估一项研究的方法学严谨性。",
            "id": "4554364",
            "problem": "放射组学工作流程的核心目标是通过系统地执行标准化步骤，包括图像采集、分割、预处理、特征提取、模型构建和验证，来生成稳健、可推广且具有临床意义的模型。为了评估一项放射组学研究是否在整个工作流程中遵循了最佳实践，我们使用放射组学质量评分（Radiomics Quality Score, RQS）。放射组学质量评分（RQS）为特定的、广为接受的研究设计和报告组成部分分配分数，这些组成部分反映了方法的严谨性和转化应用的准备程度。在这个问题中，您将通过对一个假设性研究的适用项目求和并减去发生的罚分，来计算其总 RQS。\n\n本问题的评分标准使用以下项目和分值，这与常规实践一致，且总分上限为 $36$ 分：\n\n- 影像方案标准化并有完整文档记录：$+2$\n- 多次分割或观察者间变异性分析：$+1$\n- 评估特征对采集参数敏感性的体模研究：$+1$\n- 对部分受试者进行重测或可重复性分析：$+2$\n- 适当的特征降维和多重假设检验校正：$+3$\n- 包含非放射组学协变量（例如，年龄或临床分期）的多变量分析：$+2$\n- 证明了生物学相关性（例如，与组织病理学或基因表达的相关性）：$+4$\n- 报告了区分度统计数据（例如，受试者工作特征曲线下面积）：$+2$\n- 报告了校准度统计数据（例如，校准曲线或 Hosmer–Lemeshow 检验）：$+1$\n- 在独立队列上进行外部验证：$+4$\n- 与非放射组学的标准治疗基线（例如，肿瘤-淋巴结-转移分期）进行比较：$+2$\n- 开放科学元素（例如，发布代码、特征和去识别化的数据集）：$+3$\n- 带有预先注册的前瞻性设计（例如，在数据累积前进行注册登记）：$+7$\n- 进行了成本效益分析：$+2$\n- 通过最佳截断点进行事后二分类，但没有充分的理由或验证：$-1$\n\n考虑以下旨在预测头颈癌 $2$ 年局部复发的假设性研究：\n\n- 影像方案在不同扫描仪之间进行了统一，并在方法部分有完整文档记录。\n- 两名经验丰富的放射科医生独立分割了肿瘤总体积；使用组内相关系数对观察者间的稳健性进行了量化，并排除了具有低一致性的特征。\n- 扫描了一个校准过的计算机断层扫描体模，以评估体素大小和重建核心对所选纹理特征的影响。\n- 一组 $20$ 名患者在 $48$ 小时内接受了重复成像；对特征的可重复性进行了量化，并以此仅保留稳定的特征。\n- 使用递归特征消除法对特征空间进行了降维；在单变量筛选期间，应用了错误发现率校正。\n- 最终模型在一个多变量框架中，除了放射组学特征外，还包括了年龄和肿瘤-淋巴结-转移分期。\n- 将选定的放射组学特征与活检标本的 Ki–$67$ 增殖指数进行了相关性分析。\n- 使用受试者工作特征曲线下面积报告了模型的区分度。\n- 使用校准图和 Hosmer–Lemeshow 拟合优度检验评估了模型的校准度。\n- 模型在来自另一家机构的独立队列上进行了外部验证。\n- 将该模型的性能与仅使用肿瘤-淋巴结-转移分期的基线多变量模型进行了比较。\n- 代码、完整的特征定义、训练好的模型以及带有分割的去识别化影像数据子集在一个存储库中公开发布。\n- 该研究是前瞻性设计的，并在患者招募前进行了注册，并报告了对注册方案的遵守情况。\n- 进行了一项成本效益分析，以评估相对于标准治疗影像随访计划的临床效用。\n- 在探索性分析中，使用训练集上的 Youden 指数对单个纹理特征进行二分类，以定义“高风险”与“低风险”组；这个截断点没有预先指定，也未在训练集之外得到验证。\n\n通过对适用的正向项目求和并减去任何罚分，计算该研究的总放射组学质量评分。将您的最终答案报告为一个整数分数。不需要四舍五入，最终答案中也不应包含任何单位。",
            "solution": "这个问题是有效的，因为它在放射组学领域有科学依据，问题阐述清晰，客观，并且包含了解决问题所需的一套完整且一致的信息。任务是通过对照提供的评分标准，系统地评估一个假设性研究的方法学，从而计算其总放射组学质量评分（RQS）。总分 $S_{\\text{RQS}}$ 是满足特定标准所获得的分数之和，减去所产生的任何罚分。\n\n假设性研究的评分确定如下，通过将研究描述与评分标准中的每个项目进行匹配：\n\n1.  **影像方案标准化并有完整文档记录（$+2$ 分）：** 研究描述中提到：“影像方案在不同扫描仪之间进行了统一，并在方法部分有完整文档记录。”这直接满足了该标准。得分：$+2$。\n\n2.  **多次分割或观察者间变异性分析（$+1$ 分）：** 研究描述证实了这一点：“两名经验丰富的放射科医生独立分割了肿瘤总体积；使用组内相关系数对观察者间的稳健性进行了量化，并排除了具有低一致性的特征。”这满足了要求。得分：$+1$。\n\n3.  **评估特征对采集参数敏感性的体模研究（$+1$ 分）：** 该标准得到满足，如描述所述：“扫描了一个校准过的计算机断层扫描体模，以评估体素大小和重建核心对所选纹理特征的影响。”得分：$+1$。\n\n4.  **对部分受试者进行重测或可重复性分析（$+2$ 分）：** 该研究包括了此项分析：“一组 $20$ 名患者在 $48$ 小时内接受了重复成像；对特征的可重复性进行了量化，并以此仅保留稳定的特征。”得分：$+2$。\n\n5.  **适当的特征降维和多重假设检验校正（$+3$ 分）：** 所描述的方法，“使用递归特征消除法对特征空间进行了降维；在单变量筛选期间，应用了错误发现率校正，”满足了该标准的两个组成部分。得分：$+3$。\n\n6.  **包含非放射组学协变量的多变量分析（$+2$ 分）：** 模型描述证实了这一点：“最终模型在一个多变量框架中，除了放射组学特征外，还包括了年龄和肿瘤-淋巴结-转移分期。”年龄和临床分期是非放射组学协变量。得分：$+2$。\n\n7.  **证明了生物学相关性（$+4$ 分）：** 研究建立了一个生物学联系：“将选定的放射组学特征与活检标本的 Ki–$67$ 增殖指数进行了相关性分析。”这是一个有效的生物学相关性。得分：$+4$。\n\n8.  **报告了区分度统计数据（$+2$ 分）：** 报告了区分性能：“使用受试者工作特征曲线下面积报告了模型的区分度。”这是一个标准的区分度度量。得分：$+2$。\n\n9.  **报告了校准度统计数据（$+1$ 分）：** 评估了校准度：“使用校准图和 Hosmer–Lemeshow 拟合优度检验评估了模型的校准度。”这些是标准的校准度度量。得分：$+1$。\n\n10. **在独立队列上进行外部验证（$+4$ 分）：** 该研究进行了外部验证：“模型在来自另一家机构的独立队列上进行了外部验证。”这是实现可推广性的关键一步。得分：$+4$。\n\n11. **与非放射组学的标准治疗基线进行比较（$+2$ 分）：** 对模型的效用进行了基准测试：“将该模型的性能与仅使用肿瘤-淋巴结-转移分期的基线多变量模型进行了比较。”得分：$+2$。\n\n12. **开放科学元素（$+3$ 分）：** 该研究遵循了开放科学原则：“代码、完整的特征定义、训练好的模型以及带有分割的去识别化影像数据子集在一个存储库中公开发布。”得分：$+3$。\n\n13. **带有预先注册的前瞻性设计（$+7$ 分）：** 该研究设计是前瞻性的：“该研究是前瞻性设计的，并在患者招募前进行了注册，并报告了对注册方案的遵守情况。”这代表了最高级别的证据。得分：$+7$。\n\n14. **进行了成本效益分析（$+2$ 分）：** 该研究评估了经济影响：“进行了一项成本效益分析，以评估相对于标准治疗影像随访计划的临床效用。”得分：$+2$。\n\n15. **通过最佳截断点进行事后二分类，但没有充分的理由或验证（$-1$ 分）：** 研究描述中包含一个导致罚分的方法学缺陷：“在探索性分析中，使用训练集上的 Youden 指数对单个纹理特征进行二分类，以定义‘高风险’与‘低风险’组；这个截断点没有预先指定，也未在训练集之外得到验证。”这是事后二分类的一个典型例子，可能会引入偏倚。扣分：$-1$。\n\n总放射组学质量评分是所有获得的分数和扣除的罚分的代数和。所有正分数的总和是 $2+1+1+2+3+2+4+2+1+4+2+3+7+2 = 36$。这个总和与问题陈述中指定的最大可能分数相符。\n\n最终的计算是：\n$$S_{\\text{RQS}} = 2 + 1 + 1 + 2 + 3 + 2 + 4 + 2 + 1 + 4 + 2 + 3 + 7 + 2 - 1$$\n$$S_{\\text{RQS}} = 36 - 1$$\n$$S_{\\text{RQS}} = 35$$\n该假设性研究的总放射组学质量评分为 $35$。",
            "answer": "$$\\boxed{35}$$"
        },
        {
            "introduction": "影像组学质量评分 (RQS) 中的许多标准并非主观规定，而是防范严重统计陷阱的关键屏障。本练习将带你深入理解其中一项——多重假设检验校正的必要性。通过计算在缺乏校正时，筛选大量影像特征所导致的错误发现率 (False Discovery Rate, $FDR$)，你将亲身体会到为何RQS强调严格的统计学校正，以确保研究结果的可靠性。",
            "id": "4567811",
            "problem": "一项放射组学研究从医学图像中提取 $m$ 个手工制作的纹理和形状特征，并通过独立的单变量统计检验针对一个二元临床终点对它们进行筛选，选择所有 $p$ 值小于名义显著性水平 $\\alpha$ 的特征，且不进行任何多重假设校正。假设一个科学上合理的情景：测试了 $m = 1000$ 个特征，其中 $m_{0} = 900$ 个是真零假设（与终点无关联），$m_{1} = 100$ 个是真非零假设（与终点有关联）。假设对于非零假设特征的单变量检验，在显著性水平 $\\alpha = 0.05$ 下，其平均统计功效为 $\\pi = 0.60$。将各特征的检验结果视为独立的，并使用大样本近似，其中独立指示变量的总和集中在其期望值附近。\n\n从I类错误（$\\alpha$）、统计功效（$\\pi$）和错误发现率（FDR）的基本定义出发，推导在该筛选程序下预期FDR的解析表达式，并针对给定的 $(m, m_{0}, m_{1}, \\alpha, \\pi)$ 进行计算。FDR定义为在所有被选中的特征中，错误发现的预期比例。将最终的数值结果表示为一个精确分数。\n\n最后，定性地、无需额外计算地解释放射组学质量评分（RQS）(Radiomics Quality Score)如何通过其在研究设计、分析和验证方面的要求，来防范您计算出的预期FDR所例证的陷阱。您的解释不会影响数值答案的要求。",
            "solution": "题目要求在特定条件下，推导并计算一项放射组学筛选研究的预期错误发现率（FDR），并随后定性解释放射组学质量评分（RQS）如何缓解所阐述的统计陷阱。\n\n### 问题验证\n\n所提供的问题陈述被验证为具有科学依据、问题明确、客观且完整。所有必要的参数和定义都已提供。所描述的情景是高维数据分析中的一个标准且高度相关的问题，尤其是在生物信息学和放射组学领域。参数是一致的，总特征数 $m = 1000$ 是零假设特征数 $m_0 = 900$ 和非零假设特征数 $m_1 = 100$ 的总和。该问题可以使用基本的统计学原理进行形式化，并且不违反任何科学定律或包含逻辑矛盾。因此，可以构建一个完整的解决方案。\n\n### 预期错误发现率（FDR）的推导\n\n错误发现率被定义为在所有被宣布为显著的特征中，错误发现的预期比例。在本题的背景下，采用了大样本近似，我们可以将预期FDR表示为预期错误发现数与预期总发现数的比率。\n\n让我们正式定义所涉及的量：\n-   $V$：错误发现的数量。这些是实际上为零假设却被错误地宣布为显著的特征（I类错误）。\n-   $S$：真实发现的数量。这些是实际上为非零假设且被正确地宣布为显著的特征。\n-   $R = V + S$：总发现数（所有被选中的特征）。\n\n预期FDR可近似表示为：\n$$\n\\text{Expected FDR} = \\frac{E[V]}{E[R]} = \\frac{E[V]}{E[V] + E[S]}\n$$\n\n我们首先计算预期错误发现数 $E[V]$。\n存在 $m_0 = 900$ 个真零假设特征。每个特征都在名义显著性水平 $\\alpha = 0.05$ 下进行检验。根据定义，显著性水平 $\\alpha$ 是单次检验犯I类错误的概率。假设各检验是独立的，则错误发现的数量 $V$ 服从二项分布，$V \\sim \\text{Binomial}(m_0, \\alpha)$。二项分布的期望是试验次数与成功概率的乘积。\n因此，预期错误发现数为：\n$$\nE[V] = m_0 \\alpha\n$$\n\n接下来，我们计算预期真实发现数 $E[S]$。\n存在 $m_1 = 100$ 个真非零假设特征。平均统计功效 $\\pi = 0.60$ 是正确检测到真实关联（即正确拒绝错误的零假设）的概率。假设各检验是独立的，则真实发现的数量 $S$ 服从二项分布，$S \\sim \\text{Binomial}(m_1, \\pi)$。\n因此，预期真实发现数为：\n$$\nE[S] = m_1 \\pi\n$$\n\n现在，我们可以构建预期FDR的解析表达式。预期总发现数为 $E[R] = E[V] + E[S] = m_0 \\alpha + m_1 \\pi$。\n将 $E[V]$ 和 $E[R]$ 的表达式代入，得到最终的解析表达式：\n$$\n\\text{Expected FDR} = \\frac{m_0 \\alpha}{m_0 \\alpha + m_1 \\pi}\n$$\n\n### 数值计算\n\n给定以下数值：\n-   零假设特征数，$m_0 = 900$\n-   非零假设特征数，$m_1 = 100$\n-   显著性水平，$\\alpha = 0.05$\n-   平均统计功效，$\\pi = 0.60$\n\n首先，我们计算预期错误发现数：\n$$\nE[V] = 900 \\times 0.05 = 45\n$$\n平均而言，我们预计有 $45$ 个特征会仅因偶然性而被宣布为显著。\n\n接下来，我们计算预期真实发现数：\n$$\nE[S] = 100 \\times 0.60 = 60\n$$\n平均而言，我们预计能正确识别出 $60$ 个真正相关的特征。\n\n预期被选中的总特征数为：\n$$\nE[R] = E[V] + E[S] = 45 + 60 = 105\n$$\n\n最后，我们通过计算预期错误发现数与预期总发现数的比率来计算预期FDR：\n$$\n\\text{Expected FDR} = \\frac{45}{105}\n$$\n为了将其表示为最简精确分数，我们将分子和分母除以它们的最大公约数 $15$：\n$$\n\\text{Expected FDR} = \\frac{45 \\div 15}{105 \\div 15} = \\frac{3}{7}\n$$\n预期FDR为 $\\frac{3}{7}$，约等于 $0.4286$。这意味着在指定的筛选程序下，我们预计所选特征中近 $43\\%$ 实际上是与临床终点没有真实关联的伪发现。\n\n### 放射组学质量评分（RQS）的作用\n\n计算出的高预期FDR值（$\\frac{3}{7}$）例证了高维数据分析中的一个关键陷阱：多重比较问题。当同时检验许多假设时，如果没有进行适当的控制，获得假阳性的概率会迅速累积。放射组学质量评分（RQS）是一个旨在增强放射组学研究的方法学严谨性和可重复性的框架，它包含了一些特定组成部分来防范这一确切的陷阱。\n\nRQS 会因几个主要原因给问题中描述的研究打低分：\n1.  **缺乏多重检验校正**：RQS框架明确要求进行多重假设检验的研究必须应用统计校正。问题陈述中提到，特征是在其 $p < \\alpha$ 的情况下被选中的，“且不进行任何多重假设校正”。一项合格的研究会应用像 Bonferroni 校正这样的方法，或者在以发现为导向的领域中更常用的是错误发现率控制程序（例如，Benjamini-Hochberg）。不这样做是一个重大的方法学缺陷，而RQS正是为了检测和惩罚这种缺陷而设计的。\n\n2.  **强调验证**：RQS的一个基石是对研究结果的稳健验证。RQS会对使用数据划分策略（例如，训练/测试集）以及最重要的是，在独立的外部验证队列上测试最终模型或发现的研究给予加分。一个被高比例假阳性污染的特征集（如高预期FDR所示）将导致模型对训练数据严重过拟合。这样的模型在其构建所用的数据上会表现出良好性能，但几乎肯定无法泛化，在任何独立的验证集上都会表现不佳。RQS严格的验证要求将暴露这些伪发现的不可重复性和临床效用的缺乏。\n\n3.  **促进方法学透明度**：RQS要求对整个分析流程进行清晰和完整的报告。一项遵循RQS指南的研究必须明确说明测试了 $1000$ 个特征，并且没有应用多重性校正。仅凭这种透明度，同行评审员和读者就能立即识别出错误发现的高风险，并对研究结论的有效性提出批判性质疑。\n\n本质上，RQS充当了一个强制执行最佳统计实践的质量控制清单。通过强制要求多重检验校正和稳健的独立验证，它直接和间接地确保了最终报告的放射组学特征集不会被大规模筛选中因缺乏统计严谨性而不可避免产生的伪关联所淹没。",
            "answer": "$$\\boxed{\\frac{3}{7}}$$"
        },
        {
            "introduction": "满足RQS标准不仅需要理论知识，还需要具体的实践技能。本练习聚焦于RQS的一个核心要求：特征可重复性分析 (test-retest analysis)。你将面临一个编程挑战，任务是实现一个严谨的统计检验，以判断影像特征的稳定性是否足以检测出具有临床意义的真实变化，这让你能够将抽象的质量标准转化为可执行的验证代码。",
            "id": "4567831",
            "problem": "您正在本着影像组学质量评分 (RQS) 的精神评估影像组学特征的可重复性，该评分旨在奖励透明、遵循统计学原理的测试-重测分析以及与临床有意义差异的关联。考虑一个由多名受试者组成的队列，每名受试者在相同条件下重复扫描。对于给定特征，设受试者 $i$ 在第 $j$ 次重复测量中的测量值为 $x_{ij}$。假设以下基本前提，您必须在推导中使用它们：\n\n- 单因素随机效应模型：$x_{ij} = \\mu + s_i + \\varepsilon_{ij}$，其中 $s_i \\sim \\mathcal{N}(0,\\sigma_b^2)$ 代表受试者间变异性，$\\varepsilon_{ij} \\sim \\mathcal{N}(0,\\sigma_w^2)$ 代表受试者内（重复性）变异性。所有 $s_i$ 和 $\\varepsilon_{ij}$ 相互独立。\n- 如果 $X \\sim \\mathcal{N}(\\mu,\\sigma^2)$ 和 $Y \\sim \\mathcal{N}(\\mu,\\sigma^2)$ 独立，那么 $X - Y \\sim \\mathcal{N}(0,2\\sigma^2)$。\n- 对于从正态数据计算的合并受试者内样本方差估计量 $s_w^2$（其总受试者内自由度为 $\\text{df}_w$），标度化统计量 $\\text{df}_w \\cdot s_w^2 / \\sigma_w^2$ 服从自由度为 $\\text{df}_w$ 的卡方分布。\n- 设 $Z \\sim \\mathcal{N}(0,1)$，$z_{p}$ 表示满足 $\\mathbb{P}(Z \\le z_{p}) = p$ 的分位数。\n\n任务 A（推导）：仅从上述基本前提开始，推导一个单侧假设检验，用于判断给定特征的受试者内标准差 $\\sigma_w$ 是否足够小，以至于量级为 $\\Delta_c$ 的临床有意义变化能够以高概率与测量噪声区分开。将临床阈值形式化为以下要求：两次重复测量之差在覆盖概率 $p$ 下的最小可检测变化（记为 $\\mathrm{SDC}_p$）满足 $\\mathrm{SDC}_p \\le \\beta \\cdot \\Delta_c$，其中 $\\beta \\in (0,1)$ 是一个选定的分数。用 $\\sigma_w$、$z_p$ 和基本事实表示 $\\mathrm{SDC}_p$，并推导关于 $\\sigma_w^2$ 相对于由 $\\mathrm{SDC}_p \\le \\beta \\cdot \\Delta_c$ 所隐含的界限 $\\sigma_{w,0}^2$ 的原假设和备择假设。然后，利用 $\\text{df}_w \\cdot s_w^2 / \\sigma_w^2$ 的卡方分布，推导在显著性水平 $\\alpha$ 下的单侧 $p$ 值和决策规则。\n\n任务 B（与组内相关系数的联系）：使用单因素随机效应模型中的方差分量，定义组内相关系数 $\\mathrm{ICC} = \\sigma_b^2 / (\\sigma_b^2 + \\sigma_w^2)$。展示临床可重复性要求 $\\mathrm{SDC}_p \\le \\beta \\cdot \\Delta_c$ 如何作为一个关于总方差 $\\sigma_b^2 + \\sigma_w^2$、$\\Delta_c$、$\\beta$ 和 $z_p$ 的函数，导出一个最小可接受 $\\mathrm{ICC}$ 阈值 $T_{\\min}$。提供基于可从数据中估计的量的 $T_{\\min}$ 的显式表达式。\n\n实现要求：将任务 A 中的假设检验实现为一个程序，该程序为每个特征计算：\n- 合并的受试者内方差估计值 $s_w^2$ 及其对应的自由度 $\\text{df}_w$，\n- 在覆盖率 $p = 0.95$ 时，由 $\\mathrm{SDC}_p \\le \\beta \\cdot \\Delta_c$ 隐含的界限 $\\sigma_{w,0}^2$，\n- 用于检验 $H_0: \\sigma_w^2 \\ge \\sigma_{w,0}^2$ 与 $H_1: \\sigma_w^2  \\sigma_{w,0}^2$ 的单侧卡方 $p$ 值，\n- 以及一个布尔决策，如果 $p$ 值小于或等于 $\\alpha$，则接受该特征为“重复性高于阈值”。\n\n为了完整性（但不用于决策），还应计算样本组内相关系数和任务 B 中推导出的隐含最小可接受 $\\mathrm{ICC}$ 阈值 $T_{\\min}$，在适当时使用平衡单因素方差分析估计量。\n\n测试套件：您的程序必须精确评估以下四个测试用例，每个用例由一个数据矩阵（受试者列表，每个受试者有其重复测量值）和参数 $(\\Delta_c,\\beta,\\alpha)$ 定义，覆盖率 $p$ 固定为 $0.95$：\n\n- 测试用例 $1$（预期通过）：数据\n  - 受试者 $1$：[$50.02$, $49.98$, $49.99$]\n  - 受试者 $2$：[$49.51$, $49.49$, $49.50$]\n  - 受试者 $3$：[$50.20$, $50.11$, $50.18$]\n  - 受试者 $4$：[$49.82$, $49.78$, $49.81$]\n  - 受试者 $5$：[$50.11$, $50.08$, $50.12$]\n  - 受试者 $6$：[$49.88$, $49.92$, $49.90$]\n  参数为 $(\\Delta_c,\\beta,\\alpha) = (0.8, 0.5, 0.05)$。\n\n- 测试用例 $2$（预期失败）：数据\n  - 受试者 $1$：[$100.00$, $100.50$]\n  - 受试者 $2$：[$99.80$, $100.30$]\n  - 受试者 $3$：[$100.20$, $99.60$]\n  - 受试者 $4$：[$100.40$, $100.00$]\n  - 受试者 $5$：[$99.90$, $100.50$]\n  - 受试者 $6$：[$100.10$, $99.70$]\n  参数为 $(\\Delta_c,\\beta,\\alpha) = (0.5, 0.5, 0.05)$。\n\n- 测试用例 $3$（边界附近的边缘情况）：数据\n  - 受试者 $1$：[$80.00$, $80.07$, $79.93$]\n  - 受试者 $2$：[$79.50$, $79.58$, $79.44$]\n  - 受试者 $3$：[$80.30$, $80.37$, $80.23$]\n  - 受试者 $4$：[$79.90$, $79.98$, $79.82$]\n  - 受试者 $5$：[$80.10$, $80.18$, $80.02$]\n  参数为 $(\\Delta_c,\\beta,\\alpha) = (0.6, 0.5, 0.05)$。\n\n- 测试用例 $4$（小样本，预期通过）：数据\n  - 受试者 $1$：[$120.00$, $119.98$, $120.01$, $120.02$, $119.99$]\n  - 受试者 $2$：[$119.50$, $119.52$, $119.49$, $119.51$, $119.50$]\n  - 受试者 $3$：[$120.20$, $120.18$, $120.21$, $120.19$, $120.20$]\n  参数为 $(\\Delta_c,\\beta,\\alpha) = (0.3, 0.5, 0.05)$。\n\n最终输出格式：您的程序应生成单行输出，其中包含四个测试用例的布尔决策值，按顺序排列，形式为方括号括起来的逗号分隔列表，例如，[$\\text{True}$,$\\text{False}$,$\\text{True}$,$\\text{True}$]。使用不带引号的标准编程语言布尔值。\n\n不涉及角度单位。不涉及物理单位。所有概率和显著性值必须以小数形式处理（例如，使用 $0.05$，而不是百分号）。",
            "solution": "经评估，该问题是有效的，因为它在科学上基于已建立的统计理论，问题阐述清晰，目标明确，并为推导和实现提供了完整且一致的信息。\n\n根据问题描述，解决方案分为两部分：任务 A，假设检验的推导；任务 B，与组内相关系数的联系。\n\n### 任务 A：假设检验的推导\n\n目标是构建一个假设检验，以确定一个影像组学特征的测量误差是否足够小。其标准是，由受试者内标准差 $\\sigma_w$ 量化的特征重复性，应能允许检测到临床有意义的变化 $\\Delta_c$。\n\n**步骤 1：形式化临床可重复性标准**\n\n问题给出了针对受试者 $i$ 在第 $j$ 次重复测量的测量值 $x_{ij}$ 的单因素随机效应模型：\n$$x_{ij} = \\mu + s_i + \\varepsilon_{ij}$$\n其中 $s_i \\sim \\mathcal{N}(0, \\sigma_b^2)$ 是受试者间效应，$\\varepsilon_{ij} \\sim \\mathcal{N}(0, \\sigma_w^2)$ 是受试者内测量误差。所有随机效应相互独立。\n\n考虑同一受试者 $i$ 的两次重复测量值 $x_{i1}$ 和 $x_{i2}$。它们的差值为：\n$$d_i = x_{i1} - x_{i2} = (\\mu + s_i + \\varepsilon_{i1}) - (\\mu + s_i + \\varepsilon_{i2}) = \\varepsilon_{i1} - \\varepsilon_{i2}$$\n由于 $\\varepsilon_{i1}$ 和 $\\varepsilon_{i2}$ 是从 $\\mathcal{N}(0, \\sigma_w^2)$ 中抽取的独立样本，我们使用提供的基本事实，即两个独立同分布的正态变量 $X, Y \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 之差为 $X-Y \\sim \\mathcal{N}(0, 2\\sigma^2)$。应用此事实，差值 $d_i$ 服从正态分布：\n$$d_i \\sim \\mathcal{N}(0, 2\\sigma_w^2)$$\n这个差值的标准差是 $\\sqrt{2}\\sigma_w$。\n\n在覆盖概率为 $p$ 时，最小可检测变化（$\\mathrm{SDC}_p$）代表了能够与随机测量误差可靠区分的变化量级。$\\mathrm{SDC}_p$ 的一个标准定义是包含比例为 $p$ 的差值的对称预测区间的半宽度。该区间为 $[ -z_{(1+p)/2} \\sqrt{2} \\sigma_w, +z_{(1+p)/2} \\sqrt{2} \\sigma_w ]$，其中 $Z \\sim \\mathcal{N}(0,1)$，$z_q$ 是满足 $\\mathbb{P}(Z \\le z_q) = q$ 的分位数。尽管问题中提到了 $z_p$，但“覆盖概率”的使用强烈暗示了一个双侧区间，其正确的分位数应为 $z_{(1+p)/2}$。因此，我们将 $\\mathrm{SDC}_p$ 定义为：\n$$\\mathrm{SDC}_p = z_{(1+p)/2} \\sqrt{2} \\sigma_w$$\n\n临床要求是这个最小可检测变化不得大于临床有意义变化 $\\Delta_c$ 的一个分数 $\\beta$：\n$$\\mathrm{SDC}_p \\le \\beta \\cdot \\Delta_c$$\n代入我们的 $\\mathrm{SDC}_p$ 表达式：\n$$z_{(1+p)/2} \\sqrt{2} \\sigma_w \\le \\beta \\cdot \\Delta_c$$\n\n**步骤 2：构建原假设和备择假设**\n\n我们可以重排该不等式，使其成为关于受试者内方差 $\\sigma_w^2$ 的条件。\n$$\\sigma_w \\le \\frac{\\beta \\cdot \\Delta_c}{z_{(1+p)/2} \\sqrt{2}}$$\n两边平方得到关于方差的条件：\n$$\\sigma_w^2 \\le \\frac{(\\beta \\cdot \\Delta_c)^2}{2 (z_{(1+p)/2})^2}$$\n我们将方差的临界阈值 $\\sigma_{w,0}^2$ 定义为该不等式的上界：\n$$\\sigma_{w,0}^2 = \\frac{(\\beta \\cdot \\Delta_c)^2}{2 (z_{(1+p)/2})^2}$$\n如果一个特征的真实受试者内方差 $\\sigma_w^2$ 小于或等于此阈值，则认为其重复性可接受。我们希望检验是否有证据表明该特征满足此标准。因此，陈述 $\\sigma_w^2  \\sigma_{w,0}^2$ 成为我们的备择假设 $H_1$。原假设 $H_0$ 是其补集。\n$$H_0: \\sigma_w^2 \\ge \\sigma_{w,0}^2 \\quad (\\text{该特征的重复性不足})$$\n$$H_1: \\sigma_w^2  \\sigma_{w,0}^2 \\quad (\\text{该特征的重复性足够})$$\n\n**步骤 3：推导检验统计量和决策规则**\n\n问题指出，对于一个具有 $\\text{df}_w$ 自由度的合并受试者内样本方差估计量 $s_w^2$，统计量 $\\frac{\\text{df}_w \\cdot s_w^2}{\\sigma_w^2}$ 服从自由度为 $\\text{df}_w$ 的卡方分布：\n$$\\frac{\\text{df}_w \\cdot s_w^2}{\\sigma_w^2} \\sim \\chi^2(\\text{df}_w)$$\n为了检验我们的假设，我们构建一个检验统计量，并假设原假设为真。我们在原假设的边界情况下进行检验，即假设 $\\sigma_w^2 = \\sigma_{w,0}^2$。检验统计量 $T_0$ 为：\n$$T_0 = \\frac{\\text{df}_w \\cdot s_w^2}{\\sigma_{w,0}^2}$$\n在 $\\sigma_w^2 = \\sigma_{w,0}^2$ 的假设下，$T_0 \\sim \\chi^2(\\text{df}_w)$。\n\n我们的备择假设 $H_1: \\sigma_w^2  \\sigma_{w,0}^2$ 表明，观测到的样本方差 $s_w^2$ 将会很小。这意味着检验统计量 $T_0$ 的小值提供了反对 $H_0$ 并支持 $H_1$ 的证据。这是一个单侧左尾检验。\n\n$p$-值是在 $H_0$ 为真的情况下，观测到至少与我们的观测值 $T_{0,obs}$ 一样极端（即一样小）的检验统计量的概率。\n$$p\\text{-值} = \\mathbb{P}(\\chi^2(\\text{df}_w) \\le T_{0,obs}) = F_{\\chi^2(\\text{df}_w)}(T_{0,obs})$$\n其中 $F_{\\chi^2(\\text{df}_w)}$ 是自由度为 $\\text{df}_w$ 的卡方分布的累积分布函数 (CDF)。\n\n在显著性水平 $\\alpha$ 下的决策规则是：\n- 如果 $p\\text{-值} \\le \\alpha$，则拒绝 $H_0$。结论是该特征的重复性足够。\n- 如果 $p\\text{-值}  \\alpha$，则不拒绝 $H_0$。结论是没有足够证据表明该特征的重复性足够。\n\n### 任务 B：与组内相关系数 (ICC) 的联系\n\n组内相关系数 (ICC) 根据方差分量定义：\n$$\\mathrm{ICC} = \\frac{\\sigma_b^2}{\\sigma_b^2 + \\sigma_w^2}$$\n它表示总方差中由受试者间变异引起的部分所占的比例。较高的 ICC 表示相对重复性更好（即，受试者内噪声相对于受试者间信号较小）。\n\n我们可以将临床可重复性要求与一个最小可接受 ICC（$T_{\\min}$）联系起来。该要求是 $\\sigma_w^2 \\le \\sigma_{w,0}^2$。令 $\\sigma_T^2 = \\sigma_b^2 + \\sigma_w^2$ 为总方差。\n从 ICC 的定义中，我们可以用 ICC 和 $\\sigma_T^2$ 来表示 $\\sigma_w^2$：\n$$1 - \\mathrm{ICC} = 1 - \\frac{\\sigma_b^2}{\\sigma_T^2} = \\frac{\\sigma_T^2 - \\sigma_b^2}{\\sigma_T^2} = \\frac{\\sigma_w^2}{\\sigma_T^2}$$\n$$\\implies \\sigma_w^2 = \\sigma_T^2 (1 - \\mathrm{ICC})$$\n将此代入临床要求不等式中：\n$$\\sigma_T^2 (1 - \\mathrm{ICC}) \\le \\sigma_{w,0}^2$$\n解出 ICC：\n$$1 - \\mathrm{ICC} \\le \\frac{\\sigma_{w,0}^2}{\\sigma_T^2}$$\n$$1 - \\frac{\\sigma_{w,0}^2}{\\sigma_T^2} \\le \\mathrm{ICC}$$\n这设定了一个最小可接受 ICC 阈值 $T_{\\min}$：\n$$T_{\\min} = 1 - \\frac{\\sigma_{w,0}^2}{\\sigma_T^2} = 1 - \\frac{\\sigma_{w,0}^2}{\\sigma_b^2 + \\sigma_w^2}$$\n代入 $\\sigma_{w,0}^2$ 的表达式：\n$$T_{\\min} = 1 - \\frac{(\\beta \\cdot \\Delta_c)^2}{2 (z_{(1+p)/2})^2 (\\sigma_b^2 + \\sigma_w^2)}$$\n为了使其可操作，我们用从单因素方差分析 (ANOVA) 中得到的样本估计值替换真实的方差分量 $\\sigma_b^2$ 和 $\\sigma_w^2$。对于一个有 $I$ 个受试者和 $k$ 次重复的平衡设计，估计量为：\n- $\\hat{\\sigma}_w^2 = s_w^2 = \\text{MSW}$ (组内均方)\n- $\\hat{\\sigma}_b^2 = s_b^2 = (\\text{MSB} - \\text{MSW}) / k$ (组间均方)\n估计的总方差为 $s_T^2 = s_b^2 + s_w^2$。基于这些可估计量的最小可接受 ICC 阈值为：\n$$\\hat{T}_{\\min} = 1 - \\frac{\\sigma_{w,0}^2}{s_b^2 + s_w^2}$$\n样本 ICC 估计为：\n$$\\widehat{\\mathrm{ICC}} = \\frac{s_b^2}{s_b^2 + s_w^2} = \\frac{\\text{MSB} - \\text{MSW}}{\\text{MSB} + (k-1)\\text{MSW}}$$\n如果我们有统计置信度认为 $\\sigma_w^2 \\le \\sigma_{w,0}^2$，则满足临床要求，这对应于我们期望真实 ICC 大于或等于真实 $T_{\\min}$ 的情况。任务 A 中的假设检验提供了正式的决策机制。\n\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    p_coverage = 0.95\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"data\": [\n                [50.02, 49.98, 49.99], [49.51, 49.49, 49.50], [50.20, 50.11, 50.18],\n                [49.82, 49.78, 49.81], [50.11, 50.08, 50.12], [49.88, 49.92, 49.90]\n            ],\n            \"params\": {\"delta_c\": 0.8, \"beta\": 0.5, \"alpha\": 0.05}\n        },\n        {\n            \"data\": [\n                [100.00, 100.50], [99.80, 100.30], [100.20, 99.60],\n                [100.40, 100.00], [99.90, 100.50], [100.10, 99.70]\n            ],\n            \"params\": {\"delta_c\": 0.5, \"beta\": 0.5, \"alpha\": 0.05}\n        },\n        {\n            \"data\": [\n                [80.00, 80.07, 79.93], [79.50, 79.58, 79.44], [80.30, 80.37, 80.23],\n                [79.90, 79.98, 79.82], [80.10, 80.18, 80.02]\n            ],\n            \"params\": {\"delta_c\": 0.6, \"beta\": 0.5, \"alpha\": 0.05}\n        },\n        {\n            \"data\": [\n                [120.00, 119.98, 120.01, 120.02, 119.99],\n                [119.50, 119.52, 119.49, 119.51, 119.50],\n                [120.20, 120.18, 120.21, 120.19, 120.20]\n            ],\n            \"params\": {\"delta_c\": 0.3, \"beta\": 0.5, \"alpha\": 0.05}\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        data = np.array(case[\"data\"])\n        params = case[\"params\"]\n        \n        # Unpack parameters\n        delta_c = params[\"delta_c\"]\n        beta = params[\"beta\"]\n        alpha = params[\"alpha\"]\n\n        # Get data dimensions\n        # I: number of subjects, k: number of repeats per subject\n        I, k = data.shape\n\n        # Perform one-way ANOVA calculations to find variance components\n        # Calculate subject means and the grand mean\n        subject_means = data.mean(axis=1)\n        \n        # Sum of Squares Within (SSW) and Degrees of Freedom Within (df_w)\n        # SSW = sum over all i, j of (x_ij - x_i.)^2\n        ssw = np.sum((data - subject_means[:, np.newaxis])**2)\n        df_w = I * (k - 1)\n        \n        # Mean Square Within (MSW) is the pooled within-subject variance estimate (s_w^2)\n        s_w2 = ssw / df_w # This is MSW\n\n        # --- Task A: Hypothesis Test ---\n\n        # 1. Calculate the threshold variance sigma_w,0^2\n        # For a two-sided coverage probability p, we need the z-quantile for (1+p)/2\n        z_quantile = stats.norm.ppf((1 + p_coverage) / 2)\n        sigma_w0_2 = (beta * delta_c)**2 / (2 * z_quantile**2)\n\n        # 2. Calculate the chi-squared test statistic\n        # T_0 = df_w * s_w^2 / sigma_w,0^2\n        # Handle case where sigma_w0_2 is zero to avoid division by zero\n        if sigma_w0_2 == 0:\n            # If threshold is 0, any positive variance fails test. p-value is 1.\n            p_value = 1.0\n        else:\n            test_statistic = df_w * s_w2 / sigma_w0_2\n\n            # 3. Calculate the one-sided p-value from the chi-squared CDF\n            # H1 is s_w^2  sigma_w0_2, so it's a lower-tail test\n            p_value = stats.chi2.cdf(test_statistic, df=df_w)\n        \n        # 4. Make the decision\n        is_repeatable = p_value = alpha\n        results.append(is_repeatable)\n\n    # Final print statement in the exact required format.\n    # The boolean values are capitalized as per Python's standard, which is fine.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```",
            "answer": "[True,False,False,True]"
        }
    ]
}