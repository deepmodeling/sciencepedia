{
    "hands_on_practices": [
        {
            "introduction": "梯度算子，如 Prewitt、Sobel 和 Scharr 算子，是许多分割算法中检测物体边界的第一步。然而，不同的算子在性能上存在差异，尤其是在它们对不同方向边缘的响应一致性（即各向同性）方面。这项练习  将指导您通过频域分析，来严格评估这些算子的性能，从而理解为什么在实践中某些算子（如 Scharr）会优于其他算子。",
            "id": "4560267",
            "problem": "您正在设计一个用于放射组学的基于边缘的分割流程，其中梯度算子用于初始化或优化边界。三种常用的离散梯度掩模是 Prewitt、Sobel 和 Scharr 算子。每个算子都由一对 $3 \\times 3$ 的卷积核组成，一个用于水平分量 $G_{x}$，一个用于垂直分量 $G_{y}$。对于本问题，请使用以下未归一化的掩模（整体标量归一化与所要求的各向同性计算无关）：\n- Prewitt：$G_{x}^{\\mathrm{P}}=\\begin{pmatrix}-1  0  1 \\\\ -1  0  1 \\\\ -1  0  1\\end{pmatrix}$，$G_{y}^{\\mathrm{P}}=\\left(G_{x}^{\\mathrm{P}}\\right)^{\\top}$。\n- Sobel：$G_{x}^{\\mathrm{S}}=\\begin{pmatrix}-1  0  1 \\\\ -2  0  2 \\\\ -1  0  1\\end{pmatrix}$，$G_{y}^{\\mathrm{S}}=\\left(G_{x}^{\\mathrm{S}}\\right)^{\\top}$。\n- Scharr：$G_{x}^{\\mathrm{Sc}}=\\begin{pmatrix}-3  0  3 \\\\ -10  0  10 \\\\ -3  0  3\\end{pmatrix}$，$G_{y}^{\\mathrm{Sc}}=\\left(G_{x}^{\\mathrm{Sc}}\\right)^{\\top}$。\n\n考虑一个二维正弦光栅\n$$\nf(x,y)=A \\cos\\!\\big(\\omega\\,(x \\cos\\theta+y \\sin\\theta)\\big),\n$$\n其振幅 $A>0$，径向空间频率 $\\omega \\in (0,\\pi)$（单位为弧度/像素），以及方向 $\\theta \\in [0,2\\pi)$（单位为弧度）。当一个频率响应为 $H(\\omega_{x},\\omega_{y})$ 的线性移不变滤波器应用于空间频率向量为 $(\\omega\\cos\\theta,\\omega\\sin\\theta)$ 的余弦光栅时，输出是相同频率的余弦，其振幅乘以 $\\left|H(\\omega\\cos\\theta,\\omega\\sin\\theta)\\right|$。\n\n仅从二维线性卷积、二维离散傅里叶变换 (DFT) 以及上述核的定义出发，完成以下任务：\n1) 推导二维频率响应 $H_{x}^{\\mathrm{P}}(\\omega_{x},\\omega_{y})$、$H_{y}^{\\mathrm{P}}(\\omega_{x},\\omega_{y})$、$H_{x}^{\\mathrm{S}}(\\omega_{x},\\omega_{y})$、$H_{y}^{\\mathrm{S}}(\\omega_{x},\\omega_{y})$、$H_{x}^{\\mathrm{Sc}}(\\omega_{x},\\omega_{y})$ 和 $H_{y}^{\\mathrm{Sc}}(\\omega_{x},\\omega_{y})$。\n2) 对于每个算子 $\\mathrm{O}\\in\\{\\mathrm{P},\\mathrm{S},\\mathrm{Sc}\\}$，推导与方向相关的梯度幅值增益\n$$\nG_{\\mathrm{O}}(\\theta;\\omega)=\\sqrt{\\left|H_{x}^{\\mathrm{O}}(\\omega \\cos\\theta,\\omega \\sin\\theta)\\right|^{2}+\\left|H_{y}^{\\mathrm{O}}(\\omega \\cos\\theta,\\omega \\sin\\theta)\\right|^{2}}.\n$$\n3) 通过比较沿图像轴的增益与沿对角线的增益，定义频率 $\\omega$ 处的各向同性比：\n$$\nI_{\\mathrm{O}}(\\omega)=\\frac{G_{\\mathrm{O}}(0;\\omega)}{G_{\\mathrm{O}}(\\pi/4;\\omega)}.\n$$\n计算在 $\\omega=\\pi/4$（弧度/像素）时的 $I_{\\mathrm{P}}(\\omega)$、$I_{\\mathrm{S}}(\\omega)$ 和 $I_{\\mathrm{Sc}}(\\omega)$。将您的最终答案表示为一个行矩阵，顺序为 Prewitt、Sobel、Scharr。结果是无量纲的。将您的答案四舍五入到四位有效数字。在整个计算过程中，角度必须以弧度处理。",
            "solution": "该问题被评估为有效，因为它科学地基于数字信号处理原理，问题提出得当，目标明确，数据充分，且表述客观，没有歧义。\n\n第一步是推导每个卷积核的二维频率响应。具有有限脉冲响应（核）$h(n_x, n_y)$ 的滤波器的频率响应 $H(\\omega_x, \\omega_y)$ 是其二维离散时间傅里叶变换 (DTFT)。对于定义在整数索引 $n_x, n_y \\in \\{-1, 0, 1\\}$ 上的核，DTFT 由下式给出：\n$$\nH(\\omega_x, \\omega_y) = \\sum_{n_y=-1}^{1} \\sum_{n_x=-1}^{1} h(n_x, n_y) \\exp(-j(\\omega_x n_x + \\omega_y n_y))\n$$\n其中 $j$ 是虚数单位。梯度算子的核是可分离的。如果一个核 $h(n_x, n_y)$ 可以写成两个一维向量的乘积，$h(n_x, n_y) = v(n_y) \\cdot r(n_x)$，那么它就是可分离的。其频率响应则是这两个向量的一维 DTFT 的乘积，$H(\\omega_x, \\omega_y) = V(\\omega_y) R(\\omega_x)$。\n\n水平导数核 $G_x^{\\mathrm{O}}$ 都是可分离的，形式为 $v_{\\mathrm{O}}(n_y) \\cdot r(n_x)$，其中 $r(n_x) = [-1, 0, 1]$。$r(n_x)$ 的 DTFT 是：\n$$\nR(\\omega_x) = \\sum_{n_x=-1}^{1} r(n_x) \\exp(-j \\omega_x n_x) = (-1)\\exp(j\\omega_x) + (1)\\exp(-j\\omega_x) = -2j\\sin(\\omega_x)\n$$\n垂直向量分量 $v(n_y)$ 的 DTFT 由下式给出：\n$$\nV(\\omega_y) = \\sum_{n_y=-1}^{1} v(n_y) \\exp(-j \\omega_y n_y) = v(-1)\\exp(j\\omega_y) + v(0)\\exp(0) + v(1)\\exp(-j\\omega_y)\n$$\n由于对于所有三个算子都有 $v(-1)=v(1)$，这可以简化为 $V(\\omega_y) = v(0) + 2v(1)\\cos(\\omega_y)$。\n\n**1. 频率响应**\n\n**Prewitt 算子 (P):**\n$G_x^{\\mathrm{P}}$ 的垂直向量是 $v_{\\mathrm{P}} = [1, 1, 1]^{\\top}$。\n$V_{\\mathrm{P}}(\\omega_y) = 1 + 2(1)\\cos(\\omega_y) = 1 + 2\\cos(\\omega_y)$。\n$H_x^{\\mathrm{P}}(\\omega_x, \\omega_y) = R(\\omega_x) V_{\\mathrm{P}}(\\omega_y) = -2j\\sin(\\omega_x)(1 + 2\\cos(\\omega_y))$。\n对于垂直核 $G_y^{\\mathrm{P}} = (G_x^{\\mathrm{P}})^\\top$，$n_x$ 和 $n_y$ 的角色互换。因此，频率响应可以通过交换 $\\omega_x$ 和 $\\omega_y$ 得到：\n$H_y^{\\mathrm{P}}(\\omega_x, \\omega_y) = H_x^{\\mathrm{P}}(\\omega_y, \\omega_x) = -2j\\sin(\\omega_y)(1 + 2\\cos(\\omega_x))$。\n\n**Sobel 算子 (S):**\n$G_x^{\\mathrm{S}}$ 的垂直向量是 $v_{\\mathrm{S}} = [1, 2, 1]^{\\top}$。\n$V_{\\mathrm{S}}(\\omega_y) = 2 + 2(1)\\cos(\\omega_y) = 2(1 + \\cos(\\omega_y))$。\n$H_x^{\\mathrm{S}}(\\omega_x, \\omega_y) = R(\\omega_x) V_{\\mathrm{S}}(\\omega_y) = -4j\\sin(\\omega_x)(1 + \\cos(\\omega_y))$。\n$H_y^{\\mathrm{S}}(\\omega_x, \\omega_y) = H_x^{\\mathrm{S}}(\\omega_y, \\omega_x) = -4j\\sin(\\omega_y)(1 + \\cos(\\omega_x))$。\n\n**Scharr 算子 (Sc):**\n$G_x^{\\mathrm{Sc}}$ 的垂直向量是 $v_{\\mathrm{Sc}} = [3, 10, 3]^{\\top}$。\n$V_{\\mathrm{Sc}}(\\omega_y) = 10 + 2(3)\\cos(\\omega_y) = 2(5 + 3\\cos(\\omega_y))$。\n$H_x^{\\mathrm{Sc}}(\\omega_x, \\omega_y) = R(\\omega_x) V_{\\mathrm{Sc}}(\\omega_y) = -4j\\sin(\\omega_x)(5 + 3\\cos(\\omega_y))$。\n$H_y^{\\mathrm{Sc}}(\\omega_x, \\omega_y) = H_x^{\\mathrm{Sc}}(\\omega_y, \\omega_x) = -4j\\sin(\\omega_y)(5 + 3\\cos(\\omega_x))$。\n\n推导出的频率响应都是纯虚数。对于一个表达式 $H = jC$，其中 $C$ 是实数，则 $|H|^2 = C^2$。因此，推导过程中的负号不影响幅值。\n\n**2. 梯度幅值增益**\n\n梯度幅值增益是 $G_{\\mathrm{O}}(\\theta;\\omega)=\\sqrt{|H_{x}^{\\mathrm{O}}(\\omega_x,\\omega_y)|^{2}+|H_{y}^{\\mathrm{O}}(\\omega_x,\\omega_y)|^{2}}$，其中 $\\omega_x = \\omega \\cos\\theta$ 和 $\\omega_y = \\omega \\sin\\theta$。\n\n我们需要计算在 $\\omega=\\pi/4$ 时的各向同性比 $I_{\\mathrm{O}}(\\omega)=\\frac{G_{\\mathrm{O}}(0;\\omega)}{G_{\\mathrm{O}}(\\pi/4;\\omega)}$。\n\n**分子项：$G_{\\mathrm{O}}(0; \\omega)$**\n对于 $\\theta=0$，我们有 $\\omega_x = \\omega$ 和 $\\omega_y = 0$。\n由于 $\\sin(0)=0$，所有 $H_y^{\\mathrm{O}}(\\omega, 0)$ 项都为 $0$。增益简化为：\n$G_{\\mathrm{O}}(0;\\omega) = |H_x^{\\mathrm{O}}(\\omega, 0)|$。\n我们使用 $\\cos(0)=1$。\n在 $\\omega=\\pi/4$ 时：\n$G_{\\mathrm{P}}(0;\\pi/4) = | -2j\\sin(\\pi/4)(1+2\\cos(0)) | = 2(\\frac{\\sqrt{2}}{2})(1+2) = 3\\sqrt{2}$。\n$G_{\\mathrm{S}}(0;\\pi/4) = | -4j\\sin(\\pi/4)(1+\\cos(0)) | = 4(\\frac{\\sqrt{2}}{2})(1+1) = 4\\sqrt{2}$。\n$G_{\\mathrm{Sc}}(0;\\pi/4) = | -4j\\sin(\\pi/4)(5+3\\cos(0)) | = 4(\\frac{\\sqrt{2}}{2})(5+3) = 16\\sqrt{2}$。\n\n**分母项：$G_{\\mathrm{O}}(\\pi/4; \\omega)$**\n对于 $\\theta=\\pi/4$，我们有 $\\omega_x = \\omega_y = \\omega\\cos(\\pi/4) = \\omega\\frac{\\sqrt{2}}{2}$。\n令 $\\omega_d = \\omega \\frac{\\sqrt{2}}{2}$。在 $\\omega=\\pi/4$ 时，此值为 $\\omega_d = \\frac{\\pi}{4}\\frac{\\sqrt{2}}{2} = \\frac{\\pi\\sqrt{2}}{8}$。\n根据对称性，$H_x^{\\mathrm{O}}(\\omega_d, \\omega_d) = H_y^{\\mathrm{O}}(\\omega_d, \\omega_d)$。增益为：\n$G_{\\mathrm{O}}(\\pi/4;\\omega) = \\sqrt{|H_x^{\\mathrm{O}}(\\omega_d,\\omega_d)|^2 + |H_y^{\\mathrm{O}}(\\omega_d,\\omega_d)|^2} = \\sqrt{2}|H_x^{\\mathrm{O}}(\\omega_d, \\omega_d)|$。\n\n对于 $\\omega_d = \\frac{\\pi\\sqrt{2}}{8}$:\n$|H_x^{\\mathrm{P}}(\\omega_d, \\omega_d)| = | -2j\\sin(\\omega_d)(1+2\\cos(\\omega_d)) | = 2\\sin(\\omega_d)(1+2\\cos(\\omega_d))$。\n$G_{\\mathrm{P}}(\\pi/4;\\pi/4) = \\sqrt{2} \\cdot 2\\sin(\\frac{\\pi\\sqrt{2}}{8})(1+2\\cos(\\frac{\\pi\\sqrt{2}}{8})) = 2\\sqrt{2}\\sin(\\frac{\\pi\\sqrt{2}}{8})(1+2\\cos(\\frac{\\pi\\sqrt{2}}{8}))$。\n\n$|H_x^{\\mathrm{S}}(\\omega_d, \\omega_d)| = | -4j\\sin(\\omega_d)(1+\\cos(\\omega_d)) | = 4\\sin(\\omega_d)(1+\\cos(\\omega_d))$。\n$G_{\\mathrm{S}}(\\pi/4;\\pi/4) = \\sqrt{2} \\cdot 4\\sin(\\frac{\\pi\\sqrt{2}}{8})(1+\\cos(\\frac{\\pi\\sqrt{2}}{8})) = 4\\sqrt{2}\\sin(\\frac{\\pi\\sqrt{2}}{8})(1+\\cos(\\frac{\\pi\\sqrt{2}}{8}))$。\n\n$|H_x^{\\mathrm{Sc}}(\\omega_d, \\omega_d)| = | -4j\\sin(\\omega_d)(5+3\\cos(\\omega_d)) | = 4\\sin(\\omega_d)(5+3\\cos(\\omega_d))$。\n$G_{\\mathrm{Sc}}(\\pi/4;\\pi/4) = \\sqrt{2} \\cdot 4\\sin(\\frac{\\pi\\sqrt{2}}{8})(5+3\\cos(\\frac{\\pi\\sqrt{2}}{8})) = 4\\sqrt{2}\\sin(\\frac{\\pi\\sqrt{2}}{8})(5+3\\cos(\\frac{\\pi\\sqrt{2}}{8}))$。\n\n**3. 各向同性比**\n\n现在我们计算比率 $I_{\\mathrm{O}}(\\pi/4)$。\n\n$I_{\\mathrm{P}}(\\pi/4) = \\frac{G_{\\mathrm{P}}(0;\\pi/4)}{G_{\\mathrm{P}}(\\pi/4;\\pi/4)} = \\frac{3\\sqrt{2}}{2\\sqrt{2}\\sin(\\frac{\\pi\\sqrt{2}}{8})(1+2\\cos(\\frac{\\pi\\sqrt{2}}{8}))} = \\frac{3}{2\\sin(\\frac{\\pi\\sqrt{2}}{8})(1+2\\cos(\\frac{\\pi\\sqrt{2}}{8}))}$。\n\n$I_{\\mathrm{S}}(\\pi/4) = \\frac{G_{\\mathrm{S}}(0;\\pi/4)}{G_{\\mathrm{S}}(\\pi/4;\\pi/4)} = \\frac{4\\sqrt{2}}{4\\sqrt{2}\\sin(\\frac{\\pi\\sqrt{2}}{8})(1+\\cos(\\frac{\\pi\\sqrt{2}}{8}))} = \\frac{1}{\\sin(\\frac{\\pi\\sqrt{2}}{8})(1+\\cos(\\frac{\\pi\\sqrt{2}}{8}))}$。\n\n$I_{\\mathrm{Sc}}(\\pi/4) = \\frac{G_{\\mathrm{Sc}}(0;\\pi/4)}{G_{\\mathrm{Sc}}(\\pi/4;\\pi/4)} = \\frac{16\\sqrt{2}}{4\\sqrt{2}\\sin(\\frac{\\pi\\sqrt{2}}{8})(5+3\\cos(\\frac{\\pi\\sqrt{2}}{8}))} = \\frac{4}{\\sin(\\frac{\\pi\\sqrt{2}}{8})(5+3\\cos(\\frac{\\pi\\sqrt{2}}{8}))}$。\n\n**数值计算：**\n令 $x = \\frac{\\pi\\sqrt{2}}{8}$。角度以弧度为单位。\n$x \\approx 0.55536037$ rad。\n$\\sin(x) \\approx 0.52731423$。\n$\\cos(x) \\approx 0.84956335$。\n\n$I_{\\mathrm{P}}(\\pi/4) = \\frac{3}{2(0.52731423)(1+2(0.84956335))} = \\frac{3}{1.05462846(1+1.6991267)} = \\frac{3}{1.05462846(2.6991267)} \\approx \\frac{3}{2.846618} \\approx 1.05388$。\n四舍五入到四位有效数字得到 $1.054$。\n\n$I_{\\mathrm{S}}(\\pi/4) = \\frac{1}{0.52731423(1+0.84956335)} = \\frac{1}{0.52731423(1.84956335)} \\approx \\frac{1}{0.975806} \\approx 1.02479$。\n四舍五入到四位有效数字得到 $1.025$。\n\n$I_{\\mathrm{Sc}}(\\pi/4) = \\frac{4}{0.52731423(5+3(0.84956335))} = \\frac{4}{0.52731423(5+2.54869005)} = \\frac{4}{0.52731423(7.54869005)} \\approx \\frac{4}{3.979920} \\approx 1.005045$。\n四舍五入到四位有效数字得到 $1.005$。\n\n最终答案是这三个值分别对应 Prewitt、Sobel 和 Scharr 的行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.054  1.025  1.005\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在识别出图像边缘后，下一步便是利用这些信息来勾画出完整的对象轮廓。像活动轮廓（“蛇模型”）这样的方法在很大程度上依赖于一个连续且清晰的边缘图。这个思想实验  将探讨一个关键的失效场景——当目标边界上存在缺口时，纯粹基于边缘的方法会如何表现，从而揭示其固有的局限性，并引出如图割（Graph Cut）这类能够平衡边缘和区域信息并进行全局优化的强大方法。",
            "id": "4560358",
            "problem": "一个二维放射切片包含一个半径为 $R$ 的近似圆形的病变，该病变位于视野中心。病变的平均强度为 $\\mu_{\\text{in}}$，周围组织的平均强度为 $\\mu_{\\text{out}}$，并且强度受到标准差为 $\\sigma$ 的加性、独立、同分布的高斯噪声的干扰。基于边缘的方法所使用的图像梯度是在尺度 $\\ell$ 下对高斯平滑后图像的梯度幅值，因此边缘图为 $g(\\mathbf{x}) = \\left\\lVert \\nabla \\left(G_{\\ell} * I\\right)(\\mathbf{x}) \\right\\rVert$。在病变边界的大部分区域，期望的梯度幅值为 $g_{0}$，但在一个角度为 $\\theta_{g}$（弧长 $L_{g} = R \\theta_{g}$）的弧段上，存在一个局部对比度间断，将梯度抑制为 $g(\\mathbf{x}) \\approx \\varepsilon$，其中 $\\varepsilon \\ll g_{0}$。\n\n考虑两种分割方法：\n\n$1.$ 基于边缘的主动轮廓（“蛇形模型”），其能量为\n$$\nE_{\\text{snake}}[v] = \\int_{0}^{1} \\left( \\alpha \\left\\lVert \\frac{d v}{d s} \\right\\rVert^{2} + \\beta \\left\\lVert \\frac{d^{2} v}{d s^{2}} \\right\\rVert^{2} - \\gamma \\, g\\!\\left(v(s)\\right) \\right) \\, ds,\n$$\n其中 $v(s)$ 对闭合曲线进行参数化，$\\alpha$ 是弹性（一阶平滑度）权重，$\\beta$ 是刚性（二阶平滑度）权重，$\\gamma$ 用于缩放对边缘的吸引力。\n\n$2.$ 最小化能量的二值图割分割\n$$\nE(L) = \\sum_{p} D_{p}(L_{p}) + \\lambda \\sum_{(p,q) \\in \\mathcal{N}} w_{pq} \\, [ L_{p} \\neq L_{q} ],\n$$\n其中 $L_{p} \\in \\{0,1\\}$ 是对象与背景的标签，$D_{p}(\\cdot)$ 是基于高斯模型（均值为 $\\mu_{\\text{in}}$ 和 $\\mu_{\\text{out}}$，方差为 $\\sigma^{2}$）的负对数似然的数据惩罚项，$\\lambda$ 是 Potts 模型的平滑度权重，$w_{pq}$ 是相邻像素之间的非负边缘权重，$[ \\cdot ]$ 是标签不一致的指示函数。假设沿着间断段，相邻像素的权重近似为常数 $w_{pq} \\approx w$，并且弥合该间断需要将大约 $n$ 个类背景像素标记为对象。\n\n仅使用上述定义，从第一性原理出发，推断在何种参数范围内，基于边缘的蛇形模型会穿过边界间断而泄漏，而图割分割仍然能填充该间断并返回正确的对象。哪个选项最能描述这些范围？\n\nA. 在弧长为 $L_{g}$ 的弧段上存在一个 $g \\approx \\varepsilon \\approx 0$ 的间断时，任何正的弹性权重 $\\alpha > 0$ 都会使得穿过间断对于基于边缘的蛇形模型在能量上更有利（因为它减少了与长度相关的内部能量），因此除非 $\\alpha \\approx 0$ 或添加了基于区域的项，否则会发生泄漏。对于图割，如果将一个类背景像素标记为对象的每像素惩罚是 $\\delta = \\frac{(\\mu_{\\text{in}} - \\mu_{\\text{out}})^{2}}{2 \\sigma^{2}}$，那么只要 $\\lambda w \\ge \\delta$，间断就会被填充，因为平滑度增益抵消了数据成本。\n\nB. 大的弹性权重 $\\alpha$ 会将蛇形模型钉在缺失的边缘上并防止泄漏，而图割仅在 $\\lambda w \\le \\frac{(\\mu_{\\text{in}} - \\mu_{\\text{out}})^{2}}{2 \\sigma^{2}}$ 时才会填充间断，以确保平滑度不会主导数据。\n\nC. 只要边界的其他部分 $g_{0} > 0$，基于边缘的蛇形模型就能成功跨越任何间断，这与 $\\alpha$ 无关，而图割需要 $\\lambda \\to 0$ 以避免倾向于闭合间断的偏差。\n\nD. 基于边缘的蛇形模型通过最小化 $\\gamma$ 来避免泄漏，这样曲线就不会被边缘吸引，而图割在没有额外的超像素预处理的情况下无法弥合间断，因为离散标签无法表示跨越缺失边界的连续性。",
            "solution": "### 问题验证\n\n**第1步：提取已知信息**\n\n- **图像模型**: 一个二维放射切片。\n- **对象模型**: 一个半径为 $R$ 的近似圆形的病变，位于中心。\n- **强度模型**:\n    - 病变平均强度: $\\mu_{\\text{in}}$。\n    - 周围组织平均强度: $\\mu_{\\text{out}}$。\n    - 噪声: 标准差为 $\\sigma$ 的加性、独立、同分布的高斯噪声。\n- **边缘定义**: 边缘图 $g(\\mathbf{x}) = \\left\\lVert \\nabla \\left(G_{\\ell} * I\\right)(\\mathbf{x}) \\right\\rVert$，其中 $G_{\\ell}$ 是一个尺度为 $\\ell$ 的高斯平滑核。\n- **边界间断**:\n    - 边界大部分区域的期望梯度幅值: $g_0$。\n    - 在一个角度为 $\\theta_g$（弧长 $L_g = R \\theta_g$）的弧段上存在一个间断。\n    - 在间断处，梯度被抑制: $g(\\mathbf{x}) \\approx \\varepsilon$，其中 $\\varepsilon \\ll g_0$。\n- **方法1：基于边缘的主动轮廓（“蛇形模型”）**\n    - 能量泛函: $E_{\\text{snake}}[v] = \\int_{0}^{1} \\left( \\alpha \\left\\lVert \\frac{d v}{d s} \\right\\rVert^{2} + \\beta \\left\\lVert \\frac{d^{2} v}{d s^{2}} \\right\\rVert^{2} - \\gamma \\, g\\!\\left(v(s)\\right) \\right) \\, ds$。\n    - $v(s)$ 是参数化的闭合曲线。\n    - $\\alpha$: 弹性权重（一阶平滑度）。\n    - $\\beta$: 刚性权重（二阶平滑度）。\n    - $\\gamma$: 边缘吸引力权重。\n- **方法2：二值图割分割**\n    - 能量泛函: $E(L) = \\sum_{p} D_{p}(L_{p}) + \\lambda \\sum_{(p,q) \\in \\mathcal{N}} w_{pq} \\, [ L_{p} \\neq L_{q} ]$。\n    - $L_p \\in \\{0,1\\}$: 对象（1）与背景（0）的标签。\n    - $D_p(\\cdot)$: 基于高斯模型（均值为 $\\mu_{\\text{in}}$、$\\mu_{\\text{out}}$，方差为 $\\sigma^2$）的负对数似然的数据惩罚项。\n    - $\\lambda$: Potts 模型的平滑度权重。\n    - $w_{pq}$: 相邻像素 $(p,q) \\in \\mathcal{N}$ 之间的非负边缘权重。\n    - 在间断处，相邻像素的权重近似为常数: $w_{pq} \\approx w$。\n    - 弥合间断需要将大约 $n$ 个类背景像素标记为对象。\n\n**第2步：使用提取的已知信息进行验证**\n\n- **科学依据**: 该问题使用了图像形成（带高斯噪声的分段常数）、边缘检测（平滑图像的梯度）、主动轮廓（Kass-Witkin-Terzopoulos 模型）和图割分割（带高斯似然的 Potts 模型）的标准、成熟模型。这些是计算机视觉和医学图像分析中的基本概念。边界间断的情景是一个现实且重要的问题。\n- **适定性**: 问题要求找出在何种参数范围内一种方法失败而另一种方法成功。这是一个关于这两种能量最小化技术在特定条件下行为的明确定义的问题。\n- **客观性**: 问题使用精确的数学和技术语言陈述。所有术语都在该领域的标准词汇中定义。没有主观或模棱两可的陈述。\n\n**第3步：结论与行动**\n\n问题陈述在科学上是合理的、适定的和客观的。这是一个有效的问题，需要对两种标准的分割算法进行分析。\n\n### 推导与求解\n\n目标是确定在何种条件下，尽管存在边界间断，基于边缘的蛇形模型会失败（泄漏），而图割分割能成功地正确描绘病变。\n\n**1. 基于边缘的主动轮廓（蛇形模型）分析**\n\n蛇形模型最小化以下能量：\n$$\nE_{\\text{snake}}[v] = \\int_{0}^{1} \\left( \\alpha \\left\\lVert \\frac{d v}{d s} \\right\\rVert^{2} + \\beta \\left\\lVert \\frac{d^{2} v}{d s^{2}} \\right\\rVert^{2} - \\gamma \\, g\\!\\left(v(s)\\right) \\right) \\, ds\n$$\n该能量由两个主要部分组成：\n- **内部能量**: $E_{\\text{int}}[v] = \\int_{0}^{1} \\left( \\alpha \\left\\lVert \\frac{d v}{d s} \\right\\rVert^{2} + \\beta \\left\\lVert \\frac{d^{2} v}{d s^{2}} \\right\\rVert^{2} \\right) ds$。该项控制曲线的平滑度。如果我们假设弧长参数化，那么 $\\lVert \\frac{dv}{ds} \\rVert = 1$，第一项简化为 $\\int \\alpha ds = \\alpha L$，其中 $L$ 是曲线的长度。第二项涉及二阶导数（曲率），惩罚弯曲。这两项都倾向于更短、更平滑（更直）的曲线。\n- **外部能量**: $E_{\\text{ext}}[v] = -\\gamma \\int_{0}^{1} g(v(s)) ds$。该项将曲线吸引到高梯度幅值（边缘）的区域。最小化 $E_{\\text{snake}}$ 涉及到最大化沿曲线的积分梯度。\n\n考虑长度为 $L_g = R\\theta_g$ 的边界间断。沿着这个弧段，梯度可以忽略不计，$g(\\mathbf{x}) \\approx \\varepsilon \\approx 0$。因此，外部能量在该区域没有提供将蛇形模型保持在真实边界上的力。跨越间断的蛇形模型段的行为由内部能量 $E_{\\text{int}}$ 主导。\n\n为了最小化内部能量，蛇形模型将试图找到连接间断两个端点的最小长度和最小曲率的路径。穿过间断的直线（弦）比真实边界的圆弧更短且曲率更低。\n- 弧的长度是 $L_g = R\\theta_g$。\n- 弦的长度是 $L_{\\text{chord}} = 2R \\sin(\\theta_g/2)$。对于任何 $\\theta_g \\in (0, 2\\pi)$，$L_{\\text{chord}}  L_g$。\n\n由于弦更短更直，与沿着弧线相比，它代表了更低的内部能量配置。对于任何正的弹性 ($\\alpha  0$) 或刚性 ($\\beta  0$)，蛇形模型都会从真实的圆形边界被拉向更短、更直的弦。这种现象被称为穿过边界间断的“泄漏”或“抄近路”。当面对缺失的边缘信息时，泄漏是纯粹基于边缘的主动轮廓的固有属性，除非内部能量被有效禁用（即 $\\alpha, \\beta \\to 0$，但这会破坏蛇形模型的一致性）或添加了基于区域的能量项，否则就会发生泄漏。\n\n**2. 图割分割分析**\n\n图割最小化以下能量：\n$$\nE(L) = \\sum_{p} D_{p}(L_{p}) + \\lambda \\sum_{(p,q) \\in \\mathcal{N}} w_{pq} \\, [ L_{p} \\neq L_{q} ]\n$$\n- **数据项 $D_p(L_p)$**: 此项是为像素 $p$ 分配标签 $L_p$ 的惩罚。它是负对数似然。对于强度为 $I_p$ 的像素 $p$，惩罚项为：\n  - 对象标签的惩罚: $D_p(1) = \\frac{(I_p - \\mu_{\\text{in}})^2}{2\\sigma^2} + C$。\n  - 背景标签的惩罚: $D_p(0) = \\frac{(I_p - \\mu_{\\text{out}})^2}{2\\sigma^2} + C$。\n问题陈述，弥合间断需要将 $n$ 个“类背景”像素标记为对象。这意味着对于这些像素，$I_p \\approx \\mu_{\\text{out}}$。将这样一个像素标记为对象（$L_p=1$）而不是背景（$L_p=0$）的数据成本惩罚是：\n$$\n\\delta = D_p(1) - D_p(0) \\approx \\frac{(\\mu_{\\text{out}} - \\mu_{\\text{in}})^2}{2\\sigma^2} - \\frac{(\\mu_{\\text{out}} - \\mu_{\\text{out}})^2}{2\\sigma^2} = \\frac{(\\mu_{\\text{in}} - \\mu_{\\text{out}})^2}{2\\sigma^2}\n$$\n- **平滑项**: $\\lambda \\sum w_{pq} [L_p \\neq L_q]$ 惩罚具有不同标签的相邻像素。它定义了边界的“成本”。整体最小化旨在拟合数据与创建“廉价”（通常是短而平滑）边界之间寻求平衡。\n\n在间断区域，$n$ 个像素的数据项倾向于背景标签，产生一种将边界向内移动而不是分割整个病变的力量。为了“填充间断”，算法必须将这些像素标记为对象，从而产生大约 $n\\delta$ 的总数据惩罚。\n这个数据惩罚被平滑项所抵消。如果这 $n$ 个像素被标记为背景，病变内部就会产生一个新的边界段。如果它们被标记为对象，这个内部边界就会被移除。图割算法执行全局优化，但其行为可以从局部来理解。\n\n考虑真实病变内部的一个类背景像素 $p$，它被将要标记为对象的像素所包围。算法必须决定 $p$ 的标签。\n- 如果 $L_p=0$（背景）：数据项的贡献很低，但在 $p$ 与其标记为对象的邻居之间会产生边界成本，等于 $\\lambda \\sum_{q \\in \\mathcal{N}(p)} w_{pq}$。\n- 如果 $L_p=1$（对象）：数据项的贡献很高（惩罚为 $\\delta$），但与其标记为对象的邻居之间没有边界成本。\n\n如果数据惩罚小于孤立该像素的平滑度惩罚，算法将选择将像素 $p$ 标记为对象（填充间断）：\n$$\n\\delta  \\lambda \\sum_{q \\in \\mathcal{N}(p), L_q=1} w_{pq}\n$$\n问题通过陈述相邻像素权重为 $w_{pq} \\approx w$ 来简化这一点。虽然一个像素有多个邻居，但该条件可以从概念上针对单位边界来表达。平滑项要覆盖不正确的数据项的条件是，加权平滑系数 $\\lambda w$ 必须大于数据惩罚 $\\delta$。因此，如果 $\\lambda w \\gtrsim \\delta$，间断就会被填充。大的 $\\lambda$ 或大的相邻像素权重 $w$（这在许多图割方案的低梯度区域中是典型的）使得分割对局部数据损坏具有鲁棒性，从而有效地允许分割弥合间断。\n\n### 逐项分析\n\n**A. 在弧长为 $L_{g}$ 的弧段上存在一个 $g \\approx \\varepsilon \\approx 0$ 的间断时，任何正的弹性权重 $\\alpha  0$ 都会使得穿过间断对于基于边缘的蛇形模型在能量上更有利（因为它减少了与长度相关的内部能量），因此除非 $\\alpha \\approx 0$ 或添加了基于区域的项，否则会发生泄漏。对于图割，如果将一个类背景像素标记为对象的每像素惩罚是 $\\delta = \\frac{(\\mu_{\\text{in}} - \\mu_{\\text{out}})^{2}}{2 \\sigma^{2}}$，那么只要 $\\lambda w \\ge \\delta$，间断就会被填充，因为平滑度增益抵消了数据成本。**\n- **蛇形模型分析**: 这正确地指出了在没有边缘数据的情况下，$\\alpha$ 项的长度最小化特性会导致泄漏。**正确**。\n- **图割分析**: 这正确地定义了数据惩罚 $\\delta$，并陈述了平滑项克服误导性数据项以填充间断的正确条件（$\\lambda w \\ge \\delta$）。**正确**。\n- **结论**: **正确**。\n\n**B. 大的弹性权重 $\\alpha$ 会将蛇形模型钉在缺失的边缘上并防止泄漏，而图割仅在 $\\lambda w \\le \\frac{(\\mu_{\\text{in}} - \\mu_{\\text{out}})^{2}}{2 \\sigma^{2}}$ 时才会填充间断，以确保平滑度不会主导数据。**\n- **蛇形模型分析**: 这与真实行为相反。大的 $\\alpha$ 通过更强烈地偏好更短的路径来促进泄漏。**不正确**。\n- **图割分析**: 这陈述了所需条件的相反情况。为了填充间断，平滑度*必须*主导误导性的局部数据，因此我们需要 $\\lambda w \\ge \\delta$。**不正确**。\n- **结论**: **不正确**。\n\n**C. 只要边界的其他部分 $g_{0}  0$，基于边缘的蛇形模型就能成功跨越任何间断，这与 $\\alpha$ 无关，而图割需要 $\\lambda \\to 0$ 以避免倾向于闭合间断的偏差。**\n- **蛇形模型分析**: 在间断处的行为是一个局部属性。其他地方的强边缘不能防止通过间断的泄漏。其行为严重依赖于 $\\alpha$ 和 $\\beta$。**不正确**。\n- **图割分析**: 设置 $\\lambda \\to 0$ 会消除平滑项，导致逐像素分类。这将对噪声极为敏感，并且无法弥合任何间断。**不正确**。\n- **结论**: **不正确**。\n\n**D. 基于边缘的蛇形模型通过最小化 $\\gamma$ 来避免泄漏，这样曲线就不会被边缘吸引，而图割在没有额外的超像素预处理的情况下无法弥合间断，因为离散标签无法表示跨越缺失边界的连续性。**\n- **蛇形模型分析**: 最小化 $\\gamma$ 会使蛇形模型忽略所有边缘，无论是强的还是弱的。曲线将完全找不到对象边界。这不是一个解决方案。**不正确**。\n- **图割分析**: 关于图割无法弥合间断的说法是根本错误的。能量泛函中的平滑项正是强制空间一致性并允许弥合具有弱数据或缺失数据的间断的机制。**不正确**。\n- **结论**: **不正确**。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在了解了图割方法的优越性之后，我们需要关注其在真实世界数据上的正确应用。医学图像，特别是三维扫描图像，其体素（voxel）往往是各向异性的，即切片内的像素间距与切片间的距离不相同。这项练习  将演示如何推导出正确的图连接权重，以确保分割的惩罚项能够准确地对应于一个各向同性的表面积，这是获得具有物理意义和可复现性的分割结果的关键一步。",
            "id": "4560342",
            "problem": "您正在使用图割（GC）方法，在体素间距为各向异性 $(\\Delta x,\\Delta y,\\Delta z)$ 的直角网格上，为放射组学中的体积医学影像设计一种二值分割能量。该方法采用六邻域系统。\n\n其正则化项应近似于分割对象与背景之间界面的各向同性表面积惩罚，强度参数为 $\\lambda0$。\n\n从二值特征函数 $u:\\Omega\\subset\\mathbb{R}^{3}\\to\\{0,1\\}$ 的全变分（TV）连续周长公式出发，并结合各向异性网格上的标准有限差分近似和黎曼和，推导分别分配给沿 $x$、$y$ 和 $z$ 轴的相邻体素之间边的 N-link 容量 $c_{x}$、$c_{y}$ 和 $c_{z}$ 的缩放关系，使得图割的成对 Potts 项 $\\sum_{(p,q)} w_{pq}\\,[L_{p}\\neq L_{q}]$ 能近似连续模型中的各向同性表面积惩罚。\n\n假设：\n- 六邻域拓扑（仅面相邻的邻居）。\n- 成对项为 Potts 形式，并且仅取决于相邻标签是否不同。\n- 推导从二值函数 $u$ 的 TV 周长 $\\lambda\\int_{\\Omega}|\\nabla u|\\,\\mathrm{d}V$ 开始，并对 $\\partial u/\\partial x$、$\\partial u/\\partial y$ 和 $\\partial u/\\partial z$ 使用一致的各向异性有限差分近似。\n- 最终答案必须表示为关于 $\\lambda$、$\\Delta x$、$\\Delta y$ 和 $\\Delta z$ 的三元组 $(c_{x},c_{y},c_{z})$ 的单一解析表达式。\n\n请将您的最终结果以单一行向量表达式的形式给出。不需要进行数值近似或四舍五入。",
            "solution": "用户希望推导各向异性 3D 网格上图割分割能量函数的 N-link 容量。\n\n### 步骤 1：提取已知条件\n- **任务：** 为基于图割（GC）的二值分割推导 N-link 容量 $(c_x, c_y, c_z)$ 的缩放关系。\n- **网格：** 各向异性体素间距为 $(\\Delta x, \\Delta y, \\Delta z)$ 的直角网格。\n- **邻域：** 六邻域系统（面相邻体素）。\n- **目标：** 正则化项应近似一个各向同性的表面积惩罚。\n- **连续模型：** 起点是二值特征函数 $u: \\Omega \\subset \\mathbb{R}^3 \\to \\{0, 1\\}$ 的全变分（TV）周长正则化，由 $E_{reg} = \\lambda \\int_{\\Omega} |\\nabla u| \\, \\mathrm{d}V$ 给出，其中 $\\lambda  0$。\n- **离散模型：** 图割能量中的成对项是一个 Potts 模型，$E_{Potts} = \\sum_{(p,q)} w_{pq} [L_p \\neq L_q]$，其中 $[L_p \\neq L_q]$ 是一个指示函数，当体素 $p$ 和 $q$ 的标签不同时为 $1$，否则为 $0$。权重 $w_{pq}$ 是 N-link 容量 $c_x, c_y, c_z$。\n- **方法：** 使用有限差分近似和黎曼和来连接连续模型和离散模型。\n- **输出：** 一个关于 $\\lambda, \\Delta x, \\Delta y, \\Delta z$ 的 $(c_x, c_y, c_z)$ 的单一行向量表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，提法恰当且客观。它解决的是医学图像分析中一个基本而实际的问题：如何在各向异性网格上设置离散正则化模型的参数，以近似一个连续的、各向同性的物理属性（表面张力）。连续全变分与离散图割能量之间的联系是现代图像分割的基石。所提供的信息是完整、一致且足以进行严谨推导的。该问题并非微不足道，需要清晰地理解能量泛函的连续和离散公式之间的关系。未检测到任何缺陷。\n\n### 步骤 3：结论与行动\n问题是**有效的**。开始进行求解。\n\n问题在于为各向异性网格上的离散成对 Potts 模型找到合适的 N-link 容量 $(c_x, c_y, c_z)$，使其能近似一个连续的各向同性表面积惩罚。\n\n连续正则化能量惩罚的是分割对象 $S$ 的边界 $\\partial S$ 的表面积，由对象特征函数 $u(\\mathbf{x})$ 的全变分（TV）给出。对于一个二值函数 $u \\in \\{0, 1\\}$，其表达式为：\n$$ E_{cont} = \\lambda \\int_{\\Omega} |\\nabla u| \\, \\mathrm{d}V = \\lambda \\times (S \\text{的表面积}) $$\n其中 $\\lambda  0$ 是强度参数。在笛卡尔坐标系中，梯度的模为 $|\\nabla u| = \\sqrt{(\\frac{\\partial u}{\\partial x})^2 + (\\frac{\\partial u}{\\partial y})^2 + (\\frac{\\partial u}{\\partial z})^2}$。因此，能量泛函为：\n$$ E_{cont} = \\lambda \\int_{\\Omega} \\sqrt{\\left(\\frac{\\partial u}{\\partial x}\\right)^2 + \\left(\\frac{\\partial u}{\\partial y}\\right)^2 + \\left(\\frac{\\partial u}{\\partial z}\\right)^2} \\, \\mathrm{d}x \\, \\mathrm{d}y \\, \\mathrm{d}z $$\n术语“各向同性”意味着每单位面积的惩罚是恒定的，即 $\\lambda$，与表面方向无关。\n\n在直角网格上，六邻域 Potts 模型的离散能量泛函由所有具有不同标签的相邻体素对的惩罚之和给出。设 $u_p$ 是由索引 $p=(i, j, k)$ 标记的体素的标签（$0$ 或 $1$）。设 $p_x, p_y, p_z$ 分别是 $p$ 在正 $x, y, z$ 方向上的邻居。其能量为：\n$$ E_{discrete} = \\sum_{p} \\left( c_x [u_p \\neq u_{p_x}] + c_y [u_p \\neq u_{p_y}] + c_z [u_p \\neq u_{p_z}] \\right) $$\n由于 $u_p \\in \\{0, 1\\}$，指示函数 $[u_p \\neq u_q]$ 等价于 $|u_p - u_q|$。\n\n如果使用有限差分直接离散化 $E_{cont}$ 中的平方根项，将得到一个形如 $\\sum_p \\sqrt{...}$ 的表达式，它不是成对项的和。这样的能量泛函无法通过标准的成对图割算法进行最小化。因此，术语“近似”意味着我们必须为易于处理的离散模型（$E_{discrete}$）找到参数 $c_x, c_y, c_z$，使其能最好地对应于期望的连续模型（$E_{cont}$）。\n\n实现这种近似的标准方法是，确保与网格轴对齐的表面的能量成本在连续和离散公式中是相同的。这保证了离散模型对于最简单的表面方向能够正确地工作。\n\n让我们考虑一个面积为 $A$ 的平坦小块表面，它与一个网格平面完全对齐。\n\n情况 1：表面垂直于 $x$ 轴。\n该表面的法向量为 $\\mathbf{n} = (1, 0, 0)$。在连续模型中，这个小块表面的能量贡献就是其面积乘以各向同性惩罚 $\\lambda$：\n$$ E_{cont, x} = \\lambda A $$\n在离散模型中，该表面位于相邻体素之间的面上。这些面垂直于 $x$ 轴，每个面的面积为 $\\Delta y \\Delta z$。构成总面积 $A$ 的这类面的数量为 $N_x = A / (\\Delta y \\Delta z)$。\n离散能量是每个被切割的边的惩罚之和。对于此表面方向，只有沿 $x$ 轴的边被切割。每个被切割的 $x$ 边的惩罚是 $c_x$。总的离散能量为：\n$$ E_{discrete, x} = N_x \\times c_x = \\left(\\frac{A}{\\Delta y \\Delta z}\\right) c_x $$\n为确保对于该方向的近似是准确的，我们令连续能量和离散能量相等：\n$$ \\lambda A = \\frac{A c_x}{\\Delta y \\Delta z} $$\n$$ c_x = \\lambda \\Delta y \\Delta z $$\n\n情况 2：表面垂直于 $y$ 轴。\n法向量为 $\\mathbf{n} = (0, 1, 0)$。连续能量为 $E_{cont, y} = \\lambda A$。\n每个离散面的面积为 $\\Delta x \\Delta z$。面的数量为 $N_y = A / (\\Delta x \\Delta z)$。只有 $y$ 边被切割，每个边的惩罚为 $c_y$。离散能量为：\n$$ E_{discrete, y} = N_y \\times c_y = \\left(\\frac{A}{\\Delta x \\Delta z}\\right) c_y $$\n令能量相等：\n$$ \\lambda A = \\frac{A c_y}{\\Delta x \\Delta z} $$\n$$ c_y = \\lambda \\Delta x \\Delta z $$\n\n情况 3：表面垂直于 $z$ 轴。\n法向量为 $\\mathbf{n} = (0, 0, 1)$。连续能量为 $E_{cont, z} = \\lambda A$。\n每个离散面的面积为 $\\Delta x \\Delta y$。面的数量为 $N_z = A / (\\Delta x \\Delta y)$。只有 $z$ 边被切割，每个边的惩罚为 $c_z$。离散能量为：\n$$ E_{discrete, z} = N_z \\times c_z = \\left(\\frac{A}{\\Delta x \\Delta y}\\right) c_z $$\n令能量相等：\n$$ \\lambda A = \\frac{A c_z}{\\Delta x \\Delta y} $$\n$$ c_z = \\lambda \\Delta x \\Delta y $$\n\n这些结果为 N-link 容量提供了缩放关系，确保离散 Potts 模型能根据各向同性连续模型正确地惩罚与坐标轴对齐的表面。一条边的容量是 $\\lambda$ 乘以分隔由该边连接的两个体素的对偶面的面积。\n\n结合这些结果，容量三元组为 $(c_x, c_y, c_z)$。表示为单一行向量，即为：\n$$ (c_x, c_y, c_z) = (\\lambda \\Delta y \\Delta z, \\lambda \\Delta x \\Delta z, \\lambda \\Delta x \\Delta y) $$\n这也可以写成 $\\lambda \\Delta x \\Delta y \\Delta z (1/\\Delta x, 1/\\Delta y, 1/\\Delta z)$，这表明边的容量与沿该边方向的体素维度成反比，并按体素体积和正则化强度进行缩放。所要求的形式是该三元组的直接表达式。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\lambda \\Delta y \\Delta z  \\lambda \\Delta x \\Delta z  \\lambda \\Delta x \\Delta y \\end{pmatrix}}$$"
        }
    ]
}