{
    "hands_on_practices": [
        {
            "introduction": "第一个练习旨在巩固局部二值模式（LBP）算子的基本机理。通过手动为一个小的图像块计算LBP编码及其旋转不变均匀（RIU）变体，您将具体理解局部强度比较是如何被编码成一个强大的纹理描述符的。",
            "id": "4612936",
            "problem": "在放射组学驱动的磁共振成像 (MRI) 纹理分析中，局部二值模式 (LBP) 提供了一种局部微观结构的紧凑表示，该表示对单调灰度变换具有鲁棒性。考虑从 T$_2$ 加权 MRI 切片中提取的单通道灰度 $3\\times 3$ 图像块。设中心强度为 $g_c = 10$，在半径 $R=1$ 的圆上按顺时针顺序采样的 $8$ 个邻域像素，从角度为 $0$（正 $x$ 轴，“东方”）的邻域像素开始，其序列为 $[12, 9, 11, 8, 10, 13, 7, 10]$。使用具有 $P=8$ 个邻域像素和半径 $R=1$ 的标准局部二值模式 (LBP) 算子，将每个邻域像素强度 $g_p$ 的阈值指示符定义为 $s(g_p - g_c)$，其中当 $t \\ge 0$ 时 $s(t)$ 等于 $1$，否则等于 $0$。按照给定的顺时针顺序形成圆形二值模式，并将此模式解释为一个以 2 为基数的整数，其中第一个邻域像素（角度为 $0$）被分配为最低有效位，且位权重按顺时针方向增加。然后，根据规范规则确定旋转不变均匀标签：如果圆形二值模式在 $0$ 和 $1$ 之间表现出最多两次跳变，则标签等于模式中 $1$ 的数量；否则，标签等于 $P+1$。计算得到的 $LBP_{8,1}$ 编码及其旋转不变均匀标签。报告这两个值，不带单位。最终答案必须是计算结果，并表示为单行矩阵。无需四舍五入。",
            "solution": "该问题要求计算给定 $3\\times3$ 图像块的局部二值模式 ($LBP$) 编码和相应的旋转不变均匀标签。\n\n首先对问题陈述进行验证。\n\n**步骤 1：提取已知信息**\n- 图像块是一个 $3 \\times 3$ 的单通道灰度区域。\n- 中心像素强度为 $g_c = 10$。\n- 在半径 $R=1$ 的圆上有 $P=8$ 个邻域像素。\n- 从东方（$0$ 度）开始并按顺时针方向进行的 $P=8$ 个邻域像素强度的序列为 $[12, 9, 11, 8, 10, 13, 7, 10]$。我们用 $\\{g_p\\}_{p=0}^{7}$ 表示这个序列，因此 $g_0=12$，$g_1=9$，依此类推。\n- 阈值函数定义为 $s(t)$，其中当 $t \\ge 0$ 时 $s(t) = 1$，当 $t  0$ 时 $s(t) = 0$。\n- 二值模式由阈值化差值序列 $s(g_p - g_c)$（其中 $p=0, 1, \\dots, 7$）形成。\n- $LBP$ 编码是得到的 $8$ 位二进制数的十进制值，其中来自第一个邻域像素 ($p=0$) 的位是最低有效位 (LSB)，位权重按顺时针方向增加。\n- 旋转不变均匀标签由一个基于圆形二值模式中空间跳变（从 $0$ 到 $1$ 或从 $1$ 到 $0$ 的位翻转）数量的规则确定。令此数量为 $U(LBP)$。\n    - 如果 $U(LBP) \\le 2$，则该模式是“均匀”的，其标签是模式中“1”的数量。\n    - 如果 $U(LBP)  2$，则该模式是“非均匀”的，其标签是 $P+1$。\n\n**步骤 2：使用提取的已知信息进行验证**\n该问题具有科学依据，因为它涉及标准的局部二值模式算子，这是纹理分析和放射组学中的一项基本技术。该问题是适定的，提供了所有必要的参数、数据和明确的计算规则。语言客观、正式。问题是完整的、一致的并且计算上是可行的。没有违反科学原理、逻辑不一致或含糊不清之处。\n\n**步骤 3：结论和行动**\n问题有效。将提供完整的解答。\n\n**求解过程**\n\n首先，我们通过将每个邻域像素的强度 $g_p$ 与中心强度 $g_c=10$ 进行比较来计算二值模式。我们应用阈值函数 $s(g_p - g_c)$。\n\n邻域像素强度为 $g_0=12, g_1=9, g_2=11, g_3=8, g_4=10, g_5=13, g_6=7, g_7=10$。\n\n构成模式的各位的阈值化值计算如下：\n- 对于 $p=0$：$s(g_0 - g_c) = s(12 - 10) = s(2) = 1$。\n- 对于 $p=1$：$s(g_1 - g_c) = s(9 - 10) = s(-1) = 0$。\n- 对于 $p=2$：$s(g_2 - g_c) = s(11 - 10) = s(1) = 1$。\n- 对于 $p=3$：$s(g_3 - g_c) = s(8 - 10) = s(-2) = 0$。\n- 对于 $p=4$：$s(g_4 - g_c) = s(10 - 10) = s(0) = 1$。\n- 对于 $p=5$：$s(g_5 - g_c) = s(13 - 10) = s(3) = 1$。\n- 对于 $p=6$：$s(g_6 - g_c) = s(7 - 10) = s(-3) = 0$。\n- 对于 $p=7$：$s(g_7 - g_c) = s(10 - 10) = s(0) = 1$。\n\n对应于邻域像素 $p=0, \\dots, 7$ 的位序列是 $\\{s_p\\}_{p=0}^7 = \\{1, 0, 1, 0, 1, 1, 0, 1\\}$。\n\n接下来，我们计算 $LBP_{8,1}$ 编码。问题指定来自邻域像素 $p=0$ 的位是最低有效位 (LSB)。$LBP$ 编码的公式是：\n$$ LBP_{P,R} = \\sum_{p=0}^{P-1} s(g_p - g_c) \\cdot 2^p $$\n使用 $P=8$ 和我们计算出的位：\n$$ LBP_{8,1} = s_0 \\cdot 2^0 + s_1 \\cdot 2^1 + s_2 \\cdot 2^2 + s_3 \\cdot 2^3 + s_4 \\cdot 2^4 + s_5 \\cdot 2^5 + s_6 \\cdot 2^6 + s_7 \\cdot 2^7 $$\n从 $s_7$ 读到 $s_0$ 的二进制字符串是 $10110101_2$。\n$$ LBP_{8,1} = 1 \\cdot 2^0 + 0 \\cdot 2^1 + 1 \\cdot 2^2 + 0 \\cdot 2^3 + 1 \\cdot 2^4 + 1 \\cdot 2^5 + 0 \\cdot 2^6 + 1 \\cdot 2^7 $$\n$$ LBP_{8,1} = 1 \\cdot 1 + 0 \\cdot 2 + 1 \\cdot 4 + 0 \\cdot 8 + 1 \\cdot 16 + 1 \\cdot 32 + 0 \\cdot 64 + 1 \\cdot 128 $$\n$$ LBP_{8,1} = 1 + 4 + 16 + 32 + 128 = 181 $$\n第一个要求的值，即 $LBP_{8,1}$ 编码，是 $181$。\n\n现在，我们确定旋转不变均匀标签，记为 $LBP_{P,R}^{riu2}$。我们必须计算圆形二值模式 $(s_0, s_1, s_2, s_3, s_4, s_5, s_6, s_7)$ 中的跳变次数 $U$。\n该模式是 $(1, 0, 1, 0, 1, 1, 0, 1)$。\n跳变次数 $U$ 由下式给出：\n$$ U = |s_{P-1} - s_0| + \\sum_{p=1}^{P-1} |s_p - s_{p-1}| $$\n当 $P=8$ 时，模式为 $(s_0, s_1, s_2, s_3, s_4, s_5, s_6, s_7) = (1, 0, 1, 0, 1, 1, 0, 1)$。\n让我们按顺序计算跳变：\n- $s_0 \\to s_1$: $1 \\to 0$，跳变。(1)\n- $s_1 \\to s_2$: $0 \\to 1$，跳变。(2)\n- $s_2 \\to s_3$: $1 \\to 0$，跳变。(3)\n- $s_3 \\to s_4$: $0 \\to 1$，跳变。(4)\n- $s_4 \\to s_5$: $1 \\to 1$，无跳变。\n- $s_5 \\to s_6$: $1 \\to 0$，跳变。(5)\n- $s_6 \\to s_7$: $0 \\to 1$，跳变。(6)\n- $s_7 \\to s_0$ (圆形部分)：$1 \\to 1$，无跳变。\n总跳变次数为 $U=6$。\n\n根据均匀模式的规则，如果 $U \\le 2$，则模式是均匀的。由于 $U=6$ 大于 $2$，因此该模式是非均匀的。\n对于非均匀模式，旋转不变均匀标签定义为 $P+1$。\n给定 $P=8$，标签为 $8+1=9$。\n\n计算出的两个值是 $LBP_{8,1}$ 编码（为 $181$）及其旋转不变均匀标签（为 $9$）。最终答案应表示为单行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n181  9\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在实践中，将LBP应用于有限大小的目标区域（ROI）时，会遇到如何处理边界附近像素的问题。本练习将探讨几种常见的边界处理策略，并要求您量化它们对最终LBP直方图的影响，从而突显出看似微小的实现细节会如何显著影响最终的影像组学特征。",
            "id": "4565398",
            "problem": "在放射组学中，局部二值模式 (LBP) 用于量化感兴趣区域 (ROI) 中每个像素周围的局部纹理。考虑以下 ROI 是一个 $3 \\times 3$ 的灰度图像，其强度值为\n$$\nI = \\begin{pmatrix}\n10   10  10 \\\\\n10   20  10 \\\\\n10   10  10\n\\end{pmatrix}.\n$$\nLBP 算子在半径 $R=1$ 处有 $P=8$ 个邻域点，其定义如下：对于坐标为 $(r,c)$、中心强度为 $I_{r,c}$ 的每个像素，按固定顺序定义邻域偏移量\n$$\n(\\Delta r_k, \\Delta c_k) = \\{(-1,-1),\\, (-1,0),\\, (-1,1),\\, (0,1),\\, (1,1),\\, (1,0),\\, (1,-1),\\, (0,-1)\\}, \\quad k = 0,1,\\dots,7,\n$$\n以及相应的二值测试\n$$\nb_k(r,c) = \\begin{cases}\n1,   \\text{if } I_{r+\\Delta r_k,\\,c+\\Delta c_k} \\ge I_{r,c}, \\\\\n0,   \\text{otherwise}.\n\\end{cases}\n$$\n像素 $(r,c)$ 的 LBP 编码是一个整数\n$$\ns(r,c) = \\sum_{k=0}^{7} b_k(r,c)\\,2^{k}.\n$$\nLBP 直方图是在指定边界处理策略下，对被视为有效的 ROI 像素的编码 $s(r,c)$ 的分布，并经过归一化，使其总和为 $1$。\n\n对于靠近 ROI 边界的像素，通常使用四种边界处理策略：\n- 忽略 (Ignore)：排除任何在半径 $R$ 处的 $P$ 个邻域点不完全位于 ROI 内部的像素。\n- 镜像 (Mirror)：对于任何会落在 ROI 之外的邻域索引，通过跨越最近的 ROI 边界进行反射，将其映射回 ROI 内部。\n- 环绕 (Wrap)：对于任何会落在 ROI 之外的邻域索引，通过应用周期性（环形）边界条件，将其映射回 ROI 内部。\n- 部分采样 (Partial sampling)：对于任何会落在 ROI 之外的邻域索引，将对应的位 $b_k(r,c)$ 赋值为 $0$。\n\n仅从这些基本定义出发，首先将每种策略形式化为作用于 $(r+\\Delta r_k, c+\\Delta c_k)$ 的精确数学规则，然后推导出在每种策略下给定 ROI 的归一化 LBP 直方图。最后，通过计算从“忽略”和“镜像”策略获得的归一化 LBP 直方图之间的詹森-香农 (JS) 散度，来量化边界处理的影响。所有信息度量均使用自然对数。将最终数值答案四舍五入至四位有效数字，并以奈特 (nats) 为单位表示散度。",
            "solution": "该问题被验证为是自洽的、有科学依据且适定的。解答过程分为四个阶段：(1) 形式化四种边界处理策略，(2) 在每种策略下计算给定 $3 \\times 3$ 感兴趣区域 (ROI) 中每个像素的局部二值模式 (LBP) 编码，(3) 构建归一化 LBP 直方图，以及 (4) 计算“忽略”和“镜像”策略得到的直方图之间的詹森-香农 (JS) 散度。\n\nROI 由强度矩阵 $I$ 给出，其维度为 $N_r=3$ 行和 $N_c=3$ 列。我们使用 1-索引坐标 $(r,c)$，其中 $r,c \\in \\{1, 2, 3\\}$。\n$$\nI = \\begin{pmatrix}\n10   10  10 \\\\\n10   20  10 \\\\\n10   10  10\n\\end{pmatrix}\n$$\nLBP 算子定义为在半径 $R=1$ 处有 $P=8$ 个邻域点。对于 $k = 0, \\dots, 7$，邻域偏移量为 $(\\Delta r_k, \\Delta c_k) = \\{(-1,-1), (-1,0), (-1,1), (0,1), (1,1), (1,0), (1,-1), (0,-1)\\}$。位于 $(r,c)$ 的像素的 LBP 编码为 $s(r,c) = \\sum_{k=0}^{7} b_k(r,c) 2^k$，其中如果邻域像素的强度大于或等于中心像素的强度 $I_{r,c}$，则 $b_k(r,c)=1$，否则 $b_k(r,c)=0$。\n\n**1. 边界处理策略的形式化**\n\n对于一个中心像素 $(r,c)$，设其邻域点的原始坐标为 $(r', c') = (r+\\Delta r_k, c+\\Delta c_k)$。设 $(\\tilde{r}, \\tilde{c})$ 为用于访问强度值的映射坐标。ROI 域为 $\\mathcal{D} = \\{(i,j) \\mid 1 \\le i \\le N_r, 1 \\le j \\le N_c\\}$。\n\n-   **忽略 (Ignore)**：有效中心像素的集合被限制为那些其 $3 \\times 3$ 邻域完全位于 $\\mathcal{D}$ 内部的像素。对于此集合中的任何像素 $(r,c)$，我们有 $(\\tilde{r}, \\tilde{c}) = (r',c')$。任何不满足此条件的像素都将从直方图计算中排除。\n-   **镜像 (Mirror)**：处理 $\\mathcal{D}$ 中的所有像素。如果邻域坐标 $(r',c')$ 在 $\\mathcal{D}$ 之外，则通过跨越最近的边界进行反射，将其映射到 $(\\tilde{r},\\tilde{c})$。映射关系为：\n    $$ \\tilde{r} = \\begin{cases} r'   \\text{if } 1 \\le r' \\le N_r \\\\ 2-r'   \\text{if } r'  1 \\\\ 2N_r-r'   \\text{if } r' > N_r \\end{cases} \\quad \\text{and} \\quad \\tilde{c} = \\begin{cases} c'   \\text{if } 1 \\le c' \\le N_c \\\\ 2-c'   \\text{if } c'  1 \\\\ 2N_c-c'   \\text{if } c' > N_c \\end{cases} $$\n    对于本问题，$N_r=N_c=3$。\n-   **环绕 (Wrap)**：处理 $\\mathcal{D}$ 中的所有像素。如果 $(r',c')$ 在 $\\mathcal{D}$ 之外，则使用周期性边界条件将其映射到 $(\\tilde{r},\\tilde{c})$：\n    $$ \\tilde{r} = (r'-1 \\pmod{N_r}) + 1 \\quad \\text{and} \\quad \\tilde{c} = (c'-1 \\pmod{N_c}) + 1 $$\n    其中模运算符将其输入映射到 $\\{0, 1, \\dots, N-1\\}$。\n-   **部分采样 (Partial sampling)**：处理 $\\mathcal{D}$ 中的所有像素。位 $b_k(r,c)$ 的确定方式如下：\n    $$ b_k(r,c) = \\begin{cases} 1   \\text{if } (r',c') \\in \\mathcal{D} \\text{ and } I_{r',c'} \\ge I_{r,c} \\\\ 0   \\text{if } (r',c') \\notin \\mathcal{D} \\text{ or } I_{r',c'}  I_{r,c} \\end{cases} $$\n\n**2. LBP 编码计算**\n\n中心像素是 $(2,2)$，强度为 $I_{2,2}=20$。其所有 8 个邻域像素的强度均为 $10$。由于 $10  20$，所有的位 $b_k(2,2)$ 均为 $0$。因此，$s(2,2) = \\sum_{k=0}^{7} 0 \\cdot 2^k = 0$。由于其邻域完全包含在 ROI 内，该编码对于所有策略都是相同的。\n\n另外 $8$ 个像素位于边界上，强度均为 $10$。对于这些像素，任何强度 $I_{neigh} \\ge 10$ 的邻域像素都将导致位 $b_k=1$。在此 ROI 中，所有像素的强度均为 $10$ 或 $20$，因此任何有效的邻域查找都将得到位 $1$。\n\n-   **忽略 (Ignore)**：只有中心像素 $(2,2)$ 的邻域完全位于 $3 \\times 3$ 的 ROI 内。因此，只计算了 $s(2,2)=0$。\n-   **镜像 (Mirror)**：对于任意一个 $8$ 个边界像素，中心强度为 $10$。任何邻域像素，无论是在 ROI 内部还是经过镜像处理，其强度都将是 $10$ 或 $20$。由于所有邻域像素的强度都 $\\ge 10$，所以所有 $8$ 个位都将是 $1$。因此，对于所有 $8$ 个边界像素，编码为 $s = \\sum_{k=0}^{7} 1 \\cdot 2^k = 2^8 - 1 = 255$。\n-   **环绕 (Wrap)**：同样，对于任意一个 $8$ 个边界像素（中心强度为 $10$），任何经过环绕处理的邻域像素的强度都将是 $10$ 或 $20$。所以，所有 $8$ 个位都是 $1$。所有 $8$ 个边界像素的编码都是 $255$。\n-   **部分采样 (Partial sampling)**：对于 $8$ 个边界像素（中心强度为 $10$），如果其对应的邻域像素在 ROI 内部，则位 $b_k$ 为 $1$，如果在外部，则为 $0$。\n    -   像素 $(1,1)$：ROI 内的邻域点位于 $k=3,4,5$。$s(1,1)=2^3+2^4+2^5 = 8+16+32 = 56$。\n    -   像素 $(1,3)$：ROI 内的邻域点位于 $k=5,6,7$。$s(1,3)=2^5+2^6+2^7 = 32+64+128 = 224$。\n    -   像素 $(3,1)$：ROI 内的邻域点位于 $k=1,2,3$。$s(3,1)=2^1+2^2+2^3 = 2+4+8 = 14$。\n    -   像素 $(3,3)$：ROI 内的邻域点位于 $k=7,0,1$。$s(3,3)=2^7+2^0+2^1 = 128+1+2 = 131$。\n    -   像素 $(1,2)$：ROI 内的邻域点位于 $k=3,4,5,6,7$。$s(1,2)=2^3+2^4+2^5+2^6+2^7 = 8+16+32+64+128 = 248$。\n    -   像素 $(2,1)$：ROI 内的邻域点位于 $k=1,2,3,4,5$。$s(2,1)=2^1+2^2+2^3+2^4+2^5 = 2+4+8+16+32 = 62$。\n    -   像素 $(2,3)$：ROI 内的邻域点位于 $k=5,6,7,0,1$。$s(2,3)=2^5+2^6+2^7+2^0+2^1 = 32+64+128+1+2 = 227$。\n    -   像素 $(3,2)$：ROI 内的邻域点位于 $k=7,0,1,2,3$。$s(3,2)=2^7+2^0+2^1+2^2+2^3 = 128+1+2+4+8 = 143$。\n\n**3. 归一化 LBP 直方图**\n\n直方图是计算出的 LBP 编码的归一化分布。\n-   $H_{\\text{Ignore}}$：一个像素的编码为 $0$。\n    $H_{\\text{Ignore}}(0) = 1$。\n-   $H_{\\text{Mirror}}$：一个像素的编码为 $0$，八个像素的编码为 $255$。\n    $H_{\\text{Mirror}}(0) = 1/9$, $H_{\\text{Mirror}}(255) = 8/9$。\n-   $H_{\\text{Wrap}}$：一个像素的编码为 $0$，八个像素的编码为 $255$。\n    $H_{\\text{Wrap}}(0) = 1/9$, $H_{\\text{Wrap}}(255) = 8/9$。\n-   $H_{\\text{Partial}}$：九个像素，每个都有唯一的编码。\n    对于 $s \\in \\{0, 14, 56, 62, 131, 143, 224, 227, 248\\}$，$H_{\\text{Partial}}(s) = 1/9$。\n\n**4. 詹森-香农散度计算**\n\n两个概率分布 $P$ 和 $Q$ 之间的 JS 散度为 $D_{JS}(P || Q) = \\frac{1}{2} D_{KL}(P || M) + \\frac{1}{2} D_{KL}(Q || M)$，其中 $M = \\frac{1}{2}(P+Q)$ 且 $D_{KL}(P || M) = \\sum_i P(i) \\ln\\frac{P(i)}{M(i)}$。\n\n令 $P = H_{\\text{Ignore}}$ 且 $Q = H_{\\text{Mirror}}$。LBP 编码由 $i$ 索引。\n非零概率为：\n$P(0) = 1$\n$Q(0) = 1/9$, $Q(255) = 8/9$\n\n混合分布 $M = \\frac{1}{2}(P+Q)$ 的非零概率为：\n$M(0) = \\frac{1}{2}(P(0) + Q(0)) = \\frac{1}{2}(1 + 1/9) = \\frac{1}{2}(10/9) = 5/9$。\n$M(255) = \\frac{1}{2}(P(255) + Q(255)) = \\frac{1}{2}(0 + 8/9) = \\frac{1}{2}(8/9) = 4/9$。\n\n第一个 KL 散度项，$D_{KL}(P || M)$：\n求和是针对 $P(i)  0$ 的 $i$ 进行的，这里只有 $i=0$。\n$$ D_{KL}(P || M) = P(0) \\ln\\left(\\frac{P(0)}{M(0)}\\right) = 1 \\cdot \\ln\\left(\\frac{1}{5/9}\\right) = \\ln(9/5) $$\n\n第二个 KL 散度项，$D_{KL}(Q || M)$：\n求和是针对 $Q(i)  0$ 的 $i$ 进行的，这里是 $i=0$ 和 $i=255$。\n$$ D_{KL}(Q || M) = Q(0) \\ln\\left(\\frac{Q(0)}{M(0)}\\right) + Q(255) \\ln\\left(\\frac{Q(255)}{M(255)}\\right) $$\n$$ D_{KL}(Q || M) = \\frac{1}{9} \\ln\\left(\\frac{1/9}{5/9}\\right) + \\frac{8}{9} \\ln\\left(\\frac{8/9}{4/9}\\right) = \\frac{1}{9} \\ln\\left(\\frac{1}{5}\\right) + \\frac{8}{9} \\ln(2) = -\\frac{1}{9}\\ln(5) + \\frac{8}{9}\\ln(2) $$\n\n现在，将它们组合起来求 JS 散度：\n$$ D_{JS}(P || Q) = \\frac{1}{2} \\left[ D_{KL}(P || M) + D_{KL}(Q || M) \\right] $$\n$$ D_{JS}(P || Q) = \\frac{1}{2} \\left[ \\ln\\left(\\frac{9}{5}\\right) - \\frac{1}{9}\\ln(5) + \\frac{8}{9}\\ln(2) \\right] $$\n$$ D_{JS}(P || Q) = \\frac{1}{2} \\left[ \\ln(9) - \\ln(5) - \\frac{1}{9}\\ln(5) + \\frac{8}{9}\\ln(2) \\right] $$\n$$ D_{JS}(P || Q) = \\frac{1}{2} \\left[ 2\\ln(3) - \\frac{10}{9}\\ln(5) + \\frac{8}{9}\\ln(2) \\right] $$\n$$ D_{JS}(P || Q) = \\ln(3) - \\frac{5}{9}\\ln(5) + \\frac{4}{9}\\ln(2) $$\n\n为获得数值，我们使用自然对数值：\n$\\ln(2) \\approx 0.693147$\n$\\ln(3) \\approx 1.098612$\n$\\ln(5) \\approx 1.609438$\n$$ D_{JS}(P || Q) \\approx 1.098612 - \\frac{5}{9}(1.609438) + \\frac{4}{9}(0.693147) $$\n$$ D_{JS}(P || Q) \\approx 1.098612 - 0.894132 + 0.308065 $$\n$$ D_{JS}(P || Q) \\approx 0.512545 $$\n四舍五入到四位有效数字，结果为 $0.5125$ 奈特 (nats)。",
            "answer": "$$\\boxed{0.5125}$$"
        },
        {
            "introduction": "LBP算法中一个微妙但关键的方面是如何处理邻域像素与中心像素强度完全相等的情况。这个思想实验将引导您对这种“平局”问题进行统计分析，尤其是在这种情况很常见的低对比度区域。理解这个问题是开发稳健且可复现的影像组学流程的关键。",
            "id": "4565424",
            "problem": "在一个放射组学流程中，局部二值模式（LBP）通过将每个邻域像素强度与中心像素强度进行阈值比较来概括局部纹理。设半径为 $R$ 的 $P$ 邻域LBP由阈值函数 $s(x)$ 定义，该函数应用于每个邻域像素 $n$ 的强度差 $x = I_{n} - I_{c}$，其中 $I_{n}$ 和 $I_{c}$ 分别是邻域和中心观测到的图像强度。假设在低对比度同质区域中存在以下基础模型：\n- 真实的底层强度是恒定的，因此 $T_{n} = T_{c} = T$。\n- 观测强度被加性、独立的零均值高斯噪声所破坏：$I_{n} = T + \\varepsilon_{n}$ 和 $I_{c} = T + \\varepsilon_{c}$，其中 $\\varepsilon_{n}, \\varepsilon_{c} \\sim \\mathcal{N}(0,\\sigma^{2})$ 且相互独立。\n- 强度通过步长为 $\\Delta  0$ 的均匀标量量化进行离散化，即 $Q(x) = \\Delta \\left\\lfloor \\frac{x}{\\Delta} \\right\\rfloor$，并且LBP比较是在量化后的强度上执行的，因此可观测的决策变量是 $d_{q} = Q(I_{n}) - Q(I_{c})$。\n\n将二元阈值函数定义为\n$$\ns(x) = \n\\begin{cases}\n1,  x  0, \\\\\n0,  x  0,\n\\end{cases}\n$$\n并且需要为 $x = 0$ 的情况定义一个平局处理约定。在低对比度同质区域中，当 $d_{q} = 0$ 时出现平局。设 $p_{t} = \\mathbb{P}(d_{q} = 0)$ 表示上述模型下的平局概率。\n\n使用模型假设以及关于独立性、对称性和量化的第一性原理，分析将 $s(0)$ 设置为 $1$ 与设置为 $0$ 对低对比度区域LBP编码中每个邻域“1”的期望分数的影响。然后，提出一个基于噪声统计的、有原则的平局打破规则，该规则能避免“1”的期望分数出现偏差，并增强基于直方图的放射组学特征的可复现性。\n\n哪个选项是正确的？\n\nA. 在具有加性对称噪声和均匀量化的同质低对比度区域中，$\\mathbb{P}(d_{q}  0) = \\mathbb{P}(d_{q}  0)$ 且 $\\mathbb{P}(d_{q} = 0) = p_{t}$。每个邻域“1”的期望分数是 $\\frac{1 - p_{t}}{2} + p_{t} s(0)$，因此 $s(0) = 1$ 会产生相对于 $0.5$ 的 $\\frac{p_{t}}{2}$ 的上偏，而 $s(0) = 0$ 会产生 $\\frac{p_{t}}{2}$ 的下偏。一个有原则的平局打破规则是使用后验概率 $w = \\mathbb{P}(I_{n} \\ge I_{c} \\mid d_{q} = 0)$ 来分配平局；在对称噪声模型下，$w = \\frac{1}{2}$，因此平局对结果“1”和结果“0”各贡献一半（软直方图加权），从而在不进行随机化的情况下消除偏差。\n\nB. 在同质低对比度区域中，设置 $s(0) = 0$ 是无偏的，因为 $\\mathbb{P}(d_{q} = 0)$ 可以忽略不计；因此，不需要特殊的平局打破规则。\n\nC. 只要 $p_{t}  0$，选择 $s(0) = 1$ 或 $s(0) = 0$ 是等效的。一个有原则的规则是，如果 $\\sigma  \\Delta$，则设置 $s(0) = 1$，否则设置 $s(0) = 0$，因为当 $\\sigma  \\Delta$ 时，量化在噪声中占主导地位。\n\nD. 在低对比度区域中，设置 $s(0) = 1$ 会减少均匀模式的数量并增加非均匀模式的数量。一个有原则的平局打破规则是添加一个小的随机抖动 $\\eta \\sim \\mathcal{N}(0,\\sigma^{2})$，通过采样来打破平局，这能确保跨图像结果的公平性。",
            "solution": "问题要求在放射组学的特定背景下，分析局部二值模式（LBP）计算中的平局打破问题。在该背景下，图像强度被建模为一个恒定的真实值，该真实值受到加性、独立的零均值高斯噪声的干扰，随后进行均匀标量量化。\n\n### 问题验证\n\n问题陈述已经过验证，被认为是**有效的**。它在科学上基于统计信号处理和图像分析，问题设定良好，具有清晰的概率模型，并使用客观、正式的语言。所有进行严谨推导所需的信息都已提供。\n\n### 推导\n\n**1. 强度差的分布**\n\n设邻域像素和中心像素的未量化强度分别为 $I_n$ 和 $I_c$。根据模型，我们有：\n$$I_n = T + \\varepsilon_n$$\n$$I_c = T + \\varepsilon_c$$\n其中 $T$ 是恒定的真实强度，$\\varepsilon_n, \\varepsilon_c$ 是来自正态分布 $\\mathcal{N}(0, \\sigma^2)$ 的独立同分布（i.i.d.）随机变量。\n\n未量化强度的差是一个随机变量 $X = I_n - I_c = (T + \\varepsilon_n) - (T + \\varepsilon_c) = \\varepsilon_n - \\varepsilon_c$。\n作为两个独立的零均值高斯随机变量之差，$X$ 也是一个高斯随机变量。\n- $X$ 的均值为 $\\mathbb{E}[X] = \\mathbb{E}[\\varepsilon_n] - \\mathbb{E}[\\varepsilon_c] = 0 - 0 = 0$。\n- $X$ 的方差为 $\\text{Var}(X) = \\text{Var}(\\varepsilon_n - \\varepsilon_c) = \\text{Var}(\\varepsilon_n) + \\text{Var}(\\varepsilon_c) = \\sigma^2 + \\sigma^2 = 2\\sigma^2$，这是由于独立性。\n因此，$X \\sim \\mathcal{N}(0, 2\\sigma^2)$。$X$ 的概率密度函数（PDF）是连续的且关于 $0$ 对称。这意味着 $\\mathbb{P}(X  0) = \\mathbb{P}(X  0) = 1/2$。\n\n**2. 量化后差异的分布**\n\nLBP比较在量化后的强度上进行。决策变量是 $d_q = Q(I_n) - Q(I_c)$，其中 $Q(x) = \\Delta \\lfloor \\frac{x}{\\Delta} \\rfloor$。\n$d_q$ 的可能值是量化步长 $\\Delta$ 的整数倍。$d_q$ 的分布是离散的。\n\n让我们分析 $d_q$ 分布的对称性。我们感兴趣的是三个互斥事件的概率：$d_q  0$，$d_q  0$ 和 $d_q = 0$。\n事件 $d_q=0$ 是平局事件，其概率为 $p_t = \\mathbb{P}(d_q=0)$。这发生在 $Q(I_n) = Q(I_c)$ 时，意味着 $I_n$ 和 $I_c$ 落入同一个量化区间。对于任何有限的 $\\Delta  0$ 和 $\\sigma  0$，这个概率 $p_t$ 严格为正。\n\n考虑 $(I_n, I_c)$ 的联合概率密度函数（PDF），记为 $f(i_n, i_c)$。由于 $I_n$ 和 $I_c$ 是独立同分布的（减去均值 $T$ 后），它们的联合PDF对其参数是对称的：$f(i_n, i_c) = f(i_c, i_n)$。\n\n概率 $\\mathbb{P}(d_q  0)$ 是对于所有整数 $k  0$ 的概率 $\\mathbb{P}(Q(I_n) - Q(I_c) = k\\Delta)$ 的和。\n概率 $\\mathbb{P}(d_q  0)$ 是对于所有整数 $k  0$ 的概率 $\\mathbb{P}(Q(I_n) - Q(I_c) = -k\\Delta)$ 的和。\n\n让我们比较对于一个固定的 $k  0$，$\\mathbb{P}(Q(I_n) - Q(I_c) = k\\Delta)$ 和 $\\mathbb{P}(Q(I_n) - Q(I_c) = -k\\Delta)$。\n$\\mathbb{P}(Q(I_n) - Q(I_c) = -k\\Delta) = \\mathbb{P}(Q(I_c) - Q(I_n) = k\\Delta)$。\n因为对 $(I_n, I_c)$ 与对 $(I_c, I_n)$ 具有相同的联合分布，所以可以得出 $\\mathbb{P}(Q(I_c) - Q(I_n) = k\\Delta) = \\mathbb{P}(Q(I_n) - Q(I_c) = k\\Delta)$。\n因此，$d_q$ 的分布是关于 $0$ 对称的。这意味着：\n$$\\mathbb{P}(d_q  0) = \\mathbb{P}(d_q  0)$$\n由于总概率为 $1$，我们有：\n$$\\mathbb{P}(d_q  0) + \\mathbb{P}(d_q  0) + \\mathbb{P}(d_q = 0) = 1$$\n代入对称性属性和 $p_t = \\mathbb{P}(d_q=0)$:\n$$2 \\cdot \\mathbb{P}(d_q  0) + p_t = 1$$\n这得出：\n$$\\mathbb{P}(d_q  0) = \\mathbb{P}(d_q  0) = \\frac{1 - p_t}{2}$$\n\n**3. “1”的期望分数与偏差分析**\n\nLBP 位由函数 $s(d_q)$ 决定。“1”的期望分数是期望值 $\\mathbb{E}[s(d_q)]$。\n函数定义为当 $x0$ 时 $s(x)=1$，当 $x0$ 时 $s(x)=0$。值 $s(0)$ 是一个选定的约定。\n期望值为：\n$$\\mathbb{E}[s(d_q)] = 1 \\cdot \\mathbb{P}(s(d_q)=1) + 0 \\cdot \\mathbb{P}(s(d_q)=0) = \\mathbb{P}(s(d_q)=1)$$\n事件 $s(d_q)=1$ 发生在 $d_q  0$ 时，或者在 $d_q = 0$ 且我们定义 $s(0)=1$ 时。\n所以，$\\mathbb{P}(s(d_q)=1) = \\mathbb{P}(d_q  0) + \\mathbb{P}(d_q=0 \\text{ and } s(0)=1)$。\n假设 $s(0)$ 是一个固定值（例如 $0$ 或 $1$），我们可以将其写为：\n$$\\mathbb{E}[s(d_q)] = \\mathbb{P}(d_q  0) + s(0) \\cdot \\mathbb{P}(d_q=0)$$\n代入前面推导出的概率：\n$$\\mathbb{E}[s(d_q)] = \\frac{1 - p_t}{2} + s(0) \\cdot p_t$$\n在同质区域中，底层信号不提供任何方向性信息，因此一个无偏的LBP算子应该以相等的概率产生“1”和“0”，即“1”的期望分数应为 $1/2$。\n让我们分析两种常见的 $s(0)$ 约定的偏差（与 $1/2$ 的偏离）：\n\n- 如果 $s(0)=1$:\n  $$\\mathbb{E}[s(d_q)] = \\frac{1 - p_t}{2} + p_t = \\frac{1+p_t}{2} = \\frac{1}{2} + \\frac{p_t}{2}$$\n  这引入了 $\\frac{p_t}{2}$ 的正偏差。\n\n- 如果 $s(0)=0$:\n  $$\\mathbb{E}[s(d_q)] = \\frac{1 - p_t}{2} + 0 \\cdot p_t = \\frac{1 - p_t}{2} = \\frac{1}{2} - \\frac{p_t}{2}$$\n  这引入了 $-\\frac{p_t}{2}$ 的负偏差。\n\n由于 $p_t  0$，两种约定都在同质区域中引入了系统性偏差，这会破坏从LBP直方图派生的纹理特征。\n\n**4. 有原则的平局打破规则**\n\n为了消除偏差，“1”的期望分数必须是 $1/2$。这需要一个处理平局（$d_q=0$）的规则。一个有原则的方法是，在观测到 $d_q=0$ 的条件下，确定未量化差异 $I_n - I_c$ 的“真实”符号的最佳估计。这可以表述为找到后验概率 $w = \\mathbb{P}(I_n \\ge I_c \\mid d_q = 0)$。这个概率 $w$ 代表了 $s(0)$ 的理想“软”值。\n\n让我们计算 $w$。\n$$w = \\mathbb{P}(I_n \\ge I_c \\mid Q(I_n) = Q(I_c)) = \\frac{\\mathbb{P}(I_n \\ge I_c \\text{ and } Q(I_n) = Q(I_c))}{\\mathbb{P}(Q(I_n) = Q(I_c))}$$\n事件 $\\{I_n \\ge I_c\\}$ 可以分为 $\\{I_n  I_c\\}$ 和 $\\{I_n=I_c\\}$。由于 $I_n-I_c$ 的底层分布是连续的，$\\mathbb{P}(I_n=I_c)=0$。因此，$\\mathbb{P}(I_n \\ge I_c) = \\mathbb{P}(I_n  I_c)$。\n\n正如在第2步中确立的，联合PDF $f(i_n, i_c)$ 是对称的。这种对称性意味着：\n$$\\mathbb{P}(I_n  I_c \\text{ and } Q(I_n) = Q(I_c)) = \\mathbb{P}(I_c  I_n \\text{ and } Q(I_c) = Q(I_n))$$\n分母是 $p_t = \\mathbb{P}(Q(I_n) = Q(I_c))$，它是三个不相交区域上概率的总和：\n$$p_t = \\mathbb{P}(I_n  I_c, Q(I_n)=Q(I_c)) + \\mathbb{P}(I_n  I_c, Q(I_n)=Q(I_c)) + \\mathbb{P}(I_n = I_c, Q(I_n)=Q(I_c))$$\n设 $P_{}$ 是第一项，$P_{}$ 是第二项。第三项是 $0$。\n根据对称性论证，$P_{} = P_{}$。因此，$p_t = 2 P_{}$。\n$w$ 的分子是 $\\mathbb{P}(I_n \\ge I_c \\text{ and } Q(I_n)=Q(I_c)) = P_{}$。\n因此，\n$$w = \\frac{P_{}}{p_t} = \\frac{P_{}}{2 P_{}} = \\frac{1}{2}$$\n这意味着，在量化域中出现平局的情况下，真实的未量化邻域强度大于或小于中心强度的可能性是相等的。$s(0)$ 最有原则的值就是这个后验概率，$1/2$。\n\n使用 $s(0)=1/2$（概念上作为软权重），“1”的期望分数变为：\n$$\\mathbb{E}[s(d_q)] = \\frac{1 - p_t}{2} + \\frac{1}{2} \\cdot p_t = \\frac{1 - p_t + p_t}{2} = \\frac{1}{2}$$\n这个选择消除了偏差。在实践中，可以通过为每个平局向LBP码值加 $1/2$ 或使用软直方图来确定性地实现。这种确定性方法避免了随机平局打破带来的可复现性问题。\n\n### 逐项分析\n\n**A. 在具有加性对称噪声和均匀量化的同质低对比度区域中，$\\mathbb{P}(d_{q}  0) = \\mathbb{P}(d_{q}  0)$ 且 $\\mathbb{P}(d_{q} = 0) = p_{t}$。每个邻域“1”的期望分数是 $\\frac{1 - p_{t}}{2} + p_{t} s(0)$，因此 $s(0) = 1$ 会产生相对于 $0.5$ 的 $\\frac{p_{t}}{2}$ 的上偏，而 $s(0) = 0$ 会产生 $\\frac{p_{t}}{2}$ 的下偏。一个有原则的平局打破规则是使用后验概率 $w = \\mathbb{P}(I_{n} \\ge I_{c} \\mid d_{q} = 0)$ 来分配平局；在对称噪声模型下，$w = \\frac{1}{2}$，因此平局对结果“1”和结果“0”各贡献一半（软直方图加权），从而在不进行随机化的情况下消除偏差。**\n这个陈述与我们的推导完全一致。每个子论点——$d_q$ 分布的对称性、\"1\"的期望分数的公式、$s(0)=1$ 和 $s(0)=0$ 导致的偏差，以及所提出的有原则、无偏且可复现的平局打破规则——都是正确的。\n**结论：正确。**\n\n**B. 在同质低对比度区域中，设置 $s(0) = 0$ 是无偏的，因为 $\\mathbb{P}(d_{q} = 0)$ 可以忽略不计；因此，不需要特殊的平局打破规则。**\n这是不正确的。如上所示，设置 $s(0)=0$ 会导致 $-\\frac{p_t}{2}$ 的偏差。声称 $p_t = \\mathbb{P}(d_q=0)$ 可以忽略不计是一个未经证实且通常是错误的假设。平局概率取决于噪声方差 $\\sigma^2$ 与量化步长 $\\Delta$ 的比率，并且可能相当大，特别是当噪声相对于量化步长较小时（$\\sigma \\ll \\Delta$）。\n**结论：不正确。**\n\n**C. 只要 $p_{t}  0$，选择 $s(0) = 1$ 或 $s(0) = 0$ 是等效的。一个有原则的规则是，如果 $\\sigma  \\Delta$，则设置 $s(0) = 1$，否则设置 $s(0) = 0$，因为当 $\\sigma  \\Delta$ 时，量化在噪声中占主导地位。**\n这个陈述是不正确的。选择 $s(0)=1$ 和 $s(0)=0$ 并不等效；它们会导致符号相反的偏差。只有当 $p_t = 0$ 时它们才等效。所提出的规则是临时的且没有原则的；它并不能消除偏差，只是基于一个任意的 $\\sigma/\\Delta$ 阈值在正负偏差之间切换。其推理是错误的。\n**结论：不正确。**\n\n**D. 在低对比度区域中，设置 $s(0) = 1$ 会减少均匀模式的数量并增加非均匀模式的数量。一个有原则的平局打破规则是添加一个小的随机抖动 $\\eta \\sim \\mathcal{N}(0,\\sigma^{2})$，通过采样来打破平局，这能确保跨图像结果的公平性。**\n第一个论点值得怀疑。在一个具有高平局概率 $p_t$ 的低对比度区域中，设置 $s(0)=1$ 会倾向于产生有很多'1'的LBP码（例如，`11111111`），而 $s(0)=0$ 会产生有很多'0'的码（例如，`00000000`）。两者都是均匀模式。$s(0)$ 的选择影响*哪种*均匀模式占优势，但不一定减少均匀模式的总数。陈述的第二部分建议使用随机化来打破平局。虽然这可以*在期望上*消除偏差，但它违背了增强可复现性的目标，而可复现性对于稳健的放射组学特征至关重要。选项A中提出的方法更优，因为它既是无偏的又是确定性的。\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}