{
    "hands_on_practices": [
        {
            "introduction": "单因素方差分析（ANOVA）的 F 检验能告诉我们组间均值是否存在显著差异，但它无法指明具体是哪些组别之间存在差异。为了检验预先设定的具体研究问题，例如某个高剂量药物是否比低、中剂量药物的平均效果更好，我们需要使用线性对比（linear contrasts）。这项练习将帮助你掌握如何定义和检验一个具体的科学假设，通过构建对比的置信区间，从而进行比笼统的 F 检验更精确的统计推断()。",
            "id": "4919608",
            "problem": "一项随机临床试验评估了三种剂量的抗炎药与安慰剂相比，在$8$周后对C反应蛋白（CRP）降低效果的影响。四个试验组分别是安慰剂组、低剂量组、中剂量组和高剂量组。单因素方差分析（ANOVA）模型假设误差是独立且服从具有共同方差的正态分布。样本量分别为 $n_{\\text{placebo}} = 28$，$n_{\\text{low}} = 30$，$n_{\\text{medium}} = 32$ 和 $n_{\\text{high}} = 26$。CRP降低的样本均值（单位：$\\mathrm{mg/L}$）分别为 $\\bar{y}_{\\text{placebo}} = 0.7$，$\\bar{y}_{\\text{low}} = 2.9$，$\\bar{y}_{\\text{medium}} = 3.5$ 和 $\\bar{y}_{\\text{high}} = 4.8$。来自ANOVA的组内合并方差估计（记为 $\\hat{\\sigma}^{2}$）为 $1.44$。\n\n考虑一个对比，该对比用于比较高剂量组与低、中剂量组的平均效果，在总体水平上定义为 $\\psi = \\mu_{\\text{high}} - \\frac{1}{2}\\left(\\mu_{\\text{low}} + \\mu_{\\text{medium}}\\right)$。在单因素ANOVA的假设下，并使用合并方差估计，基于残差自由度为 $\\psi$ 构建双侧 $95\\%$ 置信区间。报告此置信区间的下界（单位：$\\mathrm{mg/L}$），并四舍五入到四位有效数字。简要解释整个区间的符号对于高剂量相对于低、中剂量平均效果的优效性的临床推断意味着什么。",
            "solution": "该问题要求在单因素方差分析（ANOVA）的背景下，为总体均值的特定线性对比构建一个 $95\\%$ 的置信区间。\n\n首先，我们验证问题陈述的有效性。\n问题给出了以下已知条件：\n-   组数，$k=4$。\n-   各组样本量：$n_{\\text{placebo}} = 28$，$n_{\\text{low}} = 30$，$n_{\\text{medium}} = 32$ 和 $n_{\\text{high}} = 26$。\n-   各组样本均值：$\\bar{y}_{\\text{placebo}} = 0.7$，$\\bar{y}_{\\text{low}} = 2.9$，$\\bar{y}_{\\text{medium}} = 3.5$ 和 $\\bar{y}_{\\text{high}} = 4.8$。\n-   组内合并方差估计（均方误差，MSE）：$\\hat{\\sigma}^2 = 1.44$。\n-   关注的总体对比：$\\psi = \\mu_{\\text{high}} - \\frac{1}{2}\\left(\\mu_{\\text{low}} + \\mu_{\\text{medium}}\\right)$。\n-   置信水平为 $95\\%$，对应于 $\\alpha = 0.05$。\n\n该问题具有科学依据，提法明确，客观，并包含足够的信息以获得唯一解。这是一个标准的生物统计学问题。因此，该问题被认为是有效的。\n\n线性对比 $\\psi = \\sum_{i=1}^{k} c_i \\mu_i$ 的双侧 $(1-\\alpha) \\times 100\\%$ 置信区间的一般形式为：\n$$ \\hat{\\psi} \\pm t_{\\alpha/2, df} \\cdot SE(\\hat{\\psi}) $$\n其中 $\\hat{\\psi}$ 是对比的样本估计值，$t_{\\alpha/2, df}$ 是自由度为 $df$ 的 t 分布的临界值，$SE(\\hat{\\psi})$ 是估计值的标准误。\n\n我们按顺序计算每个组成部分。\n\n1.  **对比的估计值，$\\hat{\\psi}$**：\n    对比 $\\psi = \\mu_{\\text{high}} - \\frac{1}{2}\\mu_{\\text{low}} - \\frac{1}{2}\\mu_{\\text{medium}}$ 的系数为 $c_{\\text{high}}=1$，$c_{\\text{low}}=-1/2$，$c_{\\text{medium}}=-1/2$ 和 $c_{\\text{placebo}}=0$。\n    样本估计值 $\\hat{\\psi}$ 是通过用样本均值替代总体均值来计算的：\n    $$ \\hat{\\psi} = \\bar{y}_{\\text{high}} - \\frac{1}{2}\\left(\\bar{y}_{\\text{low}} + \\bar{y}_{\\text{medium}}\\right) $$\n    代入给定值：\n    $$ \\hat{\\psi} = 4.8 - \\frac{1}{2}(2.9 + 3.5) = 4.8 - \\frac{1}{2}(6.4) = 4.8 - 3.2 = 1.6 $$\n\n2.  **自由度，$df$**：\n    合并方差估计的自由度（即残差自由度）由 $df = N - k$ 给出，其中 $N$ 是总样本量，$k$ 是组数。\n    总样本量为 $N = n_{\\text{placebo}} + n_{\\text{low}} + n_{\\text{medium}} + n_{\\text{high}} = 28 + 30 + 32 + 26 = 116$。\n    组数为 $k=4$。\n    因此，自由度为：\n    $$ df = 116 - 4 = 112 $$\n\n3.  **估计值的标准误，$SE(\\hat{\\psi})$**：\n    估计对比的方差 $\\widehat{\\text{Var}}(\\hat{\\psi})$ 是使用合并方差估计 $\\hat{\\sigma}^2$ 和对比中涉及的各组的样本量计算的。\n    $$ \\widehat{\\text{Var}}(\\hat{\\psi}) = \\hat{\\sigma}^2 \\sum_{i=1}^{k} \\frac{c_i^2}{n_i} $$\n    对于我们特定的对比：\n    $$ \\widehat{\\text{Var}}(\\hat{\\psi}) = \\hat{\\sigma}^2 \\left( \\frac{c_{\\text{high}}^2}{n_{\\text{high}}} + \\frac{c_{\\text{low}}^2}{n_{\\text{low}}} + \\frac{c_{\\text{medium}}^2}{n_{\\text{medium}}} \\right) = \\hat{\\sigma}^2 \\left( \\frac{1^2}{n_{\\text{high}}} + \\frac{(-1/2)^2}{n_{\\text{low}}} + \\frac{(-1/2)^2}{n_{\\text{medium}}} \\right) $$\n    代入给定值：\n    $$ \\widehat{\\text{Var}}(\\hat{\\psi}) = 1.44 \\left( \\frac{1}{26} + \\frac{1/4}{30} + \\frac{1/4}{32} \\right) = 1.44 \\left( \\frac{1}{26} + \\frac{1}{120} + \\frac{1}{128} \\right) $$\n    计算括号内的各项：\n    $$ \\frac{1}{26} \\approx 0.03846154, \\quad \\frac{1}{120} \\approx 0.00833333, \\quad \\frac{1}{128} = 0.0078125 $$\n    $$ \\sum \\frac{c_i^2}{n_i} \\approx 0.03846154 + 0.00833333 + 0.0078125 = 0.05460737 $$\n    $$ \\widehat{\\text{Var}}(\\hat{\\psi}) \\approx 1.44 \\times 0.05460737 \\approx 0.07863461 $$\n    标准误是方差的平方根：\n    $$ SE(\\hat{\\psi}) = \\sqrt{\\widehat{\\text{Var}}(\\hat{\\psi})} \\approx \\sqrt{0.07863461} \\approx 0.2804186 $$\n\n4.  **临界值，$t_{\\alpha/2, df}$**：\n    对于 $95\\%$ 的置信区间，$\\alpha=0.05$，所以我们需要临界值 $t_{0.025, 112}$。使用统计软件或自由度为 $df=112$ 的详细 t 分布表，该值约为：\n    $$ t_{0.025, 112} \\approx 1.98137 $$\n\n5.  **置信区间构建**：\n    现在我们计算误差范围（ME）：\n    $$ ME = t_{0.025, 112} \\cdot SE(\\hat{\\psi}) \\approx 1.98137 \\times 0.2804186 \\approx 0.555627 $$\n    $95\\%$ 置信区间为 $\\hat{\\psi} \\pm ME$：\n    $$ CI_{95\\%} = 1.6 \\pm 0.555627 $$\n    下界：$L = 1.6 - 0.555627 = 1.044373$\n    上界：$U = 1.6 + 0.555627 = 2.155627$\n    置信区间约为 $(1.044, 2.156)$。\n\n6.  **最终答案与四舍五入**：\n    问题要求置信区间的下界，并四舍五入到四位有效数字。\n    计算出的下界为 $1.044373$。前四位有效数字是 $1$、$0$、$4$ 和 $4$。第五位有效数字是 $3$，小于 $5$，因此我们向下取整。\n    四舍五入到四位有效数字的下界是 $1.044$。\n\n7.  **置信区间的解释**：\n    对比 $\\psi = \\mu_{\\text{high}} - \\frac{1}{2}\\left(\\mu_{\\text{low}} + \\mu_{\\text{medium}}\\right)$ 的 $95\\%$ 置信区间约为 $(1.044, 2.156)$。由于整个区间为正（下界 $1.044$ 大于 $0$），我们有 $95\\%$ 的把握认为对比 $\\psi$ 的真实值为正。$\\psi$ 为正值意味着 $\\mu_{\\text{high}} > \\frac{1}{2}\\left(\\mu_{\\text{low}} + \\mu_{\\text{medium}}\\right)$。\n    在临床上，这提供了统计学上显著的证据，表明高剂量组的C反应蛋白平均降低值大于低剂量组和中剂量组的平均降低值的平均值。这表明，与较低活性剂量的平均效果相比，高剂量具有优效性。",
            "answer": "$$ \\boxed{1.044} $$"
        },
        {
            "introduction": "当方差分析的 F 检验结果显著时，如果我们没有预设的对比，通常希望对所有组别进行两两比较以探索差异来源。然而，进行多次 t 检验会增加犯第一类错误的总体概率（family-wise error rate）。为了控制这一风险，我们需要使用事后检验（post-hoc tests），如 Tukey 诚实显著性差异（HSD）检验。这项练习将指导你计算 Tukey HSD 的决策阈值，帮助你判断任意两组均值之间的差异是否在统计上显著，这是在获得显著 ANOVA 结果后进行有效探索性分析的一项基本技能()。",
            "id": "4827786",
            "problem": "一项多中心随机试验在一个单因素方差分析（ANOVA）模型下，评估了$k=4$个治疗组（每个治疗组有$n=25$名参与者）的收缩压平均降低量。假设满足标准的单因素ANOVA假定：误差$\\epsilon_{ij}$独立同分布于$\\mathcal{N}(0,\\sigma^{2})$，各组间方差相等，且各组间相互独立。观测到的合并误差均方为$\\mathrm{MSE}=36$，误差自由度为$\\nu=96$。研究者希望使用Tukey真实显著性差异（HSD）程序对$k$个组的均值进行所有成对比较，同时将族系误差率控制在$\\alpha=0.05$。\n\n设$q_{0.95;4,96}=3.63$表示具有$k=4$个组和$\\nu=96$个自由度的学生化极差分布的$0.95$分位数。从基本的ANOVA模型和学生化极差的定义出发，推导在该平衡设计中，族系误差率为$\\alpha=0.05$时成对均值差异的Tukey HSD决策阈值，然后根据给定的$\\mathrm{MSE}$和$n$计算其数值。使用此阈值，判断观测到的绝对均值差异$9$（单位与结果变量相同）在Tukey HSD检验下是否具有统计显著性。\n\n定义决策指示符$D$：如果绝对均值差异$9$在Tukey HSD检验下，族系误差率为$\\alpha=0.05$时是显著的，则$D=1$，否则$D=0$。请提供推导和计算过程，在最终答案中仅报告$D$的值以供评分。$D$无舍入要求；如果计算中间数值，可以保留精确算术直到得出结论。最终报告的值不包括单位。",
            "solution": "本题要求推导并应用Tukey真实显著性差异（HSD）程序，以确定观测到的成对均值差异是否具有统计显著性。最终答案是一个指示变量$D$。\n\n分析始于单因素方差分析（ANOVA）模型，其形式如下：\n$$ y_{ij} = \\mu_i + \\epsilon_{ij} $$\n其中$y_{ij}$是第$i$个治疗组中第$j$个参与者的观测值，对于$i \\in \\{1, 2, 3, 4\\}$和$j \\in \\{1, 2, \\dots, 25\\}$。$\\mu_i$项表示第$i$个治疗组的真实均值。误差$\\epsilon_{ij}$假定为来自均值为$0$、方差为$\\sigma^2$的正态分布的独立同分布随机变量，即$\\epsilon_{ij} \\sim \\mathcal{N}(0, \\sigma^2)$。\n\n第$i$组的样本均值记为$\\bar{y}_i$。在ANOVA假定下，每个样本均值都服从正态分布，$\\bar{y}_i \\sim \\mathcal{N}(\\mu_i, \\sigma^2/n)$。Tukey HSD程序的目标是检验所有形如$H_{0,ij}: \\mu_i = \\mu_j$的成对原假设，同时将族系误差率（FWER）控制在指定的水平$\\alpha$。FWER是在所有比较中犯一个或多个I类错误的概率。\n\nTukey HSD程序基于学生化极差分布。用于比较任意一对均值$\\bar{y}_i$和$\\bar{y}_j$的统计量由下式给出：\n$$ q_{ij} = \\frac{|\\bar{y}_i - \\bar{y}_j|}{\\mathrm{SE}} $$\n其中$\\mathrm{SE}$是组均值的标准误。在ANOVA的背景下，来自所有组的合并方差，即均方误差（$\\mathrm{MSE}$），提供了对共同总体方差$\\sigma^2$的最佳估计。$\\mathrm{MSE}$定义为$\\mathrm{MSE} = \\hat{\\sigma}^2$，具有$\\nu$个自由度。对于一个有$k$个组，每组有$n$个受试者的平衡设计，误差自由度为$\\nu = k(n-1)$。此处，$\\nu = 4(25-1) = 96$，与提供的信息相符。\n\n单个组均值$\\bar{y}_i$的标准误估计为$\\sqrt{\\mathrm{MSE}/n}$。因此，检验统计量变为：\n$$ q_{ij} = \\frac{|\\bar{y}_i - \\bar{y}_j|}{\\sqrt{\\mathrm{MSE}/n}} $$\nTukey HSD程序规定，如果观测到的均值差异足够大，则应拒绝原假设$H_{0,ij}$。为了将FWER控制在$\\alpha$，我们将观测到的统计量与来自学生化极差分布的临界值$q_{\\alpha;k,\\nu}$进行比较。该临界值是参数为$k$（组数）和$\\nu$（误差自由度）的分布的$(1-\\alpha)$分位数。\n\n决策规则是，如果满足以下条件，则拒绝$H_{0,ij}$：\n$$ \\frac{|\\bar{y}_i - \\bar{y}_j|}{\\sqrt{\\mathrm{MSE}/n}} > q_{\\alpha;k,\\nu} $$\n我们可以重新整理这个不等式，以找出被认为具有统计显著性的两个均值之间的最小绝对差异。这个最小差异就是“真实显著性差异”（HSD），我们将其表示为$W_{Tukey}$：\n$$ W_{Tukey} = q_{\\alpha;k,\\nu} \\sqrt{\\frac{\\mathrm{MSE}}{n}} $$\n任何观测到的绝对均值差异$|\\bar{y}_i - \\bar{y}_j|$如果大于$W_{Tukey}$，则被宣布为具有统计显著性。\n\n现在，我们代入题目中提供的值：\n- 组数，$k = 4$。\n- 每组样本量，$n = 25$。\n- 合并误差均方，$\\mathrm{MSE} = 36$。\n- 误差自由度，$\\nu = 96$。\n- 族系误差率，$\\alpha = 0.05$。\n- 从学生化极差分布中得到的临界值被给出为$0.95$分位数，$q_{0.95;4,96} = 3.63$。这对应于我们$\\alpha=0.05$时的$q_{\\alpha;k,\\nu}$，因此$q_{0.05;4,96} = 3.63$。\n\n我们计算Tukey HSD阈值$W_{Tukey}$的值：\n$$ W_{Tukey} = 3.63 \\times \\sqrt{\\frac{36}{25}} $$\n$$ W_{Tukey} = 3.63 \\times \\frac{\\sqrt{36}}{\\sqrt{25}} $$\n$$ W_{Tukey} = 3.63 \\times \\frac{6}{5} $$\n$$ W_{Tukey} = 3.63 \\times 1.2 $$\n$$ W_{Tukey} = 4.356 $$\n\n决策阈值是$4.356$。题目陈述观测到的绝对均值差异为$9$。为了确定这个差异是否具有统计显著性，我们将其与计算出的阈值进行比较：\n$$ |\\bar{y}_i - \\bar{y}_j|_{obs} = 9 $$\n我们必须检查$9 > 4.356$是否成立。这个不等式是成立的。\n\n由于观测到的绝对均值差异$9$大于Tukey HSD阈值$4.356$，我们拒绝相应的原假设，并得出结论：该差异在族系误差率$\\alpha=0.05$下具有统计显著性。\n\n题目定义了一个指示变量$D$，如果差异是显著的，则$D=1$，否则$D=0$。根据我们的结论，该指示变量的值为$D=1$。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "方差分析的一个关键假设是方差齐性（homoscedasticity），即所有组的方差相等。在生物学数据中，组的方差常常与其均值相关，这会违反该假设，可能导致 F 检验结果失效。为了解决这个问题，我们可以采用方差稳定变换（variance-stabilizing transformations），例如 Box-Cox 变换。这项高级练习将带你深入了解真实世界数据分析中的一个关键环节：诊断并处理模型假设的违背。你将学习如何根据组均值与方差之间的关系来选择合适的数据变换，从而使方差分析的结果更加可靠和稳健()。",
            "id": "4935078",
            "problem": "一位生物统计研究员正在一项单因素设计中研究三个具有连续结果的独立处理组。单因素方差分析 (ANOVA) 模型假定，对于组别索引 $g \\in \\{1,2,3\\}$ 和受试者索引 $i \\in \\{1,\\dots,n_g\\}$，观测值满足 $Y_{gi} = \\mu_g + \\varepsilon_{gi}$，其中误差 $\\varepsilon_{gi}$ 在组内是独立同分布的，且 $E(\\varepsilon_{gi}) = 0$ 和 $Var(\\varepsilon_{gi}) = \\sigma_g^2$。经典的单因素方差分析假定方差齐性，即 $\\sigma_1^2 = \\sigma_2^2 = \\sigma_3^2$。在实践中，许多生物测量系统的方差依赖于均值，因此会应用方差稳定变换来寻求近似的方差齐性。\n\n假设存在形式为 $Var(Y \\mid \\text{group } g) \\approx c \\,\\mu_g^{p}$ 的均值-方差关系，其中常数 $c > 0$，指数 $p \\in \\mathbb{R}$。考虑由以下公式定义的 Box-Cox 变换族\n$$\ng_{\\lambda}(y) = \n\\begin{cases}\n\\dfrac{y^{\\lambda} - 1}{\\lambda},  \\lambda \\neq 0, \\\\\n\\log(y),  \\lambda = 0,\n\\end{cases}\n$$\n其中 $y > 0$。使用一阶泰勒（delta 方法）近似 $Var(g_{\\lambda}(Y)) \\approx \\left(g_{\\lambda}'(\\mu)\\right)^2 Var(Y)$，并以 $Var(g_{\\lambda}(Y))$ 在各组间近似恒定为目标，推导出推荐参数 $\\lambda$ 作为 $p$ 的函数。然后，给定观测到的组样本均值 $\\bar{y}_g$ 和样本方差 $s_g^2$，通过使用普通最小二乘法将 $\\log(s_g^2)$ 对 $\\log(\\bar{y}_g)$ 进行回归来估计 $p$，并将斜率作为 $\\hat{p}$。\n\n接下来，对每个组 $g$，使用 delta 方法近似变换后的均值 $E[g_{\\lambda}(Y)] \\approx g_{\\lambda}(\\bar{y}_g) + \\dfrac{1}{2} g_{\\lambda}''(\\bar{y}_g) s_g^2$ 和变换后的方差 $Var(g_{\\lambda}(Y)) \\approx \\left(g_{\\lambda}'(\\bar{y}_g)\\right)^2 s_g^2$。使用这些近似值，根据平方和的基本定义，计算变换前和变换后的单因素方差分析 $F$ 统计量及相关的上尾概率（p 值）：\n$$\nSS_{\\text{between}} = \\sum_{g=1}^{3} n_g \\left(\\bar{y}_g - \\bar{y}_{\\cdot}\\right)^2, \\quad \\bar{y}_{\\cdot} = \\dfrac{\\sum_{g=1}^{3} n_g \\bar{y}_g}{\\sum_{g=1}^{3} n_g},\n$$\n$$\nSS_{\\text{within}} = \\sum_{g=1}^{3} (n_g - 1) s_g^2,\n$$\n$$\nF = \\dfrac{MS_{\\text{between}}}{MS_{\\text{within}}}, \\quad MS_{\\text{between}} = \\dfrac{SS_{\\text{between}}}{3 - 1}, \\quad MS_{\\text{within}} = \\dfrac{SS_{\\text{within}}}{\\left(\\sum_{g=1}^{3} n_g\\right) - 3}.\n$$\n对于变换后的分析，在上述定义中，用近似的变换后均值替换 $\\bar{y}_g$，用近似的变换后方差替换 $s_g^2$。\n\n最后，使用最大组方差与最小组方差之比来量化变换前后的异方差性，即 $\\rho_{\\text{before}} = \\dfrac{\\max_g s_g^2}{\\min_g s_g^2}$ 和 $\\rho_{\\text{after}} = \\dfrac{\\max_g Var(g_{\\lambda}(Y))}{\\min_g Var(g_{\\lambda}(Y))}$，并报告变换后该比率是否减小。\n\n您的程序必须实现上述过程，并对以下三个测试用例运行，每个用例都包含组大小、样本均值和样本方差：\n- 测试用例 1：$n = [12, 15, 18]$，$\\bar{y} = [10.0, 20.0, 40.0]$，$s^2 = [4.0, 16.0, 64.0]$。\n- 测试用例 2：$n = [10, 12, 14]$，$\\bar{y} = [5.0, 10.0, 20.0]$，$s^2 = [5.0, 10.0, 20.0]$。\n- 测试用例 3：$n = [20, 22, 24]$，$\\bar{y} = [10.0, 12.0, 11.0]$，$s^2 = [9.0, 9.5, 10.0]$。\n\n对于每个测试用例，程序应：\n- 通过 $\\log(s_g^2)$ 对 $\\log(\\bar{y}_g)$ 的回归估计 $\\hat{p}$，并计算推荐的 $\\hat{\\lambda}$。\n- 计算 $\\rho_{\\text{before}}$ 和 $\\rho_{\\text{after}}$ 以及布尔指标 $\\text{improved} = (\\rho_{\\text{after}}  \\rho_{\\text{before}})$。\n- 计算 $F_{\\text{before}}$ 和 $F_{\\text{after}}$ 及其在具有相应自由度的 $F$ 分布下的 p 值（上尾概率）。\n\n所有数值结果必须表示为浮点数（四舍五入到 $6$ 位小数）或布尔值。您的程序应生成单行输出，其中包含一个结果列表，每个测试用例一个结果，每个结果都是列表\n$$\n[\\hat{\\lambda}, \\rho_{\\text{before}}, \\rho_{\\text{after}}, \\text{improved}, F_{\\text{before}}, p_{\\text{before}}, F_{\\text{after}}, p_{\\text{after}}].\n$$\n例如，整体输出格式必须为\n$$\n[[\\cdot,\\cdot,\\cdot,\\cdot,\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot,\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot,\\cdot,\\cdot,\\cdot,\\cdot]],\n$$\n不含额外文本。",
            "solution": "所提出的问题是应用生物统计学中一个定义明确且具有科学依据的练习，具体涉及单因素方差分析 (ANOVA) 和异方差性的处理。所提供的数据和程序步骤是完整且逻辑一致的，可以得出一个唯一且有意义的解。所有概念，包括 Box-Cox 变换、用于近似矩的 delta 方法以及 F 检验，都是该领域的标准方法。因此，该问题被认为是有效的。我们现在开始推导和计算策略。\n\n核心目标是在执行单因素方差分析之前，稳定多个组的方差。该过程涉及几个不同的理论和计算步骤。\n\n**1. 方差稳定变换参数 $\\lambda$ 的推导**\n\n我们从每个组 $g$ 内假定的均值-方差关系开始：\n$$\nVar(Y_g) \\approx c \\mu_g^p\n$$\n其中 $\\mu_g = E[Y_g]$ 是组 $g$ 的真实均值，$c  0$ 是一个常数，$p$ 是一个实值指数。目标是从 Box-Cox 族中找到一个变换 $g_{\\lambda}(y)$，使得变换后变量的方差 $Var(g_{\\lambda}(Y_g))$ 在各组间近似恒定，且独立于均值 $\\mu_g$。\n\nBox-Cox 变换定义为：\n$$\ng_{\\lambda}(y) = \n\\begin{cases}\n\\dfrac{y^{\\lambda} - 1}{\\lambda},  \\lambda \\neq 0, \\\\\n\\log(y),  \\lambda = 0.\n\\end{cases}\n$$\n使用一阶泰勒展开（delta 方法），变换后变量的方差可以近似为：\n$$\nVar(g_{\\lambda}(Y_g)) \\approx \\left( g_{\\lambda}'(\\mu_g) \\right)^2 Var(Y_g)\n$$\n代入假定的均值-方差关系，得到：\n$$\nVar(g_{\\lambda}(Y_g)) \\approx \\left( g_{\\lambda}'(\\mu_g) \\right)^2 c \\mu_g^p\n$$\n为了使这个方差对所有组都为常数（比如 $K$），依赖于 $\\mu_g$ 的项必须是常数。\n$$\n\\left( g_{\\lambda}'(\\mu_g) \\right)^2 \\mu_g^p = \\text{constant}\n$$\n这意味着 $g_{\\lambda}'(\\mu_g) \\propto \\mu_g^{-p/2}$。\n\n我们现在计算导数 $g_{\\lambda}'(y)$：\n- 如果 $\\lambda \\neq 0$，$g_{\\lambda}'(y) = \\dfrac{d}{dy}\\left(\\dfrac{y^{\\lambda} - 1}{\\lambda}\\right) = y^{\\lambda - 1}$。\n- 如果 $\\lambda = 0$，$g_{\\lambda}'(y) = \\dfrac{d}{dy}(\\log(y)) = y^{-1}$。\n\n令指数相等：\n- 对于 $\\lambda \\neq 0$，我们需要 $y^{\\lambda - 1} \\propto y^{-p/2}$。这意味着 $\\lambda - 1 = -p/2$，这得出 $\\lambda = 1 - p/2$。\n- 对于 $\\lambda = 0$，我们有 $y^{-1} \\propto y^{-p/2}$。这意味着 $-1 = -p/2$，这得出 $p=2$。注意，如果 $p=2$，我们的通用公式给出 $\\lambda = 1 - 2/2 = 0$，这是一致的。\n\n因此，推荐的 Box-Cox 参数 $\\lambda$ 是均值-方差指数 $p$ 的一个简单函数：\n$$\n\\lambda = 1 - \\frac{p}{2}\n$$\n\n**2. 指数 $p$ 的估计**\n\n在实践中，$p$ 是未知的，必须从观测数据中估计。关系式 $s_g^2 \\approx c \\bar{y}_g^p$ 可以通过取对数来线性化：\n$$\n\\log(s_g^2) \\approx \\log(c) + p \\log(\\bar{y}_g)\n$$\n这表明 $p$ 可以通过将 $\\log(s_g^2)$ 对 $\\log(\\bar{y}_g)$ 进行简单线性回归得到的斜率来估计。对于一组 $G=3$ 个组，斜率 $\\hat{p}$ 的普通最小二乘 (OLS) 估计量是：\n$$\n\\hat{p} = \\frac{\\sum_{g=1}^{3} (\\log(\\bar{y}_g) - \\overline{\\log y})(\\log(s_g^2) - \\overline{\\log s^2})}{\\sum_{g=1}^{3} (\\log(\\bar{y}_g) - \\overline{\\log y})^2}\n$$\n其中 $\\overline{\\log y}$ 和 $\\overline{\\log s^2}$ 分别是对数变换后的样本均值和样本方差的均值。一旦获得 $\\hat{p}$，估计的变换参数就是 $\\hat{\\lambda} = 1 - \\hat{p}/2$。\n\n**3. 变换后矩的二阶近似**\n\n对于后续的方差分析，我们需要变换后数据的均值和方差的近似值。使用二阶泰勒展开，可以得到一个更精确的均值近似：\n$$\n\\mu_{g, \\text{trans}} = E[g_{\\hat{\\lambda}}(Y_g)] \\approx g_{\\hat{\\lambda}}(\\bar{y}_g) + \\frac{1}{2} g_{\\hat{\\lambda}}''(\\bar{y}_g) s_g^2\n$$\n方差的一阶近似按规定使用：\n$$\n\\sigma_{g, \\text{trans}}^2 = Var(g_{\\hat{\\lambda}}(Y_g)) \\approx \\left( g_{\\hat{\\lambda}}'(\\bar{y}_g) \\right)^2 s_g^2\n$$\n所需的二阶导数是：\n- 如果 $\\hat{\\lambda} \\neq 0$，$g_{\\hat{\\lambda}}''(y) = (\\hat{\\lambda}-1)y^{\\hat{\\lambda}-2}$。\n- 如果 $\\hat{\\lambda} = 0$，$g_{\\hat{\\lambda}}''(y) = -y^{-2}$。\n\n**4. ANOVA F 检验计算**\n\n单因素方差分析 F 统计量是组间均方与组内均方之比。设 $k=3$ 为组数，$N = \\sum_{g=1}^k n_g$ 为总样本量。\n\n**变换前：**\n统计量基于原始样本矩 $\\bar{y}_g$ 和 $s_g^2$。\n- 总均值：$\\bar{y}_{\\cdot} = \\frac{1}{N} \\sum_{g=1}^{k} n_g \\bar{y}_g$\n- 组间平方和：$SS_{\\text{between}} = \\sum_{g=1}^{k} n_g (\\bar{y}_g - \\bar{y}_{\\cdot})^2$\n- 组内平方和：$SS_{\\text{within}} = \\sum_{g=1}^{k} (n_g - 1) s_g^2$\n- 组间均方：$MS_{\\text{between}} = SS_{\\text{between}} / (k - 1)$\n- 组内均方：$MS_{\\text{within}} = SS_{\\text{within}} / (N - k)$\n- F 统计量：$F_{\\text{before}} = MS_{\\text{between}} / MS_{\\text{within}}$\n- p 值 $p_{\\text{before}}$ 是上尾概率 $P(F_{k-1, N-k} \\ge F_{\\text{before}})$。\n\n**变换后：**\n应用相同的公式，但使用近似的变换后矩 $\\mu_{g, \\text{trans}}$ 和 $\\sigma_{g, \\text{trans}}^2$。\n- 变换后总均值：$\\bar{\\mu}_{\\cdot, \\text{trans}} = \\frac{1}{N} \\sum_{g=1}^{k} n_g \\mu_{g, \\text{trans}}$\n- $SS_{\\text{between, after}} = \\sum_{g=1}^{k} n_g (\\mu_{g, \\text{trans}} - \\bar{\\mu}_{\\cdot, \\text{trans}})^2$\n- $SS_{\\text{within, after}} = \\sum_{g=1}^{k} (n_g - 1) \\sigma_{g, \\text{trans}}^2$\n- 类似地计算 F 统计量 $F_{\\text{after}}$ 和 p 值 $p_{\\text{after}}$。\n\n**5. 量化异方差性**\n\n异方差性的程度通过最大组方差与最小组方差之比来量化。\n- 变换前：$\\rho_{\\text{before}} = \\max_g(s_g^2) / \\min_g(s_g^2)$\n- 变换后：$\\rho_{\\text{after}} = \\max_g(\\sigma_{g, \\text{trans}}^2) / \\min_g(\\sigma_{g, \\text{trans}}^2)$\n变换在减少方差异质性方面的成功与否，通过布尔指标 $\\text{improved} = (\\rho_{\\text{after}}  \\rho_{\\text{before}})$ 来评估。\n\n程序将为每个提供的测试用例实现这整个计算序列。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Implements the full biostatistical analysis procedure for one-way ANOVA\n    with variance stabilization as described in the problem.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'n': [12, 15, 18], 'y_bar': [10.0, 20.0, 40.0], 's_sq': [4.0, 16.0, 64.0]},\n        {'n': [10, 12, 14], 'y_bar': [5.0, 10.0, 20.0], 's_sq': [5.0, 10.0, 20.0]},\n        {'n': [20, 22, 24], 'y_bar': [10.0, 12.0, 11.0], 's_sq': [9.0, 9.5, 10.0]},\n    ]\n    \n    # Use a small tolerance to check if lambda is close to zero\n    LAMBDA_ZERO_TOL = 1e-9\n\n    def g_lambda(y, lam):\n        if abs(lam)  LAMBDA_ZERO_TOL:\n            return np.log(y)\n        else:\n            return (y**lam - 1) / lam\n\n    def g_lambda_prime(y, lam):\n        if abs(lam)  LAMBDA_ZERO_TOL:\n            return 1 / y\n        else:\n            return y**(lam - 1)\n\n    def g_lambda_double_prime(y, lam):\n        if abs(lam)  LAMBDA_ZERO_TOL:\n            return -1 / y**2\n        else:\n            return (lam - 1) * y**(lam - 2)\n\n    def perform_anova(n, means, variances):\n        \"\"\"Helper function to compute ANOVA F-statistic and p-value.\"\"\"\n        k = len(n)\n        N = np.sum(n)\n        \n        # Grand mean\n        grand_mean = np.sum(n * means) / N\n        \n        # Sum of squares\n        ss_between = np.sum(n * (means - grand_mean)**2)\n        ss_within = np.sum((n - 1) * variances)\n        \n        # Degrees of freedom\n        df_between = k - 1\n        df_within = N - k\n        \n        # Mean squares\n        if df_between == 0:\n            ms_between = 0\n        else:\n            ms_between = ss_between / df_between\n        \n        if df_within == 0:\n            ms_within = 0\n        else:\n            ms_within = ss_within / df_within\n        \n        # F-statistic and p-value\n        if ms_within == 0: # Avoid division by zero, though unlikely\n            f_stat = np.inf if ms_between > 0 else 0\n            p_val = 0.0 if ms_between > 0 else 1.0\n        else:\n            f_stat = ms_between / ms_within\n            p_val = stats.f.sf(f_stat, df_between, df_within)\n            \n        return f_stat, p_val\n\n    all_results = []\n    \n    for case in test_cases:\n        n = np.array(case['n'])\n        y_bar = np.array(case['y_bar'])\n        s_sq = np.array(case['s_sq'])\n        \n        # Step 1: Estimate p and lambda\n        log_y_bar = np.log(y_bar)\n        log_s_sq = np.log(s_sq)\n        \n        # Handle case where all log_y_bar are the same to avoid division by zero in polyfit\n        if np.all(log_y_bar == log_y_bar[0]):\n            p_hat = 0.0\n        else:\n            p_hat = np.polyfit(log_y_bar, log_s_sq, 1)[0]\n        lambda_hat = 1 - p_hat / 2\n        \n        # Step 2: ANOVA before transformation\n        f_before, p_before = perform_anova(n, y_bar, s_sq)\n        \n        # Step 3: Compute transformed moments\n        mu_trans = g_lambda(y_bar, lambda_hat) + 0.5 * g_lambda_double_prime(y_bar, lambda_hat) * s_sq\n        sigma_sq_trans = (g_lambda_prime(y_bar, lambda_hat)**2) * s_sq\n        \n        # Step 4: ANOVA after transformation\n        f_after, p_after = perform_anova(n, mu_trans, sigma_sq_trans)\n        \n        # Step 5: Quantify heteroscedasticity\n        rho_before = np.max(s_sq) / np.min(s_sq) if np.min(s_sq) > 0 else np.inf\n        rho_after = np.max(sigma_sq_trans) / np.min(sigma_sq_trans) if np.min(sigma_sq_trans) > 0 else np.inf\n        improved = bool(rho_after  rho_before)\n        \n        # Step 6: Assemble results\n        case_results = [\n            lambda_hat,\n            rho_before,\n            rho_after,\n            improved,\n            f_before,\n            p_before,\n            f_after,\n            p_after\n        ]\n        all_results.append(case_results)\n        \n    # Final formatting of the output string to match the required format precisely\n    # without extra spaces and with specified rounding.\n    output_str = \"[\"\n    for i, row in enumerate(all_results):\n        row_str = \"[\"\n        for j, item in enumerate(row):\n            if isinstance(item, bool):\n                row_str += str(item).lower()\n            else:\n                row_str += f\"{item:.6f}\"\n            if j  len(row) - 1:\n                row_str += \",\"\n        row_str += \"]\"\n        output_str += row_str\n        if i  len(all_results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n    \n    # The problem asks for the output on a single line\n    print(output_str.replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}