{
    "hands_on_practices": [
        {
            "introduction": "本练习是评估任何诊断测试的基石。我们将从一个典型的$2 \\times 2$混淆矩阵开始，计算四个基本的性能指标：灵敏度、特异性、假阳性率和假阴性率。这个实践将巩固你对这些核心定义的理解，并让你学会辨别哪些指标是测试固有的属性，独立于研究人群中的疾病患病率 。",
            "id": "4332588",
            "problem": "为在精准肿瘤学背景下检测一种致病性变异，我们对一种靶向二代测序分析方法进行了评估。在一项多中心病例-对照评估中，样本被该分析方法分类为阳性或阴性，并由一种金标准正交方法确定其真实的变异状态。设真阳性计数为 $TP = 48$，假阴性计数为 $FN = 12$，假阳性计数为 $FP = 18$，真阴性计数为 $TN = 122$。仅使用条件概率和二元分类中错误率的基本定义，计算以下四个性能特征：灵敏度、特异度、假阳性率和假阴性率。然后，使用关于回顾性（病例-对照）抽样下条件概率的第一性原理进行论证，确定这四个量中哪些在病例-对照抽样下对于疾病患病率是不变的。\n\n将最终答案以单行矩阵的形式报告，顺序为 $\\bigl(\\text{灵敏度},\\ \\text{特异度},\\ \\text{假阳性率},\\ \\text{假阴性率},\\ I_{\\text{灵敏度}},\\ I_{\\text{特异度}},\\ I_{\\text{假阳性率}},\\ I_{\\text{假阴性率}}\\bigr)$，其中如果某个量在病例-对照抽样下是患病率不变的，则 $I_{\\cdot}$ 为 $1$，否则为 $0$。将这四个率表示为精确的既约分数。不允许四舍五入。不变性指标必须报告为精确整数 $0$ 或 $1$。",
            "solution": "该问题陈述经评估具有科学依据、提法恰当、客观且自洽。计算所需的所有数据均已提供，所涉及的概念是统计学和临床诊断学的基础。因此，该问题是有效的。\n\n设 $D^+$ 为个体携带致病性变异（为病例）的事件， $D^-$ 为个体不携带该变异（为对照）的事件。设 $T^+$ 为分析结果为阳性的事件， $T^-$ 为分析结果为阴性的事件。\n\n提供的数据是二元分类混淆矩阵中四种可能结果的计数：\n- 真阳性 ($TP$)：携带变异且检测结果为阳性的个体数量。$TP = 48$。\n- 假阴性 ($FN$)：携带变异但检测结果为阴性的个体数量。$FN = 12$。\n- 假阳性 ($FP$)：不携带变异但检测结果为阳性的个体数量。$FP = 18$。\n- 真阴性 ($TN$)：不携带变异且检测结果为阴性的个体数量。$TN = 122$。\n\n根据这些计数，我们可以确定研究中病例和对照的总数：\n- 病例总数（携带变异的个体）：$P = TP + FN = 48 + 12 = 60$。\n- 对照总数（不携带变异的个体）：$N = FP + TN = 18 + 122 = 140$。\n\n这四个性能特征根据它们作为条件概率的定义进行计算。\n\n1.  **灵敏度（真阳性率, $TPR$）**\n    灵敏度是在个体确实携带变异的条件下，检测结果为阳性的概率。它衡量了该检测方法识别真病例的能力。\n    $$ \\text{灵敏度} = P(T^+ | D^+) = \\frac{\\text{具有 } T^+ \\text{ 和 } D^+ \\text{ 的个体数}}{\\text{具有 } D^+ \\text{ 的个体总数}} = \\frac{TP}{TP + FN} $$\n    代入给定值：\n    $$ \\text{灵敏度} = \\frac{48}{48 + 12} = \\frac{48}{60} = \\frac{4 \\times 12}{5 \\times 12} = \\frac{4}{5} $$\n\n2.  **特异度（真阴性率, $TNR$）**\n    特异度是在个体确实不携带变异的条件下，检测结果为阴性的概率。它衡量了该检测方法识别真非病例的能力。\n    $$ \\text{特异度} = P(T^- | D^-) = \\frac{\\text{具有 } T^- \\text{ 和 } D^- \\text{ 的个体数}}{\\text{具有 } D^- \\text{ 的个体总数}} = \\frac{TN}{TN + FP} $$\n    代入给定值：\n    $$ \\text{特异度} = \\frac{122}{122 + 18} = \\frac{122}{140} = \\frac{61 \\times 2}{70 \\times 2} = \\frac{61}{70} $$\n\n3.  **假阳性率 ($FPR$)**\n    假阳性率是在个体确实不携带变异的条件下，检测结果为阳性的概率。这是一种I类错误率。\n    $$ FPR = P(T^+ | D^-) = \\frac{\\text{具有 } T^+ \\text{ 和 } D^- \\text{ 的个体数}}{\\text{具有 } D^- \\text{ 的个体总数}} = \\frac{FP}{FP + TN} $$\n    它在定义上也与特异度相关：$FPR = 1 - \\text{特异度}$。\n    代入给定值：\n    $$ FPR = \\frac{18}{18 + 122} = \\frac{18}{140} = \\frac{9 \\times 2}{70 \\times 2} = \\frac{9}{70} $$\n\n4.  **假阴性率 ($FNR$)**\n    假阴性率是在个体确实携带变异的条件下，检测结果为阴性的概率。这是一种II类错误率。\n    $$ FNR = P(T^- | D^+) = \\frac{\\text{具有 } T^- \\text{ 和 } D^+ \\text{ 的个体数}}{\\text{具有 } D^+ \\text{ 的个体总数}} = \\frac{FN}{TP + FN} $$\n    它在定义上也与灵敏度相关：$FNR = 1 - \\text{灵敏度}$。\n    代入给定值：\n    $$ FNR = \\frac{12}{48 + 12} = \\frac{12}{60} = \\frac{1 \\times 12}{5 \\times 12} = \\frac{1}{5} $$\n\n接下来，我们必须确定在病例-对照抽样下，这些量中哪些对疾病患病率是不变的。\n\n病例-对照研究是一种回顾性研究设计，其中受试者是根据其已知的结局状态来选择的。在这里，一组“病例”（携带变异的个体，$D^+$）和一组“对照”（不携带变异的个体，$D^-$）被召集起来。研究样本中病例与对照的比例是由研究设计决定的，而不是由人群中疾病的自然患病率决定的。患病率 $\\pi = P(D^+)$ 是指在可能从中抽取研究样本的普通人群中患有该疾病的先验概率。在病例-对照设计中，样本患病率是人为固定的，并不是 $\\pi$ 的估计值。\n\n我们根据这种抽样方案来分析这四个指标的定义：\n\n-   **灵敏度, $P(T^+|D^+)$**: 这个概率是以事件 $D^+$ 为条件的。计算 $\\frac{TP}{TP+FN}$ 完全在病例组内进行。由于灵敏度的估计仅依赖于已知患病的受试者，因此它与研究中包含了多少未患病的受试者无关。因此，灵敏度是检测方法在患病人群中性能的内在特征，并且对普通人群中的疾病患病率是**不变的**。指标 $I_{\\text{灵敏度}}$ 为 $1$。\n\n-   **特异度, $P(T^-|D^-)$**: 这个概率是以事件 $D^-$ 为条件的。计算 $\\frac{TN}{TN+FP}$ 完全在对照组内进行。与灵敏度类似，特异度的估计仅依赖于已知无病的受试者。因此，它是检测方法在非患病人群中性能的内在特征，并且对疾病患病率是**不变的**。指标 $I_{\\text{特异度}}$ 为 $1$。\n\n-   **假阳性率, $P(T^+|D^-)$**: 这个概率也是以事件 $D^-$ 为条件的。其计算 $\\frac{FP}{FP+TN}$ 完全在对照组内进行。由于它就是 $1 - \\text{特异度}$，它具有相同的性质。FPR对疾病患病率是**不变的**。指标 $I_{\\text{假阳性率}}$ 为 $1$。\n\n-   **假阴性率, $P(T^-|D^+)$**: 这个概率也是以事件 $D^+$ 为条件的。其计算 $\\frac{FN}{TP+FN}$ 完全在病例组内进行。由于它就是 $1 - \\text{灵敏度}$，它也具有相同的性质。FNR对疾病患病率是**不变的**。指标 $I_{\\text{假阴性率}}$ 为 $1$。\n\n总之，所有四个指标——灵敏度、特异度、假阳性率和假阴性率——都由以真实疾病状态为条件的概率定义。病例-对照研究设计之所以能够直接估计这些量，正是因为它从患病和非患病的独立分层中抽样。这些指标是检测方法本身的属性，而不是其使用人群的属性。相比之下，像阳性预测值（$PPV = P(D^+|T^+)$）和阴性预测值（$NPV = P(D^-|T^-)$）这样的指标，通过贝叶斯定理，严重依赖于患病率 $\\pi = P(D^+)$，并且在没有关于 $\\pi$ 的外部知识的情况下，无法从病例-对照研究中直接估计。\n\n计算出的值及其不变性指标如下：\n- 灵敏度: $\\frac{4}{5}$，不变 ($I=1$)\n- 特异度: $\\frac{61}{70}$，不变 ($I=1$)\n- 假阳性率: $\\frac{9}{70}$，不变 ($I=1$)\n- 假阴性率: $\\frac{1}{5}$，不变 ($I=1$)\n\n最终答案按指定顺序以单行矩阵的形式呈现。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{4}{5}  \\frac{61}{70}  \\frac{9}{70}  \\frac{1}{5}  1  1  1  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "灵敏度和特异性描述了测试本身的性能，但临床医生和患者更关心的是一个具体的测试结果意味着什么。本练习将运用贝叶斯定理来计算阳性预测值和阴性预测值，以回答“鉴于我的测试结果，我确实患病的概率是多少？”这个问题。你将亲身体会到，在筛查罕见疾病时，低患病率如何极大地影响一个阳性结果的可信度，这是公共卫生和临床决策中的一个关键概念 。",
            "id": "4908588",
            "problem": "一家生物技术公司正在评估一种新的基于血液的筛查方法，用于在无症状成年人群中筛查一种罕见的遗传性疾病。设 $D$ 表示随机选择的个体患有该疾病的事件，设 $T^{+}$ 和 $T^{-}$ 分别表示筛查测试结果为阳性和阴性。该筛查方法的灵敏度为 $\\operatorname{Se}=P(T^{+}\\mid D)=0.95$，特异性为 $\\operatorname{Sp}=P(T^{-}\\mid D^{c})=0.90$，并且该疾病在目标筛查人群中的患病率为 $\\pi=P(D)=0.01$。\n\n从灵敏度、特异性和患病率的定义出发，仅使用概率公理、贝叶斯定理和全概率定律，推导阳性预测值 (PPV) $P(D\\mid T^{+})$ 和阴性预测值 (NPV) $P(D^{c}\\mid T^{-})$ 的表达式。然后，使用给定的数值 $\\operatorname{Se}=0.95$, $\\operatorname{Sp}=0.90$, and $\\pi=0.01$ 对这些表达式进行数值计算。\n\n最后，在罕见病筛查的背景下，对计算出的 $P(D\\mid T^{+})$ 和 $P(D^{c}\\mid T^{-})$ 进行简要解释，重点关注低患病率如何影响阳性与阴性结果的可信度。\n\n将每个最终数值结果四舍五入至四位有效数字，并以一个二元行向量 $\\big(\\operatorname{PPV},\\operatorname{NPV}\\big)$ 的形式报告，不带单位。",
            "solution": "首先验证问题，以确保其科学基础扎实、提法恰当且客观。\n\n**步骤1：提取已知条件**\n问题提供了以下定义和数值：\n- $D$：随机选择的个体患有该疾病的事件。\n- $D^c$：随机选择的个体不患有该疾病的事件。\n- $T^{+}$：筛查测试结果为阳性的事件。\n- $T^{-}$：筛查测试结果为阴性的事件。\n- 灵敏度：$\\operatorname{Se} = P(T^{+} \\mid D) = 0.95$。\n- 特异性：$\\operatorname{Sp} = P(T^{-} \\mid D^c) = 0.90$。\n- 患病率：$\\pi = P(D) = 0.01$。\n\n目标是推导阳性预测值 $\\operatorname{PPV} = P(D \\mid T^{+})$ 和阴性预测值 $\\operatorname{NPV} = P(D^c \\mid T^{-})$ 的表达式，对其进行数值计算，并提供解释。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题是贝叶斯概率在诊断测试评估中的标准应用，这是生物统计学和流行病学的核心课题。\n- **科学基础扎实：** 灵敏度、特异性、患病率、PPV和NPV的概念是医学诊断学中基本且公认的原则。所提供的值（$\\operatorname{Se}=0.95$, $\\operatorname{Sp}=0.90$, $\\pi=0.01$）对于罕见病的筛查测试是符合实际的。\n- **提法恰当：** 问题陈述清晰，为推导和计算所需概率提供了所有必要信息。待计算的量由已知条件唯一确定。\n- **客观性：** 问题以精确、客观和标准的数学语言表述，没有歧义或主观论断。\n\n**步骤3：结论与行动**\n问题陈述有效。求解过程将首先推导PPV和NPV的一般符号表达式，然后代入给定的数值。\n\n**阳性预测值 (PPV) 的推导**\n阳性预测值是指在测试结果为阳性的条件下，个体确实患有该疾病的概率，记为 $P(D \\mid T^{+})$。我们使用贝叶斯定理来表示这个量：\n$$ \\operatorname{PPV} = P(D \\mid T^{+}) = \\frac{P(T^{+} \\mid D) P(D)}{P(T^{+})} $$\n分母 $P(T^{+})$ 是测试结果为阳性的总概率。我们可以使用全概率定律，在样本空间划分为患病者 ($D$) 和非患病者 ($D^c$) 的基础上展开此项：\n$$ P(T^{+}) = P(T^{+} \\mid D) P(D) + P(T^{+} \\mid D^c) P(D^c) $$\n我们可以得到或推导出此展开式中的每一项：\n- $P(T^{+} \\mid D) = \\operatorname{Se}$ (灵敏度)\n- $P(D) = \\pi$ (患病率)\n- $P(D^c) = 1 - P(D) = 1 - \\pi$ (补集概率公理)\n- $P(T^{+} \\mid D^c)$ 是无病个体测试结果为阳性的概率（假阳性率）。它是特异性的补集，因为对于给定的疾病状态，测试结果必须是阳性或阴性。因此，$P(T^{+} \\mid D^c) = 1 - P(T^{-} \\mid D^c) = 1 - \\operatorname{Sp}$。\n\n将这些代入 $P(T^{+})$ 的表达式中：\n$$ P(T^{+}) = (\\operatorname{Se})(\\pi) + (1 - \\operatorname{Sp})(1 - \\pi) $$\n现在，将整个表达式代回PPV的公式中：\n$$ \\operatorname{PPV} = \\frac{(\\operatorname{Se})(\\pi)}{(\\operatorname{Se})(\\pi) + (1 - \\operatorname{Sp})(1 - \\pi)} $$\n这就是用灵敏度、特异度和患病率表示的阳性预测值的一般表达式。\n\n**阴性预测值 (NPV) 的推导**\n阴性预测值是在测试结果为阴性的条件下，个体确实没有患该疾病的概率，记为 $P(D^c \\mid T^{-})$。再次应用贝叶斯定理：\n$$ \\operatorname{NPV} = P(D^c \\mid T^{-}) = \\frac{P(T^{-} \\mid D^c) P(D^c)}{P(T^{-})} $$\n分母 $P(T^{-})$ 是测试结果为阴性的总概率。使用全概率定律：\n$$ P(T^{-}) = P(T^{-} \\mid D^c) P(D^c) + P(T^{-} \\mid D) P(D) $$\n我们确定各项：\n- $P(T^{-} \\mid D^c) = \\operatorname{Sp}$ (特异性)\n- $P(D^c) = 1 - \\pi$\n- $P(D) = \\pi$\n- $P(T^{-} \\mid D)$ 是患病个体测试结果为阴性的概率（假阴性率）。它是灵敏度的补集：$P(T^{-} \\mid D) = 1 - P(T^{+} \\mid D) = 1 - \\operatorname{Se}$。\n\n将这些代入 $P(T^{-})$ 的表达式中：\n$$ P(T^{-}) = (\\operatorname{Sp})(1 - \\pi) + (1 - \\operatorname{Se})(\\pi) $$\n现在，将此代回NPV的公式中：\n$$ \\operatorname{NPV} = \\frac{(\\operatorname{Sp})(1 - \\pi)}{(\\operatorname{Sp})(1 - \\pi) + (1 - \\operatorname{Se})(\\pi)} $$\n这就是阴性预测值的一般表达式。\n\n**数值计算**\n我们代入给定值：$\\operatorname{Se} = 0.95$, $\\operatorname{Sp} = 0.90$, and $\\pi = 0.01$。\n\n对于 PPV：\n$$ \\operatorname{PPV} = \\frac{(0.95)(0.01)}{(0.95)(0.01) + (1 - 0.90)(1 - 0.01)} = \\frac{0.0095}{0.0095 + (0.10)(0.99)} = \\frac{0.0095}{0.0095 + 0.099} = \\frac{0.0095}{0.1085} $$\n$$ \\operatorname{PPV} \\approx 0.087557603... $$\n四舍五入至四位有效数字，$\\operatorname{PPV} \\approx 0.08756$。\n\n对于 NPV：\n$$ \\operatorname{NPV} = \\frac{(0.90)(1 - 0.01)}{(0.90)(1 - 0.01) + (1 - 0.95)(0.01)} = \\frac{(0.90)(0.99)}{(0.90)(0.99) + (0.05)(0.01)} = \\frac{0.891}{0.891 + 0.0005} = \\frac{0.891}{0.8915} $$\n$$ \\operatorname{NPV} \\approx 0.999439147... $$\n四舍五入至四位有效数字，$\\operatorname{NPV} \\approx 0.9994$。\n\n**解释**\n计算出的阳性预测值为 $\\operatorname{PPV} \\approx 0.08756$。这意味着如果该人群中的某个人收到阳性测试结果，他们实际患有该疾病的几率仅为 $8.756\\%$。尽管该测试具有高灵敏度（$\\operatorname{Se}=0.95$），但阳性结果是假阳性的可能性远大于真阳性。这个与直觉相悖的结果是该疾病低患病率（$\\pi=0.01$）的直接后果。因为这种疾病很罕见，所以测试结果为阳性的健康个体（假阳性，由 $1-\\operatorname{Sp}$ 决定）的绝对数量远远超过测试结果为阳性的患病个体（真阳性，由 $\\operatorname{Se}$ 决定）的绝对数量。具体来说，在一个10万人的群体中，有1000人患有该疾病，99000人没有。该测试将识别出 $1000 \\times 0.95 = 950$ 个真阳性病例和 $99000 \\times (1-0.90) = 9900$ 个假阳性病例。因此，PPV为 $950 / (950 + 9900) \\approx 0.08756$。\n\n计算出的阴性预测值为 $\\operatorname{NPV} \\approx 0.9994$。这意味着如果一个人收到阴性测试结果，他们确实没有患该疾病的几率为 $99.94\\%$。此筛查测试的阴性结果非常可靠。\n\n总之，对于罕见病的筛查，阴性结果高度可信，能有效排除该病症。然而，阳性结果本身的可信度较低，不应被解释为诊断，而应被视为需要进行进一步、更具特异性（且通常更具侵入性或更昂贵）的确诊性诊断测试的指征。这种现象被称为“基础率谬误”。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.08756  0.9994\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "为了对诊断准确性建立更动态、更直观的理解，我们可以借助计算机模拟。在这个实践中，你将使用正态分布来为患病和非患病群体的诊断分数建模。你的任务是编写一个程序，探索这两组人群分布的分离程度如何影响灵敏度、特异性以及ROC曲线下面积（AUC）等关键性能指标。通过构建并运行此模拟，你将对潜在的统计分布与测试的整体诊断能力之间的关系有更深刻的认识 。",
            "id": "4908600",
            "problem": "给定两种疾病状态下的连续诊断评分分布：$S \\mid D=1$ 代表患病受试者，$S \\mid D=0$ 代表非患病受试者。两种分布均假定为正态（高斯）分布，其均值分别为 $\\mu_1$ 和 $\\mu_0$，标准差分别为 $\\sigma_1$ 和 $\\sigma_0$。一个二元决策规则将评分 $S \\ge t$（其中 $t$ 为阈值）的受试者分类为检测阳性，否则分类为检测阴性。本问题的基础包含以下定义：灵敏度（真阳性率）为 $\\operatorname{Se}(t) = \\mathbb{P}(S \\ge t \\mid D=1)$，特异度（真阴性率）为 $\\operatorname{Sp}(t) = \\mathbb{P}(S  t \\mid D=0)$，以及受试者工作特征（ROC）曲线下面积（AUC）为概率 $\\mathbb{P}(S_1  S_0)$，其中 $S_1 \\sim S \\mid D=1$ 和 $S_0 \\sim S \\mid D=0$ 是独立的。\n\n设计一个模拟实验，以探究在正态模型下，改变 $S \\mid D=1$ 和 $S \\mid D=0$ 之间的区分度如何影响 $\\operatorname{Se}$、$\\operatorname{Sp}$ 和 AUC。你的程序必须：\n\n- 对于每组参数，从 $S \\mid D=1 \\sim \\mathcal{N}(\\mu_1,\\sigma_1^2)$ 中模拟 $n_1$ 个独立样本，并从 $S \\mid D=0 \\sim \\mathcal{N}(\\mu_0,\\sigma_0^2)$ 中模拟 $n_0$ 个独立样本。\n- 在覆盖合并样本范围的阈值网格上，选择使约登指数 $J(t) = \\operatorname{Se}(t) + \\operatorname{Sp}(t) - 1$ 最大化的阈值 $t^\\ast$。必须在整个经验范围内的 $K$ 个点的均匀网格上评估阈值；取 $K$ 为 $1001$。\n- 使用模拟数据，在 $t^\\ast$ 处以比例的形式经验性地估计 $\\operatorname{Se}$ 和 $\\operatorname{Sp}$。\n- 使用从合并样本的秩次计算出的 Mann–Whitney 概率解释 $\\mathbb{P}(S_1  S_0)$ 来经验性地估计 AUC（将 AUC 表示为小数，而非百分比）。\n- 为每个测试用例使用固定的随机种子以保证可复现性。\n\n所有答案均以小数表示。不涉及物理单位。你的程序的最终输出必须是单行，包含一个由方括号括起来的逗号分隔列表。列表中的每个元素本身必须是一个包含三个浮点数的列表 $[\\operatorname{Se},\\operatorname{Sp},\\mathrm{AUC}]$，每个浮点数四舍五入到恰好四位小数，行内任何地方都不能有空格。例如，格式必须像这样：$[[0.5000,0.5000,0.5000],[0.8000,0.7000,0.8500]]$。\n\n测试套件（每个用例为 $(\\mu_1,\\mu_0,\\sigma_1,\\sigma_0,n_1,n_0,\\text{seed})$）：\n- 用例 1：$(0,0,1,1,50000,50000,1)$，无区分度的边界条件。\n- 用例 2：$(1,0,1,1,50000,50000,2)$，方差相等，中等区分度。\n- 用例 3：$(2,0,1,1,50000,50000,3)$，方差相等，较大区分度。\n- 用例 4：$(1,0,1.5,1,50000,50000,4)$，方差不等，中等均值区分度。\n- 用例 5：$(4,0,1,1,50000,50000,5)$，方差相等，极大区分度。\n\n你的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表，格式严格为 $[[\\operatorname{Se}_1,\\operatorname{Sp}_1,\\mathrm{AUC}_1],[\\operatorname{Se}_2,\\operatorname{Sp}_2,\\mathrm{AUC}_2],\\dots,]$, 每个数值项四舍五入到四位小数且无空格。",
            "solution": "该问题要求设计一个数值模拟，以评估在双正态模型下诊断测试的性能。该性能通过灵敏度（$\\operatorname{Se}$）、特异度（$\\operatorname{Sp}$）和受试者工作特征（ROC）曲线下面积（AUC）来量化。该模拟将探究当基础评分分布的参数变化时，这些指标如何随之改变。\n\n### 1. 问题阐述与统计模型\n\n问题的核心在于诊断评分的统计建模。我们已知患病受试者 $S \\mid D=1$ 和非患病受试者 $S \\mid D=0$ 的评分遵循正态（高斯）分布：\n$$\nS \\mid D=1 \\sim \\mathcal{N}(\\mu_1, \\sigma_1^2) \\\\\nS \\mid D=0 \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)\n$$\n如果受试者的评分 $S$ 超过某个阈值 $t$（即 $S \\ge t$），则被分类为阳性。否则，被分类为阴性。\n\n### 2. 性能指标\n此分类规则的质量通过三个标准指标进行评估：\n\n-   **灵敏度（$\\operatorname{Se}$）**：正确识别患病受试者的概率。即真阳性率。\n    $$\n    \\operatorname{Se}(t) = \\mathbb{P}(S \\ge t \\mid D=1)\n    $$\n\n-   **特异度（$\\operatorname{Sp}$）**：正确识别非患病受试者的概率。即真阴性率。\n    $$\n    \\operatorname{Sp}(t) = \\mathbb{P}(S  t \\mid D=0)\n    $$\n\n-   **ROC 曲线下面积（AUC）**：ROC 曲线是对于所有可能的阈值 $t$，$ \\operatorname{Se}(t)$ 对 $1 - \\operatorname{Sp}(t)$ 的图。AUC 代表了评分的整体区分能力，独立于任何特定阈值。它等价于随机选择的一个患病受试者的评分高于随机选择的一个非患病受试者的评分的概率。\n    $$\n    \\mathrm{AUC} = \\mathbb{P}(S_1  S_0)\n    $$\n    其中 $S_1$ 和 $S_0$ 分别是从患病和非患病评分分布中抽取的独立随机变量。\n\n### 3. 模拟方法\n\n对于每组参数 $(\\mu_1, \\mu_0, \\sigma_1, \\sigma_0, n_1, n_0, \\text{seed})$，执行以下步骤：\n\n#### 3.1. 数据生成\n使用由指定种子初始化的伪随机数生成器，我们模拟两组评分：\n-   患病组的 $n_1$ 个评分样本：$\\{s_{1,i}\\}_{i=1}^{n_1}$，来自 $\\mathcal{N}(\\mu_1, \\sigma_1^2)$。\n-   非患病组的 $n_0$ 个评分样本：$\\{s_{0,j}\\}_{j=1}^{n_0}$，来自 $\\mathcal{N}(\\mu_0, \\sigma_0^2)$。\n\n#### 3.2. 经验性 AUC 估计\nAUC 使用 Mann-Whitney U 统计量进行估计，该统计量与概率 $\\mathbb{P}(S_1  S_0)$ 直接相关。步骤如下：\n1.  将两个样本 $\\{s_{1,i}\\}$ 和 $\\{s_{0,j}\\}$ 合并成一个大小为 $N = n_1 + n_0$ 的单一数据集。\n2.  为合并数据集中的所有评分分配秩次。如果出现评分相同的情况，则使用平均秩次。设 $R_1$ 为患病组评分 $\\{s_{1,i}\\}$ 对应秩次的总和。\n3.  计算患病组的 Mann-Whitney U 统计量：\n    $$\n    U_1 = R_1 - \\frac{n_1(n_1+1)}{2}\n    $$\n4.  经验性 AUC 则由 $U_1$ 与两组之间评分对总数的比率给出：\n    $$\n    \\widehat{\\mathrm{AUC}} = \\frac{U_1}{n_1 n_0}\n    $$\n该估计量是衡量两种分布之间区分度的一种非参数且稳健的度量。\n\n#### 3.3. 最优阈值选择\n问题指定通过最大化约登指数 $J(t)$ 来选择一个“最优”阈值 $t^\\ast$。约登指数衡量 ROC 曲线与机遇线之间的垂直距离，定义为：\n$$\nJ(t) = \\operatorname{Se}(t) + \\operatorname{Sp}(t) - 1\n$$\n为了找到使经验约登指数 $\\hat{J}(t)$ 最大化的阈值 $\\hat{t}^\\ast$，我们执行网格搜索：\n1.  创建一个包含 $K=1001$ 个候选阈值的均匀网格。该网格覆盖了所有观测评分的整个范围，从合并样本中的最小值到最大值。设此网格为 $\\{t_k\\}_{k=1}^{K}$。\n2.  对于网格中的每个阈值 $t_k$，我们从模拟样本中计算经验灵敏度和特异度：\n    $$\n    \\widehat{\\operatorname{Se}}(t_k) = \\frac{1}{n_1} \\sum_{i=1}^{n_1} \\mathbb{I}(s_{1,i} \\ge t_k) \\\\\n    \\widehat{\\operatorname{Sp}}(t_k) = \\frac{1}{n_0} \\sum_{j=1}^{n_0} \\mathbb{I}(s_{0,j}  t_k)\n    $$\n    其中 $\\mathbb{I}(\\cdot)$ 是指示函数，当条件为真时为 $1$，否则为 $0$。\n3.  计算每个阈值的经验约登指数：\n    $$\n    \\hat{J}(t_k) = \\widehat{\\operatorname{Se}}(t_k) + \\widehat{\\operatorname{Sp}}(t_k) - 1\n    $$\n4.  最优阈值 $\\hat{t}^\\ast$ 是产生 $\\hat{J}(t_k)$ 最大值的阈值 $t_k$。\n    $$\n    \\hat{t}^\\ast = \\underset{t_k}{\\operatorname{argmax}} \\left\\{ \\hat{J}(t_k) \\right\\}\n    $$\n\n#### 3.4. 最终指标估计\n灵敏度和特异度的最终值是在此最优阈值 $\\hat{t}^\\ast$ 处计算的经验估计值：\n-   $\\widehat{\\operatorname{Se}} = \\widehat{\\operatorname{Se}}(\\hat{t}^\\ast)$\n-   $\\widehat{\\operatorname{Sp}} = \\widehat{\\operatorname{Sp}}(\\hat{t}^\\ast)$\n\n然后为每个测试用例收集这三个结果指标 $[\\widehat{\\operatorname{Se}}, \\widehat{\\operatorname{Sp}}, \\widehat{\\mathrm{AUC}}]$。对于给定的种子，整个过程是确定性的，从而确保了可复现性。大样本量（$n_1=n_0=50000$）确保了经验估计值是精确的，并接近其理论对应值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import rankdata\n\ndef solve():\n    \"\"\"\n    Runs a simulation to evaluate diagnostic test performance for several parameter sets.\n    \"\"\"\n\n    # Test suite (each case is (mu1, mu0, sigma1, sigma0, n1, n0, seed))\n    test_cases = [\n        (0, 0, 1, 1, 50000, 50000, 1),\n        (1, 0, 1, 1, 50000, 50000, 2),\n        (2, 0, 1, 1, 50000, 50000, 3),\n        (1, 0, 1.5, 1, 50000, 50000, 4),\n        (4, 0, 1, 1, 50000, 50000, 5),\n    ]\n\n    results = []\n    K = 1001  # Number of thresholds for grid search\n\n    for case in test_cases:\n        mu1, mu0, sigma1, sigma0, n1, n0, seed = case\n\n        # 1. Set random seed and generate samples\n        rng = np.random.default_rng(seed)\n        s1 = rng.normal(loc=mu1, scale=sigma1, size=n1)  # Diseased scores\n        s0 = rng.normal(loc=mu0, scale=sigma0, size=n0)  # Non-diseased scores\n\n        # 2. Estimate AUC using Mann-Whitney U statistic from ranks\n        combined_samples = np.concatenate((s1, s0))\n        # Assign ranks, using 'average' method for ties\n        ranks = rankdata(combined_samples, method='average')\n        # Sum of ranks for the diseased group (s1)\n        r1 = np.sum(ranks[:n1])\n        # Calculate U statistic for the diseased group\n        u1 = r1 - (n1 * (n1 + 1) / 2.0)\n        # Calculate AUC\n        auc = u1 / (n1 * n0)\n\n        # 3. Find the optimal threshold t* by maximizing Youden's Index J(t)\n        # Create a grid of thresholds spanning the empirical range\n        min_val = np.min(combined_samples)\n        max_val = np.max(combined_samples)\n        thresholds = np.linspace(min_val, max_val, K)\n\n        # Vectorized calculation of Se and Sp for all thresholds\n        # s1[:, np.newaxis] broadcasts s1 to compare against all thresholds\n        se_values = np.sum(s1[:, np.newaxis] >= thresholds, axis=0) / n1\n        sp_values = np.sum(s0[:, np.newaxis]  thresholds, axis=0) / n0\n\n        # Calculate Youden's index for all thresholds\n        j_values = se_values + sp_values - 1\n\n        # Find the index of the threshold that maximizes J\n        best_idx = np.argmax(j_values)\n        \n        # 4. Get the optimal Se and Sp at that threshold\n        se_star = se_values[best_idx]\n        sp_star = sp_values[best_idx]\n\n        results.append([se_star, sp_star, auc])\n\n    # Format the final output string as specified\n    inner_parts = []\n    for se, sp, auc_val in results:\n        inner_parts.append(f'[{se:.4f},{sp:.4f},{auc_val:.4f}]')\n    \n    final_output = f\"[{','.join(inner_parts)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}