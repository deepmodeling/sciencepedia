{
    "hands_on_practices": [
        {
            "introduction": "在生物统计学实践中，最常用的方法之一是利用大样本近似来构建相对风险（$RR$）和优势比（$OR$）的置信区间。本练习将带你从第一性原理出发，通过对数变换和Delta方法，为$RR$和$OR$推导并计算华尔德（Wald）置信区间。这个过程不仅能让你掌握核心的计算技能，更能让你深刻理解为何在基线风险较高时，$OR$会显著偏离$RR$，以及这种差异对结果解释的实际影响 ()。",
            "id": "4904678",
            "problem": "一项队列研究招募了 $800$ 名参与者，其中 $400$ 人被分配到暴露组，$400$ 人被分配到非暴露对照组。观察到的 $2 \\times 2$ 结局表格如下：在暴露组中，$300$ 人出现结局，$100$ 人未出现；在非暴露组中，$200$ 人出现结局，$200$ 人未出现。这些单元格计数对应的组风险为：暴露组 $p_1 = 0.75$，非暴露组 $p_0 = 0.50$，这使得相对风险和比值比在这种情况下可能存在显著差异。\n\n请仅使用风险和比值的核心定义，计算相对风险 (RR) 和比值比 (OR) 的样本估计值。然后，从中心极限定理 (CLT) 和 Delta 方法出发，通过在对数尺度上进行计算然后反向转换，构建 RR 和 OR 的近似 $95\\%$ 置信区间。您的推导必须从风险和比值的定义开始，通过 Delta 方法进行方差近似；不得在没有论证的情况下使用任何预先记忆的快捷公式。\n\n请严格根据每个指标所隐含的风险乘性变化，简要解释为什么在这种高基线风险情景下，RR 和 OR 的数值大小不同。\n\n最后，报告一个数字：根据表格计算出的比值 $\\text{OR}/\\text{RR}$，四舍五入至四位有效数字。最终数字无需单位。",
            "solution": "该问题科学合理、提法明确、客观，并包含足够信息以得出唯一解，因此是有效的。我们开始进行解答。\n\n数据可以总结在一个 $2 \\times 2$ 列联表中，其中行代表暴露状态，列代表结局。令 $a$ 为出现结局的暴露个体数，$b$ 为未出现结局的暴露个体数，$c$ 为出现结局的非暴露个体数，$d$ 为未出现结局的非暴露个体数。\n\n根据问题陈述：\n- 出现结局的暴露组：$a = 300$\n- 未出现结局的暴露组：$b = 100$\n- 出现结局的非暴露组：$c = 200$\n- 未出现结局的非暴露组：$d = 200$\n\n暴露组的总参与者人数为 $n_1 = a+b = 300+100 = 400$。\n非暴露组的总参与者人数为 $n_0 = c+d = 200+200 = 400$。\n\n**相对风险 (RR) 和比值比 (OR) 的样本估计**\n\n暴露组的风险是出现结局的个体所占的比例：$R_1 = \\frac{a}{a+b}$。样本估计值为 $\\hat{R}_1 = \\frac{300}{400} = 0.75$。\n非暴露组的风险是 $R_0 = \\frac{c}{c+d}$。样本估计值为 $\\hat{R}_0 = \\frac{200}{400} = 0.50$。\n\n相对风险 (RR) 是风险的比值：$RR = \\frac{R_1}{R_0}$。\n样本估计值为 $\\widehat{RR} = \\frac{\\hat{R}_1}{\\hat{R}_0} = \\frac{0.75}{0.50} = 1.5$。\n\n暴露组出现结局的比值是 $O_1 = \\frac{R_1}{1-R_1} = \\frac{a/(a+b)}{b/(a+b)} = \\frac{a}{b}$。样本估计值为 $\\hat{O}_1 = \\frac{300}{100} = 3$。\n非暴露组出现结局的比值是 $O_0 = \\frac{R_0}{1-R_0} = \\frac{c/(c+d)}{d/(c+d)} = \\frac{c}{d}$。样本估计值为 $\\hat{O}_0 = \\frac{200}{200} = 1$。\n\n比值比 (OR) 是比值的比值：$OR = \\frac{O_1}{O_0} = \\frac{a/b}{c/d} = \\frac{ad}{bc}$。\n样本估计值为 $\\widehat{OR} = \\frac{300 \\times 200}{100 \\times 200} = \\frac{60000}{20000} = 3$。\n\n**相对风险 (RR) 的置信区间**\n\n为了构建 RR 的置信区间，我们在对数尺度上进行计算。我们关心的统计量是 $\\ln(\\widehat{RR}) = \\ln(\\hat{R}_1) - \\ln(\\hat{R}_0)$。由于暴露组和非暴露组是独立的，差的方差是方差的和：\n$Var(\\ln(\\widehat{RR})) = Var(\\ln(\\hat{R}_1)) + Var(\\ln(\\hat{R}_0))$。\n\n我们使用 Delta 方法来近似 $\\ln(\\hat{R})$ 的方差。对于一个函数 $g(X)$，Delta 方法将方差近似为 $Var(g(X)) \\approx [g'(E[X])]^2 Var(X)$。\n这里，$\\hat{R}_1 = a/n_1$ 是一个样本比例。事件数 $a$ 服从二项分布，$a \\sim \\text{Bin}(n_1, R_1)$。因此，$E[\\hat{R}_1] = R_1$ 且 $Var(\\hat{R}_1) = \\frac{R_1(1-R_1)}{n_1}$。\n令 $g(R_1) = \\ln(R_1)$。其导数为 $g'(R_1) = 1/R_1$。\n应用 Delta 方法：\n$$Var(\\ln(\\hat{R}_1)) \\approx \\left(\\frac{1}{R_1}\\right)^2 Var(\\hat{R}_1) = \\frac{1}{R_1^2} \\frac{R_1(1-R_1)}{n_1} = \\frac{1-R_1}{n_1 R_1}$$\n通过代入样本估计值，可以得到估计方差：\n$$\\widehat{Var}(\\ln(\\hat{R}_1)) = \\frac{1-\\hat{R}_1}{n_1 \\hat{R}_1} = \\frac{1-a/n_1}{n_1 (a/n_1)} = \\frac{(n_1-a)/n_1}{a} = \\frac{b/n_1}{a} = \\frac{b}{an_1}$$\n类似地，对于非暴露组，$\\widehat{Var}(\\ln(\\hat{R}_0)) = \\frac{d}{cn_0}$。\n\n对数相对风险的估计方差为：\n$$\\widehat{Var}(\\ln(\\widehat{RR})) = \\frac{b}{an_1} + \\frac{d}{cn_0} = \\frac{100}{300 \\times 400} + \\frac{200}{200 \\times 400} = \\frac{1}{1200} + \\frac{1}{400} = \\frac{1+3}{1200} = \\frac{4}{1200} = \\frac{1}{300}$$\n标准误 (SE) 是 $SE(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{300}} \\approx 0.05774$。\n对数相对风险的点估计值为 $\\ln(\\widehat{RR}) = \\ln(1.5) \\approx 0.4055$。\n对于 $95\\%$ 的置信区间，来自标准正态分布的临界值是 $z_{0.975} \\approx 1.96$。\n$\\ln(RR)$ 的 $95\\%$ 置信区间是 $\\ln(\\widehat{RR}) \\pm z_{0.975} \\times SE(\\ln(\\widehat{RR}))$。\n$$0.4055 \\pm 1.96 \\times \\sqrt{\\frac{1}{300}} \\approx 0.4055 \\pm 1.96 \\times 0.05774 \\approx 0.4055 \\pm 0.1132$$\n$\\ln(RR)$ 的区间是 $[0.2923, 0.5187]$。\n为了获得 RR 的置信区间，我们通过对上下限取指数来进行反向转换：\n$$CI_{95\\%}(RR) = [\\exp(0.2923), \\exp(0.5187)] \\approx [1.340, 1.680]$$\n\n**比值比 (OR) 的置信区间**\n\n类似地，我们针对 OR 在对数尺度上进行计算。我们有 $\\ln(OR) = \\ln\\left(\\frac{R_1/(1-R_1)}{R_0/(1-R_0)}\\right) = \\text{logit}(R_1) - \\text{logit}(R_0)$。\n方差是 $Var(\\ln(\\widehat{OR})) = Var(\\text{logit}(\\hat{R}_1)) + Var(\\text{logit}(\\hat{R}_0))$。\n令 $h(R) = \\text{logit}(R) = \\ln\\left(\\frac{R}{1-R}\\right)$。其导数为 $h'(R) = \\frac{1}{R(1-R)}$。\n使用 Delta 方法：\n$$Var(\\text{logit}(\\hat{R}_1)) \\approx [h'(R_1)]^2 Var(\\hat{R}_1) = \\left(\\frac{1}{R_1(1-R_1)}\\right)^2 \\frac{R_1(1-R_1)}{n_1} = \\frac{1}{n_1 R_1 (1-R_1)}$$\n估计方差为：\n$$\\widehat{Var}(\\text{logit}(\\hat{R}_1)) = \\frac{1}{n_1 \\hat{R}_1 (1-\\hat{R}_1)} = \\frac{1}{n_1 (a/n_1) (b/n_1)} = \\frac{n_1}{ab}$$\n这可以被简化为：$\\frac{n_1}{ab} = \\frac{a+b}{ab} = \\frac{a}{ab} + \\frac{b}{ab} = \\frac{1}{b} + \\frac{1}{a}$。\n因此，对数比值比的总估计方差为：\n$$\\widehat{Var}(\\ln(\\widehat{OR})) = \\left(\\frac{1}{a}+\\frac{1}{b}\\right) + \\left(\\frac{1}{c}+\\frac{1}{d}\\right) = \\frac{1}{a} + \\frac{1}{b} + \\frac{1}{c} + \\frac{1}{d}$$\n使用给定数据：\n$$\\widehat{Var}(\\ln(\\widehat{OR})) = \\frac{1}{300} + \\frac{1}{100} + \\frac{1}{200} + \\frac{1}{200} = \\frac{2}{600} + \\frac{6}{600} + \\frac{3}{600} + \\frac{3}{600} = \\frac{14}{600} = \\frac{7}{300}$$\n标准误是 $SE(\\ln(\\widehat{OR})) = \\sqrt{\\frac{7}{300}} \\approx 0.1528$。\n对数比值比的点估计值为 $\\ln(\\widehat{OR}) = \\ln(3) \\approx 1.0986$。\n$\\ln(OR)$ 的 $95\\%$ 置信区间是：\n$$1.0986 \\pm 1.96 \\times \\sqrt{\\frac{7}{300}} \\approx 1.0986 \\pm 1.96 \\times 0.1528 \\approx 1.0986 \\pm 0.2995$$\n$\\ln(OR)$ 的区间是 $[0.7991, 1.3981]$。\n反向转换以获得 OR 的置信区间：\n$$CI_{95\\%}(OR) = [\\exp(0.7991), \\exp(1.3981)] \\approx [2.224, 4.047]$$\n\n**RR 和 OR 之间差异的解释**\n\n相对风险 (RR) 是概率（风险）的比值，而比值比 (OR) 是比值的比值。它们之间的关系由下式给出：\n$$OR = \\frac{R_1/(1-R_1)}{R_0/(1-R_0)} = \\frac{R_1}{R_0} \\times \\frac{1-R_0}{1-R_1} = RR \\times \\frac{1-R_0}{1-R_1}$$\n项 $\\frac{1-R_0}{1-R_1}$ 是关联 OR 和 RR 的校正因子。\n当基线风险 $R_0$ 很低，且暴露组的风险 $R_1$ 也很低时（稀有病假设），$1-R_0$ 和 $1-R_1$ 都接近于 $1$。在这种情况下，校正因子约等于 $1$，并且 $OR \\approx RR$。\n在如本例所示的 $\\hat{R}_0=0.50$ 的高基线风险情景中，未出现结局的概率 $1-R_0$ 和 $1-R_1$ 变得重要起来。如果暴露增加了风险（$R_1 > R_0$），那么 $1-R_1  1-R_0$。这使得比值 $\\frac{1-R_0}{1-R_1}$ 大于 $1$，导致 OR 大于 RR。随着风险 $R_0$ 和 $R_1$ 的增加并远离 $0$，这种差异的幅度会增大。\n在这个问题中，$\\hat{R}_0 = 0.50$ 且 $\\hat{R}_1 = 0.75$。估计的校正因子是 $\\frac{1-0.50}{1-0.75} = \\frac{0.50}{0.25} = 2$。\n这个为 $2$ 的乘性因子解释了为什么比值比（$\\widehat{OR}=3$）恰好是相对风险（$\\widehat{RR}=1.5$）的两倍。比值比不仅反映了风险的增加，也反映了非风险的相应*减少*，这是一种乘性效应，当风险接近 $1$ 时变得更加显著。\n\n**最终计算**\n\n比值 $\\text{OR}/\\text{RR}$ 由样本估计值计算得出：\n$$\\frac{\\widehat{OR}}{\\widehat{RR}} = \\frac{3}{1.5} = 2$$\n四舍五入到四位有效数字，结果是 $2.000$。",
            "answer": "$$\\boxed{2.000}$$"
        },
        {
            "introduction": "当样本量较小或数据稀疏（例如出现零单元格）时，基于大样本理论的近似方法可能不再可靠。本练习将引导你进入精确推断的世界，特别是针对优势比（$OR$）的Cornfield精确置信区间。你将探索在固定边际的条件下，单元格计数的条件分布（非中心超几何分布），并理解如何通过反转精确检验来构建置信区间，这是处理病例对照研究中稀疏数据的黄金标准方法 ()。",
            "id": "4904695",
            "problem": "一位研究者进行了一项病例对照研究，以评估某项暴露是否与一种疾病相关。观测到的 $2 \\times 2$ 列联表如下：\n\n- 暴露且患病: $a = 0$\n- 暴露且未患病: $b = 3$\n- 未暴露且患病: $c = 2$\n- 未暴露且未患病: $d = 1$\n\n因此，固定的边际为：总暴露数 $m_1 = a + b = 3$，总未暴露数 $m_0 = c + d = 3$，总患病数 $n_1 = a + c = 2$，以及总未患病数 $n_0 = b + d = 4$。\n\n仅使用基本定义和固定边际下的条件推理，通过枚举填充表格的方式，推导在一般比值比参数 $\\theta$ 下，暴露且患病单元格计数 $A$ 的条件分布，并解释为什么该分布属于非中心超几何分布族。然后，通过在条件模型中反演单侧检验（在 $\\alpha = 0.05$ 水平上采用等尾），确定该表格的比值比 $\\theta$ 的精确 Cornfield $95\\%$ 置信区间。特别地，利用下限解一个在 $A$ 值较大方向上的单侧尾部条件，而上限解一个在 $A$ 值较小方向上的单侧尾部条件，每个条件都等于 $\\alpha/2$ 这一事实。选择既正确描述了这种反演逻辑，又报告了正确的 $\\theta$ 数值区间的选项。\n\nA. 比值比（OR）的精确等尾 $95\\%$ 区间是 $\\left[0,\\ 4.92\\right]$。它是在具有固定边际的条件非中心超几何模型中，通过求解下限的 $P_{\\theta}(A \\ge a_{\\text{obs}}) = \\alpha/2$ 和求解上限的 $P_{\\theta}(A \\le a_{\\text{obs}}) = \\alpha/2$ 得到的。\n\nB. OR 的精确等尾 $95\\%$ 区间是 $\\left[0,\\ 3.11\\right]$，通过将相关的超几何尾部概率等同于 $\\alpha = 0.05$ 而非 $\\alpha/2$ 计算得出。\n\nC. 因为存在一个零单元格，所以精确的 Cornfield 95% 区间必须是 $\\left[0,\\ \\infty\\right)$。\n\nD. 带有连续性校正的正态（Wald）近似给出了一个 $95\\%$ 区间 $\\left[0.002,\\ 3.10\\right]$，这是在稀疏表格中合适的精确 Cornfield 区间。",
            "solution": "我们从定义比值比（OR）的第一性原理出发。对于一个单元格计数为 $(a,b,c,d)$ 的 $2 \\times 2$ 列联表，其排列如下\n$$\n\\begin{array}{c|cc}\n   \\text{疾病}  \\text{无疾病} \\\\\n\\hline\n\\text{暴露}  a  b \\\\\n\\text{未暴露}  c  d\n\\end{array}\n$$\n比值比为\n$$\n\\theta = \\frac{a d}{b c}.\n$$\n在固定边际 $m_1 = a + b$（总暴露数）、$m_0 = c + d$（总未暴露数）、$n_1 = a + c$（总患病数）和 $n_0 = b + d$（总未患病数）下，我们考虑给定边际时暴露且患病计数 $A$ 的条件分布。$A$ 的允许值为整数，这些整数必须能同时满足暴露总数和患病总数：\n$$\nA \\in \\left\\{ \\max\\{0, n_1 - m_0\\}, \\ldots, \\min\\{m_1, n_1\\} \\right\\}.\n$$\n在这里，$m_1 = 3$，$m_0 = 3$，$n_1 = 2$，$n_0 = 4$，所以\n$$\nA \\in \\{0, 1, 2\\}.\n$$\n为了推导在一般比值比 $\\theta$ 下 $A$ 的条件概率，我们使用核心的组合学事实：在边际固定的条件下，从 $m_1$ 个暴露者中选出 $A$ 个患病者的方式有 $\\binom{m_1}{A}$ 种，从 $m_0$ 个未暴露者中选出 $n_1 - A$ 个患病者的方式有 $\\binom{m_0}{n_1 - A}$ 种。在比值比参数化下，暴露且患病计数为 $A$ 的表格的相对似然与 $\\theta^A$ 成正比，因为暴露者相对于未暴露者的患病比值为 $\\theta$。因此，给定边际的 $A$ 的条件分布是非中心超几何分布，其概率质量函数正比于\n$$\nw(A; \\theta) = \\binom{m_1}{A} \\binom{m_0}{n_1 - A} \\theta^A,\n$$\n并通过对所有允许的 $A$ 求和进行归一化：\n$$\nP_{\\theta}(A = a) = \\frac{w(a; \\theta)}{\\sum_{k} w(k; \\theta)}.\n$$\n对于我们的边际 $m_1 = 3$，$m_0 = 3$，$n_1 = 2$，权重为：\n- 对于 $A = 0$：$w(0; \\theta) = \\binom{3}{0} \\binom{3}{2} \\theta^0 = 1 \\cdot 3 \\cdot 1 = 3$。\n- 对于 $A = 1$：$w(1; \\theta) = \\binom{3}{1} \\binom{3}{1} \\theta^1 = 3 \\cdot 3 \\cdot \\theta = 9 \\theta$。\n- 对于 $A = 2$：$w(2; \\theta) = \\binom{3}{2} \\binom{3}{0} \\theta^2 = 3 \\cdot 1 \\cdot \\theta^2 = 3 \\theta^2$。\n\n归一化和为\n$$\nS(\\theta) = 3 + 9\\theta + 3\\theta^2.\n$$\n观测到的暴露且患病计数为 $a_{\\text{obs}} = 0$。\n\nCornfield 的精确置信限是通过在条件非中心超几何模型中反演单侧检验得到的，使用水平为 $\\alpha/2$ 的等尾。具体来说：\n- 下置信限 $L$ 求解右尾条件\n$$\nP_{\\theta}(A \\ge a_{\\text{obs}}) = \\alpha/2.\n$$\n- 上置信限 $U$ 求解左尾条件\n$$\nP_{\\theta}(A \\le a_{\\text{obs}}) = \\alpha/2.\n$$\n这个方向与用于精确二项式区间的反演相匹配，并确保了等尾覆盖。\n\n给定 $a_{\\text{obs}} = 0$ 和允许的 $A \\in \\{0,1,2\\}$，我们有：\n$$\nP_{\\theta}(A \\ge 0) = 1 \\quad \\text{对于所有 } \\theta \\ge 0,\n$$\n因此方程 $P_{\\theta}(A \\ge 0) = \\alpha/2$ 对于任何正的 $\\theta$ 都不能满足。根据标准的精确反演逻辑，下限因此为 $L = 0$。\n\n对于上限，我们求解\n$$\nP_{\\theta}(A \\le 0) = P_{\\theta}(A = 0) = \\frac{3}{3 + 9\\theta + 3\\theta^2} = \\frac{\\alpha}{2} = 0.025.\n$$\n建立方程：\n$$\n\\frac{3}{3 + 9\\theta + 3\\theta^2} = 0.025.\n$$\n交叉相乘：\n$$\n3 = 0.025 \\cdot (3 + 9\\theta + 3\\theta^2) = 0.075 + 0.225\\theta + 0.075\\theta^2.\n$$\n整理为二次方程：\n$$\n0.075\\theta^2 + 0.225\\theta - 2.925 = 0.\n$$\n两边同除以 $0.075$ 以简化：\n$$\n\\theta^2 + 3\\theta - 39 = 0.\n$$\n解这个二次方程：\n$$\n\\theta = \\frac{-3 \\pm \\sqrt{3^2 + 4 \\cdot 39}}{2} = \\frac{-3 \\pm \\sqrt{9 + 156}}{2} = \\frac{-3 \\pm \\sqrt{165}}{2}.\n$$\n我们需要正根：\n$$\n\\theta = \\frac{-3 + \\sqrt{165}}{2} \\approx \\frac{-3 + 12.845}{2} \\approx \\frac{9.845}{2} \\approx 4.9225.\n$$\n因此，\n$$\nU \\approx 4.92.\n$$\n比值比的精确等尾 $95\\%$ Cornfield 置信区间是 $\\left[0,\\ 4.92\\right]$。\n\n逐项分析：\n- A选项：它正确地陈述了条件非中心超几何模型中的反演逻辑（下限通过 $P_{\\theta}(A \\ge a_{\\text{obs}}) = \\alpha/2$，上限通过 $P_{\\theta}(A \\le a_{\\text{obs}}) = \\alpha/2$）并报告了正确的数值区间 $\\left[0,\\ 4.92\\right]$。结论：正确。\n- B选项：它使用 $\\alpha = 0.05$ 而不是 $\\alpha/2 = 0.025$ 作为尾部概率，这会得到一个不同的（且不正确的）上限。求解 $\\frac{3}{3 + 9\\theta + 3\\theta^2} = 0.05$ 会得到 $\\theta^2 + 3\\theta - 19 = 0$ 和 $\\theta \\approx 3.11$，而不是正确的等尾界限。结论：不正确。\n- C选项：它断言零单元格会导致无限的上限。如上所示，上限是有限的，因为左尾概率 $P_{\\theta}(A = 0)$ 可以通过将 $\\theta$ 增加到一个有限值来使其等于 $\\alpha/2$。结论：不正确。\n- D选项：它提出了一个带有连续性校正的正态（Wald）近似，这不是一个精确的 Cornfield 区间，并且在稀疏表中，通常是不可靠的，也不等同于精确的条件区间。报告的数字是来自另一种方法的近似值，并且不满足精确的条件反演。结论：不正确。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "超越频率学派的框架，我们来探索一种功能强大的现代方法——贝叶斯推断。在这个练习中，你将通过编写程序，学习如何将先验知识（以Beta分布表示）与观测数据（二项分布似然）相结合，从而推导出风险概率的后验分布。然后，你将使用蒙特卡洛模拟，从这些后验分布中抽样，以获得相对风险（$RR$）和优势比（$OR$）的后验分布，并最终构建它们的95%可信区间，体验贝叶斯方法在提供丰富推断结论方面的独特优势 ()。",
            "id": "4904692",
            "problem": "考虑代表队列比较的两个独立二项式样本：一个暴露组，有 $n_1$ 名受试者，其中发生了 $x_1$ 次事件；一个非暴露组，有 $n_0$ 名受试者，其中发生了 $x_0$ 次事件。设暴露组的真实事件概率为 $p_1$，非暴露组的真实事件概率为 $p_0$。给定独立的贝塔先验分布 $p_1 \\sim \\text{Beta}(\\alpha_1,\\beta_1)$ 和 $p_0 \\sim \\text{Beta}(\\alpha_0,\\beta_0)$。利用贝叶斯定理和二项式似然，从第一性原理推导出 $p_1$ 和 $p_0$ 的后验分布。然后，将定义为 $RR = p_1 / p_0$ 的相对风险（RR）和定义为 $OR = \\dfrac{p_1/(1-p_1)}{p_0/(1-p_0)}$ 的比值比（OR）视为 $(p_1,p_0)$ 的函数，并通过变换得到它们的后验分布。\n\n你的任务是设计一个程序，该程序能够：\n- 使用贝叶斯定理和二项式似然，根据给定的先验和数据构建 $p_1$ 和 $p_0$ 的后验分布。\n- 通过从 $(p_1,p_0)$ 的后验分布中进行蒙特卡洛（MC）抽样，并应用相应的变换，获得 $RR$ 和 $OR$ 的后验抽样。\n- 使用蒙特卡洛抽样的经验 $0.025$ 和 $0.975$ 后验分位数，计算 $RR$ 和 $OR$ 的 $0.95$ 可信区间（CI）。\n\n实现要求：\n- 每个测试用例使用 $M = 100000$ 次独立的后验抽样。\n- 使用固定的随机种子 $2025$ 以确保后验抽样的可复现性。\n- 将所有区间端点报告为四舍五入到 $6$ 位小数的十进制浮点数。\n- 不涉及物理单位。\n- 结果必须以小数（而非百分比）形式报告。\n\n测试套件：\n为以下参数集提供可信区间，其中每个案例由 $(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0)$ 指定：\n\n1. 理想路径，中等样本量，使用均匀先验：$(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0) = (1,1,30,200,1,1,15,180)$。\n2. 边界情况，暴露组中零事件，使用 Jeffreys 先验：$(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0) = (0.5,0.5,0,20,0.5,0.5,2,20)$。\n3. 极端情况，高发生率，使用均匀先验：$(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0) = (1,1,95,100,1,1,80,100)$。\n4. 信息性不对称先验，中等样本量：$(\\alpha_1,\\beta_1,x_1,n_1,\\alpha_0,\\beta_0,x_0,n_0) = (8,32,18,100,4,36,9,120)$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例贡献一个包含四个浮点数的列表，顺序为 $[RR_{\\text{low}},RR_{\\text{high}},OR_{\\text{low}},OR_{\\text{high}}]$。最终输出必须将所有测试用例聚合在一个外部列表中，例如：\n$[[r_{1L},r_{1U},o_{1L},o_{1U}],[r_{2L},r_{2U},o_{2L},o_{2U}],\\dots]$。",
            "solution": "该问题是有效的，因为它在科学上基于贝叶斯统计理论，问题陈述清晰，提供了所有必要信息，并且其表述是客观的。我们将继续提供解决方案。\n\n该问题要求基于两个独立二项式样本的数据，计算相对风险（$RR$）和比值比（$OR$）的 $95\\%$ 贝叶斯可信区间。解决方案包括三个主要步骤：推导基础事件概率的后验分布，使用蒙特卡洛模拟生成 $RR$ 和 $OR$ 的后验分布，最后从这些模拟分布中提取可信区间。\n\n### 步骤 1：后验分布的推导\n\n给定两个独立的组：一个暴露组和一个非暴露组。\n\n对于暴露组，我们观察到 $n_1$ 名受试者中有 $x_1$ 次事件。假设事件数 $x_1$ 服从真实事件概率为 $p_1$ 的二项分布：\n$$ x_1 | p_1, n_1 \\sim \\text{Binomial}(n_1, p_1) $$\n似然函数由下式给出：\n$$ L(p_1 | x_1, n_1) = \\binom{n_1}{x_1} p_1^{x_1} (1-p_1)^{n_1-x_1} \\propto p_1^{x_1} (1-p_1)^{n_1-x_1} $$\n\n给定概率 $p_1$ 的贝塔先验分布：\n$$ p_1 \\sim \\text{Beta}(\\alpha_1, \\beta_1) $$\n先验的概率密度函数（PDF）为：\n$$ \\pi(p_1) = \\frac{\\Gamma(\\alpha_1+\\beta_1)}{\\Gamma(\\alpha_1)\\Gamma(\\beta_1)} p_1^{\\alpha_1-1} (1-p_1)^{\\beta_1-1} \\propto p_1^{\\alpha_1-1} (1-p_1)^{\\beta_1-1} $$\n\n根据贝叶斯定理，$p_1$ 的后验分布与似然和先验的乘积成正比：\n$$ P(p_1 | x_1, n_1) \\propto L(p_1 | x_1, n_1) \\times \\pi(p_1) $$\n$$ P(p_1 | x_1, n_1) \\propto \\left( p_1^{x_1} (1-p_1)^{n_1-x_1} \\right) \\times \\left( p_1^{\\alpha_1-1} (1-p_1)^{\\beta_1-1} \\right) $$\n$$ P(p_1 | x_1, n_1) \\propto p_1^{x_1 + \\alpha_1 - 1} (1-p_1)^{n_1 - x_1 + \\beta_1 - 1} $$\n\n该表达式是贝塔分布的核。贝塔分布是二项式似然的共轭先验，这意味着后验分布也是贝塔分布。$p_1$ 的后验分布为：\n$$ p_1 | x_1, n_1 \\sim \\text{Beta}(\\alpha_1', \\beta_1') $$\n其中后验参数更新如下：\n$$ \\alpha_1' = \\alpha_1 + x_1 $$\n$$ \\beta_1' = \\beta_1 + n_1 - x_1 $$\n\n同理，对于在 $n_0$ 名受试者中发生 $x_0$ 次事件且先验为 $p_0 \\sim \\text{Beta}(\\alpha_0, \\beta_0)$ 的非暴露组，其事件概率 $p_0$ 的后验分布为：\n$$ p_0 | x_0, n_0 \\sim \\text{Beta}(\\alpha_0', \\beta_0') $$\n其中后验参数为：\n$$ \\alpha_0' = \\alpha_0 + x_0 $$\n$$ \\beta_0' = \\beta_0 + n_0 - x_0 $$\n\n由于两组是独立的，它们的后验分布也是独立的。\n\n### 步骤 2：RR 和 OR 的蒙特卡洛模拟\n\n相对风险（$RR$）和比值比（$OR$）定义为 $p_1$ 和 $p_0$ 的函数：\n$$ RR = \\frac{p_1}{p_0} $$\n$$ OR = \\frac{p_1 / (1-p_1)}{p_0 / (1-p_0)} $$\n\nRR 和 OR 的后验分布没有简单的封闭形式表达式。但是，我们可以使用蒙特卡洛模拟来近似它们。步骤如下：\n\n1.  设置蒙特卡洛抽样次数，$M = 100000$。\n2.  从 $p_1$ 的后验分布 $\\text{Beta}(\\alpha_1', \\beta_1')$ 中抽取 $M$ 个独立样本。将这组抽样表示为 $\\{p_{1,i}\\}_{i=1}^M$。\n3.  从 $p_0$ 的后验分布 $\\text{Beta}(\\alpha_0', \\beta_0')$ 中抽取 $M$ 个独立样本。将这组抽样表示为 $\\{p_{0,i}\\}_{i=1}^M$。\n4.  对于每一对抽样 $(p_{1,i}, p_{0,i})$，计算相应的 $RR_i$ 和 $OR_i$：\n    $$ RR_i = \\frac{p_{1,i}}{p_{0,i}} $$\n    $$ OR_i = \\frac{p_{1,i} / (1-p_{1,i})}{p_{0,i} / (1-p_{0,i})} $$\n得到的集合 $\\{RR_i\\}_{i=1}^M$ 和 $\\{OR_i\\}_{i=1}^M$ 分别是来自 $RR$ 和 $OR$ 后验分布的经验样本。\n\n### 步骤 3：计算可信区间\n\n一个参数的 $95\\%$ 可信区间是指以 $95\\%$ 的后验概率包含该参数的区间。对于一个模拟的后验分布，可以使用样本分位数来估计这个区间。区间的下界是第 $2.5$ 百分位数，上界是第 $97.5$ 百分位数。\n\n1.  将计算出的 $M$ 个 $RR_i$ 值按升序排序。$RR$ 的 $95\\%$ 可信区间由 $[RR_{\\text{low}}, RR_{\\text{high}}]$ 给出，其中 $RR_{\\text{low}}$ 是位于第 $(0.025 \\times M)$ 个位置的值，$RR_{\\text{high}}$ 是位于第 $(0.975 \\times M)$ 个位置的值。\n2.  同样，对计算出的 $M$ 个 $OR_i$ 值进行排序。$OR$ 的 $95\\%$ 可信区间为 $[OR_{\\text{low}}, OR_{\\text{high}}]$，由排序后样本的 $0.025$ 和 $0.975$ 分位数确定。\n\n将对所提供的四个测试用例中的每一个实施此程序，使用固定的随机种子 $2025$ 以确保蒙特卡洛抽样的可复现性。最终的区间端点将四舍五入到 $6$ 位小数。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes 95% credible intervals for Relative Risk (RR) and Odds Ratio (OR)\n    using Bayesian inference with a binomial likelihood and beta priors.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is specified by (alpha1, beta1, x1, n1, alpha0, beta0, x0, n0).\n    test_cases = [\n        (1, 1, 30, 200, 1, 1, 15, 180),  # Happy path\n        (0.5, 0.5, 0, 20, 0.5, 0.5, 2, 20), # Boundary case (zero events)\n        (1, 1, 95, 100, 1, 1, 80, 100), # Edge case (high incidence)\n        (8, 32, 18, 100, 4, 36, 9, 120),  # Informative priors\n    ]\n\n    # Implementation requirements\n    M = 100000  # Number of Monte Carlo draws\n    SEED = 2025  # Fixed random seed for reproducibility\n    QUANTILE_LOW = 0.025\n    QUANTILE_HIGH = 0.975\n    DECIMAL_PLACES = 6\n\n    # Initialize the random number generator\n    rng = np.random.default_rng(SEED)\n\n    aggregated_results = []\n\n    for case in test_cases:\n        alpha1, beta1, x1, n1, alpha0, beta0, x0, n0 = case\n\n        # Step 1: Calculate posterior parameters for Beta distributions\n        # Posterior ~ Beta(alpha + x, beta + n - x)\n        post_alpha1 = alpha1 + x1\n        post_beta1 = beta1 + n1 - x1\n        post_alpha0 = alpha0 + x0\n        post_beta0 = beta0 + n0 - x0\n\n        # Step 2: Generate posterior samples for p1 and p0\n        # The Beta distribution is defined on (0, 1), so draws are non-zero.\n        p1_samples = rng.beta(post_alpha1, post_beta1, size=M)\n        p0_samples = rng.beta(post_alpha0, post_beta0, size=M)\n\n        # Step 3: Compute posterior samples for RR and OR by transformation\n        # RR = p1 / p0\n        rr_samples = p1_samples / p0_samples\n\n        # OR = (p1 / (1-p1)) / (p0 / (1-p0))\n        # To avoid potential division by zero if a sample was exactly 1 (though\n        # highly improbable for a continuous distribution), this is handled by numpy.\n        odds1 = p1_samples / (1 - p1_samples)\n        odds0 = p0_samples / (1 - p0_samples)\n        or_samples = odds1 / odds0\n\n        # Step 4: Compute the 95% credible intervals using quantiles\n        rr_low, rr_high = np.quantile(rr_samples, [QUANTILE_LOW, QUANTILE_HIGH])\n        or_low, or_high = np.quantile(or_samples, [QUANTILE_LOW, QUANTILE_HIGH])\n\n        # Format results for the current case\n        current_result = [\n            round(rr_low, DECIMAL_PLACES),\n            round(rr_high, DECIMAL_PLACES),\n            round(or_low, DECIMAL_PLACES),\n            round(or_high, DECIMAL_PLACES)\n        ]\n        aggregated_results.append(current_result)\n\n    # Final print statement in the exact required format.\n    # str() representation gives spaces, which we need to remove.\n    output_str = str(aggregated_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}