{
    "hands_on_practices": [
        {
            "introduction": "在回归分析中，正确处理分类预测变量是至关重要的一步。不同的编码方案（如虚拟编码、效应编码）会产生看起来截然不同的回归系数，这可能会让初学者感到困惑。本练习旨在通过一个具体的计算实例，揭示一个核心原理：无论您选择哪种全秩编码方案，模型对数据的拟合优度（以 $R^2$ 衡量）和预测值都是不变的。这个练习将帮助您巩固对模型设定和参数解释之间关系的理解。",
            "id": "4899207",
            "problem": "一个具有 $K=3$ 个水平的分类预测变量的单因子线性回归模型，通过带截距的普通最小二乘法（OLS）进行拟合。考虑以下包含 $n=6$ 个独立观测值的数据集，每个观测值恰好属于分类预测变量的三个水平 $L_{1}$、$L_{2}$、$L_{3}$ 之一：\n- 观测值 1：$y_{1}=4$，水平 $L_{1}$\n- 观测值 2：$y_{2}=6$，水平 $L_{1}$\n- 观测值 3：$y_{3}=8$，水平 $L_{2}$\n- 观测值 4：$y_{4}=10$，水平 $L_{2}$\n- 观测值 5：$y_{5}=5$，水平 $L_{3}$\n- 观测值 6：$y_{6}=3$，水平 $L_{3}$\n\n从线性模型、最小二乘投影和决定系数的核心定义出发。对该因子使用三种不同的满秩编码方案（始终包含截距），并在每种方案下通过OLS拟合模型 $y_{i}=\\boldsymbol{x}_{i}^{\\top}\\boldsymbol{\\beta}+\\varepsilon_{i}$：\n1. 处理（虚拟）编码，以 $L_{1}$ 为参考水平。使用回归量 $\\{1,D_{2},D_{3}\\}$，其中如果观测值属于水平 $L_{k}$，则 $D_{k}=1$，否则为 $0$。\n2. 效应（和为零）编码，使用回归量 $\\{1,E_{1},E_{2}\\}$，由各水平的编码定义\n   - $L_{1}$: $(E_{1},E_{2})=(-1,-1)$，\n   - $L_{2}$: $(E_{1},E_{2})=(1,0)$，\n   - $L_{3}$: $(E_{1},E_{2})=(0,1)$。\n3. Helmert 编码，使用回归量 $\\{1,H_{1},H_{2}\\}$，由各水平的编码定义\n   - $L_{1}$: $(H_{1},H_{2})=(-1,-1)$，\n   - $L_{2}$: $(H_{1},H_{2})=(1,-1)$，\n   - $L_{3}$: $(H_{1},H_{2})=(0,2)$。\n\n对于每种编码：\n- 计算OLS系数向量 $\\boldsymbol{\\beta}$。\n- 计算每个观测值 $i\\in\\{1,\\dots,6\\}$ 的拟合值 $\\hat{y}_{i}$。\n- 计算决定系数（R平方），定义为 $R^{2}=1-\\mathrm{SSE}/\\mathrm{SST}$，其中 $\\mathrm{SSE}=\\sum_{i=1}^{n}(y_{i}-\\hat{y}_{i})^{2}$ 且 $\\mathrm{SST}=\\sum_{i=1}^{n}(y_{i}-\\bar{y})^{2}$，$\\bar{y}=\\frac{1}{n}\\sum_{i=1}^{n}y_{i}$。\n\n使用基本原理，证明为什么在这些满秩编码下，拟合值和 $R^{2}$ 是不变的，尽管各个系数的解释和数值不同。\n\n报告此数据集的 $R^{2}$ 的共同数值作为最终答案。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求在三种不同的参数化下分析一个单因子线性模型。我们将首先为拟合值和 $R^2$ 的不变性提供理论证明，然后对特定数据集进行计算。\n\n**不变性的理论证明**\n\n一般线性模型用矩阵形式表示为 $\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol{\\varepsilon}$，其中 $\\mathbf{y}$ 是 $n \\times 1$ 的响应向量，$\\mathbf{X}$ 是 $n \\times p$ 的设计矩阵，$\\boldsymbol{\\beta}$ 是 $p \\times 1$ 的系数向量，$\\boldsymbol{\\varepsilon}$ 是误差向量。$\\boldsymbol{\\beta}$ 的普通最小二乘（OLS）估计量由下式给出 $\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\mathbf{y}$，假设 $\\mathbf{X}$ 具有满列秩。\n\n拟合值向量 $\\hat{\\mathbf{y}}$ 由下式给出：\n$$ \\hat{\\mathbf{y}} = \\mathbf{X}\\hat{\\boldsymbol{\\beta}} = \\mathbf{X}(\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\mathbf{y} $$\n这可以写成 $\\hat{\\mathbf{y}} = \\mathbf{P}\\mathbf{y}$，其中矩阵 $\\mathbf{P} = \\mathbf{X}(\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}$ 是投影矩阵。从几何上看，$\\hat{\\mathbf{y}}$ 是数据向量 $\\mathbf{y}$ 在设计矩阵的列空间 $C(\\mathbf{X})$ 上的正交投影。投影矩阵 $\\mathbf{P}$ 由子空间 $C(\\mathbf{X})$ 唯一确定，而不由该子空间的特定基向量（列）的选择确定。\n\n在这个问题中，我们有一个包含 $K=3$ 个水平的单分类因子。任何带截距的满秩参数化都需要设计矩阵 $\\mathbf{X}$ 中有 $p=3$ 列。设 $\\mathbf{X}_A$ 和 $\\mathbf{X}_B$ 是对应于不同编码方案（例如，处理编码和效应编码）的两个这样的设计矩阵。这两个矩阵都被构造成张成同一个子空间：即在 $K$ 个水平中的每一个水平内都为常数的向量所构成的子空间。该子空间的维度为 $K=3$。因为 $\\mathbf{X}_A$ 和 $\\mathbf{X}_B$ 都是秩为 $K$ 的 $n \\times K$ 矩阵，所以它们的列构成了这个相同的 $K$ 维子空间的一个基。这意味着它们的列空间是相同的：$C(\\mathbf{X}_A) = C(\\mathbf{X}_B)$。\n\n由于列空间相同，投影到这个空间上的投影矩阵 $\\mathbf{P}$ 对于两种编码也是相同的。因此，拟合值向量 $\\hat{\\mathbf{y}} = \\mathbf{P}\\mathbf{y}$ 必须对于满秩编码方案的选择是不变的。\n\n这种不变性直接扩展到误差平方和（$\\mathrm{SSE}$）和决定系数（$R^2$）：\n- $\\mathrm{SSE} = \\sum_{i=1}^{n}(y_i - \\hat{y}_i)^2 = ||\\mathbf{y} - \\hat{\\mathbf{y}}||^2$。由于 $\\mathbf{y}$ 是固定的且 $\\hat{\\mathbf{y}}$ 是不变的，因此 $\\mathrm{SSE}$ 是不变的。\n- 总平方和 $\\mathrm{SST} = \\sum_{i=1}^{n}(y_i - \\bar{y})^2$ 仅取决于响应数据 $\\mathbf{y}$，因此与模型无关，是恒定的。\n- 因此，决定系数 $R^2 = 1 - \\mathrm{SSE}/\\mathrm{SST}$ 在这些不同的编码方案下也必须是不变的。\n\n对于任何单因素方差分析模型，OLS投影产生的拟合值等于组均值。我们先求出这些值，因为它们将是共同的拟合值集合。\n数据为 $y = (4, 6, 8, 10, 5, 3)$。水平为 $(L_1, L_1, L_2, L_2, L_3, L_3)$。\n- 水平 $L_1$ 的均值：$\\bar{y}_1 = \\frac{4+6}{2} = 5$。\n- 水平 $L_2$ 的均值：$\\bar{y}_2 = \\frac{8+10}{2} = 9$。\n- 水平 $L_3$ 的均值：$\\bar{y}_3 = \\frac{5+3}{2} = 4$。\n所有方案的拟合值向量将是 $\\hat{\\mathbf{y}} = (5, 5, 9, 9, 4, 4)^{\\top}$。\n\n**$R^2$ 的计算**\n\n首先，我们计算总均值 $\\bar{y}$：\n$$ \\bar{y} = \\frac{1}{6}(4+6+8+10+5+3) = \\frac{36}{6} = 6 $$\n接下来，我们计算总平方和（$\\mathrm{SST}$）：\n$$ \\mathrm{SST} = \\sum_{i=1}^{6}(y_i - \\bar{y})^2 = (4-6)^2 + (6-6)^2 + (8-6)^2 + (10-6)^2 + (5-6)^2 + (3-6)^2 $$\n$$ \\mathrm{SST} = (-2)^2 + 0^2 + 2^2 + 4^2 + (-1)^2 + (-3)^2 = 4 + 0 + 4 + 16 + 1 + 9 = 34 $$\n使用不变的拟合值 $\\hat{\\mathbf{y}} = (5, 5, 9, 9, 4, 4)^{\\top}$，我们计算误差平方和（$\\mathrm{SSE}$）：\n$$ \\mathrm{SSE} = \\sum_{i=1}^{6}(y_i - \\hat{y}_i)^2 = (4-5)^2 + (6-5)^2 + (8-9)^2 + (10-9)^2 + (5-4)^2 + (3-4)^2 $$\n$$ \\mathrm{SSE} = (-1)^2 + 1^2 + (-1)^2 + 1^2 + 1^2 + (-1)^2 = 1+1+1+1+1+1 = 6 $$\n最后，我们计算决定系数 $R^2$：\n$$ R^2 = 1 - \\frac{\\mathrm{SSE}}{\\mathrm{SST}} = 1 - \\frac{6}{34} = 1 - \\frac{3}{17} = \\frac{14}{17} $$\n\n现在，我们按要求演示每种编码方案的计算。响应向量为 $\\mathbf{y} = (4, 6, 8, 10, 5, 3)^{\\top}$。\n\n**1. 以 $L_1$ 为参考的处理（虚拟）编码**\n\n模型是 $y_i = \\beta_0 + \\beta_1 D_{i2} + \\beta_2 D_{i3} + \\varepsilon_i$。设计矩阵 $\\mathbf{X}_D$ 为：\n$$ \\mathbf{X}_D = \\begin{pmatrix} 1  0  0 \\\\ 1  0  0 \\\\ 1  1  0 \\\\ 1  1  0 \\\\ 1  0  1 \\\\ 1  0  1 \\end{pmatrix} $$\n我们计算 $\\mathbf{X}_D^{\\top}\\mathbf{X}_D$ 和 $\\mathbf{X}_D^{\\top}\\mathbf{y}$：\n$$ \\mathbf{X}_D^{\\top}\\mathbf{X}_D = \\begin{pmatrix} 6  2  2 \\\\ 2  2  0 \\\\ 2  0  2 \\end{pmatrix}, \\quad \\mathbf{X}_D^{\\top}\\mathbf{y} = \\begin{pmatrix} 36 \\\\ 18 \\\\ 8 \\end{pmatrix} $$\n$\\mathbf{X}_D^{\\top}\\mathbf{X}_D$ 的逆矩阵是：\n$$ (\\mathbf{X}_D^{\\top}\\mathbf{X}_D)^{-1} = \\frac{1}{8}\\begin{pmatrix} 4  -4  -4 \\\\ -4  8  4 \\\\ -4  4  8 \\end{pmatrix} = \\begin{pmatrix} 1/2  -1/2  -1/2 \\\\ -1/2  1  1/2 \\\\ -1/2  1/2  1 \\end{pmatrix} $$\nOLS系数是：\n$$ \\hat{\\boldsymbol{\\beta}}_D = (\\mathbf{X}_D^{\\top}\\mathbf{X}_D)^{-1}\\mathbf{X}_D^{\\top}\\mathbf{y} = \\begin{pmatrix} 1/2  -1/2  -1/2 \\\\ -1/2  1  1/2 \\\\ -1/2  1/2  1 \\end{pmatrix} \\begin{pmatrix} 36 \\\\ 18 \\\\ 8 \\end{pmatrix} = \\begin{pmatrix} 18 - 9 - 4 \\\\ -18 + 18 + 4 \\\\ -18 + 9 + 8 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 4 \\\\ -1 \\end{pmatrix} $$\n拟合值为 $\\hat{\\mathbf{y}}_D = \\mathbf{X}_D\\hat{\\boldsymbol{\\beta}}_D$：\n$$ \\hat{\\mathbf{y}}_D = \\begin{pmatrix} 1  0  0 \\\\ 1  0  0 \\\\ 1  1  0 \\\\ 1  1  0 \\\\ 1  0  1 \\\\ 1  0  1 \\end{pmatrix} \\begin{pmatrix} 5 \\\\ 4 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\\\ 5+4 \\\\ 5+4 \\\\ 5-1 \\\\ 5-1 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\\\ 9 \\\\ 9 \\\\ 4 \\\\ 4 \\end{pmatrix} $$\n这些确实是组均值。\n\n**2. 效应（和为零）编码**\n\n模型是 $y_i = \\beta_0 + \\beta_1 E_{i1} + \\beta_2 E_{i2} + \\varepsilon_i$。设计矩阵 $\\mathbf{X}_E$ 为：\n$$ \\mathbf{X}_E = \\begin{pmatrix} 1  -1  -1 \\\\ 1  -1  -1 \\\\ 1  1  0 \\\\ 1  1  0 \\\\ 1  0  1 \\\\ 1  0  1 \\end{pmatrix} $$\n我们计算 $\\mathbf{X}_E^{\\top}\\mathbf{X}_E$ 和 $\\mathbf{X}_E^{\\top}\\mathbf{y}$：\n$$ \\mathbf{X}_E^{\\top}\\mathbf{X}_E = \\begin{pmatrix} 6  0  0 \\\\ 0  4  2 \\\\ 0  2  4 \\end{pmatrix}, \\quad \\mathbf{X}_E^{\\top}\\mathbf{y} = \\begin{pmatrix} 36 \\\\ 8 \\\\ -2 \\end{pmatrix} $$\n逆矩阵是 $(\\mathbf{X}_E^{\\top}\\mathbf{X}_E)^{-1} = \\frac{1}{72}\\begin{pmatrix} 12  0  0 \\\\ 0  24  -12 \\\\ 0  -12  24 \\end{pmatrix} = \\begin{pmatrix} 1/6  0  0 \\\\ 0  1/3  -1/6 \\\\ 0  -1/6  1/3 \\end{pmatrix}$。\nOLS系数是：\n$$ \\hat{\\boldsymbol{\\beta}}_E = \\begin{pmatrix} 1/6  0  0 \\\\ 0  1/3  -1/6 \\\\ 0  -1/6  1/3 \\end{pmatrix} \\begin{pmatrix} 36 \\\\ 8 \\\\ -2 \\end{pmatrix} = \\begin{pmatrix} 6 \\\\ 8/3 + 2/6 \\\\ -8/6 - 2/3 \\end{pmatrix} = \\begin{pmatrix} 6 \\\\ 3 \\\\ -2 \\end{pmatrix} $$\n拟合值为 $\\hat{\\mathbf{y}}_E = \\mathbf{X}_E\\hat{\\boldsymbol{\\beta}}_E$：\n$$ \\hat{\\mathbf{y}}_E = \\begin{pmatrix} 1  -1  -1 \\\\ 1  -1  -1 \\\\ 1  1  0 \\\\ 1  1  0 \\\\ 1  0  1 \\\\ 1  0  1 \\end{pmatrix} \\begin{pmatrix} 6 \\\\ 3 \\\\ -2 \\end{pmatrix} = \\begin{pmatrix} 6 - 3 + 2 \\\\ 6 - 3 + 2 \\\\ 6 + 3 + 0 \\\\ 6 + 3 + 0 \\\\ 6 + 0 - 2 \\\\ 6 + 0 - 2 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\\\ 9 \\\\ 9 \\\\ 4 \\\\ 4 \\end{pmatrix} $$\n拟合值与前一种情况相同。\n\n**3. Helmert 编码**\n\n模型是 $y_i = \\beta_0 + \\beta_1 H_{i1} + \\beta_2 H_{i2} + \\varepsilon_i$。设计矩阵是 $\\mathbf{X}_H$：\n$$ \\mathbf{X}_H = \\begin{pmatrix} 1  -1  -1 \\\\ 1  -1  -1 \\\\ 1  1  -1 \\\\ 1  1  -1 \\\\ 1  0  2 \\\\ 1  0  2 \\end{pmatrix} $$\n对应于对比 $H_1$ 和 $H_2$ 的列彼此正交，并且也与截距列正交。因此，$\\mathbf{X}_H^{\\top}\\mathbf{X}_H$ 是一个对角矩阵。\n$$ \\mathbf{X}_H^{\\top}\\mathbf{X}_H = \\begin{pmatrix} 6  0  0 \\\\ 0  4  0 \\\\ 0  0  12 \\end{pmatrix}, \\quad \\mathbf{X}_H^{\\top}\\mathbf{y} = \\begin{pmatrix} 36 \\\\ 8 \\\\ -12 \\end{pmatrix} $$\n逆矩阵是平凡的：$(\\mathbf{X}_H^{\\top}\\mathbf{X}_H)^{-1} = \\begin{pmatrix} 1/6  0  0 \\\\ 0  1/4  0 \\\\ 0  0  1/12 \\end{pmatrix}$。\nOLS系数是：\n$$ \\hat{\\boldsymbol{\\beta}}_H = \\begin{pmatrix} 1/6  0  0 \\\\ 0  1/4  0 \\\\ 0  0  1/12 \\end{pmatrix} \\begin{pmatrix} 36 \\\\ 8 \\\\ -12 \\end{pmatrix} = \\begin{pmatrix} 6 \\\\ 2 \\\\ -1 \\end{pmatrix} $$\n拟合值为 $\\hat{\\mathbf{y}}_H = \\mathbf{X}_H\\hat{\\boldsymbol{\\beta}}_H$：\n$$ \\hat{\\mathbf{y}}_H = \\begin{pmatrix} 1  -1  -1 \\\\ 1  -1  -1 \\\\ 1  1  -1 \\\\ 1  1  -1 \\\\ 1  0  2 \\\\ 1  0  2 \\end{pmatrix} \\begin{pmatrix} 6 \\\\ 2 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 6-2+1 \\\\ 6-2+1 \\\\ 6+2+1 \\\\ 6+2+1 \\\\ 6-2 \\\\ 6-2 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\\\ 9 \\\\ 9 \\\\ 4 \\\\ 4 \\end{pmatrix} $$\n拟合值再次相同。\n\n如上所示，虽然系数向量 $\\hat{\\boldsymbol{\\beta}}_D$、$\\hat{\\boldsymbol{\\beta}}_E$ 和 $\\hat{\\boldsymbol{\\beta}}_H$ 在数值上不同且有不同的解释，但它们都产生相同的拟合值向量 $\\hat{\\mathbf{y}}$。这证实了理论原理，即 $\\mathbf{y}$ 在模型列空间上的投影对于该空间基的选择是不变的。由于 $\\hat{\\mathbf{y}}$ 是不变的，$\\mathrm{SSE}$ 和 $R^2$ 也是不变的。\n\n$R^2$ 的最终数值为 $\\frac{14}{17} \\approx 0.8235294...$。四舍五入到四位有效数字，结果是 $0.8235$。",
            "answer": "$$ \\boxed{0.8235} $$"
        },
        {
            "introduction": "将线性模型的概念扩展到逻辑回归时，系数的解释从均值差异转变为对数比值比（log-odds ratio）。本练习将挑战您处理一个具有三水平分类预测变量的逻辑回归模型。您需要推导并计算两个非参考水平之间的比值比（Odds Ratio, OR），而不仅仅是依赖于软件输出的默认参考水平比较。通过这个实践，您将深化对逻辑回归系数的精确含义的理解，并掌握使用delta方法估计其标准误的关键技能。",
            "id": "4899234",
            "problem": "一项临床研究将重症监护室中表示28天死亡率的二元结局 $Y$ 的概率，建模为一个3水平暴露 $A \\in \\{1,2,3\\}$ 和一个连续混杂变量 $Z$（严重程度评分）的函数。建模方法是逻辑斯蒂回归，采用处理编码 (treatment coding)，并以水平 $A=1$ 为基线。模型中没有交互作用项。拟合的模型为\n$$\n\\operatorname{logit}\\!\\left\\{ \\Pr(Y=1 \\mid A,Z) \\right\\} \\;=\\; \\beta_0 \\;+\\; \\beta_2 \\,\\mathbf{1}(A=2) \\;+\\; \\beta_3 \\,\\mathbf{1}(A=3) \\;+\\; \\gamma Z,\n$$\n其中 $\\mathbf{1}(\\cdot)$ 是指示函数。最大似然估计值及其估计的协方差矩阵如下：\n$$\n\\widehat{\\boldsymbol{\\theta}} \\;=\\; \\big(\\widehat{\\beta}_0,\\, \\widehat{\\beta}_2,\\, \\widehat{\\beta}_3,\\, \\widehat{\\gamma}\\big)^{\\top} \\;=\\; (-1.10,\\, 0.40,\\, 0.95,\\, 0.30)^{\\top},\n$$\n$$\n\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\theta}}) \\;=\\; \n\\begin{pmatrix}\n0.0900  -0.0100  -0.0150  0.0050\\\\\n-0.0100  0.0324  0.0120  -0.0060\\\\\n-0.0150  0.0120  0.0484  -0.0080\\\\\n0.0050  -0.0060  -0.0080  0.0225\n\\end{pmatrix}.\n$$\n从逻辑斯蒂回归模型和比值比的定义出发，且不引用任何预先陈述的捷径结果，推导比较 $A=3$ 与 $A=2$ 的比值比的闭式表达式，并以处理编码的系数表示。然后，使用所提供的估计值和协方差矩阵，计算：\n- 该比值比的最大似然估计值，以及\n- 对数比值比和比值比的delta方法标准误 (SE)。\n\n将所有数值四舍五入至四位有效数字，并将标准误以小数表示。重要提示：对于此问题的最终回答，仅报告比值比的闭式符号表达式作为您的最终答案；最终答案中不应包含任何数值。",
            "solution": "首先验证问题的正确性和完整性。\n\n**步骤1：提取已知条件**\n- 结局变量：$Y$，表示28天死亡率的二元变量。\n- 暴露变量：$A$，一个3水平的分类变量，$A \\in \\{1, 2, 3\\}$。\n- 混杂变量：$Z$，一个连续的严重程度评分。\n- 模型：一个由下式给出的逻辑斯蒂回归模型\n$$\n\\operatorname{logit}\\!\\left\\{ \\Pr(Y=1 \\mid A,Z) \\right\\} \\;=\\; \\beta_0 \\;+\\; \\beta_2 \\,\\mathbf{1}(A=2) \\;+\\; \\beta_3 \\,\\mathbf{1}(A=3) \\;+\\; \\gamma Z\n$$\n其中 $\\mathbf{1}(\\cdot)$ 是指示函数，且水平 $A=1$ 是参考类别。\n- 参数的最大似然估计值：\n$$\n\\widehat{\\boldsymbol{\\theta}} \\;=\\; \\big(\\widehat{\\beta}_0,\\, \\widehat{\\beta}_2,\\, \\widehat{\\beta}_3,\\, \\widehat{\\gamma}\\big)^{\\top} \\;=\\; (-1.10,\\, 0.40,\\, 0.95,\\, 0.30)^{\\top}\n$$\n- 估计量的估计协方差矩阵：\n$$\n\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\theta}}) \\;=\\; \n\\begin{pmatrix}\n0.0900  -0.0100  -0.0150  0.0050\\\\\n-0.0100  0.0324  0.0120  -0.0060\\\\\n-0.0150  0.0120  0.0484  -0.0080\\\\\n0.0050  -0.0060  -0.0080  0.0225\n\\end{pmatrix}\n$$\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 此问题基于逻辑斯蒂回归、最大似然估计和delta方法，这些都是生物统计学中的基本和标准概念。该设定在科学上是合理的。\n- **适定性：** 此问题是适定的。它提供了一个清晰的模型、所有必要的参数估计值及其协方差矩阵。任务是具体的，并且可以导出唯一的解。\n- **客观性：** 此问题以精确且客观的数学语言陈述，没有歧义或主观陈述。\n- **完整性与一致性：** 此问题是自足的。所提供的协方差矩阵是对称的，且其对角线元素（方差）为正，这与有效协方差矩阵的性质一致。\n- **其他缺陷：** 此问题是统计理论的标准应用，没有表现出任何其他缺陷，例如琐碎、赘述或无法验证。\n\n**步骤3：结论与行动**\n此问题有效。有必要提供完整解法。\n\n**比值比表达式的推导**\n\n结局的优势（odds）定义为 $\\text{Odds} = \\frac{\\Pr(Y=1)}{1-\\Pr(Y=1)}$。逻辑斯蒂回归模型表明，优势的自然对数（logit）是预测变量的线性函数：\n$$\n\\ln\\left(\\frac{\\Pr(Y=1 \\mid A,Z)}{1-\\Pr(Y=1 \\mid A,Z)}\\right) = \\beta_0 + \\beta_2 \\mathbf{1}(A=2) + \\beta_3 \\mathbf{1}(A=3) + \\gamma Z\n$$\n对两边取指数，我们得到优势：\n$$\n\\text{Odds}(A,Z) = \\exp\\left(\\beta_0 + \\beta_2 \\mathbf{1}(A=2) + \\beta_3 \\mathbf{1}(A=3) + \\gamma Z\\right)\n$$\n比较暴露水平 $A=3$ 与 $A=2$ 的比值比（$\\text{OR}$），是在将混杂变量 $Z$ 保持在任意水平 $z$ 不变的情况下，它们各自优势的比值：\n$$\n\\text{OR}_{3 \\text{ vs } 2} = \\frac{\\text{Odds}(A=3, Z=z)}{\\text{Odds}(A=2, Z=z)}\n$$\n对于一个 $A=3$ 且 $Z=z$ 的受试者，指示函数为 $\\mathbf{1}(A=2)=0$ 和 $\\mathbf{1}(A=3)=1$。其优势为：\n$$\n\\text{Odds}(A=3, Z=z) = \\exp(\\beta_0 + \\beta_2(0) + \\beta_3(1) + \\gamma z) = \\exp(\\beta_0 + \\beta_3 + \\gamma z)\n$$\n对于一个 $A=2$ 且 $Z=z$ 的受试者，指示函数为 $\\mathbf{1}(A=2)=1$ 和 $\\mathbf{1}(A=3)=0$。其优势为：\n$$\n\\text{Odds}(A=2, Z=z) = \\exp(\\beta_0 + \\beta_2(1) + \\beta_3(0) + \\gamma z) = \\exp(\\beta_0 + \\beta_2 + \\gamma z)\n$$\n比值比是这两个表达式的比值：\n$$\n\\text{OR}_{3 \\text{ vs } 2} = \\frac{\\exp(\\beta_0 + \\beta_3 + \\gamma z)}{\\exp(\\beta_0 + \\beta_2 + \\gamma z)}\n$$\n使用指数的性质 $\\frac{\\exp(a)}{\\exp(b)} = \\exp(a-b)$，我们得到：\n$$\n\\text{OR}_{3 \\text{ vs } 2} = \\exp\\left( (\\beta_0 + \\beta_3 + \\gamma z) - (\\beta_0 + \\beta_2 + \\gamma z) \\right) = \\exp(\\beta_3 - \\beta_2)\n$$\n这就是所要求的闭式表达式。\n\n**数值计算**\n\n1.  **比值比的最大似然估计值：**\n根据最大似然估计量（MLEs）的不变性，$\\text{OR}_{3 \\text{ vs } 2}$ 的最大似然估计值是将在参数的最大似然估计值代入表达式中得到的：\n$$\n\\widehat{\\text{OR}}_{3 \\text{ vs } 2} = \\exp(\\widehat{\\beta}_3 - \\widehat{\\beta}_2)\n$$\n使用给定的值 $\\widehat{\\beta}_2 = 0.40$ 和 $\\widehat{\\beta}_3 = 0.95$：\n$$\n\\widehat{\\text{OR}}_{3 \\text{ vs } 2} = \\exp(0.95 - 0.40) = \\exp(0.55) \\approx 1.73325\n$$\n四舍五入至四位有效数字，估计的比值比为 $1.733$。\n\n2.  **对数比值比的标准误：**\n令 $\\lambda = \\beta_3 - \\beta_2$ 为对数比值比。其最大似然估计值为 $\\widehat{\\lambda} = \\widehat{\\beta}_3 - \\widehat{\\beta}_2$。这个估计量线性组合的方差为：\n$$\n\\operatorname{Var}(\\widehat{\\lambda}) = \\operatorname{Var}(\\widehat{\\beta}_3 - \\widehat{\\beta}_2) = \\operatorname{Var}(\\widehat{\\beta}_3) + \\operatorname{Var}(\\widehat{\\beta}_2) - 2\\operatorname{Cov}(\\widehat{\\beta}_2, \\widehat{\\beta}_3)\n$$\n从所提供的协方差矩阵 $\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\theta}})$ 中，我们提取所需的估计方差和协方差：\n$\\widehat{\\operatorname{Var}}(\\widehat{\\beta}_2) = 0.0324$ (元素 $(2,2)$)\n$\\widehat{\\operatorname{Var}}(\\widehat{\\beta}_3) = 0.0484$ (元素 $(3,3)$)\n$\\widehat{\\operatorname{Cov}}(\\widehat{\\beta}_2, \\widehat{\\beta}_3) = 0.0120$ (元素 $(2,3)$)\n代入这些值：\n$$\n\\widehat{\\operatorname{Var}}(\\widehat{\\lambda}) = 0.0484 + 0.0324 - 2(0.0120) = 0.0808 - 0.0240 = 0.0568\n$$\n标准误（SE）是方差的平方根：\n$$\n\\text{SE}(\\widehat{\\lambda}) = \\sqrt{\\widehat{\\operatorname{Var}}(\\widehat{\\lambda})} = \\sqrt{0.0568} \\approx 0.2383275\n$$\n四舍五入至四位有效数字，$\\text{SE}(\\widehat{\\lambda}) = 0.2383$。\n\n3.  **比值比的标准误：**\n我们使用delta方法来求比值比的近似标准误。比值比是对数比值比 $\\lambda$ 的函数 $g(\\lambda) = \\exp(\\lambda)$。近似方差由 $\\operatorname{Var}(g(\\widehat{\\lambda})) \\approx [g'(\\lambda)]^2 \\operatorname{Var}(\\widehat{\\lambda})$ 给出，并在估计值处求值。\n导函数为 $g'(\\lambda) = \\exp(\\lambda)$。在估计值 $\\widehat{\\lambda}$ 处，其值为 $g'(\\widehat{\\lambda}) = \\exp(\\widehat{\\lambda}) = \\widehat{\\text{OR}}$。\n比值比的估计方差为：\n$$\n\\widehat{\\operatorname{Var}}(\\widehat{\\text{OR}}) \\approx (\\widehat{\\text{OR}})^2 \\widehat{\\operatorname{Var}}(\\widehat{\\lambda})\n$$\n标准误是其平方根：\n$$\n\\text{SE}(\\widehat{\\text{OR}}) \\approx \\sqrt{(\\widehat{\\text{OR}})^2 \\widehat{\\operatorname{Var}}(\\widehat{\\lambda})} = |\\widehat{\\text{OR}}| \\sqrt{\\widehat{\\operatorname{Var}}(\\widehat{\\lambda})} = \\widehat{\\text{OR}} \\times \\text{SE}(\\widehat{\\lambda})\n$$\n（因为比值比为正）。使用先前计算的值：\n$$\n\\text{SE}(\\widehat{\\text{OR}}) \\approx 1.73325 \\times 0.2383275 \\approx 0.413088\n$$\n四舍五入至四位有效数字，$\\text{SE}(\\widehat{\\text{OR}}) = 0.4131$。",
            "answer": "$$\n\\boxed{\\exp(\\beta_3 - \\beta_2)}\n$$"
        },
        {
            "introduction": "在生物统计学研究中，我们常常关心治疗效果是否在不同亚组中保持一致，即是否存在交互作用（或效应修饰）。当一个亚组变量是多水平分类变量时，我们需要联合检验所有相关的交互项，以评估整体交互作用的显著性。本练习将指导您如何在一个包含交互项的逻辑回归模型中，构建并执行多变量沃尔德检验（Multivariate Wald Test），以正式检验一个二元治疗变量与一个多水平生物标志物之间的交互效应。",
            "id": "4899236",
            "problem": "一项随机流行病学研究调查了二元处理指标 $A \\in \\{0,1\\}$ 与二元临床结局 $Y \\in \\{0,1\\}$ 之间的关联是否因具有 $J=4$ 个水平 $\\{B_{1},B_{2},B_{3},B_{4}\\}$ 的分类生物标志物 $B$ 的水平而异，同时对连续混杂因素 $C$ 进行了调整。使用 logit 链接的逻辑斯蒂广义线性模型 (GLM) 进行了拟合，其中对 $B$ 使用了参考单元格编码（以 $B_{1}$ 为参考水平），并包含了 $A$ 和 $B$ 之间的一阶交互作用。该模型为\n$$\n\\log\\left(\\frac{\\Pr(Y=1 \\mid A,B,C)}{1-\\Pr(Y=1 \\mid A,B,C)}\\right)\n=\n\\beta_{0}+\\beta_{A}A+\\beta_{B_{2}}\\mathbf{1}(B=B_{2})+\\beta_{B_{3}}\\mathbf{1}(B=B_{3})+\\beta_{B_{4}}\\mathbf{1}(B=B_{4})\n+\\beta_{AB_{2}}\\,A\\,\\mathbf{1}(B=B_{2})+\\beta_{AB_{3}}\\,A\\,\\mathbf{1}(B=B_{3})+\\beta_{AB_{4}}\\,A\\,\\mathbf{1}(B=B_{4})\n+\\beta_{C}C.\n$$\n设回归系数向量的顺序为\n$$\n\\boldsymbol{\\beta}=\n\\begin{pmatrix}\n\\beta_{0}  \\beta_{A}  \\beta_{B_{2}}  \\beta_{B_{3}}  \\beta_{B_{4}}  \\beta_{AB_{2}}  \\beta_{AB_{3}}  \\beta_{AB_{4}}  \\beta_{C}\n\\end{pmatrix}^{\\top}.\n$$\n您感兴趣的是检验在对数比值比尺度上 $A$ 和 $B$ 之间是否存在任何交互作用。请构建所有交互作用项均为零的原假设。然后，使用基于最大似然估计 (MLE) 的沃尔德检验 (Wald test)，构建适当的对比矩阵，以联合检验这些交互作用项，其自由度等于 $J-1$。\n\n从拟合的模型中，估计的交互作用系数及其估计的协方差矩阵为：\n$$\n\\widehat{\\boldsymbol{\\beta}}_{AB}=\n\\begin{pmatrix}\n\\widehat{\\beta}_{AB_{2}} \\\\\n\\widehat{\\beta}_{AB_{3}} \\\\\n\\widehat{\\beta}_{AB_{4}}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0.42 \\\\\n-0.18 \\\\\n0.30\n\\end{pmatrix},\n\\qquad\n\\widehat{\\boldsymbol{\\Sigma}}_{AB}=\n\\begin{pmatrix}\n0.040  0.005  -0.004 \\\\\n0.005  0.050  0.006 \\\\\n-0.004  0.006  0.045\n\\end{pmatrix}.\n$$\n使用大样本沃尔德检验 (Wald test) 来计算交互作用的检验统计量，所选取的对比应针对这三个交互作用系数。请明确指定相对于上述 $\\boldsymbol{\\beta}$ 顺序的对比矩阵，然后计算沃尔德检验统计量\n$$\nW=(\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}})^{\\top}\\left[\\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top}\\right]^{-1}(\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}}),\n$$\n请注意，$\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 是交互作用项的子矩阵 $\\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top}$。请说明自由度并报告 $W$ 的值。\n\n将您最终的 $W$ 数值答案四舍五入到四位有效数字。您提供的最终答案必须仅为沃尔德统计量 $W$，不带单位。",
            "solution": "该问题要求对处理 $A$ 和分类生物标志物 $B$ 之间的交互作用进行联合检验。指定的逻辑斯蒂回归模型包含了用于此交互作用的项。\n\n首先，我们构建原假设。$A$ 和 $B$ 之间的交互作用由系数 $\\beta_{AB_{j}}$（其中 $j=2, 3, 4$）捕获。由于使用了参考单元格编码方案，参考水平的交互作用项 $\\beta_{AB_{1}}$ 在结构上为零。因此，无交互作用的原假设是所有非冗余的交互作用系数同时为零。\n$$ H_{0}: \\beta_{AB_{2}} = 0, \\beta_{AB_{3}} = 0, \\beta_{AB_{4}} = 0. $$\n这可以写成矩阵形式 $\\mathbf{C}\\boldsymbol{\\beta} = \\mathbf{0}$，其中 $\\mathbf{C}$ 是一个对比矩阵，$\\boldsymbol{\\beta}$ 是所有模型系数的向量。\n\n完整的系数向量 $\\boldsymbol{\\beta}$ 是一个 $9 \\times 1$ 的向量，其顺序为：\n$$ \\boldsymbol{\\beta} = \\begin{pmatrix} \\beta_{0}  \\beta_{A}  \\beta_{B_{2}}  \\beta_{B_{3}}  \\beta_{B_{4}}  \\beta_{AB_{2}}  \\beta_{AB_{3}}  \\beta_{AB_{4}}  \\beta_{C} \\end{pmatrix}^{\\top} $$\n我们感兴趣的系数 $\\beta_{AB_{2}}$、$\\beta_{AB_{3}}$ 和 $\\beta_{AB_{4}}$ 是该向量的第6、第7和第8个元素。为了检验这三个系数为零的原假设，我们构建一个 $3 \\times 9$ 的对比矩阵 $\\mathbf{C}$，其中每一行选择这些系数中的一个。\n$$ \\mathbf{C} = \\begin{pmatrix} 0  0  0  0  0  1  0  0  0 \\\\ 0  0  0  0  0  0  1  0  0 \\\\ 0  0  0  0  0  0  0  1  0 \\end{pmatrix} $$\n该检验的自由度等于 $\\mathbf{C}$ 的行数，也就是联合检验的参数数量。在这里，生物标志物 $B$ 有 $J=4$ 个水平，因此有 $J-1=3$ 个交互作用项。自由度为 $3$。\n\n大样本沃尔德检验统计量由以下公式给出：\n$$ W = (\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}})^{\\top}\\left[\\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top}\\right]^{-1}(\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}}) $$\n根据我们对 $\\mathbf{C}$ 的定义：\n- 项 $\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}}$ 提取了估计的交互作用系数：\n$$ \\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}} = \\begin{pmatrix} \\widehat{\\beta}_{AB_{2}} \\\\ \\widehat{\\beta}_{AB_{3}} \\\\ \\widehat{\\beta}_{AB_{4}} \\end{pmatrix} = \\widehat{\\boldsymbol{\\beta}}_{AB} = \\begin{pmatrix} 0.42 \\\\ -0.18 \\\\ 0.30 \\end{pmatrix} $$\n- 项 $\\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top}$ 提取了与这些交互作用系数相对应的完整协方差矩阵的子矩阵。该子矩阵在问题中已作为 $\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 给出：\n$$ \\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top} = \\widehat{\\boldsymbol{\\Sigma}}_{AB} = \\begin{pmatrix} 0.040  0.005  -0.004 \\\\ 0.005  0.050  0.006 \\\\ -0.004  0.006  0.045 \\end{pmatrix} $$\n因此，沃尔德统计量的计算简化为：\n$$ W = \\widehat{\\boldsymbol{\\beta}}_{AB}^{\\top} \\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1} \\widehat{\\boldsymbol{\\beta}}_{AB} $$\n我们必须首先计算 $\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 的逆矩阵。$\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 的行列式为：\n$$ \\det(\\widehat{\\boldsymbol{\\Sigma}}_{AB}) = 0.040(0.050 \\times 0.045 - 0.006 \\times 0.006) - 0.005(0.005 \\times 0.045 - 0.006 \\times (-0.004)) + (-0.004)(0.005 \\times 0.006 - 0.050 \\times (-0.004)) $$\n$$ \\det(\\widehat{\\boldsymbol{\\Sigma}}_{AB}) = 0.040(0.002214) - 0.005(0.000249) - 0.004(0.000230) $$\n$$ \\det(\\widehat{\\boldsymbol{\\Sigma}}_{AB}) = 0.00008856 - 0.000001245 - 0.00000092 = 0.000086395 $$\n伴随矩阵 $\\operatorname{adj}(\\widehat{\\boldsymbol{\\Sigma}}_{AB})$ 是代数余子式矩阵的转置。由于 $\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 是对称的，其代数余子式矩阵也是对称的，因此等于伴随矩阵。\n$$ \\operatorname{adj}(\\widehat{\\boldsymbol{\\Sigma}}_{AB}) = \\begin{pmatrix} 0.002214  -0.000249  0.000230 \\\\ -0.000249  0.001784  -0.000260 \\\\ 0.000230  -0.000260  0.001975 \\end{pmatrix} $$\n逆矩阵为 $\\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1} = \\frac{1}{\\det(\\widehat{\\boldsymbol{\\Sigma}}_{AB})} \\operatorname{adj}(\\widehat{\\boldsymbol{\\Sigma}}_{AB})$：\n$$ \\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1} = \\frac{1}{0.000086395} \\begin{pmatrix} 0.002214  -0.000249  0.000230 \\\\ -0.000249  0.001784  -0.000260 \\\\ 0.000230  -0.000260  0.001975 \\end{pmatrix} \\approx \\begin{pmatrix} 25.6263  -2.8821  2.6622 \\\\ -2.8821  20.6493  -3.0094 \\\\ 2.6622  -3.0094  22.8601 \\end{pmatrix} $$\n现在我们计算 $W$ 的二次型：\n$$ W = \\begin{pmatrix} 0.42  -0.18  0.30 \\end{pmatrix} \\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1} \\begin{pmatrix} 0.42 \\\\ -0.18 \\\\ 0.30 \\end{pmatrix} $$\n首先，我们计算乘积 $\\widehat{\\boldsymbol{\\beta}}_{AB}^{\\top} \\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1}$：\n$$ \\begin{pmatrix} 0.42  -0.18  0.30 \\end{pmatrix} \\begin{pmatrix} 25.6263  -2.8821  2.6622 \\\\ -2.8821  20.6493  -3.0094 \\\\ 2.6622  -3.0094  22.8601 \\end{pmatrix} $$\n这给出了一个行向量：\n$$ \\approx \\begin{pmatrix} (10.7630 + 0.5188 + 0.7987)  (-1.2105 - 3.7169 - 0.9028)  (1.1181 + 0.5417 + 6.8580) \\end{pmatrix} $$\n$$ \\approx \\begin{pmatrix} 12.0805  -5.8302  8.5178 \\end{pmatrix} $$\n最后，我们将此行向量乘以 $\\widehat{\\boldsymbol{\\beta}}_{AB}$：\n$$ W \\approx \\begin{pmatrix} 12.0805  -5.8302  8.5178 \\end{pmatrix} \\begin{pmatrix} 0.42 \\\\ -0.18 \\\\ 0.30 \\end{pmatrix} $$\n$$ W \\approx 12.0805 \\times 0.42 + (-5.8302) \\times (-0.18) + 8.5178 \\times 0.30 $$\n$$ W \\approx 5.07381 + 1.04944 + 2.55534 = 8.67859 $$\n在原假设下，$W$ 服从自由度为 $3$ 的卡方分布。计算出的统计量值约为 $8.67859$。\n四舍五入到四位有效数字，我们得到 $W = 8.679$。",
            "answer": "$$\n\\boxed{8.679}\n$$"
        }
    ]
}