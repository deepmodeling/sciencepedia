{
    "hands_on_practices": [
        {
            "introduction": "在进行任何统计检验之前，最关键的第一步是精确地构建我们的原假设和备择假设。与许多参数检验不同，Mann-Whitney U 检验的核心并非仅仅比较均值或中位数，而是比较两个群体的整体分布。这项练习将帮助你掌握如何用累积分布函数（CDF）来表述假设，特别是理解“随机优势”（stochastic dominance）这一核心概念，它揭示了该检验真正的威力。",
            "id": "1962407",
            "problem": "一家生物技术公司开发了一种新的基因工程微生物，旨在增强水培植物的营养吸收。为了测试其有效性，研究人员对一批生菜幼苗进行了一项实验。幼苗被随机分为两组。第一组是“处理组”，在含有新微生物的营养液中生长。第二组是“对照组”，在不含微生物的相同营养液中生长。\n\n经过30天的生长期后，测量每株植物的生物量产量（单位：克/株）。由于研究人员没有理由假设任何一组的产量数据会服从正态分布，他们决定使用非参数检验。他们希望进行单尾曼-惠特尼U检验（也称为威尔科克森秩和检验），以确定是否有足够的统计证据得出新微生物能*随机增加*作物产量的结论。\n\n设 $F_T(y)$ 和 $F_C(y)$ 分别表示处理组和对照组群体的生物量产量的累积分布函数（CDF）。以下哪个选项正确地表示了本次研究的原假设（$H_0$）和备择假设（$H_a$）？\n\nA.\n$H_0$: $F_T(y) = F_C(y)$ for all $y$.\n$H_a$: $F_T(y) \\le F_C(y)$ for all $y$, and $F_T(y)  F_C(y)$ for some $y$.\n\nB.\n$H_0$: $F_T(y) = F_C(y)$ for all $y$.\n$H_a$: $F_T(y) \\ge F_C(y)$ for all $y$, and $F_T(y) > F_C(y)$ for some $y$.\n\nC.\n$H_0$: $F_T(y) = F_C(y)$ for all $y$.\n$H_a$: $F_T(y) \\neq F_C(y)$ for some $y$.\n\nD.\n设 $\\mu_T$ 和 $\\mu_C$ 分别为处理组和对照组群体的平均产量。\n$H_0$: $\\mu_T = \\mu_C$.\n$H_a$: $\\mu_T > \\mu_C$.\n\nE.\n$H_0$: $F_T(y) \\le F_C(y)$ for all $y$, and $F_T(y)  F_C(y)$ for some $y$.\n$H_a$: $F_T(y) = F_C(y)$ for all $y$.",
            "solution": "本次假设检验的目标是确定新微生物是否随机增加作物产量。我们将为曼-惠特尼U检验构建原假设和备择假设，这是一种用于比较两个独立分布的非参数检验。\n\n首先，我们建立原假设（$H_0$）。原假设代表了两组之间没有效应或没有差异的默认立场。在使用累积分布函数（CDF）比较分布的背景下，没有差异的陈述即两个分布是相同的。因此，对于所有可能的产量值 $y$，处理组产量的CDF，$F_T(y)$，等于对照组产量的CDF，$F_C(y)$。\n$$H_0: F_T(y) = F_C(y) \\text{ for all } y$$\n\n接下来，我们建立备择假设（$H_a$）。备择假设应反映研究问题，即微生物是否*随机增加*了产量。设 $Y_T$ 为处理组产量的随机变量，$Y_C$ 为对照组产量的随机变量。“$Y_T$ 随机大于 $Y_C$”的陈述意味着，对于任何给定的产量值 $y$，处理组获得大于 $y$ 的产量的概率高于（或等于）对照组。\n$$P(Y_T > y) \\ge P(Y_C > y) \\text{ for all } y$$\n并且对于至少一个 $y$ 值，该不等式是严格的。\n\n我们可以用CDF来表示这种关系。CDF的定义为 $F(y) = P(Y \\le y)$。一个值大于 $y$ 的概率是其补集，所以 $P(Y > y) = 1 - P(Y \\le y) = 1 - F(y)$。将此代入我们的不等式，得到：\n$$1 - F_T(y) \\ge 1 - F_C(y)$$\n两边减1，得到：\n$$-F_T(y) \\ge -F_C(y)$$\n两边乘以-1，不等号反转：\n$$F_T(y) \\le F_C(y)$$\n这个结果有一个清晰的解释。如果处理组的产量普遍更高，那么对于任何特定的值 $y$，处理组获得*等于或低于*该值的累积概率将小于对照组。因此，对于检验随机增加的单尾检验，其备择假设是：对于所有的 $y$，$F_T(y)$ 小于或等于 $F_C(y)$，并且对于至少一个 $y$，$F_T(y)$ 严格小于 $F_C(y)$。\n$$H_a: F_T(y) \\le F_C(y) \\text{ for all } y, \\text{ and } F_T(y)  F_C(y) \\text{ for some } y$$\n\n现在我们评估给定的选项：\n- 选项A正确地陈述了无差异的原假设以及处理组随机大于对照组的备择假设。这与我们的推导相符。\n- 选项B陈述了一个备择假设 $F_T(y) \\ge F_C(y)$，这将检验处理组的产量是否随机*小于*对照组。这与研究目标相反。\n- 选项C提出了一个双尾备择假设 $F_T(y) \\neq F_C(y)$，它检验的是分布的任何差异，而不仅仅是增加。\n- 选项D用群体均值（$\\mu$）来构建假设。这是不正确的，因为曼-惠特尼U检验是关于分布的非参数检验，而不是像t检验那样关于均值的参数检验。\n- 选项E错误地交换了原假设和备择假设。原假设必须是关于相等或无效应的陈述。\n\n因此，针对这个特定研究问题的正确假设构建方式在选项A中给出。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "虽然统计软件可以为我们即时提供 $p$ 值，但真正理解其背后的计算原理对于做出可靠的科学推断至关重要。这项练习将带你“深入引擎盖”，通过手动计算一个精确的 $p$ 值，来揭示 Mann-Whitney U 检验的组合学本质。通过这个过程，你将清楚地看到 $p$ 值是如何从数据排名和所有可能的排列组合中诞生的。",
            "id": "4934903",
            "problem": "一项临床研究比较了两个独立组间的连续生物标志物。A 组由 $n_A = 3$ 名患者组成，其生物标志物值为 $5.1$、$6.3$ 和 $8.0$。B 组由 $n_B = 4$ 名患者组成，其生物标志物值为 $2.0$、$2.9$、$3.5$ 和 $5.9$。假设该生物标志物是在连续尺度上测量的，并且在零假设下，两组样本均来自同一连续分布。\n\n使用 Wilcoxon 秩和检验框架，构建并进行单尾检验：\n$$H_0: \\text{median}_A = \\text{median}_B \\quad \\text{versus} \\quad H_1: \\text{median}_A > \\text{median}_B.$$\n构建混合秩，计算 A 组的观测 Wilcoxon 秩和统计量，并根据零假设所蕴含的精确随机化分布，计算精确的单尾 $p$ 值\n$$p = \\mathbb{P}_{H_0}\\left(W_A \\geq w_{\\text{obs}}\\right),$$\n其中 $W_A$ 是 A 组的秩和，$w_{\\text{obs}}$ 是根据上述数据得到的观测值。\n\n将 $p$ 值表示为四舍五入到 $4$ 位有效数字的小数。",
            "solution": "用户提供了一个生物统计学问题，要求计算 Wilcoxon 秩和检验的精确单尾 p 值。\n\n### 步骤 1：提取已知信息\n- A 组样本量：$n_A = 3$\n- A 组数据：$5.1, 6.3, 8.0$\n- B 组样本量：$n_B = 4$\n- B 组数据：$2.0, 2.9, 3.5, 5.9$\n- 假设：在零假设 ($H_0$)下，两组样本均来自同一连续分布。\n- 零假设 ($H_0$)：$\\text{median}_A = \\text{median}_B$\n- 备择假设 ($H_1$)：$\\text{median}_A > \\text{median}_B$\n- 任务：计算 A 组的观测 Wilcoxon 秩和统计量 $w_{\\text{obs}}$，以及精确的单尾 p 值 $p = \\mathbb{P}_{H_0}\\left(W_A \\geq w_{\\text{obs}}\\right)$。\n- p 值的要求精度：四舍五入到 $4$ 位有效数字的小数。\n\n### 步骤 2：使用提取的已知信息进行验证\n该问题在科学上和数学上都是合理的。它描述了 Wilcoxon 秩和检验（也称为 Mann-Whitney U 检验）的标准应用，这是一种在统计学中公认的非参数方法。所提供的数据是完整的，足以进行所要求的计算。样本量较小，这使得计算精确 p 值（相对于正态近似）既合适又可行。该问题是适定的、客观的，并且不包含任何矛盾或歧义。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整的解决方案。\n\n### 求解过程\n\nWilcoxon 秩和检验是一种用于比较两个独立样本的非参数检验。该过程包括将两组数据合并，对合并后的数据进行定秩，然后计算其中一组的秩和。\n\n首先，我们将 A 组和 B 组的观测值合并，并按升序排列。总观测数为 $N = n_A + n_B = 3 + 4 = 7$。\n\n合并并排序后的数据为：\n$2.0$ (B), $2.9$ (B), $3.5$ (B), $5.1$ (A), $5.9$ (B), $6.3$ (A), $8.0$ (A)\n\n接下来，我们为这些观测值分配从 $1$ 到 $N_A + N_B = 7$ 的秩次。由于所有数据值都是唯一的，因此没有结 (ties)。\n\n秩次分配如下：\n- 来自 B 组的值 $2.0$ 的秩次为 $1$。\n- 来自 B 组的值 $2.9$ 的秩次为 $2$。\n- 来自 B 组的值 $3.5$ 的秩次为 $3$。\n- 来自 A 组的值 $5.1$ 的秩次为 $4$。\n- 来自 B 组的值 $5.9$ 的秩次为 $5$。\n- 来自 A 组的值 $6.3$ 的秩次为 $6$。\n- 来自 A 组的值 $8.0$ 的秩次为 $7$。\n\nA 组观测值的秩次为 $\\{4, 6, 7\\}$。\nB 组观测值的秩次为 $\\{1, 2, 3, 5\\}$。\n\n检验统计量 $W_A$ 是 A 组的秩和。该统计量的观测值为：\n$$w_{\\text{obs}} = 4 + 6 + 7 = 17$$\n\n问题要求计算备择假设 $H_1: \\text{median}_A > \\text{median}_B$ 的单尾 p 值。该假设表明 A 组的值倾向于大于 B 组的值，这将对应于 A 组有较大的秩次，因此秩和统计量 $W_A$ 的值也较大。因此，p 值是在零假设下，观测到 A 组的秩和至少与观测值 $w_{\\text{obs}} = 17$ 一样大的概率。\n$$p = \\mathbb{P}_{H_0}(W_A \\geq 17)$$\n\n在零假设下，将 $N=7$ 个秩次分配给 A 组中 $n_A=3$ 个个体的所有可能组合都是等可能的。从 $7$ 个可用秩次的集合中选择 $n_A=3$ 个秩次的总方式数由二项式系数给出：\n$$\\text{总组合数} = \\binom{N}{n_A} = \\binom{7}{3} = \\frac{7!}{3!(7-3)!} = \\frac{7 \\times 6 \\times 5}{3 \\times 2 \\times 1} = 35$$\n在 $H_0$ 下，这 $35$ 种组合中的每一种都是等可能的，概率为 $\\frac{1}{35}$。\n\n为了找到 p 值，我们必须计算 $3$ 个秩次（来自集合 $\\{1, 2, 3, 4, 5, 6, 7\\}$）的组合中，其和大于或等于 $17$ 的数量。让我们列举这些“极端”组合：\n\n1.  最大可能的秩和是多少？当 A 组拥有三个最大的秩次时出现：$\\{5, 6, 7\\}$。其和为 $5 + 6 + 7 = 18$。这个和 $\\geq 17$。这算作 $1$ 种组合。\n2.  是否有任何组合的和为 $17$？观测到的组合 $\\{4, 6, 7\\}$ 的和为 $17$。这又算作一种组合。为确保没有其他组合，我们可以系统地推理。如果我们想要和为 $17$，并且我们取了最大的秩次 $7$，那么我们需要另外两个秩次的和为 $10$。这两个秩次必须从 $\\{1, 2, 3, 4, 5, 6\\}$ 中选择。对子 $\\{4, 6\\}$ 可行。对子 $\\{5, 5\\}$ 是不允许的，因为秩次必须是不同的。同理，对子 $\\{3, 7\\}$ 也是不允许的。因此，$\\{4, 6, 7\\}$ 是最大秩次为 $7$ 且和为 $17$ 的唯一组合。如果我们不包括秩次 $7$，最大可能的和将是 $\\{4, 5, 6\\}$，即 $15$。这小于 $17$。因此，$\\{4, 6, 7\\}$ 是和为 $17$ 的唯一由 $3$ 个秩次构成的组合。\n\n总共有两种 A 组的秩次组合会产生大于或等于 $17$ 的秩和：\n- $\\{4, 6, 7\\}$ (和 = $17$)\n- $\\{5, 6, 7\\}$ (和 = $18$)\n\n与观测结果一样极端或更极端的结果数量为 $2$。\n\n精确 p 值是这些极端结果的数量与所有可能结果总数的比率：\n$$p = \\frac{\\text{W}_A \\geq 17 \\text{的组合数}}{\\text{总组合数}} = \\frac{2}{35}$$\n\n最后，我们将此分数表示为小数，并四舍五入到 $4$ 位有效数字。\n$$p = \\frac{2}{35} \\approx 0.057142857...$$\n四舍五入到 $4$ 位有效数字得到：\n$$p \\approx 0.05714$$",
            "answer": "$$\n\\boxed{0.05714}\n$$"
        },
        {
            "introduction": "理论的价值最终要在实践中体现。当面对充满噪声和异常值的真实世界数据时，非参数检验的优势便显而易见。这个编程练习将让你直观地对比 Mann-Whitney U 检验和传统的 $t$ 检验在面对极端异常值时的表现。你会通过计算发现 $t$ 检验的脆弱性以及 Mann-Whitney U 检验的稳健性，从而理解为何以及何时选择后者是数据分析中的明智之举。",
            "id": "2398972",
            "problem": "构建一个程序，针对在两种生物学条件下测量的某个固定基因，根据核糖核酸测序 (RNA-seq) 数据，计算双样本 Welch $t$检验和 Wilcoxon 秩和检验（也称为 Mann–Whitney $U$ 检验）的双边p值，并在一个指定的测试套件中汇总结果。假设每种条件为该基因生成独立的重复计数，并将提供的计数视为观测值。两种检验的原假设均为两种条件具有相等的中心趋势，表述为 $H_0$：两种条件分别从均值相等（Welch $t$检验）或连续分布相等（Wilcoxon 秩和检验）的总体中抽样。不对计数进行任何变换。所有检验都必须是双边的。\n\n您的程序必须处理以下测试套件，其中每一项都指定了条件 $A$ 和条件 $B$ 的计数：\n\n- 测试用例 $1$（基线，无异常值，分布可比）：\n  - 条件 $A$：$\\left(43, 50, 39, 61, 55, 47\\right)$\n  - 条件 $B$：$\\left(45, 52, 41, 58, 53, 49\\right)$\n\n- 测试用例 $2$（条件 $B$ 中存在单个极端高异常值）：\n  - 条件 $A$：$\\left(43, 50, 39, 61, 55, 47\\right)$\n  - 条件 $B$：$\\left(45, 52, 41, 58, 53, 1000\\right)$\n\n- 测试用例 $3$（小样本量，且条件 $B$ 中存在单个极端高异常值）：\n  - 条件 $A$：$\\left(20, 22, 25\\right)$\n  - 条件 $B$：$\\left(19, 21, 400\\right)$\n\n- 测试用例 $4$（位置偏移，且条件 $B$ 中存在单个极端低异常值）：\n  - 条件 $A$：$\\left(15, 16, 18, 20, 19, 17\\right)$\n  - 条件 $B$：$\\left(28, 30, 27, 29, 31, 0\\right)$\n\n对于每个测试用例 $i \\in \\{1,2,3,4\\}$，计算：\n- $p_{t,i}$：比较条件 $A$ 和条件 $B$ 的双样本 Welch $t$检验的双边 p 值。\n- $p_{w,i}$：比较条件 $A$ 和条件 $B$ 的 Wilcoxon 秩和检验的双边 p 值。\n\n您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。该列表必须包含8个浮点数，按 $\\left[p_{t,1}, p_{w,1}, p_{t,2}, p_{w,2}, p_{t,3}, p_{w,3}, p_{t,4}, p_{w,4}\\right]$ 的顺序排列，每个数字四舍五入到6位小数。不应打印任何额外文本。所有数字都是无量纲的，必须表示为小数（例如，$0.012345$），而不是百分比。",
            "solution": "该问题要求对来自两种条件的 RNA 测序计数数据，应用两种不同的统计假设检验——Welch 双样本 $t$检验和 Wilcoxon 秩和检验——来计算 p 值。其目的是比较参数检验与非参数检验的性能，尤其是在存在异常值的情况下，这种情况在生物数据集中很常见。在进行计算求解之前，我们必须为每种检验建立理论基础。\n\n**1. Welch 双样本 $t$检验**\n\nWelch $t$检验是一种统计工具，用于比较两个独立样本（此处表示为条件 $A$ 和条件 $B$）的均值。它是 Student $t$检验的一种变体，在两个样本方差不相等（即所谓的 Behrens-Fisher 问题）时被认为更可靠。原假设 $H_0$ 假定总体均值相等，即 $H_0: \\mu_A = \\mu_B$。\n\n检验统计量 $t$ 的计算方法是样本均值之差除以该差值的标准误：\n$$\nt = \\frac{\\bar{x}_A - \\bar{x}_B}{\\sqrt{\\frac{s_A^2}{n_A} + \\frac{s_B^2}{n_B}}}\n$$\n其中：\n- $\\bar{x}_A$ 和 $\\bar{x}_B$ 分别是条件 $A$ 和 $B$ 的样本均值。\n- $s_A^2$ 和 $s_B^2$ 是无偏样本方差。\n- $n_A$ 和 $n_B$ 是样本大小。\n\n与 Student $t$检验不同，Welch 检验的自由度 $\\nu$ 并不简单地是 $n_A + n_B - 2$。而是使用 Welch-Satterthwaite 方程来近似计算：\n$$\n\\nu \\approx \\frac{\\left( \\frac{s_A^2}{n_A} + \\frac{s_B^2}{n_B} \\right)^2}{\\frac{(s_A^2/n_A)^2}{n_A - 1} + \\frac{(s_B^2/n_B)^2}{n_B - 1}}\n$$\np 值随后根据具有 $\\nu$ 自由度的 Student $t$分布确定。对于双边检验，p 值为 $2 \\cdot P(T_\\nu  |t|)$，其中 $T_\\nu$ 是一个服从 $t$分布的随机变量。\n\n$t$检验的一个关键假设是两个样本中的数据都近似呈正态分布。在存在严重偏离正态性（如偏斜或重尾）的情况下，检验的性能会下降。至关重要的是，样本均值 $(\\bar{x})$ 和方差 $(s^2)$ 对极端值（异常值）高度敏感，这些值会对 $t$统计量产生不成比例的影响，并可能导致错误的结论。\n\n**2. Wilcoxon 秩和 (Mann-Whitney U) 检验**\n\nWilcoxon 秩和检验是 $t$检验的一种非参数替代方法。它不假定数据的特定分布，因此更为稳健。该检验的原假设是，对于从两个总体中随机选择的值 $X$ 和 $Y$， $X$ 大于 $Y$ 的概率等于 $Y$ 大于 $X$ 的概率。更一般地，它检验两个样本是否来自具有相同分布的总体。\n\n其步骤如下：\n1. 将所有 $n_A + n_B$ 个观测值合并到一个排序列表中。如果存在结（tie），则分配本应分配的秩的平均值。\n2. 计算其中一个样本（例如样本 $A$）的秩之和，记为 $R_A$。\n3. 检验统计量 $U$ 是基于此秩和计算的。对于样本 $A$，统计量 $U_A$ 为：\n   $$\n   U_A = R_A - \\frac{n_A(n_A + 1)}{2}\n   $$\n   检验统计量 $U$ 通常取为 $U = \\min(U_A, U_B)$，其中 $U_B$ 的计算方法与样本 $B$ 类似。\n4. p 值根据原假设下 $U$ 统计量的已知分布确定。对于小样本，使用精确分布。对于大样本，则采用带连续性校正的正态近似。\n\n由于 Wilcoxon 检验是基于秩而不是原始数据值进行操作，其统计量不受异常值大小的影响，只受其序数位置的影响。一个极端值仅被视为最高（或最低）的秩，其具体的数值不会进一步影响检验统计量。这一特性使其对异常值具有很强的稳健性。\n\n**3. 测试用例的应用与解释**\n\n所提供的测试用例旨在突出这两种检验的不同敏感性。\n- **测试用例 1**：分布相似且无异常值。预计两种检验都会产生较高的 p 值，表明没有显著差异。\n- **测试用例 2 和 3**：在条件 $B$ 中引入了一个极端高异常值。预计 $t$检验的 p 值将受到显著影响，因为该异常值会同时拉高条件 $B$ 的均值和方差。相比之下，Wilcoxon 检验应相对不受影响，从而对中心趋势的偏移提供更稳定的评估。\n- **测试用例 4**：在条件 $B$ 中引入了一个极端低异常值，而其其他成员的值相较于条件 $A$ 有所升高。该异常值拉低了条件 $B$ 的均值，可能掩盖了 $t$检验本应检测到的真实位置偏移。然而，秩和检验更能检测出两个样本主体之间一致的秩差异。\n\n计算实现将使用 `scipy.stats` 库，具体而言，使用带 `equal_var=False` 参数的 `ttest_ind` 函数执行 Welch $t$检验，以及带 `alternative='two-sided'` 参数的 `mannwhitneyu` 函数执行 Wilcoxon 秩和检验。将为每个测试用例系统地计算结果，并按要求进行格式化。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import ttest_ind, mannwhitneyu\n\ndef solve():\n    \"\"\"\n    Computes and prints p-values for Welch's t-test and Wilcoxon rank-sum test\n    for a suite of RNA-seq count data test cases.\n    \"\"\"\n\n    # Define the test suite as specified in the problem statement.\n    test_cases = [\n        # Test case 1: baseline, no outlier, comparable distributions\n        (np.array([43, 50, 39, 61, 55, 47]), np.array([45, 52, 41, 58, 53, 49])),\n        # Test case 2: single extreme high outlier in condition B\n        (np.array([43, 50, 39, 61, 55, 47]), np.array([45, 52, 41, 58, 53, 1000])),\n        # Test case 3: small sample size with a single extreme high outlier in condition B\n        (np.array([20, 22, 25]), np.array([19, 21, 400])),\n        # Test case 4: location shift with a single extreme low outlier in condition B\n        (np.array([15, 16, 18, 20, 19, 17]), np.array([28, 30, 27, 29, 31, 0])),\n    ]\n\n    results = []\n    for cond_a, cond_b in test_cases:\n        # Perform Welch's two-sample t-test.\n        # The `equal_var=False` argument specifies that we should perform Welch's t-test,\n        # which does not assume equal population variance.\n        # The test is two-sided by default.\n        t_stat, p_t = ttest_ind(cond_a, cond_b, equal_var=False)\n        results.append(p_t)\n\n        # Perform the Wilcoxon rank-sum test (Mann-Whitney U test).\n        # We explicitly specify a two-sided test.\n        # The 'auto' method for p-value calculation is used by default,\n        # which chooses between an exact test and a normal approximation\n        # based on sample size and presence of ties.\n        u_stat, p_w = mannwhitneyu(cond_a, cond_b, alternative='two-sided')\n        results.append(p_w)\n\n    # Format the results as a comma-separated list of floating-point numbers\n    # rounded to 6 decimal places, enclosed in square brackets.\n    formatted_results = [f\"{p:.6f}\" for p in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}