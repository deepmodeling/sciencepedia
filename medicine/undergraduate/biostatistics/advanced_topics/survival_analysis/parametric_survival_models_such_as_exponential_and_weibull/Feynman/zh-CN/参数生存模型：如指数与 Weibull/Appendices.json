{
    "hands_on_practices": [
        {
            "introduction": "参数生存模型的核心在于其参数，如指数分布的率参数 $\\lambda$ 或威布尔分布的形状参数 $k$ 和尺度参数 $\\alpha$。为了将这些抽象的参数与临床实践联系起来，一个关键的步骤是理解它们如何决定可解释的生存指标。本练习将引导你推导中位生存时间——即50%的群体发生事件所需的时间——并将其表示为模型参数的函数，从而为这些参数赋予具体的实践意义 。",
            "id": "4977992",
            "problem": "一个时间-事件变量 $T$ 表示在接受局限性前列腺癌根治性治疗后，一个在复发前无失访的队列中发生生化复发的时间。假设 $T$ 在 $(0,\\infty)$ 上服从连续分布，其概率密度函数严格为正，并且没有点质量。设生存函数为 $S(t)=\\mathbb{P}(T>t)$，累积分布函数为 $F(t)=\\mathbb{P}(T\\le t)$。\n\n1. 仅使用 $S(t)$ 和 $F(t)$ 的定义，以及中位数 $t_{0.5}$ 的定义（即满足 $F(t_{0.5})\\ge 0.5$ 和 $\\mathbb{P}(T\\ge t_{0.5})\\ge 0.5$ 的任何值），证明在所述的连续性条件下，中位生存时间 $t_{0.5}$ 满足 $S(t_{0.5})=0.5$。\n\n2. 在参数化生存模型中，风险函数 $h(t)$ 定义为 $h(t)=\\lim_{\\Delta t\\downarrow 0}\\frac{\\mathbb{P}(t\\le T  t+\\Delta t \\mid T \\ge t)}{\\Delta t}$，它与累积风险 $H(t)=\\int_{0}^{t}h(u)\\,\\mathrm{d}u$ 和生存函数 $S(t)=\\exp(-H(t))$ 相关。推导出指数模型（具有恒定风险 $h(t)=\\lambda$）和韦伯模型（具有风险 $h(t)=\\frac{k}{\\alpha}\\left(\\frac{t}{\\alpha}\\right)^{k-1}$）的中位生存时间 $t_{0.5}$，并以二元行向量的形式报告结果。",
            "solution": "我们从生存分析的核心定义开始。对于一个非负、连续分布的时间-事件变量 $T$，其生存函数为 $S(t)=\\mathbb{P}(Tt)$，累积分布函数为 $F(t)=\\mathbb{P}(T\\le t)$，这两个函数满足基本恒等式\n$$\nF(t) \\;=\\; 1 - S(t),\n$$\n这直接源于补集法则，因为 $\\{T\\le t\\}$ 和 $\\{Tt\\}$ 是互补事件。\n\n第1部分：通过生存函数表征中位数。中位数 $t_{0.5}$ 定义为满足 $F(t_{0.5})\\ge 0.5$ 和 $\\mathbb{P}(T\\ge t_{0.5})\\ge 0.5$ 的任何值。在所述假设下，$T$ 在 $(0,\\infty)$ 上连续分布且无点质量，因此 $F$ 是连续且严格递增的，而 $S$ 是连续且严格递减的。特别地，连续性意味着中位数的集合是单点集，并且满足\n$$\nF(t_{0.5}) \\;=\\; 0.5.\n$$\n使用 $F(t)=1-S(t)$，我们得到\n$$\nS(t_{0.5}) \\;=\\; 1 - F(t_{0.5}) \\;=\\; 1 - 0.5 \\;=\\; 0.5.\n$$\n因此，在所述条件下，中位生存时间 $t_{0.5}$ 由方程 $S(t_{0.5})=0.5$ 来表征。\n\n第2部分：指数模型和韦伯模型中 $t_{0.5}$ 的显式计算。我们从风险函数 $h(t)$ 和累积风险 $H(t)=\\int_{0}^{t}h(u)\\,\\mathrm{d}u$ 的定义开始。一个基本关系连接了生存函数和累积风险：\n$$\nS(t) \\;=\\; \\exp\\!\\bigl(-H(t)\\bigr).\n$$\n对于连续分布，该恒等式可由微分方程 $\\frac{\\mathrm{d}}{\\mathrm{d}t}\\ln S(t) = -h(t)$ 推导得出，而该微分方程本身是通过结合 $h(t)=\\frac{f(t)}{S(t)}$ 和 $f(t)=-\\frac{\\mathrm{d}}{\\mathrm{d}t}S(t)$ 得到的。\n\n指数模型。假设对于 $t0$ 有 $h(t)=\\lambda$，其中 $\\lambda0$。那么\n$$\nH(t) \\;=\\; \\int_{0}^{t}\\lambda\\,\\mathrm{d}u \\;=\\; \\lambda t,\n$$\n所以生存函数是\n$$\nS(t) \\;=\\; \\exp(-\\lambda t).\n$$\n根据第1部分，中位数 $t_{0.5}$ 满足\n$$\n\\exp(-\\lambda t_{0.5}) \\;=\\; 0.5.\n$$\n取自然对数并求解 $t_{0.5}$ 可得\n$$\n-\\lambda t_{0.5} \\;=\\; \\ln(0.5) \\;=\\; -\\ln(2)\n\\quad\\Longrightarrow\\quad\nt_{0.5}^{\\text{(exp)}} \\;=\\; \\frac{\\ln 2}{\\lambda}.\n$$\n\n韦伯模型。假设对于 $t0$ 有 $h(t)=\\frac{k}{\\alpha}\\left(\\frac{t}{\\alpha}\\right)^{k-1}$，其中形状参数 $k0$，尺度参数 $\\alpha0$。那么\n$$\nH(t) \\;=\\; \\int_{0}^{t} \\frac{k}{\\alpha}\\left(\\frac{u}{\\alpha}\\right)^{k-1}\\mathrm{d}u.\n$$\n进行变量替换，令 $v = \\frac{u}{\\alpha}$，则 $\\mathrm{d}u = \\alpha\\,\\mathrm{d}v$，且当 $u=0$ 时 $v=0$，当 $u=t$ 时 $v=\\frac{t}{\\alpha}$。那么\n$$\nH(t) \\;=\\; \\int_{0}^{t/\\alpha} \\frac{k}{\\alpha} v^{k-1}\\,\\alpha\\,\\mathrm{d}v\n\\;=\\; \\int_{0}^{t/\\alpha} k\\,v^{k-1}\\,\\mathrm{d}v\n\\;=\\; \\left[v^{k}\\right]_{0}^{t/\\alpha}\n\\;=\\; \\left(\\frac{t}{\\alpha}\\right)^{k}.\n$$\n因此生存函数是\n$$\nS(t) \\;=\\; \\exp\\!\\left(-\\left(\\frac{t}{\\alpha}\\right)^{k}\\right).\n$$\n根据第1部分，中位数 $t_{0.5}$ 满足\n$$\n\\exp\\!\\left(-\\left(\\frac{t_{0.5}}{\\alpha}\\right)^{k}\\right) \\;=\\; 0.5,\n$$\n这意味着\n$$\n\\left(\\frac{t_{0.5}}{\\alpha}\\right)^{k} \\;=\\; \\ln 2\n\\quad\\Longrightarrow\\quad\nt_{0.5}^{\\text{(weib)}} \\;=\\; \\alpha\\,(\\ln 2)^{1/k}.\n$$\n\n汇总两个结果，所求的二元中位数行向量是\n$$\n\\left(t_{0.5}^{\\text{(exp)}},\\,t_{0.5}^{\\text{(weib)}}\\right)\n\\;=\\;\n\\left(\\frac{\\ln 2}{\\lambda},\\,\\alpha\\,(\\ln 2)^{1/k}\\right).\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{\\ln 2}{\\lambda}  \\alpha(\\ln 2)^{1/k}\\end{pmatrix}}$$"
        },
        {
            "introduction": "在理解了参数的意义之后，下一个核心技能是从实际观测数据中估计这些参数。生存数据通常包含“删失”观测（即在研究结束时事件尚未发生），这为估计带来了挑战。本练习将通过最基本的指数模型，展示如何运用最大似然估计法（MLE）来处理右删失数据，并推导出率参数 $\\lambda$ 的估计量，揭示其作为“总事件数/总风险时间”的直观解释 。",
            "id": "4978007",
            "problem": "在一个评估复合心血管事件发生时间的随机临床注册研究中，有$n$名患者，每位患者$i$提供了一个观测到的随访持续时间$x_i$和一个事件指示符$\\delta_i$。其中，$x_i = \\min\\{t_i, c_i\\}$是真实事件时间$t_i$和右删失时间$c_i$的最小值，而$\\delta_i = \\mathbb{I}(t_i \\le c_i)$指示事件是否被观测到。假设右删失是独立的、非信息性的，并采用参数生存模型，其中事件时间$t_i$服从指数分布，具有一个恒定的风险参数$\\lambda  0$。指数模型的特征是其生存函数$S(t) = \\exp(-\\lambda t)$和密度函数$f(t) = \\lambda \\exp(-\\lambda t)$（对于$t \\ge 0$）。利用似然原理和每个受试者在右删失情况下的贡献，推导出参数$\\lambda$的最大似然估计量，即通过最大似然估计(MLE)得到的估计量，并确定其在本研究中可观测量的解释。哪个选项正确地陈述了闭式估计量及其解释？\n\nA. 估计量是观测到的事件数除以所有患者的总观测随访时间，它估计的是队列累积风险时间内单位时间的平均事件率。\n\nB. 估计量是总观测随访时间除以观测到的事件数，它估计的是每个事件的平均生存时间。\n\nC. 在具有未知形状参数$k$的威布尔模型下，估计量是观测到的事件数除以$x_i^k$的总和，它估计的是经样本量标准化的瞬时风险。\n\nD. 估计量是观测到的事件数除以登记的患者数，它估计的是在随访期间经历事件的患者比例。",
            "solution": "该问题陈述是指数模型下右删失数据生存分析的标准表述。它在科学上是合理的、适定的且客观的。没有矛盾、缺失数据或模糊的术语。该问题是有效的。\n\n我们的任务是对于给定的右删失数据，推导指数分布率参数$\\lambda$的最大似然估计量(MLE)。对于$n$名患者中的每一位，数据由一对$(x_i, \\delta_i)$组成，其中$x_i$是观测到的随访时间，$\\delta_i$是事件指示符。随访时间$x_i = \\min\\{t_i, c_i\\}$是真实事件时间$t_i$和删失时间$c_i$的最小值。如果事件被观测到($t_i \\le c_i$)，则事件指示符$\\delta_i = 1$；如果观测被删失($t_i  c_i$)，则$\\delta_i = 0$。\n\n推导过程首先为观测数据构建似然函数。右删失数据似然函数构建的原理是：如果事件在时间$x_i$被观测到，则个体对似然的贡献是其概率密度函数$f(x_i)$；如果只知道个体存活至时间$x_i$，则其贡献是生存函数$S(x_i)$。\n\n患者$i$对似然函数$L_i(\\lambda)$的贡献可以写为：\n$$ L_i(\\lambda) = [f(x_i)]^{\\delta_i} [S(x_i)]^{1-\\delta_i} $$\n这种紧凑形式正确地表示了两种情况下的贡献：\n- 如果事件被观测到($\\delta_i=1$)：$L_i(\\lambda) = f(x_i)^1 S(x_i)^0 = f(x_i)$。\n- 如果观测被删失($\\delta_i=0$)：$L_i(\\lambda) = f(x_i)^0 S(x_i)^1 = S(x_i)$。\n\n问题陈述指出，事件时间服从参数为$\\lambda  0$的指数分布。其概率密度函数(PDF)为$f(t) = \\lambda e^{-\\lambda t}$，生存函数(SF)为$S(t) = e^{-\\lambda t}$。\n将这些代入$L_i(\\lambda)$的表达式中：\n$$ L_i(\\lambda) = [\\lambda e^{-\\lambda x_i}]^{\\delta_i} [e^{-\\lambda x_i}]^{1-\\delta_i} $$\n我们可以通过合并指数项来简化这个表达式：\n$$ L_i(\\lambda) = \\lambda^{\\delta_i} (e^{-\\lambda x_i})^{\\delta_i} (e^{-\\lambda x_i})^{1-\\delta_i} = \\lambda^{\\delta_i} e^{-\\lambda x_i (\\delta_i + 1 - \\delta_i)} = \\lambda^{\\delta_i} e^{-\\lambda x_i} $$\n\n假设所有$n$名患者的观测是独立的，总似然函数$L(\\lambda)$是各个贡献的乘积：\n$$ L(\\lambda) = \\prod_{i=1}^{n} L_i(\\lambda) = \\prod_{i=1}^{n} \\left( \\lambda^{\\delta_i} e^{-\\lambda x_i} \\right) $$\n通过分离涉及$\\lambda$的项和指数项，我们得到：\n$$ L(\\lambda) = \\left( \\prod_{i=1}^{n} \\lambda^{\\delta_i} \\right) \\left( \\prod_{i=1}^{n} e^{-\\lambda x_i} \\right) = \\lambda^{\\sum_{i=1}^{n} \\delta_i} \\exp\\left(-\\lambda \\sum_{i=1}^{n} x_i\\right) $$\n\n让我们从数据中定义两个汇总统计量：\n1. 观测到的事件总数：$D = \\sum_{i=1}^{n} \\delta_i$。\n2. 总观测随访时间（或总人时风险）：$T = \\sum_{i=1}^{n} x_i$。\n\n现在似然函数可以简洁地写为：\n$$ L(\\lambda) = \\lambda^D e^{-\\lambda T} $$\n为了找到MLE，我们关于$\\lambda$最大化$L(\\lambda)$。在计算上，最大化对数似然函数$\\ell(\\lambda) = \\ln(L(\\lambda))$更简单。\n$$ \\ell(\\lambda) = \\ln(\\lambda^D e^{-\\lambda T}) = D \\ln(\\lambda) - \\lambda T $$\n为了找到最大值，我们求$\\ell(\\lambda)$关于$\\lambda$的一阶导数，并令其等于零：\n$$ \\frac{d\\ell}{d\\lambda} = \\frac{d}{d\\lambda}(D \\ln(\\lambda) - \\lambda T) = \\frac{D}{\\lambda} - T $$\n令导数等于零得到MLE的方程，记为$\\hat{\\lambda}$：\n$$ \\frac{D}{\\hat{\\lambda}} - T = 0 \\implies \\frac{D}{\\hat{\\lambda}} = T \\implies \\hat{\\lambda} = \\frac{D}{T} $$\n为确认这对应一个最大值，我们检查二阶导数：\n$$ \\frac{d^2\\ell}{d\\lambda^2} = -\\frac{D}{\\lambda^2} $$\n由于$D$（事件数）是非负的，$\\lambda^2$是正的，所以二阶导数小于或等于零。对于$D  0$的非平凡情况，二阶导数严格为负，确认了$\\hat{\\lambda}$确实是一个最大似然估计量。\n\n推导出的MLE是：\n$$ \\hat{\\lambda} = \\frac{\\sum_{i=1}^{n} \\delta_i}{\\sum_{i=1}^{n} x_i} = \\frac{\\text{观测到的事件总数}}{\\text{总观测随访时间}} $$\n这是发生率的公式。在指数模型的背景下，参数$\\lambda$代表恒定的风险率，即单位时间内事件的瞬时风险。因此，估计量$\\hat{\\lambda}$是估计的恒定事件率，计算方法为队列中观测到的事件总数除以该队列的累积风险时间。\n\n现在我们评估每个选项：\n\n**A. 估计量是观测到的事件数除以所有患者的总观测随访时间，它估计的是队列累积风险时间内单位时间的平均事件率。**\n- **估计量形式**：“观测到的事件数除以所有患者的总观测随访时间”与我们推导出的估计量$\\hat{\\lambda} = \\frac{D}{T}$完全对应。这是正确的。\n- **解释**：参数$\\lambda$是一个恒定的事件率。MLE $\\hat{\\lambda}$是基于整个队列经验的估计值。将其表述为“队列累积风险时间内单位时间的平均事件率”是流行病学中对发生率（$\\hat{\\lambda}$所代表的）的精确且标准的解释。这是正确的。\n- **结论**：正确。\n\n**B. 估计量是总观测随访时间除以观测到的事件数，它估计的是每个事件的平均生存时间。**\n- **估计量形式**：这描述的是量$\\frac{T}{D} = \\frac{1}{\\hat{\\lambda}}$。这是指数模型中平均生存时间($1/\\lambda$)的MLE，而不是率参数$\\lambda$的MLE。问题明确要求的是$\\lambda$的估计量。这是不正确的。\n- **解释**：量$1/\\lambda$是事件的平均时间。该解释对于$1/\\hat{\\lambda}$是合理的，但估计量形式对于$\\lambda$是错误的。\n- **结论**：不正确。\n\n**C. 在具有未知形状参数$k$的威布尔模型下，估计量是观测到的事件数除以$x_i^k$的总和，它估计的是经样本量标准化的瞬时风险。**\n- **估计量形式**：这个选项将模型从指数模型更改为威布尔模型。指数模型是威布尔模型在形状参数$k=1$时的特例。如果我们在所给公式中设$k=1$，我们得到$\\frac{D}{\\sum x_i^1} = \\frac{D}{T}$，这与我们的结果相符。然而，该选项假定了一个通用的威布尔模型，并声称此形式成立，但这仅在$k$已知时才成立。问题陈述明确指定了指数模型。因此，这个选项解决了另一个不同的问题。\n- **结论**：不正确。\n\n**D. 估计量是观测到的事件数除以登记的患者数，它估计的是在随访期间经历事件的患者比例。**\n- **估计量形式**：这描述的是量$\\frac{D}{n} = \\frac{\\sum \\delta_i}{n}$。这是发生事件的受试者的简单比例。这不是$\\lambda$的MLE，因为它忽略了数据的时间维度（即$x_i$的值）。它将随访1天的患者与随访10年的患者同等对待。这不是从时间-事件数据的似然原理推导出的正确估计量。\n- **结论**：不正确。\n\n基于严谨的推导，只有选项A正确地提供了$\\lambda$的MLE的数学形式及其在生存分析背景下的正确统计解释。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "真实世界的生存分析通常需要处理比简单指数分布更复杂的情况，并考虑协变量（如治疗分组）的影响。本练习将理论与实践相结合，引导你为一个包含协变量的威布尔比例风险模型构建完整的对数似然函数，并推导其得分方程。通过这个过程，你将了解到统计软件在底层是如何通过数值优化方法（如牛顿-拉弗森算法）来联合估计模型中的所有参数的，这是参数生存模型应用的基石 。",
            "id": "4977946",
            "problem": "一项临床试验研究了参数化威布尔比例风险 (PH) 模型下的事件发生时间结果。假设观测值为独立右删失。威布尔 PH 模型将以协变量向量为条件的风险函数指定为 $h(t \\mid \\boldsymbol{x}) = k \\lambda t^{k-1} \\exp(\\boldsymbol{x}^{\\top} \\boldsymbol{\\beta})$，其中 $k \\gt 0$ 是形状参数，$\\lambda \\gt 0$ 是基线尺度参数，$\\boldsymbol{\\beta}$ 是回归系数。生存函数定义为 $S(t \\mid \\boldsymbol{x}) = \\exp\\!\\big(-\\Lambda(t \\mid \\boldsymbol{x})\\big)$，其中 $\\Lambda(t \\mid \\boldsymbol{x})$ 是累积风险。\n\n考虑一个表示治疗分配的单一二元协变量 $x \\in \\{0,1\\}$，其对应的标量系数为 $\\beta$。您观察到 $n = 5$ 名独立患者的右删失时间数据 $(t_i, \\delta_i, x_i)$ 如下：\n- $(t_1, \\delta_1, x_1) = (2, 1, 0)$\n- $(t_2, \\delta_2, x_2) = (5, 0, 1)$\n- $(t_3, \\delta_3, x_3) = (3, 1, 0)$\n- $(t_4, \\delta_4, x_4) = (8, 1, 1)$\n- $(t_5, \\delta_5, x_5) = (4, 0, 1)$\n\n所有时间都在一致的时间尺度上测量（例如，月），但为本题目的，您应将其视为无单位。\n\n任务：\n1) 仅从独立右删失数据的核心定义出发，即似然函数可分解为 $\\prod_{i=1}^{n} \\left[h(t_i \\mid x_i)\\right]^{\\delta_i} S(t_i \\mid x_i)$，并且威布尔 PH 风险和生存函数如上定义，推导出 $(\\beta, k, \\lambda)$ 的完整对数似然，然后推导出 $\\beta$ 和 $k$ 的得分方程（对数似然的一阶导数）。用关于 $(t_i, \\delta_i, x_i)$ 和 $(\\beta, k, \\lambda)$ 且对 $i = 1, \\dots, n$ 的显式求和来表示您的结果。\n\n2) 描述如何通过最大似然法联合估计 $(\\beta, k, \\lambda)$。您的描述应从得分方程开始，然后提出一个适合实施的实用算法解决方案，并阐明如何同时估计所有参数。首次使用时请定义所有缩略语，例如最大似然估计量 (Maximum Likelihood Estimator, MLE) 和牛顿-拉弗森法 (Newton–Raphson, NR)。\n\n3) 使用上述数据和参数值 $(\\beta, k, \\lambda) = (-0.3, 1.5, 0.04)$，评估在该参数点上的联合得分向量 $\\big(U_{\\beta}, U_{k}, U_{\\lambda}\\big)$。将您的答案以单行矩阵 $\\begin{pmatrix} U_{\\beta}  U_{k}  U_{\\lambda} \\end{pmatrix}$ 的形式报告。将每个分量四舍五入到四位有效数字。在最终的数值报告中不要包含单位。",
            "solution": "该问题要求进行与威布尔比例风险模型相关的推导，描述最大似然估计过程，并对给定数据集和参数值评估得分向量。该问题提法明确，具有科学依据，并提供了所有必要信息。\n\n**1) 对数似然和得分方程的推导**\n\n分析从模型的基本定义开始。对于具有单一协变量 $x$ 的威布尔比例风险 (PH) 模型，其风险函数由下式给出：\n$h(t \\mid x) = k \\lambda t^{k-1} \\exp(x \\beta)$\n其中 $k  0$ 是形状参数，$\\lambda  0$ 是基线尺度参数，$\\beta$ 是协变量 $x$ 的回归系数。\n\n累积风险函数 $\\Lambda(t \\mid x)$ 是风险函数从 $0$ 到 $t$ 的积分：\n$$\n\\Lambda(t \\mid x) = \\int_{0}^{t} h(u \\mid x) \\, du = \\int_{0}^{t} k \\lambda u^{k-1} \\exp(x \\beta) \\, du\n$$\n$$\n\\Lambda(t \\mid x) = \\lambda \\exp(x \\beta) \\int_{0}^{t} k u^{k-1} \\, du = \\lambda \\exp(x \\beta) \\left[ u^k \\right]_{0}^{t} = \\lambda t^k \\exp(x \\beta)\n$$\n生存函数 $S(t \\mid x)$ 定义为 $S(t \\mid x) = \\exp(-\\Lambda(t \\mid x))$。因此：\n$$\nS(t \\mid x) = \\exp\\left(-\\lambda t^k \\exp(x \\beta)\\right)\n$$\n对于一个包含 $n$ 个独立右删失观测值 $(t_i, \\delta_i, x_i)$ 的样本，其中 $t_i$ 是观测时间，如果事件发生则 $\\delta_i=1$，如果观测值被删失则 $\\delta_i=0$，似然函数 $L$ 是各个贡献的乘积。如果事件发生 ($\\delta_i=1$)，每个贡献是概率密度函数 (pdf) $f(t_i | x_i)$；如果观测值被删失 ($\\delta_i=0$)，则是生存函数 $S(t_i | x_i)$。由于 $f(t \\mid x) = h(t \\mid x) S(t \\mid x)$，观测值 $i$ 的似然为 $[h(t_i \\mid x_i)]^{\\delta_i} S(t_i \\mid x_i)$。完整的似然函数是：\n$$\nL(\\beta, k, \\lambda) = \\prod_{i=1}^{n} \\left[h(t_i \\mid x_i)\\right]^{\\delta_i} S(t_i \\mid x_i)\n$$\n代入 $h(t \\mid x)$ 和 $S(t \\mid x)$ 的表达式：\n$$\nL(\\beta, k, \\lambda) = \\prod_{i=1}^{n} \\left[k \\lambda t_i^{k-1} \\exp(x_i \\beta)\\right]^{\\delta_i} \\exp\\left(-\\lambda t_i^k \\exp(x_i \\beta)\\right)\n$$\n对数似然 $\\ell(\\beta, k, \\lambda) = \\ln L(\\beta, k, \\lambda)$ 更便于求导：\n$$\n\\ell(\\beta, k, \\lambda) = \\sum_{i=1}^{n} \\left[ \\delta_i \\ln\\left(k \\lambda t_i^{k-1} \\exp(x_i \\beta)\\right) - \\lambda t_i^k \\exp(x_i \\beta) \\right]\n$$\n$$\n\\ell(\\beta, k, \\lambda) = \\sum_{i=1}^{n} \\left[ \\delta_i (\\ln(k) + \\ln(\\lambda) + (k-1)\\ln(t_i) + x_i \\beta) - \\lambda t_i^k \\exp(x_i \\beta) \\right]\n$$\n这可以写成：\n$$\n\\ell(\\beta, k, \\lambda) = \\left(\\sum_{i=1}^{n} \\delta_i\\right) (\\ln(k) + \\ln(\\lambda)) + \\sum_{i=1}^{n} \\delta_i (k-1)\\ln(t_i) + \\beta \\sum_{i=1}^{n} \\delta_i x_i - \\lambda \\sum_{i=1}^{n} t_i^k \\exp(x_i \\beta)\n$$\n得分方程是对数似然函数关于参数的一阶偏导数，并令其等于零。我们按要求推导得分分量 $U_{\\beta}$ 和 $U_{k}$。为完整起见以及在后续部分使用，我们同样推导 $U_{\\lambda}$。\n\n$\\beta$ 的得分分量是 $U_{\\beta} = \\frac{\\partial \\ell}{\\partial \\beta}$：\n$$\nU_{\\beta} = \\sum_{i=1}^{n} \\delta_i x_i - \\lambda \\sum_{i=1}^{n} \\frac{\\partial}{\\partial \\beta} \\left(t_i^k \\exp(x_i \\beta)\\right) = \\sum_{i=1}^{n} \\delta_i x_i - \\lambda \\sum_{i=1}^{n} t_i^k x_i \\exp(x_i \\beta)\n$$\n$k$ 的得分分量是 $U_{k} = \\frac{\\partial \\ell}{\\partial k}$：\n$$\nU_{k} = \\frac{\\partial}{\\partial k} \\left[ \\left(\\sum_{i=1}^{n} \\delta_i\\right) \\ln(k) + \\sum_{i=1}^{n} \\delta_i (k-1)\\ln(t_i) - \\lambda \\sum_{i=1}^{n} t_i^k \\exp(x_i \\beta) \\right]\n$$\n利用 $\\frac{d}{dk} t_i^k = t_i^k \\ln(t_i)$ 这一事实：\n$$\nU_{k} = \\frac{\\sum_{i=1}^{n} \\delta_i}{k} + \\sum_{i=1}^{n} \\delta_i \\ln(t_i) - \\lambda \\sum_{i=1}^{n} t_i^k \\ln(t_i) \\exp(x_i \\beta)\n$$\n$\\lambda$ 的得分分量是 $U_{\\lambda} = \\frac{\\partial \\ell}{\\partial \\lambda}$：\n$$\nU_{\\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left[ \\left(\\sum_{i=1}^{n} \\delta_i\\right) \\ln(\\lambda) - \\lambda \\sum_{i=1}^{n} t_i^k \\exp(x_i \\beta) \\right] = \\frac{\\sum_{i=1}^{n} \\delta_i}{\\lambda} - \\sum_{i=1}^{n} t_i^k \\exp(x_i \\beta)\n$$\n\n**2) 最大似然估计过程**\n\n参数向量 $\\boldsymbol{\\theta} = (\\beta, k, \\lambda)^{\\top}$ 的联合最大似然估计量 (Maximum Likelihood Estimators, MLEs) 是使对数似然函数 $\\ell(\\boldsymbol{\\theta})$ 最大化的值 $(\\hat{\\beta}, \\hat{k}, \\hat{\\lambda})$。这些估计量通过求解得分方程组得到，其中得分向量 $U(\\boldsymbol{\\theta}) = (U_{\\beta}, U_{k}, U_{\\lambda})^{\\top}$ 被设为零向量：\n$$\nU(\\boldsymbol{\\theta}) = \\boldsymbol{0}\n$$\n得分方程是非线性的且相互耦合，这意味着无法对 $(\\beta, k, \\lambda)$ 进行解析求解。因此，需要一个数值优化算法。解决此问题的标准且高效的方法是牛顿-拉弗森 (Newton-Raphson, NR) 算法。\n\nNR 算法是用于寻找方程组根的迭代过程。为了找到 MLE，它使用以下公式迭代更新参数估计值：\n$$\n\\boldsymbol{\\theta}^{(m+1)} = \\boldsymbol{\\theta}^{(m)} - \\left[H\\left(\\boldsymbol{\\theta}^{(m)}\\right)\\right]^{-1} U\\left(\\boldsymbol{\\theta}^{(m)}\\right)\n$$\n其中：\n- $\\boldsymbol{\\theta}^{(m)}$ 是第 $m$ 次迭代时的参数估计向量。\n- $U(\\boldsymbol{\\theta}^{(m)})$ 是在 $\\boldsymbol{\\theta}^{(m)}$ 处评估的得分向量（$\\ell$ 的一阶导数）。\n- $H(\\boldsymbol{\\theta}^{(m)})$ 是海森矩阵 (Hessian matrix)，即在 $\\boldsymbol{\\theta}^{(m)}$ 处评估的对数似然函数的二阶偏导数的 $3 \\times 3$ 矩阵，$\\left[H_{ij}\\right] = \\frac{\\partial^2 \\ell}{\\partial \\theta_i \\partial \\theta_j}$。海森矩阵的负数是观测信息矩阵。\n\n实际的算法解决方案如下：\n1.  **初始化**：为参数向量选择一个初始值，$\\boldsymbol{\\theta}^{(0)} = (\\beta^{(0)}, k^{(0)}, \\lambda^{(0)})^{\\top}$。\n2.  **迭代**：对于 $m = 0, 1, 2, \\dots$：\n    a.  使用第 1 部分推导出的表达式计算得分向量 $U(\\boldsymbol{\\theta}^{(m)})$。\n    b.  通过对对数似然函数 $\\ell(\\boldsymbol{\\theta})$ 求二阶偏导数来计算 $3 \\times 3$ 的海森矩阵 $H(\\boldsymbol{\\theta}^{(m)})$。例如，$H_{11} = \\frac{\\partial^2 \\ell}{\\partial \\beta^2} = -\\lambda \\sum_{i=1}^{n} t_i^k x_i^2 \\exp(x_i \\beta)$，以此类推计算所有九个元素。\n    c.  对海森矩阵求逆以获得 $[H(\\boldsymbol{\\theta}^{(m)})]^{-1}$。\n    d.  使用 NR 公式更新参数向量：$\\boldsymbol{\\theta}^{(m+1)} = \\boldsymbol{\\theta}^{(m)} - [H(\\boldsymbol{\\theta}^{(m)})]^{-1} U(\\boldsymbol{\\theta}^{(m)})$。\n3.  **收敛**：重复迭代步骤，直到满足收敛准则。通常是当参数估计值的变化 $\\|\\boldsymbol{\\theta}^{(m+1)} - \\boldsymbol{\\theta}^{(m)}\\|$ 或得分向量的模长 $\\|U(\\boldsymbol{\\theta}^{(m+1)})\\|$ 小于一个预先指定的微小容差 $\\epsilon$ 时。\n4.  **结果**：最终的参数向量 $\\boldsymbol{\\theta}^{(m+1)}$ 即为 MLE，记作 $\\hat{\\boldsymbol{\\theta}} = (\\hat{\\beta}, \\hat{k}, \\hat{\\lambda})$。\n\n**3) 得分向量的数值评估**\n\n我们被要求在点 $(\\beta, k, \\lambda) = (-0.3, 1.5, 0.04)$ 处评估得分向量 $(U_{\\beta}, U_{k}, U_{\\lambda})$。\n$n=5$ 名患者的数据如下：\n- $(t_1, \\delta_1, x_1) = (2, 1, 0)$\n- $(t_2, \\delta_2, x_2) = (5, 0, 1)$\n- $(t_3, \\delta_3, x_3) = (3, 1, 0)$\n- $(t_4, \\delta_4, x_4) = (8, 1, 1)$\n- $(t_5, \\delta_5, x_5) = (4, 0, 1)$\n\n首先，我们计算汇总统计量：\n- 事件总数：$D = \\sum_{i=1}^{5} \\delta_i = 1+0+1+1+0 = 3$。\n- $\\sum_{i=1}^{5} \\delta_i x_i = (1 \\cdot 0) + (0 \\cdot 1) + (1 \\cdot 0) + (1 \\cdot 1) + (0 \\cdot 1) = 1$。\n- $\\sum_{i=1}^{5} \\delta_i \\ln(t_i) = 1 \\cdot \\ln(2) + 1 \\cdot \\ln(3) + 1 \\cdot \\ln(8) = \\ln(2 \\cdot 3 \\cdot 8) = \\ln(48) \\approx 3.8712$。\n\n接下来，我们使用给定的参数值 $k=1.5$ 和 $\\beta=-0.3$ 来评估所需的总和，其中 $\\exp(-0.3) \\approx 0.740818$。\n\n**$U_{\\beta}$ 的评估：**\n$U_{\\beta} = \\sum_{i=1}^{5} \\delta_i x_i - \\lambda \\sum_{i=1}^{5} t_i^k x_i \\exp(x_i \\beta)$\n$U_{\\beta} = 1 - 0.04 \\sum_{i=1}^{5} t_i^{1.5} x_i \\exp(-0.3 x_i)$\n$U_{\\beta} = 1 - 0.04 \\left( 5^{1.5}e^{-0.3} + 8^{1.5}e^{-0.3} + 4^{1.5}e^{-0.3} \\right)$\n$U_{\\beta} = 1 - 0.04 \\cdot e^{-0.3} (5^{1.5} + 8^{1.5} + 4^{1.5})$\n$U_{\\beta} \\approx 1 - 0.04 \\cdot 0.740818 \\cdot (11.18034 + 22.62742 + 8)$\n$U_{\\beta} \\approx 1 - 0.04 \\cdot 0.740818 \\cdot 41.80776 \\approx 1 - 1.2390 = -0.2390$。\n保留四位有效数字，$U_{\\beta} = -0.2390$。\n\n**$U_{k}$ 的评估：**\n$U_{k} = \\frac{D}{k} + \\sum_{i=1}^{5} \\delta_i \\ln(t_i) - \\lambda \\sum_{i=1}^{5} t_i^k \\ln(t_i) \\exp(x_i \\beta)$\n$U_{k} = \\frac{3}{1.5} + \\ln(48) - 0.04 \\sum_{i=1}^{5} t_i^{1.5} \\ln(t_i) \\exp(-0.3 x_i)$\n$U_{k} \\approx 2 + 3.8712 - 0.04 \\big( 2^{1.5}\\ln(2)e^0 + 5^{1.5}\\ln(5)e^{-0.3} + 3^{1.5}\\ln(3)e^0 + 8^{1.5}\\ln(8)e^{-0.3} + 4^{1.5}\\ln(4)e^{-0.3} \\big)$\n$U_{k} \\approx 5.8712 - 0.04 \\big( 1.9609 + 13.3308 + 5.7087 + 34.8562 + 8.2166 \\big)$\n$U_{k} \\approx 5.8712 - 0.04 \\cdot 64.0732 = 5.8712 - 2.5629 = 3.3083$。\n保留四位有效数字，$U_{k} = 3.308$。\n\n**$U_{\\lambda}$ 的评估：**\n$U_{\\lambda} = \\frac{D}{\\lambda} - \\sum_{i=1}^{5} t_i^k \\exp(x_i \\beta)$\n$U_{\\lambda} = \\frac{3}{0.04} - \\sum_{i=1}^{5} t_i^{1.5} \\exp(-0.3 x_i)$\n$U_{\\lambda} = 75 - \\big( 2^{1.5}e^0 + 5^{1.5}e^{-0.3} + 3^{1.5}e^0 + 8^{1.5}e^{-0.3} + 4^{1.5}e^{-0.3} \\big)$\n$U_{\\lambda} \\approx 75 - \\big( 2.8284 + 8.2825 + 5.1962 + 16.7621 + 5.9265 \\big)$\n$U_{\\lambda} \\approx 75 - 38.9957 = 36.0043$。\n保留四位有效数字，$U_{\\lambda} = 36.00$。\n\n在给定点评估的联合得分向量 $(U_{\\beta}, U_{k}, U_{\\lambda})$ 是 $(-0.2390, 3.308, 36.00)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -0.2390  3.308  36.00 \\end{pmatrix}}\n$$"
        }
    ]
}