{
    "hands_on_practices": [
        {
            "introduction": "Kaplan-Meier 估计量是现代生存分析的基石，它使我们能够在部分数据被删失的情况下估计生存函数。本练习将通过一个小型数据集，提供构建 Kaplan-Meier 曲线的基础性、分步实践。通过亲手计算，您将具体理解该估计量如何随时间处理事件和删失数据。",
            "id": "4562449",
            "problem": "一项影像组学研究调查了通过高风险影像学特征筛选出的一个队列的总生存期。对于每个个体，记录了以月为单位的观测时间，以及一个指示事件（死亡）是否发生或观测是否被删失的指示符。该数据集（有序对 $\\left(t_i,\\delta_i\\right)$，其中 $t_i$ 以月为单位，$\\delta_i \\in \\{0,1\\}$，$\\delta_i=1$ 表示事件，$\\delta_i=0$ 表示删失）如下：\n- $(2,1)$,\n- $(3,0)$,\n- $(3,0)$,\n- $(4,1)$,\n- $(5,0)$,\n- $(6,1)$,\n- $(7,0)$,\n- $(8,1)$,\n- $(9,1)$,\n- $(10,0)$,\n- $(10,1)$,\n- $(12,0)$.\n\n从生存分析的基本原理出发——即生存函数 $S(t)=\\Pr(Tt)$ 的定义，以及将生存随时间的变化表示为由有序的独立事件时间定义的连续区间上的条件生存概率的乘积——为该数据集逐步构建 Kaplan–Meier（乘积限）估计量。在您的构建过程中，请明确处理没有事件发生的时间（纯删失时间）以及事件和删失同时发生的时间。对生存阶梯函数使用右连续约定（即，生存率的下降发生在事件时间点）。\n\n在右连续约定下，当 $t=9$ 个月时，Kaplan–Meier 估计值 $\\hat{S}(t)$ 的精确值是多少？请将您的最终答案表示为一个无单位的最简分数，不要四舍五入。最终答案中仅提供最终数值；不要求提供中间步骤。",
            "solution": "基本量是生存函数 $S(t)=\\Pr(T>t)$，它可以根据条件概率的链式法则在有序的事件时间点 $t_{(1)}  t_{(2)}  \\dots$ 上进行分解。Kaplan-Meier (KM) 估计量正是利用了这一点，通过将每个事件时间点的条件生存概率连乘来估计生存函数。其公式为 $\\hat{S}(t) = \\prod_{t_{(i)} \\le t} \\left(1 - \\frac{d_i}{n_i}\\right)$，其中 $d_i$ 是在时间 $t_{(i)}$ 的事件数，而 $n_i$ 是在时间 $t_{(i)}$ 之前处于风险中的个体数量（风险集）。被删失的个体在被删失之前会一直对风险集 $n_i$ 作出贡献。我们为给定数据集逐步构建估计量。初始时，共有12名受试者，$\\hat{S}(t)=1$。在第一个事件时间 $t=2$，风险集 $n_1=12$，事件数 $d_1=1$，$\\hat{S}(t)$ 更新为 $1 \\times (1 - 1/12) = 11/12$。在 $t=3$ 有两例删失后，到下一个事件时间 $t=4$ 时，风险集为 $n_2 = 12 - 1 - 2 = 9$，事件数 $d_2=1$，$\\hat{S}(t)$ 更新为 $(11/12) \\times (1 - 1/9) = 22/27$。在 $t=5$ 有一例删失后，到下一个事件时间 $t=6$ 时，风险集为 $n_3 = 9 - 1 - 1 = 7$，事件数 $d_3=1$，$\\hat{S}(t)$ 更新为 $(22/27) \\times (1 - 1/7) = 44/63$。在 $t=7$ 有一例删失后，到下一个事件时间 $t=8$ 时，风险集为 $n_4 = 7 - 1 - 1 = 5$，事件数 $d_4=1$，$\\hat{S}(t)$ 更新为 $(44/63) \\times (1 - 1/5) = 176/315$。最后，在事件时间 $t=9$，风险集为 $n_5 = 5 - 1 = 4$，事件数 $d_5=1$。生存函数更新为 $\\hat{S}(9) = (176/315) \\times (1 - 1/4) = 44/105$。根据右连续约定，在 $t=9$ 个月时的KM估计值 $\\hat{S}(t)$ 是事件发生后更新的值。因此，精确值为 $\\frac{44}{105}$。",
            "answer": "$$\\boxed{\\frac{44}{105}}$$"
        },
        {
            "introduction": "在估计出多条生存曲线后，我们通常需要检验它们之间是否存在统计学上的显著差异，例如比较治疗组与对照组。对数秩检验 (log-rank test) 是进行此类比较的标准非参数方法，其原理是在每个事件时间点比较观测事件数与期望事件数。本练习将分解该检验统计量的计算过程，阐明如何综合所有时间点的信息来检验组间无差异的原假设。",
            "id": "4853724",
            "problem": "考虑一个双臂随机对照试验 (RCT)，其结局为受独立右删失影响的事件发生时间。令 $G \\in \\{1,2\\}$ 表示治疗组，令 $T$ 表示事件时间。对于组 $g$，其生存函数为 $S_{g}(t) = \\Pr(T > t \\mid G=g)$，风险函数为 $\\lambda_{g}(t)$。在风险相等的原假设 $H_{0} : \\lambda_{1}(t) = \\lambda_{2}(t)$（对于所有 $t$）下，Mantel-Haenszel 对数秩检验在每个不同的事件时间点，以风险集为条件，比较两组的观测事件数和期望事件数。\n\n假设有三个不同的有序事件时间 $t_{1}  t_{2}  t_{3}$。在每个 $t_{j}$ 时刻，令 $n_{1j}$ 和 $n_{2j}$ 分别表示第1组和第2组的风险人数，令 $d_{1j}$ 和 $d_{2j}$ 分别表示在 $t_{j}$ 时刻第1组和第2组发生的事件数。这三个时间点的观测数据为\n$$(d_{1j}, d_{2j}, n_{1j}, n_{2j}) = (1,0,5,5),\\ (0,1,4,4),\\ (1,1,3,3)。$$\n假设 $t_{3}$ 处的事件时间相同情况（ties）由 Mantel-Haenszel 对数秩检验的标准精确条件论证处理。\n\n仅使用上面给出的风险集和事件计数，计算在 $H_{0} : \\lambda_{1}(t) = \\lambda_{2}(t)$ 下的单自由度 Mantel-Haenszel 对数秩卡方检验统计量，并以单个实数表示。请勿对答案进行四舍五入。",
            "solution": "用户要求根据一个双臂随机对照试验所提供的数据，计算 Mantel-Haenszel 对数秩卡方检验统计量。\n\n首先，我们必须验证问题陈述。该问题为计算提供了所有必要的数据：在三个不同事件时间点上，两个组中的事件数和风险个体数。其框架是统计学中一个成熟的领域——生存分析。对数秩检验是比较生存分布的一种标准的、有科学依据的方法。所提供的数据是内部一致的，考虑了事件时间之间的删失。该问题提法恰当、客观、有效。我们可以着手求解。\n\nMantel-Haenszel 对数秩检验统计量，记为 $\\chi^2$，是一个单自由度卡方统计量，计算公式如下：\n$$ \\chi^2 = \\frac{(O - E)^2}{V} $$\n其中 $O$ 是指定组（我们将使用第1组）中观测到的事件总数，$E$ 是在该组中，在原假设 $H_{0} : \\lambda_{1}(t) = \\lambda_{2}(t)$ 下的期望事件总数，而 $V$ 是在 $H_{0}$ 下观测计数的总方差。这些总量是每个不同事件时间点 $t_{j}$ 贡献的总和。令 $j$ 为事件时间的索引，其中 $j \\in \\{1, 2, 3\\}$。\n\n在每个事件时间点 $t_{j}$，我们有：\n- $d_{1j}, d_{2j}$：第1组和第2组的事件数。\n- $n_{1j}, n_{2j}$：就在 $t_{j}$ 之前，第1组和第2组的风险个体数。\n\n由此，我们可以定义：\n- $d_{j} = d_{1j} + d_{2j}$：在 $t_{j}$ 时的事件总数。\n- $n_{j} = n_{1j} + n_{2j}$：在 $t_{j}$ 时的风险个体总数。\n\n在时间 $t_{j}$，第1组对观测总数的贡献就是 $O_{j} = d_{1j}$。\n在原假设下，在时间 $t_{j}$ 第1组的事件数 $d_{1j}$ 服从超几何分布。在时间 $t_{j}$ 第1组的期望事件数为：\n$$ E_{j} = d_{j} \\frac{n_{1j}}{n_{j}} $$\n在时间 $t_{j}$ 第1组的事件数的方差，基于超几何分布，为：\n$$ V_{j} = \\frac{n_{1j} n_{2j} d_{j} (n_{j} - d_{j})}{n_{j}^2 (n_{j} - 1)} $$\n观测总数 $O$、期望总数 $E$ 和总方差 $V$ 是对三个事件时间的求和：\n$$ O = \\sum_{j=1}^{3} O_{j}, \\quad E = \\sum_{j=1}^{3} E_{j}, \\quad V = \\sum_{j=1}^{3} V_{j} $$\n\n现在我们使用提供的数据计算每个事件时间点的这些量。\n\n**事件时间 $t_{1}$：**\n数据为 $(d_{11}, d_{21}, n_{11}, n_{21}) = (1, 0, 5, 5)$。\n- 事件总数：$d_{1} = 1 + 0 = 1$。\n- 风险总人数：$n_{1} = 5 + 5 = 10$。\n- 第1组的观测计数：$O_{1} = d_{11} = 1$。\n- 第1组的期望计数：$E_{1} = d_{1} \\frac{n_{11}}{n_{1}} = 1 \\times \\frac{5}{10} = 0.5$。\n- 方差：$V_{1} = \\frac{n_{11} n_{21} d_{1} (n_{1} - d_{1})}{n_{1}^2 (n_{1} - 1)} = \\frac{5 \\times 5 \\times 1 \\times (10 - 1)}{10^2 \\times (10 - 1)} = \\frac{25 \\times 9}{100 \\times 9} = \\frac{25}{100} = 0.25$。\n\n**事件时间 $t_{2}$：**\n数据为 $(d_{12}, d_{22}, n_{12}, n_{22}) = (0, 1, 4, 4)$。\n- 事件总数：$d_{2} = 0 + 1 = 1$。\n- 风险总人数：$n_{2} = 4 + 4 = 8$。\n- 第1组的观测计数：$O_{2} = d_{12} = 0$。\n- 第1组的期望计数：$E_{2} = d_{2} \\frac{n_{12}}{n_{2}} = 1 \\times \\frac{4}{8} = 0.5$。\n- 方差：$V_{2} = \\frac{n_{12} n_{22} d_{2} (n_{2} - d_{2})}{n_{2}^2 (n_{2} - 1)} = \\frac{4 \\times 4 \\times 1 \\times (8 - 1)}{8^2 \\times (8 - 1)} = \\frac{16 \\times 7}{64 \\times 7} = \\frac{16}{64} = 0.25$。\n\n**事件时间 $t_{3}$：**\n数据为 $(d_{13}, d_{23}, n_{13}, n_{23}) = (1, 1, 3, 3)$。\n- 事件总数：$d_{3} = 1 + 1 = 2$。\n- 风险总人数：$n_{3} = 3 + 3 = 6$。\n- 第1组的观测计数：$O_{3} = d_{13} = 1$。\n- 第1组的期望计数：$E_{3} = d_{3} \\frac{n_{13}}{n_{3}} = 2 \\times \\frac{3}{6} = 1$。\n- 方差：$V_{3} = \\frac{n_{13} n_{23} d_{3} (n_{3} - d_{3})}{n_{3}^2 (n_{3} - 1)} = \\frac{3 \\times 3 \\times 2 \\times (6 - 2)}{6^2 \\times (6 - 1)} = \\frac{9 \\times 2 \\times 4}{36 \\times 5} = \\frac{72}{180} = \\frac{2 \\times 36}{5 \\times 36} = \\frac{2}{5} = 0.4$。\n\n现在，我们将这些量相加得到总和。\n- 第1组的观测总数：\n  $$ O = O_{1} + O_{2} + O_{3} = 1 + 0 + 1 = 2 $$\n- 第1组的期望总数：\n  $$ E = E_{1} + E_{2} + E_{3} = 0.5 + 0.5 + 1 = 2 $$\n- 总方差：\n  $$ V = V_{1} + V_{2} + V_{3} = 0.25 + 0.25 + 0.4 = 0.9 $$\n\n最后，我们计算卡方统计量：\n$$ \\chi^2 = \\frac{(O - E)^2}{V} = \\frac{(2 - 2)^2}{0.9} = \\frac{0^2}{0.9} = \\frac{0}{0.9} = 0 $$\nMantel-Haenszel 对数秩卡方检验统计量为 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "真实的生存数据常常涉及“竞争风险”，即受试者可能经历多种互斥事件中的一种。一个常见且严重的错误是将竞争性事件当作普通删失来处理，这会导致对所研究事件发生概率的显著高估。本练习将引导您严格证明这种偏差的存在，并量化其大小，从而强调在竞争风险分析中采用正确方法的重要性。",
            "id": "4853762",
            "problem": "考虑一项医学中的队列研究，该研究包含两种互斥的失效类型，标记为原因$1$和原因$2$，以及相对于事件过程为无信息性的独立右删失。令$T$表示任何原因下首次事件发生的时间，令$K \\in \\{1,2\\}$表示事件类型。定义原因$k$的特定原因风险函数为 $\\lambda_{k}(t) = \\lim_{\\Delta \\downarrow 0} \\frac{\\Pr(t \\leq T  t+\\Delta, K = k \\mid T \\geq t)}{\\Delta}$，并定义总风险函数为 $\\lambda(t) = \\lambda_{1}(t) + \\lambda_{2}(t)$。生存函数定义为 $S(t) = \\Pr(T > t)$，原因$k$的累积发生率函数定义为 $F_{k}(t) = \\Pr(T \\leq t, K = k)$。\n\n一种常见但错误的做法是，在估计原因$k$时，将所有竞争事件（即非$k$类型的事件）视为独立右删失，并应用Kaplan–Meier (KM) 估计量。请仅使用上述基本定义和全概率定律，推导将竞争事件作删失处理后得到的基于KM方法的量与真实累积发生率函数$F_{k}(t)$之间的关系，并严格证明当$\\lambda_{2}(t)$不恒等于零时，为何将竞争事件作删失处理会导致对所有$t0$的$F_{k}(t)$的高估。\n\n然后，在一个简单的双原因情景下，其中特定原因风险为常数 $\\lambda_{1}(t) \\equiv \\alpha$ 和 $\\lambda_{2}(t) \\equiv \\beta$，计算在时间$t$的绝对偏差，定义为\n$$\\text{Bias}(t) = \\left[\\text{在原因2被删失的情况下，原因1的基于KM的量}\\right] - F_{1}(t),$$\n对于$\\alpha = 0.08 \\text{ 年}^{-1}$，$\\beta = 0.12 \\text{ 年}^{-1}$和$t = 2 \\text{ 年}$。将偏差表示为小数（不带百分号），并将最终数值答案四舍五入到四位有效数字。请写出您推导的任何中间解析表达式，但最终答案只提供所要求的数值。全程使用“年”作为时间单位。",
            "solution": "问题陈述已经过验证，被认为是合理的。这是一个在生存分析和竞争风险领域内适定的、有科学依据的问题，没有矛盾或含糊之处。\n\n这个问题针对的是在分析含有竞争风险的事件时间数据时的一个常见误解。它要求进行严格的推导，以说明为什么将竞争事件视为删失观测值会导致对累积发生率的有偏估计。\n\n首先，我们形式化我们感兴趣的两个量：真实的累积发生率函数$F_k(t)$，以及从错误的Kaplan-Meier (KM) 方法中推导出的量。\n\n原因$k$的真实累积发生率函数 (CIF)，$F_{k}(t) = \\Pr(T \\leq t, K=k)$，是在所有竞争风险都存在的情况下，个体在时间$t$之前经历$k$类型事件的概率。在时间$u$发生原因$k$事件的密度是存活到时间$u$的概率$S(u)$与在时间$u$因原因$k$失效的瞬时速率$\\lambda_k(u)$的乘积。将其从$0$到$t$积分，得到累积概率：\n$$ F_{k}(t) = \\int_{0}^{t} S(u) \\lambda_{k}(u) \\,du $$\n总生存函数$S(t) = \\Pr(T > t)$由总风险函数$\\lambda(t) = \\sum_{j=1}^{2} \\lambda_{j}(t)$通过关系式$S(t) = \\exp\\left(-\\int_{0}^{t} \\lambda(u) \\,du\\right)$确定。\n将此代入$F_k(t)$的表达式中，我们得到CIF的正确公式：\n$$ F_{k}(t) = \\int_{0}^{t} \\lambda_{k}(u) \\exp\\left(-\\int_{0}^{u} (\\lambda_{1}(s) + \\lambda_{2}(s)) \\,ds\\right) \\,du $$\n\n接下来，我们形式化“基于KM的量”。Kaplan-Meier估计量旨在估计生存函数$S(t)$。如果我们在分析原因1时将原因2的事件视为删失，我们实际上是在尝试估计一个原因2不存在的假设世界中的生存函数。在这样一个世界里，唯一存在的风险将是$\\lambda_1(t)$。这个假设世界中的生存函数，我们称之为净生存函数$S_1^{net}(t)$，由下式给出：\n$$ S_1^{net}(t) = \\exp\\left(-\\int_{0}^{t} \\lambda_{1}(u) \\,du\\right) $$\n因此，事件1的累积概率的基于KM的量是1减去这个净生存函数。我们将这个量表示为$F_1^{KM}(t)$：\n$$ F_1^{KM}(t) = 1 - S_1^{net}(t) = 1 - \\exp\\left(-\\int_{0}^{t} \\lambda_{1}(u) \\,du\\right) $$\n这个表达式也可以写成积分形式，即 $1 - \\exp(-\\int_0^t \\lambda_1(u)du) = \\int_0^t \\lambda_1(u) \\exp(-\\int_0^u \\lambda_1(s)ds)du$。\n\n现在我们来证明高估。我们必须证明当$\\lambda_2(t)$不恒等于零时，对所有$t  0$都有$F_1^{KM}(t)  F_1(t)$。我们比较它们的积分形式：\n$$ F_1^{KM}(t) = \\int_{0}^{t} \\lambda_{1}(u) \\exp\\left(-\\int_{0}^{u} \\lambda_{1}(s) \\,ds\\right) \\,du $$\n$$ F_1(t) = \\int_{0}^{t} \\lambda_{1}(u) \\exp\\left(-\\int_{0}^{u} (\\lambda_{1}(s) + \\lambda_{2}(s)) \\,ds\\right) \\,du $$\n让我们比较在任何时间$u0$的被积函数。令$F_1^{KM}(t)$的被积函数为$g_{KM}(u)$，$F_1(t)$的被积函数为$g_1(u)$。\n$$ g_{KM}(u) = \\lambda_{1}(u) \\exp\\left(-\\int_{0}^{u} \\lambda_{1}(s) \\,ds\\right) $$\n$$ g_1(u) = \\lambda_{1}(u) \\exp\\left(-\\int_{0}^{u} \\lambda_{1}(s) \\,ds - \\int_{0}^{u} \\lambda_{2}(s) \\,ds\\right) = g_{KM}(u) \\exp\\left(-\\int_{0}^{u} \\lambda_{2}(s) \\,ds\\right) $$\n由于风险函数是非负的，所以对所有$s$都有$\\lambda_2(s) \\geq 0$。问题陈述中提到$\\lambda_2(t)$不恒等于零。这意味着对于任何$t0$，在$(0, t]$中存在某个区间，使得$\\lambda_2(s)  0$。因此，对于任何满足$\\int_0^u \\lambda_2(s)ds  0$的$u0$，我们有：\n$$ \\exp\\left(-\\int_{0}^{u} \\lambda_{2}(s) \\,ds\\right)  1 $$\n这意味着对于这样的$u$值，$g_1(u)  g_{KM}(u)$。对于所有其他的$u$，$g_1(u) = g_{KM}(u)$（这种情况发生在$\\lambda_1(u)=0$或$\\int_0^u \\lambda_2(s)ds=0$时）。假设$\\lambda_1(t)$也不恒等于零（否则$F_1(t)=0$且$F_1^{KM}(t)=0$），那么不等式$g_1(u)  g_{KM}(u)$将在$(0, t]$的某个子区间上是严格的。对一个在非零测度集上严格为正的非负函数进行积分，会得到一个正的结果。因此，将两边从$0$到$t$积分：\n$$ \\int_{0}^{t} g_1(u) \\,du  \\int_{0}^{t} g_{KM}(u) \\,du $$\n这就证明了对所有$t > 0$都有$F_1(t)  F_1^{KM}(t)$，表明将竞争事件作删失处理会导致对累积发生率的高估。这种错误的方法之所以会高估概率，是因为它没有考虑到那些因竞争事件而从风险集中移除的个体，这些个体因此不再有资格经历我们所关注的事件。\n\n现在，我们计算指定情景下的绝对偏差。\n给定：$\\lambda_1(t) \\equiv \\alpha = 0.08 \\text{ 年}^{-1}$ 和 $\\lambda_2(t) \\equiv \\beta = 0.12 \\text{ 年}^{-1}$。\n总风险为常数：$\\lambda(t) = \\alpha + \\beta = 0.08 + 0.12 = 0.20 \\text{ 年}^{-1}$。\n\n在时间$t$，原因1的基于KM的量是：\n$$ F_1^{KM}(t) = 1 - \\exp\\left(-\\int_{0}^{t} \\alpha \\,du\\right) = 1 - \\exp(-\\alpha t) $$\n\n在时间$t$，原因1的真实累积发生率函数是：\n$$ F_1(t) = \\int_{0}^{t} \\alpha \\exp(-(\\alpha+\\beta)u) \\,du = \\alpha \\left[ \\frac{\\exp(-(\\alpha+\\beta)u)}{-(\\alpha+\\beta)} \\right]_{0}^{t} $$\n$$ F_1(t) = \\frac{\\alpha}{\\alpha+\\beta} \\left(1 - \\exp(-(\\alpha+\\beta)t)\\right) $$\n\n在时间$t$的绝对偏差是 $\\text{Bias}(t) = F_1^{KM}(t) - F_1(t)$。\n$$ \\text{Bias}(t) = \\left(1 - \\exp(-\\alpha t)\\right) - \\frac{\\alpha}{\\alpha+\\beta} \\left(1 - \\exp(-(\\alpha+\\beta)t)\\right) $$\n我们需要计算在$t=2$年时的这个偏差。\n$$ \\text{Bias}(2) = \\left(1 - \\exp(-0.08 \\times 2)\\right) - \\frac{0.08}{0.08+0.12} \\left(1 - \\exp(-(0.08+0.12) \\times 2)\\right) $$\n$$ \\text{Bias}(2) = \\left(1 - \\exp(-0.16)\\right) - \\frac{0.08}{0.20} \\left(1 - \\exp(-0.20 \\times 2)\\right) $$\n$$ \\text{Bias}(2) = \\left(1 - \\exp(-0.16)\\right) - 0.4 \\left(1 - \\exp(-0.4)\\right) $$\n现在，我们计算数值：\n$\\exp(-0.16) \\approx 0.852143788$\n$\\exp(-0.4) \\approx 0.670320046$\n$$ \\text{Bias}(2) \\approx (1 - 0.852143788) - 0.4 \\times (1 - 0.670320046) $$\n$$ \\text{Bias}(2) \\approx 0.147856212 - 0.4 \\times (0.329679954) $$\n$$ \\text{Bias}(2) \\approx 0.147856212 - 0.1318719816 $$\n$$ \\text{Bias}(2) \\approx 0.0159842304 $$\n四舍五入到四位有效数字，结果是$0.01598$。",
            "answer": "$$\\boxed{0.01598}$$"
        }
    ]
}