{
    "hands_on_practices": [
        {
            "introduction": "理论知识是基础，但只有通过亲手实践才能真正掌握生存分析的核心。这个练习 () 提供了一个典型的临床研究数据集，旨在引导你从头开始、一步一步地构建Kaplan-Meier生存曲线。通过处理删失数据和计算风险集，你将能熟练掌握估算中位生存时间的基本技能。",
            "id": "4911089",
            "problem": "一组参加临床研究的 $20$ 名患者被随访观察至死亡时间，对于失访或研究结束的患者进行右删失。令 $T$ 表示非负连续的事件发生时间随机变量，$S(t) = \\Pr(T > t)$ 表示生存函数。假设为非信息性右删失，并且当事件和删失发生在同一记录时间时，先处理事件，后处理删失。观测数据由数对 $(t_i, \\delta_i)$ 组成，其中 $t_i$ 是以月为单位的记录时间，$\\delta_i \\in \\{0,1\\}$ 指示在 $t_i$ 时发生的是死亡（$\\delta_i = 1$）还是右删失（$\\delta_i = 0$）。这 $20$ 个观测数对如下：\n- $(2, 1)$,\n- $(3, 1)$,\n- $(3, 0)$,\n- $(4, 0)$,\n- $(5, 1)$,\n- $(6, 1)$,\n- $(7, 0)$,\n- $(8, 1)$,\n- $(9, 0)$,\n- $(10, 1)$,\n- $(11, 1)$,\n- $(12, 0)$,\n- $(12, 1)$,\n- $(13, 0)$,\n- $(14, 0)$,\n- $(15, 1)$,\n- $(16, 0)$,\n- $(18, 0)$,\n- $(20, 1)$,\n- $(22, 0)$.\n\n仅使用生存函数的定义和在所述假设下处理右删失的原则，通过 Kaplan-Meier 方法根据这些数据构建 $S(t)$ 的阶梯估计量，然后提取估计的中位生存时间（即估计的生存函数小于或等于 $1/2$ 的最小时间 $t$）。最终时间以月为单位表示，并将您的答案四舍五入到三位有效数字。",
            "solution": "用户提供了一个生物统计学问题，要求根据右删失数据估计中位生存时间。\n\n### 步骤 1：提取已知条件\n-   **队列规模**：$n = 20$ 名患者。\n-   **随机变量**：$T$，一个非负连续的事件发生时间变量。\n-   **生存函数**：$S(t) = \\Pr(T > t)$。\n-   **数据结构**：数对 $(t_i, \\delta_i)$，其中 $t_i$ 是以月为单位的时间，$\\delta_i=1$ 表示事件（死亡），$\\delta_i=0$ 表示右删失。\n-   **假设**：非信息性右删失。对于时间上的并列，先处理事件，后处理删失。\n-   **数据集**：这 $20$ 个观测数对是 $(2, 1)$, $(3, 1)$, $(3, 0)$, $(4, 0)$, $(5, 1)$, $(6, 1)$, $(7, 0)$, $(8, 1)$, $(9, 0), (10, 1)$, $(11, 1)$, $(12, 0)$, $(12, 1)$, $(13, 0)$, $(14, 0)$, $(15, 1)$, $(16, 0)$, $(18, 0)$, $(20, 1)$, $(22, 0)$。\n-   **目标**：构建 $S(t)$ 的 Kaplan-Meier 估计量，并找到估计的中位生存时间，定义为满足 $\\hat{S}(t) \\le 1/2$ 的最小时间 $t$。结果必须以月为单位，并四舍五入到三位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它是 Kaplan-Meier 方法的标准应用，而 Kaplan-Meier 方法是生存分析中的一个基本工具。该问题提法明确，提供了所有必要的数据、一个明确的目标和具体的定义，包括一个并列处理规则和要使用的中位生存时间的确切定义。语言客观而精确。数据对于一个小型临床研究来说是合理的。该问题不违反任何无效性标准。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整的解答。\n\n### 解答\n生存函数 $\\hat{S}(t)$ 的 Kaplan-Meier 估计量是一种非参数方法，用于从可能存在右删失的生存数据中估计 $S(t)$。它是一种乘积极限估计量，由以下公式给出：\n$$ \\hat{S}(t) = \\prod_{j: t_{(j)} \\le t} \\left(1 - \\frac{d_j}{n_j}\\right) $$\n其中 $t_{(j)}$ 是至少发生一个事件的独特时间点，$d_j$ 是在时间 $t_{(j)}$ 发生的事件数，$n_j$ 是在时间 $t_{(j)}$ 之前处于风险中的个体数量（即那些仍然存活且尚未被删失的个体）。按照惯例，$\\hat{S}(0) = 1$。生存函数的估计值是一个阶梯函数，其值仅在观测到事件的时间点发生变化。\n\n为了计算 $\\hat{S}(t)$，我们首先对不同的事件时间进行排序，并对每一个时间点，确定风险中的个体数量（$n_j$）和事件数量（$d_j$）。我们必须通过在每个时间点减去发生事件或被删失的受试者，来仔细追踪风险中的受试者数量。受试者总数为 $N=20$。\n\n不同的事件时间是 $t=2, 3, 5, 6, 8, 10, 11, 12, 15, 20$。我们将在这些时间点计算生存概率。\n\n-   **初始状态**：在 $t=0$ 时，风险中的受试者数量为 $n=20$。对于 $t \\in [0, 2)$，$\\hat{S}(t)=1$。\n\n-   **在事件时间 $t_{(1)} = 2$**：\n    -   风险中的受试者：$n_1 = 20$。\n    -   观测到的事件：$d_1 = 1$。\n    -   $\\hat{S}(2) = \\hat{S}(0) \\times \\left(1 - \\frac{d_1}{n_1}\\right) = 1 \\times \\left(1 - \\frac{1}{20}\\right) = \\frac{19}{20} = 0.95$。\n    -   下一区间剩余的受试者：$20 - 1(\\text{事件}) = 19$。\n\n-   **在事件时间 $t_{(2)} = 3$**：\n    -   风险中的受试者：$n_2 = 19$。\n    -   观测到的事件：$d_2 = 1$。\n    -   $\\hat{S}(3) = \\hat{S}(2) \\times \\left(1 - \\frac{d_2}{n_2}\\right) = \\frac{19}{20} \\times \\left(1 - \\frac{1}{19}\\right) = \\frac{19}{20} \\times \\frac{18}{19} = \\frac{18}{20} = 0.90$。\n    -   在 $t=3$ 时，也有一名受试者被删失。剩余受试者：$19 - 1(\\text{事件}) - 1(\\text{删失}) = 17$。\n\n-   **在 $t=3$ 和 $t=5$ 之间**：在 $t=4$ 时，一名受试者被删失。剩余受试者：$17 - 1 = 16$。\n\n-   **在事件时间 $t_{(3)} = 5$**：\n    -   风险中的受试者：$n_3 = 16$。\n    -   观测到的事件：$d_3 = 1$。\n    -   $\\hat{S}(5) = \\hat{S}(3) \\times \\left(1 - \\frac{d_3}{n_3}\\right) = \\frac{18}{20} \\times \\left(1 - \\frac{1}{16}\\right) = \\frac{18}{20} \\times \\frac{15}{16} = \\frac{270}{320} = \\frac{27}{32} = 0.84375$。\n    -   剩余受试者：$16 - 1(\\text{事件}) = 15$。\n\n-   **在事件时间 $t_{(4)} = 6$**：\n    -   风险中的受试者：$n_4 = 15$。\n    -   观测到的事件：$d_4 = 1$。\n    -   $\\hat{S}(6) = \\hat{S}(5) \\times \\left(1 - \\frac{d_4}{n_4}\\right) = \\frac{27}{32} \\times \\left(1 - \\frac{1}{15}\\right) = \\frac{27}{32} \\times \\frac{14}{15} = \\frac{378}{480} = \\frac{63}{80} = 0.7875$。\n    -   剩余受试者：$15 - 1 = 14$。在 $t=7$ 时，一名受试者被删失，剩下 $13$ 人。\n\n-   **在事件时间 $t_{(5)} = 8$**：\n    -   风险中的受试者：$n_5 = 13$。\n    -   观测到的事件：$d_5 = 1$。\n    -   $\\hat{S}(8) = \\hat{S}(6) \\times \\left(1 - \\frac{d_5}{n_5}\\right) = \\frac{63}{80} \\times \\left(1 - \\frac{1}{13}\\right) = \\frac{63}{80} \\times \\frac{12}{13} = \\frac{756}{1040} = \\frac{189}{260} \\approx 0.7269$。\n    -   剩余受试者：$13-1=12$。在 $t=9$ 时，一名受试者被删失，剩下 $11$ 人。\n\n-   **在事件时间 $t_{(6)} = 10$**：\n    -   风险中的受试者：$n_6 = 11$。\n    -   观测到的事件：$d_6 = 1$。\n    -   $\\hat{S}(10) = \\hat{S}(8) \\times \\left(1 - \\frac{d_6}{n_6}\\right) = \\frac{189}{260} \\times \\left(1 - \\frac{1}{11}\\right) = \\frac{189}{260} \\times \\frac{10}{11} = \\frac{189}{286} \\approx 0.6608$。\n    -   剩余受试者：$11-1 = 10$。\n\n-   **在事件时间 $t_{(7)} = 11$**：\n    -   风险中的受试者：$n_7 = 10$。\n    -   观测到的事件：$d_7 = 1$。\n    -   $\\hat{S}(11) = \\hat{S}(10) \\times \\left(1 - \\frac{d_7}{n_7}\\right) = \\frac{189}{286} \\times \\left(1 - \\frac{1}{10}\\right) = \\frac{189}{286} \\times \\frac{9}{10} = \\frac{1701}{2860} \\approx 0.5948$。\n    -   剩余受试者：$10-1 = 9$。\n\n-   **在事件时间 $t_{(8)} = 12$**：\n    -   风险中的受试者：$n_8 = 9$。\n    -   观测到的事件：$d_8 = 1$。根据规则，在同一时间点，事件在删失之前处理。\n    -   $\\hat{S}(12) = \\hat{S}(11) \\times \\left(1 - \\frac{d_8}{n_8}\\right) = \\frac{1701}{2860} \\times \\left(1 - \\frac{1}{9}\\right) = \\frac{1701}{2860} \\times \\frac{8}{9} = \\frac{1512}{2860} = \\frac{378}{715} \\approx 0.5287$。\n    -   剩余受试者：$9-1(\\text{事件}) - 1(\\text{删失}) = 7$。\n\n-   **在 $t=12$ 和 $t=15$ 之间**：在 $t=13$ 时，一人被删失（剩下 6 人）。在 $t=14$ 时，一人被删失（剩下 5 人）。\n\n-   **在事件时间 $t_{(9)} = 15$**：\n    -   风险中的受试者：$n_9 = 5$。\n    -   观测到的事件：$d_9 = 1$。\n    -   $\\hat{S}(15) = \\hat{S}(12) \\times \\left(1 - \\frac{d_9}{n_9}\\right) = \\frac{378}{715} \\times \\left(1 - \\frac{1}{5}\\right) = \\frac{378}{715} \\times \\frac{4}{5} = \\frac{1512}{3575} \\approx 0.4229$。\n\n我们正在寻找中位生存时间，定义为满足 $\\hat{S}(t) \\le 0.5$ 的最小时间 $t$。\n让我们检查一下我们计算出的估计生存函数的值：\n-   对于 $t \\in [12, 15)$，$\\hat{S}(t) = \\hat{S}(12) \\approx 0.5287$，该值大于 $0.5$。\n-   在 $t=15$ 时，生存函数下降到 $\\hat{S}(15) \\approx 0.4229$，该值小于或等于 $0.5$。\n\n因此，满足条件 $\\hat{S}(t) \\le 0.5$ 的最小时间 $t$ 是 $15$ 个月。\n\n问题要求将答案四舍五入到三位有效数字。确切答案是 $15$。为了用三位有效数字表示，我们将其写为 $15.0$。",
            "answer": "$$\n\\boxed{15.0}\n$$"
        },
        {
            "introduction": "在理想情况下，生存曲线会下降到$0.5$以下，从而可以明确地估算出中位生存时间。然而，在实际研究中，尤其是在随访时间有限或事件发生率较低时，情况并非总是如此。本练习 () 提出了一个关键的挑战性场景：当Kaplan-Meier生存曲线 $\\hat{S}(t)$ 在整个观察期内始终保持在$0.5$以上时，我们该如何解释和报告结果？",
            "id": "4605660",
            "problem": "一项队列研究对 $10$ 名患者进行随访，观察其带有独立右删失的事件发生时间结局。令 $T$ 表示事件时间，生存函数为 $S(t) = \\mathbb{P}(T > t)$。生存函数的 Kaplan-Meier (KM) 估计量，记为 $\\hat S(t)$，是根据观测到的事件时间和删失时间构建的。中位生存时间 $m$ 定义为满足 $S(t) \\le 0.5$ 的最小时间 $t$。管理删失发生在最长随访时间 $\\tau$ 时。\n\n假设观测数据如下：\n- $3$ 名患者的事件时间（单位：月）：$2$，$4$，$7$。\n- 其余 $7$ 名患者的删失时间（单位：月）：$9$。\n\n假设除了明确说明的情况外，没有结（即时间点重复）。使用 Kaplan-Meier 估计量的基本原理，计算在各个事件时间点的 $\\hat S(t)$ 值，并确定在时间 $t = \\tau = 9$ 个月时，$\\hat S(t)$ 是否穿过 $0.5$。然后，基于此判断，选择最恰当描述如何处理中位生存估计值以及如何在这种情况下正式表示一个删失的中位数或不可估计情景的选项。\n\nA. 报告中位生存时间为 $7$ 个月，因为这是在管理删失前观测到的最后一个事件时间。\n\nB. 报告中位生存时间在 $[0,\\tau]$ 内不可估计，因为 $\\hat S(t)$ 从未降至 $\\le 0.5$；通过声明 $m > \\tau$ 将中位数视为在 $\\tau$ 之后右删失，并且，如果需要，可以通过反转 $\\hat S(t)$ 的置信区间来提供 $m$ 的单侧置信下限，和/或报告一个替代性总结指标，如限制性平均生存时间 $\\int_{0}^{\\tau} \\hat S(t)\\, dt$。\n\nC. 在 $\\hat S(7)$ 和 $\\hat S(9)$ 之间进行线性插值，以找到使 $\\hat S(t)$ 等于 $0.5$ 的时间 $t \\in (7,9)$，并报告该时间为中位生存时间。\n\nD. 拟合一个指数参数模型来推算中位生存时间，并将该值报告为 Kaplan-Meier 中位数。",
            "solution": "在进行解答之前，对问题陈述进行严格验证。\n\n### 步骤 1：提取已知条件\n- 队列研究中的患者总数：$N = 10$。\n- 结局：带有独立右删失的事件发生时间。\n- 事件时间变量：$T$。\n- 生存函数的定义：$S(t) = \\mathbb{P}(T > t)$。\n- 生存函数的估计量：Kaplan-Meier (KM) 估计量，$\\hat S(t)$。\n- 中位生存时间 $m$ 的定义：满足 $S(t) \\le 0.5$ 的最小时间 $t$。\n- 最长随访时间（管理删失）：$\\tau$。\n- 观测数据：\n    - 事件时间：$2, 4, 7$ 月（$d=3$ 名患者）。\n    - 删失时间：$9$ 月（$c=7$ 名患者）。\n- 假设：除数据中明确说明外，没有结。\n- 任务：在事件时间点计算 $\\hat S(t)$，确定在 $t = \\tau = 9$ 个月时 $\\hat S(t)$ 是否穿过 $0.5$，并选择处理中位生存估计的适当选项。\n\n根据数据，最长随访时间 $\\tau$ 为 $9$ 个月，因为这是观测到的最晚时间点，并被指定为管理删失时间。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学性：** 问题基于 Kaplan-Meier 估计量，这是生物统计学和流行病学中生存分析的基石。所有概念——生存函数、删失、中位生存——都是标准且明确定义的。该问题是这一成熟方法的直接应用。\n2.  **良态性：** 问题提供了构建 Kaplan-Meier 曲线所需的所有数据：总样本量、事件的数量和时间，以及删失的数量和时间。问题具体且可回答。可以根据这些数据构建唯一的 Kaplan-Meier 曲线。\n3.  **客观性：** 问题使用精确、客观和标准的统计术语陈述。没有歧义或主观性语言。\n4.  **缺陷分析：**\n    - **科学或事实不准确：** 无。生存分析的原理陈述正确。\n    - **不可形式化或不相关：** 无。该问题是生物统计学中一个形式化且相关的练习。\n    - **设置不完整或矛盾：** 无。数据完整且一致。发生事件的患者数（$3$）和删失的患者数（$7$）之和等于队列总规模（$10$）。\n    - **不切实际或不可行：** 无。数据代表了一项合理的小规模研究。\n    - **病态或结构不良：** 无。中位数的定义是标准的。问题根据数据可导出一个唯一的结论。\n    - **伪深刻、琐碎或同义反复：** 无。该问题需要对一个标准统计估计量进行正确计算和解释，这不是一项微不足道的任务。\n    - **超出科学可验证性：** 无。计算过程完全可以验证。\n\n### 步骤 3：结论和行动\n问题陈述是**有效的**。将根据所提供的信息推导出解决方案。\n\n### Kaplan-Meier 估计量的推导\n\nKaplan-Meier 估计量 $\\hat S(t)$ 是生存函数的非参数乘积极限估计量。其计算公式为：\n$$ \\hat S(t) = \\prod_{i: t_i \\le t} \\left(1 - \\frac{d_i}{n_i}\\right) $$\n其中 $t_i$ 是不同的事件时间，$d_i$ 是在时间 $t_i$ 发生的事件数，而 $n_i$ 是在时间 $t_i$ 之前处于风险中的个体数（即存活且尚未删失的个体数）。\n\n首先按时间对数据进行排序：\n- 在 $t=2$ 时发生事件。\n- 在 $t=4$ 时发生事件。\n- 在 $t=7$ 时发生事件。\n- 在 $t=9$ 时有 $7$ 名患者被删失。\n\n我们构建一个生命表来计算每个事件时间点的 $\\hat S(t)$。\n\n1.  **时间 $t=0$**：研究开始。风险中的患者数为 $n_0=10$。对于 $t \\in [0, 2)$，生存估计值为 $\\hat S(t) = 1.0$。\n\n2.  **事件发生于 $t_1 = 2$ 月**：\n    - 在 $t=2$ 之前的风险人数：$n_1 = 10$。\n    - 在 $t=2$ 时的事件数：$d_1 = 1$。\n    - 此步骤的生存概率为 $(1 - d_1/n_1) = (1 - 1/10) = 0.9$。\n    - 累积生存率为 $\\hat S(2) = 1.0 \\times 0.9 = 0.9$。\n    - 对于 $t \\in [2, 4)$，$\\hat S(t) = 0.9$。\n    - 事件发生后，仍有 $10 - 1 = 9$ 名患者处于风险中。\n\n3.  **事件发生于 $t_2 = 4$ 月**：\n    - 在 $t=4$ 之前的风险人数：$n_2 = 9$。\n    - 在 $t=4$ 时的事件数：$d_2 = 1$。\n    - 此步骤的生存概率为 $(1 - d_2/n_2) = (1 - 1/9) = 8/9$。\n    - 累积生存率为 $\\hat S(4) = \\hat S(2) \\times (8/9) = 0.9 \\times (8/9) = (9/10) \\times (8/9) = 8/10 = 0.8$。\n    - 对于 $t \\in [4, 7)$，$\\hat S(t) = 0.8$。\n    - 事件发生后，仍有 $9 - 1 = 8$ 名患者处于风险中。\n\n4.  **事件发生于 $t_3 = 7$ 月**：\n    - 在 $t=7$ 之前的风险人数：$n_3 = 8$。\n    - 在 $t=7$ 时的事件数：$d_3 = 1$。\n    - 此步骤的生存概率为 $(1 - d_3/n_3) = (1 - 1/8) = 7/8$。\n    - 累积生存率为 $\\hat S(7) = \\hat S(4) \\times (7/8) = 0.8 \\times (7/8) = (8/10) \\times (7/8) = 7/10 = 0.7$。\n    - 对于 $t \\in [7, 9)$，$\\hat S(t) = 0.7$。\n    - 事件发生后，仍有 $8 - 1 = 7$ 名患者处于风险中。\n\n5.  **删失发生于 $t = 9$ 月**：\n    - 在 $t=9$ 时，剩余的 $7$ 名患者被删失。\n    - 删失事件不会导致 Kaplan-Meier 生存估计值发生变化。因此，在 $t=9$ 时，$\\hat S(t)$ 的值保持为 $0.7$。\n    - 研究在 $\\tau=9$ 个月时结束。生存函数的最后一个计算值为 $\\hat S(9) = 0.7$。\n\n### 中位生存时间的确定\n\n中位生存时间 $m$ 定义为满足 $\\hat S(t) \\le 0.5$ 的最小时间 $t$。\n根据我们的计算，在随访期结束时（$t=\\tau=9$），生存估计的最终值为 $\\hat S(9) = 0.7$。\n由于 $0.7 > 0.5$，Kaplan-Meier 曲线在观测期 $[0, 9]$ 内从未降至或低于 $0.5$ 的阈值。因此，中位生存时间未达到，无法从观测数据中估计。唯一可以得出的结论是中位生存时间大于最长随访持续时间，即 $m > 9$ 个月。这被称为右删失中位数。\n\n### 逐项分析选项\n\n**A. 报告中位生存时间为 $7$ 个月，因为这是在管理删失前观测到的最后一个事件时间。**\n- **分析：** 这是不正确的。中位生存时间由生存概率达到 $0.5$ 定义，而不是由最后观测到的事件时间定义。在 $t=7$ 个月时，估计的生存概率为 $\\hat S(7) = 0.7$，远高于 $0.5$。\n- **结论：** 不正确。\n\n**B. 报告中位生存时间在 $[0,\\tau]$ 内不可估计，因为 $\\hat S(t)$ 从未降至 $\\le 0.5$；通过声明 $m > \\tau$ 将中位数视为在 $\\tau$ 之后右删失，并且，如果需要，可以通过反转 $\\hat S(t)$ 的置信区间来提供 $m$ 的单侧置信下限，和/或报告一个替代性总结指标，如限制性平均生存时间 $\\int_{0}^{\\tau} \\hat S(t)\\, dt$。**\n- **分析：** 该陈述准确地反映了我们推导的结果。KM 估计量 $\\hat S(t)$ 在研究结束时的最小值为 $0.7$，因此它从未达到 $\\le 0.5$。在这种情况下，正确的统计实践是断定中位数在研究时间范围内不可估计，并且是右删失的，即 $m > \\tau=9$ 个月。该选项还正确列出了此类情况下的标准和适当的替代总结指标：通过反转 $S(t)$ 的置信区间来找到中位数的下限，或计算限制性平均生存时间 (RMST)，即 KM 曲线下直到 $\\tau$ 的面积。此选项代表了一种完整且专业上合理的处理方法。\n- **结论：** 正确。\n\n**C. 在 $\\hat S(7)$ 和 $\\hat S(9)$ 之间进行线性插值，以找到使 $\\hat S(t)$ 等于 $0.5$ 的时间 $t \\in (7,9)$，并报告该时间为中位生存时间。**\n- **分析：** 这是一个无效的程序。Kaplan-Meier 曲线是阶梯函数，而不是连续的线。它在事件时间之间是恒定的。具体来说，对于区间 $[7, 9)$ 中的任何时间 $t$，$\\hat S(t) = 0.7$。线性插值不是 KM 估计方法的一个特征，它会假设生存概率呈线性下降，而模型明确指出其是恒定的，从而产生一个虚假的结果。\n- **结论：** 不正确。\n\n**D. 拟合一个指数参数模型来推算中位生存时间，并将该值报告为 Kaplan–Meier 中位数。**\n- **分析：** 此选项建议从非参数方法（Kaplan-Meier）切换到参数方法（指数模型）。虽然拟合参数模型是一种有效的统计技术，但得到的中位数估计值将来自指数模型，而不是 Kaplan-Meier 估计量。问题明确要求的是 Kaplan-Meier 中位数。将参数估计与非参数估计混为一谈是方法论上的错误。\n- **结论：** 不正确。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "掌握了Kaplan-Meier方法后，一个自然而然的问题是：这是唯一的分析方法吗？它总是最好的选择吗？这个综合性练习 () 旨在拓宽你的分析视野，通过直接比较非参数化的Kaplan-Meier估计与参数化的指数模型，让你深入理解不同模型背后的假设和适用性。你将学习如何评估模型的拟合优度，并使用对数秩检验（log-rank test）来比较不同组间的生存差异，这是生存分析中一项至关重要的技能。",
            "id": "4576941",
            "problem": "给定右删失生存数据，要求您协调非参数Kaplan-Meier估计量的中位生存时间与参数化指数模型所隐含的中位生存时间之间的差异。您的推导和算法必须从生存分析的第一性原理出发，除了核心定义和广为接受的事实之外，不得使用任何预先指定的“快捷”公式。您可以引用的核心基础包括：生存函数 $S(t) = \\mathbb{P}(T > t)$ 的定义、风险函数 $h(t)$、非信息性右删失的假设以及最大似然估计（MLE）中的一般似然原理。基于这些，您必须推导出必要的估计程序，并设计一个算法来计算所需的输出。\n\n对于下方的每个数据集，您必须为整个队列计算以下三个量（在计算中位数和差异时忽略组别标签）：\n- Kaplan-Meier中位生存时间与指数模型隐含的中位生存时间之间的绝对差值，单位为月，以浮点数表示。如果Kaplan-Meier中位数在观测时间范围内未达到（即Kaplan-Meier生存曲线从未降至或低于$0.5$），则此差值输出哨兵值$-1.0$。\n- 指数模型的描述性拟合优度差异，定义为非参数累积风险与指数模型累积风险之差的上确界范数，即 $\\sup_{t \\in \\mathcal{T}_{\\text{event}}} \\left| \\widehat{H}(t) - \\widehat{\\lambda} \\, t \\right|$，其中 $\\widehat{H}(t)$ 是在观测事件时间点评估的非参数累积风险，$\\widehat{\\lambda}$ 是右删失下指数模型中恒定风险的MLE，$\\mathcal{T}_{\\text{event}}$ 是不同观测事件时间的集合。该值以浮点数表示。\n- 比较组 $0$ 与组 $1$ 生存经历的双样本对数秩检验$p$值，以十进制浮点数形式报告。此检验测试了两组间风险相等的零假设。\n\n所有时间值均以月为单位。中位数差异以月为单位，表示为浮点数；上确界范数差异表示为浮点数；对数秩检验$p$值表示为浮点数。\n\n推导和算法设计的基础原理：\n- 生存分析中的生存函数 $S(t) = \\mathbb{P}(T > t)$ 和风险函数 $h(t)$ 概念。\n- 非信息性右删失假设，意味着在给定协变量的情况下，删失时间与失效时间是独立的。\n- 用于从右删失数据中进行生存非参数估计的乘积极限原理。\n- 右删失下参数模型的似然原理和MLE。\n- 通过Nelson-Aalen方法对累积风险的计数过程直观理解。\n- 作为基于风险集和观测事件的两组间风险相等性的非参数得分检验的对数秩检验框架。\n\n您的程序必须直接根据这些原理实现计算，包括Kaplan-Meier估计量、右删失下的指数MLE、非参数累积风险和双样本对数秩检验。不提供外部输入；请完全按照下方给出的数据集使用。\n\n测试套件（所有时间单位为月；在每个数据集中，三个对齐的列表分别是 $t_i$（时间）、$\\delta_i$（事件指示符：$1$ 表示事件， $0$ 表示右删失）和 $g_i$（组别标签：$0$ 或 $1$））：\n\n- 数据集 A（一般“理想”情况，具有中度删失和近似恒定的风险）：\n  - $t$：[$2.1$, $3.0$, $3.7$, $4.2$, $5.0$, $5.5$, $6.9$, $7.2$, $8.1$, $9.0$, $10.5$, $11.0$, $12.0$, $13.5$]\n  - $\\delta$：[$1$, $1$, $0$, $1$, $0$, $1$, $1$, $0$, $1$, $0$, $1$, $0$, $1$, $0$]\n  - $g$：[$0$, $0$, $1$, $1$, $0$, $1$, $0$, $1$, $0$, $1$, $0$, $1$, $0$, $1$]\n\n- 数据集 B（边界情况，由于生存曲线未降至或低于 $0.5$，因此未达到Kaplan-Meier中位数）：\n  - $t$：[$2.0$, $3.5$, $4.0$, $5.0$, $6.5$, $8.0$]\n  - $\\delta$：[$1$, $0$, $0$, $0$, $0$, $0$]\n  - $g$：[$0$, $1$, $0$, $1$, $0$, $1$]\n\n- 数据集 C（边缘情况，具有显著非恒定的风险和组间异质性，导致非参数和指数摘要之间出现差异）：\n  - $t$：[$1.0$, $1.2$, $1.5$, $2.0$, $2.2$, $2.5$, $5.0$, $6.0$, $7.0$, $8.0$, $9.0$, $12.0$, $15.0$, $18.0$]\n  - $\\delta$：[$1$, $1$, $1$, $1$, $1$, $1$, $0$, $0$, $1$, $0$, $0$, $1$, $0$, $0$]\n  - $g$：[$0$, $0$, $0$, $0$, $0$, $0$, $0$, $1$, $1$, $1$, $1$, $1$, $1$, $1$]\n\n每个数据集的必需输出，按此确切顺序：\n- Kaplan-Meier中位数与指数模型中位数之间的绝对差值（单位：月）。如果未达到Kaplan-Meier中位数，则输出$-1.0$。\n- 上确界范数差异 $\\sup_{t \\in \\mathcal{T}_{\\text{event}}} \\left| \\widehat{H}(t) - \\widehat{\\lambda} \\, t \\right|$。\n- 组 $0$ 与组 $1$ 的双样本对数秩检验$p$值。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个JSON格式的列表，该列表包含三个列表。每个内部列表对应一个数据集（按 A、B、C 的确切顺序），并包含上述三个浮点数结果（按确切顺序）。例如，打印的行必须具有单个方括号括起来的三个三元组列表的句法形式，即类似列表的列表的单行字符串。不应打印任何额外文本。\n\n所有计算必须仅使用指定的库来执行。确保数值稳定性并正确处理并列事件时间和右删失。最终数字必须与上述定义和原理一致。时间差必须以月为单位，作为浮点数报告，概率或$p$值必须以小数形式报告（而不是百分比）。",
            "solution": "问题陈述经评估有效。它在科学上基于生存分析的既定原则，问题设定良好，目标明确，数据完整，且表述客观。不存在矛盾、歧义或伪科学主张。因此，我们可以按照要求，从第一性原理出发推导解决方案。\n\n该任务要求为三个数据集中的每一个计算三个不同的量：（1）非参数估计的中位生存时间与参数化估计的中位生存时间之间的绝对差值，（2）参数化模型的拟合优度度量，以及（3）来自生存分布双样本检验的p值。这些中的每一个都将从基本概念中推导出来。\n\n设 $n$ 个个体的观测数据为一组三元组 $(T_i, \\delta_i, g_i)$，其中 $i=1, \\dots, n$，$T_i \\ge 0$ 是观测时间（事件发生时间或删失时间），$\\delta_i \\in \\{0, 1\\}$ 是事件指示符（如果事件发生则 $\\delta_i=1$，如果观测值被右删失则 $\\delta_i=0$），$g_i \\in \\{0, 1\\}$ 是分组。我们假设非信息性删失。\n\n### 所需估计量和检验的推导\n\n#### 1. 非参数估计：Kaplan-Meier 和 Nelson-Aalen\n\n**生存函数 $\\widehat{S}(t)$ 的Kaplan-Meier (KM) 估计量**\n\n生存函数 $S(t) = \\mathbb{P}(\\text{真实事件时间 } T > t)$ 是存活超过时间 $t$ 的概率。Kaplan-Meier或乘积极限估计量是一种从右删失数据中估计 $S(t)$ 的非参数方法。\n\n设 $t_1  t_2  \\dots  t_k$ 为数据中不同的观测事件时间。在每个这样的时间 $t_j$，设 $d_j$ 是在 $t_j$ 时经历事件的个体数量，设 $n_j$ 是在时间 $t_j$ 之前处于“风险中”（即存活且在观察中）的个体数量。风险集中的数量 $n_j$ 是所有满足 $T_i \\ge t_j$ 的受试者 $i$ 的计数。\n\n在存活到 $t_j$ 之前的条件下，存活过 $t_j$ 的条件概率估计为 $(n_j - d_j)/n_j$。在时间 $t$ 的总生存概率是截至 $t$ 的所有事件时间的这些条件概率的乘积。\n\n因此，Kaplan-Meier估计量为：\n$$\n\\widehat{S}(t) = \\prod_{j: t_j \\le t} \\left( 1 - \\frac{d_j}{n_j} \\right)\n$$\n按照惯例，对于 $t  t_1$，$\\widehat{S}(t) = 1$。这产生一个右连续的阶梯函数，仅在观测到事件的时间点下降。\n\n**Kaplan-Meier中位生存时间, $\\widehat{t}_{KM\\_median}$**\n\n中位生存时间是 $S(t) = 0.5$ 时的时间 $t$。对于KM估计量，中位数定义为生存曲线首次降至或低于 $0.5$ 的最早时间：\n$$\n\\widehat{t}_{KM\\_median} = \\inf \\{t : \\widehat{S}(t) \\le 0.5\\}\n$$\n如果生存曲线在整个观察期间内没有降至或低于 $0.5$（即 $\\widehat{S}(T_{\\max}) > 0.5$，其中 $T_{\\max}$ 是最大观测时间），则中位数在数据范围内未达到。问题指定在这种情况下，最终的中位数差异使用哨兵值 $-1.0$。\n\n**累积风险函数 $\\widehat{H}(t)$ 的Nelson-Aalen (NA) 估计量**\n\n风险函数 $h(t)$ 表示在存活至时间 $t$ 的条件下，在时间 $t$ 的瞬时失效率。累积风险函数是 $H(t) = \\int_0^t h(u) du$。Nelson-Aalen估计量提供了 $H(t)$ 的非参数估计。\n\n在每个事件时间 $t_j$，瞬时风险通过经历事件的风险个体比例来估计，$\\Delta \\widehat{H}(t_j) = d_j/n_j$。累积风险是这些增量的总和：\n$$\n\\widehat{H}(t) = \\sum_{j: t_j \\le t} \\frac{d_j}{n_j}\n$$\n与KM估计量类似，NA估计量也是一个右连续的阶梯函数。\n\n#### 2. 参数估计：指数模型\n\n**指数率 $\\widehat{\\lambda}$ 的最大似然估计（MLE）**\n\n指数模型假设风险率恒定，即 $h(t) = \\lambda$。这意味着生存函数为 $S(t) = e^{-\\lambda t}$，概率密度函数为 $f(t) = \\lambda e^{-\\lambda t}$。\n\n为了从右删失数据中估计 $\\lambda$，我们使用最大似然估计。似然函数 $L(\\lambda)$ 是每个个体贡献的乘积。\n- 在时间 $T_i$ 观测到事件的个体 $i$（$\\delta_i=1$）对似然的贡献是 $f(T_i) = \\lambda e^{-\\lambda T_i}$。\n- 在时间 $T_i$ 被删失的个体 $i$（$\\delta_i=0$）对似然的贡献是 $S(T_i) = e^{-\\lambda T_i}$。\n\n对于 $n$ 个个体的总似然是：\n$$\nL(\\lambda) = \\prod_{i=1}^{n} [f(T_i)]^{\\delta_i} [S(T_i)]^{1-\\delta_i} = \\prod_{i=1}^{n} [\\lambda e^{-\\lambda T_i}]^{\\delta_i} [e^{-\\lambda T_i}]^{1-\\delta_i} = \\prod_{i=1}^{n} \\lambda^{\\delta_i} e^{-\\lambda T_i}\n$$\n设 $D = \\sum_{i=1}^{n} \\delta_i$ 是事件总数。似然函数简化为：\n$$\nL(\\lambda) = \\lambda^D e^{-\\lambda \\sum_{i=1}^{n} T_i}\n$$\n最大化对数似然 $\\ell(\\lambda) = \\ln L(\\lambda)$ 更为容易：\n$$\n\\ell(\\lambda) = D \\ln(\\lambda) - \\lambda \\sum_{i=1}^{n} T_i\n$$\n对 $\\lambda$ 求导并令其为零以找到最大值：\n$$\n\\frac{d\\ell}{d\\lambda} = \\frac{D}{\\lambda} - \\sum_{i=1}^{n} T_i = 0\n$$\n解出 $\\lambda$ 得到 MLE：\n$$\n\\widehat{\\lambda} = \\frac{D}{\\sum_{i=1}^{n} T_i} = \\frac{\\text{事件总数}}{\\text{总研究时间}}\n$$\n\n**指数模型中位生存时间, $t_{exp\\_median}$**\n\n使用估计的生存函数 $\\widehat{S}(t) = e^{-\\widehat{\\lambda}t}$，我们通过求解 $\\widehat{S}(t_{exp\\_median}) = 0.5$ 来找到中位时间：\n$$\ne^{-\\widehat{\\lambda}t_{exp\\_median}} = 0.5 \\implies -\\widehat{\\lambda}t_{exp\\_median} = \\ln(0.5) = -\\ln(2)\n$$\n$$\nt_{exp\\_median} = \\frac{\\ln(2)}{\\widehat{\\lambda}}\n$$\n\n#### 3. 所需计算\n\n**中位数绝对差值**\n\n计算公式为 $|\\widehat{t}_{KM\\_median} - t_{exp\\_median}|$，除非KM中位数未达到，此时该值为 $-1.0$。\n\n**拟合优度差异**\n\n这是非参数和参数累积风险估计值之差的上确界范数，在观测事件时间集合 $\\mathcal{T}_{\\text{event}}$ 上进行评估：\n$$\n\\text{Discrepancy} = \\sup_{t \\in \\mathcal{T}_{\\text{event}}} \\left| \\widehat{H}(t) - \\widehat{\\lambda} t \\right|\n$$\n此处，$\\widehat{H}(t)$ 是Nelson-Aalen估计值，$\\widehat{\\lambda}t$ 是指数模型的估计值。值越大表明指数模型对数据的拟合越差。\n\n**对数秩检验**\n\n此检验在零假设 $H_0$（即两组的风险函数相等，$h_0(t) = h_1(t)$）下，比较两组（$g=0$ 和 $g=1$）的生存分布。\n\n该检验统计量是通过在每个不同的事件时间 $t_j$ 检查数据来构建的。在每个 $t_j$，我们可以形成一个 $2 \\times 2$ 列联表：\n\n| | 事件（死亡） | 无事件（存活过 $t_j$） | 风险总数 |\n| :-------- | :-------------: | :---------------------------: | :-----------: |\n| 组 0 | $d_{j0}$ | $n_{j0} - d_{j0}$ | $n_{j0}$ |\n| 组 1 | $d_{j1}$ | $n_{j1} - d_{j1}$ | $n_{j1}$ |\n| **总计** | $d_j$ | $n_j - d_j$ | $n_j$ |\n\n在 $H_0$ 下，组 1 中的事件数 $d_{j1}$ 服从超几何分布。在时间 $t_j$ 组 1 的预期事件数为：\n$$\nE_{j1} = d_j \\frac{n_{j1}}{n_j}\n$$\n对数秩统计量将某一特定组（例如组 1）在所有事件时间的“观测值减期望值”计数相加：\n$$\nO_1 - E_1 = \\sum_{j} (d_{j1} - E_{j1})\n$$\n在时间 $t_j$，$d_{j1}$ 的方差（来自超几何分布）是：\n$$\nV_j = \\frac{d_j (n_j - d_j) n_{j0} n_{j1}}{n_j^2 (n_j - 1)}\n$$\n仅当 $n_j > 1$ 时才计算此项；否则，其对总方差的贡献为 $0$。假设不同事件时间的计数是独立的，总方差为 $V = \\sum_j V_j$。\n\n检验统计量为：\n$$\nZ^2 = \\frac{(O_1 - E_1)^2}{V}\n$$\n在零假设下，$Z^2$ 服从自由度为 $1$ 的卡方分布（$\\chi_1^2$）。$p$ 值是概率 $\\mathbb{P}(\\chi_1^2 > Z^2)$。如果 $V=0$（例如，某一组中没有事件），则统计量无定义，$p$ 值取为 $1.0$，表示没有证据反对 $H_0$。\n\n现在将实施这些原理来分析所提供的数据集。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import chi2\nimport json\n\ndef solve():\n    \"\"\"\n    Main function to process datasets and print results.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Dataset A\n        (\n            [2.1, 3.0, 3.7, 4.2, 5.0, 5.5, 6.9, 7.2, 8.1, 9.0, 10.5, 11.0, 12.0, 13.5],\n            [1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0],\n            [0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1]\n        ),\n        # Dataset B\n        (\n            [2.0, 3.5, 4.0, 5.0, 6.5, 8.0],\n            [1, 0, 0, 0, 0, 0],\n            [0, 1, 0, 1, 0, 1]\n        ),\n        # Dataset C\n        (\n            [1.0, 1.2, 1.5, 2.0, 2.2, 2.5, 5.0, 6.0, 7.0, 8.0, 9.0, 12.0, 15.0, 18.0],\n            [1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0],\n            [0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1]\n        )\n    ]\n\n    all_results = []\n    for times, deltas, groups in test_cases:\n        result_tuple = process_dataset(times, deltas, groups)\n        all_results.append(list(result_tuple))\n\n    # Final print statement in the exact required format.\n    # Using json.dumps to get a compact list-of-lists representation.\n    print(json.dumps(all_results, separators=(',', ':')))\n\n\ndef process_dataset(times, deltas, groups):\n    \"\"\"\n    Performs all required calculations for a single dataset.\n    \"\"\"\n    t = np.array(times)\n    delta = np.array(deltas)\n    g = np.array(groups)\n    n_total = len(t)\n    \n    # --- 1. Parametric Exponential Model Calculations ---\n    total_events = np.sum(delta)\n    total_time_on_study = np.sum(t)\n    lambda_hat = total_events / total_time_on_study if total_time_on_study > 0 else 0\n    exp_median = np.log(2) / lambda_hat if lambda_hat > 0 else np.inf\n\n    # --- 2. Nonparametric Kaplan-Meier and Nelson-Aalen Calculations ---\n    # We loop over unique event times to build the KM and NA curves\n    unique_event_times = np.unique(t[delta == 1])\n    \n    s_hat = 1.0  # Kaplan-Meier survival probability\n    h_hat = 0.0  # Nelson-Aalen cumulative hazard\n    km_median = -999.0 # Sentinel for not found\n\n    discrepancy_values = []\n\n    for time_j in sorted(unique_event_times):\n        at_risk = t >= time_j\n        n_j = np.sum(at_risk)\n        \n        events_at_time = (t == time_j)  (delta == 1)\n        d_j = np.sum(events_at_time)\n\n        if n_j > 0:\n            # Check for KM median cross-over before updating S_hat\n            if s_hat > 0.5 and (s_hat * (1 - d_j / n_j) = 0.5):\n                km_median = time_j\n\n            s_hat *= (1 - d_j / n_j)\n            h_hat += d_j / n_j\n        \n        # Calculate discrepancy at this event time\n        discrepancy_values.append(np.abs(h_hat - lambda_hat * time_j))\n\n    # Finalize median difference\n    # If loop finished and median not found, it's not attained\n    if km_median == -999.0:\n        median_diff = -1.0\n    else:\n        median_diff = np.abs(km_median - exp_median)\n\n    # Finalize goodness-of-fit discrepancy\n    sup_norm_discrepancy = max(discrepancy_values) if discrepancy_values else 0.0\n\n    # --- 3. Log-Rank Test Calculation ---\n    O_minus_E_sum = 0.0\n    V_sum = 0.0\n\n    # Loop over same unique event times\n    for time_j in sorted(unique_event_times):\n        at_risk_mask = t >= time_j\n        n_j = np.sum(at_risk_mask)\n        \n        events_mask = (t == time_j)  (delta == 1)\n        d_j = np.sum(events_mask)\n\n        # Skip if no one is at risk\n        if n_j == 0:\n            continue\n\n        n_j0 = np.sum(at_risk_mask  (g == 0))\n        n_j1 = np.sum(at_risk_mask  (g == 1))\n\n        d_j1 = np.sum(events_mask  (g == 1))\n        \n        # Expected events in group 1\n        E_j1 = d_j * (n_j1 / n_j)\n        O_minus_E_sum += (d_j1 - E_j1)\n\n        # Variance calculation (only if n_j > 1)\n        if n_j > 1:\n            V_j = (d_j * (n_j - d_j) * n_j0 * n_j1) / (n_j**2 * (n_j - 1))\n            V_sum += V_j\n\n    if V_sum > 0:\n        z_squared = (O_minus_E_sum ** 2) / V_sum\n        p_value = chi2.sf(z_squared, df=1)\n    else:\n        # If variance is 0, no basis for comparison, so p-value is 1.\n        p_value = 1.0\n        \n    return median_diff, sup_norm_discrepancy, p_value\n\n# Execute the main function\nsolve()\n```"
        }
    ]
}