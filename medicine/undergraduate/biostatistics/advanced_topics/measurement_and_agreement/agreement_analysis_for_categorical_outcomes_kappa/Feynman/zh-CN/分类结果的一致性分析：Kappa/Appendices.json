{
    "hands_on_practices": [
        {
            "introduction": "掌握一个统计量最好的方法之一就是亲自推导其公式。这个练习将引导你从代数层面剖析$\\kappa$系数的结构。通过将其变形，你将更深刻地理解$\\kappa$是如何量化“超出机遇的一致性”的，即它衡量的是与机遇导致的预期不一致相比，实际观察到的不一致性减少了多少。",
            "id": "4892815",
            "problem": "两名独立的临床医生，记作评估者 $A$ 和评估者 $B$，在一项大型研究中将每位受试者分入两个名义类别之一，标记为 $1$ 和 $2$。设 $p_{ij}$ 表示评估者 $A$ 将受试者分入类别 $i \\in \\{1,2\\}$ 且评估者 $B$ 将其分入类别 $j \\in \\{1,2\\}$ 的联合概率，满足 $p_{11}+p_{12}+p_{21}+p_{22}=1$。定义评估者 $A$ 的边际概率为 $p_{i\\cdot}=p_{i1}+p_{i2}$，评估者 $B$ 的边际概率为 $p_{\\cdot j}=p_{1j}+p_{2j}$。观测一致性比例 $p_{o}$ 是两位评估者意见一致的概率，而期望一致性比例 $p_{e}$ 是在假设两位评估者独立分类且保持各自边际分布不变的情况下意见一致的概率。\n\n仅从这些定义和概率法则出发，首先在 $2\\times 2$ 的情况下，用联合概率和边际概率推导 $p_{o}$ 和 $p_{e}$ 的表达式。然后，使用 Cohen's kappa 作为机遇校正后一致性的定义，对 kappa 系数 $\\kappa$ 的表达式进行代数简化，以明确其如何依赖于总的非对角线不一致性 $p_{12}+p_{21}$。将您对 $\\kappa$ 的最终答案表示为一个以 $p_{12}+p_{21}$、$p_{1\\cdot}$ 和 $p_{\\cdot 1}$ 表示的单一封闭形式符号表达式。无需四舍五入，也不涉及单位。",
            "solution": "该设定涉及两位评估者对两个类别进行分类，其联合概率为 $p_{ij}$，相应的边际概率为 $p_{i\\cdot}$ 和 $p_{\\cdot j}$。根据全概率法则，一致的概率是对角线上联合概率之和。因此，观测一致性比例为\n$$\np_{o} = \\Pr(\\text{agree}) = \\Pr(\\text{both }1) + \\Pr(\\text{both }2) = p_{11} + p_{22}.\n$$\n在评估者之间相互独立且保持其边际分布不变的假设下，期望一致性是各类别对应边际概率乘积之和。具体来说，\n$$\np_{e} = \\Pr(\\text{agree under independence}) = p_{1\\cdot} p_{\\cdot 1} + p_{2\\cdot} p_{\\cdot 2}.\n$$\n这些是在 $2\\times 2$ 情况下观测一致性和期望一致性的典型表达式。\n\nCohen's kappa $\\kappa$ 定义为不一致性相对于机遇预期的不一致性的比例减少量：\n$$\n\\kappa = \\frac{p_{o} - p_{e}}{1 - p_{e}}.\n$$\n为了揭示其对非对角线不一致性的依赖关系，注意总概率满足\n$$\np_{11} + p_{12} + p_{21} + p_{22} = 1,\n$$\n这意味着\n$$\np_{o} = p_{11} + p_{22} = 1 - (p_{12} + p_{21}).\n$$\n将 $p_{o} = 1 - (p_{12} + p_{21})$ 代入 $\\kappa$ 的定义中得到\n$$\n\\kappa = \\frac{1 - (p_{12} + p_{21}) - p_{e}}{1 - p_{e}} = 1 - \\frac{p_{12} + p_{21}}{1 - p_{e}}.\n$$\n这种形式已经表明，$\\kappa$ 随着非对角线不一致性 $p_{12}+p_{21}$ 线性减少，其缩放因子为 $1 - p_{e}$，该因子编码了基于边际分布的机遇一致性。为了将分母完全用边际概率 $p_{1\\cdot}$ 和 $p_{\\cdot 1}$ 表示，观察到\n$$\np_{2\\cdot} = 1 - p_{1\\cdot}, \\quad p_{\\cdot 2} = 1 - p_{\\cdot 1},\n$$\n所以\n$$\np_{e} = p_{1\\cdot} p_{\\cdot 1} + (1 - p_{1\\cdot})(1 - p_{\\cdot 1}) = p_{1\\cdot} p_{\\cdot 1} + 1 - p_{1\\cdot} - p_{\\cdot 1} + p_{1\\cdot} p_{\\cdot 1} = 1 - p_{1\\cdot} - p_{\\cdot 1} + 2 p_{1\\cdot} p_{\\cdot 1}.\n$$\n因此，\n$$\n1 - p_{e} = p_{1\\cdot} + p_{\\cdot 1} - 2 p_{1\\cdot} p_{\\cdot 1}.\n$$\n将此代入简化的 $\\kappa$ 表达式中，得到 $\\kappa$ 对非对角线不一致性和边际概率的完全显式依赖关系：\n$$\n\\kappa = 1 - \\frac{p_{12} + p_{21}}{p_{1\\cdot} + p_{\\cdot 1} - 2 p_{1\\cdot} p_{\\cdot 1}}.\n$$\n这个最终形式表明，$\\kappa$ 等于 1 减去观测到的不一致性 $p_{12}+p_{21}$ 与在给定边际分布下独立分类所期望的不一致性之比。",
            "answer": "$$\\boxed{1 - \\frac{p_{12}+p_{21}}{p_{1\\cdot}+p_{\\cdot 1}-2\\,p_{1\\cdot}\\,p_{1\\cdot}}}$$"
        },
        {
            "introduction": "$\\kappa$系数虽然强大，但在某些情况下会产生与直觉相悖的结果，尤其是在数据分布不均衡时。这些所谓的“$\\kappa$悖论”是理解该指标局限性的关键。本练习通过几个精心设计的极端案例，探讨了当观察到的一致性很高时，$\\kappa$值为何可能为零或无定义，从而帮助你学会如何批判性地解读和报告结果。",
            "id": "4892729",
            "problem": "两名独立的临床评估者将每位受试者分类到名义类别中。通过使用机会校正一致性系数来评估超出偶然性的一致性，该系数将观察到的一致性比例与在给定评估者经验边际分布的情况下独立性假设下预期的一致性进行比较。考虑一个二元分类，类别为“无”和“有”，以及三个假设的研究，每个研究有 $N=50$ 名受试者：\n\n研究 $S1$：\n- 评估者 A 对所有 $50$ 名受试者均评为“无”。\n- 评估者 B 对所有 $50$ 名受试者均评为“无”。\n- 交叉分类计数：“无/无” $=50$，所有其他单元格 $=0$。\n\n研究 $S2$：\n- 评估者 A 对所有 $50$ 名受试者均评为“无”。\n- 评估者 B 对 $40$ 名受试者评为“无”，对 $10$ 名受试者评为“有”。\n- 交叉分类计数：“无/无” $=40$，“无/有” $=10$，所有其他单元格 $=0$。\n\n研究 $S3$：\n- 评估者 A 的分类：对 $35$ 名受试者评为“无”，对 $15$ 名受试者评为“有”。\n- 评估者 B 在每位受试者上的分类与 A 完全匹配。\n- 交叉分类计数：“无/无” $=35$，“有/有” $=15$，所有其他单元格 $=0$。\n\n仅使用以下基本定义：(i) 观察到的一致性是评估者分类匹配的受试者比例，以及 (ii) “偶然”预期的一致性是根据经验边际类别比例在独立性假设下计算的，请确定以下哪些陈述是正确的。选择所有适用的选项。\n\nA. 在 $S1$ 中，机会一致性等于 $1$，导致一致性系数无定义；一个有原则的报告规则是避免强行给出一个数值系数，报告观察到的一致性和退化的边际分布，并指出由于没有变异，超出机会的一致性是不可估计的。\n\nB. 在 $S2$ 中，只要有一位评估者只使用一个类别，一致性系数就无定义；一个标准的决策规则是按惯例将该系数设为 $0$。\n\nC. 在 $S3$ 中，完美的观察一致性并不会使系数无定义，因为当边际分布非退化时，机会一致性严格小于 $1$；此处系数是良定义的，并等于其最大值。\n\nD. 在任何两位评估者总是意见不一致的二元研究中（例如，一位总是评为“有”，另一位总是评为“无”），系数是无定义的，因为观察到的一致性和机会一致性都等于 $0$；因此无法量化一致性。\n\nE. 当系数因机会一致性等于 $1$ 而无定义时（例如，两位评估者总是选择同一个单一类别），一个合理的决策规则是报告观察到的一致性和边际分布，并可选择性地补充特定类别的一致性（例如，阳性和阴性特定一致性）以及替代指标，如患病率调整和偏倚调整的 kappa (PABAK) 或 Gwet 的一致性系数 (AC1)，作为敏感性分析，而不是强行给出一个 kappa 值。",
            "solution": "问题要求我们评估关于机会校正一致性系数的五个陈述，该系数被定义为 Cohen's kappa 系数 ($\\kappa$)。该系数由以下公式给出：\n$$\n\\kappa = \\frac{p_o - p_e}{1 - p_e}\n$$\n其中 $p_o$ 是观察到的一致性比例，而 $p_e$ 是在两位评估者之间独立的假设下预期的一致性比例。当分母为零时，该系数无定义，这种情况当且仅当 $p_e = 1$ 时发生。\n\n让我们将二元分类的数据表示为一个 $2 \\times 2$ 的列联表，总共有 $N$ 名受试者：\n\n| | 评估者 B：无 | 评估者 B：有 | 行合计 |\n| :--- | :---: | :---: | :---: |\n| **评估者 A：无** | $a$ | $b$ | $r_1 = a+b$ |\n| **评估者 A：有**| $c$ | $d$ | $r_2 = c+d$ |\n| **列合计** | $c_1 = a+c$ | $c_2 = b+d$ | $N = a+b+c+d$ |\n\n根据问题的定义：\n(i) 观察到的一致性比例是对角线元素之和除以总受试者数：\n$$\np_o = \\frac{a+d}{N}\n$$\n(ii) 偶然预期的一致性比例是根据边际比例计算的。评估者 A 选择“无”的概率是 $P(\\text{A=无}) = (a+b)/N$，对于评估者 B 则是 $P(\\text{B=无}) = (a+c)/N$。两人都选择“有”的概率涉及边际比例 $(c+d)/N$ 和 $(b+d)/N$。在独立性假设下，预期的一致性为：\n$$\np_e = P(\\text{A=无})P(\\text{B=无}) + P(\\text{A=有})P(\\text{B=有}) = \\frac{(a+b)(a+c)}{N^2} + \\frac{(c+d)(b+d)}{N^2}\n$$\n\n现在我们分析每个研究。\n\n**研究 S1：**\n交叉分类为 $a=50, b=0, c=0, d=0$，其中 $N=50$。\n- 观察到的一致性：$p_o = \\frac{50+0}{50} = 1$。\n- 边际总计：$r_1=50, r_2=0, c_1=50, c_2=0$。\n- 边际比例：$P(\\text{A=无}) = 50/50 = 1$，$P(\\text{A=有}) = 0/50 = 0$。类似地，$P(\\text{B=无}) = 1$，$P(\\text{B=有}) = 0$。\n- 预期的一致性：$p_e = (1)(1) + (0)(0) = 1$。\n- Kappa 系数：$\\kappa = \\frac{p_o - p_e}{1 - p_e} = \\frac{1 - 1}{1 - 1} = \\frac{0}{0}$。该系数在数学上是不确定的（无定义）。\n\n**研究 S2：**\n交叉分类为 $a=40, b=10, c=0, d=0$，其中 $N=50$。\n- 观察到的一致性：$p_o = \\frac{40+0}{50} = 0.8$。\n- 边际总计：$r_1=50, r_2=0, c_1=40, c_2=10$。\n- 边际比例：$P(\\text{A=无}) = 50/50 = 1$，$P(\\text{A=有}) = 0/50 = 0$。对于评估者 B，$P(\\text{B=无}) = 40/50 = 0.8$，$P(\\text{B=有}) = 10/50 = 0.2$。\n- 预期的一致性：$p_e = (1)(0.8) + (0)(0.2) = 0.8$。\n- Kappa 系数：$\\kappa = \\frac{p_o - p_e}{1 - p_e} = \\frac{0.8 - 0.8}{1 - 0.8} = \\frac{0}{0.2} = 0$。该系数是良定义的，且等于 $0$。\n\n**研究 S3：**\n交叉分类为 $a=35, b=0, c=0, d=15$，其中 $N=50$。\n- 观察到的一致性：$p_o = \\frac{35+15}{50} = \\frac{50}{50} = 1$。\n- 边际总计：$r_1=35, r_2=15, c_1=35, c_2=15$。\n- 边际比例：$P(\\text{A=无}) = 35/50 = 0.7$，$P(\\text{A=有}) = 15/50 = 0.3$。评估者 B 的边际比例相同。\n- 预期的一致性：$p_e = (0.7)(0.7) + (0.3)(0.3) = 0.49 + 0.09 = 0.58$。\n- Kappa 系数：$\\kappa = \\frac{p_o - p_e}{1 - p_e} = \\frac{1 - 0.58}{1 - 0.58} = 1$。该系数是良定义的，且等于其最大值 $1$。\n\n通过这些计算，我们评估每个陈述。\n\n**A. 在 $S1$ 中，机会一致性等于 $1$，导致一致性系数无定义；一个有原则的报告规则是避免强行给出一个数值系数，报告观察到的一致性和退化的边际分布，并指出由于没有变异，超出机会的一致性是不可估计的。**\n我们对 S1 的分析表明 $p_e = 1$ 且 $\\kappa$ 是无定义的 ($0/0$)。当任一评估者的评分没有变异性时（两位评估者都只使用一个类别），这是一个众所周知的问题。在这种情况下，“机会”一致性的概念是退化的，因为机会只能导致单一的观察结果。最科学严谨的方法是如实描述数据：完美的观察一致性 ($p_o=1$)，但边际分布是退化的，这使得像 kappa 这样的机会校正度量无法估计。该陈述准确地描述了数学结果和正确的统计报告实践。\n结论：**正确**。\n\n**B. 在 $S2$ 中，只要有一位评估者只使用一个类别，一致性系数就无定义；一个标准的决策规则是按惯例将该系数设为 $0$。**\n我们对 S2 的分析表明 $\\kappa$ 是良定义的，其值为 $0$。该系数无定义的前提是错误的。评估者 A 只使用一个类别，这导致了一个“悖论性”的结果，即高观察一致性 ($p_o=0.8$) 产生了一个为 $0$ 的 kappa 值，但这并不会使该系数无定义。$\\kappa$ 的表达式是 $\\frac{0}{0.2}$，这明确地等于 $0$。该值不是按惯例设为 $0$；而是计算得出为 $0$。\n结论：**不正确**。\n\n**C. 在 $S3$ 中，完美的观察一致性并不会使系数无定义，因为当边际分布非退化时，机会一致性严格小于 $1$；此处系数是良定义的，并等于其最大值。**\n我们对 S3 的分析证实了该陈述的所有部分。观察到的一致性是完美的 ($p_o=1$)。边际分布是非退化的（评估者同时使用了“无”和“有”两个类别），导致 $p_e=0.58$，该值严格小于 $1$。因此，分母 $1-p_e$ 非零 ($0.42$)，$\\kappa$ 是良定义的。其值为 $\\kappa = \\frac{1-0.58}{1-0.58} = 1$，这是 kappa 可能的最大值，表明在排除偶然性之后，一致性是完美的。\n结论：**正确**。\n\n**D. 在任何两位评估者总是意见不一致的二元研究中（例如，一位总是评为“有”，另一位总是评为“无”），系数是无定义的，因为观察到的一致性和机会一致性都等于 $0$；因此无法量化一致性。**\n让我们分析给出的例子：评估者 A 总是说“无”，评估者 B 总是说“有”。表格中有 $a=0, d=0$ 以及非零的非对角线单元格。假设对于 $N$ 个受试者，$b=N, c=0$。\n- 观察到的一致性：$p_o = \\frac{0+0}{N} = 0$。\n- 边际比例：$P(\\text{A=无}) = N/N = 1$，$P(\\text{A=有}) = 0$。$P(\\text{B=无}) = 0$，$P(\\text{B=有}) = N/N = 1$。\n- 预期的一致性：$p_e = (1)(0) + (0)(1) = 0$。\n- Kappa 系数：$\\kappa = \\frac{p_o - p_e}{1 - p_e} = \\frac{0 - 0}{1 - 0} = 0$。\n该系数不是无定义的；它等于 $0$。该陈述声称因为 $p_o=0$ 和 $p_e=0$ 所以系数无定义，这在数学上是错误的。无定义的条件是 $p_e=1$。在完全不一致 ($p_o=0$) 的一般情况下，$\\kappa = \\frac{-p_e}{1-p_e}$，这通常是一个有定义的负数。它永远不会是无定义的，因为 $p_o=0$ 意味着对于任何非平凡的研究，$p_e  1$。\n结论：**不正确**。\n\n**E. 当系数因机会一致性等于 $1$ 而无定义时（例如，两位评估者总是选择同一个单一类别），一个合理的决策规则是报告观察到的一致性和边际分布，并可选择性地补充特定类别的一致性（例如，阳性和阴性特定一致性）以及替代指标，如患病率调整和偏倚调整的 kappa (PABAK) 或 Gwet 的一致性系数 (AC1)，作为敏感性分析，而不是强行给出一个 kappa 值。**\n该陈述讨论了 S1 中 $\\kappa$ 无定义的情景。它提出了一种报告策略。报告观察到的一致性 ($p_o=1$) 和退化的边际分布是主要的正确做法，正如 A 中所述。建议用其他度量来补充这一点，反映了现代统计学的最佳实践。像 PABAK 和 Gwet 的 AC1 这样的指标是专门为处理 kappa 的“悖论”而设计的，包括其无定义的情况。对于 S1，PABAK 将是 $2p_o - 1 = 2(1)-1=1$，Gwet 的 AC1 也将是 $1$。这些度量提供了一个反映完美一致性的确定值，这通常比报告一个无定义的 kappa 更具解释性。这种全面的报告策略确实是一个合理且值得推荐的规则。\n结论：**正确**。\n\n总而言之，陈述 A、C 和 E 是正确的。",
            "answer": "$$\\boxed{ACE}$$"
        },
        {
            "introduction": "在真实世界的研究中，数据常常来自不同的亚组或分层（例如不同的医院或患者群体）。直接汇总所有数据进行分析可能会掩盖重要的层间差异。本练习模拟了一个包含三个临床分层的真实场景，指导你计算分层$\\kappa$，并比较两种不同的合并策略：先合并数据再计算总$\\kappa$，与先计算各层$\\kappa$再求加权平均。这个对比揭示了处理分层数据时的一个重要决策点。",
            "id": "4892755",
            "problem": "两名独立的人类评估者对从三个层（门诊 ($s=1$)、住院病房 ($s=2$) 和急诊科 ($s=3$)）中抽取的患者的一项二元临床结果（是/否）进行分类。在每个层内，评估者1（行）和评估者2（列）之间的交叉分类被记录为一个 $2 \\times 2$ 的计数列联表。记录的计数如下：\n\n第 $1$ 层（门诊，总数 $n_1 = 50$）：\n- $(\\text{评估者 }1=\\text{是}, \\text{评估者 }2=\\text{是}) = 30$\n- $(\\text{评估者 }1=\\text{是}, \\text{评估者 }2=\\text{否}) = 5$\n- $(\\text{评估者 }1=\\text{否}, \\text{评估者 }2=\\text{是}) = 10$\n- $(\\text{评估者 }1=\\text{否}, \\text{评估者 }2=\\text{否}) = 5$\n\n第 $2$ 层（住院病房，总数 $n_2 = 40$）：\n- $(\\text{评估者 }1=\\text{是}, \\text{评估者 }2=\\text{是}) = 18$\n- $(\\text{评估者 }1=\\text{是}, \\text{评估者 }2=\\text{否}) = 6$\n- $(\\text{评估者 }1=\\text{否}, \\text{评估者 }2=\\text{是}) = 4$\n- $(\\text{评估者 }1=\\text{否}, \\text{评估者 }2=\\text{否}) = 12$\n\n第 $3$ 层（急诊科，总数 $n_3 = 30$）：\n- $(\\text{评估者 }1=\\text{是}, \\text{评估者 }2=\\text{是}) = 8$\n- $(\\text{评估者 }1=\\text{是}, \\text{评估者 }2=\\text{否}) = 7$\n- $(\\text{评估者 }1=\\text{否}, \\text{评估者 }2=\\text{是}) = 3$\n- $(\\text{评估者 }1=\\text{否}, \\text{评估者 }2=\\text{否}) = 12$\n\n您计划使用基于数组的、跨层的向量化操作（例如，构建对角线和与边际总数的数组，并应用元素级算术）来计算特定于层和合并的科恩卡帕系数（$\\kappa$），并通过对合成表的单元测试来验证实现。请考虑以下关于结果和测试的候选陈述：\n\n- 通过对各层的单元格计数求和得到的聚合 $2 \\times 2$ 表计算出的合并 $\\kappa$ 约等于 $0.386$（四舍五入到三位小数）。\n- 使用层的总数 $(n_s)$ 作为权重，特定于层的 $\\kappa$ 值的加权平均值约等于 $0.334$，并且在这些数据中，不等于合并的 $\\kappa$。\n- 对一个具有完全一致性（所有计数都在对角线上，非对角线元素等于 $0$）的合成 $2 \\times 2$ 表进行的单元测试应该返回 $\\kappa = 1$。\n- 对一个为反映独立性（行和列的边际比例相等，且观察到的单元格比例等于边际比例的乘积）而构建的合成 $2 \\times 2$ 表进行的单元测试应该返回 $\\kappa=0$。\n- 一个正确编写的、从边际值计算每层观察一致性和期望一致性然后进行聚合的向量化实现，其在这些整数表上的结果应与等效的基于循环的实现的结果在机器精度上相匹配。\n\n哪个选项报告了数值结果和单元测试预期的正确组合？\n\nA. 以上五个陈述都正确。\n\nB. 合并的 $\\kappa$ 约等于 $0.334$，加权平均值约等于 $0.386$，完全一致性产生 $\\kappa = 0.95$，独立性产生 $\\kappa = 0$，并且向量化和基于循环的实现相匹配。\n\nC. 合并的 $\\kappa$ 约等于 $0.386$，加权平均值在三位小数上等于合并值，完全一致性产生 $\\kappa = 1$，独立性产生 $\\kappa = 0.5$，并且向量化和基于循环的实现相匹配。\n\nD. 合并的 $\\kappa$ 约等于 $0.334$，加权平均值约等于 $0.334$，完全一致性产生 $\\kappa = 1$，独立性产生 $\\kappa = 0$，并且向量化和基于循环的实现不匹配。",
            "solution": "对于总计数为 $n = a+b+c+d$ 的 $2 \\times 2$ 表 $\\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$，科恩卡帕系数（$\\kappa$）的公式是：\n$$ \\kappa = \\frac{p_o - p_e}{1 - p_e} $$\n其中观察到的一致性为 $p_o = \\frac{a+d}{n}$，偶然期望的一致性为 $p_e = \\frac{(a+b)(a+c) + (c+d)(b+d)}{n^2}$。\n\n我们现在将评估问题描述中的五个陈述中的每一个。\n\n**对陈述1的评估：** “通过对各层的单元格计数求和得到的聚合 $2 \\times 2$ 表计算出的合并 $\\kappa$ 约等于 $0.386$（四舍五入到三位小数）。”\n\n首先，我们通过将 $C_1, C_2, C_3$ 的单元格计数相加来创建聚合表 $C_{agg}$：\n$$ C_{agg} = C_1+C_2+C_3 = \\begin{pmatrix} 30  5 \\\\ 10  5 \\end{pmatrix} + \\begin{pmatrix} 18  6 \\\\ 4  12 \\end{pmatrix} + \\begin{pmatrix} 8  7 \\\\ 3  12 \\end{pmatrix} = \\begin{pmatrix} 30+18+8  5+6+7 \\\\ 10+4+3  5+12+12 \\end{pmatrix} = \\begin{pmatrix} 56  18 \\\\ 17  29 \\end{pmatrix} $$\n聚合表的总计数为 $n_{agg} = n_1+n_2+n_3 = 50+40+30 = 120$。检查 $C_{agg}$ 中单元格的总和：$56+18+17+29 = 120$。\n\n现在，我们计算这个聚合表的 $\\kappa$。\n- 观察到的一致性，$p_o$：\n$$ p_o = \\frac{\\text{对角线元素之和}}{n_{agg}} = \\frac{56+29}{120} = \\frac{85}{120} \\approx 0.70833 $$\n- 期望的一致性，$p_e$：\n边际总数是：\n行1总计（评估者1“是”）：$56+18 = 74$\n行2总计（评估者1“否”）：$17+29 = 46$\n列1总计（评估者2“是”）：$56+17 = 73$\n列2总计（评估者2“否”）：$18+29 = 47$\n$$ p_e = \\frac{(74)(73) + (46)(47)}{120^2} = \\frac{5402 + 2162}{14400} = \\frac{7564}{14400} \\approx 0.52528 $$\n- 合并的卡帕系数，$\\kappa_{pooled}$：\n$$ \\kappa_{pooled} = \\frac{p_o - p_e}{1 - p_e} = \\frac{0.70833 - 0.52528}{1 - 0.52528} = \\frac{0.18305}{0.47472} \\approx 0.38559 $$\n四舍五入到三位小数得到 $0.386$。\n**对陈述1的结论：正确。**\n\n**对陈述2的评估：** “使用层的总数 $(n_s)$ 作为权重，特定于层的 $\\kappa$ 值的加权平均值约等于 $0.334$，并且在这些数据中，不等于合并的 $\\kappa$。”\n\n我们必须首先计算每个层 $s \\in \\{1, 2, 3\\}$ 的 $\\kappa_s$。\n\n- **第1层 ($n_1=50$):** $C_1 = \\begin{pmatrix} 30  5 \\\\ 10  5 \\end{pmatrix}$。\n  $p_{o,1} = \\frac{30+5}{50} = 0.7$。边际：行 $(35, 15)$，列 $(40, 10)$。\n  $p_{e,1} = \\frac{(35)(40) + (15)(10)}{50^2} = \\frac{1400+150}{2500} = 0.62$。\n  $\\kappa_1 = \\frac{0.7 - 0.62}{1 - 0.62} = \\frac{0.08}{0.38} \\approx 0.2105$。\n\n- **第2层 ($n_2=40$):** $C_2 = \\begin{pmatrix} 18  6 \\\\ 4  12 \\end{pmatrix}$。\n  $p_{o,2} = \\frac{18+12}{40} = 0.75$。边际：行 $(24, 16)$，列 $(22, 18)$。\n  $p_{e,2} = \\frac{(24)(22) + (16)(18)}{40^2} = \\frac{528+288}{1600} = 0.51$。\n  $\\kappa_2 = \\frac{0.75 - 0.51}{1 - 0.51} = \\frac{0.24}{0.49} \\approx 0.4898$。\n\n- **第3层 ($n_3=30$):** $C_3 = \\begin{pmatrix} 8  7 \\\\ 3  12 \\end{pmatrix}$。\n  $p_{o,3} = \\frac{8+12}{30} = \\frac{2}{3} \\approx 0.6667$。边际：行 $(15, 15)$，列 $(11, 19)$。\n  $p_{e,3} = \\frac{(15)(11) + (15)(19)}{30^2} = \\frac{165+285}{900} = 0.5$。\n  $\\kappa_3 = \\frac{2/3 - 0.5}{1 - 0.5} = \\frac{1/6}{1/2} = \\frac{1}{3} \\approx 0.3333$。\n\n现在，我们计算加权平均值 $\\kappa_{w-avg}$：\n$$ \\kappa_{w-avg} = \\frac{\\sum n_s \\kappa_s}{\\sum n_s} = \\frac{50(0.2105) + 40(0.4898) + 30(1/3)}{120} $$\n$$ \\kappa_{w-avg} = \\frac{10.525 + 19.592 + 10}{120} = \\frac{40.117}{120} \\approx 0.3343 $$\n四舍五入到三位小数得到 $0.334$。\n该陈述还声称这个值不等于合并的 $\\kappa$。我们发现 $\\kappa_{pooled} \\approx 0.386$ 而 $\\kappa_{w-avg} \\approx 0.334$。显然，$0.334 \\neq 0.386$。这种不等式是一个已知的统计现象，因为卡帕统计量不是一个可合并的度量。\n**对陈述2的结论：正确。**\n\n**对陈述3的评估：** “对一个具有完全一致性（所有计数都在对角线上，非对角线元素等于 $0$）的合成 $2 \\times 2$ 表进行的单元测试应该返回 $\\kappa = 1$。”\n\n一个具有完全一致性的表其非对角线单元格等于 $0$：$b=0, c=0$。\n该表为 $\\begin{pmatrix} a  0 \\\\ 0  d \\end{pmatrix}$，总数为 $n=a+d$。\n观察到的一致性为 $p_o = \\frac{a+d}{n} = 1$。\n期望的一致性为 $p_e = \\frac{(a+0)(a+0) + (0+d)(0+d)}{(a+d)^2} = \\frac{a^2+d^2}{(a+d)^2}$。\n卡帕系数为 $\\kappa = \\frac{p_o - p_e}{1 - p_e} = \\frac{1 - p_e}{1 - p_e}$。\n只要分母不为零，即 $p_e \\neq 1$，这个表达式就等于 $1$。只有当 $a=0$ 或 $d=0$ 时，$p_e=1$，这意味着所有评级都落入单个类别中（例如，所有评估者对所有受试者都说“是”）。在这种退化情况下，$\\kappa$ 是未定义的。一个合适的单元测试将使用非退化情况（例如，$a>0$ 且 $d>0$），此时 $\\kappa$ 毫无疑问地等于 $1$。\n**对陈述3的结论：正确。**\n\n**对陈述4的评估：** “对一个为反映独立性（行和列的边际比例相等，且观察到的单元格比例等于边际比例的乘积）而构建的合成 $2 \\times 2$ 表进行的单元测试应该返回 $\\kappa=0$。”\n\n根据定义，科恩卡帕系数衡量的是超出偶然预期的一致性。偶然期望的一致性 $p_e$ 是在评估者判断之间统计独立的假设下计算的。如果观察到的一致性 $p_o$ 恰好等于偶然期望的一致性，即 $p_o = p_e$，那么卡帕公式的分子就变为 $p_o - p_e = 0$。\n$$ \\kappa = \\frac{0}{1 - p_e} = 0 $$\n只要 $p_e \\neq 1$，这就成立。一个反映独立性的表正是观察到的一致性等于偶然一致性的情况。\n**对陈述4的结论：正确。**\n\n**对陈述5的评估：** “一个正确编写的、从边际值计算每层观察一致性和期望一致性然后进行聚合的向量化实现，其在这些整数表上的结果应与等效的基于循环的实现的结果在机器精度上相匹配。”\n\n这个陈述涉及计算方法。向量化实现一次性对整个数组执行操作（例如，`po = (a_counts + d_counts) / n_counts`）。基于循环的实现则遍历每个层，执行标量计算。对于计算卡帕系数所需的算术运算（加法、乘法、除法），两种方法中对每个层的数据执行的浮点运算序列是相同的。由于输入是精确的整数，且操作序列相同，因此两个正确编写的程序（一个向量化，一个使用循环）将产生逐位相同的浮点结果。不存在数值差异的来源。\n**对陈述5的结论：正确。**\n\n### 逐项选项分析\n\n基于对五个陈述的评估，所有陈述都是正确的。我们现在可以评估给出的选项。\n\n- **A. 以上五个陈述都正确。**\n这与我们的详细分析完全一致。\n\n- **B. 合并的 $\\kappa$ 约等于 $0.334$，加权平均值约等于 $0.386$，完全一致性产生 $\\kappa = 0.95$，独立性产生 $\\kappa = 0$，并且向量化和基于循环的实现相匹配。**\n该选项错误地交换了合并卡帕和加权平均卡帕的值。它还错误地陈述了完全一致性产生 $\\kappa = 0.95$。因此，它是不正确的。\n\n- **C. 合并的 $\\kappa$ 约等于 $0.386$，加权平均值在三位小数上等于合并值，完全一致性产生 $\\kappa = 1$，独立性产生 $\\kappa = 0.5$，并且向量化和基于循环的实现相匹配。**\n该选项错误地声称加权平均值等于合并值，并错误地陈述了独立性产生 $\\kappa = 0.5$。因此，它是不正确的。\n\n- **D. 合并的 $\\kappa$ 约等于 $0.334$，加权平均值约等于 $0.334$，完全一致性产生 $\\kappa = 1$，独立性产生 $\\kappa = 0$，并且向量化和基于循环的实现不匹配。**\n该选项错误地陈述了合并卡帕的值，并错误地声称向量化和基于循环的实现不匹配。因此，它是不正确的。\n\n唯一与推导出的结果和理论原则完全一致的选项是 A。\n所有五个陈述都是正确的。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}