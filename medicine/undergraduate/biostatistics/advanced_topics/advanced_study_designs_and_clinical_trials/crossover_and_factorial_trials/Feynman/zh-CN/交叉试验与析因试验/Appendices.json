{
    "hands_on_practices": [
        {
            "introduction": "在任何临床试验的设计阶段，确定所需的样本量都是一个至关重要的步骤。本练习将指导您完成一个典型的生物等效性交叉试验的样本量计算过程。通过从基本原理出发，您将学习如何将原始数据尺度上的变异性（通过受试者内变异系数 $CV_{w}$ 体现）与对数转换后数据的方差联系起来，并最终推导出在给定统计功效和显著性水平下所需的样本量 。",
            "id": "4907228",
            "problem": "一项药代动力学生物等效性研究计划采用平衡的 $2 \\times 2$ 随机交叉试验设计，以比较两种治疗方法 $A$ 和 $B$。对于每位受试者 $i$，令 $X_{iA}$ 和 $X_{iB}$ 表示曲线下面积 (AUC)，令 $Y_{iA} = \\ln(X_{iA})$ 和 $Y_{iB} = \\ln(X_{iB})$ 表示 AUC 的自然对数。假设以下科学上标准的模型和设计特征：\n- 在每位受试者内部，一个周期内对数转换后的 AUC 为 $Y \\sim \\mathcal{N}(\\mu, s_{w}^{2})$，其中受试者内方差 $s_{w}^{2}$ 对两种治疗方法和各个周期均相同，且周期特定误差在各周期之间是独立的。\n- 在原始 AUC 尺度上，受试者内变异系数 (CV) 定义为 $CV_{w} = \\frac{\\sqrt{\\operatorname{Var}(X)}}{\\operatorname{E}(X)}$，其中 $X$ 表示一个周期内的 AUC。\n- $n$ 名受试者的对数 AUC 样本均值差为 $\\bar{D} = \\frac{1}{n}\\sum_{i=1}^{n}\\left(Y_{iA} - Y_{iB}\\right)$，推断将基于 $\\bar{D}$ 的大样本正态近似。\n\n仅使用均值、方差和变异系数的基本定义，以及经过充分检验的对数正态分布的矩公式，执行以下操作：\n\n1. 推导一个连接 $CV_{w}$ 与 $s_{w}^{2}$ 的表达式，然后根据所述假设，用 $CV_{w}$ 和 $n$ 表示样本均值差 $\\bar{D}$ 的标准误。\n\n2. 假设设计目标是双侧 I 型错误率 $\\alpha = 0.05$，以及在对数尺度上的真实均值差为 $\\delta = 0.15$ 时，把握度为 $1-\\beta = 0.90$。使用基于 $\\bar{D}$ 的 $z$-检验，推导出所需总样本量 $n$ 的闭合形式表达式，用 $CV_{w}$、$\\alpha$、$\\beta$ 和 $\\delta$ 表示。对于分位数，使用 $z_{q} = \\Phi^{-1}(q)$，其中 $\\Phi$ 是标准正态分布的累积分布函数。\n\n对于第2部分的计算，取 $CV_{w} = 0.30$，$\\alpha = 0.05$，$1-\\beta = 0.90$，以及 $\\delta = 0.15$。将您的最终答案表示为 $n$ 的单一闭合形式解析表达式。最终答案中不需要也不允许进行数值四舍五入。",
            "solution": "用户提供了一个生物统计学问题，必须首先验证其科学和逻辑上的合理性。\n\n### 步骤1：提取已知条件\n- **研究设计**：比较治疗方法 A 和 B 的平衡的 $2 \\times 2$ 随机交叉试验。\n- **变量**：$X_{iA}, X_{iB}$ 是受试者 $i$ 的 AUC。$Y_{iA} = \\ln(X_{iA})$, $Y_{iB} = \\ln(X_{iB})$。\n- **模型**：在受试者内部，一个周期内对数转换后的 AUC 为 $Y \\sim \\mathcal{N}(\\mu, s_{w}^{2})$。受试者内方差 $s_{w}^{2}$ 对治疗方法和周期均相同。周期特定误差在各周期之间是独立的。\n- **定义**：受试者内变异系数为 $CV_{w} = \\frac{\\sqrt{\\operatorname{Var}(X)}}{\\operatorname{E}(X)}$，其中 $X$ 是一个周期内的 AUC。\n- **估计量**：$\\bar{D} = \\frac{1}{n}\\sum_{i=1}^{n}\\left(Y_{iA} - Y_{iB}\\right)$。\n- **推断**：基于 $\\bar{D}$ 的大样本正态近似。\n- **任务1**：推导一个连接 $CV_{w}$ 与 $s_{w}^{2}$ 的表达式。用 $CV_{w}$ 和 $n$ 推导 $\\bar{D}$ 的标准误。\n- **任务2**：推导总样本量 $n$ 的闭合形式表达式。\n- **任务2的参数**：\n  - 双侧 I 型错误率：$\\alpha = 0.05$。\n  - 把握度：$1-\\beta = 0.90$。\n  - 对数尺度上的真实均值差：$\\delta = 0.15$。\n  - 检验：基于 $\\bar{D}$ 的 $z$-检验。\n  - 分位数符号：$z_{q} = \\Phi^{-1}(q)$，其中 $\\Phi$ 是标准正态累积分布函数。\n  - 给定值：$CV_{w} = 0.30$。\n- **最终答案要求**：$n$ 的单一闭合形式解析表达式，无数值四舍五入。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据。$2 \\times 2$ 交叉设计是生物等效性研究的标准且高效的设计。对药代动力学参数（如AUC）使用对数转换是常规做法，因为这些测量值通常呈右偏态，用对数正态分布能更好地近似。受试者内变异系数（$CV_w$）、对数转换数据的模型、标准误以及样本量计算框架的定义在生物统计学和临床试验方法学中都是基础和标准的。该问题表述清晰、客观、自洽，为获得唯一解提供了所有必要的参数和定义。给定的数值（$\\alpha$、$1-\\beta$、$\\delta$、$CV_w$）对于此类研究是符合实际的。不存在矛盾、歧义或违反科学原则的情况。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将开始求解过程。\n\n***\n\n### 第1部分：推导关系\n\n**$CV_{w}$ 与 $s_{w}^{2}$ 之间的关系**\n\n问题指出，对数转换后的 AUC，$Y = \\ln(X)$，服从方差为 $s_{w}^{2}$ 的正态分布，即 $Y \\sim \\mathcal{N}(\\mu, s_{w}^{2})$，其中均值为 $\\mu$。这意味着原始 AUC，$X = \\exp(Y)$，服从对数正态分布。由正态随机变量 $Y \\sim \\mathcal{N}(\\mu, \\sigma^2)$ 推导出的对数正态随机变量 $X$ 的矩由公认的公式给出。此处，$\\sigma^2$ 对应于 $s_{w}^{2}$。\n\n$X$ 的期望值为：\n$$ \\operatorname{E}(X) = \\exp\\left(\\mu + \\frac{1}{2}s_{w}^{2}\\right) $$\n$X$ 的方差为：\n$$ \\operatorname{Var}(X) = \\left[\\exp(s_{w}^{2}) - 1\\right] \\exp\\left(2\\mu + s_{w}^{2}\\right) = \\left[\\exp(s_{w}^{2}) - 1\\right] \\left[\\exp\\left(\\mu + \\frac{1}{2}s_{w}^{2}\\right)\\right]^2 = \\left[\\exp(s_{w}^{2}) - 1\\right] (\\operatorname{E}(X))^2 $$\n变异系数 $CV_{w}$ 定义为标准差与均值的比率。其平方为：\n$$ CV_{w}^{2} = \\frac{\\operatorname{Var}(X)}{(\\operatorname{E}(X))^2} $$\n代入对数正态分布的方差表达式：\n$$ CV_{w}^{2} = \\frac{\\left[\\exp(s_{w}^{2}) - 1\\right] (\\operatorname{E}(X))^2}{(\\operatorname{E}(X))^2} = \\exp(s_{w}^{2}) - 1 $$\n这提供了 $CV_{w}$ 和 $s_{w}^{2}$ 之间的直接联系。该方程可以重排以用 $CV_{w}$ 表示 $s_{w}^{2}$：\n$$ s_{w}^{2} = \\ln(CV_{w}^{2} + 1) $$\n\n**样本均值差 $\\bar{D}$ 的标准误**\n\n我们关注的估计量是 $\\bar{D} = \\frac{1}{n}\\sum_{i=1}^{n} D_i$，其中 $D_i = Y_{iA} - Y_{iB}$ 是受试者 $i$ 的受试者内对数 AUC 差值。假设受试者是独立的，样本均值 $\\bar{D}$ 的方差是：\n$$ \\operatorname{Var}(\\bar{D}) = \\operatorname{Var}\\left(\\frac{1}{n}\\sum_{i=1}^{n} D_i\\right) = \\frac{1}{n^2} \\sum_{i=1}^{n} \\operatorname{Var}(D_i) = \\frac{n \\operatorname{Var}(D_i)}{n^2} = \\frac{\\operatorname{Var}(D_i)}{n} $$\n现在我们必须确定 $\\operatorname{Var}(D_i)$。在交叉试验中，$Y_{iA}$ 和 $Y_{iB}$ 是对同一受试者 $i$ 的测量值。对受试者 $i$ 的观测值的标准模型是 $Y = \\mu_{\\text{treatment}} + \\text{受试者效应} + \\text{随机误差}$。随机误差来自一个方差为 $s_w^2$ 的分布。受试者效应对该受试者的两次测量是共同的。因此，$Y_{iA}$ 和 $Y_{iB}$ 是相关的。\n设 $s_i$ 是受试者 $i$ 的随机效应，其方差为 $\\operatorname{Var}(s_i) = s_b^2$（受试者间方差），并设 $e_{iA}$ 和 $e_{iB}$ 是独立的周期特定误差，其方差为 $\\operatorname{Var}(e_{iA}) = \\operatorname{Var}(e_{iB}) = s_w^2$（受试者内方差）。\n观测值可以建模为：\n$Y_{iA} = \\mu_A + s_i + e_{iA}$\n$Y_{iB} = \\mu_B + s_i + e_{iB}$\n同一受试者两次测量之间的协方差是 $\\operatorname{Cov}(Y_{iA}, Y_{iB}) = \\operatorname{Cov}(\\mu_A + s_i + e_{iA}, \\mu_B + s_i + e_{iB}) = \\operatorname{Var}(s_i) = s_b^2$，因为 $s_i$ 是唯一的共同随机项。单次观测的总方差是 $\\operatorname{Var}(Y_{iA}) = \\operatorname{Var}(Y_{iB}) = s_b^2 + s_w^2$。\n受试者内差值 $D_i$ 的方差是：\n$$ \\operatorname{Var}(D_i) = \\operatorname{Var}(Y_{iA} - Y_{iB}) = \\operatorname{Var}(Y_{iA}) + \\operatorname{Var}(Y_{iB}) - 2\\operatorname{Cov}(Y_{iA}, Y_{iB}) $$\n$$ \\operatorname{Var}(D_i) = (s_b^2 + s_w^2) + (s_b^2 + s_w^2) - 2(s_b^2) = 2s_w^2 $$\n受试者间方差 $s_b^2$ 被抵消了，这是交叉设计的主要优点。\n因此，$\\bar{D}$ 的方差是：\n$$ \\operatorname{Var}(\\bar{D}) = \\frac{2s_w^2}{n} $$\n$\\bar{D}$ 的标准误是其方差的平方根：\n$$ \\operatorname{SE}(\\bar{D}) = \\sqrt{\\frac{2s_w^2}{n}} $$\n代入用 $CV_w$ 表示的 $s_w^2$ 表达式：\n$$ \\operatorname{SE}(\\bar{D}) = \\sqrt{\\frac{2\\ln(CV_{w}^{2} + 1)}{n}} $$\n\n### 第2部分：样本量公式的推导\n\n均值差的假设检验如下：\n- 原假设 $H_0: \\mu_A - \\mu_B = 0$\n- 备择假设 $H_1: \\mu_A - \\mu_B \\neq 0$\n\n该检验是基于统计量 $Z = \\frac{\\bar{D}}{\\operatorname{SE}(\\bar{D})}$ 的双侧 $z$-检验。如果 $|Z| > z_{1-\\alpha/2}$，我们拒绝 $H_0$。\n把握度 $1-\\beta$ 是当真实差值为 $\\delta \\neq 0$ 时拒绝 $H_0$ 的概率。\n$$ 1-\\beta = P\\left(\\text{Reject } H_0 \\mid \\operatorname{E}(\\bar{D}) = \\delta\\right) = P\\left(\\left|\\frac{\\bar{D}}{\\operatorname{SE}(\\bar{D})}\\right| > z_{1-\\alpha/2} \\mid \\operatorname{E}(\\bar{D}) = \\delta\\right) $$\n不失一般性地假设 $\\delta > 0$，把握度主要由上侧拒绝域决定：\n$$ 1-\\beta \\approx P\\left(\\frac{\\bar{D}}{\\operatorname{SE}(\\bar{D})} > z_{1-\\alpha/2} \\mid \\operatorname{E}(\\bar{D}) = \\delta\\right) $$\n为了评估这个概率，我们在备择假设下对检验统计量进行标准化，此时 $\\bar{D} \\sim \\mathcal{N}(\\delta, \\operatorname{SE}(\\bar{D})^2)$：\n$$ \\frac{\\bar{D} - \\delta}{\\operatorname{SE}(\\bar{D})} \\sim \\mathcal{N}(0, 1) $$\n重写该概率：\n$$ 1-\\beta \\approx P\\left(\\bar{D} > z_{1-\\alpha/2} \\operatorname{SE}(\\bar{D})\\right) = P\\left(\\frac{\\bar{D}-\\delta}{\\operatorname{SE}(\\bar{D})} > z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})}\\right) $$\n令 $Z' \\sim \\mathcal{N}(0,1)$。则 $1-\\beta = P(Z' > z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})})$。\n用标准正态累积分布函数 $\\Phi$ 表示，即 $1-\\beta = 1 - \\Phi\\left(z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})}\\right)$。\n$$ \\beta = \\Phi\\left(z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})}\\right) $$\n应用逆正态累积分布函数 $\\Phi^{-1}$：\n$$ \\Phi^{-1}(\\beta) = z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})} $$\n使用符号 $z_q = \\Phi^{-1}(q)$ 和属性 $z_\\beta = -z_{1-\\beta}$：\n$$ z_\\beta = -z_{1-\\beta} = z_{1-\\alpha/2} - \\frac{\\delta}{\\operatorname{SE}(\\bar{D})} $$\n对于一般的 $\\delta$（使用 $|\\delta|$），整理得：\n$$ \\frac{|\\delta|}{\\operatorname{SE}(\\bar{D})} = z_{1-\\alpha/2} + z_{1-\\beta} $$\n两边平方并代入 $\\operatorname{SE}(\\bar{D})^2 = \\frac{2s_w^2}{n}$：\n$$ \\frac{\\delta^2}{2s_w^2/n} = (z_{1-\\alpha/2} + z_{1-\\beta})^2 $$\n$$ n \\frac{\\delta^2}{2s_w^2} = (z_{1-\\alpha/2} + z_{1-\\beta})^2 $$\n求解总样本量 $n$：\n$$ n = \\frac{2s_w^2 (z_{1-\\alpha/2} + z_{1-\\beta})^2}{\\delta^2} $$\n最后，我们代入 $s_w^2 = \\ln(1 + CV_w^2)$：\n$$ n = \\frac{2\\ln(1 + CV_w^2) (z_{1-\\alpha/2} + z_{1-\\beta})^2}{\\delta^2} $$\n问题要求最终答案为使用给定值的闭合形式解析表达式：$CV_w=0.30$，$\\alpha=0.05$，$1-\\beta=0.90$（所以 $\\beta=0.10$），以及 $\\delta=0.15$。我们也使用符号 $z_q = \\Phi^{-1}(q)$。\n分位数项为 $z_{1-\\alpha/2} = z_{1-0.05/2} = z_{0.975} = \\Phi^{-1}(0.975)$ 和 $z_{1-\\beta} = z_{1-0.10} = z_{0.90} = \\Phi^{-1}(0.90)$。\n将所有值代入 $n$ 的公式中：\n$$ n = \\frac{2\\ln(1 + (0.30)^2) (\\Phi^{-1}(0.975) + \\Phi^{-1}(0.90))^2}{(0.15)^2} $$\n这是所要求的最终解析表达式。",
            "answer": "$$ \\boxed{\\frac{2 \\ln(1 + (0.30)^2) (\\Phi^{-1}(0.975) + \\Phi^{-1}(0.90))^2}{(0.15)^2}} $$"
        },
        {
            "introduction": "析因试验因其能够在一个研究中同时评估多种干预措施及其相互作用而备受青睐，体现了卓越的效率。本练习聚焦于 $2 \\times 2$ 析因设计的核心，要求您推导检测交互作用所需的样本量。通过这个过程，您将深入理解在平衡设计下，估计主效应和交互作用的统计功效关系，从而揭示析因设计的内在优势 。",
            "id": "4907254",
            "problem": "一个生物统计学研究团队计划进行一项平衡的二乘二（2x2）析因临床试验，以研究两种分别记为 $A$ 和 $B$ 的二元治疗方法。每位参与者以均等分配的方式被随机分配到四个单元格 $\\{(A+,B+),(A+,B-),(A-,B+),(A-,B-)\\}$ 之一。设结局变量 $Y$ 为连续变量。假设采用以下线性模型，该模型具有同方差、独立、正态分布的误差以及正交的治疗编码：\n$$\nY \\;=\\; \\mu \\;+\\; \\beta_{1} x_{A} \\;+\\; \\beta_{2} x_{B} \\;+\\; \\beta_{12}\\, x_{A} x_{B} \\;+\\; \\varepsilon,\n$$\n其中 $x_{A},x_{B}\\in\\{-1,+1\\}$ 表示编码后的治疗指示变量，$\\varepsilon \\sim \\mathcal{N}(0,\\sigma^{2})$，总样本量为 $N$，每个单元格有 $N/4$ 名参与者。\n\n假设研究的科学目标是，当真实的交互作用参数等于 $\\beta_{12}\\neq 0$ 时，在双侧显著性水平 $\\alpha$ 和功效 $1-\\beta$ 下检测出 $A$ 和 $B$ 之间的交互作用。请从正态线性模型和大样本 Wald 检验的基本原理出发，推导为实现这一功效，对于 $H_{0}:\\beta_{12}=0$ 对 $H_{1}:\\beta_{12}\\neq 0$ 的双侧检验所需的最小总样本量 $N$。请将最终答案表示为一个由 $\\alpha$、$\\beta$、$\\sigma$ 和 $|\\beta_{12}|$ 组成的解析表达式（闭式解）。无需四舍五入，也无需物理单位。\n\n此外，在您的解题过程中，请解释在这种平衡析因设计下，检测主效应（$\\beta_{1}$ 或 $\\beta_{2}$）与交互效应（$\\beta_{12}$）之间的功效权衡。",
            "solution": "所陈述的问题具有科学依据、提法恰当、客观，并包含了进行形式推导所需的所有信息。它代表了生物统计学中析因实验设计领域一个标准且基本的问题。因此，该问题被认为是有效的。我们开始进行解答。\n\n该问题指定了一个总样本量为 $N$ 的平衡 $2 \\times 2$ 析因设计。共有四个治疗单元格，对应于治疗方法 $A$ 和 $B$ 的组合，编码为 $x_A, x_B \\in \\{-1, +1\\}$。这四个单元格是 $(x_A, x_B) \\in \\{(+1, +1), (+1, -1), (-1, +1), (-1, -1)\\}$，每个单元格包含 $N/4$ 名参与者。\n\n指定的线性模型是：\n$$\nY = \\mu + \\beta_{1} x_{A} + \\beta_{2} x_{B} + \\beta_{12}\\, x_{A} x_{B} + \\varepsilon\n$$\n其中 $\\varepsilon \\sim \\mathcal{N}(0, \\sigma^2)$。其矩阵形式为 $\\mathbf{Y} = X \\mathbf{b} + \\mathbf{\\varepsilon}$，其中 $\\mathbf{b} = (\\mu, \\beta_1, \\beta_2, \\beta_{12})^T$。设计矩阵 $X$ 是一个 $N \\times 4$ 的矩阵，其各列分别对应截距项、$x_A$、$x_B$ 和交互作用项 $x_A x_B$。\n\n设 $X$ 的列为 $\\mathbf{c}_0$, $\\mathbf{c}_1$, $\\mathbf{c}_2$, $\\mathbf{c}_3$。由于是每个单元格有 $N/4$ 名受试者的平衡设计，我们可以计算矩阵乘积 $X^T X$。$X^T X$ 的第 $(i, j)$ 个元素是点积 $\\mathbf{c}_i^T \\mathbf{c}_j$。该设计使用了正交编码，我们验证如下：\n- 对于对角线元素：\n  - $\\mathbf{c}_0^T \\mathbf{c}_0 = \\sum_{k=1}^N 1^2 = N$。\n  - $\\mathbf{c}_1^T \\mathbf{c}_1 = \\sum_{k=1}^N x_{kA}^2 = \\sum_{k=1}^N (\\pm 1)^2 = N$。\n  - $\\mathbf{c}_2^T \\mathbf{c}_2 = \\sum_{k=1}^N x_{kB}^2 = \\sum_{k=1}^N (\\pm 1)^2 = N$。\n  - $\\mathbf{c}_3^T \\mathbf{c}_3 = \\sum_{k=1}^N (x_{kA}x_{kB})^2 = \\sum_{k=1}^N (\\pm 1)^2 = N$。\n- 对于非对角线元素（利用每个唯一的 $(x_A, x_B)$ 对有 $N/4$ 名受试者的均等分配特性）：\n  - $\\mathbf{c}_0^T \\mathbf{c}_1 = \\sum x_{kA} = \\frac{N}{4}(+1) + \\frac{N}{4}(+1) + \\frac{N}{4}(-1) + \\frac{N}{4}(-1) = 0$。\n  - $\\mathbf{c}_1^T \\mathbf{c}_2 = \\sum x_{kA}x_{kB} = \\frac{N}{4}(+1)(+1) + \\frac{N}{4}(+1)(-1) + \\frac{N}{4}(-1)(+1) + \\frac{N}{4}(-1)(-1) = 0$。\n  - 所有其他不同列的点积同样为零。例如，$\\mathbf{c}_1^T \\mathbf{c}_3 = \\sum x_{kA}(x_{kA}x_{kB}) = \\sum x_{kA}^2 x_{kB} = \\sum x_{kB} = 0$。\n\n因此，$X^T X$ 矩阵是一个对角矩阵：\n$$\nX^T X = \\begin{pmatrix} N & 0 & 0 & 0 \\\\ 0 & N & 0 & 0 \\\\ 0 & 0 & N & 0 \\\\ 0 & 0 & 0 & N \\end{pmatrix} = N I_4\n$$\n其中 $I_4$ 是 $4 \\times 4$ 的单位矩阵。\n\n参数向量 $\\mathbf{b}$ 的普通最小二乘 (OLS) 估计量为 $\\hat{\\mathbf{b}} = (X^T X)^{-1} X^T \\mathbf{Y}$。该估计量的方差-协方差矩阵由 $\\text{Var}(\\hat{\\mathbf{b}}) = \\sigma^2 (X^T X)^{-1}$ 给出。\n使用我们关于 $X^T X$ 的结果，其逆矩阵为 $(X^T X)^{-1} = \\frac{1}{N} I_4$。\n因此，估计量的方差-协方差矩阵为：\n$$\n\\text{Var}(\\hat{\\mathbf{b}}) = \\sigma^2 \\left(\\frac{1}{N} I_4\\right) = \\frac{\\sigma^2}{N} I_4\n$$\n这种对角结构意味着估计量 $\\hat{\\mu}$、$\\hat{\\beta}_1$、$\\hat{\\beta}_2$ 和 $\\hat{\\beta}_{12}$ 是不相关的（并且，由于正态性，它们也是独立的）。交互作用项的特定估计量 $\\hat{\\beta}_{12}$ 的方差是该矩阵的第四个对角线元素：\n$$\n\\text{Var}(\\hat{\\beta}_{12}) = \\frac{\\sigma^2}{N}\n$$\n标准误为 $\\text{SE}(\\hat{\\beta}_{12}) = \\sqrt{\\frac{\\sigma^2}{N}} = \\frac{\\sigma}{\\sqrt{N}}$。\n由于结局变量 $Y$ 服从正态分布，OLS 估计量 $\\hat{\\beta}_{12}$ 也服从正态分布：\n$$\n\\hat{\\beta}_{12} \\sim \\mathcal{N}\\left(\\beta_{12}, \\frac{\\sigma^2}{N}\\right)\n$$\n科学目标是检验原假设 $H_0: \\beta_{12} = 0$ 与备择假设 $H_1: \\beta_{12} \\neq 0$。大样本 Wald 检验统计量为：\n$$\nZ = \\frac{\\hat{\\beta}_{12} - 0}{\\text{SE}(\\hat{\\beta}_{12})} = \\frac{\\hat{\\beta}_{12}}{\\sigma/\\sqrt{N}}\n$$\n在 $H_0$（即 $\\beta_{12}=0$）下，统计量 $Z$ 服从标准正态分布，$Z \\sim \\mathcal{N}(0, 1)$。如果在双侧显著性水平 $\\alpha$ 下，有 $|Z| > z_{1-\\alpha/2}$，我们就拒绝 $H_0$，其中 $z_{q}$ 是标准正态分布的第 $q$ 分位数。\n\n在 $H_1$ 下，交互作用参数的真实值是某个非零值 $\\beta_{12}$。检验统计量 $Z$ 则服从如下分布：\n$$\nZ = \\frac{\\hat{\\beta}_{12}}{\\sigma/\\sqrt{N}} \\sim \\mathcal{N}\\left(\\frac{\\beta_{12}}{\\sigma/\\sqrt{N}}, 1\\right)\n$$\n检验的功效 $1-\\beta$ 是在 $H_1$ 为真时正确拒绝 $H_0$ 的概率。\n$$\n1-\\beta = P\\left(|Z| > z_{1-\\alpha/2} \\mid \\beta_{12} \\neq 0\\right) = P\\left(Z > z_{1-\\alpha/2}\\right) + P\\left(Z < -z_{1-\\alpha/2}\\right)\n$$\n设 $\\delta = \\frac{\\beta_{12}\\sqrt{N}}{\\sigma}$ 为非中心化参数。$Z$ 的分布是 $\\mathcal{N}(\\delta, 1)$。设 $Z' \\sim \\mathcal{N}(0, 1)$。功效为：\n$$\n1-\\beta = P(Z' > z_{1-\\alpha/2} - \\delta) + P(Z' < -z_{1-\\alpha/2} - \\delta)\n$$\n对于一个有合理功效的研究，非中心化参数 $\\delta$ 的符号与 $\\beta_{12}$ 相同。如果 $\\beta_{12}>0$，那么 $\\delta>0$，此时 $P(Z' < -z_{1-\\alpha/2} - \\delta)$ 这一项变得可以忽略不计。功效主要由第一项决定。\n$$\n1-\\beta \\approx P(Z' > z_{1-\\alpha/2} - \\delta)\n$$\n这等价于说，概率的参数必须满足 $z_{1-\\alpha/2} - \\delta = z_{\\beta} = -z_{1-\\beta}$。\n$$\n\\delta \\approx z_{1-\\alpha/2} + z_{1-\\beta}\n$$\n如果 $\\beta_{12}<0$，那么 $\\delta<0$，此时第二项 $P(Z' < -z_{1-\\alpha/2} - \\delta)$ 占主导地位，导致条件 $-z_{1-\\alpha/2} - \\delta = z_{1-\\beta}$，从而得到 $-\\delta \\approx z_{1-\\alpha/2} + z_{1-\\beta}$。两种情况都可以通过使用绝对值来涵盖：\n$$\n|\\delta| = \\frac{|\\beta_{12}|\\sqrt{N}}{\\sigma} \\approx z_{1-\\alpha/2} + z_{1-\\beta}\n$$\n求解最小总样本量 $N$：\n$$\n\\sqrt{N} = \\frac{\\sigma}{|\\beta_{12}|} (z_{1-\\alpha/2} + z_{1-\\beta})\n$$\n$$\nN = \\frac{\\sigma^2 (z_{1-\\alpha/2} + z_{1-\\beta})^2}{\\beta_{12}^2}\n$$\n这就是以功效 $1-\\beta$ 在显著性水平 $\\alpha$ 下检测出量级为 $|\\beta_{12}|$ 的交互效应所需的最小总样本量。\n\n关于功效的权衡，我们必须考察主效应 $\\beta_1$ 和 $\\beta_2$ 的估计精度。根据我们先前对方差-协方差矩阵 $\\text{Var}(\\hat{\\mathbf{b}}) = \\frac{\\sigma^2}{N} I_4$ 的推导，我们发现主效应估计量的方差为：\n$$\n\\text{Var}(\\hat{\\beta}_1) = \\frac{\\sigma^2}{N} \\quad \\text{and} \\quad \\text{Var}(\\hat{\\beta}_2) = \\frac{\\sigma^2}{N}\n$$\n这些方差与交互作用估计量 $\\text{Var}(\\hat{\\beta}_{12})$ 的方差完全相同。这是采用正交编码的平衡 $2 \\times 2$ 析因设计的一个显著特性。这意味着，对于给定的效应量 $|\\theta|$，检测主效应 $\\beta_1=\\theta$、主效应 $\\beta_2=\\theta$ 或交互效应 $\\beta_{12}=\\theta$ 的统计功效是完全相同的。检测主效应 $\\beta_1$ 所需的样本量为 $N = \\sigma^2(z_{1-\\alpha/2} + z_{1-\\beta})^2 / \\beta_1^2$，其形式与用于交互作用的公式相同。\n\n因此，在这种设计下，检测主效应与交互作用之间不存在功效上的“权衡”，即提高一个效应的功效并不会以牺牲另一个效应的功效为代价。恰恰相反，析因设计的效率极高。它允许用相同的总样本量 $N$，以同样的精度（因此，对于给定的效应量，功效也相同）来估计两个主效应和一个交互效应，而这样的精度在两组实验中只能用于估计单个效应。实际上，整个样本量 $N$ 对每个效应的估计都有贡献。这种对多个效应的同时、高效能的估计是析因设计的主要优势。",
            "answer": "$$\n\\boxed{\\frac{\\sigma^2 \\left(z_{1-\\alpha/2} + z_{1-\\beta}\\right)^2}{\\beta_{12}^2}}\n$$"
        },
        {
            "introduction": "真实世界的临床试验常常会遇到数据不完整的挑战，例如参与者中途脱落，这可能给分析带来偏倚。本练习模拟了一个交叉试验中出现差分脱落（即脱落率因序列而异）的常见情景。您将首先展示一种简单的“天真”分析方法为何会产生有偏倚的结果，然后学习并应用一种强大的统计学校正技术——反概率加权法（IPW），以获得对治疗效果的无偏估计 。",
            "id": "4907236",
            "problem": "一个两阶段、两序列的交叉设计将参与者分配到序列 $AB$（时期 $1$ 接受治疗 $A$，时期 $2$ 接受治疗 $B$）或序列 $BA$（时期 $1$ 接受治疗 $B$，时期 $2$ 接受治疗 $A$）。假设没有延滞效应，并存在可加的时期效应，因此每个观测结果都满足模型 $Y_{it} = \\mu_{d_{it}} + \\pi_t + \\varepsilon_{it}$，其中 $d_{it} \\in \\{A,B\\}$ 是参与者 $i$ 在时期 $t$ 接受的治疗，$\\mu_{A}$ 和 $\\mu_{B}$ 是治疗均值，$\\pi_t$ 是时期效应，$\\varepsilon_{it}$ 的均值为 $0$ 且与序列、时期和治疗分配独立。受试者被随机分配，使得初始样本量为 $n_{AB} = 100$ 和 $n_{BA} = 100$。脱落仅发生在时期 $2$ 之前，且取决于序列，时期 $2$ 的保留概率分别为 $r_{AB} = 0.60$ 和 $r_{BA} = 0.90$。\n\n观测到的单元格均值（样本均值）如下：\n- 序列 $AB$，时期 $1$（治疗 $A$）：$10.1$（来自 $100$ 个观测值）。\n- 序列 $AB$，时期 $2$（治疗 $B$）：$12.9$（来自 $60$ 个观测值）。\n- 序列 $BA$，时期 $1$（治疗 $B$）：$12.1$（来自 $100$ 个观测值）。\n- 序列 $BA$，时期 $2$（治疗 $A$）：$10.9$（来自 $90$ 个观测值）。\n\n使用无偏性、期望值的核心定义以及上述可加模型，首先说明序列间的差异性脱落如何在通过观测治疗均值的朴素差异（即对所有观测到的 $B$ 结果取平均，然后减去所有观测到的 $A$ 结果的平均值，而不考虑时期或序列）来估计治疗对比 $\\Delta = \\mu_{B} - \\mu_{A}$ 时，破坏了使不同治疗间时期贡献相等的平衡条件。然后，构建一个逆概率加权（IPW）方案来恢复平衡。具体来说，定义权重，使得时期 $2$ 的观测值根据其在各自序列中的保留概率的倒数进行加权，而时期 $1$ 的权重等于 $1$。使用这些权重计算所有观测到的 $B$ 结果的加权平均值与所有观测到的 $A$ 结果的加权平均值之间的重新加权的差异。\n\n根据给定数据计算 $\\Delta$ 的 IPW 重新加权的估计量，并报告其值。将您的答案四舍五入到四位有效数字。最终答案以纯数字形式表示，不带单位。",
            "solution": "该问题要求分析一个存在差异性脱落的两阶段、两序列交叉试验。我们必须首先证明这种脱落模式如何在一个朴素的治疗效果估计量中引入偏差，然后使用逆概率加权（IPW）方案计算一个校正后的估计值。我们感兴趣的治疗对比是 $\\Delta = \\mu_B - \\mu_A$。\n\n对于受试者 $i$ 在时期 $t$ 的结果 $Y_{it}$，其底层的可加模型为 $Y_{it} = \\mu_{d_{it}} + \\pi_t + \\varepsilon_{it}$，其中 $\\mu_{d_{it}}$ 是治疗 $d_{it} \\in \\{A,B\\}$ 的均值，$\\pi_t$ 是时期 $t \\in \\{1,2\\}$ 的时期效应，$\\varepsilon_{it}$ 是一个均值为零的误差项。\n\n给定数据如下：\n- 初始样本量：$n_{AB} = 100$，$n_{BA} = 100$。\n- 保留概率：$r_{AB} = 0.60$，$r_{BA} = 0.90$。\n- 最终的样本量：\n  - 序列 $AB$，时期 $1$：$N_{AB,1} = n_{AB} = 100$。\n  - 序列 $AB$，时期 $2$：$N_{AB,2} = n_{AB} r_{AB} = 100 \\times 0.60 = 60$。\n  - 序列 $BA$，时期 $1$：$N_{BA,1} = n_{BA} = 100$。\n  - 序列 $BA$，时期 $2$：$N_{BA,2} = n_{BA} r_{BA} = 100 \\times 0.90 = 90$。\n- 观测到的单元格均值：$\\bar{Y}_{AB,1} = 10.1$，$\\bar{Y}_{AB,2} = 12.9$，$\\bar{Y}_{BA,1} = 12.1$，$\\bar{Y}_{BA,2} = 10.9$。\n\n**第1部分：朴素估计量的偏差**\n一个朴素估计量 $\\hat{\\Delta}_{naive}$ 是治疗 $B$ 的所有观测结果的平均值与治疗 $A$ 的所有观测结果的平均值之间的简单差值。\n\n治疗 A 的观测结果总数为 $N_A = N_{AB,1} + N_{BA,2} = 100 + 90 = 190$。\n治疗 B 的观测结果总数为 $N_B = N_{BA,1} + N_{AB,2} = 100 + 60 = 160$。\n\n观测结果的平均值为：\n$$ \\bar{Y}_A = \\frac{N_{AB,1}\\bar{Y}_{AB,1} + N_{BA,2}\\bar{Y}_{BA,2}}{N_A} $$\n$$ \\bar{Y}_B = \\frac{N_{BA,1}\\bar{Y}_{BA,1} + N_{AB,2}\\bar{Y}_{AB,2}}{N_B} $$\n所以，$\\hat{\\Delta}_{naive} = \\bar{Y}_B - \\bar{Y}_A$。\n\n为求偏差，我们计算 $\\hat{\\Delta}_{naive}$ 的期望值。单元格均值的期望值为：\n$E[\\bar{Y}_{AB,1}] = \\mu_A + \\pi_1$\n$E[\\bar{Y}_{AB,2}] = \\mu_B + \\pi_2$\n$E[\\bar{Y}_{BA,1}] = \\mu_B + \\pi_1$\n$E[\\bar{Y}_{BA,2}] = \\mu_A + \\pi_2$\n\n对平均结果取期望：\n$$ E[\\bar{Y}_A] = \\frac{N_{AB,1}(\\mu_A + \\pi_1) + N_{BA,2}(\\mu_A + \\pi_2)}{N_A} = \\mu_A + \\frac{N_{AB,1}\\pi_1 + N_{BA,2}\\pi_2}{N_A} $$\n$$ E[\\bar{Y}_B] = \\frac{N_{BA,1}(\\mu_B + \\pi_1) + N_{AB,2}(\\mu_B + \\pi_2)}{N_B} = \\mu_B + \\frac{N_{BA,1}\\pi_1 + N_{AB,2}\\pi_2}{N_B} $$\n朴素估计量的期望值为：\n$$ E[\\hat{\\Delta}_{naive}] = E[\\bar{Y}_B] - E[\\bar{Y}_A] = (\\mu_B - \\mu_A) + \\left( \\frac{N_{BA,1}\\pi_1 + N_{AB,2}\\pi_2}{N_B} - \\frac{N_{AB,1}\\pi_1 + N_{BA,2}\\pi_2}{N_A} \\right) $$\n偏差是加在真实治疗效应 $\\Delta = \\mu_B - \\mu_A$ 上的项。按时期效应重新整理偏差项：\n$$ \\text{Bias} = \\left( \\frac{N_{BA,1}}{N_B} - \\frac{N_{AB,1}}{N_A} \\right)\\pi_1 + \\left( \\frac{N_{AB,2}}{N_B} - \\frac{N_{BA,2}}{N_A} \\right)\\pi_2 $$\n代入样本量：\n$$ \\text{Bias} = \\left( \\frac{100}{160} - \\frac{100}{190} \\right)\\pi_1 + \\left( \\frac{60}{160} - \\frac{90}{190} \\right)\\pi_2 $$\n$$ \\text{Bias} = \\left( \\frac{5}{8} - \\frac{10}{19} \\right)\\pi_1 + \\left( \\frac{3}{8} - \\frac{9}{19} \\right)\\pi_2 = \\left( \\frac{95-80}{152} \\right)\\pi_1 + \\left( \\frac{57-72}{152} \\right)\\pi_2 = \\frac{15}{152}\\pi_1 - \\frac{15}{152}\\pi_2 = \\frac{15}{152}(\\pi_1 - \\pi_2) $$\n如果存在时期效应（$\\pi_1 \\neq \\pi_2$），则偏差非零。这种偏差的产生是因为差异性脱落（$r_{AB} \\neq r_{BA}$）破坏了每个治疗组内时期代表性的平衡。例如，治疗 A 的观测值由 $100/190 \\approx 52.6\\%$ 来自时期 $1$ 的数据和 $90/190 \\approx 47.4\\%$ 来自时期 $2$ 的数据组成，而治疗 B 的观测值由 $100/160 = 62.5\\%$ 来自时期 $1$ 的数据和 $60/160 = 37.5\\%$ 来自时期 $2$ 的数据组成。\n\n**第2部分：IPW 估计量**\n为校正此偏差，我们使用 IPW 方案。权重由被观测到的概率的倒数定义。\n- 对所有时期 1 的观测值，被观测到的概率为 $1$。权重为 $w_1 = 1$。\n- 对序列 $AB$ 中时期 2 的观测值，被观测到的概率（保留率）为 $r_{AB}=0.60$。权重为 $w_{AB,2} = 1/0.60$。\n- 对序列 $BA$ 中时期 2 的观测值，被观测到的概率为 $r_{BA}=0.90$。权重为 $w_{BA,2} = 1/0.90$。\n\n治疗差异的 IPW 估计量 $\\hat{\\Delta}_{IPW}$ 是所有观测到的 B 结果的加权平均值与所有观测到的 A 结果的加权平均值之差。\n$$ \\hat{\\Delta}_{IPW} = \\bar{Y}_{B,w} - \\bar{Y}_{A,w} \\quad \\text{其中} \\quad \\bar{Y}_{d,w} = \\frac{\\sum_{i: d_{i}=d} w_i Y_i}{\\sum_{i: d_{i}=d} w_i} $$\n其中求和是对治疗 $d$ 的所有观测结果进行的。\n\n首先，我们计算治疗 A 的加权平均值 $\\bar{Y}_{A,w}$。\n治疗 A 的加权结果之和为：\n$$\n\\begin{aligned}\n\\sum_{i \\in A} w_i Y_i = (N_{AB,1} \\bar{Y}_{AB,1}) \\cdot w_1 + (N_{BA,2} \\bar{Y}_{BA,2}) \\cdot w_{BA,2} \\\\\n= (100 \\times 10.1) \\times 1 + (90 \\times 10.9) \\times \\frac{1}{0.90} \\\\\n= 1010 + 1090 \\\\\n= 2100\n\\end{aligned}\n$$\n治疗 A 的权重之和为：\n$$ \\sum_{i \\in A} w_i = N_{AB,1} \\cdot w_1 + N_{BA,2} \\cdot w_{BA,2} = 100 \\cdot 1 + 90 \\cdot \\frac{1}{0.90} = 100 + 100 = 200 $$\n治疗 A 的加权平均值为：\n$$ \\bar{Y}_{A,w} = \\frac{2100}{200} = 10.5 $$\n\n接下来，我们计算治疗 B 的加权平均值 $\\bar{Y}_{B,w}$。\n治疗 B 的加权结果之和为：\n$$\n\\begin{aligned}\n\\sum_{i \\in B} w_i Y_i = (N_{BA,1} \\bar{Y}_{BA,1}) \\cdot w_1 + (N_{AB,2} \\bar{Y}_{AB,2}) \\cdot w_{AB,2} \\\\\n= (100 \\times 12.1) \\times 1 + (60 \\times 12.9) \\times \\frac{1}{0.60} \\\\\n= 1210 + 1290 \\\\\n= 2500\n\\end{aligned}\n$$\n治疗 B 的权重之和为：\n$$ \\sum_{i \\in B} w_i = N_{BA,1} \\cdot w_1 + N_{AB,2} \\cdot w_{AB,2} = 100 \\cdot 1 + 60 \\cdot \\frac{1}{0.60} = 100 + 100 = 200 $$\n治疗 B 的加权平均值为：\n$$ \\bar{Y}_{B,w} = \\frac{2500}{200} = 12.5 $$\n\n最后，我们计算 $\\Delta$ 的 IPW 重新加权的估计量：\n$$ \\hat{\\Delta}_{IPW} = \\bar{Y}_{B,w} - \\bar{Y}_{A,w} = 12.5 - 10.5 = 2.0 $$\nIPW 方案创建了一个伪总体，其中每个治疗的总权重在不同时期之间是平衡的，从而恢复了无偏估计的条件。问题要求将答案四舍五入到四位有效数字。",
            "answer": "$$\n\\boxed{2.000}\n$$"
        }
    ]
}