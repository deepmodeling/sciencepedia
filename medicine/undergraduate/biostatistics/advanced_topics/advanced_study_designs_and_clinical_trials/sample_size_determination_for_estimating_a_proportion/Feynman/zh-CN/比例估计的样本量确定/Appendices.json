{
    "hands_on_practices": [
        {
            "introduction": "在进行任何研究设计之前，理解样本量计算公式的来源至关重要。这个基础练习将指导你从第一性原理出发，利用正态近似推导出用于估计比例的核心样本量公式。通过这个过程，你不仅会学会如何应用该公式，还将深入理解其背后的统计学原理，例如置信水平、边际误差和总体变异性之间的权衡。",
            "id": "4950548",
            "problem": "一家公共卫生实验室计划进行一项横断面研究，以估计未知的感染患病率与某一基准值之间的差异。令 $p$ 表示目标人群中受感染的真实总体比例，令 $p_{0}$ 表示前一个监测年份的固定基准比例。感兴趣的估计量是风险差 $d = p - p_{0}$。研究者将从目标人群中收集一个大小为 $n$ 的独立同分布样本，并计算样本比例 $\\hat{p}$，以构建置入估计量 $\\hat{d} = \\hat{p} - p_{0}$。设计要求是，基于大样本正态近似的 $d$ 的双侧 $(1-\\alpha)$ 置信区间的半宽不大于预先指定的边际误差 $m > 0$。\n\n从伯努利结果抽样的第一性原理出发，推导在所述正态近似下，保证满足边际误差要求的最小所需样本量 $n$ 关于 $p$、$\\alpha$ 和 $m$ 的精确解析表达式。然后，定性地解释在这种近似下所需的 $n$ 如何依赖于 $p$，并确定哪些 $p$ 值会使 $n$ 最大化。你最终报告的答案必须是 $n$ 的封闭形式符号表达式；不要代入数值或报告不等式。",
            "solution": "问题陈述经评估有效。这是一个在生物统计学中提法恰当、有科学依据的问题，没有矛盾或歧义。因此，我们可以进行推导。\n\n设个体受试者的结果为一个随机变量 $X$，如果受试者被感染，则 $X=1$，否则 $X=0$。给定抽样来自一个大总体，其中受感染个体的真实比例为 $p$。因此，$X$ 服从参数为 $p$ 的伯努利分布，记为 $X \\sim \\text{Bernoulli}(p)$。$X$ 的期望值为 $E[X] = p$，其方差为 $\\text{Var}(X) = p(1-p)$。\n\n抽取一个大小为 $n$ 的独立同分布样本，得到结果 $X_1, X_2, \\ldots, X_n$。样本比例 $\\hat{p}$ 是这些结果的样本均值：\n$$ \\hat{p} = \\frac{1}{n} \\sum_{i=1}^{n} X_i $$\n根据期望的线性性质，样本比例的期望值为：\n$$ E[\\hat{p}] = E\\left[\\frac{1}{n} \\sum_{i=1}^{n} X_i\\right] = \\frac{1}{n} \\sum_{i=1}^{n} E[X_i] = \\frac{1}{n} \\sum_{i=1}^{n} p = \\frac{np}{n} = p $$\n由于观测值是独立的，样本比例的方差为：\n$$ \\text{Var}(\\hat{p}) = \\text{Var}\\left(\\frac{1}{n} \\sum_{i=1}^{n} X_i\\right) = \\frac{1}{n^2} \\sum_{i=1}^{n} \\text{Var}(X_i) = \\frac{1}{n^2} \\sum_{i=1}^{n} p(1-p) = \\frac{n p(1-p)}{n^2} = \\frac{p(1-p)}{n} $$\n感兴趣的估计量是风险差 $d = p - p_0$，其中 $p_0$ 是一个固定的已知常数。$d$ 的估计量为 $\\hat{d} = \\hat{p} - p_0$。$\\hat{d}$ 的期望值为 $E[\\hat{d}] = E[\\hat{p} - p_0] = E[\\hat{p}] - p_0 = p - p_0 = d$。这证实了 $\\hat{d}$ 是 $d$ 的一个无偏估计量。$\\hat{d}$ 的方差为：\n$$ \\text{Var}(\\hat{d}) = \\text{Var}(\\hat{p} - p_0) = \\text{Var}(\\hat{p}) = \\frac{p(1-p)}{n} $$\n因为 $p_0$ 是一个常数，所以它对方差没有贡献。估计量 $\\hat{d}$ 的标准误是其方差的平方根：\n$$ SE(\\hat{d}) = \\sqrt{\\frac{p(1-p)}{n}} $$\n问题陈述要求基于大样本正态近似构建 $d$ 的双侧 $(1-\\alpha)$ 置信区间。根据中心极限定理，对于足够大的样本量 $n$，$\\hat{d}$ 的抽样分布近似为均值为 $d$、方差为 $\\frac{p(1-p)}{n}$ 的正态分布。$d$ 的一个通用的双侧 $(1-\\alpha)$ 置信区间由下式给出：\n$$ \\hat{d} \\pm z_{1-\\alpha/2} \\times SE(\\hat{d}) $$\n其中 $z_{1-\\alpha/2}$ 是标准正态分布的分位数，其右侧尾部概率为 $\\alpha/2$（即 $\\Phi(z_{1-\\alpha/2}) = 1-\\alpha/2$，其中 $\\Phi$ 是标准正态累积分布函数）。\n\n该置信区间的半宽，我们可以表示为 $HW$，是乘以 $z$-分数的量：\n$$ HW = z_{1-\\alpha/2} \\times SE(\\hat{d}) = z_{1-\\alpha/2} \\sqrt{\\frac{p(1-p)}{n}} $$\n设计要求是该半宽不得大于预先指定的边际误差 $m > 0$。为了找到保证此条件的最小样本量 $n$，我们将半宽设为等于 $m$：\n$$ m = z_{1-\\alpha/2} \\sqrt{\\frac{p(1-p)}{n}} $$\n我们现在解这个方程求 $n$。两边平方得：\n$$ m^2 = \\left(z_{1-\\alpha/2}\\right)^2 \\left(\\frac{p(1-p)}{n}\\right) $$\n两边乘以 $n$ 得：\n$$ n m^2 = z_{1-\\alpha/2}^{2} p(1-p) $$\n最后，除以 $m^2$ 分离出 $n$，得到最小所需样本量的精确解析表达式：\n$$ n = \\frac{z_{1-\\alpha/2}^{2} p(1-p)}{m^2} $$\n这个表达式给出了 $n$ 关于真实比例 $p$、显著性水平 $\\alpha$（它决定了 $z_{1-\\alpha/2}$）和期望的边际误差 $m$ 的关系。\n\n为了定性地解释所需样本量 $n$ 如何依赖于 $p$，我们检查推导出的公式。对于固定的置信水平 $(1-\\alpha)$ 和边际误差 $m$，项 $z_{1-\\alpha/2}^2$ 和 $m^2$ 是正常数。因此，$n$ 与乘积 $p(1-p)$ 成正比：\n$$ n \\propto p(1-p) $$\n项 $p(1-p)$ 代表单个伯努利试验的方差。因此，达到特定精度所需的样本量由总体的基础方差决定。函数 $f(p) = p(1-p) = p-p^2$ 是一个关于 $p$ 的二次函数，定义在区间 $p \\in [0, 1]$ 上。为了找到使该函数最大化（从而使所需样本量 $n$ 最大化）的 $p$ 值，我们可以使用微积分。对 $p$ 求一阶导数并令其为零：\n$$ \\frac{df}{dp} = \\frac{d}{dp}(p-p^2) = 1 - 2p = 0 $$\n解得 $p = \\frac{1}{2} = 0.5$。二阶导数为 $\\frac{d^2f}{dp^2} = -2$，是负数，这证实了 $p=0.5$ 对应一个最大值。\n\n因此，当真实总体比例 $p$ 为 $0.5$ 时，所需样本量 $n$ 最大。这是“最坏情况”或最保守的情景，因为它对应于总体中可能的最大异质性（方差）。当总体在感染和未感染个体之间均等分配时，不确定性达到峰值，需要最大的样本量来以给定的精度估计该比例。当 $p$ 接近 $0$ 或 $1$ 时，总体变得更加同质，方差 $p(1-p)$ 减小，因此需要较小的样本量。",
            "answer": "$$\\boxed{\\frac{z_{1-\\alpha/2}^{2} p(1-p)}{m^2}}$$"
        },
        {
            "introduction": "研究的目标并非总要求一个对称的置信区间。有时，我们更关心的是比例是否超过或低于某个阈值，即单侧检验。这个练习将探讨如何根据单侧精度目标调整样本量计算，并与双侧目标进行比较。通过解决这个问题，你将学会如何使研究设计更高效，并精确地匹配你的特定研究问题，从而避免不必要的资源浪费。",
            "id": "4950450",
            "problem": "一个公共卫生团队计划进行一项横断面调查，以估计一个二元比率 $p$（即个体具有特定健康属性的概率）。令 $\\hat{p}$ 表示从大小为 $n$ 的样本中得到的样本比例。该团队要求 $\\hat{p}$ 和 $p$ 之间的最大绝对误差为 $m$，并通过一个置信陈述来保证。他们正在考虑基于大样本近似的两个精度目标：\n- 一个双侧置信陈述，要求 $\\Pr(|\\hat{p}-p|\\le m)\\approx 1-\\alpha$。\n- 一个单侧置信陈述，要求 $\\Pr(\\hat{p}-p\\le m)\\approx 1-\\alpha$。\n\n仅从 $\\hat{p}$ 的二项模型和中心极限定理（CLT）出发，推导误差界 $m$ 如何通过 $\\hat{p}$ 的抽样变异性和适当的标准正态分位数与 $n$ 相关联。利用此关系，在 $m$ 和 $\\alpha$ 保持固定的情况下，比较两种目标下所需的样本量。定义 $z_{\\gamma}$ 为标准正态分布的上$\\gamma$-分位数，即对于 $Z\\sim \\mathcal{N}(0,1)$，满足 $\\Pr(Z>z_{\\gamma})=\\gamma$ 的数值。\n\n表达出单侧设计所需的样本量相对于双侧设计所需样本量的乘法因子，然后对 $\\alpha=0.05$ 的情况计算该因子的数值。将最终数值答案四舍五入至四位有效数字。",
            "solution": "我们从二项抽样模型开始：如果 $X\\sim \\mathrm{Binomial}(n,p)$ 表示大小为 $n$ 的样本中具有该属性的个体数量，则样本比例为 $\\hat{p}=X/n$。$\\hat{p}$ 的期望和方差为\n$$\n\\mathbb{E}[\\hat{p}]=p, \\qquad \\mathrm{Var}(\\hat{p})=\\frac{p(1-p)}{n}.\n$$\n根据中心极限定理（CLT），对于大的 $n$，\n$$\n\\frac{\\hat{p}-p}{\\sqrt{p(1-p)/n}} \\approx Z,\n$$\n其中 $Z\\sim \\mathcal{N}(0,1)$ 是一个标准正态随机变量。\n\n双侧精度目标。双侧要求 $\\Pr(|\\hat{p}-p|\\le m)\\approx 1-\\alpha$ 在正态近似下可以写为\n$$\n\\Pr\\!\\left(\\left|\\frac{\\hat{p}-p}{\\sqrt{p(1-p)/n}}\\right|\\le \\frac{m}{\\sqrt{p(1-p)/n}}\\right)\\approx \\Pr(|Z|\\le c)=1-\\alpha,\n$$\n其中 $c$ 是使绝对正态变量达到 $1-\\alpha$ 覆盖率的临界值。等价地，$c=z_{\\alpha/2}$，其中 $z_{\\gamma}$ 由 $\\Pr(Z>z_{\\gamma})=\\gamma$ 定义。施加误差界 $m$ 可得\n$$\n\\frac{m}{\\sqrt{p(1-p)/n}}=z_{\\alpha/2} \\quad \\Longrightarrow \\quad n_{\\text{two}}=\\frac{z_{\\alpha/2}^{2}\\,p(1-p)}{m^{2}}.\n$$\n\n单侧精度目标。单侧要求 $\\Pr(\\hat{p}-p\\le m)\\approx 1-\\alpha$ 在相同的近似下可转化为\n$$\n\\Pr\\!\\left(\\frac{\\hat{p}-p}{\\sqrt{p(1-p)/n}}\\le \\frac{m}{\\sqrt{p(1-p)/n}}\\right)\\approx \\Pr(Z\\le c)=1-\\alpha,\n$$\n当 $c=z_{\\alpha}$ 时，该条件成立，因为 $\\Pr(Z>z_{\\alpha})=\\alpha$。因此，误差界条件意味着\n$$\n\\frac{m}{\\sqrt{p(1-p)/n}}=z_{\\alpha} \\quad \\Longrightarrow \\quad n_{\\text{one}}=\\frac{z_{\\alpha}^{2}\\,p(1-p)}{m^{2}}.\n$$\n\n样本量的乘法变化。在保持 $m$ 和 $\\alpha$ 固定的情况下，所需样本量之比为\n$$\n\\frac{n_{\\text{one}}}{n_{\\text{two}}}=\\frac{z_{\\alpha}^{2}\\,p(1-p)/m^{2}}{z_{\\alpha/2}^{2}\\,p(1-p)/m^{2}}=\\left(\\frac{z_{\\alpha}}{z_{\\alpha/2}}\\right)^{2}.\n$$\n在正态近似下，该因子与 $p$ 和 $m$ 无关。\n\n对于 $\\alpha=0.05$ 的数值计算。这里 $z_{\\alpha}=z_{0.05}$ 且 $z_{\\alpha/2}=z_{0.025}$。使用标准正态分位数，\n$$\nz_{0.05}\\approx 1.64485362695147, \\qquad z_{0.025}\\approx 1.95996398454005,\n$$\n所以乘法因子是\n$$\n\\left(\\frac{z_{0.05}}{z_{0.025}}\\right)^{2}\\approx \\left(\\frac{1.64485362695147}{1.95996398454005}\\right)^{2}\\approx 0.704300999\\ldots\n$$\n四舍五入至四位有效数字，该因子为 $0.7043$。",
            "answer": "$$\\boxed{0.7043}$$"
        },
        {
            "introduction": "在处理罕见事件（如药物不良反应或稀有疾病）时，标准的正态近似可能不再准确。本练习将介绍泊松近似，这是一种在流行病学和安全性研究中非常有用的强大工具。你将学习如何在这种“大样本、小概率”的情境下推导样本量，特别是在预期事件数为零的挑战性研究设计中。",
            "id": "4950477",
            "problem": "一项安全性监测研究将招募 $n$ 名独立受试者，每名受试者的二元不良事件结局被建模为事件概率为 $p$ 的独立同分布伯努利随机变量。令 $X$ 表示 $n$ 名受试者中的不良事件总数，因此 $X$ 服从参数为 $n$ 和 $p$ 的二项分布。在 $p$ 很小、$n$ 很大但乘积 $np$ 保持中等量级的罕见事件情形下，请仔细论证使用均值参数为 $\\lambda = np$ 的泊松分布来近似 $X$ 的二项分布的合理性。从基本定义出发，在 $p \\to 0$，$n \\to \\infty$ 且 $np \\to \\lambda$ 的条件下，确立二项概率质量函数的极限形式，并解释指数极限在此推导中的作用。\n\n利用此泊松近似，基于观测到的计数值 $X$，推导事件概率 $p$ 的一个近似双侧 $(1-\\alpha)$ 置信区间(CI)。推导应以泊松模型下最大似然估计量(MLE)的大样本性质以及MLE在光滑变换下的不变性为起点。同时，在观测计数值为 $X=0$ 的特殊情况下，通过反转精确的泊松尾部概率，推导 $p$ 的 $(1-\\alpha)$ 单侧置信上限。\n\n规划问题：一项设备安全性研究旨在证明，如果观测到零例不良事件，则 $p$ 的单侧 $95\\%$ 置信上限严格低于预设的安全阈值 $p^{\\star} = 1.5 \\times 10^{-4}$。对于单侧置信限，取 $\\alpha = 0.05$。利用上面推导出的泊松近似结果，确定所需的最小整数样本量 $n$，使得当 $X=0$ 时，$p$ 的 $(1-\\alpha)$ 上限小于 $p^{\\star}$。将最终数值答案表示为单个整数 $n$。无需按有效数字进行四舍五入；报告满足条件的最小整数。",
            "solution": "在 $n$ 次事件概率为 $p$ 的独立伯努利试验中，不良事件的总数 $X$ 服从二项分布，其概率质量函数为\n$$\n\\Pr(X=x) = \\binom{n}{x} p^{x} (1-p)^{n-x}, \\quad x=0,1,2,\\dots,n.\n$$\n我们寻求在 $p$ 很小、$n$ 很大，而乘积 $np$ 保持中等量级时的极限近似。设 $\\lambda = np$，并考虑极限 $n \\to \\infty$，$p \\to 0$，使得 $np \\to \\lambda$。一种标准方法是代入 $p = \\lambda/n$ 并考察其极限形式：\n$$\n\\Pr(X=x) = \\binom{n}{x} \\left(\\frac{\\lambda}{n}\\right)^{x} \\left(1 - \\frac{\\lambda}{n}\\right)^{n-x}.\n$$\n重写二项式系数并将各项分开：\n$$\n\\binom{n}{x} \\left(\\frac{\\lambda}{n}\\right)^{x} = \\frac{n(n-1)\\cdots(n-x+1)}{x!} \\cdot \\frac{\\lambda^{x}}{n^{x}}.\n$$\n当 $n \\to \\infty$ 且 $x$ 固定时，我们有\n$$\n\\frac{n(n-1)\\cdots(n-x+1)}{n^{x}} \\to 1,\n$$\n因此第一项收敛于 $\\lambda^{x}/x!$。对于剩余的项，使用熟知的指数极限\n$$\n\\lim_{n \\to \\infty} \\left(1 - \\frac{\\lambda}{n}\\right)^{n} = \\exp(-\\lambda).\n$$\n此外，\n$$\n\\left(1 - \\frac{\\lambda}{n}\\right)^{-x} \\to 1 \\quad \\text{as} \\quad n \\to \\infty \\quad \\text{for fixed } x.\n$$\n结合这些极限可得\n$$\n\\Pr(X=x) \\to \\frac{\\lambda^{x}}{x!} \\exp(-\\lambda),\n$$\n这是均值为 $\\lambda$ 的泊松随机变量的概率质量函数。因此，在 $p \\to 0$，$n \\to \\infty$ 且 $np \\to \\lambda$ 的条件下，我们得到近似 $X \\sim \\text{Poisson}(\\lambda)$，其中 $\\lambda = np$。\n\n接下来我们通过泊松近似推导 $p$ 的近似置信区间。在 $X \\sim \\text{Poisson}(\\lambda)$ 的条件下，$\\lambda$ 的最大似然估计量(MLE)是 $\\hat{\\lambda} = X$。对于单个泊松观测值，$\\lambda$ 的费雪信息为 $I(\\lambda) = 1/\\lambda$，根据标准渐近理论，MLE近似服从正态分布：\n$$\n\\hat{\\lambda} \\approx \\text{Normal}\\!\\left(\\lambda, \\lambda\\right),\n$$\n或者等价地，\n$$\n\\frac{\\hat{\\lambda} - \\lambda}{\\sqrt{\\lambda}} \\approx \\text{Normal}(0,1).\n$$\n在标准误中用 $\\hat{\\lambda}$ 替换 $\\lambda$，可得到常见的大样本双侧 $(1-\\alpha)$ 置信区间：\n$$\n\\hat{\\lambda} \\pm z_{1-\\alpha/2} \\sqrt{\\hat{\\lambda}},\n$$\n其中 $z_{1-\\alpha/2}$ 是标准正态分布的 $(1-\\alpha/2)$ 分位数。由于 $p = \\lambda/n$，$p$ 的MLE为 $\\hat{p} = \\hat{\\lambda}/n = X/n$。根据MLE在光滑变换下的不变性以及德尔塔方法，$p$ 的近似双侧 $(1-\\alpha)$ 置信区间为\n$$\n\\hat{p} \\pm z_{1-\\alpha/2} \\frac{\\sqrt{\\hat{\\lambda}}}{n} \\;=\\; \\frac{X}{n} \\pm z_{1-\\alpha/2} \\frac{\\sqrt{X}}{n}.\n$$\n该区间在事件罕见时利用了方差的泊松近似。\n\n现在我们通过反转精确的泊松尾部概率，来推导当 $X=0$ 时 $p$ 的单侧置信上限。对于 $X \\sim \\text{Poisson}(\\lambda)$，观测到零事件的概率是\n$$\n\\Pr(X=0) = \\exp(-\\lambda).\n$$\n在给定 $X=0$ 的条件下，$\\lambda$ 的一个单侧 $(1-\\alpha)$ 置信上限满足\n$$\n\\Pr_{\\lambda_U}(X=0) = \\alpha \\quad \\Rightarrow \\quad \\exp(-\\lambda_U) = \\alpha \\quad \\Rightarrow \\quad \\lambda_U = -\\ln(\\alpha).\n$$\n通过 $p = \\lambda/n$ 变换回 $p$，得到相应的置信上限\n$$\np_U = \\frac{\\lambda_U}{n} = \\frac{-\\ln(\\alpha)}{n}.\n$$\n\n我们将此应用于规划问题。该研究旨在确保，如果 $X=0$，则在置信水平为 $(1-\\alpha)$（其中 $\\alpha = 0.05$）时，$p$ 的单侧置信上限严格低于 $p^{\\star} = 1.5 \\times 10^{-4}$。要求是\n$$\np_U = \\frac{-\\ln(\\alpha)}{n}  p^{\\star}.\n$$\n解出 $n$ 可得\n$$\nn > \\frac{-\\ln(\\alpha)}{p^{\\star}}.\n$$\n为保证该上限严格低于 $p^{\\star}$，我们选择满足该不等式的最小整数 $n$：\n$$\nn_{\\min} = \\left\\lceil \\frac{-\\ln(\\alpha)}{p^{\\star}} \\right\\rceil.\n$$\n代入 $\\alpha = 0.05$ 和 $p^{\\star} = 1.5 \\times 10^{-4}$，\n$$\n-\\ln(0.05) \\approx 2.99573227355,\n$$\n因此\n$$\n\\frac{-\\ln(0.05)}{1.5 \\times 10^{-4}} \\approx \\frac{2.99573227355}{0.00015} \\approx 19971.54849.\n$$\n因此，所需的最小整数样本量是\n$$\nn_{\\min} = 19972.\n$$\n这个 $n$ 值确保了在观测到零事件的情况下，$p$ 的单侧 $95\\%$ 置信上限严格低于 $1.5 \\times 10^{-4}$，符合要求。",
            "answer": "$$\\boxed{19972}$$"
        }
    ]
}