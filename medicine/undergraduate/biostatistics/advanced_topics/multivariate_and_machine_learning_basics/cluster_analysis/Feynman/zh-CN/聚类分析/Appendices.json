{
    "hands_on_practices": [
        {
            "introduction": "尽管 $k$-均值算法因其直观和简洁而广受欢迎，但其性能可能会被异常值严重影响。本练习通过一个“对抗性”的场景，具体地展示了这一弱点。通过推导算法失效的确切临界点，您将更深刻地理解选择稳健聚类方法的重要性。",
            "id": "4900186",
            "problem": "一位生物统计学研究员正在分析一个在 $n=11$ 名受试者中测量的单变量基因表达生物标志物。由于批次效应，一名受试者表现出一个极端值。为清晰起见，忽略测量噪声，数据由两个具有生物学意义的组和一个离群值组成，具体来说，$n_{1}=5$ 名受试者的值为 $0$，$n_{2}=5$ 名受试者的值为 $10$，以及一个值为 $L>10$ 的离群值。目标是使用平方欧几里得距离将受试者聚类成 $k=2$ 个组。具有生物学意义的划分是，值为 $0$ 的受试者形成一个簇，值为 $10$ 的受试者形成另一个簇，而离群值由一个稳健的过程处理。\n\n$k$-均值目标函数的定义是与簇均值的平方偏差之和；形式上，对于一个划分 $\\{C_{1},C_{2}\\}$，其簇均值分别为 $m_{1}$ 和 $m_{2}$，目标函数为 $\\sum_{x\\in C_{1}}(x-m_{1})^{2}+\\sum_{x\\in C_{2}}(x-m_{2})^{2}$。考虑数据集的两种可能的划分：\n- 划分 I（生物学上正确的组）：将值为 $0$ 的受试者聚为一簇，值为 $10$ 的受试者聚为一簇，并将离群值分配给其均值更接近 $L$ 的簇。\n- 划分 II（对抗性离群值隔离）：将离群值单独置于一个簇中，并将两个生物学组合并到另一个簇中。\n\n使用第一性原理和目标函数定义，推导出临界离群值大小 $L^{\\ast}$，使得对于所有 $L>L^{\\ast}$，标准 $k$-均值目标函数在所有 $k=2$ 划分上的全局最小值是划分 II 而不是划分 I。然后，解释为什么当修剪比例 $\\alpha=\\frac{1}{11}$ 时，一个 $\\alpha$-修剪 $k$-均值过程（该过程在计算簇均值之前，丢弃具有最大平方残差的 $\\alpha$ 比例的观测值）对于任何 $L>L^{\\ast}$ 都能恢复生物学上正确的两组结构。\n\n将最终答案表示为 $L^{\\ast}$ 的精确值。不要四舍五入。",
            "solution": "相关的基础是 $k$-均值目标函数定义为与簇均值的平方偏差之和。我们将比较两种候选划分的目标函数值，并确定对于离群值大小 $L$ 的哪些值，每种划分会产生更小的目标函数值。\n\n我们将数据集表示为 $D=\\{0,0,0,0,0,10,10,10,10,10,L\\}$，其中有 $n_{1}=5$ 个值为 $0$ 的观测值，$n_{2}=5$ 个值为 $10$ 的观测值，以及一个值为 $L>10$ 的离群值。我们使用 $k=2$ 个簇和平方欧几里得距离。\n\n划分 I 将值为 $0$ 的受试者放入一个簇，将值为 $10$ 的受试者放入另一个簇。由于 $L>10$，离群值比 $0$ 更接近 $10$，因此，为了比较目标函数值，很自然地考虑将 $L$ 分配给最初以 $10$ 附近为中心的簇。在此划分下：\n- 簇 $C_{1}$ 包含五个值为 $0$ 的受试者，因此其均值为 $m_{1}=0$，其簇内平方和为 $\\sum_{x\\in C_{1}}(x-m_{1})^{2}=0$。\n- 簇 $C_{2}$ 包含五个值为 $10$ 的受试者和离群值 $L$，因此其均值为 \n$$\nm_{2}=\\frac{10\\cdot n_{2}+L}{n_{2}+1}=\\frac{50+L}{6}.\n$$\n$C_{2}$ 中的平方偏差之和为\n$$\n\\sum_{x\\in C_{2}}(x-m_{2})^{2}=n_{2}\\,(10-m_{2})^{2}+(L-m_{2})^{2}.\n$$\n我们明确地计算偏差。首先，\n$$\n10-m_{2}=10-\\frac{50+L}{6}=\\frac{60-(50+L)}{6}=\\frac{10-L}{6},\n$$\n其次，\n$$\nL-m_{2}=L-\\frac{50+L}{6}=\\frac{6L-(50+L)}{6}=\\frac{5L-50}{6}=\\frac{5(L-10)}{6}.\n$$\n因此，\n$$\n\\sum_{x\\in C_{2}}(x-m_{2})^{2}=5\\left(\\frac{10-L}{6}\\right)^{2}+\\left(\\frac{5(L-10)}{6}\\right)^{2}\n=\\frac{5(10-L)^{2}}{36}+\\frac{25(L-10)^{2}}{36}\n=\\frac{30(L-10)^{2}}{36}=\\frac{5}{6}(L-10)^{2}.\n$$\n因此，划分 I 的总 $k$-均值目标函数值为\n$$\n\\text{SSE}_{\\text{I}}=0+\\frac{5}{6}(L-10)^{2}=\\frac{5}{6}(L-10)^{2}.\n$$\n\n划分 II 将离群值隔离在其自己的簇中，并将两个生物学组合并到另一个簇中。在此划分下：\n- 簇 $C_{1}$ 只包含离群值，其均值为 $m_{1}=L$，簇内平方和为 $0$。\n- 簇 $C_{2}$ 包含五个值为 $0$ 的受试者和五个值为 $10$ 的受试者。其均值为 \n$$\nm_{2}=\\frac{0\\cdot n_{1}+10\\cdot n_{2}}{n_{1}+n_{2}}=\\frac{50}{10}=5.\n$$\n$C_{2}$ 中的平方偏差之和为\n$$\n\\sum_{x\\in C_{2}}(x-m_{2})^{2}=5\\,(0-5)^{2}+5\\,(10-5)^{2}=5\\cdot 25+5\\cdot 25=250.\n$$\n因此，划分 II 的总目标函数值为\n$$\n\\text{SSE}_{\\text{II}}=0+250=250.\n$$\n\n我们确定临界离群值大小 $L^{\\ast}$，使得两种划分的目标函数值相等：\n$$\n\\text{SSE}_{\\text{I}}=\\text{SSE}_{\\text{II}}\n\\quad\\Longleftrightarrow\\quad\n\\frac{5}{6}(L-10)^{2}=250.\n$$\n解出 $L$，\n$$\n(L-10)^{2}=250\\cdot\\frac{6}{5}=50\\cdot 6=300,\n$$\n所以\n$$\nL-10=\\sqrt{300}=10\\sqrt{3}.\n$$\n因为我们考虑的是 $L>10$，所以相关的解是\n$$\nL^{\\ast}=10+10\\sqrt{3}.\n$$\n对于任何 $L>L^{\\ast}$，我们有 $\\text{SSE}_{\\text{I}}>\\text{SSE}_{\\text{II}}$，因此标准 $k$-均值目标函数在 $k=2$ 时的全局最小值是划分 II，它隔离了离群值并将两个生物学组合并，从而未能恢复生物学上正确的簇。\n\n最后，考虑修剪比例为 $\\alpha=\\frac{1}{11}$ 的 $\\alpha$-修剪 $k$-均值过程。在水平 $\\alpha=\\frac{1}{11}$ 进行修剪会恰好丢弃一个观测值（因为 $n=11$），即相对于当前质心具有最大平方残差的那个观测值。对于 $L>10$，在两种候选划分中，离群值都是距离任一质心最远的点，因此是唯一将被修剪掉的点。修剪掉 $L$ 后，剩余的数据集包含五个值为 $0$ 和五个值为 $10$ 的受试者。将这个修剪后的数据集进行最优 $k$-均值划分为 $k=2$ 个簇，其均值分别为 $0$ 和 $10$，簇内离散度为零，从而恢复了生物学上正确的聚类，无论 $L$ 的值在 $L^{\\ast}$ 之上有多大。这表明，即使在标准 $k$-均值因离群值而失败的对抗性情况下，稳健的修剪方法也能恢复正确的簇。\n\n精确的临界离群值大小是 $L^{\\ast}=10+10\\sqrt{3}$。",
            "answer": "$$\\boxed{10+10\\sqrt{3}}$$"
        },
        {
            "introduction": "在聚类分析中，选择合适的距离度量与选择算法本身同样关键。本练习将超越标准的欧几里得距离，探索一种专为计数数据设计的度量方法，这在基因组学等领域非常常见。通过推导和应用基于泊松离差的相异度，您将学习到基于模型的统计方法如何能够提供更有意义的结果。",
            "id": "4900189",
            "problem": "一位生物统计学家正在对一项具有零膨胀计数数据的小型RNA测序实验的样本进行聚类。共有$3$个样本，标记为$A$、$B$和$C$，以及$4$个基因，标记为$g_1, g_2, g_3, g_4$。观测到的计数（按$(g_1,g_2,g_3,g_4)$的顺序）如下：\n- 样本$A$：$(0, 3, 12, 0)$\n- 样本$B$：$(1, 0, 7, 2)$\n- 样本$C$：$(0, 1, 15, 0)$\n\n假设基因之间相互独立，且各样本的测序深度（exposure）相同。为了基于泊松模型定义两个样本之间的不相似性，请按以下步骤进行。对于一个给定的基因$g$和一对样本$(i,j)$，其观测计数为$x_{gi}$和$x_{gj}$，考虑泊松概率质量函数和偏差（deviance）的定义，即饱和模型下的最大对数似然与约束模型（其中两个泊松均值相等，即$\\lambda_{gi}=\\lambda_{gj}=\\mu_g$）下的最大对数似然之差的两倍。从这些基本定义出发，推导每个基因对偏差的贡献，并由此推导出两个样本之间基于偏差的总不相似性，即所有基因贡献的总和。使用自然对数，并采纳约定$0 \\ln(0/\\mu_g)=0$以及当$x_{gi}=x_{gj}=0$时基因对偏差的贡献为$0$。不要引入任何额外的伪计数。\n\n使用你推导出的表达式，计算三对样本$(A,B)$、$(A,C)$和$(B,C)$之间基于偏差的成对不相似性，然后计算这三个成对不相似性的平均值。将最终的平均值四舍五入至四位有效数字。最终结果不带单位。\n\n根据你的推导，简要说明为什么这种基于偏差的不相似性比原始计数上的欧几里得距离更能稳健地处理计数数据固有的均值-方差关系。",
            "solution": "### 基于偏差的不相似性的推导\n\n让我们考虑单个基因 $g$ 和一对样本 $(i, j)$，其观测计数为 $x_{gi}$ 和 $x_{gj}$。对于一个观测值 $x$ 和均值参数 $\\lambda$，泊松概率质量函数为 $P(x; \\lambda) = \\frac{\\exp(-\\lambda)\\lambda^x}{x!}$。对数似然函数为 $\\ell(\\lambda; x) = \\ln(P(x; \\lambda)) = x \\ln(\\lambda) - \\lambda - \\ln(x!)$。\n\n**1. 饱和模型的对数似然：**\n在饱和模型中，每个观测值都有其自身的参数。对于一对观测值 $(x_{gi}, x_{gj})$，参数为 $\\lambda_{gi}$ 和 $\\lambda_{gj}$。由于独立性假设，总对数似然是各个对数似然之和：\n$$L_{sat}(\\lambda_{gi}, \\lambda_{gj}) = \\ell(\\lambda_{gi}; x_{gi}) + \\ell(\\lambda_{gj}; x_{gj}) = (x_{gi} \\ln \\lambda_{gi} - \\lambda_{gi} - \\ln(x_{gi}!)) + (x_{gj} \\ln \\lambda_{gj} - \\lambda_{gj} - \\ln(x_{gj}!))$$\n参数的最大似然估计 (MLEs) 通过将偏导数设为零求得：\n$\\frac{\\partial L_{sat}}{\\partial \\lambda_{gi}} = \\frac{x_{gi}}{\\lambda_{gi}} - 1 = 0 \\implies \\hat{\\lambda}_{gi}^{\\text{sat}} = x_{gi}$\n$\\frac{\\partial L_{sat}}{\\partial \\lambda_{gj}} = \\frac{x_{gj}}{\\lambda_{gj}} - 1 = 0 \\implies \\hat{\\lambda}_{gj}^{\\text{sat}} = x_{gj}$\n将这些最大似然估计值代回，得到饱和模型的最大化对数似然 $\\ell_{sat}$：\n$$\\ell_{sat} = (x_{gi} \\ln x_{gi} - x_{gi} - \\ln(x_{gi}!)) + (x_{gj} \\ln x_{gj} - x_{gj} - \\ln(x_{gj}!))$$\n这里我们使用约定，当 $x=0$ 时，$x \\ln x = 0$。\n\n**2. 约束模型的对数似然：**\n在约束模型中，我们施加原假设，即均值相等：$\\lambda_{gi} = \\lambda_{gj} = \\mu_g$。对数似然函数为：\n$$L_{con}(\\mu_g) = (x_{gi} \\ln \\mu_g - \\mu_g - \\ln(x_{gi}!)) + (x_{gj} \\ln \\mu_g - \\mu_g - \\ln(x_{gj}!))$$\n$$L_{con}(\\mu_g) = (x_{gi} + x_{gj}) \\ln \\mu_g - 2\\mu_g - \\ln(x_{gi}!) - \\ln(x_{gj}!)$$\n$\\mu_g$ 的最大似然估计为：\n$\\frac{\\partial L_{con}}{\\partial \\mu_g} = \\frac{x_{gi} + x_{gj}}{\\mu_g} - 2 = 0 \\implies \\hat{\\mu}_g = \\frac{x_{gi} + x_{gj}}{2}$\n将其代回，得到约束模型的最大化对数似然 $\\ell_{con}$：\n$$\\ell_{con} = (x_{gi} + x_{gj}) \\ln\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) - 2\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) - \\ln(x_{gi}!) - \\ln(x_{gj}!)$$\n$$\\ell_{con} = (x_{gi} + x_{gj}) \\ln\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) - (x_{gi} + x_{gj}) - \\ln(x_{gi}!) - \\ln(x_{gj}!)$$\n\n**3. 每个基因的偏差贡献：**\n基因 $g$ 的偏差贡献，记为 $d_g(i,j)$，是最大化对数似然之差的两倍：\n$$d_g(i,j) = 2 (\\ell_{sat} - \\ell_{con})$$\n$$d_g(i,j) = 2 \\left[ (x_{gi} \\ln x_{gi} - x_{gi} + x_{gj} \\ln x_{gj} - x_{gj}) - \\left( (x_{gi} + x_{gj}) \\ln\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) - (x_{gi} + x_{gj}) \\right) \\right]$$\n包含 $-x_{gi}$ 和 $-x_{gj}$ 的项相互抵消：\n$$d_g(i,j) = 2 \\left[ x_{gi} \\ln x_{gi} + x_{gj} \\ln x_{gj} - (x_{gi} + x_{gj}) \\ln\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) \\right]$$\n使用对数性质重新整理各项：\n$$d_g(i,j) = 2 \\left[ x_{gi} \\ln\\left(\\frac{x_{gi}}{(x_{gi} + x_{gj})/2}\\right) + x_{gj} \\ln\\left(\\frac{x_{gj}}{(x_{gi} + x_{gj})/2}\\right) \\right]$$\n这是每个基因偏差贡献的通用公式。如果 $x_{gi} = x_{gj} = 0$，则表达式为 $0$。如果其中一个计数为零（例如，$x_{gi}=0, x_{gj}>0$），设 $\\mu_g = x_{gj}/2$。根据约定 $0 \\ln(0/\\mu_g)=0$，第一项的贡献为 $0$。总贡献为 $d_g(i,j) = 2 \\left[ x_{gj} \\ln\\left(\\frac{x_{gj}}{x_{gj}/2}\\right) \\right] = 2 x_{gj} \\ln(2)$。\n\n### 成对不相似性的计算\n总不相似性 $D_{ij}$ 是每个基因偏差贡献的总和：$D_{ij} = \\sum_{g=1}^{4} d_g(i, j)$。\n数据：$A=(0, 3, 12, 0)$，$B=(1, 0, 7, 2)$，$C=(0, 1, 15, 0)$。\n\n**不相似性 $D_{AB}$：**\n- $g_1$: $(x_{g1,A}, x_{g1,B}) = (0, 1)$。$d_1 = 2 \\times 1 \\times \\ln(2) = 2\\ln(2)$。\n- $g_2$: $(x_{g2,A}, x_{g2,B}) = (3, 0)$。$d_2 = 2 \\times 3 \\times \\ln(2) = 6\\ln(2)$。\n- $g_3$: $(x_{g3,A}, x_{g3,B}) = (12, 7)$。均值 $\\hat{\\mu}_{g3} = (12+7)/2 = 9.5$。\n$d_3 = 2 \\left[ 12 \\ln\\left(\\frac{12}{9.5}\\right) + 7 \\ln\\left(\\frac{7}{9.5}\\right) \\right]$。\n- $g_4$: $(x_{g4,A}, x_{g4,B}) = (0, 2)$。$d_4 = 2 \\times 2 \\times \\ln(2) = 4\\ln(2)$。\n$D_{AB} = 2\\ln(2) + 6\\ln(2) + d_3 + 4\\ln(2) = 12\\ln(2) + 2 \\left[ 12 \\ln\\left(\\frac{12}{9.5}\\right) + 7 \\ln\\left(\\frac{7}{9.5}\\right) \\right]$\n$D_{AB} \\approx 12(0.69315) + 2 [12(0.23363) + 7(-0.30538)] = 8.3178 + 2[2.80356 - 2.13766] = 8.3178 + 1.3318 = 9.6496$。\n\n**不相似性 $D_{AC}$：**\n- $g_1$: $(x_{g1,A}, x_{g1,C}) = (0, 0)$。$d_1 = 0$。\n- $g_2$: $(x_{g2,A}, x_{g2,C}) = (3, 1)$。均值 $\\hat{\\mu}_{g2} = (3+1)/2 = 2$。\n$d_2 = 2 \\left[ 3 \\ln\\left(\\frac{3}{2}\\right) + 1 \\ln\\left(\\frac{1}{2}\\right) \\right] = 6\\ln(1.5) - 2\\ln(2)$。\n- $g_3$: $(x_{g3,A}, x_{g3,C}) = (12, 15)$。均值 $\\hat{\\mu}_{g3} = (12+15)/2 = 13.5$。\n$d_3 = 2 \\left[ 12 \\ln\\left(\\frac{12}{13.5}\\right) + 15 \\ln\\left(\\frac{15}{13.5}\\right) \\right]$。\n- $g_4$: $(x_{g4,A}, x_{g4,C}) = (0, 0)$。$d_4 = 0$。\n$D_{AC} = d_2 + d_3 = (6\\ln(1.5) - 2\\ln(2)) + 2 \\left[ 12 \\ln\\left(\\frac{12}{13.5}\\right) + 15 \\ln\\left(\\frac{15}{13.5}\\right) \\right]$\n$D_{AC} \\approx (6(0.40547) - 2(0.69315)) + 2 [12(-0.11778) + 15(0.10536)] = (2.43282 - 1.3863) + 2[-1.41336 + 1.5804] = 1.04652 + 0.33408 = 1.3806$。\n\n**不相似性 $D_{BC}$：**\n- $g_1$: $(x_{g1,B}, x_{g1,C}) = (1, 0)$。$d_1 = 2 \\times 1 \\times \\ln(2) = 2\\ln(2)$。\n- $g_2$: $(x_{g2,B}, x_{g2,C}) = (0, 1)$。$d_2 = 2 \\times 1 \\times \\ln(2) = 2\\ln(2)$。\n- $g_3$: $(x_{g3,B}, x_{g3,C}) = (7, 15)$。均值 $\\hat{\\mu}_{g3} = (7+15)/2 = 11$。\n$d_3 = 2 \\left[ 7 \\ln\\left(\\frac{7}{11}\\right) + 15 \\ln\\left(\\frac{15}{11}\\right) \\right]$。\n- $g_4$: $(x_{g4,B}, x_{g4,C}) = (2, 0)$。$d_4 = 2 \\times 2 \\times \\ln(2) = 4\\ln(2)$。\n$D_{BC} = 2\\ln(2) + 2\\ln(2) + d_3 + 4\\ln(2) = 8\\ln(2) + 2 \\left[ 7 \\ln\\left(\\frac{7}{11}\\right) + 15 \\ln\\left(\\frac{15}{11}\\right) \\right]$\n$D_{BC} \\approx 8(0.69315) + 2 [7(-0.45199) + 15(0.31015)] = 5.5452 + 2[-3.16393 + 4.65225] = 5.5452 + 2.97664 = 8.5218$。\n\n### 最终平均值计算\n三个成对不相似性分别为 $D_{AB} \\approx 9.6496$，$D_{AC} \\approx 1.3806$ 和 $D_{BC} \\approx 8.5218$。\n平均不相似性为：\n$$\\text{Average} = \\frac{D_{AB} + D_{AC} + D_{BC}}{3} = \\frac{9.6496 + 1.3806 + 8.5218}{3} = \\frac{19.5520}{3} \\approx 6.51733...$$\n四舍五入到四位有效数字，平均值为 $6.517$。\n\n### 稳健性说明\n出于基本的统计学原因，基于偏差的不相似性比欧几里得距离更能稳健地处理计数数据的均值-方差关系。\n1.  **基于模型的基础**：偏差直接从泊松模型的对数似然推导而来。这意味着它内在地考虑了泊松分布数据的统计特性，最显著的是方差等于均值的性质（$\\text{Var}(X) = \\text{E}[X] = \\lambda$）。\n2.  **方差稳定化**：欧几里得距离对计数的原始大小很敏感。计数从$10$到$15$的差值$5$与从$100$到$105$的差值$5$对平方距离的贡献相同。然而，在泊松框架下，均值为$100$时的方差远大于均值为$10$时的方差。因此，对于较大的计数，差值$5$的重要性较低。偏差公式包含形如 $x \\ln(x/\\mu)$ 的项，它在相对于均值的对数尺度上评估差异。这种变换有效地稳定了方差，为整个表达水平范围内的差异赋予了更合适的权重。它正确地评估了从$0$到$3$的变化（如样本 A 与 B 的基因 $g_2$）比从$7$到$12$的变化（如基因 $g_3$）更能作为差异的显著证据，这一点反映在它们各自的偏差贡献中（$6\\ln(2) \\approx 4.16$ vs. $\\approx 1.33$），而这与从平方欧几里得距离得出的结论（$3^2=9$ vs. $5^2=25$）恰恰相反。\n3.  **证据的度量**：偏差本质上是一个统计检验量（与似然比检验相关），它量化了反对原假设（即对于给定基因，两个样本具有相同的平均表达水平）的证据强度。欧几里得距离是一个纯粹的几何度量，缺乏这种统计解释，因此对潜在的数据生成过程是“盲目”的。\n\n总之，基于偏差的不相似性提供了一种有统计学原理支持的距离度量，能够恰当地处理计数数据固有的异方差性（非恒定方差）。",
            "answer": "$$\n\\boxed{6.517}\n$$"
        },
        {
            "introduction": "许多聚类分析的最后一步是评估结果或将其与另一种分组方案进行比较。本练习介绍了调整兰德指数 (Adjusted Rand Index, ARI)，这是一个量化两个分区之间一致性的强大工具。通过第一性原理的推导和计算，您将理解 ARI 如何校正偶然一致性，从而提供一个更可靠的相似性度量。",
            "id": "4900171",
            "problem": "一个生物统计学团队正在评估从相同的 $n$ 名患者的转录组学和蛋白质组学图谱中获得的两种患者亚型无监督聚类之间的一致性。设划分 $\\mathcal{U}$ 有 $r$ 个簇，划分 $\\mathcal{V}$ 有 $s$ 个簇。对于每一对 $(i,j)$，设 $n_{ij}$ 表示同时处于 $\\mathcal{U}$ 的簇 $i$ 和 $\\mathcal{V}$ 的簇 $j$ 中的患者数量。设行和为 $a_{i}=\\sum_{j=1}^{s} n_{ij}$，列和为 $b_{j}=\\sum_{i=1}^{r} n_{ij}$，因此 $\\sum_{i=1}^{r} a_{i}=\\sum_{j=1}^{s} b_{j}=n$。该生物统计学团队使用调整兰德指数 (Adjusted Rand Index, ARI) 来比较 $\\mathcal{U}$ 和 $\\mathcal{V}$。ARI的定义是通过调整兰德指数 (Rand Index, RI) 以校正随机一致性，而RI是两个划分达成一致的患者对所占的比例。该调整是相对于一个保持 $\\{a_{i}\\}$ 和 $\\{b_{j}\\}$ 不变的广义超几何模型。\n\n从兰德指数作为一致对比例的定义出发，仅使用关于患者对的基本组合推理，完成以下任务：\n\n1) 用 $\\{n_{ij}\\}$、$\\{a_{i}\\}$、$\\{b_{j}\\}$ 和 $\\binom{\\cdot}{2}$ 表示调整兰德指数，推导出一个闭式表达式，且不引入除上述定义之外的任何新定义。\n\n2) 在保持 $\\{a_{i}\\}$ 和 $\\{b_{j}\\}$ 不变的广义超几何随机标记模型下，使用第一性原理计算未调整的一致对计数的期望值，并解释为何在此模型下调整兰德指数的期望值为 $0$。\n\n3) 考虑 $n=12$ 名标记为 $\\{1,2,3,4,5,6,7,8,9,10,11,12\\}$ 的患者。转录组学聚类 $\\mathcal{U}$ 有 $r=3$ 个亚型：\n- $U_1=\\{1,2,3,4,5\\}$，\n- $U_2=\\{6,7,8,9\\}$，\n- $U_3=\\{10,11,12\\}$。\n\n蛋白质组学聚类 $\\mathcal{V}$ 有 $s=3$ 个亚型：\n- $V_1=\\{1,2,6,7\\}$，\n- $V_2=\\{3,4,8,9,10\\}$，\n- $V_3=\\{5,11,12\\}$。\n\n计算 $\\mathcal{U}$ 和 $\\mathcal{V}$ 之间的调整兰德指数。将答案四舍五入到四位有效数字。无需单位。",
            "solution": "### 解答\n\n解答分为所要求的三个任务。\n\n#### 1) 调整兰德指数 (ARI) 的推导\n\n患者的不同配对总数为 $\\binom{n}{2}$。兰德指数 (RI) 是这些配对中“一致”的配对所占的比例。一致对是指一对患者，他们在两个划分中或者被分在同一个簇中，或者被分在不同的簇中。我们可以根据列联表 $(n_{ij})$ 将所有配对分为四种类型：\n1.  在 $\\mathcal{U}$ 中和在 $\\mathcal{V}$ 中都处于同一簇的配对。这类配对的数量是 $N_{11} = \\sum_{i=1}^{r} \\sum_{j=1}^{s} \\binom{n_{ij}}{2}$。\n2.  在 $\\mathcal{U}$ 中处于同一簇但在 $\\mathcal{V}$ 中处于不同簇的配对。这类配对的数量是 $N_{10}$。\n3.  在 $\\mathcal{U}$ 中处于不同簇但在 $\\mathcal{V}$ 中处于同一簇的配对。这类配对的数量是 $N_{01}$。\n4.  在 $\\mathcal{U}$ 和 $\\mathcal{V}$ 中都处于不同簇的配对。这类配对的数量是 $N_{00}$。\n\n在 $\\mathcal{U}$ 中处于同一簇的总配对数是 $S_U = \\sum_{i=1}^{r} \\binom{a_i}{2}$。在 $\\mathcal{V}$ 中处于同一簇的总配对数是 $S_V = \\sum_{j=1}^{s} \\binom{b_j}{2}$。\n由此，我们可以表示 $N_{10}$ 和 $N_{01}$：\n$N_{10} = S_U - N_{11} = \\sum_{i=1}^{r} \\binom{a_i}{2} - \\sum_{i=1}^{r} \\sum_{j=1}^{s} \\binom{n_{ij}}{2}$\n$N_{01} = S_V - N_{11} = \\sum_{j=1}^{s} \\binom{b_j}{2} - \\sum_{i=1}^{r} \\sum_{j=1}^{s} \\binom{n_{ij}}{2}$\n\n总配对数是 $\\binom{n}{2} = N_{11} + N_{10} + N_{01} + N_{00}$。\n一致对的数量是 $A = N_{11} + N_{00}$。我们可以通过减法求得 $N_{00}$：\n$N_{00} = \\binom{n}{2} - N_{11} - N_{10} - N_{01} = \\binom{n}{2} - N_{11} - (S_U - N_{11}) - (S_V - N_{11}) = \\binom{n}{2} - S_U - S_V + N_{11}$。\n所以，一致对的总数是：\n$A = N_{11} + N_{00} = N_{11} + \\left( \\binom{n}{2} - S_U - S_V + N_{11} \\right) = \\binom{n}{2} - S_U - S_V + 2N_{11}$。\n兰德指数是 $RI = A / \\binom{n}{2}$。\n\n调整兰德指数的形式定义为 $\\text{ARI} = \\frac{\\text{指数} - E[\\text{指数}]}{\\text{最大指数} - E[\\text{指数}]}$。“指数”的一个常用选择是 $N_{11} = \\sum_{i,j}\\binom{n_{ij}}{2}$，即在两个划分中都处于同一簇的配对数量。\n在广义超几何模型下，给定固定的边际计数 $\\{a_i\\}$ 和 $\\{b_j\\}$，划分 $\\mathcal{U}$ 和 $\\mathcal{V}$ 被假定为独立的。随机选择的一对患者在 $\\mathcal{U}$ 中处于同一簇的概率是 $p_U = S_U / \\binom{n}{2}$。随机一对在 $\\mathcal{V}$ 中处于同一簇的概率是 $p_V = S_V / \\binom{n}{2}$。由于独立性，随机一对在两者中都处于同一簇的概率是 $p_U p_V$。\n这类配对的期望数量 $E[N_{11}]$ 是总配对数乘以这个概率：\n$E[N_{11}] = \\binom{n}{2} \\times p_U \\times p_V = \\binom{n}{2} \\frac{S_U}{\\binom{n}{2}} \\frac{S_V}{\\binom{n}{2}} = \\frac{S_U S_V}{\\binom{n}{2}}$。\n$E\\left[\\sum_{i,j}\\binom{n_{ij}}{2}\\right] = \\frac{\\left(\\sum_i\\binom{a_i}{2}\\right) \\left(\\sum_j\\binom{b_j}{2}\\right)}{\\binom{n}{2}}$。\n\n“最大指数”是指数可能的最大值，出现在最大一致性的情况下。这取决于边际量 $\\{a_i\\}$ 和 $\\{b_j\\}$。该值不是唯一的，但 $\\frac{1}{2}(S_U + S_V)$ 被用作一个代表值，如果一个划分是另一个划分的细化，这是 $N_{11}$ 可能的最大值的平均值。\n因此，ARI 是：\n$$ \\text{ARI} = \\frac{N_{11} - E[N_{11}]}{\\frac{1}{2}(S_U + S_V) - E[N_{11}]} $$\n代入 $N_{11}$、$S_U$、$S_V$ 和 $E[N_{11}]$ 的表达式，得到闭式表达式：\n$$ \\text{ARI} = \\frac{\\sum_{i,j}\\binom{n_{ij}}{2} - \\frac{\\left(\\sum_i\\binom{a_i}{2}\\right) \\left(\\sum_j\\binom{b_j}{2}\\right)}{\\binom{n}{2}}}{\\frac{1}{2}\\left(\\sum_i\\binom{a_i}{2} + \\sum_j\\binom{b_j}{2}\\right) - \\frac{\\left(\\sum_i\\binom{a_i}{2}\\right) \\left(\\sum_j\\binom{b_j}{2}\\right)}{\\binom{n}{2}}} $$\n\n#### 2) 一致对计数和 ARI 的期望值\n\n未调整的一致对计数为 $A = \\binom{n}{2} - S_U - S_V + 2N_{11}$。\n在随机标记模型下，边际量以及因此的 $S_U$ 和 $S_V$ 是固定的。我们必须求 $A$ 的期望。利用期望的线性性质：\n$E[A] = E\\left[ \\binom{n}{2} - S_U - S_V + 2N_{11} \\right] = \\binom{n}{2} - S_U - S_V + 2E[N_{11}]$。\n代入之前的结果：\n$E[A] = \\binom{n}{2} - \\sum_i\\binom{a_i}{2} - \\sum_j\\binom{b_j}{2} + 2\\frac{\\left(\\sum_i\\binom{a_i}{2}\\right) \\left(\\sum_j\\binom{b_j}{2}\\right)}{\\binom{n}{2}}$。\n\n调整兰德指数的构造使其在零模型下的期望值为 $0$。设指数为一个随机变量 $X = N_{11} = \\sum_{i,j}\\binom{n_{ij}}{2}$。ARI 公式的分母 $D = \\frac{1}{2}(S_U + S_V) - E[X]$ 是一个常数，因为边际量是固定的。ARI 是随机变量 $Y = \\frac{X - E[X]}{D}$。\n为了求其期望：\n$E[\\text{ARI}] = E[Y] = E\\left[ \\frac{X - E[X]}{D} \\right]$。\n由于 $D$ 和 $E[X]$ 是常数，我们可以写出：\n$E[\\text{ARI}] = \\frac{1}{D} E[X - E[X]] = \\frac{1}{D} (E[X] - E[E[X]])$。\n一个常数的期望是它本身，所以 $E[E[X]] = E[X]$。\n因此，$E[\\text{ARI}] = \\frac{1}{D} (E[X] - E[X]) = 0$。\n调整过程从分子中的观测值减去指数的期望值，根据构造，这使得分子（以及整个指数）的分布在零假设下以 $0$ 为中心。\n\n#### 3) 具体案例的计算\n\n给定 $n=12$。\n划分为：\n$\\mathcal{U}: U_1=\\{1,2,3,4,5\\}$, $U_2=\\{6,7,8,9\\}$, $U_3=\\{10,11,12\\}$。\n簇的大小为 $a_1=5, a_2=4, a_3=3$。\n$\\mathcal{V}: V_1=\\{1,2,6,7\\}$, $V_2=\\{3,4,8,9,10\\}$, $V_3=\\{5,11,12\\}$。\n簇的大小为 $b_1=4, b_2=5, b_3=3$。\n\n首先，我们构建计数 $n_{ij} = |U_i \\cap V_j|$ 的列联表：\n$n_{11} = |U_1 \\cap V_1| = |\\{1,2\\}| = 2$\n$n_{12} = |U_1 \\cap V_2| = |\\{3,4\\}| = 2$\n$n_{13} = |U_1 \\cap V_3| = |\\{5\\}| = 1$\n$n_{21} = |U_2 \\cap V_1| = |\\{6,7\\}| = 2$\n$n_{22} = |U_2 \\cap V_2| = |\\{8,9\\}| = 2$\n$n_{23} = |U_2 \\cap V_3| = |\\emptyset| = 0$\n$n_{31} = |U_3 \\cap V_1| = |\\emptyset| = 0$\n$n_{32} = |U_3 \\cap V_2| = |\\{10\\}| = 1$\n$n_{33} = |U_3 \\cap V_3| = |\\{11,12\\}| = 2$\n列联表为：\n$$(n_{ij}) = \\begin{pmatrix} 2  2  1 \\\\ 2  2  0 \\\\ 0  1  2 \\end{pmatrix}$$\n\n现在我们计算 ARI 公式的各项：\n1.  指数：$N_{11} = \\sum_{i,j}\\binom{n_{ij}}{2} = \\binom{2}{2}+\\binom{2}{2}+\\binom{1}{2}+\\binom{2}{2}+\\binom{2}{2}+\\binom{0}{2}+\\binom{0}{2}+\\binom{1}{2}+\\binom{2}{2}$\n    $N_{11} = 1 + 1 + 0 + 1 + 1 + 0 + 0 + 0 + 1 = 5$。\n2.  $\\mathcal{U}$ 的配对总和：$S_U = \\sum_i\\binom{a_i}{2} = \\binom{5}{2} + \\binom{4}{2} + \\binom{3}{2} = 10 + 6 + 3 = 19$。\n3.  $\\mathcal{V}$ 的配对总和：$S_V = \\sum_j\\binom{b_j}{2} = \\binom{4}{2} + \\binom{5}{2} + \\binom{3}{2} = 6 + 10 + 3 = 19$。\n4.  总配对数：$\\binom{n}{2} = \\binom{12}{2} = \\frac{12 \\times 11}{2} = 66$。\n\n现在，我们计算 ARI 公式的各个组成部分：\n-   期望指数：$E[N_{11}] = \\frac{S_U S_V}{\\binom{n}{2}} = \\frac{19 \\times 19}{66} = \\frac{361}{66}$。\n-   最大指数项：$\\frac{1}{2}(S_U + S_V) = \\frac{1}{2}(19+19) = 19$。\n\n最后，我们计算 ARI：\n$$ \\text{ARI} = \\frac{N_{11} - E[N_{11}]}{\\frac{1}{2}(S_U + S_V) - E[N_{11}]} = \\frac{5 - \\frac{361}{66}}{19 - \\frac{361}{66}} $$\n$$ \\text{ARI} = \\frac{\\frac{5 \\times 66 - 361}{66}}{\\frac{19 \\times 66 - 361}{66}} = \\frac{330 - 361}{1254 - 361} = \\frac{-31}{893} $$\n换算成小数，结果是 $\\frac{-31}{893} \\approx -0.0347144456...$。\n四舍五入到四位有效数字得到 $-0.03471$。",
            "answer": "$$ \\boxed{-0.03471} $$"
        }
    ]
}