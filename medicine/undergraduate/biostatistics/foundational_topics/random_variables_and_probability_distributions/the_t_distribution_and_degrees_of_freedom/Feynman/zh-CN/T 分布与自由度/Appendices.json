{
    "hands_on_practices": [
        {
            "introduction": "我们从一个思想实验开始：如果只有一个数据点，我们能做什么？这个练习探讨了t分布的基本局限性，并强调了自由度的不可或缺的作用。通过检验样本量 $n=1$ 的边缘情况，我们将更深刻地理解为什么在方差未知时，估计变异性是推断总体均值的先决条件。",
            "id": "4902390",
            "problem": "一项罕见病领域的临床研究从目标人群中获得了一个连续生物标志物的独立同分布观测值。设该单个观测值为 $X_{1}$，并假设总体分布为正态分布，其均值为 $\\mu$，方差 $\\sigma^{2}$ 未知。研究者要求仅基于 $X_{1}$ 和所述的模型假设，为 $\\mu$ 构建一个 95% 的频率派置信区间，并考虑如果这样的区间不合理，可以采取什么措施。仅利用正态样本的基本分布性质和基本样本统计量的定义，判断下列关于这一极端情况及可行解决方案的陈述中，哪些是正确的。\n\n选择所有适用项。\n\nA. 仅基于单个观测值的标准学生 $t$ 区间是有效的，因为可以使用自由度 $\\nu = n - 1 = 0$ 和一个有限的临界值。\n\nB. 在没有关于 $\\sigma^{2}$ 的任何额外信息的情况下，当 $n=1$ 时，不存在 $\\mu$ 的有限长度的频率派置信区间，因为均值的抽样变异性无法仅从 $X_{1}$ 估计。\n\nC. 从单个观测值进行的非参数自助法（bootstrap）可以提供 $\\sigma$ 的一个相合估计，因此能够构建 $\\mu$ 的大样本 Wald 置信区间。\n\nD. 采用一个对 $(\\mu,\\sigma^{2})$ 具有正常先验（proper prior）的贝叶斯模型（例如，正态-逆伽马先验），会得到 $\\mu$ 的一个学生 $t$ 后验分布，从而可以构建一个 95% 的可信区间；其频率派覆盖率取决于先验的选择。\n\nE. 如果有一个来自同一总体的、大小为 $m \\ge 2$ 的独立外部样本可用于估计 $\\sigma^{2}$，那么在正态性和独立性的假设下，$(X_{1}-\\mu)/S_{\\text{ext}}$ 服从自由度为 $\\nu = m - 1$ 的学生 $t$ 分布，从而可以为 $\\mu$ 构建一个有效的频率派置信区间。",
            "solution": "该问题陈述是数理统计学中一个有效且定义明确的问题，特别涉及置信区间的基本原理。它探讨了一个关键的极端案例（$n=1$），这个案例突出了方差估计的至关重要的作用。\n\n问题的核心在于，当方差 $\\sigma^2$ 未知且样本量为 $n=1$ 时，如何为正态分布 $N(\\mu, \\sigma^2)$ 的总体均值 $\\mu$ 构建一个频率派置信区间。\n\n设单个观测值为 $X_1$。\n样本均值是 $\\mu$ 的最佳估计量，即 $\\bar{X} = X_1$。\n在 $\\sigma^2$ 未知的情况下，构建 $\\mu$ 的置信区间的标准方法依赖于学生 $t$ 分布。枢轴量为：\n$$ T = \\frac{\\bar{X} - \\mu}{S/\\sqrt{n}} $$\n其中 $S^2$ 是无偏样本方差：\n$$ S^2 = \\frac{1}{n-1} \\sum_{i=1}^{n} (X_i - \\bar{X})^2 $$\n对于大小为 $n=1$ 的样本，我们有 $\\bar{X} = X_1$。样本方差变为：\n$$ S^2 = \\frac{1}{1-1} (X_1 - X_1)^2 = \\frac{0}{0} $$\n样本方差是不确定的。因此，样本标准差 $S$ 也未定义。仅凭样本数据无法计算 $t$ 统计量。这种从单个数据点无法估计总体方差 $\\sigma^2$ 的根本性问题是这里的核心所在。\n\n现在，我们来评估每个陈述。\n\n**A. 仅基于单个观测值的标准学生 $t$ 区间是有效的，因为可以使用自由度 $\\nu = n - 1 = 0$ 和一个有限的临界值。**\n\n这个陈述是 **不正确** 的。\n样本方差 $S^2$ 的公式涉及除以 $n-1$。对于 $n=1$，这是除以 $0$，使得 $S^2$ 及其平方根 $S$ 未定义。$t$ 统计量 $T = (X_1 - \\mu)/S$ 无法被构建。\n此外，$t$ 分布的自由度为 $\\nu = n-1 = 1-1 = 0$。自由度 $\\nu > 0$ 的学生 $t$ 分布具有有限的分位数 $t_{\\alpha/2, \\nu}$。然而，当 $\\nu \\to 0^+$ 时，分布的尾部变得无限重，对于任何 $\\alpha \\in (0, 1)$，分位数 $t_{\\alpha/2, \\nu}$ 都发散到无穷大。因此，自由度为 0 的 $t$ 分布不存在*有限的*临界值。置信区间的形式为 $X_1 \\pm t_{\\alpha/2, 0} S$，这不仅基于一个未定义的 $S$，而且其宽度也将是无限的，对应于无信息的区间 $(-\\infty, \\infty)$。\n\n**B. 在没有关于 $\\sigma^{2}$ 的任何额外信息的情况下，当 $n=1$ 时，不存在 $\\mu$ 的有限长度的频率派置信区间，因为均值的抽样变异性无法仅从 $X_{1}$ 估计。**\n\n这个陈述是 **正确** 的。\n$\\mu$ 的频率派置信区间的宽度必须能反映估计量 $\\bar{X}=X_1$ 的不确定性。这种不确定性由均值的标准误决定，当 $n=1$ 时，标准误为 $\\sigma/\\sqrt{1} = \\sigma$。要构建一个区间，我们必须使用一个其分布已知且不含未知参数的枢轴量。\n量 $Z = (X_1 - \\mu)/\\sigma$ 服从 $N(0,1)$ 分布，但它不能被用来构建置信区间，因为它含有未知参数 $\\sigma$。\n为了消除 $\\sigma$，我们必须用一个估计值来代替它。如前所述，样本方差 $S^2$ 无法从单个观测值计算得出。单个数据点 $X_1$ 中没有任何信息可以用来估计总体的尺度或变异性 $\\sigma^2$。$\\sigma$ 的任何正值都与观测值 $X_1$ 同样兼容。由于任何 $\\mu$ 的置信区间的长度都必须与某个尺度度量成正比，而尺度又无法估计，因此无法构建任何有信息的、有限长度的置信区间。该陈述正确地指出了抽样变异性 $\\text{Var}(X_1) = \\sigma^2$ 无法仅从 $X_1$ 估计，而这正是造成这种不可能性的确切原因。\n\n**C. 从单个观测值进行的非参数自助法（bootstrap）可以提供 $\\sigma$ 的一个相合估计，因此能够构建 $\\mu$ 的大样本 Wald 置信区间。**\n\n这个陈述是 **不正确** 的。\n非参数自助法（bootstrap）程序涉及从观测样本中有放回地进行重抽样。在这种情况下，样本是 $\\{X_1\\}$。从这个集合中抽取的任何大小为 $n=1$ 的自助样本都将是 $\\{X_1\\}$。事实上，任何大小为 $m$ 的自助样本都将是 $\\{X_1, X_1, \\dots, X_1\\}$。\n每个这样的自助样本的均值总是 $X_1$。因此，自助样本均值的方差为 0。样本均值标准误的自助法估计为 0。\n同样，任何自助样本的样本方差为 $\\frac{1}{m-1}\\sum_{i=1}^m(X_1 - X_1)^2 = 0$。因此，$\\sigma$ 的自助法估计为 0。这不是一个相合或合理的 $\\sigma$ 估计。一个形如 $\\hat{\\mu} \\pm z_{\\alpha/2}\\widehat{\\text{SE}}(\\hat{\\mu})$ 的 Wald 置信区间会坍缩为一个点 $[X_1, X_1]$，其包含 $\\mu$ 的概率为 0%（除非 $\\sigma=0$，而这对于连续变量是不可能的）。在这种情况下，自助法完全失效。\n\n**D. 采用一个对 $(\\mu,\\sigma^{2})$ 具有正常先验（proper prior）的贝叶斯模型（例如，正态-逆伽马先验），会得到 $\\mu$ 的一个学生 $t$ 后验分布，从而可以构建一个 95% 的可信区间；其频率派覆盖率取决于先验的选择。**\n\n这个陈述是 **正确** 的。\n频率派的僵局可以通过切换到贝叶斯框架来解决。在这种范式中，我们通过一个先验分布 $p(\\mu, \\sigma^2)$ 来提供关于未知参数 $(\\mu, \\sigma^2)$ 的先验信息。正态-逆伽马分布是正态分布均值和方差的共轭先验。\n当我们将这个先验与来自单个观测值的似然函数 $L(\\mu, \\sigma^2 | X_1)$ 结合时，我们得到一个后验分布 $p(\\mu, \\sigma^2 | X_1)$。通过对讨厌参数 $\\sigma^2$ 进行积分，我们可以求得 $\\mu$ 的边际后验分布 $p(\\mu|X_1)$。对于标准的共轭先验，这个边际后验是一个非标准化的学生 $t$ 分布。\n从这个后验分布中，当然可以计算出 $\\mu$ 的一个 95% 可信区间。这个区间的中心和宽度将取决于单个数据点 $X_1$ 和所选先验的超参数。由于 $n=1$，先验对后验分布有非常强的影响。\n最后的子句指出，该区间的频率派覆盖率取决于先验的选择。这也是正确的。一个贝叶斯可信区间不保证具有名义上的频率派覆盖率。贝叶斯过程的频率派覆盖率是一个在重复抽样下评估的属性，它通常取决于真实参数值和先验的选择。对于 $n=1$ 的情况，这种依赖性是极端的。因此，该陈述准确地描述了一个可行的解决方案及其性质。\n\n**E. 如果有一个来自同一总体的、大小为 $m \\ge 2$ 的独立外部样本可用于估计 $\\sigma^{2}$，那么在正态性和独立性的假设下，$(X_{1}-\\mu)/S_{\\text{ext}}$ 服从自由度为 $\\nu = m - 1$ 的学生 $t$ 分布，从而可以为 $\\mu$ 构建一个有效的频率派置信区间。**\n\n这个陈述是 **正确** 的。\n这提出了另一种克服缺少内部方差估计的有效方法：使用一个外部估计。设外部样本为来自具有相同方差 $\\sigma^2$ 的总体的 $Y_1, \\dots, Y_m$。外部样本方差为 $S_{\\text{ext}}^2 = \\frac{1}{m-1} \\sum_{i=1}^m (Y_i - \\bar{Y})^2$。这需要 $m \\ge 2$ 才能定义 $S_{\\text{ext}}^2$。\n我们依据学生 $t$ 分布的定义。如果一个随机变量 $T$ 可以写成 $T = \\frac{Z}{\\sqrt{U/\\nu}}$ 的形式，其中 $Z \\sim N(0,1)$ 和 $U \\sim \\chi_{\\nu}^2$ 是独立的，那么该随机变量 $T$ 就服从自由度为 $\\nu$ 的 $t$ 分布。\n让我们定义我们的组成部分：\n1.  由于 $X_1 \\sim N(\\mu, \\sigma^2)$，标准化变量 $Z = \\frac{X_1 - \\mu}{\\sigma}$ 服从标准正态分布 $N(0,1)$。\n2.  根据标准抽样理论，量 $U = \\frac{(m-1)S_{\\text{ext}}^2}{\\sigma^2}$ 服从自由度为 $\\nu = m-1$ 的卡方分布。\n3.  问题陈述说明外部样本与观测值 $X_1$ 独立。因此，$Z$ 和 $U$ 是独立的随机变量。\n现在，构建比率：\n$$ T = \\frac{Z}{\\sqrt{U/\\nu}} = \\frac{\\frac{X_1 - \\mu}{\\sigma}}{\\sqrt{\\frac{(m-1)S_{\\text{ext}}^2/\\sigma^2}{m-1}}} = \\frac{\\frac{X_1 - \\mu}{\\sigma}}{\\sqrt{S_{\\text{ext}}^2/\\sigma^2}} = \\frac{X_1 - \\mu}{S_{\\text{ext}}} $$\n这表明量 $(X_1 - \\mu)/S_{\\text{ext}}$ 确实服从自由度为 $\\nu=m-1$ 的学生 $t$ 分布。这是一个枢轴量，因为它的分布是已知的，并且可以从数据（给定 $S_{\\text{ext}}$）和参数 $\\mu$ 计算得出。这允许构建一个有效的频率派置信区间：$X_1 \\pm t_{\\alpha/2, m-1} S_{\\text{ext}}$。",
            "answer": "$$\\boxed{BDE}$$"
        },
        {
            "introduction": "在我们理解了t分布的基本要求之后，现在我们转向一个实际问题：我们需要多少样本？这个问题将引导您推导并求解单样本t检验的样本量方程。这个过程对于设计具有统计功效的研究至关重要，它将功效、效应大小和非中心t分布等抽象概念与现实世界的实验规划直接联系起来。",
            "id": "4960987",
            "problem": "一个临床实验室计划进行一项单样本研究，以确定空腹高敏C反应蛋白（hs-CRP）的平均浓度（记为$\\mu$，单位为$\\mathrm{mg/L}$）是否与标准参考值$\\mu_{0}$不同。个体hs-CRP测量值被假定为独立同分布于$\\mathcal{N}(\\mu,\\sigma^{2})$，其中方差$\\sigma^{2}$未知，并且该研究将使用双侧I型错误率为$\\alpha$的单样本Student's $t$检验。\n\n从第一性原理出发——即单样本$t$统计量$T=\\dfrac{\\bar{X}-\\mu_{0}}{S/\\sqrt{n}}$的定义（其中$\\bar{X}$是样本均值，$S$是样本标准差），以及在$\\mu\\neq\\mu_{0}$条件下，统计量$T$服从自由度为$n-1$、非中心化参数为$\\delta$的非中心$t$分布这一事实——推导为检测大小为$\\Delta=|\\mu-\\mu_{0}|$的真实均值偏移而达到目标功效$1-\\beta$所必须求解的样本量方程。\n\n然后，对于设计值$\\alpha=0.05$（双侧）、期望功效$1-\\beta=0.90$、假定总体标准差$\\sigma=10.0$ $\\mathrm{mg/L}$以及目标差异$\\Delta=4.0$ $\\mathrm{mg/L}$，求解所推导出的功效方程，以获得达到目标功效的最小整数样本量$n$。您可以使用对非中心$t$分布的科学合理的渐近近似来求解$n$，但您的推导必须从精确的非中心$t$分布公式开始。将最终答案表示为最小整数$n$。由于答案是精确整数，因此不需要舍入说明。",
            "solution": "该问题要求推导单样本Student's $t$检验的样本量方程，并随后针对一组特定的设计参数进行求解。\n\n首先，对问题进行验证并确认其有效。该问题在科学上基于标准统计理论，问题陈述清晰，目标明确，并包含一套完整且一致的给定条件。\n\n求解过程分两部分：第一部分，推导通用样本量方程；第二部分，计算指定参数下的最小整数样本量$n$。\n\n**第1部分：样本量方程的推导**\n\n目标是检验原假设$H_0: \\mu = \\mu_0$与双侧备择假设$H_A: \\mu \\neq \\mu_0$。检验统计量是单样本$t$统计量：\n$$T = \\frac{\\bar{X} - \\mu_0}{S/\\sqrt{n}}$$\n其中$\\bar{X}$是样本均值，$S$是样本标准差，$n$是样本量。\n\n在原假设$H_0$下，统计量$T$服从自由度为$\\nu = n-1$的中心Student's $t$分布，记为$t_{n-1}$。对于I型错误率为$\\alpha$的双侧检验，如果$|T| > t_{1-\\alpha/2, n-1}$，则拒绝$H_0$，其中$t_{1-\\alpha/2, n-1}$是中心$t_{n-1}$分布的上$100(1-\\alpha/2)\\%$分位数。\n\n在备择假设$H_A$下，真实均值为$\\mu \\neq \\mu_0$，统计量$T$服从自由度为$\\nu = n-1$、非中心化参数为$\\delta$的非中心$t$分布。非中心化参数$\\delta$由下式给出：\n$$\\delta = \\frac{(\\mu - \\mu_0)}{\\sigma/\\sqrt{n}}$$\n其中$\\sigma$是真实的总体标准差。使用给定的定义$\\Delta = |\\mu - \\mu_0|$，非中心化参数的大小为$|\\delta| = \\frac{\\Delta\\sqrt{n}}{\\sigma}$。\n\n检验的功效$1-\\beta$是在$H_A$为真时正确拒绝$H_0$的概率。令$T_{\\nu, \\delta}$表示服从自由度为$\\nu$、非中心化参数为$\\delta$的非中心$t$分布的随机变量。功效为：\n$$1-\\beta = P(|T_{n-1, \\delta}| > t_{1-\\alpha/2, n-1})$$\n这可以写成两个尾部概率之和：\n$$1-\\beta = P(T_{n-1, \\delta} > t_{1-\\alpha/2, n-1}) + P(T_{n-1, \\delta} < -t_{1-\\alpha/2, n-1})$$\n这是精确的功效方程。不失一般性，我们假设$\\mu > \\mu_0$，这使得$\\delta > 0$。对于正的$\\delta$和典型的功效值（例如，$1-\\beta > 0.5$），第二项$P(T_{n-1, \\delta} < -t_{1-\\alpha/2, n-1})$可以忽略不计。因此，我们可以将功效近似为：\n$$1-\\beta \\approx P(T_{n-1, \\delta} > t_{1-\\alpha/2, n-1})$$\n这等价于说II型错误的概率$\\beta$为：\n$$\\beta \\approx P(T_{n-1, \\delta} \\le t_{1-\\alpha/2, n-1})$$\n为了求解此方程中的$n$，我们使用一个科学上合理的渐近近似。对于大的自由度$\\nu$，非中心$t$分布$t_{\\nu, \\delta}$可以近似为正态分布$\\mathcal{N}(\\delta, 1)$。当$S$成为$\\sigma$的更精确估计量时，这种近似是合理的，这使得$t$统计量的分母趋近于一个常数。应用此近似：\n$$\\beta \\approx P(\\mathcal{N}(\\delta, 1) \\le t_{1-\\alpha/2, n-1})$$\n为了计算这个概率，我们对正态变量进行标准化。令$Z \\sim \\mathcal{N}(0,1)$。\n$$\\beta \\approx P\\left(\\frac{\\mathcal{N}(\\delta, 1) - \\delta}{1} \\le \\frac{t_{1-\\alpha/2, n-1} - \\delta}{1}\\right) = P(Z \\le t_{1-\\alpha/2, n-1} - \\delta)$$\n根据定义，标准正态值$z_{\\beta}$是满足$P(Z \\le z_{\\beta}) = \\beta$的分位数。因此，我们有以下关系：\n$$t_{1-\\alpha/2, n-1} - \\delta \\approx z_{\\beta}$$\n利用标准正态分布的对称性，$z_{\\beta} = -z_{1-\\beta}$。代入得到：\n$$t_{1-\\alpha/2, n-1} - \\delta \\approx -z_{1-\\beta}$$\n整理得到非中心化参数$\\delta$：\n$$\\delta \\approx t_{1-\\alpha/2, n-1} + z_{1-\\beta}$$\n最后，我们代入非中心化参数的大小的表达式，$|\\delta| = \\frac{\\Delta\\sqrt{n}}{\\sigma}$：\n$$\\frac{\\Delta\\sqrt{n}}{\\sigma} \\approx t_{1-\\alpha/2, n-1} + z_{1-\\beta}$$\n这就是所求的样本量方程。这是一个关于$n$的隐式方程，因为$n$出现在方程的两边（在$\\sqrt{n}$中以及在$t$分位数的自由度$n-1$中）。\n\n**第2部分：求解最小样本量**\n\n我们有以下给定的设计值：\n- 双侧I型错误率：$\\alpha = 0.05$。\n- 期望功效：$1-\\beta = 0.90$，这意味着$\\beta = 0.10$。\n- 假定总体标准差：$\\sigma = 10.0 \\, \\mathrm{mg/L}$。\n- 目标检测差异：$\\Delta = 4.0 \\, \\mathrm{mg/L}$。\n\n首先，我们从标准正态分布中找到必要的分位数：\n- 对于显著性水平：$z_{1-\\alpha/2} = z_{1-0.025} = z_{0.975} \\approx 1.95996$。\n- 对于功效：$z_{1-\\beta} = z_{1-0.10} = z_{0.90} \\approx 1.28155$。\n\n比率$\\sigma/\\Delta$为$\\frac{10.0}{4.0} = 2.5$。将这些值代入第1部分推导出的样本量方程中，得到：\n$$\\sqrt{n} \\approx \\frac{\\sigma}{\\Delta} (t_{1-\\alpha/2, n-1} + z_{1-\\beta}) = 2.5 (t_{0.975, n-1} + 1.28155)$$\n两边平方得到需要求解$n$的方程：\n$$n \\approx (2.5)^2 (t_{0.975, n-1} + 1.28155)^2 = 6.25 (t_{0.975, n-1} + 1.28155)^2$$\n这个方程必须迭代求解。我们可以通过用相应的正态分位数$t_{0.975, n-1} \\approx z_{0.975} \\approx 1.95996$来近似$t$分位数，从而得到一个$n$的初始猜测值。\n初始猜测值$n_0$：\n$$n_0 = 6.25 (1.95996 + 1.28155)^2 = 6.25 (3.24151)^2 \\approx 6.25 \\times 10.5074 \\approx 65.67$$\n这表明所需的样本量可能接近$66$。\n\n我们从$n=66$开始迭代。\n迭代1：令$n=66$，则自由度为$\\nu = 65$。所需的$t$分位数为$t_{0.975, 65} \\approx 1.9971$。\n计算$n$的新估计值：\n$$n_1 = 6.25 (1.9971 + 1.28155)^2 = 6.25 (3.27865)^2 \\approx 6.25 \\times 10.7495 \\approx 67.18$$\n由于$n_1 \\approx 67.18 > 66$，我们猜测的$n=66$太小了。\n\n迭代2：我们尝试$n=68$，则$\\nu = 67$。$t$分位数为$t_{0.975, 67} \\approx 1.9960$。\n计算$n$的新估计值：\n$$n_2 = 6.25 (1.9960 + 1.28155)^2 = 6.25 (3.27755)^2 \\approx 6.25 \\times 10.7426 \\approx 67.14$$\n当样本量为$n=68$时，公式表明所需的样本量约为$67.14$。由于$68 > 67.14$，样本量为$68$足以达到期望的功效。\n\n为了确认$n=67$是不够的，我们来检验一下。对于$n=67$，$\\nu=66$，且$t_{0.975, 66} \\approx 1.9966$。\n所需的$n = 6.25(1.9966 + 1.28155)^2 = 6.25 (3.27815)^2 \\approx 67.16$。\n由于$67 < 67.16$，样本量为$67$是不够的。\n\n因此，为了确保功效至少为$0.90$，我们必须将所需的非整数值向上取整到下一个整数。最小整数样本量是$68$。",
            "answer": "$$\n\\boxed{68}\n$$"
        },
        {
            "introduction": "在最后的这个实践中，我们将分析范围扩展到常见的双样本情景，并搭建起理论与计算之间的桥梁。您将使用非中心t分布推导出精确的功效公式，然后通过代码实现它。这项练习不仅巩固了您的理论知识，还提供了一种切实可行的方法，用数值方式验证统计功效随样本量增加而增强这一核心原则。",
            "id": "4939262",
            "problem": "您将仅使用假设检验的基本定义和已有的分布事实，推导并计算具有等方差和等样本量的双样本学生t检验的统计功效。考虑两个来自具有共同方差的正态分布的独立样本，样本量均为 $n$。设组均值分别为 $\\mu_1$ 和 $\\mu_2$，共同标准差为 $\\sigma$。定义标准化效应量 $\\Delta$ 为 $\\Delta = (\\mu_1 - \\mu_2)/\\sigma$。该检验为显著性水平为 $\\alpha$ 的双侧检验，原假设为 $H_0: \\mu_1 - \\mu_2 = 0$，备择假设为 $H_1: \\mu_1 - \\mu_2 \\neq 0$。\n\n任务 A (推导)：从以下基础出发：\n- 统计功效的定义，即在备择假设为真时正确拒绝原假设的概率。\n- 在原假设下，合并方差双样本t统计量的抽样分布是自由度为 $\\nu = 2n - 2$ 的中心学生t分布。\n- 在备择假设（$\\Delta \\neq 0$）下，相同的t统计量服从具有相同自由度 $\\nu = 2n - 2$ 和一个由 $\\Delta$ 与 $n$ 决定的非中心参数 $\\lambda$ 的非中心学生t分布。\n\n推导双侧检验的统计功效的显式表达式，该表达式应使用非中心学生t分布的累积分布函数和由中心学生t分布在水平 $\\alpha$ 下定义的临界值来表示。您的推导必须说明为什么自由度是 $\\nu = 2n - 2$以及非中心参数 $\\lambda$ 如何依赖于 $\\Delta$ 和 $n$。将最终的统计功效表示为函数 $\\text{power}(n,\\Delta,\\alpha)$，并用非中心学生t分布的累积分布函数来表示。\n\n任务 B (计算验证)：实现一个程序，该程序：\n- 使用您推导的表达式计算 $\\text{power}(n,\\Delta,\\alpha)$。\n- 通过前向有限差分近似在固定 $\\Delta$ 下关于 $n$ 的导数\n$$D(n,\\Delta,\\alpha) = \\text{power}(n+1,\\Delta,\\alpha) - \\text{power}(n,\\Delta,\\alpha).$$\n- 对于固定的 $\\Delta > 0$，数值验证 $D(n,\\Delta,\\alpha) > 0$。对于 $\\Delta = 0$，数值验证 $D(n,0,\\alpha)$ 近似为 $0$。\n\n科学与数值要求：\n- 将所有概率视为小数（例如，使用 $\\alpha = 0.05$ 而不是百分比）。\n- 仅使用双侧检验。\n- 使用正值容差 $\\tau_+ = 10^{-10}$ 来判断 $D(n,\\Delta,\\alpha) > 0$（当 $D(n,\\Delta,\\alpha) \\ge \\tau_+$ 时）。使用近零容差 $\\tau_0 = 10^{-8}$ 来判断 $|D(n,0,\\alpha)| \\le \\tau_0$。\n- 所有数学符号和数字都必须以无量纲方式处理。\n\n要实现和评估的测试套件：\n- 情况 1：$(n,\\Delta,\\alpha) = (10, 0.5, 0.05)$，使用容差 $\\tau_+$ 检查 $D(n,\\Delta,\\alpha) > 0$。\n- 情况 2：$(n,\\Delta,\\alpha) = (3, 1.0, 0.05)$，使用容差 $\\tau_+$ 检查 $D(n,\\Delta,\\alpha) > 0$。\n- 情况 3：$(n,\\Delta,\\alpha) = (50, 0.2, 0.01)$，使用容差 $\\tau_+$ 检查 $D(n,\\Delta,\\alpha) > 0$。\n- 情况 4：$(n,\\Delta,\\alpha) = (20, 0.0, 0.05)$，使用容差 $\\tau_0$ 检查 $|D(n,0,\\alpha)| \\le \\tau_0$。\n- 情况 5：$(n,\\Delta,\\alpha) = (150, 0.5, 0.05)$，使用容差 $\\tau_+$ 检查 $D(n,\\Delta,\\alpha) > 0$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，列表中的每个条目都是一个布尔值，指示相应的测试是否通过（例如，$[ \\text{True}, \\text{False}, \\dots ]$）。不要打印任何其他文本。",
            "solution": "在提供解答之前，需对问题进行验证。\n\n### 步骤1：提取已知条件\n\n-   **背景**：具有等方差和等样本量的双样本学生t检验。\n-   **样本**：两个独立样本，每个样本量为 $n$。\n-   **分布**：样本来自具有共同方差的正态分布。\n-   **参数**：组均值 $\\mu_1$ 和 $\\mu_2$；共同标准差 $\\sigma$。\n-   **定义**：标准化效应量 $\\Delta = (\\mu_1 - \\mu_2)/\\sigma$。\n-   **假设**：显著性水平为 $\\alpha$ 的双侧检验。\n    -   $H_0: \\mu_1 - \\mu_2 = 0$。\n    -   $H_1: \\mu_1 - \\mu_2 \\neq 0$。\n-   **给定断言**：\n    -   统计功效的定义是在 $H_1$ 为真时正确拒绝 $H_0$ 的概率。\n    -   在 $H_0$ 下，t统计量服从自由度为 $\\nu = 2n - 2$ 的中心学生t分布。\n    -   在 $H_1$ （$\\Delta \\neq 0$）下，t统计量服从自由度为 $\\nu = 2n - 2$ 和非中心参数为 $\\lambda$ 的非中心学生t分布。\n-   **任务A（推导）**：\n    -   推导统计功效 $\\text{power}(n,\\Delta,\\alpha)$ 的表达式。\n    -   说明为什么自由度是 $\\nu = 2n - 2$。\n    -   说明 $\\lambda$ 如何依赖于 $\\Delta$ 和 $n$。\n    -   使用非中心t分布的累积分布函数 (CDF) 表示统计功效。\n-   **任务B（计算）**：\n    -   实现 $\\text{power}(n,\\Delta,\\alpha)$。\n    -   计算前向有限差分：$D(n,\\Delta,\\alpha) = \\text{power}(n+1,\\Delta,\\alpha) - \\text{power}(n,\\Delta,\\alpha)$。\n    -   对于 $\\Delta > 0$，使用容差 $\\tau_+ = 10^{-10}$ 验证 $D(n,\\Delta,\\alpha) > 0$。\n    -   对于 $\\Delta = 0$，使用容差 $\\tau_0 = 10^{-8}$ 验证 $|D(n,0,\\alpha)| \\le \\tau_0$。\n-   **测试套件**：\n    -   情况 1：$(n,\\Delta,\\alpha) = (10, 0.5, 0.05)$，检查 $D > 0$。\n    -   情况 2：$(n,\\Delta,\\alpha) = (3, 1.0, 0.05)$，检查 $D > 0$。\n    -   情况 3：$(n,\\Delta,\\alpha) = (50, 0.2, 0.01)$，检查 $D > 0$。\n    -   情况 4：$(n,\\Delta,\\alpha) = (20, 0.0, 0.05)$，检查 $|D| \\le \\tau_0$。\n    -   情况 5：$(n,\\Delta,\\alpha) = (150, 0.5, 0.05)$，检查 $D > 0$。\n\n### 步骤2：使用提取的已知条件进行验证\n\n根据已建立的验证标准评估问题。\n1.  **科学依据充分**：该问题是统计功效分析中的经典练习，基于学生t检验和非中心t分布的成熟理论。所有前提在事实上都是正确的。\n2.  **问题定义明确**：问题定义清晰，提供了所有必要的参数和条件。推导和计算的目标都明确无误地指定了。\n3.  **客观性**：语言正式、精确，没有主观性或个人观点。\n4.  **不完整性/矛盾**：问题是自洽的，没有矛盾。其假设（如正态性、等方差）是该检验的标准假设。\n5.  **不切实际/不可行**：该问题本质上是理论和计算性的，不涉及任何物理上不可能或科学上难以置信的条件。\n所有其他标准也同样满足。该问题是生物统计学中一个标准的、实质性的练习。\n\n### 步驟3：結論與行動\n\n问题陈述**有效**。将提供完整解答。\n\n### 任务A：统计功效函数的推导\n\n我们首先为统计功效计算建立理论基础。\n\n**1. 双样本t统计量**\n设两个独立样本为 $X_1, X_2, \\dots, X_n$（来自 $N(\\mu_1, \\sigma^2)$ 分布）和 $Y_1, Y_2, \\dots, Y_n$（来自 $N(\\mu_2, \\sigma^2)$ 分布）。样本均值为 $\\bar{X}$ 和 $\\bar{Y}$。样本方差为 $S_1^2$ 和 $S_2^2$。由于假定总体方差相等，我们使用合并样本方差 $S_p^2$，它是共同方差 $\\sigma^2$ 的一个无偏估计量：\n$$ S_p^2 = \\frac{(n-1)S_1^2 + (n-1)S_2^2}{(n-1) + (n-1)} = \\frac{(n-1)S_1^2 + (n-1)S_2^2}{2n-2} $$\n双样本t统计量定义为样本均值之差，并由其估计的标准误进行标准化：\n$$ T = \\frac{\\bar{X} - \\bar{Y}}{S_p \\sqrt{\\frac{1}{n} + \\frac{1}{n}}} = \\frac{\\bar{X} - \\bar{Y}}{S_p \\sqrt{\\frac{2}{n}}} $$\n\n**2. t统计量的分布**\n为确定 $T$ 的分布，我们分析其分子和分母。\n\n样本均值之差 $\\bar{X} - \\bar{Y}$ 服从正态分布：\n$$ \\bar{X} - \\bar{Y} \\sim N\\left(\\mu_1 - \\mu_2, \\frac{\\sigma^2}{n} + \\frac{\\sigma^2}{n}\\right) = N\\left(\\mu_1 - \\mu_2, \\frac{2\\sigma^2}{n}\\right) $$\n由此，我们可以定义一个标准正态变量 $Z_0 = \\frac{(\\bar{X}-\\bar{Y}) - (\\mu_1 - \\mu_2)}{\\sigma\\sqrt{2/n}} \\sim N(0,1)$。\n\n根据Cochran定理，缩放后的误差平方和服从卡方分布。对于每个样本，$\\frac{(n-1)S_k^2}{\\sigma^2} \\sim \\chi^2_{n-1}$。由于两个样本独立，这两个独立的卡方变量之和也是一个卡方变量，其自由度等于它们各自自由度之和：\n$$ V = \\frac{(2n-2)S_p^2}{\\sigma^2} = \\frac{(n-1)S_1^2}{\\sigma^2} + \\frac{(n-1)S_2^2}{\\sigma^2} \\sim \\chi^2_{n-1+n-1} = \\chi^2_{2n-2} $$\n这个推导显示了检验的自由度为 $\\nu = 2n-2$。统计量 $V$ 与样本均值无关，因此也与 $Z_0$ 无关。\n\nt统计量 $T$ 可以重写为：\n$$ T = \\frac{\\frac{(\\bar{X} - \\bar{Y})}{\\sigma \\sqrt{2/n}}}{\\frac{S_p \\sqrt{2/n}}{\\sigma \\sqrt{2/n}}} = \\frac{\\frac{(\\bar{X} - \\bar{Y})}{\\sigma \\sqrt{2/n}}}{\\sqrt{\\frac{S_p^2}{\\sigma^2}}} = \\frac{\\frac{(\\bar{X} - \\bar{Y})}{\\sigma \\sqrt{2/n}}}{\\sqrt{\\frac{V/\\nu}{\\sigma^2} \\cdot \\sigma^2}} = \\frac{\\frac{(\\bar{X}-\\bar{Y})}{\\sigma\\sqrt{2/n}}}{\\sqrt{V/\\nu}}$$\n让我们在原假设和备择假设下分析这个比率。\n\n*   **在原假设 ($H_0: \\mu_1 - \\mu_2 = 0$) 下**：\n    分子简化为 $\\frac{\\bar{X} - \\bar{Y}}{\\sigma\\sqrt{2/n}} \\sim N(0,1)$。统计量 $T$ 成为一个标准正态变量与一个独立的、除以其自由度 $\\nu = 2n-2$ 的卡方变量的平方根之比。这是中心学生t分布的定义：\n    $$ T | H_0 \\sim t_{\\nu} = t_{2n-2} $$\n\n*   **在备择假设 ($H_1: \\mu_1 - \\mu_2 \\neq 0$) 下**：\n    分子的分布是非中心的：\n    $$ \\frac{\\bar{X} - \\bar{Y}}{\\sigma\\sqrt{2/n}} \\sim N\\left(\\frac{\\mu_1 - \\mu_2}{\\sigma\\sqrt{2/n}}, 1\\right) $$\n    统计量 $T$ 现在是一个非标准正态变量与一个独立的、除以其自由度的卡方变量的平方根之比。这定义了一个非中心学生t分布。该正态变量的均值即为非中心参数 $\\lambda$。\n    这表明非中心参数 $\\lambda$ 是：\n    $$ \\lambda = \\frac{\\mu_1 - \\mu_2}{\\sigma\\sqrt{2/n}} $$\n    使用标准化效应量 $\\Delta = (\\mu_1 - \\mu_2)/\\sigma$，我们用 $\\Delta$ 和 $n$ 来表示 $\\lambda$：\n    $$ \\lambda = \\frac{\\Delta \\sigma}{\\sigma \\sqrt{2/n}} = \\Delta \\sqrt{\\frac{n}{2}} $$\n    因此，在 $H_1$ 下，检验统计量 $T$ 服从自由度为 $\\nu = 2n-2$、非中心参数为 $\\lambda = \\Delta \\sqrt{n/2}$ 的非中心t分布：\n    $$ T | H_1 \\sim t_{\\nu, \\lambda} = t_{2n-2, \\Delta\\sqrt{n/2}} $$\n\n**3. 统计功效的推导**\n统计功效是在备择假设 $H_1$ 为真时正确拒绝原假设 $H_0$ 的概率。对于一个显著性水平为 $\\alpha$ 的双侧检验，如果观测到的统计量 $|T_{obs}|$ 超过一个临界值 $c$，我们就拒绝 $H_0$。\n\n临界值 $c$ 是根据零分布（$t_{2n-2}$）确定的，使得 $P(|T| > c | H_0) = \\alpha$。由于中心t分布的对称性，这等价于 $P(T > c | H_0) = \\alpha/2$。因此，临界值是自由度为 $\\nu = 2n-2$ 的中心t分布的 $(1 - \\alpha/2)$-分位数：\n$$ c = t_{2n-2, 1-\\alpha/2} $$\n\n统计功效，是在备择假设下发生此拒绝事件的概率：\n$$ \\text{power} = P(|T| > c | H_1) = P(T > c | H_1) + P(T < -c | H_1) $$\n令 $T'$ 为一个服从非中心t分布 $t_{\\nu, \\lambda}$ 的随机变量，其中 $\\nu = 2n-2$ 且 $\\lambda = \\Delta \\sqrt{n/2}$。令 $F_{t(\\nu, \\lambda)}$ 为其累积分布函数（CDF）。统计功效可以表示为：\n$$ \\text{power} = (1 - P(T' \\le c)) + P(T' < -c) $$\n$$ \\text{power}(n, \\Delta, \\alpha) = (1 - F_{t(\\nu, \\lambda)}(c)) + F_{t(\\nu, \\lambda)}(-c) $$\n其中：\n-   $\\nu = 2n - 2$\n-   $\\lambda = \\Delta \\sqrt{n/2}$\n-   $c = F_{t(\\nu)}^{-1}(1-\\alpha/2)$，其中 $F_{t(\\nu)}$ 是中心t分布的CDF。\n\n这是该检验统计功效的最终表达式。\n\n### 任务B：计算验证的基本原理\n\n实现将计算此统计功效函数。统计功效关于样本量 $n$ 的导数使用前向有限差分 $D(n,\\Delta,\\alpha) = \\text{power}(n+1,\\Delta,\\alpha) - \\text{power}(n,\\Delta,\\alpha)$ 进行近似。\n\n*   对于 $\\Delta > 0$，备择假设为真。增加样本量提供了更多信息，从而减少了均值差估计的标准误。这使得将真实效应与随机噪声区分开来变得更容易，因此增加了正确拒绝原假设的概率。所以，统计功效是 $n$ 的单调递增函数，我们期望 $D(n,\\Delta,\\alpha)>0$。\n\n*   对于 $\\Delta = 0$，原假设为真。在这种情况下，检验统计量服从中心t分布，“统计功效”实际上是犯第一类错误的概率。根据定义，对于任何样本量 $n > 1$，这个概率都固定为显著性水平 $\\alpha$。\n    $$ \\text{power}(n, 0, \\alpha) = P(|T| > c | H_0) = \\alpha $$\n    因此，$\\text{power}(n+1,0,\\alpha) - \\text{power}(n,0,\\alpha) = \\alpha - \\alpha = 0$。数值计算应该得到一个非常接近 $0$ 的值，受浮点精度限制。检查 $|D(n,0,\\alpha)| \\le \\tau_0$ 验证了这一理论结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import t, nct\n\ndef power_func(n, Delta, alpha):\n    \"\"\"\n    Computes the power of a two-sided, two-sample t-test with equal sample sizes.\n\n    Args:\n        n (int): Sample size for each group (must be > 1).\n        Delta (float): Standardized effect size (mu1 - mu2) / sigma.\n        alpha (float): Significance level.\n\n    Returns:\n        float: The power of the test.\n    \"\"\"\n    # Degrees of freedom must be positive, which means n > 1.\n    if n = 1:\n        return np.nan\n    nu = 2 * n - 2\n    \n    # Calculate the critical value 'c' from the central t-distribution.\n    # We reject H0 if |T| > c.\n    critical_value = t.ppf(1 - alpha / 2, df=nu)\n    \n    # Calculate the noncentrality parameter 'lambda'.\n    noncentrality_param = Delta * np.sqrt(n / 2.0)\n    \n    # The power is P(T'  -c) + P(T' > c), where T' follows a noncentral\n    # t-distribution with df=nu and nc=noncentrality_param.\n    # This is calculated using the CDF of the noncentral t-distribution.\n    # Using sf (survival function, 1-cdf) for the upper tail can improve\n    # numerical precision.\n    power = nct.cdf(-critical_value, df=nu, nc=noncentrality_param) + \\\n            nct.sf(critical_value, df=nu, nc=noncentrality_param)\n            \n    return power\n\ndef forward_difference_power(n, Delta, alpha):\n    \"\"\"\n    Computes the forward finite difference approximation of the derivative of\n    power with respect to sample size n.\n    \"\"\"\n    power_n = power_func(n, Delta, alpha)\n    power_n_plus_1 = power_func(n + 1, Delta, alpha)\n    return power_n_plus_1 - power_n\n\ndef solve():\n    \"\"\"\n    Executes the computational verification for the specified test cases.\n    \"\"\"\n    test_cases = [\n        # (n, Delta, alpha)\n        (10, 0.5, 0.05),\n        (3, 1.0, 0.05),\n        (50, 0.2, 0.01),\n        (20, 0.0, 0.05),\n        (150, 0.5, 0.05),\n    ]\n\n    tau_plus = 1e-10  # Positivity tolerance\n    tau_zero = 1e-8   # Near-zero tolerance\n    \n    results = []\n    \n    for case in test_cases:\n        n, Delta, alpha = case\n        \n        d_val = forward_difference_power(n, Delta, alpha)\n        \n        if Delta > 0:\n            # For Delta > 0, power should increase with n.\n            # D(n, Delta, alpha) should be positive.\n            test_passed = d_val >= tau_plus\n        elif Delta == 0:\n            # For Delta = 0, power is constant at alpha for n > 1.\n            # D(n, 0, alpha) should be zero (within machine precision).\n            test_passed = np.abs(d_val) = tau_zero\n        else:\n            # This case is not in the test suite, but handle for completeness.\n            # Power is symmetric with respect to Delta, so D is also symmetric.\n            # The check would be the same as for Delta > 0.\n            test_passed = d_val >= tau_plus\n\n        results.append(test_passed)\n        \n    # Format the final output as a comma-separated list of booleans in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the main function.\nsolve()\n\n```"
        }
    ]
}