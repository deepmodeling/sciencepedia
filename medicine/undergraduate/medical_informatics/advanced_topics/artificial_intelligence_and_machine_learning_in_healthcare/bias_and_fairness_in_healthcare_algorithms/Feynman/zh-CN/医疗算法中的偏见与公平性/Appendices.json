{
    "hands_on_practices": [
        {
            "introduction": "要想定量评估算法的偏见，我们首先必须掌握核心的公平性指标。本练习提供了一个动手实践的机会，使用具体的临床数据计算三个最重要的群体公平性标准：人口统计均等、均等化赔率和预测均等。通过解决这个问题 ()，您将对这些不同公平性定义的计算方式以及它们之间可能存在的冲突获得一个实践性的理解。",
            "id": "4824186",
            "problem": "一家医院部署了一种二元分类算法，用于预测$24$小时内败血症的发作。该分类器输出一个风险评分，该评分通过阈值处理产生阳性或阴性预测。考虑两个人口群体$G_1$和$G_2$，它们在不同阈值下的真实败血症患病率是固定的。在每个阈值$\\tau$下，该算法根据真正例 (TP)、假正例 (FP)、真负例 (TN) 和假负例 (FN) 的计数，得出以下针对特定群体的混淆矩阵。\n\n在阈值$\\tau_1$下：\n- 群体$G_1$：$TP=300$， $FP=120$， $TN=480$， $FN=100$。\n- 群体$G_2$：$TP=180$， $FP=90$， $TN=810$， $FN=120$。\n\n在阈值$\\tau_2$下：\n- 群体$G_1$：$TP=240$， $FP=72$， $TN=528$， $FN=160$。\n- 群体$G_2$：$TP=135$， $FP=54$， $TN=846$， $FN=165$。\n\n使用选择率（预测为阳性的比例，$(TP+FP)/(\\text{总数})$）、真正例率（TPR，灵敏度）$TP/P$（其中$P$为实际阳性数量）、假正例率（FPR）$FP/N$（其中$N$为实际阴性数量）和阳性预测值（PPV）$TP/(TP+FP)$的正式定义，计算在每个阈值下的以下公平性差异度量：\n- 人口均等差异（DP 差异）：$G_1$和$G_2$之间选择率的绝对差。\n- 均等化赔率差异（EO 差异）：$G_1$和$G_2$之间 TPR 和 FPR 绝对差中的较大者。\n- 预测均等差异（PPV 差异）：$G_1$和$G_2$之间 PPV 的绝对差。\n\n然后，根据您计算出的值，通过比较$\\tau_1$和$\\tau_2$处的数值大小，解释哪个阈值对每种差异的贡献最大。\n\n将所有计算出的差异四舍五入到四位有效数字。将最终数值结果表示为单个行矩阵，顺序为 $(\\text{DP at }\\tau_1,\\ \\text{EO at }\\tau_1,\\ \\text{PPV at }\\tau_1,\\ \\text{DP at }\\tau_2,\\ \\text{EO at }\\tau_2,\\ \\text{PPV at }\\tau_2)$。",
            "solution": "问题陈述经评估有效。它在算法公平性这一成熟领域具有科学依据，在数学上是适定的，并为分析提供了一套完整、一致且客观的数据和定义。“不同阈值下固定的真实败血症患病率”这一核心假设可由所提供的数据验证。对于群体$G_1$，在阈值$\\tau_1$下，实际阳性数量为 $P_1 = 300+100 = 400$，实际阴性数量为 $N_1 = 120+480 = 600$。在阈值$\\tau_2$下，这些值为 $P_1 = 240+160 = 400$ 和 $N_1 = 72+528 = 600$。对于群体$G_2$，在$\\tau_1$下，$P_2 = 180+120 = 300$，$N_2 = 90+810 = 900$。在$\\tau_2$下，$P_2 = 135+165 = 300$，$N_2 = 54+846 = 900$。每个群体内的阳性和阴性数量在不同阈值下是恒定的，这证实了问题陈述的内部一致性。我们现在可以进行求解。\n\n该问题要求计算和比较两个人口群体$G_1$和$G_2$在两个不同分类器阈值$\\tau_1$和$\\tau_2$下的三种公平性差异度量。这些度量是人口均等差异、均等化赔率差异和预测均等差异。\n\n首先，我们计算每个群体在每个阈值下必要的性能统计数据。令$P$表示实际阳性总数（$P=TP+FN$），$N$表示实际阴性总数（$N=TN+FP$），$T$表示总人口规模（$T=P+N$）。\n\n**在阈值 $\\tau_1$ 下的分析**\n\n对于群体 $G_1$：\n- 已知：$TP_{1,\\tau_1}=300$, $FP_{1,\\tau_1}=120$, $TN_{1,\\tau_1}=480$, $FN_{1,\\tau_1}=100$。\n- 总人口：$T_{1,\\tau_1} = 300+120+480+100 = 1000$。\n- 实际阳性：$P_1 = 300+100 = 400$。\n- 实际阴性：$N_1 = 120+480 = 600$。\n- 选择率 ($SR$)：$SR_{1,\\tau_1} = \\frac{TP_{1,\\tau_1} + FP_{1,\\tau_1}}{T_{1,\\tau_1}} = \\frac{300+120}{1000} = \\frac{420}{1000} = 0.42$。\n- 真正例率 ($TPR$)：$TPR_{1,\\tau_1} = \\frac{TP_{1,\\tau_1}}{P_1} = \\frac{300}{400} = 0.75$。\n- 假正例率 ($FPR$)：$FPR_{1,\\tau_1} = \\frac{FP_{1,\\tau_1}}{N_1} = \\frac{120}{600} = 0.20$。\n- 阳性预测值 ($PPV$)：$PPV_{1,\\tau_1} = \\frac{TP_{1,\\tau_1}}{TP_{1,\\tau_1}+FP_{1,\\tau_1}} = \\frac{300}{300+120} = \\frac{300}{420} = \\frac{5}{7}$。\n\n对于群体 $G_2$：\n- 已知：$TP_{2,\\tau_1}=180$, $FP_{2,\\tau_1}=90$, $TN_{2,\\tau_1}=810$, $FN_{2,\\tau_1}=120$。\n- 总人口：$T_{2,\\tau_1} = 180+90+810+120 = 1200$。\n- 实际阳性：$P_2 = 180+120 = 300$。\n- 实际阴性：$N_2 = 90+810 = 900$。\n- 选择率 ($SR$)：$SR_{2,\\tau_1} = \\frac{TP_{2,\\tau_1} + FP_{2,\\tau_1}}{T_{2,\\tau_1}} = \\frac{180+90}{1200} = \\frac{270}{1200} = 0.225$。\n- 真正例率 ($TPR$)：$TPR_{2,\\tau_1} = \\frac{TP_{2,\\tau_1}}{P_2} = \\frac{180}{300} = 0.60$。\n- 假正例率 ($FPR$)：$FPR_{2,\\tau_1} = \\frac{FP_{2,\\tau_1}}{N_2} = \\frac{90}{900} = 0.10$。\n- 阳性预测值 ($PPV$)：$PPV_{2,\\tau_1} = \\frac{TP_{2,\\tau_1}}{TP_{2,\\tau_1}+FP_{2,\\tau_1}} = \\frac{180}{180+90} = \\frac{180}{270} = \\frac{2}{3}$。\n\n在 $\\tau_1$ 下的差异度量：\n- DP 差异：$|\\Delta SR|_{\\tau_1} = |SR_{1,\\tau_1} - SR_{2,\\tau_1}| = |0.42 - 0.225| = 0.195$。四舍五入到四位有效数字为 $0.1950$。\n- EO 差异：$\\max(|\\Delta TPR|_{\\tau_1}, |\\Delta FPR|_{\\tau_1}) = \\max(|0.75 - 0.60|, |0.20 - 0.10|) = \\max(0.15, 0.10) = 0.15$。四舍五入到四位有效数字为 $0.1500$。\n- PPV 差异：$|\\Delta PPV|_{\\tau_1} = |PPV_{1,\\tau_1} - PPV_{2,\\tau_1}| = |\\frac{5}{7} - \\frac{2}{3}| = |\\frac{15-14}{21}| = \\frac{1}{21} \\approx 0.047619$。四舍五入到四位有效数字为 $0.04762$。\n\n**在阈值 $\\tau_2$ 下的分析**\n\n对于群体 $G_1$：\n- 已知：$TP_{1,\\tau_2}=240$, $FP_{1,\\tau_2}=72$, $TN_{1,\\tau_2}=528$, $FN_{1,\\tau_2}=160$。\n- $P_1 = 400$, $N_1=600$, $T_{1,\\tau_2}=1000$。\n- 选择率 ($SR$)：$SR_{1,\\tau_2} = \\frac{240+72}{1000} = \\frac{312}{1000} = 0.312$。\n- 真正例率 ($TPR$)：$TPR_{1,\\tau_2} = \\frac{240}{400} = 0.60$。\n- 假正例率 ($FPR$)：$FPR_{1,\\tau_2} = \\frac{72}{600} = 0.12$。\n- 阳性预测值 ($PPV$)：$PPV_{1,\\tau_2} = \\frac{240}{240+72} = \\frac{240}{312} = \\frac{10}{13}$。\n\n对于群体 $G_2$：\n- 已知：$TP_{2,\\tau_2}=135$, $FP_{2,\\tau_2}=54$, $TN_{2,\\tau_2}=846$, $FN_{2,\\tau_2}=165$。\n- $P_2 = 300$, $N_2=900$, $T_{2,\\tau_2}=1200$。\n- 选择率 ($SR$)：$SR_{2,\\tau_2} = \\frac{135+54}{1200} = \\frac{189}{1200} = 0.1575$。\n- 真正例率 ($TPR$)：$TPR_{2,\\tau_2} = \\frac{135}{300} = 0.45$。\n- 假正例率 ($FPR$)：$FPR_{2,\\tau_2} = \\frac{54}{900} = 0.06$。\n- 阳性预测值 ($PPV$)：$PPV_{2,\\tau_2} = \\frac{135}{135+54} = \\frac{135}{189} = \\frac{5}{7}$。\n\n在 $\\tau_2$ 下的差异度量：\n- DP 差异：$|\\Delta SR|_{\\tau_2} = |SR_{1,\\tau_2} - SR_{2,\\tau_2}| = |0.312 - 0.1575| = 0.1545$。这已经是四位有效数字。\n- EO 差异：$\\max(|\\Delta TPR|_{\\tau_2}, |\\Delta FPR|_{\\tau_2}) = \\max(|0.60 - 0.45|, |0.12 - 0.06|) = \\max(0.15, 0.06) = 0.15$。四舍五入到四位有效数字为 $0.1500$。\n- PPV 差异：$|\\Delta PPV|_{\\tau_2} = |PPV_{1,\\tau_2} - PPV_{2,\\tau_2}| = |\\frac{10}{13} - \\frac{5}{7}| = |\\frac{70-65}{91}| = \\frac{5}{91} \\approx 0.054945$。四舍五入到四位有效数字为 $0.05495$。\n\n**解释与比较**\n\n- **人口均等 (DP) 差异**：在 $\\tau_1$ 下，DP 差异为 $0.1950$。在 $\\tau_2$ 下，为 $0.1545$。由于 $0.1950 > 0.1545$，阈值 $\\tau_1$ 对选择率差异的贡献最大。这表明，在更宽松的阈值 $\\tau_1$ 下，阳性预测的总体比例在各群体之间更加不平衡。\n\n- **均等化赔率 (EO) 差异**：在 $\\tau_1$ 和 $\\tau_2$ 下，EO 差异均为 $0.1500$。在这两种情况下，这个最大差异都来自真正例率的差异（$|\\Delta TPR| = 0.15$），而不是来自假正例率。就该度量而言，没有哪个阈值明显更好或更差；它们都表现出相同水平的差异。\n\n- **预测均等 (PPV) 差异**：在 $\\tau_1$ 下，PPV 差异为 $0.04762$。在 $\\tau_2$ 下，为 $0.05495$。由于 $0.05495 > 0.04762$，阈值 $\\tau_2$ 对阳性预测值的差异贡献最大。这意味着，在更严格的阈值 $\\tau_2$ 下，对于收到阳性预测的患者实际患有败血症的概率，群体之间的差异更大。\n\n最终结果按要求编译成一个单行矩阵。\n这些值为：\nDP at $\\tau_1$: $0.1950$\nEO at $\\tau_1$: $0.1500$\nPPV at $\\tau_1$: $0.04762$\nDP at $\\tau_2$: $0.1545$\nEO at $\\tau_2$: $0.1500$\nPPV at $\\tau_2$: $0.05495$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1950  0.1500  0.04762  0.1545  0.1500  0.05495\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在计算了各个群体的公平性指标后，一个常见的后续步骤是报告一个单一的、总结性的指标。然而，聚合方法本身会极大地影响最终的结论。本练习 () 将探讨宏观平均和微观平均之间的关键差异，揭示统计聚合方法的选择如何在不同规模的子群体之间掩盖或凸显不平等。",
            "id": "4824189",
            "problem": "一个医院系统部署了一个二元分类器来触发早期败血症警报。该系统的性能在三个互斥的患者组（$A$、$B$ 和 $C$）中进行了公平性审计。审计重点关注机会均等率（Equal Opportunity Rate），其定义为真正率（True Positive Rate, TPR），其中真正率（TPR）为 $TPR = \\frac{\\text{True Positive (TP)}}{\\text{True Positive (TP)} + \\text{False Negative (FN)}}$。该系统记录了为期一个月的以下混淆矩阵计数：\n\n- $A$ 组：$TP = 160$，$FN = 40$，$FP = 90$，$TN = 510$；总样本量 $800$，其中实际正例 $200$，实际阴性 $600$。\n- $B$ 组：$TP = 54$，$FN = 36$，$FP = 18$，$TN = 42$；总样本量 $150$，其中实际正例 $90$，实际阴性 $60$。\n- $C$ 组：$TP = 18$，$FN = 12$，$FP = 2$，$TN = 18$；总样本量 $50$，其中实际正例 $30$，实际阴性 $20$。\n\n考虑两种标准聚合方案来总结各组的机会均等率：宏平均（macro-averaging）和微平均（micro-averaging）。宏平均定义为各组特定比率的算术平均值。微平均定义为首先汇总各组的计数，然后根据汇总的计数计算比率。令 $\\Delta$ 表示宏平均机会均等率与微平均机会均等率之间的有符号差值，\n$$\n\\Delta = \\text{Macro-averaged TPR} - \\text{Micro-averaged TPR}.\n$$\n仅使用所提供的计数计算 $\\Delta$。在您的推理中，解释相对组规模如何影响聚合以及寻求各组间 TPR 均等的公平性均等约束。将 $\\Delta$ 的最终数值答案四舍五入到四位有效数字。无需单位。",
            "solution": "对问题陈述进行验证。\n\n**步骤 1：提取给定信息**\n-   患者组：$A$、$B$、$C$（互斥）。\n-   公平性指标：机会均等率，定义为真正率 (TPR)。\n-   TPR 定义：$TPR = \\frac{\\text{True Positive (TP)}}{\\text{True Positive (TP)} + \\text{False Negative (FN)}}$。\n-   混淆矩阵计数：\n    -   A 组：$TP_A = 160$, $FN_A = 40$, $FP_A = 90$, $TN_A = 510$。\n    -   B 组：$TP_B = 54$, $FN_B = 36$, $FP_B = 18$, $TN_B = 42$。\n    -   C 组：$TP_C = 18$, $FN_C = 12$, $FP_C = 2$, $TN_C = 18$。\n-   聚合定义：\n    -   宏平均：各组特定比率的算术平均值。\n    -   微平均：根据汇总的计数计算比率。\n-   待计算量：$\\Delta = \\text{Macro-averaged TPR} - \\text{Micro-averaged TPR}$。\n-   最终指令：将 $\\Delta$ 的数值答案四舍五入到四位有效数字。\n\n**步骤 2：使用提取的给定信息进行验证**\n该问题具有科学依据，采用了机器学习公平性和模型评估领域的标准、明确定义的指标（TPR、宏/微平均）。所提供的数据是完整且内部一致的；对于每个组，TP、FN、FP 和 TN 的总和等于所述的总样本量，TP 和 FN 的总和等于所述的实际正例数。问题定义明确，所有必要信息和清晰定义导向一个唯一的、可计算的解。语言客观而精确。\n\n**步骤 3：结论与行动**\n问题有效。现在开始求解过程。\n\n核心任务是计算宏平均和微平均的真正率（TPR），并求出它们的差值 $\\Delta$。\n\n首先，我们单独计算每个组的 TPR。组 $i$ 的 TPR 由以下公式给出：\n$$\nTPR_i = \\frac{TP_i}{TP_i + FN_i}\n$$\n其中 $TP_i$ 是组 $i$ 的真正例数，$FN_i$ 是组 $i$ 的假阴性数。分母 $TP_i + FN_i$ 代表组 $i$ 中实际正例的总数。\n\n对于 A 组：\n$$\nTPR_A = \\frac{TP_A}{TP_A + FN_A} = \\frac{160}{160 + 40} = \\frac{160}{200} = 0.8\n$$\n\n对于 B 组：\n$$\nTPR_B = \\frac{TP_B}{TP_B + FN_B} = \\frac{54}{54 + 36} = \\frac{54}{90} = 0.6\n$$\n\n对于 C 组：\n$$\nTPR_C = \\frac{TP_C}{TP_C + FN_C} = \\frac{18}{18 + 12} = \\frac{18}{30} = 0.6\n$$\n\n接下来，我们计算宏平均 TPR。宏平均计算各个组 TPR 的简单算术平均值。它给予每个组的性能相同的权重，而不管组的大小。\n$$\n\\text{Macro-averaged TPR} = \\frac{TPR_A + TPR_B + TPR_C}{3} = \\frac{0.8 + 0.6 + 0.6}{3} = \\frac{2.0}{3}\n$$\n\n现在，我们计算微平均 TPR。微平均在计算指标前会汇总所有组的计数。这给予每个独立观察（在此案例中，是每个阳性患者病例）相同的权重。\n我们首先汇总所有组的真正例和假阴性：\n$$\nTP_{\\text{total}} = TP_A + TP_B + TP_C = 160 + 54 + 18 = 232\n$$\n$$\nFN_{\\text{total}} = FN_A + FN_B + FN_C = 40 + 36 + 12 = 88\n$$\n然后使用这些汇总的计数来计算微平均 TPR：\n$$\n\\text{Micro-averaged TPR} = \\frac{TP_{\\text{total}}}{TP_{\\text{total}} + FN_{\\text{total}}} = \\frac{232}{232 + 88} = \\frac{232}{320}\n$$\n化简分数：\n$$\n\\frac{232}{320} = \\frac{116}{160} = \\frac{58}{80} = \\frac{29}{40} = 0.725\n$$\n\n最后，我们计算 $\\Delta$，即宏平均 TPR 与微平均 TPR 之间的有符号差值。\n$$\n\\Delta = \\text{Macro-averaged TPR} - \\text{Micro-averaged TPR} = \\frac{2}{3} - \\frac{29}{40}\n$$\n为了减去这两个分数，我们找到一个公分母，即 $120$：\n$$\n\\Delta = \\frac{2 \\times 40}{3 \\times 40} - \\frac{29 \\times 3}{40 \\times 3} = \\frac{80}{120} - \\frac{87}{120} = -\\frac{7}{120}\n$$\n将此分数转换为小数：\n$$\n\\Delta = -7 \\div 120 \\approx -0.058333...\n$$\n问题要求将结果四舍五入到四位有效数字。前四位有效数字是 $5$、$8$、$3$ 和 $3$。第五位有效数字是 $3$，小于 $5$，因此我们不进行进位。\n$$\n\\Delta \\approx -0.05833\n$$\n\n**结果解读**\n机会均等率公平性约束要求所有组的 TPR 相等。在本例中，我们观察到差异：$TPR_A = 0.8$，而 $TPR_B = TPR_C = 0.6$。分类器对 A 组的表现更好。\n\n宏平均和微平均之间的差异 $\\Delta$ 提供了有用的信息。宏平均将每个组视为一个单一实体，因此最终得分是各组性能的平均值（$\\frac{0.8+0.6+0.6}{3} \\approx 0.667$）。微平均根据每个组中“正例”类别的个体数量来加权性能。A 组的正例数为 $200$，B 组为 $90$，C 组为 $30$。A 组拥有最高的 TPR（$0.8$），同时也拥有最多的正例（总共 $320$ 个中的 $200$ 个）。因此，微平均值严重偏向 A 组的更高性能，导致其值（$0.725$）高于宏平均值。\n\n$\\Delta$ 为负值这一事实表明宏平均小于微平均。这揭示了拥有最多正例实例的组（A 组）也是分类器性能最高的组。如果最大的组性能最差，$\\Delta$ 将为正。因此，$\\Delta$ 的符号和大小可以作为性能差异如何与子组大小相关联的指标。",
            "answer": "$$\n\\boxed{-0.05833}\n$$"
        },
        {
            "introduction": "混淆矩阵虽然实用，但它只捕捉了模型在单个决策阈值下的性能。这个更高级的练习 () 将超越离散计数，转而分析模型产生的连续风险评分。您将探索为什么像精确率-召回率曲线下面积 (AUPRC) 这样的指标在医疗领域中对于罕见事件更具信息量，并推导这个总体性能指标与在任意给定阈值下的具体公平性差距之间的数学联系。",
            "id": "4824170",
            "problem": "一家医院部署了一个二元风险评分模型，用于预测一种罕见不良事件的发生。该医院监测模型在两个标记为 $A$ 和 $B$ 的患者子群中的性能和公平性。该模型输出一个连续评分 $s \\in [0, \\infty)$，并使用一个决策阈值 $t$ 将评分 $s \\geq t$ 的患者分类为预测阳性。\n\n任务1（概念基础）：使用真正率（TPR）、假正率（FPR）、精确率（precision）和召回率（recall）的核心定义，给出受试者工作特征曲线下面积（AUROC）和精确率-召回率曲线下面积（AUPRC）的形式化定义。基于这些定义解释，在结局患病率非常低的情况下（这在医疗健康风险预测中很常见），为什么AUPRC通常比AUROC提供更多信息。\n\n任务2（建模与推导）：假设存在以下科学上合理的评分生成机制。以真实结局 $Y \\in \\{0,1\\}$为条件，模型评分服从指数分布：\n- 对于两个子群，给定结局 $Y=1$ 的评分密度函数为 $f_{+}(s) = \\lambda_{+} \\exp(-\\lambda_{+} s)$，率参数为 $\\lambda_{+} = 1$。\n- 对于子群 $A$，给定结局 $Y=0$ 的评分密度函数为 $f_{A-}(s) = \\lambda_{A-} \\exp(-\\lambda_{A-} s)$，率参数为 $\\lambda_{A-} = 2$。\n- 对于子群 $B$，给定结局 $Y=0$ 的评分密度函数为 $f_{B-}(s) = \\lambda_{B-} \\exp(-\\lambda_{B-} s)$，率参数为 $\\lambda_{B-} = 3$。\n\n假设各子群的结局患病率相等，为 $\\pi = \\Pr(Y=1) = 0.05$。\n\n仅从基本定义和这些分布假设出发，推导出特定子群的精确率-召回率（PR）曲线 $P_{g}(r)$ 作为召回率 $r$ 的函数（其中 $g \\in \\{A,B\\}$），然后计算每个子群的精确率-召回率曲线下面积（AUPRC）的闭式解析表达式。\n\n任务3（公平性转换与计算）：将阈值 $t$ 下的阈值依赖精确率差距定义为 $\\Delta(t) = P_{B}(t) - P_{A}(t)$，其中 $P_{g}(t)$ 是子群 $g$ 在阈值 $t$ 下的精确率。使用推导出的表达式，解释当各子群的 $\\lambda_{+}$ 和 $\\pi$ 相同时，子群AUPRC的差异与 $\\Delta(t)$ 之间的关系。然后，对于特定阈值 $t=1$，使用 $\\pi = 0.05$ 计算 $\\Delta(1)$ 的数值，并将您的最终答案四舍五入到四位有效数字。最终数值无需单位。",
            "solution": "该问题陈述经评估有效。它在科学上基于统计机器学习和性能评估的原理，问题提出得当，信息充分，可得出唯一解，并且表述客观，没有歧义。所提供的模型评分分布假设是合理的，并允许进行严谨的解析推导。\n\n### 任务1：概念基础\n\n核心指标是针对给定的决策阈值 $t$ 和二元结局 $Y \\in \\{0,1\\}$ 定义的。模型评分用 $s$ 表示。\n\n**基本定义：**\n- **真正率（TPR）**，也称为**召回率（Recall）**或灵敏度，是在真实结局为阳性的条件下，预测为阳性的概率。\n$$\n\\text{TPR}(t) = \\text{Recall}(t) = \\Pr(s \\ge t | Y=1)\n$$\n- **假正率（FPR）**是在真实结局为阴性的条件下，预测为阳性的概率。\n$$\n\\text{FPR}(t) = \\Pr(s \\ge t | Y=0)\n$$\n- **精确率**，也称为阳性预测值（PPV），是在预测为阳性的条件下，真实结局为阳性的概率。使用贝叶斯定理，它可以表示为TPR、FPR和结局患病率 $\\pi = \\Pr(Y=1)$ 的函数。\n$$\n\\text{Precision}(t) = \\Pr(Y=1 | s \\ge t) = \\frac{\\Pr(s \\ge t | Y=1)\\Pr(Y=1)}{\\Pr(s \\ge t)} = \\frac{\\text{TPR}(t) \\cdot \\pi}{\\text{TPR}(t) \\cdot \\pi + \\text{FPR}(t) \\cdot (1-\\pi)}\n$$\n\n**AUROC和AUPRC的形式化定义：**\n- **受试者工作特征（ROC）曲线和AUROC**：ROC曲线是TPR对FPR的参数图，其参数为决策阈值 $t \\in [0, \\infty)$。该曲线描绘了当 $t$ 变化时 $(\\text{FPR}(t), \\text{TPR}(t))$ 的轨迹。ROC曲线下面积（AUROC）是该曲线的积分。令 $x = \\text{FPR}(t)$，AUROC的形式化定义为：\n$$\n\\text{AUROC} = \\int_{x=0}^{x=1} \\text{TPR}(\\text{FPR}^{-1}(x)) dx\n$$\nAUROC表示随机选择一个阳性实例的得分高于随机选择一个阴性实例的得分的概率。\n\n- **精确率-召回率（PR）曲线和AUPRC**：PR曲线是精确率对召回率的参数图，其参数为决策阈值 $t$。该曲线描绘了当 $t$ 变化时 $(\\text{Recall}(t), \\text{Precision}(t))$ 的轨迹。PR曲线下面积（AUPRC）是该曲线的积分。令 $r = \\text{Recall}(t)$，AUPRC的形式化定义为：\n$$\n\\text{AUPRC} = \\int_{r=0}^{r=1} \\text{Precision}(\\text{Recall}^{-1}(r)) dr\n$$\n\n**低患病率下AUPRC与AUROC的比较：**\n关键区别在于它们对结局患病率 $\\pi$ 的敏感性。TPR和FPR的定义是以真实类别（分别为 $Y=1$ 或 $Y=0$）为条件的，因此独立于类别分布 $\\pi$。因此，仅是TPR和FPR函数的AUROC与患病率无关。\n\n然而，如其贝叶斯公式所示，精确率明确依赖于 $\\pi$。对于罕见不良事件，患病率 $\\pi$ 非常低（$\\pi \\ll 1$），阴性实例的数量 $(1-\\pi)$ 远超阳性实例的数量 $\\pi$。在精确率公式的分母 $\\text{TPR}(t) \\cdot \\pi + \\text{FPR}(t) \\cdot (1-\\pi)$ 中，第二项 $\\text{FPR}(t) \\cdot (1-\\pi)$ 占主导地位。即使FPR很小，也可能导致大量的假阳性绝对数，从而显著降低精确率。\n\n例如，一个具有高AUROC（例如 $0.95$）的模型可能看起来非常出色，表明阳性和阴性类别的评分分布之间有很好的区分度。然而，在 $\\pi=0.001$ 的情况下，即使FPR为 $0.05$，也意味着每检测到 $1$ 个真阳性（假设TPR很高），大约会产生 $0.05 \\times (1/0.001 - 1) \\approx 50$ 个假阳性。精确率将极低（$\\approx 1/51$）。\n\nAUPRC直接捕捉了这种效应，因为它的纵轴是精确率。大量的假阳性会急剧拉低PR曲线，从而降低AUPRC。而AUROC由于与患病率无关，将保持高值，并可能在假阳性成本高昂的实际应用场景中，对模型性能给出一个具有误导性的乐观评估。因此，对于医疗健康领域典型的低患病率场景，AUPRC是衡量模型效用时一个信息更丰富、临床相关性更强的指标。\n\n### 任务2：建模与推导\n\n给定以结局 $Y$ 和子群 $g \\in \\{A, B\\}$ 为条件的评分密度函数。\n- 对于 $Y=1$ (两个子群)：$f_+(s) = \\lambda_+ \\exp(-\\lambda_+ s)$，其中 $\\lambda_+ = 1$。\n- 对于 $Y=0$，子群A：$f_{A-}(s) = \\lambda_{A-} \\exp(-\\lambda_{A-} s)$，其中 $\\lambda_{A-} = 2$。\n- 对于 $Y=0$，子群B：$f_{B-}(s) = \\lambda_{B-} \\exp(-\\lambda_{B-} s)$，其中 $\\lambda_{B-} = 3$。\n患病率为 $\\pi = \\Pr(Y=1) = 0.05$。\n\n率参数为 $\\lambda$ 的指数分布的生存函数为 $\\Pr(S \\ge s) = \\exp(-\\lambda s)$。\n\n首先，我们推导每个子群的阈值依赖的TPR（召回率）和FPR。\n**召回率（TPR）：** 这对两个子群是共同的，因为它们对于阳性案例（$Y=1$）具有相同的评分分布。\n$$\nr(t) = \\text{TPR}(t) = \\Pr(s \\ge t | Y=1) = \\exp(-\\lambda_+ t) = \\exp(-t)\n$$\n**假正率（FPR）：** 这是特定于子群的。\n对于子群A：\n$$\n\\text{FPR}_A(t) = \\Pr(s \\ge t | Y=0, g=A) = \\exp(-\\lambda_{A-} t) = \\exp(-2t)\n$$\n对于子群B：\n$$\n\\text{FPR}_B(t) = \\Pr(s \\ge t | Y=0, g=B) = \\exp(-\\lambda_{B-} t) = \\exp(-3t)\n$$\n\n现在，我们为每个子群推导精确率-召回率曲线 $P_g(r)$。PR曲线将精确率表示为召回率 $r$ 的函数。我们必须消除阈值参数 $t$。\n从召回率表达式 $r = \\exp(-t)$，我们得到 $t = -\\ln(r)$。\n我们现在可以用 $r$ 来重新表示FPR：\n$$\n\\text{FPR}_A(r) = \\exp(-2(-\\ln(r))) = \\exp(2\\ln(r)) = r^2\n$$\n$$\n\\text{FPR}_B(r) = \\exp(-3(-\\ln(r))) = \\exp(3\\ln(r)) = r^3\n$$\n使用精确率作为召回率 $r$ 及其对应 $\\text{FPR}(r)$ 的函数的一般公式：\n$$\nP(r) = \\frac{r \\cdot \\pi}{r \\cdot \\pi + \\text{FPR}(r) \\cdot (1-\\pi)}\n$$\n对于子群A：\n$$\nP_A(r) = \\frac{r\\pi}{r\\pi + r^2(1-\\pi)} = \\frac{\\pi}{\\pi + r(1-\\pi)}\n$$\n对于子群B：\n$$\nP_B(r) = \\frac{r\\pi}{r\\pi + r^3(1-\\pi)} = \\frac{\\pi}{\\pi + r^2(1-\\pi)}\n$$\n这些就是特定子群的PR曲线。\n\n接下来，我们通过对 $P_g(r)$ 从 $r=0$ 到 $r=1$ 积分来计算每个子群的AUPRC。\n**子群A的AUPRC：**\n$$\n\\text{AUPRC}_A = \\int_0^1 P_A(r) dr = \\int_0^1 \\frac{\\pi}{\\pi + r(1-\\pi)} dr\n$$\n我们使用换元法，令 $u = \\pi + r(1-\\pi)$，这意味着 $du = (1-\\pi)dr$。\n$$\n\\text{AUPRC}_A = \\pi \\int_\\pi^1 \\frac{1}{u} \\frac{du}{1-\\pi} = \\frac{\\pi}{1-\\pi} [\\ln(u)]_\\pi^1 = \\frac{\\pi}{1-\\pi} (\\ln(1) - \\ln(\\pi)) = -\\frac{\\pi \\ln(\\pi)}{1-\\pi}\n$$\n**子群B的AUPRC：**\n$$\n\\text{AUPRC}_B = \\int_0^1 P_B(r) dr = \\int_0^1 \\frac{\\pi}{\\pi + r^2(1-\\pi)} dr\n$$\n$$\n\\text{AUPRC}_B = \\frac{\\pi}{1-\\pi} \\int_0^1 \\frac{1}{\\frac{\\pi}{1-\\pi} + r^2} dr\n$$\n这是一个形如 $\\int \\frac{1}{a^2+x^2} dx = \\frac{1}{a}\\arctan(\\frac{x}{a})$ 的标准积分。这里 $a^2 = \\frac{\\pi}{1-\\pi}$。\n$$\n\\text{AUPRC}_B = \\frac{\\pi}{1-\\pi} \\left[ \\frac{1}{\\sqrt{\\frac{\\pi}{1-\\pi}}} \\arctan\\left(\\frac{r}{\\sqrt{\\frac{\\pi}{1-\\pi}}}\\right) \\right]_0^1\n$$\n$$\n\\text{AUPRC}_B = \\frac{\\pi}{1-\\pi} \\sqrt{\\frac{1-\\pi}{\\pi}} \\left( \\arctan\\left(\\sqrt{\\frac{1-\\pi}{\\pi}}\\right) - \\arctan(0) \\right) = \\sqrt{\\frac{\\pi}{1-\\pi}} \\arctan\\left(\\sqrt{\\frac{1-\\pi}{\\pi}}\\right)\n$$\n\n### 任务3：公平性转换与计算\n\n阈值 $t$ 下的精确率差距为 $\\Delta(t) = P_B(t) - P_A(t)$。\n每个子群的AUPRC是其各自PR曲线 $P_g(r)$ 下的面积。AUPRC的差异为 $\\text{AUPRC}_B - \\text{AUPRC}_A = \\int_0^1 (P_B(r) - P_A(r)) dr$。这是在从 $0$ 到 $1$ 的所有可能召回率水平上积分得到的平均精确率差距。\n\n鉴于各子群的 $\\lambda_+$ 和 $\\pi$ 相同，性能差异完全源于阴性案例（$Y=0$）的评分分布，这由 $\\lambda_{A-} = 2$ 和 $\\lambda_{B-} = 3$ 决定。较大的率参数 $\\lambda_-$ 意味着评分分布更集中于 $0$ 附近，使其更容易与阳性评分分布区分开。由于 $\\lambda_{B-} > \\lambda_{A-}$，模型在区分B子群的阴性案例方面表现更好。这导致在任何给定的阈值 $t > 0$ 下，B子群的FPR更低，即 $\\text{FPR}_B(t)  \\text{FPR}_A(t)$。\n\n从精确率公式 $P_g(t) = \\frac{\\text{TPR}(t)\\pi}{\\text{TPR}(t)\\pi + \\text{FPR}_g(t)(1-\\pi)}$ 来看，由于TPR和 $\\pi$ 是恒定的，较低的FPR直接导致较高的精确率。因此，对于所有 $t > 0$，都有 $P_B(t) > P_A(t)$。AUPRC的差异量化了B子群在所有召回率水平上相对于A子群的总体、聚合的精确率优势。精确率差距 $\\Delta(t)$ 是在由阈值 $t$ 定义的单个工作点上这种性能差异的具体体现。\n\n最后，我们计算当 $t=1$ 和 $\\pi=0.05$ 时 $\\Delta(1)$ 的数值。\n首先，计算在 $t=1$ 时每个子群的精确率。\n$$\nP_A(t) = \\frac{\\pi \\exp(-t)}{\\pi \\exp(-t) + (1-\\pi) \\exp(-\\lambda_{A-}t)} = \\frac{0.05 \\exp(-1)}{0.05 \\exp(-1) + 0.95 \\exp(-2)}\n$$\n$$\nP_B(t) = \\frac{\\pi \\exp(-t)}{\\pi \\exp(-t) + (1-\\pi) \\exp(-\\lambda_{B-}t)} = \\frac{0.05 \\exp(-1)}{0.05 \\exp(-1) + 0.95 \\exp(-3)}\n$$\n分子分母同除以 $\\exp(-1)$：\n$$\nP_A(1) = \\frac{0.05}{0.05 + 0.95 \\exp(-1)}\n$$\n$$\nP_B(1) = \\frac{0.05}{0.05 + 0.95 \\exp(-2)}\n$$\n现在，代入数值：\n$$\nP_A(1) = \\frac{0.05}{0.05 + 0.95 \\times 0.36787944...} = \\frac{0.05}{0.05 + 0.34948547...} = \\frac{0.05}{0.39948547...} \\approx 0.125161\n$$\n$$\nP_B(1) = \\frac{0.05}{0.05 + 0.95 \\times 0.13533528...} = \\frac{0.05}{0.05 + 0.12856852...} = \\frac{0.05}{0.17856852...} \\approx 0.280004\n$$\n精确率差距是：\n$$\n\\Delta(1) = P_B(1) - P_A(1) \\approx 0.280004 - 0.125161 = 0.154843\n$$\n四舍五入到四位有效数字，结果是 $0.1548$。",
            "answer": "$$\\boxed{0.1548}$$"
        }
    ]
}