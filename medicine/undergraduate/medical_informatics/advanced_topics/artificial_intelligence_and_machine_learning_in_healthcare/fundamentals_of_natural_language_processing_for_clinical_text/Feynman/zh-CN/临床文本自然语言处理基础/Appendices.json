{
    "hands_on_practices": [
        {
            "introduction": "将文本分段后，下一步往往是识别其中最重要的术语，这对于信息检索、文档排序和临床文本挖掘至关重要。TF-IDF (Term Frequency–Inverse Document Frequency) 是一种经典且强大的统计方法，用于评估一个词语在文档集合中的相对重要性。本练习将通过一个具体的临床场景，让你一步步计算 TF-IDF 值，从而加深对词频 ($TF$) 和逆文档频率 ($IDF$) 如何协同工作以突出关键信息的理解。",
            "id": "4841475",
            "problem": "正在开发一个临床搜索模块，用于索引医院病程记录，以便查询与呼吸系统疾病相关的术语。考虑一个由 $N$ 篇临床文档组成的语料库，其中 $N=5$。临床术语 $t=$ \"pneumonia\" 在这些文档中出现的原始计数由向量 $\\left[2,0,1,0,1\\right]$ 给出，按文档标识符 $d=1,2,3,4,5$ 排序。术语 \"pneumonia\" 至少出现一次的文档数量（也称为文档频率）为 $\\mathrm{df}=3$。从自然语言处理的信息检索中词频和逆文档频率的基本定义出发，将词频视为原始计数 $c(t,d)$，并将逆文档频率定义为语料库大小与文档频率之比的自然对数。使用标准的乘法词频-逆文档频率 (TF-IDF) 加权方案，计算每篇文档的 TF-IDF 值，并按 TF-IDF 值从高到低对文档进行排序。最后，确定所有 $N$ 篇文档的 TF-IDF 值的总和，并将最终答案表示为单个闭式解析表达式。只报告总和；不需要四舍五入，也不应包含单位。",
            "solution": "问题已根据所需标准进行验证。\n\n**步骤 1：提取已知条件**\n-   一个由 $N$ 篇临床文档组成的语料库，其中 $N=5$。\n-   一个临床术语，$t=$ \"pneumonia\"。\n-   术语 $t$ 在文档 $d=1,2,3,4,5$ 中的原始计数由向量 $\\begin{pmatrix} 2  0  1  0  1 \\end{pmatrix}$ 给出。\n-   术语的文档频率 $\\mathrm{df}$ 给出为 $\\mathrm{df}=3$。\n-   词频 $\\mathrm{tf}(t,d)$ 的定义是原始计数 $c(t,d)$。\n-   逆文档频率 $\\mathrm{idf}(t)$ 的定义是语料库大小与文档频率之比的自然对数，即 $\\mathrm{idf}(t) = \\ln\\left(\\frac{N}{\\mathrm{df}}\\right)$。\n-   加权方案是标准的乘法词频-逆文档频率 (TF-IDF)，即 $\\mathrm{tfidf}(t,d) = \\mathrm{tf}(t,d) \\times \\mathrm{idf}(t)$。\n-   最终目标是计算所有 $N$ 篇文档的 TF-IDF 值的总和。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题充分基于自然语言处理 (NLP) 和信息检索 (IR) 的基本原理，这些是医学信息学的核心组成部分。词频-逆文档频率 (TF-IDF) 是一种标准的、成熟的统计度量，用于评估一个词在集合或语料库中的一篇文档里的重要性。所提供的 TF（作为原始计数）和 IDF（使用自然对数）的定义是常见且有效的公式。\n-   **适定性与一致性**：该问题是适定的，为获得唯一解提供了所有必要的数据和定义。已知条件内部一致。原始计数向量 $\\begin{pmatrix} 2  0  1  0  1 \\end{pmatrix}$ 表明术语 \"pneumonia\" 出现在文档 1、3 和 5 中。这意味着该术语出现在 3 篇文档中。这与给定的文档频率 $\\mathrm{df}=3$ 相符。\n-   **客观性**：该问题以客观、精确的语言陈述，不含任何主观或基于意见的主张。\n-   **完整性与可行性**：该问题是自包含的，不需要外部信息。该场景是临床文本处理中一个简化但现实的应用。\n\n**步骤 3：结论与行动**\n问题被视为有效。将推导解答。\n\n**解答推导**\n\n问题要求计算术语 $t=$ \"pneumonia\" 在一个包含 $N=5$ 篇文档的语料库中所有 TF-IDF 分数的总和。\n\n首先，我们计算术语 $t$ 的逆文档频率 (IDF)。问题将 IDF 定义为：\n$$\n\\mathrm{idf}(t) = \\ln\\left(\\frac{N}{\\mathrm{df}}\\right)\n$$\n我们已知文档总数 $N=5$ 和该术语的文档频率 $\\mathrm{df}=3$。将这些值代入公式：\n$$\n\\mathrm{idf}(t) = \\ln\\left(\\frac{5}{3}\\right)\n$$\n对于语料库中的所有文档，这个值对于术语 $t$ 是恒定的。\n\n接下来，我们计算术语 $t$ 在每篇文档 $d$ 中的词频 (TF)。问题指出词频应被视为原始计数 $c(t,d)$。针对文档 $d=1,2,3,4,5$ 的原始计数以向量形式给出：\n-   $c(t,1) = 2$\n-   $c(t,2) = 0$\n-   $c(t,3) = 1$\n-   $c(t,4) = 0$\n-   $c(t,5) = 1$\n因此，每篇文档的 TF 值为 $\\mathrm{tf}(t,1)=2$、$\\mathrm{tf}(t,2)=0$、$\\mathrm{tf}(t,3)=1$、$\\mathrm{tf}(t,4)=0$ 和 $\\mathrm{tf}(t,5)=1$。\n\n现在，我们使用乘法定义 $\\mathrm{tfidf}(t,d) = \\mathrm{tf}(t,d) \\times \\mathrm{idf}(t)$ 来计算每篇文档的 TF-IDF 分数。\n-   对于文档 $d=1$：$\\mathrm{tfidf}(t,1) = \\mathrm{tf}(t,1) \\times \\mathrm{idf}(t) = 2 \\times \\ln\\left(\\frac{5}{3}\\right) = 2 \\ln\\left(\\frac{5}{3}\\right)$\n-   对于文档 $d=2$：$\\mathrm{tfidf}(t,2) = \\mathrm{tf}(t,2) \\times \\mathrm{idf}(t) = 0 \\times \\ln\\left(\\frac{5}{3}\\right) = 0$\n-   对于文档 $d=3$：$\\mathrm{tfidf}(t,3) = \\mathrm{tf}(t,3) \\times \\mathrm{idf}(t) = 1 \\times \\ln\\left(\\frac{5}{3}\\right) = \\ln\\left(\\frac{5}{3}\\right)$\n-   对于文档 $d=4$：$\\mathrm{tfidf}(t,4) = \\mathrm{tf}(t,4) \\times \\mathrm{idf}(t) = 0 \\times \\ln\\left(\\frac{5}{3}\\right) = 0$\n-   对于文档 $d=5$：$\\mathrm{tfidf}(t,5) = \\mathrm{tf}(t,5) \\times \\mathrm{idf}(t) = 1 \\times \\ln\\left(\\frac{5}{3}\\right) = \\ln\\left(\\frac{5}{3}\\right)$\n\n问题还要求按 TF-IDF 值从高到低对文档进行排序。由于 $\\frac{5}{3} > 1$，所以值 $\\ln(\\frac{5}{3}) > 0$。因此，排名由原始计数的大小决定：\n-   排名 1：文档 1 (TF-IDF = $2 \\ln(\\frac{5}{3})$)\n-   排名 2 (并列)：文档 3 和文档 5 (TF-IDF = $\\ln(\\frac{5}{3})$)\n-   排名 3 (并列)：文档 2 和文档 4 (TF-IDF = $0$)\n排名为 $d_1 > (d_3=d_5) > (d_2=d_4)$。\n\n最后，我们必须确定所有 $N$ 篇文档的 TF-IDF 值的总和。设此总和为 $S$。\n$$\nS = \\sum_{d=1}^{5} \\mathrm{tfidf}(t,d)\n$$\n$$\nS = \\mathrm{tfidf}(t,1) + \\mathrm{tfidf}(t,2) + \\mathrm{tfidf}(t,3) + \\mathrm{tfidf}(t,4) + \\mathrm{tfidf}(t,5)\n$$\n代入计算出的值：\n$$\nS = 2 \\ln\\left(\\frac{5}{3}\\right) + 0 + \\ln\\left(\\frac{5}{3}\\right) + 0 + \\ln\\left(\\frac{5}{3}\\right)\n$$\n我们可以将常数项 $\\mathrm{idf}(t) = \\ln(\\frac{5}{3})$ 因子提出来：\n$$\nS = \\left(2 + 0 + 1 + 0 + 1\\right) \\ln\\left(\\frac{5}{3}\\right)\n$$\n系数（即原始计数）的总和是 $2+0+1+0+1 = 4$。\n因此，总和为：\n$$\nS = 4 \\ln\\left(\\frac{5}{3}\\right)\n$$\n这就是所要求的总和的闭式解析表达式。",
            "answer": "$$\\boxed{4 \\ln\\left(\\frac{5}{3}\\right)}$$"
        },
        {
            "introduction": "一旦我们构建了模型来从文本中提取信息（如疾病或药物名称），我们就必须能够精确地衡量其性能。本练习聚焦于命名实体识别 (Named Entity Recognition, NER) 任务的评估，并阐释了两种关键指标的区别：基于词元 (token-level) 的评估和基于实体跨度 (span-level) 的评估。通过对一个具体案例进行计算，你将理解为什么高词元准确率有时会产生误导，以及为什么跨度级别的 $F_{1}$-分数通常是衡量 NER 系统性能的更实用、更严格的标准。",
            "id": "4841429",
            "problem": "一个临床命名实体识别系统在单个句子上进行评估，该句子被分词为 $10$ 个词元：$\\text{Patient}$ $(1)$, $\\text{has}$ $(2)$, $\\text{chest}$ $(3)$, $\\text{pain}$ $(4)$, $\\text{and}$ $(5)$, $\\text{shortness}$ $(6)$, $\\text{of}$ $(7)$, $\\text{breath}$ $(8)$, $\\text{denies}$ $(9)$, $\\text{fever}$ $(10)$。黄金标签（gold labels）对临床问题（clinical problem）实体类型使用 Begin–Inside–Outside (BIO) 标注方案，其中 $\\text{B-P}$ 表示问题片段（problem span）的开始，$\\text{I-P}$ 表示问题片段的内部，$\\text{O}$ 表示在任何问题片段之外的词元。这些词元的黄金 BIO 标签是：\n$(1)\\ \\text{O},\\ (2)\\ \\text{O},\\ (3)\\ \\text{B-P},\\ (4)\\ \\text{I-P},\\ (5)\\ \\text{O},\\ (6)\\ \\text{B-P},\\ (7)\\ \\text{I-P},\\ (8)\\ \\text{I-P},\\ (9)\\ \\text{O},\\ (10)\\ \\text{B-P}$。\n系统的预测 BIO 标签是：\n$(1)\\ \\text{B-P},\\ (2)\\ \\text{I-P},\\ (3)\\ \\text{B-P},\\ (4)\\ \\text{I-P},\\ (5)\\ \\text{O},\\ (6)\\ \\text{B-P},\\ (7)\\ \\text{I-P},\\ (8)\\ \\text{O},\\ (9)\\ \\text{O},\\ (10)\\ \\text{B-P}$。\n\n假设遵循以下基于标准信息检索定义的评估约定：\n- 词元级评估将 BIO 标签分配视为每个词元的单标签多类别决策，词元级 $F_1$-分数是所有 $10$ 个词元上，所有 BIO 类别的词元级精确率和词元级召回率的微观平均（micro-averaged）调和平均值。\n- 片段级评估将每个连续的问题片段视为一个单元，一个预测的片段仅在其边界和实体类型与黄金片段完全匹配时才被计为正确。片段级 $F_1$-分数是根据该句子中所有片段的片段级精确率和片段级召回率计算得出的。\n\n已知有 $7$ 个词元的预测 BIO 标签与黄金标签完全匹配，而只有 $2$ 个预测片段与黄金片段完全匹配。仅使用上述定义作为基本依据，计算：\n- $10$ 个词元上的词元级微观平均 $F_1$-分数，以及\n- 预测片段和黄金片段上的片段级完全匹配 $F_1$-分数。\n\n将两个 $F_1$-分数均四舍五入到四位有效数字。最终答案以小数形式表示，不带任何单位。",
            "solution": "该问题经评估有效。它在科学上基于自然语言处理评估的原则，问题设定良好，数据充分且一致，并以客观的语言表述。所提供的摘要统计数据（“$7$ 个词元的预测 BIO 标签与黄金标签完全匹配”和“$2$ 个预测片段与黄金片段完全匹配”）与原始数据一致，证实了问题陈述的自洽性。因此，我们可以着手求解。\n\n问题要求计算两个不同的指标：词元级的微观平均 $F_1$-分数和片段级的完全匹配 $F_1$-分数。我们将依次解决这两个问题。\n\n### 第 1 部分：词元级微观平均 $F_1$-分数\n\n评估是在词元级别进行的，其中 $N=10$ 个词元中的每一个都被分配一个来自集合 $\\{\\text{B-P, I-P, O}\\}$ 的 BIO 标签。这是一个单标签多类别分类任务。词元级 $F_1$-分数被定义为精确率和召回率的微观平均调和平均值。\n\n在微观平均中，我们在计算指标之前，对每个类别的真正例（$TP$）、假正例（$FP$）和假反例（$FN$）进行求和。设类别集合为 $C = \\{\\text{B-P, I-P, O}\\}$。\n微观平均精确率（$P_{\\text{micro}}$）由下式给出：\n$$ P_{\\text{micro}} = \\frac{\\sum_{c \\in C} TP_c}{\\sum_{c \\in C} (TP_c + FP_c)} $$\n微观平均召回率（$R_{\\text{micro}}$）由下式给出：\n$$ R_{\\text{micro}} = \\frac{\\sum_{c \\in C} TP_c}{\\sum_{c \\in C} (TP_c + FN_c)} $$\n\n对于一个在固定数量项目（词元）上的单标签分类任务，预测的总数等于真实标签（ground truth labels）的总数，也就是词元的总数 $N$。\n$P_{\\text{micro}}$ 的分母 $\\sum_{c \\in C} (TP_c + FP_c)$ 表示系统做出的预测总数，即 $N=10$。\n$R_{\\text{micro}$ 的分母 $\\sum_{c \\in C} (TP_c + FN_c)$ 表示黄金标准标签的总数，也即 $N=10$。\n分子 $\\sum_{c \\in C} TP_c$ 是所有类别中被正确分类的词元总数。这也就是预测标签与黄金标签匹配的词元总数。\n\n问题陈述中明确给出了这个数字：“$7$ 个词元的预测 BIO 标签与黄金标签完全匹配”。\n设 $N_{\\text{correct}} = 7$ 为正确分类的词元数，$N_{\\text{total}} = 10$ 为总词元数。\n\n因此，我们有：\n$$ P_{\\text{micro}} = \\frac{N_{\\text{correct}}}{N_{\\text{total}}} = \\frac{7}{10} = 0.7 $$\n$$ R_{\\text{micro}} = \\frac{N_{\\text{correct}}}{N_{\\text{total}}} = \\frac{7}{10} = 0.7 $$\n\n对于任何每个项目仅被分配一个标签的多类别分类问题，微观平均精确率、召回率和 $F_1$-分数都等于整体准确率。\n词元级微观平均 $F_1$-分数（$F_{1, \\text{token}}$）是 $P_{\\text{micro}}$ 和 $R_{\\text{micro}}$ 的调和平均值：\n$$ F_{1, \\text{token}} = 2 \\times \\frac{P_{\\text{micro}} \\times R_{\\text{micro}}}{P_{\\text{micro}} + R_{\\text{micro}}} $$\n由于 $P_{\\text{micro}} = R_{\\text{micro}}$，我们有 $F_{1, \\text{token}} = P_{\\text{micro}} = R_{\\text{micro}}$。\n$$ F_{1, \\text{token}} = 0.7 $$\n按要求四舍五入到四位有效数字，得到 $0.7000$。\n\n### 第 2 部分：片段级完全匹配 $F_1$-分数\n\n对于片段级评估，我们首先从黄金和预测的 BIO 标签中识别出连续的问题片段。一个片段是一个以 `B-P` 标签开始，后跟零个或多个 `I-P` 标签的词元序列。\n\n**黄金片段（Ground Truth）：**\n黄金标签为：O, O, B-P, I-P, O, B-P, I-P, I-P, O, B-P。\n- `chest pain`: 词元 $3$ (`B-P`) 和 $4$ (`I-P`)。\n- `shortness of breath`: 词元 $6$ (`B-P`)、$7$ (`I-P`) 和 $8$ (`I-P`)。\n- `fever`: 词元 $10$ (`B-P`)。\n所以，有 $3$ 个黄金片段。设 $N_{\\text{gold}} = 3$。\n\n**预测片段（System Output）：**\n预测标签为：B-P, I-P, B-P, I-P, O, B-P, I-P, O, O, B-P。\n- `Patient has`: 词元 $1$ (`B-P`) 和 $2$ (`I-P`)。\n- `chest pain`: 词元 $3$ (`B-P`) 和 $4$ (`I-P`)。\n- `shortness of`: 词元 $6$ (`B-P`) 和 $7$ (`I-P`)。\n- `fever`: 词元 $10$ (`B-P`)。\n所以，有 $4$ 个预测片段。设 $N_{\\text{predicted}} = 4$。\n\n现在我们计算片段的真正例（$TP$）、假正例（$FP$）和假反例（$FN$）的数量。如果一个预测片段在边界和实体类型上都与一个黄金片段完全匹配，则它是一个真正例。\n\n- **真正例 ($TP$)**：与黄金片段完全匹配的预测片段数量。\n  - 预测的 `chest pain` (词元 $3$-$4$) 与黄金的 `chest pain` (词元 $3$-$4$) 匹配。这是一个 $TP$。\n  - 预测的 `fever` (词元 $10$) 与黄金的 `fever` (词元 $10$) 匹配。这是第二个 $TP$。\n  - 另外两个预测片段没有与任何黄金片段完全匹配。\n  - 因此，$TP = 2$。这与问题陈述一致：“$2$ 个预测片段与黄金片段完全匹配”。\n\n- **假正例 ($FP$)**：不是真正例的预测片段数量。\n  - $FP = N_{\\text{predicted}} - TP = 4 - 2 = 2$。\n  - 假正例片段是 `Patient has` (词元 $1$-$2$) 和 `shortness of` (词元 $6$-$7$)。\n\n- **假反例 ($FN$)**：未被任何预测片段匹配的黄金片段数量。\n  - $FN = N_{\\text{gold}} - TP = 3 - 2 = 1$。\n  - 假反例片段是 `shortness of breath` (词元 $6$-$8$)。系统的预测 `shortness of` (词元 6-7) 是一个部分匹配，但在完全匹配准则下，它不被算作正确预测，因此该黄金片段被视为漏报。\n\n有了这些值，我们可以计算片段级精确率（$P_{\\text{span}}$）和召回率（$R_{\\text{span}}$）。\n$$ P_{\\text{span}} = \\frac{TP}{TP + FP} = \\frac{2}{2 + 2} = \\frac{2}{4} = \\frac{1}{2} = 0.5 $$\n$$ R_{\\text{span}} = \\frac{TP}{TP + FN} = \\frac{2}{2 + 1} = \\frac{2}{3} $$\n\n片段级 $F_1$-分数（$F_{1, \\text{span}}$）是 $P_{\\text{span}}$ 和 $R_{\\text{span}}$ 的调和平均值：\n$$ F_{1, \\text{span}} = 2 \\times \\frac{P_{\\text{span}} \\times R_{\\text{span}}}{P_{\\text{span}} + R_{\\text{span}}} = 2 \\times \\frac{\\frac{1}{2} \\times \\frac{2}{3}}{\\frac{1}{2} + \\frac{2}{3}} $$\n$$ F_{1, \\text{span}} = 2 \\times \\frac{\\frac{1}{3}}{\\frac{3}{6} + \\frac{4}{6}} = 2 \\times \\frac{\\frac{1}{3}}{\\frac{7}{6}} = 2 \\times \\frac{1}{3} \\times \\frac{6}{7} = \\frac{4}{7} $$\n将其表示为四舍五入到四位有效数字的小数：\n$$ F_{1, \\text{span}} = \\frac{4}{7} \\approx 0.57142857... $$\n四舍五入得到 $0.5714$。\n\n计算出的两个值是：\n- 词元级微观平均 $F_1$-分数：$0.7000$\n- 片段级完全匹配 $F_1$-分数：$0.5714$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.7000  0.5714 \\end{pmatrix} } $$"
        }
    ]
}