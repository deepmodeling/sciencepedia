{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在将关系代数的理论概念与其在SQL中的实际应用联系起来。通过这个练习，你将理解关系代数中的集合语义与SQL中默认的多重集合（或称“包”）语义之间的关键区别，并学会如何使用`DISTINCT`关键字来获取唯一的、基于集合的结果，这是确保数据检索准确性的基础技能。",
            "id": "4845746",
            "problem": "一家医院维护着一个实验室观察关系 $\\text{Observation}(\\text{obs\\_id}, \\text{pid}, \\text{loinc\\_code}, \\text{value}, \\text{effective\\_time})$，其中 $\\text{obs\\_id}$ 是主键，$\\text{pid}$ 是引用患者主记录的患者标识符 (PID)。Logical Observation Identifiers Names and Codes (LOINC) 使用标准化代码来表示实验室检验；LOINC 代码 $\\text{'718-7'}$ 代表血液血红蛋白检验。该数据管理系统基于结构化查询语言 (SQL)，默认情况下使用包语义，除非明确要求消除重复项。\n\n仅使用关系代数选择和投影的核心定义，以及集合语义与包语义的概念：\n- 推导关系代数表达式，该表达式返回在 $\\text{Observation}$ 中至少有一条血红蛋白观察记录的唯一患者标识符集合。\n- 给出一个返回相同标识符集合的等效 SQL 查询，并通过引用选择、投影和消除重复项的语义来证明其等效性。\n\n对于 $\\text{Observation}$ 关系的一个特定摘录，假设 $\\text{loinc\\_code} = \\text{'718-7'}$ 的行在患者中的分布如下：\n- $450$ 名患者恰好有 $1$ 条这样的行。\n- $380$ 名患者恰好有 $2$ 条这样的行。\n- $250$ 名患者恰好有 $3$ 条这样的行。\n- $20$ 名患者恰好有 $4$ 条这样的行。\n- $100$ 名患者恰好有 $5$ 条这样的行。\n\n假设除了上述患者之外，没有其他患者的 $\\text{loinc\\_code} = \\text{'718-7'}$，并且任何系统级别的重复都已反映在上述计数中。在这些条件下，计算您的 SQL 查询返回的不同患者标识符的数量。将最终数值答案表示为整数。",
            "solution": "我们从关系模型中的核心定义开始：\n\n- 选择：对于一个关系 $R$ 和一个谓词 $\\theta$，选择算子 $\\sigma_{\\theta}(R)$ 返回 $R$ 中满足 $\\theta$ 的元组子集。它在筛选行的同时保留 $R$ 的所有属性。\n- 投影：对于一个关系 $R$ 和一个属性列表 $A$，投影算子 $\\pi_{A}(R)$ 返回限制在属性 $A$ 上的元组集合，并消除重复的元组，因为关系代数使用集合语义。\n\n在 SQL（结构化查询语言）中，不带 $\\text{DISTINCT}$ 的查询返回一个行的包（多重集），可能包含重复项。添加 $\\text{DISTINCT}$ 会强制消除重复项，使结果与关系代数投影中的集合语义保持一致。\n\n任务1：推导关系代数表达式。我们想要获得至少有一个血红蛋白观察记录的唯一患者标识符集合。设血红蛋白代码为 $\\text{'718-7'}$。我们首先使用选择操作来选取血红蛋白的行，然后投影患者标识符属性：\n$$\n\\pi_{\\text{pid}}\\big(\\sigma_{\\text{loinc\\_code}=\\text{'718-7'}}(\\text{Observation})\\big).\n$$\n根据定义，$\\sigma_{\\text{loinc\\_code}=\\text{'718-7'}}(\\text{Observation})$ 将关系筛选为 LOINC 代码等于 $\\text{'718-7'}$ 的行，然后 $\\pi_{\\text{pid}}(\\cdot)$ 提取患者标识符并移除重复项，从而得到一个唯一的 PID 集合。\n\n任务2：给出一个等效的 SQL 查询并证明其等效性。与之对应的 SQL 查询通过 $\\text{WHERE}$ 反映选择操作，并通过 $\\text{DISTINCT}$ 反映带消除重复项的投影操作，该查询如下：\n`SELECT DISTINCT pid FROM Observation WHERE loinc_code = '718-7';`\n该查询与关系代数表达式一致，因为：\n- $\\text{WHERE}$ 子句 `loinc_code = '718-7'` 是选择操作 $\\sigma_{\\text{loinc\\_code}=\\text{'718-7'}}$ 的 SQL 实现。\n- `SELECT DISTINCT pid` 是带消除重复项的投影操作 $\\pi_{\\text{pid}}$ 的 SQL 实现。如果没有 `DISTINCT`，SQL 将返回一个包，对于有多个血红蛋白观察记录的患者，可能会重复其 `pid` 值；而使用 `DISTINCT`，重复项被移除以返回一个集合，这与关系代数的语义相匹配。\n\n任务3：计算返回的不同患者标识符的数量。设 $x_{k}$ 表示在 $\\text{Observation}$ 中恰好有 $k$ 行满足 $\\text{loinc\\_code}=\\text{'718-7'}$ 的患者数量。查询返回的不同患者的数量是至少有一条此类行的患者总数，即所有 $x_{k}$ 的总和：\n$$\n\\text{distinct\\_patients} \\;=\\; \\sum_{k \\ge 1} x_{k}.\n$$\n根据问题数据：\n- $x_{1} = 450$,\n- $x_{2} = 380$,\n- $x_{3} = 250$,\n- $x_{4} = 20$,\n- $x_{5} = 100$.\n\n因此，\n$$\n\\text{distinct\\_patients} \\;=\\; 450 + 380 + 250 + 20 + 100 \\;=\\; 1{,}200.\n$$\n無需四舍五入，因为在给定假设下这是一个精确的整数计数。这个值与底层表（每个患者有多行）的包语义以及关系代数中的投影或SQL中的 `DISTINCT` 所强制执行的集合语义一致：无论每个患者有多少条血红蛋白行，每个符合条件的患者都只向结果集贡献一个标识符。",
            "answer": "$$\\boxed{1200}$$"
        },
        {
            "introduction": "现实世界中的健康数据往往是不完整的。本练习探讨了在SQL查询中处理`NULL`值的关键议题，并展示了不恰当的处理方法（例如，用一个默认值如0来替换`NULL`）如何导致严重的分类错误。通过对比一个有缺陷的方法和一个逻辑上严谨的方法，你将学会编写能够正确处理缺失信息的稳健查询，这是保证数据质量的一项至关重要的技能。",
            "id": "4845761",
            "problem": "一家医院维护着一张门诊血压记录表，包含 `patient_id`、`encounter_id`、`systolic_mmHg` 和 `diastolic_mmHg` 这几列。`systolic_mmHg` 和 `diastolic_mmHg` 的值可能缺失，在结构化查询语言 (SQL) 中表示为 `NULL`。给定以下一组行，每一行描述一次门诊记录。对于每一行，其属性以有序元组 (`patient_id`, `encounter_id`, `systolic_mmHg`, `diastolic_mmHg`) 的形式显示。数值的单位是毫米汞柱，其值或者是一个非负整数，或者是 `NULL`。\n\n- (A01, E001, $142$, $88$)\n- (A01, E002, NULL, $91$)\n- (B07, E003, $138$, NULL)\n- (B07, E004, NULL, NULL)\n- (C12, E005, $129$, $79$)\n- (C12, E006, $170$, NULL)\n- (D22, E007, NULL, $85$)\n- (D22, E008, NULL, $95$)\n- (E31, E009, $200$, $110$)\n- (E31, E010, $139$, $90$)\n- (F45, E011, $100$, NULL)\n- (F45, E012, $140$, $89$)\n\n在此情境下，用于识别正常血压记录的临床规则是：收缩压严格小于 $140$ 且舒张压严格小于 $90$。在 SQL 中，`NULL` 参与三值逻辑运算，只有当 `WHERE` 子句中的谓词求值为“真”(true)时，该行才会被选中。函数 $\\mathrm{COALESCE}$ 返回其参数中第一个非 `NULL` 的值。\n\n一位分析师提出了一种简单的正常血压查询方法，该方法在应用临床阈值之前，使用 $\\mathrm{COALESCE}$ 函数将缺失的数值替换为 $0$。另一位分析师则认为，正确的查询必须以一种尊重三值逻辑的方式来实现该临床规则，不为缺失数据捏造生理学数值，并通过应用恰当的过滤器来避免错误分类。\n\n从上述核心定义出发，通过对 SQL 三值逻辑和 $\\mathrm{COALESCE}$ 函数行为的推理，推导出在存在 `NULL` 值的情况下，SQL `WHERE` 子句应该用来识别正常血压记录的逻辑上正确的谓词。然后，确定数据集中有多少条记录会被简单的“将缺失值替换为 $0$”的方法错误地标记为正常血压，但不会被正确的方法标记为正常血压。\n\n将您的最终答案以单个整数形式报告。无需四舍五入。报告的答案中不要包含任何单位。",
            "solution": "该问题要求对两种不同的结构化查询语言 (SQL) 谓词公式进行严谨分析，这两种公式用于从一个包含缺失值（表示为 `NULL`）的数据集中识别正常血压的患者记录。目标是量化与逻辑正确的方法相比，被简单方法错误分类的记录数量。\n\n首先，我们必须在 SQL 三值逻辑的框架内，正式定义临床规则以及两种提议的谓词的行为。\n\n正常血压记录的临床规则定义为：收缩压严格小于 $140$ 毫米汞柱，舒张压严格小于 $90$ 毫米汞柱。设 $S$ 代表 `systolic_mmHg`，$D$ 代表 `diastolic_mmHg`。该条件是一个逻辑合取式：\n$$ (S  140) \\land (D  90) $$\n\n在 SQL 中，任何涉及 `NULL` 值的比较（例如 `NULL  140` 或 `138  NULL`）的求值结果不是 `TRUE` 或 `FALSE`，而是第三个逻辑值 `UNKNOWN`。逻辑 `AND` 运算符与 `UNKNOWN` 的运算规则如下：\n- `TRUE AND UNKNOWN` 的求值结果是 `UNKNOWN`。\n- `FALSE AND UNKNOWN` 的求值结果是 `FALSE`。\n- `UNKNOWN AND UNKNOWN` 的求值结果是 `UNKNOWN`。\n\nSQL 的 `WHERE` 子句通过只包含那些指定谓词求值为 `TRUE` 的行来筛选结果集。谓词求值为 `FALSE` 或 `UNKNOWN` 的行将被排除。\n\n现在我们分析这两种方法：\n\n**1. 正确的谓词**\n一个逻辑上合理的临床规则实现必须尊重在信息不完整时无法做出明确分类的原则。将该规则直接翻译成 SQL 谓词即可实现这一点：\n$$ \\text{Predicate}_{\\text{Correct}}: \\quad \\text{systolic\\_mmHg}  140 \\text{ AND } \\text{diastolic\\_mmHg}  90 $$\n要使该谓词求值为 `TRUE`，`systolic_mmHg` 和 `diastolic_mmHg` 都必须非 `NULL`，并且必须满足各自的不等式。如果任一值为 `NULL`，其对应的比较结果为 `UNKNOWN`。除非另一个比较明确为 `FALSE`（这将使整个合取式为 `FALSE`），否则该谓词的求值结果将是 `UNKNOWN`，该行将正确地从正常血压记录集合中排除。这种方法不捏造数据，并遵守了缺失信息的语义。\n\n**2. 简单的谓词**\n简单方法首先使用 `COALESCE` 函数将 `NULL` 值替换为 $0$，然后应用比较：\n$$ \\text{Predicate}_{\\text{Naive}}: \\quad \\mathrm{COALESCE}(\\text{systolic\\_mmHg}, 0)  140 \\text{ AND } \\mathrm{COALESCE}(\\text{diastolic\\_mmHg}, 0)  90 $$\n这个谓词在科学上是不合理的，因为它为缺失数据赋予了一个非生理学的值（$0$ 毫米汞柱）。由于 `COALESCE` 总是返回一个非 `NULL` 值（在本例中，是原始测量值或 $0$），该谓词的求值结果将始终是 `TRUE` 或 `FALSE`，绝不会是 `UNKNOWN`。当数据缺失时，这种强制的二分法会导致错误分类。\n\n**目标**\n任务是找出 `Predicate_Naive` 求值为 `TRUE` 但 `Predicate_Correct` 求值不为 `TRUE`（即求值为 `FALSE` 或 `UNKNOWN`）的记录数量。\n\n我们现在将系统地用两个谓词来评估这 $12$ 条记录中的每一条。\n\n设 $P_C$ 为正确谓词的求值结果，$P_N$ 为简单谓词的求值结果。\n\n- **记录 E001:** ($142$, $88$)\n  - $P_C$: $(142  140) \\land (88  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(142, 0)  140) \\land (\\mathrm{COALESCE}(88, 0)  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **记录 E002:** (NULL, $91$)\n  - $P_C$: $(\\text{NULL}  140) \\land (91  90) \\rightarrow \\text{UNKNOWN} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(\\text{NULL}, 0)  140) \\land (\\mathrm{COALESCE}(91, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **记录 E003:** ($138$, NULL)\n  - $P_C$: $(138  140) \\land (\\text{NULL}  90) \\rightarrow \\text{TRUE} \\land \\text{UNKNOWN} \\rightarrow \\text{UNKNOWN}$\n  - $P_N$: $(\\mathrm{COALESCE}(138, 0)  140) \\land (\\mathrm{COALESCE}(\\text{NULL}, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - **错误分类：** 简单方法错误地将此记录标记为正常血压。\n\n- **记录 E004:** (NULL, NULL)\n  - $P_C$: $(\\text{NULL}  140) \\land (\\text{NULL}  90) \\rightarrow \\text{UNKNOWN} \\land \\text{UNKNOWN} \\rightarrow \\text{UNKNOWN}$\n  - $P_N$: $(\\mathrm{COALESCE}(\\text{NULL}, 0)  140) \\land (\\mathrm{COALESCE}(\\text{NULL}, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - **错误分类：** 简单方法错误地将此记录标记为正常血压。\n\n- **记录 E005:** ($129$, $79$)\n  - $P_C$: $(129  140) \\land (79  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - $P_N$: $(\\mathrm{COALESCE}(129, 0)  140) \\land (\\mathrm{COALESCE}(79, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - 无错误分类。\n\n- **记录 E006:** ($170$, NULL)\n  - $P_C$: $(170  140) \\land (\\text{NULL}  90) \\rightarrow \\text{FALSE} \\land \\text{UNKNOWN} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(170, 0)  140) \\land (\\mathrm{COALESCE}(\\text{NULL}, 0)  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **记录 E007:** (NULL, $85$)\n  - $P_C$: $(\\text{NULL}  140) \\land (85  90) \\rightarrow \\text{UNKNOWN} \\land \\text{TRUE} \\rightarrow \\text{UNKNOWN}$\n  - $P_N$: $(\\mathrm{COALESCE}(\\text{NULL}, 0)  140) \\land (\\mathrm{COALESCE}(85, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - **错误分类：** 简单方法错误地将此记录标记为正常血压。\n\n- **记录 E008:** (NULL, $95$)\n  - $P_C$: $(\\text{NULL}  140) \\land (95  90) \\rightarrow \\text{UNKNOWN} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(\\text{NULL}, 0)  140) \\land (\\mathrm{COALESCE}(95, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **记录 E009:** ($200$, $110$)\n  - $P_C$: $(200  140) \\land (110  90) \\rightarrow \\text{FALSE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(200, 0)  140) \\land (\\mathrm{COALESCE}(110, 0)  90) \\rightarrow \\text{FALSE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **记录 E010:** ($139$, $90$)\n  - $P_C$: $(139  140) \\land (90  90) \\rightarrow \\text{TRUE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(139, 0)  140) \\land (\\mathrm{COALESCE}(90, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **记录 E011:** ($100$, NULL)\n  - $P_C$: $(100  140) \\land (\\text{NULL}  90) \\rightarrow \\text{TRUE} \\land \\text{UNKNOWN} \\rightarrow \\text{UNKNOWN}$\n  - $P_N$: $(\\mathrm{COALESCE}(100, 0)  140) \\land (\\mathrm{COALESCE}(\\text{NULL}, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - **错误分类：** 简单方法错误地将此记录标记为正常血压。\n\n- **记录 E012:** ($140$, $89$)\n  - $P_C$: $(140  140) \\land (89  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(140, 0)  140) \\land (\\mathrm{COALESCE}(89, 0)  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n错误分类发生在记录 E003、E004、E007 和 E011。在所有这些情况下，正确的谓词求值为 `UNKNOWN`（因此该行不被选中），而简单的谓词求值为 `TRUE`（该行被错误地选中）。如此被错误标记的记录总数为 $4$。",
            "answer": "$$\\boxed{4}$$"
        },
        {
            "introduction": "在医学信息学中，一项核心任务是根据多种临床标准来定义和识别患者队列。本练习模拟了这一复杂过程，要求你使用集合运算（如交集、并集和差集）来组合诊断代码、实验室结果和时间窗口。通过此实践，你将巩固将复杂的临床研究问题转化为精确、多步骤数据库查询的能力，这是连接临床需求与数据分析的桥梁。",
            "id": "4845783",
            "problem": "一个卫生系统维护着两个核心关系表，这两个表遵循关系代数中的集合语义：诊断（Diagnosis）和观察（Observation）。在集合语义下，并集、交集和差集运算符会移除重复项，并对唯一的元组集合进行操作。在队列构建中，成员资格是在患者层面定义的：如果存在至少一个满足给定谓词的合格行，则该患者被包含在一个集合中。设国际疾病分类第十次修订版（ICD-10）编码代表诊断概念，血红蛋白A1c（HbA1c）是记录在观察表中的一项实验室观察指标。假设两个表都可能包含每个患者在不同时间的多行记录，并且患者标识符是唯一且稳定的。以下所有集合操作都是在唯一的患者标识符集合上定义的。\n\n给定以下从诊断表和观察表中提取的数据。每条记录列出了患者标识符、概念（ICD-10编码或HbA1c）以及从一个共同基准日开始计算的研究日索引（以整数天计）。天数为整数。\n\n诊断记录：\n- P01：E11.9于第 $30$ 天；E10.9于第 $15$ 天；I10于第 $40$ 天。\n- P02：E11.65于第 $25$ 天；J45.909于第 $60$ 天。\n- P03：E11.9于第 $5$ 天；E11.9于第 $110$ 天；E78.5于第 $45$ 天。\n- P04：E11.9于第 $80$ 天。\n- P05：E10.9于第 $50$ 天。\n- P06：E11.65于第 $95$ 天。\n- P07：I10于第 $70$ 天。\n- P08：E11.9于第 $35$ 天；E11.9于第 $90$ 天。\n- P09：E11.9于第 $150$ 天；E10.9于第 $180$ 天。\n- P10：E11.9于第 $20$ 天。\n- P11：E78.5于第 $55$ 天。\n- P12：E11.9于第 $15$ 天。\n\n观察记录（血红蛋白A1c值，以小数表示）：\n- P01：HbA1c $8.2$于第 $50$ 天；HbA1c $7.6$于第 $90$ 天。\n- P02：HbA1c $8.5$于第 $30$ 天。\n- P03：HbA1c $7.4$于第 $50$ 天；HbA1c $7.6$于第 $115$ 天。\n- P04：HbA1c $8.1$于第 $85$ 天；HbA1c $8.0$于第 $130$ 天。\n- P05：HbA1c $9.0$于第 $55$ 天。\n- P06：HbA1c $7.5$于第 $100$ 天；HbA1c $7.8$于第 $140$ 天。\n- P07：HbA1c $8.3$于第 $10$ 天；HbA1c $8.6$于第 $25$ 天。\n- P08：HbA1c $7.2$于第 $40$ 天；HbA1c $7.6$于第 $92$ 天。\n- P09：HbA1c $8.4$于第 $160$ 天；HbA1c $7.7$于第 $100$ 天。\n- P10：HbA1c $7.0$于第 $50$ 天；HbA1c $8.1$于第 $75$ 天。\n- P11：HbA1c $8.2$于第 $60$ 天。\n- P12：HbA1c $7.6$于第 $16$ 天；HbA1c $7.6$于第 $22$ 天。\n\n使用诊断和观察谓词以及研究日窗口定义以下患者层面的集合：\n- 集合 $\\mathcal{A}$：在包含性窗口 $[10, 100]$ 内的某一天，至少有一次2型糖尿病诊断的患者，定义为ICD-10编码在 $\\{\\text{E11.9}, \\text{E11.65}\\}$ 中。\n- 集合 $\\mathcal{B}$：在包含性窗口 $[20, 120]$ 内的某一天，至少有一次HbA1c值 $\\geq 8.0$ 记录的患者。\n- 集合 $\\mathcal{C}$（排除）：在包含性窗口 $[0, 200]$ 内的某一天，有任何1型糖尿病诊断的患者，定义为ICD-10编码形式为 $\\text{E10.*}$（例如，E10.9）。\n- 集合 $\\mathcal{D}$：在包含性窗口 $[20, 150]$ 内的两个不同日期，至少有两次HbA1c值 $\\geq 7.5$ 记录的患者。\n\n最终的队列由集合表达式定义\n$$\n\\mathcal{S} \\;=\\; \\big(\\,(\\mathcal{A} \\cap \\mathcal{B}) \\,\\cup\\, \\mathcal{D}\\,\\big)\\; \\setminus\\; \\mathcal{C},\n$$\n其中每个集合的成员资格都在患者层面（一个患者在任何集合中最多出现一次），并且所有运算符都使用集合语义。\n\n计算 $\\mathcal{S}$ 中唯一患者的数量。以整数形式表示您的答案。",
            "solution": "首先对用户提供的问题进行严格的验证过程。\n\n### 步骤1：提取已知信息\n- **数据源1（诊断）：** 一组包含患者标识符、ICD-10编码和研究日的记录。\n  - $P_{01}$：E11.9于第 $30$ 天；E10.9于第 $15$ 天；I10于第 $40$ 天。\n  - $P_{02}$：E11.65于第 $25$ 天；J45.909于第 $60$ 天。\n  - $P_{03}$：E11.9于第 $5$ 天；E11.9于第 $110$ 天；E78.5于第 $45$ 天。\n  - $P_{04}$：E11.9于第 $80$ 天。\n  - $P_{05}$：E10.9于第 $50$ 天。\n  - $P_{06}$：E11.65于第 $95$ 天。\n  - $P_{07}$：I10于第 $70$ 天。\n  - $P_{08}$：E11.9于第 $35$ 天；E11.9于第 $90$ 天。\n  - $P_{09}$：E11.9于第 $150$ 天；E10.9于第 $180$ 天。\n  - $P_{10}$：E11.9于第 $20$ 天。\n  - $P_{11}$：E78.5于第 $55$ 天。\n  - $P_{12}$：E11.9于第 $15$ 天。\n- **数据源2（观察）：** 一组包含患者标识符、观察类型（HbA1c）、值和研究日的记录。\n  - $P_{01}$：HbA1c $8.2$于第 $50$ 天；HbA1c $7.6$于第 $90$ 天。\n  - $P_{02}$：HbA1c $8.5$于第 $30$ 天。\n  - $P_{03}$：HbA1c $7.4$于第 $50$ 天；HbA1c $7.6$于第 $115$ 天。\n  - $P_{04}$：HbA1c $8.1$于第 $85$ 天；HbA1c $8.0$于第 $130$ 天。\n  - $P_{05}$：HbA1c $9.0$于第 $55$ 天。\n  - $P_{06}$：HbA1c $7.5$于第 $100$ 天；HbA1c $7.8$于第 $140$ 天。\n  - $P_{07}$：HbA1c $8.3$于第 $10$ 天；HbA1c $8.6$于第 $25$ 天。\n  - $P_{08}$：HbA1c $7.2$于第 $40$ 天；HbA1c $7.6$于第 $92$ 天。\n  - $P_{09}$：HbA1c $8.4$于第 $160$ 天；HbA1c $7.7$于第 $100$ 天。\n  - $P_{10}$：HbA1c $7.0$于第 $50$ 天；HbA1c $8.1$于第 $75$ 天。\n  - $P_{11}$：HbA1c $8.2$于第 $60$ 天。\n  - $P_{12}$：HbA1c $7.6$于第 $16$ 天；HbA1c $7.6$于第 $22$ 天。\n- **集合定义：**\n  - 集合 $\\mathcal{A}$：在日期 $d \\in [10, 100]$ 内，有 $\\geq 1$ 次2型糖尿病诊断（$\\text{ICD-10} \\in \\{\\text{E11.9}, \\text{E11.65}\\}$）的患者。\n  - 集合 $\\mathcal{B}$：在日期 $d \\in [20, 120]$ 内，有 $\\geq 1$ 次HbA1c值 $v \\geq 8.0$ 记录的患者。\n  - 集合 $\\mathcal{C}$：在日期 $d \\in [0, 200]$ 内，有任何1型糖尿病诊断（$\\text{ICD-10}$ 形式为 $\\text{E10.*}$）的患者。\n  - 集合 $\\mathcal{D}$：在两个不同日期 $d_{1}, d_{2}$（其中 $d_{1}, d_{2} \\in [20, 150]$ 且 $d_1 \\neq d_2$）有 $\\geq 2$ 次HbA1c值 $v \\geq 7.5$ 记录的患者。\n- **最终集合表达式：** $\\mathcal{S} = ((\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D}) \\setminus \\mathcal{C}$。\n- **目标：** 计算 $|\\mathcal{S}|$，即最终集合 $\\mathcal{S}$ 中的唯一患者数量。\n\n### 步骤2：使用提取的已知信息进行验证\n该问题具有科学依据，使用了医学信息学（ICD-10编码、HbA1c实验室值、队列定义）和数学（集合论）的标准概念。定义精确无歧义。所提供的数据是自包含的，足以执行所需的计算。问题提法得当，会导出一个唯一的整数解。不存在科学、逻辑或事实上的缺陷。\n\n### 步骤3：结论与行动\n该问题被判定为**有效**。将提供完整的解答。\n\n### 解答推导\n解答通过根据所提供的数据和定义构建四个集合（$\\mathcal{A}, \\mathcal{B}, \\mathcal{C}, \\mathcal{D}$），然后应用指定的集合运算来找到最终队列 $\\mathcal{S}$。\n\n**1. 构建集合 $\\mathcal{A}$**\n集合 $\\mathcal{A}$ 包括在包含性区间 $[10, 100]$ 内的某一天，至少有一次诊断编码来自 $\\{\\text{E11.9}, \\text{E11.65}\\}$ 的患者。\n- $P_{01}$：E11.9于第 $30$ 天。是 ($30 \\in [10, 100]$)。\n- $P_{02}$：E11.65于第 $25$ 天。是 ($25 \\in [10, 100]$)。\n- $P_{03}$：E11.9于第 $5$ 天（太早），第 $110$ 天（太晚）。否。\n- $P_{04}$：E11.9于第 $80$ 天。是 ($80 \\in [10, 100]$)。\n- $P_{05}$：E10.9不是此集合的有效编码。否。\n- $P_{06}$：E11.65于第 $95$ 天。是 ($95 \\in [10, 100]$)。\n- $P_{07}$：I10不是有效编码。否。\n- $P_{08}$：E11.9于第 $35$ 天和第 $90$ 天。是 ($35, 90 \\in [10, 100]$)。\n- $P_{09}$：E11.9于第 $150$ 天（太晚）。否。\n- $P_{10}$：E11.9于第 $20$ 天。是 ($20 \\in [10, 100]$)。\n- $P_{11}$：E78.5不是有效编码。否。\n- $P_{12}$：E11.9于第 $15$ 天。是 ($15 \\in [10, 100]$)。\n因此，患者集合为 $\\mathcal{A} = \\{P_{01}, P_{02}, P_{04}, P_{06}, P_{08}, P_{10}, P_{12}\\}$。\n\n**2. 构建集合 $\\mathcal{B}$**\n集合 $\\mathcal{B}$ 包括在 $[20, 120]$ 内的某一天，至少有一次HbA1c值 $\\geq 8.0$ 记录的患者。\n- $P_{01}$：$8.2$于第 $50$ 天。是 ($8.2 \\geq 8.0$ 且 $50 \\in [20, 120]$)。\n- $P_{02}$：$8.5$于第 $30$ 天。是 ($8.5 \\geq 8.0$ 且 $30 \\in [20, 120]$)。\n- $P_{03}$：值 $7.4, 7.6$ 均  $8.0$。否。\n- $P_{04}$：$8.1$于第 $85$ 天。是 ($8.1 \\geq 8.0$ 且 $85 \\in [20, 120]$)。\n- $P_{05}$：$9.0$于第 $55$ 天。是 ($9.0 \\geq 8.0$ 且 $55 \\in [20, 120]$)。\n- $P_{06}$：值 $7.5, 7.8$ 均  $8.0$。否。\n- $P_{07}$：$8.3$于第 $10$ 天（太早）；$8.6$于第 $25$ 天。是 ($8.6 \\geq 8.0$ 且 $25 \\in [20, 120]$)。\n- $P_{08}$：值 $7.2, 7.6$ 均  $8.0$。否。\n- $P_{09}$：$8.4$于第 $160$ 天（太晚）；$7.7$于第 $100$ 天（值太低）。否。\n- $P_{10}$：$8.1$于第 $75$ 天。是 ($8.1 \\geq 8.0$ 且 $75 \\in [20, 120]$)。\n- $P_{11}$：$8.2$于第 $60$ 天。是 ($8.2 \\geq 8.0$ 且 $60 \\in [20, 120]$)。\n- $P_{12}$：值为 $7.6  8.0$。否。\n因此，患者集合为 $\\mathcal{B} = \\{P_{01}, P_{02}, P_{04}, P_{05}, P_{07}, P_{10}, P_{11}\\}$。\n\n**3. 构建集合 $\\mathcal{C}$**\n集合 $\\mathcal{C}$ 是一个排除集合，包含在 $[0, 200]$ 内的某一天有任何以“E10”开头的诊断编码的患者。\n- $P_{01}$：E10.9于第 $15$ 天。是 ($15 \\in [0, 200]$)。\n- $P_{05}$：E10.9于第 $50$ 天。是 ($50 \\in [0, 200]$)。\n- $P_{09}$：E10.9于第 $180$ 天。是 ($180 \\in [0, 200]$)。\n所有其他患者都没有匹配E10.*的诊断编码。\n因此，患者集合为 $\\mathcal{C} = \\{P_{01}, P_{05}, P_{09}\\}$。\n\n**4. 构建集合 $\\mathcal{D}$**\n集合 $\\mathcal{D}$ 包括在 $[20, 150]$ 内的两个不同日期，至少有两次HbA1c值 $\\geq 7.5$ 记录的患者。\n- $P_{01}$：$8.2$于第 $50$ 天和 $7.6$于第 $90$ 天。是（在 $[20, 150]$ 内的不同日期有两个值 $\\geq 7.5$）。\n- $P_{02}$：只有一条记录。否。\n- $P_{03}$：$7.6$于第 $115$ 天。只有一条合格记录（$7.4  7.5$）。否。\n- $P_{04}$：$8.1$于第 $85$ 天和 $8.0$于第 $130$ 天。是（在 $[20, 150]$ 内的不同日期有两个值 $\\geq 7.5$）。\n- $P_{05}$：只有一条记录。否。\n- $P_{06}$：$7.5$于第 $100$ 天和 $7.8$于第 $140$ 天。是（在 $[20, 150]$ 内的不同日期有两个值 $\\geq 7.5$）。\n- $P_{07}$：$8.6$于第 $25$ 天。只有一条合格记录（第 $10$ 天超出范围）。否。\n- $P_{08}$：$7.6$于第 $92$ 天。只有一条合格记录（$7.2  7.5$）。否。\n- $P_{09}$：$7.7$于第 $100$ 天。只有一条合格记录（第 $160$ 天超出范围）。否。\n- $P_{10}$：$8.1$于第 $75$ 天。只有一条合格记录（$7.0  7.5$）。否。\n- $P_{11}$：只有一条记录。否。\n- $P_{12}$：$7.6$于第 $22$ 天。只有一条合格记录（第 $16$ 天超出范围）。否。\n因此，患者集合为 $\\mathcal{D} = \\{P_{01}, P_{04}, P_{06}\\}$。\n\n**5. 计算最终集合 $\\mathcal{S}$**\n最终队列 $\\mathcal{S}$ 是使用表达式 $\\mathcal{S} = ((\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D}) \\setminus \\mathcal{C}$ 计算的。\n首先，计算交集 $\\mathcal{A} \\cap \\mathcal{B}$：\n$\\mathcal{A} = \\{P_{01}, P_{02}, P_{04}, P_{06}, P_{08}, P_{10}, P_{12}\\}$\n$\\mathcal{B} = \\{P_{01}, P_{02}, P_{04}, P_{05}, P_{07}, P_{10}, P_{11}\\}$\n$\\mathcal{A} \\cap \\mathcal{B} = \\{P_{01}, P_{02}, P_{04}, P_{10}\\}$\n\n接下来，计算结果与 $\\mathcal{D}$ 的并集：\n$(\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D} = \\{P_{01}, P_{02}, P_{04}, P_{10}\\} \\cup \\{P_{01}, P_{04}, P_{06}\\}$\n$(\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D} = \\{P_{01}, P_{02}, P_{04}, P_{06}, P_{10}\\}$\n\n最后，计算与排除集合 $\\mathcal{C}$ 的差集：\n$\\mathcal{S} = ((\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D}) \\setminus \\mathcal{C} = \\{P_{01}, P_{02}, P_{04}, P_{06}, P_{10}\\} \\setminus \\{P_{01}, P_{05}, P_{09}\\}$\n患者 $P_{01}$ 存在于要减去的集合中，因此被移除。患者 $P_{05}$ 和 $P_{09}$ 不在中间集合中，因此它们在 $\\mathcal{C}$ 中的存在对结果没有影响。\n$\\mathcal{S} = \\{P_{02}, P_{04}, P_{06}, P_{10}\\}$\n\n最终集合 $\\mathcal{S}$ 中的唯一患者数量是该集合的基数，即 $|\\mathcal{S}|$。\n$|\\mathcal{S}| = |\\{P_{02}, P_{04}, P_{06}, P_{10}\\}| = 4$。\n最终答案是 $4$。",
            "answer": "$$\n\\boxed{4}\n$$"
        }
    ]
}