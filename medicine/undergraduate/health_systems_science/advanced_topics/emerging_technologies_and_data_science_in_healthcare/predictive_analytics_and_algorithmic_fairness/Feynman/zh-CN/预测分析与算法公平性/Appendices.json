{
    "hands_on_practices": [
        {
            "introduction": "在医疗保健领域应用预测模型时，首要任务之一是进行公平性审计，以确保模型不会对不同人群产生系统性的偏见。本练习提供了一个具体场景，您将利用分类模型评估的基础工具——混淆矩阵，来计算关键的性能指标，并评估一个重要的群体公平性标准：均等化赔率 (equalized odds)。通过这个实践，您将掌握从模型原始性能数据中量化和评估群体公平性的基本技能。",
            "id": "4390084",
            "problem": "一家医院部署了一个二元预测模型，在急诊科（ED）分诊时标记需要进行紧急脓毒症检查的患者。为了审查该模型在两个所考虑的人口群体间的算法公平性，分析师从一个具有代表性的评估队列中编制了混淆矩阵。对于A组，混淆矩阵的计数为 $\\text{TP}=80$，$\\text{FP}=20$，$\\text{FN}=40$，$\\text{TN}=860$。对于B组，计数为 $\\text{TP}=60$，$\\text{FP}=15$，$\\text{FN}=30$，$\\text{TN}=895$。使用基于混淆矩阵的标准分类指标定义，计算每个组的真阳性率（TPR）、假阳性率（FPR）和阳性预测值（PPV）。然后，评估均等化赔率准则，该准则要求各组间的真阳性率和假阳性率均相等，并指出该模型是否满足此准则。\n\n将您的最终结果以无单位比例（无百分号）的形式提供，并四舍五入到四位有效数字。以单行矩阵 $(\\text{TPR}_{A}, \\text{FPR}_{A}, \\text{PPV}_{A}, \\text{TPR}_{B}, \\text{FPR}_{B}, \\text{PPV}_{B}, I)$ 的形式报告您的最终答案，其中如果均等化赔率准则成立，则 $I$ 为 $1$，否则为 $0$。",
            "solution": "首先验证问题陈述的科学性、客观性和完整性。\n\n**步骤1：提取已知条件**\n-   对于A组，混淆矩阵计数为：真阳性（$\\text{TP}_A$）= $80$，假阳性（$\\text{FP}_A$）= $20$，假阴性（$\\text{FN}_A$）= $40$，真阴性（$\\text{TN}_A$）= $860$。\n-   对于B组，混淆矩阵计数为：真阳性（$\\text{TP}_B$）= $60$，假阳性（$\\text{FP}_B$）= $15$，假阴性（$\\text{FN}_B$）= $30$，真阴性（$\\text{TN}_B$）= $895$。\n-   待计算的指标：每个组的真阳性率（TPR）、假阳性率（FPR）和阳性预测值（PPV）。\n-   待评估的公平性准则：均等化赔率，要求各组间的TPR和FPR均相等。\n-   输出格式：一个行矩阵 $(\\text{TPR}_{A}, \\text{FPR}_{A}, \\text{PPV}_{A}, \\text{TPR}_{B}, \\text{FPR}_{B}, \\text{PPV}_{B}, I)$，其中 $I$ 是一个指示变量（如果均等化赔率成立则为 $1$，否则为 $0$）。\n-   四舍五入：最终比例需四舍五入到四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于机器学习和分类模型评估领域的标准、明确定义的指标（混淆矩阵、TPR、FPR、PPV）以及已建立的均等化赔率公平性准则。临床预测模型的背景是卫生系统科学中的一个标准应用领域。该问题在科学上是有效的。\n-   **良态问题**：该问题提供了计算所需指标和进行所要求评估的所有必要数据和清晰定义。保证存在唯一、稳定的解。\n-   **客观性**：该问题使用精确、定量和无偏见的语言陈述。\n\n**步骤3：结论与行动**\n该问题是有效的。它是自足的、有科学依据的并且是良态的。将计算解答。\n\n所需指标定义如下：\n-   真阳性率（TPR），或称灵敏度：被正确识别的实际阳性样本的比例。\n$$ \\text{TPR} = \\frac{\\text{TP}}{\\text{TP} + \\text{FN}} $$\n-   假阳性率（FPR），或称误报率：被错误识别为阳性的实际阴性样本的比例。\n$$ \\text{FPR} = \\frac{\\text{FP}}{\\text{FP} + \\text{TN}} $$\n-   阳性预测值（PPV），或称精确率：预测为阳性的样本中实际为阳性的比例。\n$$ \\text{PPV} = \\frac{\\text{TP}}{\\text{TP} + \\text{FP}} $$\n\n我们现在使用提供的数据为每个组计算这些指标。\n\n**对于A组：**\n-   $\\text{TP}_A = 80$，$\\text{FP}_A = 20$，$\\text{FN}_A = 40$，$\\text{TN}_A = 860$。\n-   实际阳性样本数为 $\\text{TP}_A + \\text{FN}_A = 80 + 40 = 120$。\n-   实际阴性样本数为 $\\text{FP}_A + \\text{TN}_A = 20 + 860 = 880$。\n-   预测为阳性的样本数为 $\\text{TP}_A + \\text{FP}_A = 80 + 20 = 100$。\n\n指标计算如下：\n$$ \\text{TPR}_A = \\frac{80}{80 + 40} = \\frac{80}{120} = \\frac{2}{3} \\approx 0.66666... $$\n四舍五入到四位有效数字，$\\text{TPR}_A = 0.6667$。\n\n$$ \\text{FPR}_A = \\frac{20}{20 + 860} = \\frac{20}{880} = \\frac{1}{44} \\approx 0.022727... $$\n四舍五入到四位有效数字，$\\text{FPR}_A = 0.02273$。\n\n$$ \\text{PPV}_A = \\frac{80}{80 + 20} = \\frac{80}{100} = 0.8 $$\n表示为四位有效数字，$\\text{PPV}_A = 0.8000$。\n\n**对于B组：**\n-   $\\text{TP}_B = 60$，$\\text{FP}_B = 15$，$\\text{FN}_B = 30$，$\\text{TN}_B = 895$。\n-   实际阳性样本数为 $\\text{TP}_B + \\text{FN}_B = 60 + 30 = 90$。\n-   实际阴性样本数为 $\\text{FP}_B + \\text{TN}_B = 15 + 895 = 910$。\n-   预测为阳性的样本数为 $\\text{TP}_B + \\text{FP}_B = 60 + 15 = 75$。\n\n指标计算如下：\n$$ \\text{TPR}_B = \\frac{60}{60 + 30} = \\frac{60}{90} = \\frac{2}{3} \\approx 0.66666... $$\n四舍五入到四位有效数字，$\\text{TPR}_B = 0.6667$。\n\n$$ \\text{FPR}_B = \\frac{15}{15 + 895} = \\frac{15}{910} = \\frac{3}{182} \\approx 0.0164835... $$\n四舍五入到四位有效数字，$\\text{FPR}_B = 0.01648$。\n\n$$ \\text{PPV}_B = \\frac{60}{60 + 15} = \\frac{60}{75} = \\frac{4}{5} = 0.8 $$\n表示为四位有效数字，$\\text{PPV}_B = 0.8000$。\n\n**均等化赔率评估：**\n均等化赔率准则要求模型同时满足 $\\text{TPR}_A = \\text{TPR}_B$ 和 $\\text{FPR}_A = \\text{FPR}_B$。\n-   比较TPR：$\\text{TPR}_A = 0.6667$ 且 $\\text{TPR}_B = 0.6667$。真阳性率相等（在指定精度内）。\n-   比较FPR：$\\text{FPR}_A = 0.02273$ 且 $\\text{FPR}_B = 0.01648$。假阳性率不相等。\n\n由于假阳性率不相等，均等化赔率准则不满足。因此，指示变量 $I$ 为 $0$。\n\n最终结果被整合为所需的行矩阵格式：$(\\text{TPR}_{A}, \\text{FPR}_{A}, \\text{PPV}_{A}, \\text{TPR}_{B}, \\text{FPR}_{B}, \\text{PPV}_{B}, I)$。\n这些值为 $(0.6667, 0.02273, 0.8000, 0.6667, 0.01648, 0.8000, 0)$。",
            "answer": "$$ \\boxed{\\begin{pmatrix} 0.6667  0.02273  0.8000  0.6667  0.01648  0.8000  0 \\end{pmatrix}} $$"
        },
        {
            "introduction": "群体公平性确保模型在宏观上对不同群体表现一致，但我们同样关心在个体层面上的公平，即“相似的个体应受到相似的对待”。本练习将介绍一种被称为“利普希茨条件” (Lipschitz condition) 的个体公平性形式化定义。您将通过计算来验证一个预测模型是否满足这一公平性约束，即确保患者特征的微小差异不会导致模型预测结果出现不合理的巨大跳跃。",
            "id": "4390112",
            "problem": "一个医疗系统正在部署一个预测性分析模型，该模型根据电子健康记录 (EHR) 数据估算患者$30$天内的再入院风险。治理委员会采纳了一项通过利普希茨条件 (Lipschitz condition) 形式化的个体公平性要求：对于在具有度量距离$d$的标准化特征空间中表示的任意两位患者，其预测绝对差值必须满足不等式约束 $\\lvert f(\\mathbf{x}) - f(\\mathbf{x}') \\rvert \\leq L\\, d(\\mathbf{x}, \\mathbf{x}')$，其中$L$是一个固定的利普希茨公平性常数。\n\n特征通过$z$-分数进行标准化：对于每个原始特征$x_{j}$，$z_{j} = (x_{j} - \\mu_{j}) / \\sigma_{j}$，其中$\\mu_{j}$是在训练人群上计算出的经验均值，$\\sigma_{j}$是经验标准差。度量$d(\\mathbf{x}, \\mathbf{x}')$是在此标准化空间中的欧几里得距离。\n\n考虑两名患者 A 和 B，他们由三个临床相关特征描述：年龄（岁）、Charlson合并症指数（CCI，无单位分数）和上一年度入院次数（无单位计数）。用于标准化的总体参数为 $\\sigma_{\\text{age}} = 10$、$\\sigma_{\\text{CCI}} = 2$ 和 $\\sigma_{\\text{adm}} = 1$，相应的均值为 $\\mu_{\\text{age}} = 50$、$\\mu_{\\text{CCI}} = 4$ 和 $\\mu_{\\text{adm}} = 2$。患者 A 的年龄为$60$岁，CCI为$6$，上一年度入院次数为$3$次。患者 B 的年龄为$40$岁，CCI为$2$，上一年度入院次数为$2$次。模型预测的$30$天再入院风险分别为 $f(\\mathbf{x}_{A}) = 0.62$ 和 $f(\\mathbf{x}_{B}) = 0.25$。治理委员会将利普希茨公平性常数固定为 $L = 0.10$。\n\n使用$z$-分数标准化和欧几里得距离的核心定义，以及形式化的利普希茨个体公平性条件，推导这两位患者之间允许的最大预测绝对差值，并判断模型的输出是否违反了公平性界限。您最终报告的答案必须是最大允许差值 $L\\, d(\\mathbf{x}_{A}, \\mathbf{x}_{B})$ 的单个数值，以小数形式表示。如果需要四舍五入，请将答案保留四位有效数字。最终答案中请勿包含任何单位。",
            "solution": "该问题要求基于利普希茨个体公平性约束，计算两名患者 A 和 B 之间允许的最大预测绝对差值。问题还要求判断模型的预测是否违反了此约束。最终答案必须是代表此最大允许差值的单个数值。\n\n公平性条件通过利普希茨条件形式化：$\\lvert f(\\mathbf{x}) - f(\\mathbf{x}') \\rvert \\leq L\\, d(\\mathbf{x}, \\mathbf{x}')$，其中 $f(\\mathbf{x})$ 是模型预测的风险，$L$ 是利普希茨公平性常数，$d(\\mathbf{x}, \\mathbf{x}')$ 是标准化空间中患者特征向量之间的欧几里得距离。\n\n第一步是将患者 A 和患者 B 的原始特征向量转换到标准化的$z$-分数空间。每个特征 $j$ 的标准化公式为 $z_{j} = \\frac{x_{j} - \\mu_{j}}{\\sigma_{j}}$。特征向量包含（年龄、Charlson合并症指数、上一年度入院次数）。\n\n患者 A 的原始特征为 $(\\text{age}, \\text{CCI}, \\text{adm}) = (60, 6, 3)$。给定的标准化总体参数为 $\\mu_{\\text{age}} = 50$ 和 $\\sigma_{\\text{age}} = 10$；$\\mu_{\\text{CCI}} = 4$ 和 $\\sigma_{\\text{CCI}} = 2$；$\\mu_{\\text{adm}} = 2$ 和 $\\sigma_{\\text{adm}} = 1$。患者 A 的标准化向量 $\\mathbf{z}_{A}$ 计算如下：\n$$z_{A, \\text{age}} = \\frac{60 - 50}{10} = \\frac{10}{10} = 1$$\n$$z_{A, \\text{CCI}} = \\frac{6 - 4}{2} = \\frac{2}{2} = 1$$\n$$z_{A, \\text{adm}} = \\frac{3 - 2}{1} = \\frac{1}{1} = 1$$\n因此，患者 A 的标准化特征向量为 $\\mathbf{z}_{A} = (1, 1, 1)$。\n\n患者 B 的原始特征为 $(\\text{age}, \\text{CCI}, \\text{adm}) = (40, 2, 2)$。使用相同的总体参数，患者 B 的标准化向量 $\\mathbf{z}_{B}$ 计算如下：\n$$z_{B, \\text{age}} = \\frac{40 - 50}{10} = \\frac{-10}{10} = -1$$\n$$z_{B, \\text{CCI}} = \\frac{2 - 4}{2} = \\frac{-2}{2} = -1$$\n$$z_{B, \\text{adm}} = \\frac{2 - 2}{1} = \\frac{0}{1} = 0$$\n因此，患者 B 的标准化特征向量为 $\\mathbf{z}_{B} = (-1, -1, 0)$。\n\n接下来，我们计算两个标准化向量之间的欧几里得距离 $d(\\mathbf{z}_{A}, \\mathbf{z}_{B})$。三维空间中的欧几里得距离公式为 $d(\\mathbf{u}, \\mathbf{v}) = \\sqrt{(u_1 - v_1)^2 + (u_2 - v_2)^2 + (u_3 - v_3)^2}$。\n$$d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = \\sqrt{(z_{A, \\text{age}} - z_{B, \\text{age}})^2 + (z_{A, \\text{CCI}} - z_{B, \\text{CCI}})^2 + (z_{A, \\text{adm}} - z_{B, \\text{adm}})^2}$$\n代入计算出的$z$-分数：\n$$d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = \\sqrt{(1 - (-1))^2 + (1 - (-1))^2 + (1 - 0)^2}$$\n$$d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = \\sqrt{2^2 + 2^2 + 1^2}$$\n$$d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = \\sqrt{4 + 4 + 1} = \\sqrt{9} = 3$$\n在标准化特征空间中，患者之间的距离恰好为 $3$。\n\n允许的最大预测绝对差值由项 $L\\, d(\\mathbf{z}_{A}, \\mathbf{z}_{B})$ 给出。利普希茨公平性常数固定为 $L = 0.10$。\n$$ \\text{最大允许差值} = L \\times d(\\mathbf{z}_{A}, \\mathbf{z}_{B}) = 0.10 \\times 3 = 0.30 $$\n这就是最终答案所要求的值。问题要求以小数形式表示此值，如果需要四舍五入，则保留四位有效数字。结果 $0.3$ 是精确值。为遵守此说明中隐含的精度标准，我们将其表示为 $0.3000$，它有四位有效数字。\n\n为完成题目要求的完整分析，我们检查模型的实际预测是否违反了此公平性界限。模型的预测值为 $f(\\mathbf{x}_{A}) = 0.62$ 和 $f(\\mathbf{x}_{B}) = 0.25$。\n预测的实际绝对差值为：\n$$ \\lvert f(\\mathbf{x}_{A}) - f(\\mathbf{x}_{B}) \\rvert = |0.62 - 0.25| = 0.37 $$\n我们将实际差值（$0.37$）与最大允许差值（$0.30$）进行比较：\n$$0.37 > 0.30$$\n由于实际差值大于最大允许差值，因此模型对这两名患者的输出违反了定义的公平性要求。\n\n然而，问题只要求提供最大允许差值 $L\\, d(\\mathbf{x}_{A}, \\mathbf{x}_{B})$ 的单个数值。",
            "answer": "$$\\boxed{0.3000}$$"
        },
        {
            "introduction": "当发现模型存在不公平时，我们往往需要采取干预措施进行修正，但这些干预措施可能会带来意想不到的后果。本练习探讨了一种常见的技术——保序校准 (isotonic recalibration)，并分析其对预测均等性 (predictive parity) 这一公平性指标的影响。通过这个复杂的案例，您将深入理解在追求模型准确性和不同公平性目标之间存在的内在权衡，这对于在现实世界中部署负责任的算法至关重要。",
            "id": "4390107",
            "problem": "一个医疗系统部署了一个风险预测模型，以标记可能在$30$天内发生非计划再入院的患者。该模型为每位患者输出一个连续得分 $s \\in [0,1]$。考虑两个患者群体，A组和B组，其二元结果 $Y \\in \\{0,1\\}$ 表示再入院（$Y=1$）或未再入院（$Y=0$）。设基础比率为 $\\pi_{A} = 0.25$ 和 $\\pi_{B} = 0.40$，其中 $\\pi_{g} = \\mathbb{P}(Y=1 \\mid g)$ 代表组 $g$ 的基础比率。\n\n在重校准之前，以真实结果为条件的得分分布如下：\n- A组：$s \\mid Y=1 \\sim \\text{Uniform}[0.4,1.0]$ 且 $s \\mid Y=0 \\sim \\text{Uniform}[0.0,0.8]$。\n- B组：$s \\mid Y=1 \\sim \\text{Uniform}[0.2,0.9]$ 且 $s \\mid Y=0 \\sim \\text{Uniform}[0.0,0.7]$。\n\n对每个组分别进行保序重校准，得到校准后的概率 $r_{g}(s)$，其值等于特定组的估计校准曲线 $c_{g}(s)$。保序校准曲线如下：\n- A组：\n$$\nc_{A}(s) = \\begin{cases}\n0.08,  0 \\leq s  0.4 \\\\\n0.22,  0.4 \\leq s  0.7 \\\\\n0.65,  0.7 \\leq s \\leq 1\n\\end{cases}\n$$\n- B组：\n$$\nc_{B}(s) = \\begin{cases}\n0.12,  0 \\leq s  0.3 \\\\\n0.28,  0.3 \\leq s  0.6 \\\\\n0.55,  0.6 \\leq s \\leq 1\n\\end{cases}\n$$\n\n使用一个固定的决策阈值 $t = 0.5$（基于预测概率）来标记需要干预的患者。\n\n使用校准和预测均等性的第一性原理定义，执行以下操作：\n1. 定义并计算每个组 $g \\in \\{A,B\\}$ 的重校准后阳性预测值（PPV），$\\text{PPV}_{g}^{\\text{post}}(t) = \\mathbb{P}(Y=1 \\mid r_{g}(s) \\geq t)$，以及重校准后的绝对预测均等性差距，$|\\text{PPV}_{A}^{\\text{post}}(t) - \\text{PPV}_{B}^{\\text{post}}(t)|$。\n2. 定义并计算重校准前阳性预测值（PPV），$\\text{PPV}_{g}^{\\text{pre}}(t) = \\mathbb{P}(Y=1 \\mid s \\geq t)$，以及相应的重校准前绝对预测均等性差距，$|\\text{PPV}_{A}^{\\text{pre}}(t) - \\text{PPV}_{B}^{\\text{pre}}(t)|$。\n3. 计算由保序重校准引起的绝对预测均等性差距的变化，即 $|\\text{PPV}_{A}^{\\text{pre}}(t) - \\text{PPV}_{B}^{\\text{pre}}(t)| - |\\text{PPV}_{A}^{\\text{post}}(t) - \\text{PPV}_{B}^{\\text{post}}(t)|$。\n\n从阳性预测值和校准的定义出发，解释每个步骤，并使用给定的分布来评估必要的概率。最后，简要讨论按组执行保序重校准在校准、预测均等性和决策一致性方面的权衡。\n\n将第3部分的最终数值答案表示为四舍五入到四位有效数字的小数。不需要单位，最终答案必须是单个实数。",
            "solution": "用户要求对一个风险预测模型在保序重校准前后的公平性属性进行多部分分析。这需要系统地应用概率论，特别是贝叶斯定理，来计算不同条件下的阳性预测值（PPV）。\n\n首先，我们建立必要的定义和符号。\n令 $g \\in \\{A, B\\}$ 表示患者组。\n令 $s \\in [0,1]$ 为原始预测得分。\n令 $Y \\in \\{0, 1\\}$ 为二元结果，其中 $Y=1$ 表示再入院。\n令 $\\pi_g = \\mathbb{P}(Y=1 \\mid g)$ 为特定组的再入院基础比率。给定 $\\pi_A = 0.25$ 和 $\\pi_B = 0.40$。\n令 $r_g(s)$ 为组 $g$ 的重校准得分。\n决策阈值为 $t=0.5$。\n\n阳性测试结果对应于预测概率达到或超过阈值。预测均等性是一种公平性标准，要求在给定决策阈值下，各组的PPV相等。\n组 $g$ 在给定测试条件（例如 $s \\geq t$ 或 $r_g(s) \\geq t$）下的 PPV 定义为在阳性测试结果下事件为真的概率：$\\text{PPV} = \\mathbb{P}(Y=1 \\mid \\text{测试为阳性})$。\n对于代表组 $g$ 阳性测试的通用事件 $C_g$，使用贝叶斯定理：\n$$ \\text{PPV}_g = \\mathbb{P}(Y=1 \\mid C_g, g) = \\frac{\\mathbb{P}(C_g \\mid Y=1, g) \\mathbb{P}(Y=1 \\mid g)}{\\mathbb{P}(C_g \\mid g)} $$\n分母可以使用全概率公式展开：\n$$ \\mathbb{P}(C_g \\mid g) = \\mathbb{P}(C_g \\mid Y=1, g)\\mathbb{P}(Y=1 \\mid g) + \\mathbb{P}(C_g \\mid Y=0, g)\\mathbb{P}(Y=0 \\mid g) $$\n条件得分分布 $s \\mid Y, g$ 是均匀分布。对于区间 $[a, b]$ 上的均匀分布，其概率密度函数为 $f(x) = \\frac{1}{b-a}$（对于 $x \\in [a, b]$），其他情况下为 $0$。$s$ 落入子区间 $[c,d] \\subseteq [a,b]$ 的概率为 $\\frac{d-c}{b-a}$。\n\n给定的条件分布如下：\n- A组：$s \\mid (Y=1, A) \\sim \\text{Uniform}[0.4, 1.0]$，$s \\mid (Y=0, A) \\sim \\text{Uniform}[0.0, 0.8]$。\n- B组：$s \\mid (Y=1, B) \\sim \\text{Uniform}[0.2, 0.9]$，$s \\mid (Y=0, B) \\sim \\text{Uniform}[0.0, 0.7]$。\n\n### 1. 重校准后分析\n\n重校准后的阳性测试条件是 $r_g(s) \\geq t$，其中 $t=0.5$。我们必须首先确定对于每个组，满足此条件的原始得分 $s$ 的范围。\n\n**A组：**\n条件是 $r_A(s) = c_A(s) \\geq 0.5$。根据 $c_A(s)$ 的定义，这仅在 $c_A(s) = 0.65$ 时成立，对应于 $s \\in [0.7, 1.0]$。设事件为 $C_A^{\\text{post}} \\equiv s \\geq 0.7$。我们计算条件概率：\n- $\\mathbb{P}(s \\geq 0.7 \\mid Y=1, A)$：对于 $s \\sim \\text{Uniform}[0.4, 1.0]$，此概率为 $\\frac{1.0 - 0.7}{1.0 - 0.4} = \\frac{0.3}{0.6} = \\frac{1}{2}$。\n- $\\mathbb{P}(s \\geq 0.7 \\mid Y=0, A)$：对于 $s \\sim \\text{Uniform}[0.0, 0.8]$，此概率为 $\\frac{0.8 - 0.7}{0.8 - 0.0} = \\frac{0.1}{0.8} = \\frac{1}{8}$。\n\n现在，我们计算 $\\text{PPV}_A^{\\text{post}}(0.5)$：\n$$ \\text{PPV}_{A}^{\\text{post}}(0.5) = \\frac{\\mathbb{P}(s \\geq 0.7 \\mid Y=1, A)\\pi_A}{\\mathbb{P}(s \\geq 0.7 \\mid Y=1, A)\\pi_A + \\mathbb{P}(s \\geq 0.7 \\mid Y=0, A)(1-\\pi_A)} $$\n$$ \\text{PPV}_{A}^{\\text{post}}(0.5) = \\frac{(\\frac{1}{2})(0.25)}{(\\frac{1}{2})(0.25) + (\\frac{1}{8})(0.75)} = \\frac{0.125}{0.125 + 0.09375} = \\frac{0.125}{0.21875} = \\frac{4}{7} $$\n\n**B组：**\n条件是 $r_B(s) = c_B(s) \\geq 0.5$。根据 $c_B(s)$ 的定义，这仅在 $c_B(s) = 0.55$ 时成立，对应于 $s \\in [0.6, 1.0]$。设事件为 $C_B^{\\text{post}} \\equiv s \\geq 0.6$。我们计算条件概率：\n- $\\mathbb{P}(s \\geq 0.6 \\mid Y=1, B)$：对于 $s \\sim \\text{Uniform}[0.2, 0.9]$，此概率为 $\\frac{0.9 - 0.6}{0.9 - 0.2} = \\frac{0.3}{0.7} = \\frac{3}{7}$。\n- $\\mathbb{P}(s \\geq 0.6 \\mid Y=0, B)$：对于 $s \\sim \\text{Uniform}[0.0, 0.7]$，此概率为 $\\frac{0.7 - 0.6}{0.7 - 0.0} = \\frac{0.1}{0.7} = \\frac{1}{7}$。\n\n现在，我们计算 $\\text{PPV}_B^{\\text{post}}(0.5)$：\n$$ \\text{PPV}_{B}^{\\text{post}}(0.5) = \\frac{\\mathbb{P}(s \\geq 0.6 \\mid Y=1, B)\\pi_B}{\\mathbb{P}(s \\geq 0.6 \\mid Y=1, B)\\pi_B + \\mathbb{P}(s \\geq 0.6 \\mid Y=0, B)(1-\\pi_B)} $$\n$$ \\text{PPV}_{B}^{\\text{post}}(0.5) = \\frac{(\\frac{3}{7})(0.40)}{(\\frac{3}{7})(0.40) + (\\frac{1}{7})(0.60)} = \\frac{1.2/7}{1.2/7 + 0.6/7} = \\frac{1.2/7}{1.8/7} = \\frac{1.2}{1.8} = \\frac{2}{3} $$\n\n重校准后的绝对预测均等性差距为：\n$$ |\\text{PPV}_{A}^{\\text{post}}(0.5) - \\text{PPV}_{B}^{\\text{post}}(0.5)| = \\left|\\frac{4}{7} - \\frac{2}{3}\\right| = \\left|\\frac{12 - 14}{21}\\right| = \\frac{2}{21} $$\n\n### 2. 重校准前分析\n\n重校准前的阳性测试条件使用原始得分 $s$。事件为 $C_g^{\\text{pre}} \\equiv s \\geq t$，其中 $t=0.5$。\n\n**A组：**\n事件为 $s \\geq 0.5$。我们计算条件概率：\n- $\\mathbb{P}(s \\geq 0.5 \\mid Y=1, A)$：对于 $s \\sim \\text{Uniform}[0.4, 1.0]$，此概率为 $\\frac{1.0 - 0.5}{1.0 - 0.4} = \\frac{0.5}{0.6} = \\frac{5}{6}$。\n- $\\mathbb{P}(s \\geq 0.5 \\mid Y=0, A)$：对于 $s \\sim \\text{Uniform}[0.0, 0.8]$，此概率为 $\\frac{0.8 - 0.5}{0.8 - 0.0} = \\frac{0.3}{0.8} = \\frac{3}{8}$。\n\n现在，我们计算 $\\text{PPV}_A^{\\text{pre}}(0.5)$：\n$$ \\text{PPV}_{A}^{\\text{pre}}(0.5) = \\frac{(\\frac{5}{6})(0.25)}{(\\frac{5}{6})(0.25) + (\\frac{3}{8})(0.75)} = \\frac{5/24}{5/24 + 9/32} = \\frac{20/96}{20/96 + 27/96} = \\frac{20/96}{47/96} = \\frac{20}{47} $$\n\n**B组：**\n事件为 $s \\geq 0.5$。我们计算条件概率：\n- $\\mathbb{P}(s \\geq 0.5 \\mid Y=1, B)$：对于 $s \\sim \\text{Uniform}[0.2, 0.9]$，此概率为 $\\frac{0.9 - 0.5}{0.9 - 0.2} = \\frac{0.4}{0.7} = \\frac{4}{7}$。\n- $\\mathbb{P}(s \\geq 0.5 \\mid Y=0, B)$：对于 $s \\sim \\text{Uniform}[0.0, 0.7]$，此概率为 $\\frac{0.7 - 0.5}{0.7 - 0.0} = \\frac{0.2}{0.7} = \\frac{2}{7}$。\n\n现在，我们计算 $\\text{PPV}_B^{\\text{pre}}(0.5)$：\n$$ \\text{PPV}_{B}^{\\text{pre}}(0.5) = \\frac{(\\frac{4}{7})(0.40)}{(\\frac{4}{7})(0.40) + (\\frac{2}{7})(0.60)} = \\frac{1.6/7}{1.6/7 + 1.2/7} = \\frac{1.6/7}{2.8/7} = \\frac{1.6}{2.8} = \\frac{4}{7} $$\n\n重校准前的绝对预测均等性差距为：\n$$ |\\text{PPV}_{A}^{\\text{pre}}(0.5) - \\text{PPV}_{B}^{\\text{pre}}(0.5)| = \\left|\\frac{20}{47} - \\frac{4}{7}\\right| = \\left|\\frac{140 - 188}{329}\\right| = \\frac{48}{329} $$\n\n### 3. 绝对预测均等性差距的变化\n\n变化量是重校准前的差距减去重校准后的差距。\n$$ \\text{变化} = |\\text{PPV}_{A}^{\\pre}(0.5) - \\text{PPV}_{B}^{\\pre}(0.5)| - |\\text{PPV}_{A}^{\\text{post}}(0.5) - \\text{PPV}_{B}^{\\text{post}}(0.5)| $$\n$$ \\text{变化} = \\frac{48}{329} - \\frac{2}{21} $$\n为了计算数值，我们转换为小数：\n$$ \\frac{48}{329} \\approx 0.1458966... $$\n$$ \\frac{2}{21} \\approx 0.0952381... $$\n$$ \\text{变化} \\approx 0.1458966 - 0.0952381 = 0.0506585... $$\n四舍五入到四位有效数字，变化为 $0.05066$。\n\n### 权衡讨论\n\n执行特定组的保序重校准涉及统计属性和公平性原则之间的多种权衡。\n\n1.  **校准性：** 该程序旨在改善每个组内部的校准性。新的得分 $r_g(s)$ 平均而言应比原始得分 $s$ 更好地估计再入院的真实条件概率 $\\mathbb{P}(Y=1 \\mid s, g)$。这使得模型的输出对于使用它们进行特定组风险评估的临床医生来说更具可解释性和可靠性。\n\n2.  **预测均等性：** 这个公平性指标要求各组的 PPV 相等（$\\text{PPV}_A = \\text{PPV}_B$）。我们的计算显示：\n    - 重校准前差距：$|\\frac{20}{47} - \\frac{4}{7}| \\approx |0.426 - 0.571| = 0.145$。\n    - 重校准后差距：$|\\frac{4}{7} - \\frac{2}{3}| \\approx |0.571 - 0.667| = 0.096$。\n    在这个特定案例中，按组重校准减小了预测均等性差距。两组的 PPV 都有所增加，但它们之间的差异减小了。从预测均等性的角度来看，这是一个积极的结果。然而，这并非按组重校准的必然结果；在其他情况下，它可能会增加差距。\n\n3.  **决策一致性（个体公平性）：** 这是出现显著权衡的地方。在重校准之前，任何原始得分 $s \\geq 0.5$ 的患者都会被标记，无论其属于哪个组。重校准后，标记患者的决定取决于他们的得分*和*他们所在的组：\n    - A组患者在 $s \\geq 0.7$ 时被标记。\n    - B组患者在 $s \\geq 0.6$ 时被标记。\n    这导致了一种情况：两个具有相同初始风险得分（例如 $s=0.65$）的患者，会因其组别成员身份而受到不同的对待。一个来自A组且 $s=0.65$ 的患者不会被标记，而一个来自B组且得分相同的患者则会被标记。这违反了“同等对待”或“个体公平性”的原则，该原则主张具有相同特征（在此例中为相同的原始得分 $s$）的个体应被算法同等对待。\n\n总之，虽然按组重校准可以改善组内校准性，并且在本例中也改善了组级公平性（预测均等性），但它牺牲了个体层面的公平性，因为它创建了依赖于组别的决策规则。这种权衡是在实践中部署公平机器学习模型的核心挑战。",
            "answer": "$$\n\\boxed{0.05066}\n$$"
        }
    ]
}