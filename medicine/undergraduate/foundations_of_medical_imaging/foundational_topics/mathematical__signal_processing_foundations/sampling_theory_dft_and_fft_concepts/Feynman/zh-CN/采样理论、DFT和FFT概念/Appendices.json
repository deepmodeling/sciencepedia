{
    "hands_on_practices": [
        {
            "introduction": "像磁共振成像（MRI）这样的医学成像系统在很高的射频（RF）下捕获信号。为了对这些信号进行数字处理，我们必须首先将它们转换为较低频率的“基带”表示。本练习将演示一种卓越的方法——同相/正交（I/Q）解调，它巧妙地解决了困扰简单方法的“镜像问题”。通过理论推导和模型实现，您将对成像链中这关键的第一步获得实践性的理解。",
            "id": "4920811",
            "problem": "考虑一个用于磁共振成像（MRI）接收链中的实值带限射频信号，该信号被建模为围绕一个载波（本地振荡器）频率的一系列窄带正弦波之和。设连续时间信号为 $x(t)$，本地振荡器频率为 $f_{\\mathrm{LO}}$，单位为赫兹。你将分析将 $x(t)$ 乘以一个实数正弦波与一个复指数的效果，然后实现相应的离散时间同相/正交（I/Q）解调模型。\n\n基本原理：\n- 使用 $x(t)$ 的傅里叶变换 $X(f)$ 的定义，其中 $f$ 的单位是赫兹。\n- 使用调制特性，即时域相乘对应于傅里叶域中的频移。\n- 使用实数信号具有共轭对称谱的属性以及复指数和正弦波之间的关系。\n\n任务：\n1. 从傅里叶变换定义和调制属性出发，推导将 $x(t)$ 乘以实数正弦波 $\\cos(2\\pi f_{\\mathrm{LO}} t)$ 如何从 $X(f_{\\mathrm{LO}}+\\Delta f)$ 和 $X(f_{\\mathrm{LO}}-\\Delta f)$ 中产生基带分量，从而导致镜像频带模糊。然后，推导将 $x(t)$ 乘以复指数 $\\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$ 如何产生一个单一的、保留符号的移位，该移位将 $X(f_{\\mathrm{LO}}+\\Delta f)$ 映射到 $X(\\Delta f)$，将 $X(f_{\\mathrm{LO}}-\\Delta f)$ 映射到 $X(-\\Delta f)$，而不会将它们合并。\n2. 构建以 $f_s$ 赫兹速率采样的离散时间I/Q解调模型。设 $x[n] = x(n/f_s)$，其中 $n$ 为整数，$0 \\le n \\le N-1$。定义离散时间I/Q分量：\n   - $I[n] = 2\\,x[n]\\cos\\!\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$,\n   - $Q[n] = -2\\,x[n]\\sin\\!\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$,\n   和复基带信号 $y[n] = I[n] + j\\,Q[n]$。解释在频域中对 $y[n]$ 进行理想低通滤波（其对称通带宽度大于预期的基带偏移）如何实现一个保留基带、消除镜像的解调器。该滤波器必须通过所有感兴趣的 $|\\Delta f|$，并抑制接近 $2 f_{\\mathrm{LO}}$ 的分量。\n3. 实现一个程序，该程序：\n   - 生成离散时间测试信号，作为在指定射频音调上的余弦之和。\n   - 执行实数解调（乘以 $2\\cos(2\\pi f_{\\mathrm{LO}} n/f_s)$）和复数I/Q解调（如上构成 $y[n]$）。\n   - 在离散傅里叶变换（DFT）域中，通过将指定截止频率（单位为赫兹）之外的频点置零来应用理想对称低通滤波器。\n   - 计算解调并滤波后信号的快速傅里叶变换（FFT），并测量在 $\\pm \\Delta f$ 处的幅度，以形成对符号保持和镜像频带消除的简单量化测试。\n\n角度单位和物理单位：\n- 所有频率 $f$、$f_{\\mathrm{LO}}$、$f_s$ 和 $\\Delta f$ 均以赫兹为单位。\n- 所有时间样本 $n$ 是无单位的索引，通过 $n/f_s$ 隐式对应于秒。\n- 正弦波中的角度以弧度为单位。\n\n测试套件：\n- 使用以下三种情况。在每种情况下，$f_s$ 和 $N$ 定义了采样设置，$f_{\\mathrm{LO}}$ 定义了载波，而 $x[n]$ 则被构建为一个或多个余弦的和。频率是精确的DFT频点中心，因此在理想运算中没有频谱泄漏。\n  1. 情况1（上边带音调）：\n     - $f_s = 4096$,\n     - $N = 4096$,\n     - $f_{\\mathrm{LO}} = 1024$,\n     - 在 $f = f_{\\mathrm{LO}} + \\Delta f$ 处的单音，其中 $\\Delta f = 128$（即 $f = 1152$ 赫兹）。\n  2. 情况2（下边带音调）：\n     - $f_s = 4096$,\n     - $N = 4096$,\n     - $f_{\\mathrm{LO}} = 1024$,\n     - 在 $f = f_{\\mathrm{LO}} - \\Delta f$ 处的单音，其中 $\\Delta f = 128$（即 $f = 896$ 赫兹）。\n  3. 情况3（近奈奎斯特上边带音调）：\n     - $f_s = 4096$,\n     - $N = 4096$,\n     - $f_{\\mathrm{LO}} = 1984$,\n     - 在 $f = f_{\\mathrm{LO}} + \\Delta f$ 处的单音，其中 $\\Delta f = 32$（即 $f = 2016$ 赫兹）。\n\n截止频率选择规则：\n- 对于每种情况，将理想低通截止频率设置为 $f_c = \\max(\\Delta f) + 10$ 赫兹，以赫兹明确表示。\n\n各案例评估指标：\n- 对于复数I/Q解调，定义符号保持比\n  - 当输入音调位于 $f_{\\mathrm{LO}}+\\Delta f$ 时，$R_{\\mathrm{c}}^{(+)} = \\dfrac{|Y(\\Delta f)|}{|Y(-\\Delta f)|}$，\n  - 当输入音调位于 $f_{\\mathrm{LO}}-\\Delta f$ 时，$R_{\\mathrm{c}}^{(-)} = \\dfrac{|Y(-\\Delta f)|}{|Y(\\Delta f)|}$，\n  其中 $Y(\\cdot)$ 表示经过复数解调和低通滤波后，在指定基带频点处的幅度。\n- 对于实数解调，定义对称比\n  - $R_{\\mathrm{r}} = \\dfrac{|Z(\\Delta f)|}{|Z(-\\Delta f)|}$，\n  其中 $Z(\\cdot)$ 表示经过实数解调和低通滤波后，在指定基带频点处的幅度。\n\n判定规则：\n- 如果相关的 $R_{\\mathrm{c}}^{(+)}$ 或 $R_{\\mathrm{c}}^{(-)}$ 超过 $100$，则判定复数解调“保留符号”。\n- 如果复数解调比率超过 $100$，而实数解调对称比满足 $0.9 \\le R_{\\mathrm{r}} \\le 1.1$，则判定“相对于实数混频，镜像已消除”。\n\n要求的最终输出格式：\n- 你的程序应生成单行输出，其中包含一个 Python 列表的结果，该列表包含三个对应各案例的列表，每个列表按 $[\\text{sign\\_preserved}, \\text{image\\_eliminated}]$ 的顺序包含两个布尔值。例如，输出应如下所示：\n  - $[[\\text{True},\\text{True}],[\\text{True},\\text{True}],[\\text{True},\\text{True}]]$。",
            "solution": "## 问题验证\n\n### 步骤1：提取给定信息\n- **信号模型**：一个实值、带限的射频信号 $x(t)$，建模为围绕载波频率 $f_{\\mathrm{LO}}$ 的窄带正弦波之和。\n- **傅里叶变换**：$X(f)$ 是 $x(t)$ 的傅里叶变换。\n- **调制属性**：时域相乘对应于频域卷积。\n- **信号属性**：实数信号具有共轭对称谱。\n- **任务1（理论）**：\n  - 推导将 $x(t)$ 与 $\\cos(2\\pi f_{\\mathrm{LO}} t)$ 相乘如何导致镜像频带模糊。\n  - 推导将 $x(t)$ 与 $\\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$ 相乘如何保留频率偏移的符号并避免模糊。\n- **任务2（离散模型）**：\n  - 采样信号：$x[n] = x(n/f_s)$，对于 $0 \\le n \\le N-1$。\n  - I/Q分量：$I[n] = 2\\,x[n]\\cos(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n)$，$Q[n] = -2\\,x[n]\\sin(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n)$。\n  - 复基带：$y[n] = I[n] + j\\,Q[n]$。\n  - 解释在频域中对 $y[n]$ 进行理想低通滤波如何实现镜像抑制。\n- **任务3（实现）**：\n  - 实现一个程序，用指定的测试信号测试实数和复数解调。\n  - 通过将频点置零，在DFT域中应用理想对称低通滤波器。\n  - 计算FFT并测量幅度，以测试符号保持和镜像消除。\n- **单位**：频率单位为赫兹（Hz），时间样本 $n$ 是无单位索引，角度单位为弧度。\n- **测试套件**：\n  - 情况1：$f_s = 4096$, $N = 4096$, $f_{\\mathrm{LO}} = 1024$，音调在 $f = f_{\\mathrm{LO}} + \\Delta f = 1152$ Hz（因此 $\\Delta f = 128$ Hz）。\n  - 情况2：$f_s = 4096$, $N = 4096$, $f_{\\mathrm{LO}} = 1024$，音调在 $f = f_{\\mathrm{LO}} - \\Delta f = 896$ Hz（因此 $\\Delta f = 128$ Hz）。\n  - 情况3：$f_s = 4096$, $N = 4096$, $f_{\\mathrm{LO}} = 1984$，音调在 $f = f_{\\mathrm{LO}} + \\Delta f = 2016$ Hz（因此 $\\Delta f = 32$ Hz）。\n- **滤波器规则**：低通截止频率 $f_c = \\max(\\Delta f) + 10$ 赫兹。\n- **评估指标**：\n  - 复数解调符号保持比：上边带为 $R_{\\mathrm{c}}^{(+)} = \\frac{|Y(\\Delta f)|}{|Y(-\\Delta f)|}$，下边带为 $R_{\\mathrm{c}}^{(-)} = \\frac{|Y(-\\Delta f)|}{|Y(\\Delta f)|}$。\n  - 实数解调对称比：$R_{\\mathrm{r}} = \\frac{|Z(\\Delta f)|}{|Z(-\\Delta f)|}$。\n- **判定规则**：\n  - 如果 $R_{\\mathrm{c}} > 100$，则符号被保留。\n  - 如果 $R_{\\mathrm{c}} > 100$ 且 $0.9 \\le R_{\\mathrm{r}} \\le 1.1$，则镜像被消除。\n- **输出格式**：一个Python列表，包含多个布尔值列表，例如 `[[True,True],[True,True],[True,True]]`。\n\n### 步骤2：使用提取的给定信息进行验证\n该问题在科学上基于信号处理的基本原理，特别是傅里叶分析和数字解调技术，这些是MRI和许多其他领域的核心。这是一个定义明确的问题，所有必要的参数（$f_s, N, f_{\\mathrm{LO}}$，信号定义）和评估标准都已提供，确保了唯一且可验证的解决方案。语言客观精确。任务从理论到实现逻辑递进。提供的测试案例在物理上是合理的，在计算上是可行的。该问题是数字信号处理（DSP）中一个标准的、格式良好的练习，没有任何指令中列出的无效性缺陷。\n\n### 步骤3：结论与行动\n该问题是 **有效的**。开始进行求解。\n\n## 理论基础与实现策略\n\n解调过程是诸如MRI等射频（RF）系统的核心，它用于将高频信号移至较低频率的基带，以便进行数字化和分析。本解答首先推导了实数解调和复数解调之间的理论差异，然后概述了验证这些原理的数值实验的实现方法。\n\n### 第1部分：连续时间域中解调方案的分析\n\n我们首先分析在频域中将输入信号 $x(t)$ 与本地振荡器（LO）信号进行混频的效果。核心数学工具是傅里叶变换的调制属性，即时域中的乘法等效于频域中的卷积：$\\mathcal{F}\\{s_1(t) s_2(t)\\} = S_1(f) * S_2(f)$，其中 $S_1(f)$ 和 $S_2(f)$ 分别是 $s_1(t)$ 和 $s_2(t)$ 的傅里叶变换， $*$ 表示卷积。\n\n设实值输入信号 $x(t)$ 的傅里叶变换为 $X(f)$。由于 $x(t)$ 是实数，其频谱表现出共轭对称性：$X(-f) = X^*(f)$。让我们考虑一个输入信号，它是在频率 $f_{in}$ 处的单音，与LO频率 $f_{\\mathrm{LO}}$ 相差 $\\Delta f$，使得 $f_{in} = f_{\\mathrm{LO}} + \\Delta f$。该信号为 $x(t) = A\\cos(2\\pi f_{in} t)$。其傅里叶变换为 $X(f) = \\frac{A}{2} [ \\delta(f - f_{in}) + \\delta(f + f_{in}) ]$。\n\n**1. 实数解调（与余弦混频）**\n\n在实数解调中，单个混频器将输入信号 $x(t)$ 与来自LO的实数正弦波 $s_{LO}(t) = \\cos(2\\pi f_{\\mathrm{LO}} t)$ 相乘。LO信号的傅里叶变换为 $\\mathcal{F}\\{s_{LO}(t)\\} = \\frac{1}{2} [ \\delta(f - f_{\\mathrm{LO}}) + \\delta(f + f_{\\mathrm{LO}}) ]$。\n\n解调后的信号是 $z(t) = x(t) \\cos(2\\pi f_{\\mathrm{LO}} t)$。其频谱 $Z(f)$ 为：\n$$Z(f) = X(f) * \\left( \\frac{1}{2} [ \\delta(f - f_{\\mathrm{LO}}) + \\delta(f + f_{\\mathrm{LO}}) ] \\right)$$\n$$Z(f) = \\frac{1}{2} [ X(f - f_{\\mathrm{LO}}) + X(f + f_{\\mathrm{LO}}) ]$$\n此操作将 $x(t)$ 的频谱移动 $\\pm f_{\\mathrm{LO}}$ 并将其幅度减半。让我们分析其对两种不同输入音调的影响：\n- **上边带（USB）音调**：$f_{in} = f_{\\mathrm{LO}} + \\Delta f$，其中 $\\Delta f > 0$。输入频谱 $X(f)$ 在 $\\pm(f_{\\mathrm{LO}} + \\Delta f)$ 处有峰值。频谱 $Z(f)$ 将有由移动这两个delta函数产生的峰值：\n  $$Z(f) \\propto [ \\delta(f - (f_{\\mathrm{LO}}+\\Delta f) - f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}+\\Delta f) - f_{\\mathrm{LO}}) ] + [ \\delta(f - (f_{\\mathrm{LO}}+\\Delta f) + f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}+\\Delta f) + f_{\\mathrm{LO}}) ]$$\n  $$Z(f) \\propto \\delta(f - (2f_{\\mathrm{LO}}+\\Delta f)) + \\delta(f + \\Delta f) + \\delta(f - \\Delta f) + \\delta(f + (2f_{\\mathrm{LO}}+\\Delta f))$$\n  在应用理想低通滤波器（LPF）后，该滤波器通过频率 $|f|  f_c$，其中 $|\\Delta f|  f_c \\ll 2f_{\\mathrm{LO}}$，只有在 $\\pm\\Delta f$ 处的份量保留下来。\n- **下边带（LSB）音调**：$f_{in} = f_{\\mathrm{LO}} - \\Delta f$，其中 $\\Delta f  0$。输入频谱 $X(f)$ 在 $\\pm(f_{\\mathrm{LO}} - \\Delta f)$ 处有峰值。频谱 $Z(f)$ 将在以下位置有峰值：\n  $$Z(f) \\propto [ \\delta(f - (f_{\\mathrm{LO}}-\\Delta f) - f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}-\\Delta f) - f_{\\mathrm{LO}}) ] + [ \\delta(f - (f_{\\mathrm{LO}}-\\Delta f) + f_{\\mathrm{LO}}) + \\delta(f + (f_{\\mathrm{LO}}-\\Delta f) + f_{\\mathrm{LO}}) ]$$\n  $$Z(f) \\propto \\delta(f - (2f_{\\mathrm{LO}}-\\Delta f)) + \\delta(f + (-\\Delta f)) + \\delta(f - (-\\Delta f)) + \\delta(f + (2f_{\\mathrm{LO}}-\\Delta f))$$\n  经过相同的LPF后，在 $\\pm\\Delta f$ 处的份量保留下来。\n\n在这两种情况下，LPF后的频谱在 $\\pm\\Delta f$ 处都有相同的峰值。无法区分原始RF音调是在 $f_{\\mathrm{LO}} + \\Delta f$ 还是 $f_{\\mathrm{LO}} - \\Delta f$。这就是**镜像频带模糊**。\n\n**2. 复数解调（与复指数混频）**\n\n同相/正交（I/Q）解调等效于与复指数混频。设LO信号为 $s_{LO,c}(t) = \\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$。其傅里叶变换为 $\\mathcal{F}\\{s_{LO,c}(t)\\} = \\delta(f + f_{\\mathrm{LO}})$。\n\n复数解调信号为 $y(t) = x(t) \\mathrm{e}^{-j 2\\pi f_{\\mathrm{LO}} t}$。其频谱 $Y(f)$ 为：\n$$Y(f) = X(f) * \\delta(f + f_{\\mathrm{LO}}) = X(f + f_{\\mathrm{LO}})$$\n这是将 $x(t)$ 的整个频谱向左平移 $f_{\\mathrm{LO}}$。\n- **上边带（USB）音调**：$f_{in} = f_{\\mathrm{LO}} + \\Delta f$。$X(f)$ 在 $\\pm(f_{\\mathrm{LO}} + \\Delta f)$ 处有峰值。移位后的频谱 $Y(f)$ 在以下位置有峰值：\n  - $(f_{\\mathrm{LO}} + \\Delta f) - f_{\\mathrm{LO}} = +\\Delta f$\n  - $-(f_{\\mathrm{LO}} + \\Delta f) - f_{\\mathrm{LO}} = -2f_{\\mathrm{LO}} - \\Delta f$\n  LPF通过 $+\\Delta f$ 分量，并抑制在 $-2f_{\\mathrm{LO}} - \\Delta f$ 处的高频分量。最终的基带频谱是单边的（在正频率上）。\n- **下边带（LSB）音调**：$f_{in} = f_{\\mathrm{LO}} - \\Delta f$。$X(f)$ 在 $\\pm(f_{\\mathrm{LO}} - \\Delta f)$ 处有峰值。移位后的频谱 $Y(f)$ 在以下位置有峰值：\n  - $(f_{\\mathrm{LO}} - \\Delta f) - f_{\\mathrm{LO}} = -\\Delta f$\n  - $-(f_{\\mathrm{LO}} - \\Delta f) - f_{\\mathrm{LO}} = -2f_{\\mathrm{LO}} + \\Delta f$\n  LPF通过 $-\\Delta f$ 分量，并抑制在 $-2f_{\\mathrm{LO}} + \\Delta f$ 处的高频分量。最终的基带频谱是单边的（在负频率上）。\n\n复数解调将上边带映射到正基带频率，将下边带映射到负基带频率，从而**保留**偏移量 $\\Delta f$ 的**符号**并**消除镜像频带模糊**。\n\n### 第2部分：离散时间I/Q解调模型\n\n这些原理直接适用于离散时间信号。信号 $x(t)$ 以速率 $f_s$ 采样生成 $x[n] = x(n/f_s)$。解调以数字方式进行。I/Q分量定义为：\n$$I[n] = 2\\,x[n]\\cos\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$$\n$$Q[n] = -2\\,x[n]\\sin\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right)$$\n它们被组合成一个复基带信号 $y[n]$：\n$$y[n] = I[n] + j\\,Q[n] = 2\\,x[n] \\left( \\cos\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right) - j\\sin\\left(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n\\right) \\right)$$\n使用欧拉公式，这可以简化为：\n$$y[n] = 2\\,x[n]\\,\\mathrm{e}^{-j 2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n}$$\n这是与 $2\\,\\mathrm{e}^{-j 2 \\pi f_{\\mathrm{LO}} t}$ 相乘的离散时间等价形式。因子 $2$ 是一种惯例，用于在解调和滤波后恢复音调的原始幅度。\n\n在离散傅里叶变换（DFT）域中，这种乘法导致 $x[n]$ 频谱的循环移位。对应于 $f_{\\mathrm{LO}}$ 的频谱分量被移到 $0$ Hz（直流），而 $-f_{\\mathrm{LO}}$ 处的分量被移到 $-2f_{\\mathrm{LO}}$。理想数字低通滤波器通过计算 $y[n]$ 的DFT，创建一个对于频率仓 $|f| \\le f_c$ 为 $1$ 否则为 $0$ 的掩码，并将 $y[n]$ 的DFT与此掩码相乘来实现。这选择性地将高频镜像分量（现在集中在 $-2f_{\\mathrm{LO}}$ 附近）置零，只留下所需的基带信号。\n\n### 第3部分：验证的实现策略\n\n所提供的Python代码将实现对这些原理的数值验证。\n1.  **信号生成**：对于每个测试案例，创建一个时间向量 `n`。一个在指定频率 $f_{in} = f_{\\mathrm{LO}} \\pm \\Delta f$ 的单音RF信号 `x[n]` 被合成为一个余弦波。\n2.  **解调**：\n    - **实数**：`x[n]` 乘以 $2\\cos(2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n)$ 生成 `z[n]`。\n    - **复数**：`x[n]` 乘以 $2\\mathrm{e}^{-j 2\\pi \\frac{f_{\\mathrm{LO}}}{f_s} n}$ 生成 `y[n]`。\n3.  **频率分析与滤波**：\n    - 使用快速傅里叶变换（`FFT`）计算 `z[n]` 和 `y[n]` 的DFT，得到 `Z[k]` 和 `Y[k]`。\n    - 生成一个频率轴。通过识别截止频率 $f_c = \\max(\\Delta f) + 10$ 内的所有频率仓来创建理想的LPF掩码。\n    - 将掩码应用于 `Z[k]` 和 `Y[k]` 以产生滤波后的频谱。\n4.  **指标计算**：\n    - 在对应于 $+\\Delta f$ 和 $-\\Delta f$ 的频率仓处测量滤波后频谱的幅度。\n    - 计算比率 $R_{\\mathrm{r}}$，$R_{\\mathrm{c}}^{(+)}$ 和 $R_{\\mathrm{c}}^{(-)}$。在分母上加上一个小的epsilon以防止在理想情况下除以零。\n5.  **判定逻辑**：将计算出的比率与阈值（$100$ 和 $[0.9, 1.1]$）进行比较，以生成“保留符号”和“消除镜像”的布尔标志，然后进行格式化并打印。\n这个过程将定量地展示实数解调的镜像模糊性（$R_{\\mathrm{r}} \\approx 1$）和复数解调的镜像抑制能力（$R_{\\mathrmc} \\gg 1$）。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs I/Q demodulation analysis for three test cases, verifying\n    sign preservation and image elimination.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (upper sideband tone)\n        {\n            \"fs\": 4096, \"N\": 4096, \"f_lo\": 1024,\n            \"f_tone\": 1152, \"delta_f\": 128, \"type\": \"upper\"\n        },\n        # Case 2 (lower sideband tone)\n        {\n            \"fs\": 4096, \"N\": 4096, \"f_lo\": 1024,\n            \"f_tone\": 896, \"delta_f\": 128, \"type\": \"lower\"\n        },\n        # Case 3 (near-Nyquist upper sideband tone)\n        {\n            \"fs\": 4096, \"N\": 4096, \"f_lo\": 1984,\n            \"f_tone\": 2016, \"delta_f\": 32, \"type\": \"upper\"\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        fs = case[\"fs\"]\n        N = case[\"N\"]\n        f_lo = case[\"f_lo\"]\n        f_tone = case[\"f_tone\"]\n        delta_f = case[\"delta_f\"]\n        sideband_type = case[\"type\"]\n\n        # 1. Generate discrete-time test signal\n        n = np.arange(N)\n        # Using n/fs for time to be explicit\n        t = n / fs\n        x_n = np.cos(2 * np.pi * f_tone * t)\n\n        # 2. Perform real and complex I/Q demodulation\n        \n        # Real demodulation\n        lo_real = 2 * np.cos(2 * np.pi * f_lo * t)\n        z_n = x_n * lo_real\n\n        # Complex I/Q demodulation\n        # y[n] = I[n] + jQ[n] = 2*x[n]*cos(...) - j*2*x[n]*sin(...) = 2*x[n]*exp(-j...)\n        lo_complex = 2 * np.exp(-1j * 2 * np.pi * f_lo * t)\n        y_n = x_n * lo_complex\n\n        # 3. Apply ideal symmetric low-pass filter in the DFT domain\n        \n        # Compute FFTs\n        Zk = np.fft.fft(z_n)\n        Yk = np.fft.fft(y_n)\n        \n        # Define frequency axis for the DFT\n        freqs = np.fft.fftfreq(N, 1/fs)\n\n        # Cutoff selection rule\n        f_c = delta_f + 10\n\n        # Create ideal LPF mask\n        lpf_mask = np.abs(freqs) = f_c\n\n        # Apply filter by zeroing out bins\n        Zk_filt = Zk * lpf_mask\n        Yk_filt = Yk * lpf_mask\n        \n        # 4. Compute metrics\n        \n        # Find indices for +/- delta_f\n        # Since frequencies are exact bin centers, we can cast to int.\n        k_df = int(delta_f * N / fs)\n        k_neg_df = int(-delta_f * N / fs) # Python handles negative indices correctly\n        \n        # Get magnitudes at +/- delta_f\n        mag_Z_df = np.abs(Zk_filt[k_df])\n        mag_Z_neg_df = np.abs(Zk_filt[k_neg_df])\n        \n        mag_Y_df = np.abs(Yk_filt[k_df])\n        mag_Y_neg_df = np.abs(Yk_filt[k_neg_df])\n\n        # Add a small epsilon to denominator to prevent division by zero\n        epsilon = 1e-15\n\n        # Calculate ratios\n        if sideband_type == \"upper\":\n            # For USB tone, expect signal at +delta_f\n            Rc = mag_Y_df / (mag_Y_neg_df + epsilon)\n        else: # \"lower\"\n            # For LSB tone, expect signal at -delta_f\n            Rc = mag_Y_neg_df / (mag_Y_df + epsilon)\n            \n        Rr = mag_Z_df / (mag_Z_neg_df + epsilon)\n        \n        # 5. Apply decision rules\n        sign_preserved = Rc > 100.0\n        \n        # Real demodulation should be symmetric\n        real_is_symmetric = 0.9 = Rr = 1.1\n        \n        # Image is eliminated if complex is highly asymmetric and real is symmetric\n        image_eliminated = sign_preserved and real_is_symmetric\n        \n        results.append([sign_preserved, image_eliminated])\n        \n    # Final print statement in the exact required format\n    print(f\"{str(results).replace(' ', '')}\")\n\nsolve()\n```"
        },
        {
            "introduction": "快速傅里叶变换（FFT）不仅用于频谱分析，其最强大的应用之一是执行快速卷积，这是数字滤波背后的数学运算。然而，FFT计算的是*循环*卷积，这与大多数滤波任务所需的*线性*卷积不同。本练习将指导您推导弥合这一差距所必需的补零条件，这是实现高效、准确的数字滤波器的基本技能。",
            "id": "4920806",
            "problem": "医学成像流程中的一个一维数字成像系统将一个已知的离散脉冲响应应用于一个离散反射率剖面。令 $x[n]$ 表示离散物体反射率，其具有有限支撑，$x[n]=0$ 对于 $n \\notin \\{0,\\dots,N_{x}-1\\}$；令 $h[n]$ 表示离散脉冲响应，其具有有限支撑，$h[n]=0$ 对于 $n \\notin \\{0,\\dots,N_{h}-1\\}$。期望的输出是线性卷积 $y[n] = \\sum_{m=-\\infty}^{\\infty} x[m]\\,h[n-m]$。为了提高计算效率，通过将两个序列都零填充到共同长度 $L$，然后使用离散傅里叶变换 (DFT) 及其通过快速傅里叶变换 (FFT) 实现的高效算法来计算输出。具体来说，该算法计算零填充序列的 $L$ 点 DFT 的逐点乘积，然后应用逆 $L$ 点 DFT，从而得到零填充序列的 $L$ 点循环卷积。\n\n从线性卷积、模 $L$ 循环卷积以及 DFT 的卷积定理的定义出发，推导使这个 $L$ 点循环卷积在所有 $y[n]$ 可能非零的索引上都精确等于线性卷积 $y[n]$ 的条件 $L$。然后，用 $N_{x}$ 和 $N_{h}$ 的封闭形式表达式给出满足该条件的最小 $L$。将您的最终答案表示为这个最小 $L$ 关于 $N_{x}$ 和 $N_{h}$ 的单个解析表达式。",
            "solution": "该问题要求推导离散傅里叶变换 (DFT) 的长度 $L$ 所需满足的条件，以使得两个零填充序列的循环卷积等于原始序列的线性卷积。我们已知两个离散序列，物体反射率 $x[n]$ 和脉冲响应 $h[n]$。\n\n首先，我们分析线性卷积的性质，用 $y[n]$ 表示。线性卷积的定义如下：\n$$y[n] = (x * h)[n] = \\sum_{m=-\\infty}^{\\infty} x[m]\\,h[n-m]$$\n序列 $x[n]$ 在 $n \\in \\{0, 1, \\dots, N_x-1\\}$ 上具有有限支撑，这意味着它的长度为 $N_x$。序列 $h[n]$ 在 $n \\in \\{0, 1, \\dots, N_h-1\\}$ 上具有有限支撑，这意味着它的长度为 $N_h$。由于两个序列都具有有限支撑，求和可以限制在 $x[m]$ 非零的索引上：\n$$y[n] = \\sum_{m=0}^{N_x-1} x[m]\\,h[n-m]$$\n为了使乘积 $x[m]h[n-m]$ 非零，$h$ 的自变量，即 $n-m$，也必须落在其支撑范围内，即 $0 \\le n-m \\le N_h-1$。\n得到的序列 $y[n]$ 也将具有有限支撑。$y[n]$ 的第一个非零样本出现在使 $x[m]$ 和 $h[n-m]$ 的支撑重叠的最小 $n$ 值处。这发生在 $m=0$ 和 $n-m=0$ 时，这意味着 $n=0$。所以，$y[n]$ 的支撑从 $n=0$ 开始。\n$y[n]$ 的最后一个非零样本出现在使支撑重叠的最大 $n$ 值处。这对应于 $x[m]$ 的最大索引 $m=N_x-1$ 和 $h$ 的自变量的最大索引 $n-m=N_h-1$。将 $m=N_x-1$ 代入第二个方程得到 $n-(N_x-1) = N_h-1$，解得 $n = N_x + N_h - 2$。\n因此，线性卷积 $y[n]$ 的支撑范围为索引 $n \\in \\{0, 1, \\dots, N_x + N_h - 2\\}$。序列 $y[n]$ 的长度，记为 $N_y$，是此支撑范围内的点数，即 $(N_x + N_h - 2) - 0 + 1 = N_x + N_h - 1$。\n\n所描述的计算过程包括将 $x[n]$ 和 $h[n]$ 零填充到共同长度 $L$。令这些填充后的序列为 $x_p[n]$ 和 $h_p[n]$。\n$$x_p[n] = \\begin{cases} x[n]  0 \\le n \\le N_x-1 \\\\ 0  N_x \\le n \\le L-1 \\end{cases}$$\n$$h_p[n] = \\begin{cases} h[n]  0 \\le n \\le N_h-1 \\\\ 0  N_h \\le n \\le L-1 \\end{cases}$$\n然后，该算法计算 $L$ 点 DFT $X_p[k]$ 和 $H_p[k]$、它们的乘积 $Y_p[k] = X_p[k]H_p[k]$ 以及乘积的逆 $L$ 点 DFT。根据 DFT 的卷积定理，这个结果是 $x_p[n]$ 和 $h_p[n]$ 的 $L$ 点循环卷积，我们将其表示为 $y_c[n]$。\n$$y_c[n] = \\sum_{m=0}^{L-1} x_p[m]\\,h_p[(n-m) \\pmod L]$$\n线性卷积 $y[n]$ 和循环卷积 $y_c[n]$（填充后序列的）之间的关系由下式给出：\n$$y_c[n] = \\sum_{k=-\\infty}^{\\infty} y[n+kL] \\quad \\text{for } n \\in \\{0, 1, \\dots, L-1\\}$$\n这个方程表明，循环卷积是线性卷积的时域混叠版本，其中线性卷积的结果以周期 $L$ 进行环绕和求和。\n\n为了使循环卷积 $y_c[n]$ 在 $y[n]$ 可能非零的区间（即 $n \\in \\{0, \\dots, N_x+N_h-2\\}$）上与线性卷积 $y[n]$ 完全相同，我们必须确保不发生环绕（混叠）。这意味着对于区间 $\\{0, \\dots, L-1\\}$ 中的每个 $n$，和 $\\sum_{k=-\\infty}^{\\infty} y[n+kL]$ 必须只包含一个非零项，即 $k=0$ 时的 $y[n]$。这要求对于所有整数 $k \\neq 0$，$y[n+kL]=0$。\n\n让我们分析这个条件：\n1.  对于 $k \\ge 1$：我们需要对于所有 $n \\in \\{0, \\dots, L-1\\}$，$y[n+kL]=0$。最小的索引是 $n+kL = 0+1\\cdot L = L$。因此，我们要求线性卷积 $y[j]$ 对于所有索引 $j \\ge L$ 都为零。由于 $y[n]$ 的支撑结束于 $n=N_x+N_h-2$，如果 $L > N_x+N_h-2$，则此条件得到满足。\n\n2.  对于 $k \\le -1$：我们需要对于所有 $n \\in \\{0, \\dots, L-1\\}$，$y[n+kL]=0$。让我们考虑 $k=-1$。最大的索引是 $n-L = (L-1)-L = -1$。我们要求 $y[j]$ 对于所有索引 $j \\le -1$ 都为零。$y[n]$ 的支撑从 $n=0$ 开始，所以这个条件总是满足的。对于 $k \\le -2$ 的条件甚至更不严格。\n\n综合这些观察，防止时域混叠的唯一条件是长度 $L$ 必须足够大，以包含整个线性卷积结果而不会发生环绕。线性卷积结果 $y[n]$ 的长度是 $N_y = N_x+N_h-1$。因此，循环卷积的缓冲区长度必须至少这么长。\n条件是 $L \\ge N_y$，即：\n$$L \\ge N_x + N_h - 1$$\n这个不等式就是推导出的关于 $L$ 的条件。\n\n问题要求的是满足该条件的最小 $L$。鉴于 $L$ 必须是一个满足 $L \\ge N_x + N_h - 1$ 的整数， $L$ 的最小可能值就是满足这个条件的最小整数。这个最小值恰好是 $N_x + N_h - 1$。\n因此，使得 $L$ 点循环卷积等于线性卷积的最小长度 $L$ 是：\n$$L_{\\text{min}} = N_x + N_h - 1$$",
            "answer": "$$\\boxed{N_{x} + N_{h} - 1}$$"
        },
        {
            "introduction": "离散傅里叶变换（DFT）提供了信号的频域快照，但这种视角有其固有的局限性。当信号的频率与DFT的某个频率“点”不完全对齐时，其能量会“泄漏”到相邻的频率点中，这种伪影被称为频谱泄漏。本练习将深入探讨该效应的数学根源，使您能够量化泄漏，从而更好地解释真实世界中非理想信号的频谱。",
            "id": "4920820",
            "problem": "在磁共振成像中，沿频率编码方向的一维读出会产生一个复值时间序列，随后使用离散傅里叶变换（DFT）进行分析，而DFT通常通过快速傅里叶变换（FFT）计算。考虑读出信号中的一个复指数分量，其频率未精确对准某个DFT频率仓，这种情况由于有限长度采样带来的隐式矩形窗，会导致栅栏效应和频谱泄漏。\n\n设采样信号为\n$$\nx[n] = A\\,\\exp\\!\\left(j\\,2\\pi\\,\\frac{k_{0}+\\delta}{N}\\,n\\right), \\quad n = 0,1,\\dots,N-1,\n$$\n其中 $A \\in \\mathbb{C}$ 是一个恒定振幅，$N \\in \\mathbb{N}$ 是DFT的长度，$k_{0} \\in \\mathbb{Z}$ 是一个整数，表示距离该单频信号最近的DFT频率仓的索引，而 $\\delta \\in (0,\\,\\tfrac{1}{2})$ 是一个分数偏移，表示该单频信号的频率位于两个频率仓之间。DFT的定义为\n$$\nX[k] = \\sum_{n=0}^{N-1} x[n]\\,\\exp\\!\\left(-j\\,2\\pi\\,\\frac{k}{N}\\,n\\right), \\quad k = 0,1,\\dots,N-1.\n$$\n\n从DFT的定义以及几何级数和复指数的基本性质出发，推导一个用 $A$、$N$、$k$、$k_{0}$ 和 $\\delta$ 表示的 $X[k]$ 的闭式表达式。然后，利用你的结果，通过推导功率比\n$$\nR(\\delta, N) = \\frac{|X[k_{0}+1]|^{2}}{|X[k_{0}]|^{2}}\n$$\n来量化到相邻频率仓的频谱泄漏。\n\n将你的最终答案表示为仅含 $\\delta$ 和 $N$ 的单个闭式解析表达式。不需要进行数值计算或四舍五入。答案必须是单个表达式，而不是不等式或待解方程。",
            "solution": "信号为\n$$\nx[n] = A\\,\\exp\\!\\left(j\\,2\\pi\\,\\frac{k_{0}+\\delta}{N}\\,n\\right),\n$$\n离散傅里叶变换（DFT）为\n$$\nX[k] = \\sum_{n=0}^{N-1} x[n]\\,\\exp\\!\\left(-j\\,2\\pi\\,\\frac{k}{N}\\,n\\right).\n$$\n将 $x[n]$ 代入DFT定义可得\n$$\nX[k] = A \\sum_{n=0}^{N-1} \\exp\\!\\left(j\\,2\\pi\\,\\frac{k_{0}+\\delta - k}{N}\\,n\\right).\n$$\n定义\n$$\n\\alpha \\triangleq k_{0} + \\delta - k,\n$$\n于是\n$$\nX[k] = A \\sum_{n=0}^{N-1} \\left(\\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)\\right)^{n}.\n$$\n这是一个公比为 $r = \\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)$ 的有限几何级数，因此\n$$\n\\sum_{n=0}^{N-1} r^{n} = \\frac{1 - r^{N}}{1 - r} = \\frac{1 - \\exp\\!\\left(j\\,2\\pi\\,\\alpha\\right)}{1 - \\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)}.\n$$\n为了得到一个能揭示其幅度特性的形式，使用恒等式\n$$\n1 - \\exp(j\\theta) = \\exp\\!\\left(j\\frac{\\theta}{2}\\right)\\left(\\exp\\!\\left(-j\\frac{\\theta}{2}\\right) - \\exp\\!\\left(j\\frac{\\theta}{2}\\right)\\right) = -2j\\,\\exp\\!\\left(j\\frac{\\theta}{2}\\right)\\sin\\!\\left(\\frac{\\theta}{2}\\right).\n$$\n将此恒等式应用于分子和分母，其中 $\\theta = 2\\pi\\alpha$ 和 $\\theta = 2\\pi\\frac{\\alpha}{N}$，可得\n$$\n\\frac{1 - \\exp\\!\\left(j\\,2\\pi\\,\\alpha\\right)}{1 - \\exp\\!\\left(j\\,2\\pi\\,\\frac{\\alpha}{N}\\right)}\n= \\frac{-2j\\,\\exp\\!\\left(j\\,\\pi\\,\\alpha\\right)\\,\\sin\\!\\left(\\pi\\alpha\\right)}{-2j\\,\\exp\\!\\left(j\\,\\pi\\,\\frac{\\alpha}{N}\\right)\\,\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}\n= \\exp\\!\\left(j\\,\\pi\\,\\alpha\\left(1 - \\frac{1}{N}\\right)\\right)\\,\\frac{\\sin\\!\\left(\\pi\\alpha\\right)}{\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}.\n$$\n因此，\n$$\nX[k] = A\\,\\exp\\!\\left(j\\,\\pi\\,\\alpha\\,\\frac{N-1}{N}\\right)\\,\\frac{\\sin\\!\\left(\\pi\\alpha\\right)}{\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}.\n$$\n$X[k]$ 的幅度为\n$$\n|X[k]| = |A|\\,\\left|\\frac{\\sin\\!\\left(\\pi\\alpha\\right)}{\\sin\\!\\left(\\frac{\\pi\\alpha}{N}\\right)}\\right|.\n$$\n我们现在计算在主频率仓 $k = k_{0}$ 和相邻的较高频率仓 $k = k_{0}+1$ 处的 $|X[k]|$。\n\n对于 $k = k_{0}$，我们有 $\\alpha = k_{0} + \\delta - k_{0} = \\delta$，因此\n$$\n|X[k_{0}]| = |A|\\,\\left|\\frac{\\sin\\!\\left(\\pi\\delta\\right)}{\\sin\\!\\left(\\frac{\\pi\\delta}{N}\\right)}\\right|.\n$$\n对于 $k = k_{0}+1$，我们有 $\\alpha = k_{0} + \\delta - (k_{0}+1) = \\delta - 1$，因此\n$$\n|X[k_{0}+1]|\n= |A|\\,\\left|\\frac{\\sin\\!\\left(\\pi(\\delta - 1)\\right)}{\\sin\\!\\left(\\frac{\\pi(\\delta - 1)}{N}\\right)}\\right|.\n$$\n利用 $\\sin(\\pi(\\delta - 1)) = -\\sin(\\pi(1 - \\delta)) = -\\sin(\\pi\\delta)$ 和 $\\sin\\!\\left(\\frac{\\pi(\\delta - 1)}{N}\\right) = -\\sin\\!\\left(\\frac{\\pi(1 - \\delta)}{N}\\right)$，我们得到\n$$\n|X[k_{0}+1]| = |A|\\,\\frac{|\\sin(\\pi\\delta)|}{\\left|\\sin\\!\\left(\\frac{\\pi(1 - \\delta)}{N}\\right)\\right|}.\n$$\n泄漏到相邻频率仓的所需功率比为\n$$\nR(\\delta, N) = \\frac{|X[k_{0}+1]|^{2}}{|X[k_{0}]|^{2}}\n= \\frac{|A|^{2}\\,\\dfrac{|\\sin(\\pi\\delta)|^{2}}{\\left|\\sin\\!\\left(\\dfrac{\\pi(1 - \\delta)}{N}\\right)\\right|^{2}}}{|A|^{2}\\,\\dfrac{|\\sin(\\pi\\delta)|^{2}}{\\left|\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)\\right|^{2}}}\n= \\frac{\\left|\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)\\right|^{2}}{\\left|\\sin\\!\\left(\\dfrac{\\pi(1 - \\delta)}{N}\\right)\\right|^{2}}.\n$$\n因为 $\\delta \\in (0, \\tfrac{1}{2})$ 且 $N \\in \\mathbb{N}$，正弦函数的参数位于 $(0, \\tfrac{\\pi}{2})$ 区间内，所以可以去掉绝对值而不改变结果：\n$$\nR(\\delta, N) = \\left(\\frac{\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)}{\\sin\\!\\left(\\dfrac{\\pi(1 - \\delta)}{N}\\right)}\\right)^{2}.\n$$\n这个闭式表达式根据分数偏移 $\\delta$ 和变换长度 $N$ 量化了由于栅栏效应导致的向相邻频率仓的频谱泄漏。",
            "answer": "$$\\boxed{\\left(\\frac{\\sin\\!\\left(\\dfrac{\\pi\\delta}{N}\\right)}{\\sin\\!\\left(\\dfrac{\\pi(1-\\delta)}{N}\\right)}\\right)^{2}}$$"
        }
    ]
}