{
    "hands_on_practices": [
        {
            "introduction": "理论与实践的结合是掌握科学概念的关键。本练习将抽象的点扩散函数（PSF）概念与在光学显微镜领域的真实实验测量联系起来。通过模拟分析一个常见的“珠子模体”实验，你将学习如何从测量的图像中“解卷积”掉探测工具（微球）自身的尺寸效应，从而精确地分离出成像系统真实的PSF。这个过程不仅能加深你对卷积的理解，也是表征和校准成像系统性能的一项核心技能。",
            "id": "4897191",
            "problem": "一台宽场光学显微镜在其成像可被建模为线性移不变 (LSI) 系统的工作状态下运行，该系统在信号处理中通常通过类比被称为线性时不变 (LTI) 系统。物体强度分布 $f(\\mathbf{r})$ 通过与点扩展函数 (PSF)（记为 $h(\\mathbf{r})$）进行空间卷积，成像为测量强度 $m(\\mathbf{r})$。您的任务是设计并分析一个微球模型实验，以估计系统的 PSF，并消除由有限微球尺寸引入的展宽。\n\n您必须使用的基本原理包括：\n- LSI 成像模型的定义：$m(\\mathbf{r}) = (h * f)(\\mathbf{r})$，其中 $*$ 是空间卷积。\n- PSF 的定义，即脉冲状物体的像。\n- 归一化核函数在卷积下的空间矩性质。\n- 高斯函数的参数形式。\n\n请设计一个合理的实验，并从第一性原理出发按如下步骤推导反卷积关系：\n1. 考虑已知半径为 $a$ 的荧光微球（beads），它们在其体积内均匀发光。在焦平面上，每个微球可以被建模为一个半径为 $a$ 的均匀圆盘，其归一化后积分为1，即一个面“顶帽”核函数 $b(\\mathbf{r})$，其支撑集为 $|\\mathbf{r}| \\leq a$，在其他地方为零，并归一化使得 $\\int_{\\mathbb{R}^{2}} b(\\mathbf{r}) \\,\\mathrm{d}\\mathbf{r} = 1$。稀疏地放置微球以避免重叠，并在相同条件下对它们成像以最小化变异性。\n2. 假设显微镜的横向 PSF 是各向同性的，并且可以很好地用一个零均值高斯函数 $h(\\mathbf{r})$ 来近似，其沿任意横向轴的标准差 $\\sigma_{\\mathrm{sys}}$ 未知。测得的微球图像 $m(\\mathbf{r})$ 是 $h(\\mathbf{r})$ 和 $b(\\mathbf{r})$ 的卷积，您需要用一个高斯函数拟合穿过微球中心的 $m(\\mathbf{r})$ 的横向截面，以获得测量的标准差 $\\sigma_{\\mathrm{meas}}$。\n3. 从上述定义出发，不使用任何快捷公式，通过使用归一化核函数卷积的矩性质，并计算均匀圆盘模型的二阶中心矩，推导出用 $\\sigma_{\\mathrm{meas}}$ 和 $a$ 表示 $\\sigma_{\\mathrm{sys}}$ 的解析表达式。\n4. 根据您推导出的 $\\sigma_{\\mathrm{sys}}$，求出系统高斯 PSF 沿一个横向轴的半峰全宽 (FWHM)。\n\n对于一个具体实验，取微球半径为 $a = 120\\,\\mathrm{nm}$，对测得微球图像的高斯拟合给出横向截面的 $\\sigma_{\\mathrm{meas}} = 200\\,\\mathrm{nm}$。使用您的推导，计算系统 PSF 的横向 FWHM，并用微米表示您的最终数值答案。将您的答案四舍五入到四位有效数字。最终答案必须是一个实数。",
            "solution": "问题陈述已经过验证，被认为是具有科学依据、良置且客观的。它提出了光学显微镜表征中的一个标准任务，可以使用信号处理和统计学的基本原理解答。因此，我们可以进行推导和计算。\n\n该问题描述了一个被建模为线性移不变 (LSI) 系统的成像过程。测量的图像强度 $m(\\mathbf{r})$ 是物体的内在强度分布 $f(\\mathbf{r})$ 与系统的点扩展函数 (PSF) $h(\\mathbf{r})$ 的空间卷积。\n$$m(\\mathbf{r}) = (h * f)(\\mathbf{r}) = \\int_{\\mathbb{R}^2} h(\\mathbf{r} - \\mathbf{r'}) f(\\mathbf{r'}) \\, \\mathrm{d}\\mathbf{r'}$$\n在这个实验中，物体是一个孤立的荧光微球，被建模为半径为 $a$ 的均匀圆盘。其强度分布（记为 $b(\\mathbf{r})$）替代了 $f(\\mathbf{r})$。系统的 PSF $h(\\mathbf{r})$ 被假设为一个各向同性的零均值高斯函数。得到的测量微球图像是 $m(\\mathbf{r}) = (h * b)(\\mathbf{r})$。$h(\\mathbf{r})$ 和 $b(\\mathbf{r})$ 都被归一化以使积分为1，这是将它们视为用于矩分析的概率密度函数的一个要求。\n\n我们的推导关键在于这样一个性质：对于两个零均值、归一化的函数卷积，结果函数的方差是各单个函数方差的和。我们首先证明这个性质。一个归一化的二维函数 $g(x,y)$ 沿 $x$ 轴的方差是它的二阶中心矩。由于函数是零均值的，所以方差为 $\\sigma_{g,x}^2 = \\int_{\\mathbb{R}^2} x^2 g(x,y) \\, \\mathrm{d}x\\mathrm{d}y$。\n测量图像 $m(x,y)$ 沿 $x$ 轴的方差为：\n$$\\sigma_{m,x}^2 = \\int_{\\mathbb{R}^2} x^2 m(x,y) \\, \\mathrm{d}x\\mathrm{d}y = \\int_{\\mathbb{R}^2} x^2 \\left( \\int_{\\mathbb{R}^2} h(x-x', y-y') b(x',y') \\, \\mathrm{d}x'\\mathrm{d}y' \\right) \\mathrm{d}x\\mathrm{d}y$$\n令 $u = x-x'$ 和 $v = y-y'$，所以 $x = u+x'$ 和 $y=v+y'$。微分元 $\\mathrm{d}x\\mathrm{d}y$ 变为 $\\mathrm{d}u\\mathrm{d}v$。\n$$\\sigma_{m,x}^2 = \\int_{\\mathbb{R}^2} \\int_{\\mathbb{R}^2} (u+x')^2 h(u,v) b(x',y') \\, \\mathrm{d}u\\mathrm{d}v \\, \\mathrm{d}x'\\mathrm{d}y'$$\n展开平方项 $(u+x')^2 = u^2 + 2ux' + (x')^2$：\n$$\\sigma_{m,x}^2 = \\int_{\\mathbb{R}^2} \\int_{\\mathbb{R}^2} (u^2 + 2ux' + (x')^2) h(u,v) b(x',y') \\, \\mathrm{d}u\\mathrm{d}v \\, \\mathrm{d}x'\\mathrm{d}y'$$\n我们可以将其分为三项：\n$$1. \\quad \\int_{\\mathbb{R}^2} u^2 h(u,v) \\, \\mathrm{d}u\\mathrm{d}v \\int_{\\mathbb{R}^2} b(x',y') \\, \\mathrm{d}x'\\mathrm{d}y' = \\sigma_{h,x}^2 \\cdot 1 = \\sigma_{h,x}^2$$\n$$2. \\quad 2 \\int_{\\mathbb{R}^2} u h(u,v) \\, \\mathrm{d}u\\mathrm{d}v \\int_{\\mathbb{R}^2} x' b(x',y') \\, \\mathrm{d}x'\\mathrm{d}y' = 2 \\cdot (h \\text{的均值}) \\cdot (b \\text{的均值}) = 2 \\cdot 0 \\cdot 0 = 0$$\n$$3. \\quad \\int_{\\mathbb{R}^2} h(u,v) \\, \\mathrm{d}u\\mathrm{d}v \\int_{\\mathbb{R}^2} (x')^2 b(x',y') \\, \\mathrm{d}x'\\mathrm{d}y' = 1 \\cdot \\sigma_{b,x}^2 = \\sigma_{b,x}^2$$\n将这些项相加，得到方差的可加性：\n$$\\sigma_{m,x}^2 = \\sigma_{h,x}^2 + \\sigma_{b,x}^2$$\n由于 PSF 和微球模型都是各向同性的，沿任意横向轴的方差都相同，因此我们可以省略下标 $x$。\n问题陈述指出，测量的轮廓用高斯函数拟合，得到标准差 $\\sigma_{\\mathrm{meas}}$。这对应于 $\\sigma_m$。系统 PSF 是一个标准差为 $\\sigma_{\\mathrm{sys}}$ 的高斯函数，这对应于 $\\sigma_h$。因此，关系式为：\n$$\\sigma_{\\mathrm{meas}}^2 = \\sigma_{\\mathrm{sys}}^2 + \\sigma_{b}^2$$\n\n接下来，我们必须计算微球的均匀圆盘模型的方差 $\\sigma_{b}^2$。微球是一个半径为 $a$ 的均匀圆盘。其强度分布 $b(\\mathbf{r})$ 由下式给出：\n$$b(x,y) = \\begin{cases} C  \\text{if } x^2+y^2 \\leq a^2 \\\\ 0  \\text{otherwise} \\end{cases}$$\n归一化条件 $\\int_{\\mathbb{R}^2} b(x,y) \\, \\mathrm{d}x\\mathrm{d}y = 1$ 要求 $C \\cdot (\\pi a^2) = 1$，所以 $C = \\frac{1}{\\pi a^2}$。该模型关于原点对称，因此其均值为零。沿 $x$ 轴的方差为：\n$$\\sigma_{b}^2 = \\int_{\\mathbb{R}^2} x^2 b(x,y) \\, \\mathrm{d}x\\mathrm{d}y = \\frac{1}{\\pi a^2} \\iint_{x^2+y^2 \\leq a^2} x^2 \\, \\mathrm{d}x\\mathrm{d}y$$\n我们转换为极坐标，其中 $x = r\\cos\\theta$ 且 $\\mathrm{d}x\\mathrm{d}y = r\\,\\mathrm{d}r\\mathrm{d}\\theta$。\n$$\\sigma_{b}^2 = \\frac{1}{\\pi a^2} \\int_0^{2\\pi} \\int_0^a (r\\cos\\theta)^2 r \\, \\mathrm{d}r\\mathrm{d}\\theta = \\frac{1}{\\pi a^2} \\int_0^{2\\pi} \\int_0^a r^3 \\cos^2\\theta \\, \\mathrm{d}r\\mathrm{d}\\theta$$\n该积分是可分离的：\n$$\\sigma_{b}^2 = \\frac{1}{\\pi a^2} \\left(\\int_0^a r^3 \\, \\mathrm{d}r\\right) \\left(\\int_0^{2\\pi} \\cos^2\\theta \\, \\mathrm{d}\\theta\\right)$$\n径向积分为 $\\int_0^a r^3 \\, \\mathrm{d}r = \\left[\\frac{r^4}{4}\\right]_0^a = \\frac{a^4}{4}$。\n角向积分为 $\\int_0^{2\\pi} \\cos^2\\theta \\, \\mathrm{d}\\theta = \\int_0^{2\\pi} \\frac{1+\\cos(2\\theta)}{2} \\, \\mathrm{d}\\theta = \\left[\\frac{\\theta}{2} + \\frac{\\sin(2\\theta)}{4}\\right]_0^{2\\pi} = \\pi$。\n代入这些结果：\n$$\\sigma_{b}^2 = \\frac{1}{\\pi a^2} \\left(\\frac{a^4}{4}\\right) (\\pi) = \\frac{a^2}{4}$$\n现在我们可以写出 $\\sigma_{\\mathrm{sys}}$ 的表达式。将 $\\sigma_b^2 = a^2/4$ 代入方差相加公式：\n$$\\sigma_{\\mathrm{meas}}^2 = \\sigma_{\\mathrm{sys}}^2 + \\frac{a^2}{4}$$\n解出 $\\sigma_{\\mathrm{sys}}$ 得到所需的解析表达式：\n$$\\sigma_{\\mathrm{sys}} = \\sqrt{\\sigma_{\\mathrm{meas}}^2 - \\frac{a^2}{4}}$$\n这就完成了推导的第一部分。\n\n对于第二部分，我们必须求出系统高斯 PSF 的半峰全宽 (FWHM)。PSF 的一维横截面由 $h(x) = A \\exp\\left(-\\frac{x^2}{2\\sigma_{\\mathrm{sys}}^2}\\right)$ 给出，其中 $A$ 是某个振幅。最大值是 $h(0) = A$。FWHM 是宽度 $2x_{HM}$，其中 $h(x_{HM}) = A/2$。\n$$A \\exp\\left(-\\frac{x_{HM}^2}{2\\sigma_{\\mathrm{sys}}^2}\\right) = \\frac{A}{2}$$\n$$\\exp\\left(-\\frac{x_{HM}^2}{2\\sigma_{\\mathrm{sys}}^2}\\right) = \\frac{1}{2}$$\n对两边取自然对数：\n$$-\\frac{x_{HM}^2}{2\\sigma_{\\mathrm{sys}}^2} = \\ln\\left(\\frac{1}{2}\\right) = -\\ln(2)$$\n$$x_{HM}^2 = 2 \\sigma_{\\mathrm{sys}}^2 \\ln(2) \\implies x_{HM} = \\sigma_{\\mathrm{sys}} \\sqrt{2 \\ln(2)}$$\nFWHM 是这个值的两倍：\n$$\\text{FWHM}_{\\mathrm{sys}} = 2 x_{HM} = 2 \\sqrt{2 \\ln(2)} \\sigma_{\\mathrm{sys}}$$\n代入我们关于 $\\sigma_{\\mathrm{sys}}$ 的表达式：\n$$\\text{FWHM}_{\\mathrm{sys}} = 2 \\sqrt{2 \\ln(2)} \\sqrt{\\sigma_{\\mathrm{meas}}^2 - \\frac{a^2}{4}}$$\n现在我们代入给定的数值：$a = 120\\,\\mathrm{nm}$ 和 $\\sigma_{\\mathrm{meas}} = 200\\,\\mathrm{nm}$。所有计算都将以纳米 (nm) 为单位进行。\n$$\\sigma_{\\mathrm{sys}}^2 = (200)^2 - \\frac{(120)^2}{4} = 40000 - \\frac{14400}{4} = 40000 - 3600 = 36400\\,\\mathrm{nm}^2$$\n$$\\sigma_{\\mathrm{sys}} = \\sqrt{36400}\\,\\mathrm{nm}$$\n现在我们计算 FWHM：\n$$\\text{FWHM}_{\\mathrm{sys}} = 2 \\sqrt{2 \\ln(2)} \\sqrt{36400}\\,\\mathrm{nm}$$\n使用值 $\\ln(2) \\approx 0.693147$：\n$$\\text{FWHM}_{\\mathrm{sys}} = 2 \\sqrt{2 \\cdot 0.693147} \\cdot \\sqrt{36400}\\,\\mathrm{nm}$$\n$$\\text{FWHM}_{\\mathrm{sys}} \\approx 2 \\sqrt{1.386294} \\cdot 190.7878...\\,\\mathrm{nm}$$\n$$\\text{FWHM}_{\\mathrm{sys}} \\approx 2.35482 \\cdot 190.7878...\\,\\mathrm{nm} \\approx 449.284\\,\\mathrm{nm}$$\n问题要求答案以微米 ($\\mu$m) 为单位，并四舍五入到四位有效数字。\n$$1\\,\\mathrm{nm} = 10^{-3}\\,\\mu\\mathrm{m}$$\n$$\\text{FWHM}_{\\mathrm{sys}} \\approx 449.284 \\times 10^{-3}\\,\\mu\\mathrm{m} = 0.449284\\,\\mu\\mathrm{m}$$\n四舍五入到四位有效数字得到 $0.4493\\,\\mu\\mathrm{m}$。",
            "answer": "$$\\boxed{0.4493}$$"
        },
        {
            "introduction": "在理解了如何测量PSF后，一个核心的工程问题是如何高效地执行卷积运算。本练习将探讨一种基于PSF自身数学结构的强大优化技巧——可分离性。通过证明一个三维可分离核的卷积可以分解为三次独立的一维卷积，你将亲手计算并量化这种特性所带来的巨大计算速度提升。掌握这一原理对于在多维信号处理中设计高效算法至关重要。",
            "id": "4897196",
            "problem": "医学成像基础中的三维成像系统可以建模为一个线性、移位不变（也称为线性、时不变）系统，其冲激响应（点扩散函数）为 $h(\\mathbf{r})$，其中 $\\mathbf{r} = (x,y,z)$ 是一个离散立方网格的索引。这样一个系统对于输入体数据 $f$ 的输出 $g$ 是离散卷积\n$$\ng(x,y,z) = (f * h)(x,y,z) = \\sum_{u}\\sum_{v}\\sum_{w} f(x-u, y-v, z-w)\\, h(u,v,w),\n$$\n其中求和遍及 $f$ 和 $h$ 的支撑域内的所有整数索引。假设冲激响应是可分离的，即对于某些一维核 $h_x$、$h_y$ 和 $h_z$，它可以写成 $h(u,v,w) = h_x(u)\\, h_y(v)\\, h_z(w)$。\n\n(a) 仅从离散卷积的定义和有限和的代数性质（加法和标量乘法的线性性、交换律和结合律）出发，证明 $g$ 可以通过沿 $x$、$y$ 和 $z$ 轴（以任意顺序）对 $f$ 进行三次连续的一维卷积来计算，每次使用相应的核 $h_x$、$h_y$ 和 $h_z$。\n\n(b) 设输入体数据的大小为 $N \\times N \\times N$，并假设每个维度上进行循环卷积，以使每个输出体素都涉及完整的核支撑域。设每个一维核的有限长度为 $K$（因此 $h$ 的支撑域为 $K \\times K \\times K$）。将算术复杂度定义为计算所有 $N^3$ 个输出体素所需的标量乘法总数。计算使用三次一维卷积而非单次直接三维卷积的乘法加速因子，定义为以下比率：\n$$\nS(K) = \\frac{\\text{直接 3D 卷积所需的乘法次数}}{\\text{三次连续 1D 卷积所需的乘法次数}}。\n$$\n将你的最终答案表示为仅含 $K$ 的单个简化解析表达式。不包含单位。",
            "solution": "首先根据所需标准对问题陈述进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- **系统**：一个建模为线性、移位不变 (LSI) 系统的三维成像系统。\n- **冲激响应 (PSF)**：$h(\\mathbf{r})$，其中 $\\mathbf{r} = (x,y,z)$ 在一个离散立方网格上。\n- **输入**：$f$。\n- **输出**：$g$。\n- **3D 卷积定义**：$g(x,y,z) = (f * h)(x,y,z) = \\sum_{u}\\sum_{v}\\sum_{w} f(x-u, y-v, z-w)\\, h(u,v,w)$。求和遍及 $f$ 和 $h$ 的支撑域内的所有整数索引。\n- **可分离冲激响应**：$h(u,v,w) = h_x(u)\\, h_y(v)\\, h_z(w)$，其中 $h_x, h_y, h_z$ 为一维核。\n- **(a) 部分目标**：仅使用卷积定义和有限和的代数性质，证明 $g$ 可由沿坐标轴的三次连续一维卷积计算得出。卷积的顺序不应影响结果。\n- **(b) 部分参数**：\n    - 输入体数据大小：$N \\times N \\times N$。\n    - 卷积类型：每个维度上进行循环卷积。\n    - 核支撑域：每个一维核（$h_x, h_y, h_z$）的长度为 $K$。三维核 $h$ 的支撑域为 $K \\times K \\times K$。\n    - 复杂度度量：标量乘法的总数。\n- **(b) 部分目标**：计算乘法加速因子 $S(K) = \\frac{\\text{直接 3D 卷积所需的乘法次数}}{\\text{三次连续 1D 卷积所需的乘法次数}}$，并表示为仅关于 $K$ 的函数。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题很好地基于线性系统理论的原理，这是信号处理及其在医学成像中应用的基石。LSI 系统、冲激响应 (PSF)、卷积和可分离核等概念都是标准和基础的。\n- **适定性**：该问题是适定的。(a) 部分要求基于给定的公理（卷积定义和求和性质）进行数学证明。(b) 部分是一个计算复杂度分析，所有参数（$N$、$K$）和计算规则（循环卷积、计算乘法次数）都已明确定义，从而可以得出一个唯一的加速比解析表达式。\n- **客观性**：问题以精确、客观和数学化的语言陈述。没有主观或含糊不清的术语。\n- **缺陷分析**：\n    1.  **科学/事实不准确**：无。数学和物理模型都是标准的。\n    2.  **非形式化/不相关**：无。问题是完全可形式化的，并且与医学成像中的 LTI 系统主题直接相关。\n    3.  **不完整/矛盾的设置**：无。所有必要的定义和约束都已提供。“有限和”的提法与有限支撑域（$K$）的核是一致的。\n    4.  **不切实际/不可行**：无。可分离 PSF 在实践中是一种常见且在计算上非常重要的特例。\n    5.  **不适定/结构不良**：无。问题清晰，可以得出唯一确定的答案。\n    6.  **伪深刻/琐碎**：无。虽然这是一个标准结果，但 (a) 部分的推导需要仔细应用基本原理。(b) 部分的计算展示了一个具有实际意义的计算原理。\n    7.  **超出科学可验证性**：无。证明和计算在数学上是可验证的。\n\n**步骤3：结论与行动**\n问题是**有效的**。继续进行解答。\n\n### 解答\n\n**(a) 可分离卷积的证明**\n\n我们从三维离散卷积对输出 $g(x,y,z)$ 的定义开始：\n$$\ng(x,y,z) = \\sum_{u}\\sum_{v}\\sum_{w} f(x-u, y-v, z-w)\\, h(u,v,w)\n$$\n问题陈述指出冲激响应 $h$ 是可分离的。我们将给定的形式 $h(u,v,w) = h_x(u)\\, h_y(v)\\, h_z(w)$ 代入卷积和中：\n$$\ng(x,y,z) = \\sum_{u}\\sum_{v}\\sum_{w} f(x-u, y-v, z-w)\\, h_x(u)\\, h_y(v)\\, h_z(w)\n$$\n由于核具有有限支撑域，所以这些是有限和。利用有限和的代数性质（特别是分配律，它允许将不依赖于求和索引的项提取出来），我们可以重新排列求和顺序并对各项进行分组。让我们首先对关于 $u$ 的求和进行分组。\n$$\ng(x,y,z) = \\sum_{v}\\sum_{w} h_y(v)\\, h_z(w) \\left[ \\sum_{u} f(x-u, y-v, z-w)\\, h_x(u) \\right]\n$$\n括号内的表达式是输入体数据 $f$ 的一个切片与核 $h_x$ 的一维卷积。我们定义一个中间体数据 $g_1$，其中 $f$ 的每一条沿 $x$ 方向的线都与 $h_x$ 进行卷积：\n$$\ng_1(x, y', z') = \\sum_{u} f(x-u, y', z')\\, h_x(u)\n$$\n将此定义代入我们对 $g(x,y,z)$ 的表达式中，并令 $y' = y-v$ 和 $z' = z-w$：\n$$\ng(x,y,z) = \\sum_{v}\\sum_{w} h_y(v)\\, h_z(w)\\, g_1(x, y-v, z-w)\n$$\n接下来，我们可以对关于 $v$ 的求和进行分组：\n$$\ng(x,y,z) = \\sum_{w} h_z(w) \\left[ \\sum_{v} g_1(x, y-v, z-w)\\, h_y(v) \\right]\n$$\n新括号内的表达式是中间体数据 $g_1$ 的一个切片与核 $h_y$ 的一维卷积。我们定义第二个中间体数据 $g_2$，其中 $g_1$ 的每一条沿 $y$ 方向的线都与 $h_y$ 进行卷积：\n$$\ng_2(x', y, z') = \\sum_{v} g_1(x', y-v, z')\\, h_y(v)\n$$\n将此定义代入我们对 $g(x,y,z)$ 的表达式中，并令 $x' = x$ 和 $z' = z-w$：\n$$\ng(x,y,z) = \\sum_{w} g_2(x, y, z-w)\\, h_z(w)\n$$\n这最后的表达式是体数据 $g_2$ 中沿 $z$ 方向的线与核 $h_z$ 的一维卷积。因此，最终输出 $g$ 通过以下方式获得：\n$$\ng(x,y,z) = \\sum_{w} g_2(x, y, z-w)\\, h_z(w)\n$$\n这表明 3D 卷积可以通过三次连续的 1D 卷积来计算：首先沿一个轴（例如 $x$ 轴），然后沿第二个轴（例如 $y$ 轴），最后沿第三个轴（例如 $z$ 轴）。\n\n为了证明这可以按任何顺序进行，我们认识到重新组合求和的能力是有限集上加法交换律和结合律的结果。例如，我们可以先分离出关于 $w$ 的求和：\n$$\ng(x,y,z) = \\sum_{u}\\sum_{v} h_x(u)\\, h_y(v) \\left[ \\sum_{w} f(x-u, y-v, z-w)\\, h_z(w) \\right]\n$$\n这对应于首先沿 $z$ 轴执行卷积。由于三个求和索引 $u,v,w$ 是独立的，求和可以按 $3! = 6$ 种可能的顺序中的任何一种进行，这直接对应于沿 $x,y,z$ 轴进行 1D 卷积的六种可能的排序。这完成了 (a) 部分的证明。\n\n**(b) 乘法加速因子**\n\n我们将算术复杂度定义为计算整个 $N \\times N \\times N$ 输出体数据所需的标量乘法总数。\n\n**1. 直接 3D 卷积的复杂度**\n\n要使用直接方法计算单个输出体素 $g(x,y,z)$，我们评估：\n$$\ng(x,y,z) = \\sum_{u}\\sum_{v}\\sum_{w} f(\\dots)\\, h(u,v,w)\n$$\n问题陈述指出 1D 核的长度为 $K$，因此 3D 核 $h(u,v,w)$ 在 $K \\times K \\times K$ 的支撑域上非零。这意味着对 $u$、$v$ 和 $w$ 的求和各自都遍历 $K$ 个值。单个输出体素的求和项总数为 $K \\times K \\times K = K^3$。每一项包含一次乘法。\n因此，每个输出体素的乘法次数为 $K^3$。\n输出体数据有 $N \\times N \\times N = N^3$ 个体素。\n直接 3D 卷积的总乘法次数 $C_{3D}$ 是：\n$$\nC_{3D} = (\\text{体素数}) \\times (\\text{每个体素的乘法次数}) = N^3 \\times K^3\n$$\n\n**2. 可分离 1D 卷积的复杂度**\n\n如 (a) 部分所示，该计算分三个阶段进行。\n\n*   **阶段 1：沿 $x$ 轴的卷积。**\n    我们将输入 $f$ 与 $h_x$ 进行卷积。这涉及到对体数据的每一“行”执行 1D 卷积，其中“行”由一个固定的 $(y,z)$ 对定义。共有 $N \\times N = N^2$ 个这样的行。\n    对于每一行，我们是在对一个 $N$ 点信号和一个 $K$ 点核执行 1D 循环卷积。要计算这个 1D 卷积中的 $N$ 个输出点中的每一个点，需要 $K$ 次乘法。\n    一行的乘法次数：$N \\times K$。\n    阶段 1 的总乘法次数：$(\\text{行数}) \\times (\\text{每行的乘法次数}) = N^2 \\times (NK) = N^3 K$。\n\n*   **阶段 2：沿 $y$ 轴的卷积。**\n    我们将阶段 1 的中间体数据 $g_1$ 与 $h_y$ 进行卷积。这对每一“列”进行，其中“列”由一个固定的 $(x,z)$ 对定义。共有 $N^2$ 个这样的列。\n    与阶段 1 类似，每列的计算需要 $N \\times K$ 次乘法。\n    阶段 2 的总乘法次数：$N^2 \\times (NK) = N^3 K$。\n\n*   **阶段 3：沿 $z$ 轴的卷积。**\n    我们将阶段 2 的中间体数据 $g_2$ 与 $h_z$ 进行卷积。这对每一“纤维”进行，其中“纤维”由一个固定的 $(x,y)$ 对定义。共有 $N^2$ 个这样的纤维。\n    每条纤维的计算需要 $N \\times K$ 次乘法。\n    阶段 3 的总乘法次数：$N^2 \\times (NK) = N^3 K$。\n\n可分离方法的总乘法次数 $C_{sep}$ 是三个阶段乘法次数的总和：\n$$\nC_{sep} = N^3 K + N^3 K + N^3 K = 3 N^3 K\n$$\n\n**3. 加速因子 $S(K)$**\n\n加速因子是两种复杂度的比率：\n$$\nS(K) = \\frac{C_{3D}}{C_{sep}} = \\frac{N^3 K^3}{3 N^3 K}\n$$\n$N^3$ 项被消去，这是预料之中的，因为加速是核大小的一个属性。\n$$\nS(K) = \\frac{K^3}{3K} = \\frac{K^2}{3}\n$$\n这就是以 $K$ 表示的加速因子的简化解析表达式。",
            "answer": "$$\\boxed{\\frac{K^2}{3}}$$"
        },
        {
            "introduction": "对于许多通用或不可分离的PSF，快速傅里叶变换（FFT）是实现高效卷积的首选方法。然而，要正确使用该方法，必须满足一个关键前提。本练习将深入探讨线性和循环卷积之间的根本区别，并指导你推导出使用FFT计算精确线性卷积结果所需的“零填充”量。理解并正确应用零填充是避免常见“环绕”伪影、确保计算结果准确性的基础。",
            "id": "4897204",
            "problem": "在医学成像基础中，考虑一个二维线性移不变 (LSI) 成像系统。该系统的点扩展函数 (PSF) 是离散冲激响应 $h[i,j]$，其具有大小为 $K_x \\times K_y$ 的有限矩形支撑域，即对于任何 $i \\notin \\{0,1,\\dots,K_x-1\\}$ 或 $j \\notin \\{0,1,\\dots,K_y-1\\}$，$h[i,j] = 0$。一个大小为 $N_x \\times N_y$ 的离散对象 $f[m,n]$ 通过线性卷积生成理想图像 $g[m,n]$，因此从 $f$ 到 $g$ 的映射是线性和移不变的。\n\n在实践中，卷积是通过离散傅里叶变换 (DFT) 的快速傅里叶变换 (FFT) 实现的：将 $f$ 和 $h$ 零填充到大小为 $P_x \\times P_y$，计算它们的 DFT，将它们相乘，然后应用逆 DFT，以获得在 $P_x \\times P_y$ 网格上的循环卷积。然后将结果裁剪为 $N_x \\times N_y$。\n\n从线性卷积、循环卷积和有限支撑域的核心定义出发，推导当假定对象在其支撑域之外为零时，零填充如何在边界处产生一个空间变化的、位置相关的“有效PSF”。具体来说，将给定像素位置 $(m,n)$ 处的有效PSF表示为由 $f[m-i,n-j]$ 的可用索引决定的 $h[i,j]$ 的一个截断版本。然后，利用线性卷积和循环卷积之间的基本关系以及非零支撑域的范围，推导所需的最小填充长度 $P_x$ 和 $P_y$，以确保当裁剪回 $N_x \\times N_y$ 时，基于FFT的卷积在所有地方都能产生精确的线性卷积结果（即，在任一维度上都没有循环重叠或环绕）。\n\n你的最终答案必须是最小 $P_x$ 和 $P_y$ 作为 $N_x$、$N_y$、$K_x$ 和 $K_y$ 函数的闭式解析表达式。最终答案不带单位，无需四舍五入。",
            "solution": "该问题要求对成像系统中离散对象与点扩展函数 (PSF) 的卷积进行两项推导。首先，描述由有限对象支撑域产生的位置相关的“有效PSF”；其次，推导使用 DFT/FFT 方法计算精确线性卷积所需的最小零填充维度。\n\n设离散对象为 $f[m,n]$，系统的PSF为 $h[i,j]$。\n问题陈述 $f[m,n]$ 具有大小为 $N_x \\times N_y$ 的支撑域，意味着它仅在索引 $(m,n)$ 满足 $m \\in \\{0, 1, \\dots, N_x-1\\}$ 和 $n \\in \\{0, 1, \\dots, N_y-1\\}$ 时非零。\nPSF $h[i,j]$ 具有大小为 $K_x \\times K_y$ 的有限矩形支撑域，意味着它仅在索引 $(i,j)$ 满足 $i \\in \\{0, 1, \\dots, K_x-1\\}$ 和 $j \\in \\{0, 1, \\dots, K_y-1\\}$ 时非零。\n\n理想图像 $g[m,n]$ 由 $f$ 和 $h$ 的二维线性卷积给出，记为 $(f * h)[m,n]$。卷积和可以表示为：\n$$g[m,n] = \\sum_{i=-\\infty}^{\\infty} \\sum_{j=-\\infty}^{\\infty} h[i,j] f[m-i, n-j]$$\n考虑到 PSF $h[i,j]$ 的有限支撑域，求和索引被限制为：\n$$g[m,n] = \\sum_{i=0}^{K_x-1} \\sum_{j=0}^{K_y-1} h[i,j] f[m-i, n-j]$$\n\n**第一部分：有效点扩展函数**\n\n空间变化的“有效PSF”这一概念的出现，是因为对象 $f$ 也具有有限的支撑域。求和中的项 $f[m-i, n-j]$ 仅当其索引位于 $f$ 的支撑域内时才非零。也就是说，我们必须有：\n$$0 \\le m-i \\le N_x-1$$\n$$0 \\le n-j \\le N_y-1$$\n对于给定的输出像素位置 $(m,n)$，这些条件对能够对求和做出贡献的 PSF $h[i,j]$ 的索引 $(i,j)$ 施加了约束。对于靠近对象域边界的像素 $(m,n)$，某些 $(i,j)$ 的值（对于这些值 $h[i,j]$ 非零）将导致参数 $(m-i, n-j)$ 落在 $f$ 的支撑域之外。在这些情况下，乘积 $h[i,j] f[m-i, n-j]$ 为零。\n\n例如，考虑在 $m=0, n=0$ 处的一个输出像素。其卷积为：\n$$g[0,0] = \\sum_{i=0}^{K_x-1} \\sum_{j=0}^{K_y-1} h[i,j] f[-i, -j]$$\n由于 $f$ 的支撑域在非负索引上，因此 $f[-i,-j]$ 仅在 $i=0$ 和 $j=0$ 时非零。因此，求和坍缩为单项：$g[0,0] = h[0,0] f[0,0]$。此位置的卷积仅“看到”PSF的 $h[0,0]$ 这一项。\n\n这表明对于每个输出位置 $(m,n)$，卷积是使用一个“有效PSF”（我们称之为 $h_{\\text{eff}, (m,n)}[i,j]$）来执行的，它是真实PSF $h[i,j]$ 的一个截断版本。这个有效PSF可以表示为：\n$$h_{\\text{eff}, (m,n)}[i,j] = \\begin{cases} h[i,j]  \\text{if } 0 \\le m-i \\le N_x-1 \\text{ and } 0 \\le n-j \\le N_y-1 \\\\ 0  \\text{otherwise} \\end{cases}$$\n输出图像可以被认为是：\n$$g[m,n] = \\sum_{i=0}^{K_x-1} \\sum_{j=0}^{K_y-1} h_{\\text{eff}, (m,n)}[i,j] f[m-i, n-j]$$\n这个有效PSF是位置相关的。只有对于离边界足够远的输出像素 $(m,n)$（具体来说，对于 $m \\ge K_x-1$ 和 $n \\ge K_y-1$，使得对于 $h$ 支撑域中的所有 $i,j$，$m-i$ 和 $n-j$ 都映射到 $f$ 中的有效索引），有效PSF才等于完整的PSF，$h_{\\text{eff}, (m,n)}[i,j]=h[i,j]$。这种边界效应是两个有限支撑域信号卷积的直接结果。\n\n**第二部分：基于FFT的卷积的最小填充**\n\n卷积定理指出，空间域中的线性卷积等价于频率域中的乘法。在计算上，这是通过使用离散傅里叶变换 (DFT) 来执行的，通常通过快速傅里叶变换 (FFT) 实现。然而，DFT 内在地假设信号是周期的，其在频率域相乘的性质对应于空间/时间域中的循环卷积，而非线性卷积。\n\n为了使用DFT计算线性卷积，我们必须将信号 $f$ 和 $h$ 零填充到一个足够大的尺寸，例如 $P_x \\times P_y$，以防止循环卷积固有的环绕（混叠）效应。设填充后的信号为 $f_p[m,n]$ 和 $h_p[m,n]$，大小均为 $P_x \\times P_y$。它们的循环卷积是：\n$$g_{\\text{circ}}[m,n] = (f_p \\circledast h_p)[m,n] = \\sum_{i=0}^{P_x-1} \\sum_{j=0}^{P_y-1} h_p[i,j] f_p[(m-i) \\pmod{P_x}, (n-j) \\pmod{P_y}]$$\n考虑到 $h_p[i,j]$ 的支撑域与 $h[i,j]$ 相同，上式可简化为：\n$$g_{\\text{circ}}[m,n] = \\sum_{i=0}^{K_x-1} \\sum_{j=0}^{K_y-1} h[i,j] f_p[(m-i) \\pmod{P_x}, (n-j) \\pmod{P_y}]$$\n我们要求这个结果与线性卷积结果 $g[m,n]$ 在感兴趣区域内的所有输出像素上都相同，即对于 $m \\in \\{0, \\dots, N_x-1\\}$ 和 $n \\in \\{0, \\dots, N_y-1\\}$。\n\n将 $g_{\\text{circ}}[m,n]$ 的表达式与 $g[m,n]$ 的表达式进行比较，如果满足以下条件，则两者相等：\n$$f_p[(m-i) \\pmod{P_x}, (n-j) \\pmod{P_y}] = f[m-i, n-j]$$\n对于输出区域 $\\{0, \\dots, N_x-1\\} \\times \\{0, \\dots, N_y-1\\}$ 中的所有 $(m,n)$ 和 PSF 支撑域 $\\{0, \\dots, K_x-1\\} \\times \\{0, \\dots, K_y-1\\}$ 中的所有 $(i,j)$。\n\n让我们分析沿第一维度的 $f$ 的参数所需的索引范围。设此索引为 $u = m-i$。\n$m$ 的范围是 $[0, N_x-1]$。\n$i$ 的范围是 $[0, K_x-1]$。\n$u$ 的最小值为 $0 - (K_x-1) = -(K_x-1)$。\n$u$ 的最大值为 $(N_x-1) - 0 = N_x-1$。\n因此，为了计算指定区域上的输出，我们需要访问 $u \\in [-(K_x-1), N_x-1]$ 范围内的 $f[u, \\cdot]$ 值。\n\n信号 $f_p$ 是通过将 $f$ 放置在一个 $P_x \\times P_y$ 的零网格中构建的。循环卷积有效地将此网格视为周期信号的一个周期。环绕效应由模运算捕获。让我们分析其对索引 $u$ 的影响：\n1. 对于 $u \\in [0, N_x-1]$：\n   在此范围内，$f[u, \\cdot]$ 可能为非零。循环卷积中的项是 $f_p[u \\pmod{P_x}, \\cdot]$。如果我们选择 $P_x > N_x-1$，则 $u \\pmod{P_x} = u$。由于根据零填充的定义，在此范围内 $f_p[u, \\cdot] = f[u, \\cdot]$，因此等式成立。\n2. 对于 $u \\in [-(K_x-1), -1]$：\n   在此范围内，根据其支撑域的定义，$f[u, \\cdot] = 0$。我们需要循环卷积项也为零。该项是 $f_p[u \\pmod{P_x}, \\cdot]$。对于负数 $u$，$u \\pmod{P_x} = u + P_x$。所以我们要求 $f_p[u+P_x, \\cdot] = 0$。\n   填充后的信号 $f_p$ 仅在 $[0, N_x-1]$ 范围内的索引处非零。我们必须确保环绕的负索引不会落入此范围内。这意味着我们必须有：\n   $$u + P_x > N_x-1$$\n   此条件必须对范围 $[-(K_x-1), -1]$ 内的所有 $u$ 成立。最坏情况（$u+P_x$ 的最小值）发生在 $u$ 的最小值处，即 $u = -(K_x-1)$。\n   $$-(K_x-1) + P_x > N_x - 1$$\n   $$P_x - K_x + 1 > N_x - 1$$\n   $$P_x > N_x + K_x - 2$$\n   由于 $P_x$ 必须是整数，满足此严格不等式的 $P_x$ 的最小值为 $P_x = N_x + K_x - 1$。\n\n选择这个 $P_x$ 可以确保需要对象信号负索引的PSF“尾部”环绕到填充后DFT网格中保证为零的区域，从而避免混叠，并正确复制线性卷积的边界条件（即假定对象在其支撑域外为零）。\n\n同样的推导独立地适用于第二维度，得出条件 $P_y > N_y + K_y - 2$。最小整数值为 $P_y = N_y + K_y - 1$。\n\n因此，为确保基于FFT的循环卷积在期望的 $N_x \\times N_y$ 输出网格内产生精确的线性卷积结果，最小填充维度必须是：\n$$P_x = N_x + K_x - 1$$\n$$P_y = N_y + K_y - 1$$\n这个尺寸恰好是线性卷积输出的完整支撑域的大小，确保没有信息因混叠而丢失。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nN_x + K_x - 1 & N_y + K_y - 1\n\\end{pmatrix}\n}\n$$"
        }
    ]
}