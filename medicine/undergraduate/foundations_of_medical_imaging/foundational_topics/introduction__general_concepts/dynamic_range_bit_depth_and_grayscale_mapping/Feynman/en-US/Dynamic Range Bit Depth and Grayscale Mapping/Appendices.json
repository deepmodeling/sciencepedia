{
    "hands_on_practices": [
        {
            "introduction": "The first step in creating a digital image is converting a continuous analog signal into discrete digital values. A fundamental design question is how many discrete levels, or bits, are necessary for this conversion. This practice connects the engineering parameter of bit depth to the psychovisual concept of the Just Noticeable Difference (JND). By working through this exercise , you will calculate the minimum bit depth required to ensure that quantization steps are smaller than what the human eye can perceive, thereby preventing distracting visual artifacts like contouring or banding.",
            "id": "4880586",
            "problem": "A flat-panel digital radiography system linearly maps detector signal intensities within a prescribed window to a display grayscale with uniform quantization. Suppose a particular imaging protocol restricts the region of interest to intensities in the interval $[I_{\\min}, I_{\\max}] = [\\,10,\\,410\\,]$ in calibrated detector units. The display pipeline uses an $N$-bit uniform quantizer with $2^N$ equally spaced levels over the interval $[I_{\\min}, I_{\\max})$. To ensure that quantization is visually imperceptible under the given viewing conditions, assume a just noticeable difference (JND) threshold $\\Delta I_{\\mathrm{JND}} = 0.35$ in the same calibrated detector units, and require that the quantization step (i.e., the width of one quantization interval) is strictly smaller than $\\Delta I_{\\mathrm{JND}}$ across the entire mapped range.\n\nStarting from the definitions of dynamic range, bit depth, uniform quantization, and the just noticeable difference threshold, determine the minimum integer bit depth $N$ that satisfies the perceptual requirement. Express your final answer as an integer number of bits. No rounding instruction is necessary since the answer is an integer.",
            "solution": "The problem requires determining the minimum integer bit depth $N$ for a uniform quantizer such that the quantization step size is strictly smaller than a given just noticeable difference (JND) threshold. We begin by formally defining the relevant quantities and establishing their relationships based on the principles of digital signal processing and medical imaging.\n\nThe problem statement provides the following givens:\n1.  The range of signal intensities to be mapped is the interval $[I_{\\min}, I_{\\max}] = [10, 410]$ in calibrated detector units.\n2.  The quantizer is a uniform $N$-bit quantizer, which provides $L = 2^N$ quantization levels.\n3.  The quantization is applied over the interval $[I_{\\min}, I_{\\max})$, which has a total width or dynamic range, $W$.\n4.  The just noticeable difference threshold is $\\Delta I_{\\mathrm{JND}} = 0.35$ in the same units.\n5.  The perceptual requirement is that the quantization step size, which we denote as $\\Delta I_q$, must be strictly smaller than the JND threshold: $\\Delta I_q < \\Delta I_{\\mathrm{JND}}$.\n\nFirst, let's calculate the total width of the intensity range to be quantized. This dynamic range, $W$, is given by the difference between the maximum and minimum intensity values:\n$$W = I_{\\max} - I_{\\min}$$\nSubstituting the given values, we have:\n$$W = 410 - 10 = 400$$\n\nNext, we consider the uniform $N$-bit quantizer. By definition, an $N$-bit quantizer divides the input range into $L$ discrete levels, where $L$ is given by:\n$$L = 2^N$$\nFor a uniform quantizer, these $L$ levels are equally spaced across the entire dynamic range $W$. The width of each quantization interval, also known as the quantization step size $\\Delta I_q$, is therefore the total width of the range divided by the number of levels:\n$$\\Delta I_q = \\frac{W}{L} = \\frac{I_{\\max} - I_{\\min}}{2^N}$$\n\nThe core requirement of the problem is that this quantization step must be imperceptible, which is mathematically stated as being strictly smaller than the JND threshold, $\\Delta I_{\\mathrm{JND}}$. This gives us the following inequality:\n$$\\Delta I_q < \\Delta I_{\\mathrm{JND}}$$\nSubstituting our expression for $\\Delta I_q$, we get:\n$$\\frac{I_{\\max} - I_{\\min}}{2^N} < \\Delta I_{\\mathrm{JND}}$$\n\nWe can now substitute the given numerical values into this inequality to solve for $N$:\n$$\\frac{400}{2^N} < 0.35$$\nTo find the minimum integer $N$ that satisfies this condition, we first rearrange the inequality to isolate the term $2^N$:\n$$2^N > \\frac{400}{0.35}$$\nLet's evaluate the fraction on the right-hand side.\n$$\\frac{400}{0.35} = \\frac{400}{35/100} = \\frac{400 \\times 100}{35} = \\frac{40000}{35} = \\frac{8000}{7}$$\nSo the inequality is:\n$$2^N > \\frac{8000}{7}$$\nCalculating the approximate decimal value of the fraction:\n$$\\frac{8000}{7} \\approx 1142.857$$\nThus, we must find the smallest integer $N$ such that $2^N > 1142.857...$.\n\nTo solve for $N$, we take the base-$2$ logarithm of both sides of the inequality. Since $\\log_2(x)$ is a monotonically increasing function, the direction of the inequality is preserved.\n$$\\log_2(2^N) > \\log_2\\left(\\frac{8000}{7}\\right)$$\n$$N > \\log_2\\left(\\frac{8000}{7}\\right)$$\nUsing the change of base formula for logarithms, $\\log_b(x) = \\frac{\\ln(x)}{\\ln(b)}$, we can compute the value using the natural logarithm ($\\ln$):\n$$N > \\frac{\\ln\\left(\\frac{8000}{7}\\right)}{\\ln(2)}$$\nNumerically evaluating the expression:\n$$\\ln\\left(\\frac{8000}{7}\\right) \\approx \\ln(1142.857) \\approx 7.0413$$\n$$\\ln(2) \\approx 0.6931$$\n$$N > \\frac{7.0413}{0.6931} \\approx 10.158$$\nSince the bit depth $N$ must be an integer, we must find the smallest integer value of $N$ that is strictly greater than $10.158$. The first integer to satisfy this condition is $11$.\n\nTherefore, the minimum integer bit depth required to meet the perceptual criterion is $N=11$. We can verify this answer.\nIf $N=10$, $2^{10} = 1024$. The quantization step would be $\\Delta I_q = \\frac{400}{1024} \\approx 0.3906$, which is not smaller than $\\Delta I_{\\mathrm{JND}} = 0.35$.\nIf $N=11$, $2^{11} = 2048$. The quantization step would be $\\Delta I_q = \\frac{400}{2048} \\approx 0.1953$, which is strictly smaller than $\\Delta I_{\\mathrm{JND}} = 0.35$. This satisfies the condition.\nThus, the minimum integer bit depth is indeed $11$.",
            "answer": "$$\\boxed{11}$$"
        },
        {
            "introduction": "While we know that increasing bit depth improves image quality, a crucial question is: by how much? The Signal-to-Noise Ratio (SNR) provides a powerful, quantitative metric to answer this. This exercise guides you through the fundamental relationship between the number of quantization bits and the theoretical SNR, leading to a famous rule of thumb in signal processing. Furthermore, it challenges you to think critically about why this ideal performance gain might not be fully achieved in a real-world medical imaging system , where other noise sources are always present.",
            "id": "4880569",
            "problem": "An imaging acquisition chain for X-ray fluoroscopy uses an ideal uniform midtread Analog-to-Digital Converter (ADC). The ADC is operated first at $10$-bit resolution and then at $12$-bit resolution. Assume the input is a sinusoidal test signal that exactly spans the full-scale range (FSR), meaning its peak-to-peak equals the full-scale range (FSR), and that the quantization error can be modeled as uncorrelated, uniformly distributed over its support. Using only first principles of uniform quantization and basic definitions of signal and noise power, determine the expected improvement in the Signal-to-Noise Ratio (SNR) in decibels when moving from $10$-bit to $12$-bit quantization under these ideal conditions. Then, consider clinical operation in which pixel value histograms can be sparse or confined to a narrow subrange of the ADCâ€™s full-scale range (due to scene content and window/level choices): select the statement that correctly gives the ideal improvement and accurately explains why the improvement may not be realized in practice for such sparse or subrange inputs.\n\nChoose one:\n\nA. The ideal SNR improvement is approximately $12.04\\ \\mathrm{dB}$; in practice it may not be realized if the input occupies only a fraction $k<1$ of full scale without appropriate gain rescaling or if grayscale mapping uses a narrow window, because the signal root-mean-square scales with $k$ while the quantization step does not, and non-quantization noise sources can dominate, masking the quantization-limited gain.\n\nB. The ideal SNR improvement is approximately $6.02\\ \\mathrm{dB}$; in practice it may not be realized because sparse histograms inherently reduce quantization noise, so extra bits confer little benefit.\n\nC. The ideal SNR improvement is approximately $12.04\\ \\mathrm{dB}$; in practice it may not be realized for subrange inputs because using a narrower subrange reduces the quantization step size, which makes the quantization noise smaller regardless of bit depth.\n\nD. The ideal SNR improvement is approximately $24.08\\ \\mathrm{dB}$; in practice it may not be realized because $8$-bit display pipelines cap the visible grayscale levels, eliminating any upstream SNR gain.",
            "solution": "**Part 1: Ideal Signal-to-Noise Ratio (SNR) Improvement**\n\nThe Signal-to-Noise Ratio (SNR) for a quantized signal is the ratio of the signal power ($P_S$) to the quantization noise power ($P_N$).\n$$ \\mathrm{SNR} = \\frac{P_S}{P_N} $$\n\n1.  **Quantization Noise Power ($P_N$)**:\n    For an $n$-bit uniform ADC with a full-scale range $V_{FSR}$, there are $L = 2^n$ quantization levels. The size of each quantization step is $\\Delta = V_{FSR} / L = V_{FSR} / 2^n$. The quantization error, $e_q$, is modeled as a random variable uniformly distributed over the range $[-\\Delta/2, \\Delta/2]$.\n    The noise power is the variance of this error:\n    $$ P_N = E[e_q^2] = \\frac{\\Delta^2}{12} $$\n\n2.  **Signal Power ($P_S$)**:\n    The input is a sinusoidal test signal with peak-to-peak amplitude equal to the FSR ($V_{pp} = V_{FSR}$). The peak amplitude is $A = V_{FSR}/2$. The power of a sinusoid is its RMS value squared, where $V_{rms} = A/\\sqrt{2}$.\n    $$ P_S = V_{rms}^2 = \\left( \\frac{A}{\\sqrt{2}} \\right)^2 = \\frac{A^2}{2} = \\frac{(V_{FSR}/2)^2}{2} = \\frac{V_{FSR}^2}{8} $$\n\n3.  **SNR Formula**:\n    $$ \\mathrm{SNR} = \\frac{P_S}{P_N} = \\frac{V_{FSR}^2 / 8}{\\Delta^2 / 12} = \\frac{V_{FSR}^2}{8} \\cdot \\frac{12}{(V_{FSR}/2^n)^2} = 1.5 \\cdot (2^n)^2 = 1.5 \\cdot 2^{2n} $$\n\n4.  **SNR in Decibels (dB)**:\n    $$ \\mathrm{SNR}_{\\mathrm{dB}} = 10 \\log_{10}(1.5 \\cdot 2^{2n}) = 10 \\log_{10}(1.5) + 20n \\log_{10}(2) $$\n    Using $\\log_{10}(2) \\approx 0.30103$:\n    $$ \\mathrm{SNR}_{\\mathrm{dB}} \\approx 1.76 + 6.02n $$\n    This formula shows that for each additional bit, the ideal SNR increases by approximately $6.02\\ \\mathrm{dB}$.\n\n5.  **Calculate the Improvement**:\n    We need to find the improvement in SNR when moving from $n_1 = 10$-bit to $n_2 = 12$-bit resolution. The change in bit depth is $\\Delta n = n_2 - n_1 = 2$ bits.\n    The improvement in dB is:\n    $$ \\Delta \\mathrm{SNR}_{\\mathrm{dB}} = 6.02 (n_2 - n_1) = 6.02 \\times 2 = 12.04\\ \\mathrm{dB} $$\n    The ideal SNR improvement is approximately $12.04\\ \\mathrm{dB}$.\n\n**Part 2: Analysis of Practical Limitations and Option Evaluation**\n\nThe question asks why this gain may not be realized in practice for subrange inputs. In a real system, the total noise power is the sum of quantization noise ($P_N$) and other noise sources ($P_{other}$), like thermal and electronic noise.\n$$ \\mathrm{SNR}_{total} = \\frac{P_S}{P_{N,total}} = \\frac{P_S}{P_N + P_{other}} $$\nIncreasing the bit depth reduces $P_N$, but $P_{other}$ remains constant. If the system is already dominated by non-quantization noise (i.e., $P_{other} \\gg P_N$), then reducing $P_N$ further will have a negligible effect on $P_{N,total}$ and thus on the overall SNR. This is particularly true for small signals that occupy only a fraction of the ADC's range, as their signal power $P_S$ is low, making the SNR more sensitive to the noise floor set by $P_{other}$.\n\n**Option-by-Option Analysis**\n\n*   **A. The ideal SNR improvement is approximately $12.04\\ \\mathrm{dB}$; in practice it may not be realized if the input occupies only a fraction $k<1$ of full scale... because... non-quantization noise sources can dominate, masking the quantization-limited gain.**\n    *   **Ideal Improvement:** $12.04\\ \\mathrm{dB}$. This is correct.\n    *   **Practical Explanation:** Correctly identifies that for a subrange input, the signal power is lower, and crucially, that the gain is masked when other (non-quantization) noise sources dominate the total noise. This is the correct physical reasoning.\n*   **B. The ideal SNR improvement is approximately $6.02\\ \\mathrm{dB}$...**\n    *   **Ideal Improvement:** Incorrect. This is the gain for 1 bit, not 2.\n*   **C. The ideal SNR improvement is approximately $12.04\\ \\mathrm{dB}$; ... because using a narrower subrange reduces the quantization step size...**\n    *   **Practical Explanation:** Incorrect reasoning. The quantization step size $\\Delta$ is a fixed property of the ADC, not dependent on the input signal's range.\n*   **D. The ideal SNR improvement is approximately $24.08\\ \\mathrm{dB}$...**\n    *   **Ideal Improvement:** Incorrect. This would be for a 4-bit increase.\n\nTherefore, option A provides both the correct numerical value for the ideal case and the correct physical explanation for the practical limitation.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Medical images, particularly from modalities like CT, possess a vast dynamic range of intensity values. To make them interpretable, radiologists use a technique called \"windowing\" to map a specific range of interest onto the display's grayscale. While essential for diagnosis, this mapping is a non-linear operation that often involves clipping data that falls outside the chosen window. This advanced practice explores the tangible consequences of this process, using a realistic statistical model of a CT scan to quantify how a simple display setting can introduce measurement bias in lesion characterization, directly linking visualization choices to the integrity of quantitative analysis .",
            "id": "4880602",
            "problem": "A computed tomography image volume is rendered to a $12$-bit grayscale display using windowing and linear mapping. Let the underlying voxel intensity $X$ (in Hounsfield units, HU) have a two-component mixture-of-Gaussians histogram representative of soft tissue and a focal lesion:\n- Background component: weight $w_{b} = 0.95$, distribution $X \\sim \\mathcal{N}(\\mu_{b}, \\sigma_{b}^{2})$ with $\\mu_{b} = 50$ and $\\sigma_{b} = 20$.\n- Lesion component: weight $w_{\\ell} = 0.05$, distribution $X \\sim \\mathcal{N}(\\mu_{\\ell}, \\sigma_{\\ell}^{2})$ with $\\mu_{\\ell} = 120$ and $\\sigma_{\\ell} = 15$.\n\nA window level $L$ and window width $W$ define the lower and upper limits of the grayscale mapping as $L L = L - \\frac{W}{2}$ and $U L = L + \\frac{W}{2}$. For this problem, use $L = 90$ and $W = 120$, so that $L L = 30$ and $U L = 150$. The $12$-bit display maps intensities as follows:\n- If $x \\leq L L$, the displayed code is $0$.\n- If $x \\geq U L$, the displayed code is $4095$.\n- If $L L < x < U L$, the displayed code is $d(x) = s\\,(x - L L)$, where $s = \\frac{4095}{U L - L L}$.\n\nClinically, a naive lesion quantification approach sometimes back-inverts the display to estimate intensities. Define the naive estimator $Y$ (in HU) by inverting the linear mapping and treating clipped voxels as exactly at the bounds:\n$$\nY = \\min\\big(\\max(X, L L), U L\\big).\n$$\n\nStarting from the definitions of windowing, bit depth mapping, and properties of the Gaussian distribution and its cumulative distribution function, derive and compute:\n1. The overall fraction of voxels in the image that are clipped on the display (either mapped to $0$ or to $4095$), expressed as a decimal.\n2. The bias in the estimated lesion mean under the naive estimator, defined as $E[Y] - \\mu_{\\ell}$, expressed in Hounsfield units.\n\nRound both answers to four significant figures. For the bias, express the final value in Hounsfield units (HU). The final numerical outputs must be given as a pair in a single row matrix.",
            "solution": "### Solution Derivation\n\nThe probability density function (PDF) of the voxel intensity $X$ is a weighted sum of the two component PDFs:\n$$\np(x) = w_{b} p_{b}(x) + w_{\\ell} p_{\\ell}(x)\n$$\nwhere $p_{b}(x)$ is the PDF of a normal distribution $\\mathcal{N}(\\mu_{b}, \\sigma_{b}^{2})$ and $p_{\\ell}(x)$ is the PDF of a normal distribution $\\mathcal{N}(\\mu_{\\ell}, \\sigma_{\\ell}^{2})$. Let $\\phi(z)$ and $\\Phi(z)$ denote the PDF and cumulative distribution function (CDF) of the standard normal distribution $\\mathcal{N}(0, 1)$, respectively.\n\n**Part 1: Fraction of Clipped Voxels**\n\nA voxel is clipped if its intensity $X$ is outside the window $[LL, UL] = [30, 150]$. The fraction of clipped voxels is the probability $P(X \\leq LL \\text{ or } X \\geq UL)$, which can be calculated as $P(X \\leq LL) + P(X \\geq UL)$. By the law of total probability, this is:\n$$\nF_{\\text{clipped}} = w_{b} \\Big( P(X_{b} \\leq LL) + P(X_{b} \\geq UL) \\Big) + w_{\\ell} \\Big( P(X_{\\ell} \\leq LL) + P(X_{\\ell} \\geq UL) \\Big)\n$$\nwhere $X_b \\sim \\mathcal{N}(50, 20^2)$ and $X_\\ell \\sim \\mathcal{N}(120, 15^2)$.\n\nWe convert the probabilities to the standard normal CDF $\\Phi(z)$.\nFor the background component ($X_b$):\n$$\nP(X_{b} \\leq 30) = \\Phi\\left(\\frac{30 - 50}{20}\\right) = \\Phi(-1.0)\n$$\n$$\nP(X_{b} \\geq 150) = 1 - \\Phi\\left(\\frac{150 - 50}{20}\\right) = 1 - \\Phi(5.0)\n$$\n\nFor the lesion component ($X_\\ell$):\n$$\nP(X_{\\ell} \\leq 30) = \\Phi\\left(\\frac{30 - 120}{15}\\right) = \\Phi(-6.0)\n$$\n$$\nP(X_{\\ell} \\geq 150) = 1 - \\Phi\\left(\\frac{150 - 120}{15}\\right) = 1 - \\Phi(2.0)\n$$\n\nUsing standard values for the normal CDF: $\\Phi(-1.0) \\approx 0.158655$, $1 - \\Phi(5.0) \\approx 2.87 \\times 10^{-7}$, $\\Phi(-6.0) \\approx 9.87 \\times 10^{-10}$, and $1 - \\Phi(2.0) \\approx 0.022750$.\n$$\nF_{\\text{clipped}} \\approx (0.95) \\cdot (0.158655 + 2.87 \\times 10^{-7}) + (0.05) \\cdot (9.87 \\times 10^{-10} + 0.022750)\n$$\n$$\nF_{\\text{clipped}} \\approx 0.95 \\cdot (0.158655) + 0.05 \\cdot (0.022750) \\approx 0.150722 + 0.0011375 = 0.1518595\n$$\nRounding to four significant figures, $F_{\\text{clipped}} \\approx 0.1519$.\n\n**Part 2: Bias in the Estimated Lesion Mean**\n\nThe bias is defined for the lesion component, so we consider only $X_{\\ell} \\sim \\mathcal{N}(\\mu_{\\ell}, \\sigma_{\\ell}^{2})$. The naive estimator is $Y_{\\ell} = \\min\\big(\\max(X_{\\ell}, LL), UL\\big)$. The bias is $\\text{Bias} = E[Y_{\\ell}] - \\mu_{\\ell}$, which equals the expected estimation error, $E[Y_{\\ell} - X_{\\ell}]$. The error is non-zero only when $X_{\\ell}$ is clipped.\nThe bias is the expectation of this error over the distribution $p_{\\ell}(x)$:\n$$\n\\text{Bias} = \\int_{-\\infty}^{LL} (LL - x) p_{\\ell}(x) dx + \\int_{UL}^{\\infty} (UL - x) p_{\\ell}(x) dx\n$$\nThis can be expressed using the standard normal distribution. Let $a = \\frac{LL - \\mu_{\\ell}}{\\sigma_{\\ell}}$ and $b = \\frac{UL - \\mu_{\\ell}}{\\sigma_{\\ell}}$. The bias is given by:\n$$\n\\text{Bias} = (LL - \\mu_{\\ell})\\Phi(a) + \\sigma_{\\ell}\\phi(a) + (UL - \\mu_{\\ell})(1 - \\Phi(b)) - \\sigma_{\\ell}\\phi(b)\n$$\nFrom Part 1, we have for the lesion: $a = -6.0$ and $b = 2.0$.\nWe have $\\mu_{\\ell} = 120$, $\\sigma_{\\ell} = 15$, $LL = 30$, $UL = 150$.\n$LL - \\mu_{\\ell} = -90$.\n$UL - \\mu_{\\ell} = 30$.\n\nWe use the values for the CDF and PDF:\n$\\Phi(-6.0) \\approx 9.866 \\times 10^{-10}$\n$1 - \\Phi(2.0) \\approx 0.022750$\n$\\phi(z) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-z^2/2)$\n$\\phi(-6.0) = \\phi(6.0) \\approx 6.076 \\times 10^{-9}$\n$\\phi(2.0) \\approx 0.053991$\n\nSubstituting these values into the bias equation:\n$$\n\\text{Bias} = (-90)(9.866 \\times 10^{-10}) + (15)(6.076 \\times 10^{-9}) + (30)(0.022750) - (15)(0.053991)\n$$\nThe first two terms are negligible:\n$$\n\\text{Bias} \\approx (-8.88 \\times 10^{-8}) + (9.11 \\times 10^{-8}) + 0.68250 - 0.809865\n$$\n$$\n\\text{Bias} \\approx 0.68250 - 0.809865 = -0.127365\n$$\nRounding to four significant figures, the bias is $-0.1274$ HU.\n\nThe two requested values are the clipped fraction ($0.1519$) and the bias in the lesion mean ($-0.1274$ HU).",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1519 & -0.1274\n\\end{pmatrix}\n}\n$$"
        }
    ]
}