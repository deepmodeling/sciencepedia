{
    "hands_on_practices": [
        {
            "introduction": "掌握射频（RF）激发的第一步是理解射频脉冲的属性与产生的翻转角之间的直接关系。这个练习  提供了一个基础计算，要求您确定在给定时间内实现特定翻转角所需的射频场强（$B_1$）。这个练习对于掌握在磁共振成像（MRI）中操控核自旋的基本“配方”至关重要。",
            "id": "4916239",
            "problem": "在一个质子磁共振成像 (MRI) 系统中，一个射频 (RF) 发射线圈在拉莫尔频率 $f_0=64\\,\\text{MHz}$ 下工作，用于施加一个空间均匀的、共振的横向激发。该激发由射频场 $B_1^+(t)$ 的正旋分量来描述。该激发是一个持续时间为 $T=1\\,\\text{ms}$、幅度恒为 $B_1^+$ 的矩形脉冲，其目标是使净磁化强度产生 $90^\\circ$ 的翻转。假设样本含有质子，系统与对应于 $f_0$ 的主磁场 $B_0$ 精确共振，并且在脉冲持续时间内弛豫可以忽略不计。使用角磁旋比 $\\gamma = 2\\pi \\cdot 42.58\\,\\text{MHz/T}$。\n\n从布洛赫方程和用于共振射频激发的旋转坐标系图像出发，确定在这些条件下产生所需翻转角所需的幅度 $B_1^+$。请以微特斯拉为单位表示最终结果，并将答案四舍五入至三位有效数字。",
            "solution": "在共振条件下，施加一个持续时间为 $T$、幅度恒为 $B_1^+$ 的矩形射频脉冲所产生的翻转角 $\\alpha$ 由以下基本关系式给出：\n$$\n\\alpha = \\gamma B_1^+ T\n$$\n其中 $\\gamma$ 是角磁旋比。这个关系源于旋转坐标系中的布洛赫方程，在该坐标系中，共振射频场 $B_1^+$ 表现为一个静态有效场，导致磁化矢量以角频率 $\\omega_1 = \\gamma B_1^+$ 绕其轴进动。\n\n我们的目标是求解产生给定翻转角所需的射频场幅度 $B_1^+$。重新整理方程可得：\n$$\nB_1^+ = \\frac{\\alpha}{\\gamma T}\n$$\n\n接下来，我们将问题中给定的值代入此方程。\n- 翻转角为 $\\alpha = 90^\\circ$。在计算中，必须将其转换为弧度：$\\alpha = \\frac{\\pi}{2}\\,\\text{rad}$。\n- 脉冲持续时间为 $T = 1\\,\\text{ms} = 1 \\times 10^{-3}\\,\\text{s}$。\n- 角磁旋比为 $\\gamma = 2\\pi \\cdot 42.58\\,\\text{MHz/T} = 2\\pi \\cdot 42.58 \\times 10^6\\,\\text{rad}\\cdot\\text{s}^{-1}\\cdot\\text{T}^{-1}$。\n\n将这些值代入方程：\n$$\nB_1^+ = \\frac{\\frac{\\pi}{2}\\,\\text{rad}}{(2\\pi \\cdot 42.58 \\times 10^6\\,\\text{rad}\\cdot\\text{s}^{-1}\\cdot\\text{T}^{-1}) \\cdot (1 \\times 10^{-3}\\,\\text{s})}\n$$\n通过化简，$\\pi$ 因子和单位相互抵消：\n$$\nB_1^+ = \\frac{1/2}{2 \\cdot 42.58 \\times 10^6 \\cdot 10^{-3}}\\,\\text{T} = \\frac{1}{4 \\cdot 42.58 \\times 10^3}\\,\\text{T}\n$$\n$$\nB_1^+ = \\frac{1}{170.32 \\times 10^3}\\,\\text{T} \\approx 5.8713 \\times 10^{-6}\\,\\text{T}\n$$\n问题要求以微特斯拉（$\\mu\\text{T}$）为单位表示结果，其中 $1\\,\\mu\\text{T} = 10^{-6}\\,\\text{T}$。因此：\n$$\nB_1^+ \\approx 5.8713\\,\\mu\\text{T}\n$$\n最后，将结果四舍五入到三位有效数字：\n$$\nB_1^+ \\approx 5.87\\,\\mu\\text{T}\n$$",
            "answer": "$$\\boxed{5.87}$$"
        },
        {
            "introduction": "在现实中，发射的射频场（$B_1$）绝不是完全均匀的，这会导致预期的翻转角出现误差。这个练习  演示了一种使用“复合脉冲”来校正这类不均匀性的强大技术。通过追踪磁化矢量在一系列脉冲作用下的路径，您将发现巧妙的脉冲设计如何在射频场强不准确的情况下，依然能实现稳健而精确的磁化翻转。",
            "id": "4920044",
            "problem": "一个磁共振成像 (MRI) 中的质子自旋系统在旋转坐标系中进行建模，其净磁化强度初始时沿纵向轴处于热平衡状态，因此初始磁化矢量为 $M(0) = (0,\\,0,\\,M_{0})$。在短而强的射频 (RF) 脉冲（硬脉冲）极限下，假设为共振激发，脉冲期间的弛豫可忽略不计，且不存在静磁场不均匀性。存在一个 $10\\%$ 的发射场 ($B_{1}$) 旋转不足，这意味着每个名义翻转角都乘以了因子 $0.90$。\n\n考虑施加于此初始状态的两种激发方案：\n1. 一个名义上为 $180^{\\circ}$ 的单硬脉冲。\n2. 一个名义上为 $90^{\\circ}_{x}$–$180^{\\circ}_{y}$–$90^{\\circ}_{x}$ 的复合脉冲序列，其中下标表示旋转坐标系中每个脉冲的旋转轴。\n\n使用射频激发下磁化动力学的第一性原理，确定每种方案后的剩余纵向磁化强度，以 $M_{0}$ 的分数表示。所有翻转角均以度为单位。将每个值四舍五入到四位有效数字。将您的答案表示为 $M_{0}$ 的无量纲分数。",
            "solution": "在共振射频脉冲作用下，旋转坐标系中磁化矢量 $M$ 的演化可以用一个旋转来描述。一个翻转角为 $\\alpha$、沿轴 $\\hat{n}$（$\\hat{n}$ 是 $x, y$ 之一）施加的脉冲，其效果等同于将旋转矩阵 $R_{\\hat{n}}(\\alpha)$ 应用于磁化矢量。\n\n初始磁化矢量为 $M_{initial} = \\begin{pmatrix} 0 \\\\ 0 \\\\ M_0 \\end{pmatrix}$。\n\n绕 $x$ 轴和 $y$ 轴的旋转矩阵（作用于列向量）为：\n$$R_x(\\alpha) = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & \\cos(\\alpha) & \\sin(\\alpha) \\\\ 0 & -\\sin(\\alpha) & \\cos(\\alpha) \\end{pmatrix}$$\n$$R_y(\\alpha) = \\begin{pmatrix} \\cos(\\alpha) & 0 & -\\sin(\\alpha) \\\\ 0 & 1 & 0 \\\\ \\sin(\\alpha) & 0 & \\cos(\\alpha) \\end{pmatrix}$$\n问题规定所有名义翻转角都存在 $10\\%$ 的旋转不足，即实际翻转角是名义值的 $0.90$ 倍。\n\n**方案 1：名义上为 $180^{\\circ}$ 的单硬脉冲**\n\n此方案施加一个名义翻转角为 $\\alpha_{nom} = 180^{\\circ}$ 的单脉冲。我们假设脉冲沿 $x$ 轴施加（最终的纵向磁化强度与此选择无关）。\n\n实际翻转角为 $\\alpha_{actual,1} = 0.90 \\times 180^{\\circ} = 162^{\\circ}$。\n\n最终磁化矢量 $M_{final,1}$ 是通过将旋转矩阵 $R_x(162^{\\circ})$ 应用于初始磁化矢量 $M_{initial}$ 得到的：\n$$M_{final,1} = R_x(162^{\\circ}) M_{initial} = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & \\cos(162^{\\circ}) & \\sin(162^{\\circ}) \\\\ 0 & -\\sin(162^{\\circ}) & \\cos(162^{\\circ}) \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ M_0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ M_0 \\sin(162^{\\circ}) \\\\ M_0 \\cos(162^{\\circ}) \\end{pmatrix}$$\n剩余纵向磁化强度是 $z$ 分量，$M_{z,1} = M_0 \\cos(162^{\\circ})$。\n占初始磁化强度的分数为：\n$$\\frac{M_{z,1}}{M_0} = \\cos(162^{\\circ}) \\approx -0.9510565...$$\n四舍五入到四位有效数字，结果为 $-0.9511$。\n\n**方案 2：名义上为 $90^{\\circ}_{x}$–$180^{\\circ}_{y}$–$90^{\\circ}_{x}$ 的复合脉冲序列**\n\n此方案由三个脉冲序列组成。最终的磁化矢量 $M_{final,2}$ 是依次应用三个相应旋转矩阵的结果：\n$$M_{final,2} = R_x(\\alpha_3) R_y(\\alpha_2) R_x(\\alpha_1) M_{initial}$$\n计入 $10\\%$ 的旋转不足后，实际翻转角为：\n-   $\\alpha_1 = 0.90 \\times 90^{\\circ} = 81^{\\circ}$\n-   $\\alpha_2 = 0.90 \\times 180^{\\circ} = 162^{\\circ}$\n-   $\\alpha_3 = 0.90 \\times 90^{\\circ} = 81^{\\circ}$\n\n我们依次应用每次旋转：\n1.  第一次脉冲后 ($R_x(81^{\\circ})$)：\n    $$M_1 = R_x(81^{\\circ}) M_{initial} = M_0 \\begin{pmatrix} 0 \\\\ \\sin(81^{\\circ}) \\\\ \\cos(81^{\\circ}) \\end{pmatrix}$$\n2.  第二次脉冲后 ($R_y(162^{\\circ})$)：\n    $$M_2 = R_y(162^{\\circ}) M_1 = M_0 \\begin{pmatrix} -\\sin(162^{\\circ})\\cos(81^{\\circ}) \\\\ \\sin(81^{\\circ}) \\\\ \\cos(162^{\\circ})\\cos(81^{\\circ}) \\end{pmatrix}$$\n3.  第三次脉冲后 ($R_x(81^{\\circ})$)：\n    $$M_{final,2} = R_x(81^{\\circ}) M_2$$\n我们只关心最终的纵向分量 $M_{z,2}$：\n$$M_{z,2} = M_0 \\left( [M_2/M_0]_y \\cdot (-\\sin(81^{\\circ})) + [M_2/M_0]_z \\cdot (\\cos(81^{\\circ})) \\right)$$\n代入 $M_2$ 的分量：\n$$\\frac{M_{z,2}}{M_0} = (\\sin(81^{\\circ})) \\cdot (-\\sin(81^{\\circ})) + (\\cos(162^{\\circ})\\cos(81^{\\circ})) \\cdot (\\cos(81^{\\circ}))$$\n$$\\frac{M_{z,2}}{M_0} = -\\sin^2(81^{\\circ}) + \\cos(162^{\\circ})\\cos^2(81^{\\circ})$$\n使用三角恒等式 $\\cos(2\\theta) = 2\\cos^2(\\theta) - 1$ 和 $\\sin^2(\\theta) + \\cos^2(\\theta) = 1$，令 $\\theta = 81^\\circ$：\n$$\\frac{M_{z,2}}{M_0} = -(\\sin^2(\\theta) + \\cos^2(\\theta)) + \\cos^2(\\theta) + \\cos(2\\theta)\\cos^2(\\theta)$$\n$$\\frac{M_{z,2}}{M_0} = -1 + \\cos^2(\\theta) (1 + \\cos(2\\theta))$$\n$$\\frac{M_{z,2}}{M_0} = -1 + \\cos^2(\\theta) (1 + 2\\cos^2(\\theta)-1) = -1 + 2\\cos^4(\\theta)$$\n现在进行数值计算：\n$$\\frac{M_{z,2}}{M_0} = -1 + 2\\cos^4(81^{\\circ}) \\approx -1 + 2(0.156434...)^4 \\approx -1 + 2(0.0006011...) \\approx -0.998797...$$\n四舍五入到四位有效数字，结果为 $-0.9988$。\n\n比较两种方案，复合脉冲（$-0.9988 M_0$）的最终纵向磁化强度远比单脉冲（$-0.9511 M_0$）更接近理想的反转值 $-M_0$，展示了其对 $B_1$ 场不均匀性的鲁棒性。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} -0.9511  -0.9988 \\end{pmatrix} } $$"
        },
        {
            "introduction": "基于$B_1$场不均匀性的概念，这最后一个练习采用计算方法来解决一个真实的成像问题。您将编写一个程序，模拟并可视化在不同射频脉冲形状下，翻转角如何在整个成像体积内随空间变化 。这个练习将单体素理论与确保在非均匀样本中实现均匀激发的实际挑战联系起来，是理论走向实践的关键一步。",
            "id": "4920032",
            "problem": "在磁共振成像 (MRI) 中，给定一个复数圆极化发射场 $B_1^+(x,y,z)$ 的离散空间图和一个时域射频 (RF) 包络 $E(t)$（单位为特斯拉）。假设为共振激发，脉冲期间弛豫可忽略不计，且旋转坐标系中的有效章动率与横向 $B_1^+$ 场的模成正比。请基于第一性原理（从 Bloch 方程出发），设计一个程序，对每个体素，通过对射频包络的模进行时间积分，再按局部 $B_1^+$ 振幅进行缩放，并通过氢的旋磁比从弧度转换为度，来数值计算以度为单位的局部翻转角。角度必须以度表示，并四舍五入到三位小数。整个计算过程使用国际单位制 (SI)，时间单位为秒，磁场单位为特斯拉。\n\n定义和常数：\n- 磁共振成像 (MRI) 使用发射场 $B_1^+(x,y,z)$ 来翻转净磁化强度。体素的翻转角由自旋感受到的有效横向射频场的时间积分决定。\n- 射频 (RF) 指的是在激发期间施加的时变磁场 $E(t)$。\n- 氢的旋磁比为 $\\gamma = 2\\pi \\cdot 42.577 \\times 10^{6}\\ \\mathrm{rad}\\,\\mathrm{s}^{-1}\\,\\mathrm{T}^{-1}$。\n- 程序必须为每个体素计算由给定的射频包络和局部 $B_1^+$ 振幅缩放产生的翻转角。将 $B_1^+(x,y,z)$ 视为一个实数、非负的缩放因子 $s(x,y,z)$，它与包络 $E(t)$ 相乘，即 $|B_1^+(x,y,z,t)| = s(x,y,z)\\,|E(t)|$。\n\n数值积分要求：\n- 在指定的离散时间网格上，使用梯形法则来近似计算射频包络模 $|E(t)|$ 的时间积分。\n- 然后乘以 $s(x,y,z)$ 和 $\\gamma$ 进行缩放，并将结果从弧度转换为度。\n\n你的程序必须实现以下三个测试用例（一个测试套件），每个用例使用指定的空间图、射频包络和时间网格。对于每个用例，计算每个体素的翻转角，然后计算并输出三个以度为单位的汇总指标：逐体素均值、逐体素标准差（总体标准差）和范围（最大值减最小值）。所有报告的角度都必须四舍五入到三位小数。\n\n测试用例 1（均匀 $B_1^+$，矩形脉冲）：\n- 空间图：一个 $3 \\times 3 \\times 1$ 网格，所有体素的 $s(x,y,z) = 1$。\n- 射频包络：振幅为 $B_{1,\\mathrm{amp}} = 10\\,\\mu\\mathrm{T}$（即 $10 \\times 10^{-6}\\ \\mathrm{T}$）的矩形脉冲，持续时间 $\\tau = 1\\,\\mathrm{ms}$（即 $1 \\times 10^{-3}\\ \\mathrm{s}$），在此外为零。\n- 时间网格：$t \\in [0,\\tau]$，步长 $\\Delta t = 1\\,\\mu\\mathrm{s}$（即 $1 \\times 10^{-6}\\ \\mathrm{s}$）。\n\n测试用例 2（线性变化的 $B_1^+$，高斯脉冲）：\n- 空间图：一个 $4 \\times 1 \\times 1$ 网格，$s(x,y,z)$ 沿 $x$ 轴线性变化，为 $[0.8, 0.933333\\ldots, 1.066666\\ldots, 1.2]$。\n- 射频包络：高斯脉冲 $E(t) = B_{1,\\mathrm{amp}} \\exp\\!\\left(-\\dfrac{t^{2}}{2\\sigma^{2}}\\right)$，其中 $B_{1,\\mathrm{amp}} = 8\\,\\mu\\mathrm{T}$，$\\sigma = 0.3\\,\\mathrm{ms}$，截断在 $t \\in [-1.2\\,\\mathrm{ms}, 1.2\\,\\mathrm{ms}]$。\n- 时间网格：在指定区间内，$\\Delta t = 1\\,\\mu\\mathrm{s}$。\n\n测试用例 3（非均匀 $B_1^+$，半正弦脉冲）：\n- 空间图：一个 $4 \\times 1 \\times 1$ 网格，$s(x,y,z)$ 沿 $x$ 轴变化，为 $[0.0, 0.5, 1.0, 1.5]$。\n- 射频包络：半正弦脉冲 $E(t) = B_{1,\\mathrm{amp}} \\sin\\!\\left(\\dfrac{\\pi t}{\\tau}\\right)$，对于 $t \\in [0,\\tau]$，其中 $B_{1,\\mathrm{amp}} = 6\\,\\mu\\mathrm{T}$ 且 $\\tau = 2\\,\\mathrm{ms}$；在此外为零。\n- 时间网格：$t \\in [0,\\tau]$，步长 $\\Delta t = 1\\,\\mu\\mathrm{s}$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含三个测试用例的九个结果（顺序为：测试用例 1 的均值、标准差、范围，然后是测试用例 2 的，再然后是测试用例 3 的），形式为一个用方括号括起来的逗号分隔列表，例如 $[\\text{result1},\\text{result2},\\ldots,\\text{result9}]$，每个值都以度为单位并四舍五入到三位小数。",
            "solution": "该问题是有效的，因为它在科学上基于核磁共振 (NMR) 物理学原理，特别是 Bloch 方程所描述的核自旋在射频 (RF) 激发下的行为。这个问题是适定的，提供了所有必需的常数、初始条件和函数形式，并且没有矛盾或歧义。\n\n控制磁场中净磁化矢量 $\\mathbf{M}$ 演化的基本原理是 Bloch 方程。在旋转参考系中并忽略弛豫效应（假设射频脉冲远短于弛豫时间 $T_1$ 和 $T_2$），该方程简化为：\n$$\n\\frac{d\\mathbf{M}}{dt} = \\gamma \\mathbf{M} \\times \\mathbf{B}_{\\text{eff}}\n$$\n其中 $\\gamma$ 是旋磁比，$\\mathbf{B}_{\\text{eff}}$ 是旋转坐标系中的有效磁场。\n\n对于共振激发，自旋的拉莫尔频率与旋转坐标系的频率完全匹配，导致主静磁场 $B_0$ 的贡献消失。此时，有效场就是施加的横向射频场 $\\mathbf{B}_1(t)$。该方程描述了磁化矢量 $\\mathbf{M}$ 围绕 $\\mathbf{B}_1(t)$ 场轴的进动（或章动）。此章动的瞬时角频率由 $\\omega(t) = \\gamma |\\mathbf{B}_1(t)|$ 给出。\n\n题目规定，在空间位置 $(x,y,z)$ 和时间 $t$ 的有效横向射频场的模由 $|B_1^+(x,y,z,t)| = s(x,y,z) |E(t)|$ 给出。这里，$E(t)$ 是一个标称射频脉冲包络，$s(x,y,z)$ 是一个无量纲、实数、非负的缩放因子，用于说明发射场的空间不均匀性。\n\n总旋转角度，即翻转角 $\\alpha$，是章动频率在射频脉冲持续时间内的积分。对于位置 $(x,y,z)$ 处的体素，其表达式为：\n$$\n\\alpha(x,y,z) = \\int_{\\text{pulse duration}} \\omega(t) dt = \\int \\gamma |B_1^+(x,y,z,t)| dt\n$$\n代入给定的场模关系式：\n$$\n\\alpha(x,y,z) = \\int \\gamma s(x,y,z) |E(t)| dt\n$$\n由于 $\\gamma$ 和空间缩放因子 $s(x,y,z)$ 不随时间变化，它们可以从积分中提出：\n$$\n\\alpha(x,y,z) = \\gamma s(x,y,z) \\int |E(t)| dt\n$$\n根据此公式计算出的 $\\alpha$ 值以弧度为单位。要转换为度，我们使用转换因子 $\\frac{180}{\\pi}$：\n$$\n\\alpha_{\\text{deg}}(x,y,z) = \\alpha_{\\text{rad}}(x,y,z) \\cdot \\frac{180}{\\pi}\n$$\n题目要求使用梯形法则对积分 $\\int |E(t)| dt$ 进行数值计算。对于一个在 $N$ 个点上以恒定时间步长 $\\Delta t$ 离散化的函数 $f(t)$，其积分近似为：\n$$\n\\int_{t_0}^{t_N} f(t) dt \\approx \\Delta t \\left( \\frac{f(t_0) + f(t_N)}{2} + \\sum_{i=1}^{N-1} f(t_i) \\right)\n$$\n在本问题中，$f(t) = |E(t)|$。\n\n总体算法如下：\n1.  对于每个测试用例，定义时间网格 $t_i$ 并计算每个点上的射频包络模 $|E(t_i)|$。\n2.  使用梯形法则计算包络模的时间积分 $I_E = \\int |E(t)| dt$。\n3.  定义氢的旋磁比：$\\gamma = 2\\pi \\cdot 42.577 \\times 10^{6}\\ \\mathrm{rad}\\,\\mathrm{s}^{-1}\\,\\mathrm{T}^{-1}$。\n4.  对于空间图 $s(x,y,z)$ 中的每个体素，计算以度为单位的局部翻转角：$\\alpha_{\\text{deg}}(x,y,z) = \\gamma \\cdot s(x,y,z) \\cdot I_E \\cdot \\frac{180}{\\pi}$。\n5.  收集空间图中所有计算出的翻转角。\n6.  计算翻转角的逐体素均值、总体标准差和范围（最大值 - 最小值）。\n7.  将最终的三个指标四舍五入到三位小数。\n\n此过程应用于所提供的三个测试用例中的每一个。\n\n**测试用例 1：均匀 $B_1^+$，矩形脉冲**\n-   空间图：$3 \\times 3 \\times 1$ 网格，其中 $s(x,y,z) = 1$。\n-   射频包络：$|E(t)| = 10 \\times 10^{-6}\\ \\mathrm{T}$，持续时间 $\\tau = 1 \\times 10^{-3}\\ \\mathrm{s}$。\n-   积分为 $I_E = (10 \\times 10^{-6}\\ \\mathrm{T}) \\cdot (1 \\times 10^{-3}\\ \\mathrm{s}) = 10 \\times 10^{-9}\\ \\mathrm{T \\cdot s}$。\n-   所有体素的翻转角恒定：$\\alpha_{\\text{deg}} = (2\\pi \\cdot 42.577 \\times 10^6) \\cdot 1 \\cdot (10 \\times 10^{-9}) \\cdot \\frac{180}{\\pi} = 360 \\cdot 42.577 \\times 10^6 \\cdot 10^{-8} \\approx 153.277^{\\circ}$。\n-   因此，均值为 $153.277^{\\circ}$，标准差和范围均为 $0$。\n\n**测试用例 2：线性变化的 $B_1^+$，高斯脉冲**\n-   空间图：$4 \\times 1 \\times 1$ 网格，其中 $s(x,y,z) = [0.8, 0.933..., 1.066..., 1.2]$。\n-   射频包络：$|E(t)| = (8 \\times 10^{-6}) \\exp(-t^2 / (2\\sigma^2))$，其中 $\\sigma = 0.3 \\times 10^{-3}\\ \\mathrm{s}$，在 $t \\in [-1.2 \\times 10^{-3}, 1.2 \\times 10^{-3}]\\ \\mathrm{s}$ 上积分。\n-   积分 $I_E$ 进行数值计算，并使用相应的 $s$ 值计算四个体素位置上各自的翻转角。\n\n**测试用例 3：非均匀 $B_1^+$，半正弦脉冲**\n-   空间图：$4 \\times 1 \\times 1$ 网格，其中 $s(x,y,z) = [0.0, 0.5, 1.0, 1.5]$。\n-   射频包络：$E(t) = (6 \\times 10^{-6}) \\sin(\\pi t / \\tau)$，其中 $\\tau = 2 \\times 10^{-3}\\ \\mathrm{s}$。由于对于 $t \\in [0, \\tau]$，$\\sin(\\pi t / \\tau) \\ge 0$，因此 $|E(t)| = E(t)$。\n-   积分 $I_E$ 进行数值计算。其解析积分为 $\\int_0^\\tau B_{1,\\mathrm{amp}} \\sin(\\pi t/\\tau) dt = B_{1,\\mathrm{amp}} \\frac{2\\tau}{\\pi}$，这可用于验证。然后计算每个体素的翻转角。\n\n最终输出将三个用例各自的均值、标准差和范围汇总到一个列表中。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the MRI flip angle calculation problem for three test cases.\n    \"\"\"\n    \n    # Define the gyromagnetic ratio for hydrogen (proton) in rad/s/T\n    GAMMA = 2 * np.pi * 42.577e6\n\n    results = []\n\n    # Wrapper function to process a single test case\n    def process_case(s_map, E_func, t_start, t_end, dt):\n        \"\"\"\n        Computes flip angle statistics for a given test case.\n\n        Args:\n            s_map (np.ndarray): Spatial map of B1+ scaling factors.\n            E_func (callable): Function that returns the RF envelope magnitude |E(t)|.\n            t_start (float): Start time of the integration interval in seconds.\n            t_end (float): End time of the integration interval in seconds.\n            dt (float): Time step in seconds.\n\n        Returns:\n            tuple: (mean, std_dev, range) of flip angles in degrees.\n        \"\"\"\n        # Create the time grid, ensuring the endpoint is included\n        t_grid = np.arange(t_start, t_end + dt / 2, dt)\n        \n        # Evaluate the RF envelope magnitude on the time grid\n        E_t = E_func(t_grid)\n        \n        # Numerically integrate |E(t)| using the trapezoidal rule\n        integral_E = np.trapz(E_t, t_grid)\n        \n        # Calculate the base flip angle in radians (for s=1)\n        alpha_base_rad = GAMMA * integral_E\n        \n        # Calculate the flip angle for each voxel in the spatial map\n        # Flatten the map for easier computation of statistics\n        s_values = s_map.flatten()\n        alpha_map_rad = s_values * alpha_base_rad\n        \n        # Convert flip angles to degrees\n        alpha_map_deg = np.degrees(alpha_map_rad)\n        \n        # Compute summary statistics\n        mean_angle = np.mean(alpha_map_deg)\n        # Population standard deviation (ddof=0 is the default)\n        std_dev_angle = np.std(alpha_map_deg, ddof=0)\n        # Range (max - min)\n        range_angle = np.ptp(alpha_map_deg)\n        \n        return mean_angle, std_dev_angle, range_angle\n\n    # --- Test Case 1: Uniform B1+, Rectangular Pulse ---\n    s_map_1 = np.ones((3, 3, 1))\n    B1_amp_1 = 10e-6  # Tesla\n    tau_1 = 1e-3      # seconds\n    dt_1 = 1e-6       # seconds\n    E_func_1 = lambda t: np.full_like(t, B1_amp_1)\n    \n    metrics_1 = process_case(s_map_1, E_func_1, 0, tau_1, dt_1)\n    results.extend(metrics_1)\n\n    # --- Test Case 2: Linearly Varying B1+, Gaussian Pulse ---\n    s_map_2 = np.array([0.8, 0.8 + 0.4 / 3, 0.8 + 2 * 0.4 / 3, 1.2])\n    B1_amp_2 = 8e-6   # Tesla\n    sigma_2 = 0.3e-3  # seconds\n    t_half_dur_2 = 1.2e-3  # seconds\n    dt_2 = 1e-6       # seconds\n    E_func_2 = lambda t: B1_amp_2 * np.exp(-t**2 / (2 * sigma_2**2))\n\n    metrics_2 = process_case(s_map_2, E_func_2, -t_half_dur_2, t_half_dur_2, dt_2)\n    results.extend(metrics_2)\n\n    # --- Test Case 3: Heterogeneous B1+, Half-Sine Pulse ---\n    s_map_3 = np.array([0.0, 0.5, 1.0, 1.5])\n    B1_amp_3 = 6e-6   # Tesla\n    tau_3 = 2e-3      # seconds\n    dt_3 = 1e-6       # seconds\n    E_func_3 = lambda t: B1_amp_3 * np.sin(np.pi * t / tau_3)\n\n    metrics_3 = process_case(s_map_3, E_func_3, 0, tau_3, dt_3)\n    results.extend(metrics_3)\n    \n    # Format the final output string as required\n    # Each value rounded to three decimal places\n    output_str = f\"[{','.join(f'{x:.3f}' for x in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}