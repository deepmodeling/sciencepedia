{
    "hands_on_practices": [
        {
            "introduction": "超导磁体的一大关键优势是其在“持续模式”下运行的能力，此时磁体与电源断开，电流在一个几乎无阻的闭合回路中持续流动。这种模式为磁共振成像（MRI）提供了极其稳定的主磁场$B_0$，这是获得高质量图像的先决条件。然而，即使是最好的超导线圈，其接头处也存在微小的残余电阻，这会导致磁场随时间极其缓慢地衰减。通过本练习，您将通过计算一个典型MRI磁体的时间常数和24小时内的磁场漂移，来量化这种卓越的稳定性。",
            "id": "4928914",
            "problem": "一台在持续模式下运行的全身磁共振成像 (MRI) 超导磁体，可以建模为一个由一个电感 $L$ 和一个微小但有限的残余接头电阻 $R_{j}$ 组成的闭合回路。在持续模式下，没有外部电源，因此该回路遵循 Kirchhoff 电压定律 (KVL)，并且磁场与环路电流成正比。从 KVL 和电感器的本构关系出发，推导环路电流以及磁场随时间变化的函数关系。然后，对于 $L = 500$ $\\mathrm{H}$ 和 $R_{j} = 10^{-12}$ $\\Omega$，计算时间常数 $\\tau$ 以及在初始磁场为 $B_{0} = 3$ $\\mathrm{T}$ 的情况下，经过 $t = 24$ 小时后的磁场漂移百分比。将 $\\tau$ 以秒为单位表示，并将磁场漂移百分比表示为百分数的十进制数值（例如，$0.25$ 对应于 $0.25\\%$）。将两个量均四舍五入至三位有效数字。",
            "solution": "首先对问题陈述进行验证。\n\n### 第1步：提取已知条件\n- **模型**：一个代表持续模式下超导磁体的闭合回路电路。\n- **元件**：电感 $L$ 和残余接头电阻 $R_{j}$。\n- **控制定律**：无外部电源回路的 Kirchhoff 电压定律 (KVL)。\n- **本构关系**：电感器两端的电压为 $L \\frac{dI}{dt}$。\n- **正比关系**：磁场 $B$ 与环路电流 $I$ 成正比。\n- **数值**：$L = 500$ $\\mathrm{H}$，$R_{j} = 10^{-12}$ $\\Omega$。\n- **初始条件**：初始磁场为 $B_{0} = 3$ $\\mathrm{T}$。\n- **时间间隔**：$t = 24$ 小时。\n- **任务**：\n    1.  推导环路电流 $I(t)$ 和磁场 $B(t)$ 随时间变化的函数关系。\n    2.  计算时间常数 $\\tau$（以秒为单位）。\n    3.  计算在 $t = 24$ 小时内的磁场漂移百分比。\n- **输出要求**：\n    1. 将 $\\tau$ 和磁场漂移百分比四舍五入至三位有效数字。\n    2. 将磁场漂移百分比表示为百分数的十进制数值。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据**：该问题使用标准的 RL 电路（电磁学的基石）来模拟一个真实的物理系统（超导磁体）。KVL 的应用是恰当的。超导接头中存在微小残余电阻的概念在物理上是正确的，所提供的电感值 ($L=500$ H) 和电阻值 ($R_j=10^{-12}$ $\\Omega$) 对于大孔径、高场强的 MRI 磁体是符合实际的。该问题具有科学合理性。\n- **适定性**：问题定义清晰。它提供了所有必要的参数和初始条件，以推导所要求的函数并计算指定的量。其控制微分方程存在唯一且稳定的解。\n- **客观性**：问题以精确、技术性的语言陈述，没有主观性或歧义。\n\n### 第3步：结论与行动\n该问题是有效的。这是一个应用物理学中的标准、适定的问题，具有科学依据和客观性。将提供解答。\n\n### 解答推导\n在持续模式下的超导磁体被建模为一个没有外部电压源的简单 RL 电路。应用 Kirchhoff 电压定律 (KVL)，闭合回路中各元件的电压降之和必须为零。电感器上的电压降为 $V_L = L \\frac{dI(t)}{dt}$，残余电阻上的电压降为 $V_R = I(t)R_j$。\n\n因此，KVL 方程为：\n$$L \\frac{dI(t)}{dt} + I(t)R_{j} = 0$$\n这是一个一阶线性齐次常微分方程。我们可以通过分离变量法来求解：\n$$L \\frac{dI}{dt} = -I R_j$$\n$$\\frac{1}{I} dI = -\\frac{R_j}{L} dt$$\n我们对两边进行积分。设时间 $t=0$ 时的初始电流为 $I_0$。我们将电流从 $I_0$ 积分到 $I(t)$，时间从 $0$ 积分到 $t$：\n$$\\int_{I_0}^{I(t)} \\frac{1}{I'} dI' = \\int_{0}^{t} -\\frac{R_j}{L} dt'$$\n$$[\\ln|I'|]_{I_0}^{I(t)} = -\\frac{R_j}{L} [t']_{0}^{t}$$\n$$\\ln(I(t)) - \\ln(I_0) = -\\frac{R_j}{L} t$$\n$$\\ln\\left(\\frac{I(t)}{I_0}\\right) = -\\frac{R_j}{L} t$$\n对两边取指数，得到电流随时间变化的函数关系：\n$$I(t) = I_0 \\exp\\left(-\\frac{R_j}{L}t\\right)$$\n问题陈述磁场 $B$ 与电流 $I$ 成正比。设此比例关系由一个常数 $k$ 表示，使得 $B(t) = k I(t)$。\n在 $t=0$ 时，初始磁场为 $B_0$，初始电流为 $I_0$，所以 $B_0 = k I_0$。由此可得 $k = B_0/I_0$。\n将此代入 $B(t)$ 的表达式中：\n$$B(t) = \\left(\\frac{B_0}{I_0}\\right) I(t) = \\left(\\frac{B_0}{I_0}\\right) \\left(I_0 \\exp\\left(-\\frac{R_j}{L}t\\right)\\right)$$\n$$B(t) = B_0 \\exp\\left(-\\frac{R_j}{L}t\\right)$$\n这就是磁场随时间变化的函数关系。电流和磁场都表现出指数衰减。\n\n指数衰减的标准形式是 $A(t) = A_0 \\exp(-t/\\tau)$，其中 $\\tau$ 是时间常数。通过将我们推导的 $B(t)$ 表达式与标准形式进行比较，我们确定该 RL 电路的时间常数 $\\tau$ 为：\n$$\\tau = \\frac{L}{R_j}$$\n使用给定的值 $L = 500$ $\\mathrm{H}$ 和 $R_j = 10^{-12}$ $\\Omega$：\n$$\\tau = \\frac{500}{10^{-12}} = 5 \\times 10^{14} \\, \\mathrm{s}$$\n四舍五入到三位有效数字，时间常数为 $\\tau = 5.00 \\times 10^{14}$ $\\mathrm{s}$。\n\n接下来，我们计算在 $t = 24$ 小时内的磁场漂移百分比。首先，我们将这个时间转换为秒：\n$$t = 24 \\, \\mathrm{h} \\times 60 \\, \\frac{\\mathrm{min}}{\\mathrm{h}} \\times 60 \\, \\frac{\\mathrm{s}}{\\mathrm{min}} = 86400 \\, \\mathrm{s}$$\n磁场漂移是磁场的变化量，$\\Delta B = B_0 - B(t)$。分数漂移为 $\\frac{\\Delta B}{B_0}$。磁场漂移百分比，我们记为 $D_{\\%}$，是这个分数乘以 $100$：\n$$D_{\\%} = \\frac{B_0 - B(t)}{B_0} \\times 100 = \\left(1 - \\frac{B(t)}{B_0}\\right) \\times 100$$\n代入 $B(t)$ 的表达式：\n$$D_{\\%} = \\left(1 - \\frac{B_0 \\exp(-t/\\tau)}{B_0}\\right) \\times 100 = \\left(1 - \\exp\\left(-\\frac{t}{\\tau}\\right)\\right) \\times 100$$\n现在我们计算指数的参数值：\n$$\\frac{t}{\\tau} = \\frac{86400 \\, \\mathrm{s}}{5.00 \\times 10^{14} \\, \\mathrm{s}} = 1.728 \\times 10^{-10}$$\n因为这个值远小于 $1$ ($t/\\tau \\ll 1$)，我们可以使用指数函数的一阶泰勒级数近似，即当 $x$ 很小时，$\\exp(-x) \\approx 1 - x$。在这种情况下，这个近似非常精确。\n$$D_{\\%} \\approx \\left(1 - \\left(1 - \\frac{t}{\\tau}\\right)\\right) \\times 100 = \\frac{t}{\\tau} \\times 100$$\n$$D_{\\%} \\approx (1.728 \\times 10^{-10}) \\times 100 = 1.728 \\times 10^{-8}$$\n问题要求将此值四舍五入到三位有效数字。\n$$D_{\\%} \\approx 1.73 \\times 10^{-8}$$\n此值代表所要求的“百分数的十进制数值”，意味着如果漂移是 $0.25\\%$，答案将是 $0.25$。我们的答案是 $1.73 \\times 10^{-8}$。\n\n需要报告的两个量是时间常数 $\\tau = 5.00 \\times 10^{14}$ s 和磁场漂移百分比 $1.73 \\times 10^{-8}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 5.00 \\times 10^{14}  1.73 \\times 10^{-8} \\end{pmatrix}}$$"
        },
        {
            "introduction": "虽然超导磁体在正常运行时非常稳定，但它们也带来了独特的安全挑战，即“失超”现象——超导线圈的某个部分意外失去超导性并转变为电阻态。由于高场强磁体中储存着巨大的电磁能量（可达数兆焦耳），必须迅速而安全地将这些能量耗散掉，以防止磁体过热受损。本练习将带您直面失超保护系统设计的核心工程权衡，您将计算磁体储存的总能量，并确定保护电路中关键元件“卸放电阻”的最小允许值。",
            "id": "4928730",
            "problem": "一个用于磁共振成像（MRI）的超导螺线管磁体在稳定的输运电流 $I_{0} = 250\\,\\mathrm{A}$下运行，其电感为 $L = 500\\,\\mathrm{H}$。如果检测到失超，保护电路会立即将电流转移到与磁体串联的纯卸载电阻中，并隔离电源，从而使随后的电流衰减仅由磁体电感和卸载电阻决定。在放电期间，磁体终端绝缘的额定最大允许电压幅值为 $V_{\\max} = 1.50\\,\\mathrm{kV}$。从基本能量和电路关系出发，计算在 $I_{0}$ 时储存在磁体中的总电磁能，并确定所需的最小卸载电阻，以确保磁体终端的峰值电压幅值不超过 $V_{\\max}$。对于此最小电阻，还需报告相应的峰值电压幅值和电流衰减的指数时间常数。将储存的能量以兆焦耳（MJ）为单位表示，电阻以欧姆（$\\Omega$）为单位表示，电压以千伏（kV）为单位表示，时间常数以秒（s）为单位表示。将所有报告值四舍五入至三位有效数字。在您的推理中，请论证这些约束条件如何与超导MRI磁体的场强考虑因素相关联。",
            "solution": "该问题陈述经评估是有效的。它在科学上基于电磁学和电路理论的原理，特别是这些原理在超导磁体失超保护这一关键工程问题中的应用。该问题是适定的、客观的，并包含了计算出唯一且有意义解所需的所有信息。所提供的物理值对于高场医学成像磁体是符合实际的。\n\n解答过程分为四个部分：计算储存的能量，确定最小卸载电阻和峰值电压，计算衰减时间常数，以及论证这些参数与MRI磁体设计的相关性。\n\n**1. 储存的电磁能**\n\n储存在电感为 $L$、载有电流 $I$ 的电感器中的总电磁能 $E$ 由以下基本关系式给出：\n$$E = \\frac{1}{2} L I^2$$\n问题给出了稳态工作电流 $I_{0} = 250\\,\\mathrm{A}$ 和磁体电感 $L = 500\\,\\mathrm{H}$。代入这些值，我们计算失超前储存的能量：\n$$E = \\frac{1}{2} (500\\,\\mathrm{H}) (250\\,\\mathrm{A})^2 = \\frac{1}{2} (500) (62500)\\,\\mathrm{J} = 15,625,000\\,\\mathrm{J}$$\n为了将此值以兆焦耳（$1\\,\\mathrm{MJ} = 10^6\\,\\mathrm{J}$）表示，我们有：\n$$E = \\frac{15,625,000}{1,000,000}\\,\\mathrm{MJ} = 15.625\\,\\mathrm{MJ}$$\n按要求四舍五入至三位有效数字，储存的能量为 $E \\approx 15.6\\,\\mathrm{MJ}$。\n\n**2. 电路分析与最小卸载电阻**\n\n当失超发生时，电源被隔离，磁体电流通过卸载电阻 $R_{dump}$ 分流。磁体和电阻形成一个简单的串联RL电路。对此回路应用基尔霍夫电压定律，我们得到：\n$$V_L(t) + V_R(t) = 0$$\n其中 $V_L(t)$ 是电感两端的电压，$V_R(t)$ 是电阻两端的电压。它们由 $V_L(t) = L \\frac{dI(t)}{dt}$ 和 $V_R(t) = I(t)R_{dump}$ 给出。得到的微分方程是：\n$$L \\frac{dI(t)}{dt} + I(t)R_{dump} = 0$$\n对于这个一阶齐次微分方程，在初始条件 $I(t=0) = I_0$ 下的解是一个指数衰减：\n$$I(t) = I_0 \\exp\\left(-\\frac{R_{dump}}{L}t\\right) = I_0 \\exp\\left(-\\frac{t}{\\tau}\\right)$$\n其中 $\\tau = \\frac{L}{R_{dump}}$ 是电流衰减的指数时间常数。\n\n在此放电期间，磁体终端的电压是 $V_L(t)$。根据电路方程，$V_L(t) = -V_R(t) = -I(t)R_{dump}$。代入 $I(t)$ 的表达式：\n$$V_L(t) = -(I_0 \\exp(-t/\\tau))R_{dump} = -I_0 R_{dump} \\exp(-t/\\tau)$$\n该电压的幅值为 $|V_L(t)| = I_0 R_{dump} \\exp(-t/\\tau)$。峰值电压幅值出现在放电开始的瞬间，即 $t=0$ 时，因为此时指数项最大（$\\exp(0)=1$）。\n$$|V_L|_{peak} = I_0 R_{dump}$$\n问题陈述该峰值电压不得超过绝缘额定值 $V_{max} = 1.50\\,\\mathrm{kV}$。\n$$|V_L|_{peak} \\le V_{max}$$\n$$I_0 R_{dump} \\le V_{max}$$\n为了找到所需的最小卸载电阻 $R_{dump, min}$，我们必须选择能够产生最大允许电压的电阻。小于此值的电阻会产生较低的电压，但问题要求的是仍能满足约束条件的最小电阻，这意味着我们应该在边界上操作。因此，我们将峰值电压设置为等于 $V_{max}$：\n$$I_0 R_{dump, min} = V_{max}$$\n求解 $R_{dump, min}$：\n$$R_{dump, min} = \\frac{V_{max}}{I_0}$$\n使用给定值 $V_{max} = 1.50\\,\\mathrm{kV} = 1500\\,\\mathrm{V}$ 和 $I_0 = 250\\,\\mathrm{A}$：\n$$R_{dump, min} = \\frac{1500\\,\\mathrm{V}}{250\\,\\mathrm{A}} = 6.00\\,\\Omega$$\n根据此定义，相应的峰值电压幅值恰好是最大允许电压 $V_{max} = 1.50\\,\\mathrm{kV}$。\n\n**3. 指数时间常数**\n\n电流衰减的时间常数 $\\tau$ 使用最小电阻 $R_{dump, min}$ 计算：\n$$\\tau = \\frac{L}{R_{dump, min}} = \\frac{500\\,\\mathrm{H}}{6.00\\,\\Omega} = 83.333...\\,\\mathrm{s}$$\n四舍五入至三位有效数字，时间常数为 $\\tau \\approx 83.3\\,\\mathrm{s}$。\n\n**4. 论证及与场强的关系**\n\n此问题中的参数与MRI磁体的基本要求和操作安全直接相关。\nMRI磁体的主要目标是在成像体积内产生一个强而均匀的磁场 $B_0$。MRI中的信噪比（SNR）约与 $B_0$ 成正比，因此更高的场强（例如，$1.5\\,\\mathrm{T}$、$3\\,\\mathrm{T}$、$7\\,\\mathrm{T}$）是非常理想的。储存在磁场中的能量与场强的平方及其所占体积成正比（$E \\propto B_0^2 \\times Volume$）。这意味着高场强的全身MRI磁体储存着巨大的能量，数量级为兆焦耳，如第1部分所计算。这种能量是所需高场强的直接结果。\n\n“失超”是磁体线圈中超导性的不受控丧失，其中一段线圈转变为其正常的电阻状态。这个电阻区会产生强烈的焦耳热（$P=I^2R_{zone}$），这会蒸发液氦制冷剂，更严重的是，如果能量不能迅速安全地耗散，可能导致磁体绕组的永久性热损伤或熔化。\n\n失超保护系统，包括卸载电阻 $R_{dump}$，旨在快速提取磁体储存的能量，并将其作为热量在外部耗散，远离精密的磁体线圈。能量提取的速率由时间常数 $\\tau = L/R_{dump}$ 控制。快速放电（小 $\\tau$）需要一个大的 $R_{dump}$。\n\n然而，一个大的 $R_{dump}$ 会在磁体终端产生高峰值电压（$|V_L|_{peak} = I_0 R_{dump}$）。如果该电压超过磁体绝缘的介电强度 $V_{max}$，可能会在绕组之间引起电弧，从而导致短路并灾难性地摧毁磁体。\n\n因此，失超保护系统的设计涉及一个关键的权衡。卸载电阻 $R_{dump}$ 必须足够小，以使终端电压低于绝缘额定值 $V_{max}$，但又必须足够大，以确保时间常数 $\\tau$ 足够短，以防止对线圈造成热损伤。如此处进行的，基于最大电压计算最小电阻是这一工程安全分析的核心部分。\n\n总而言之，高储存能量是成像所需高磁场的必然结果。电压限制 $V_{max}$ 是磁体构造的物理约束。这些因素共同决定了强制性失超保护系统的参数（$R_{dump}$，$\\tau$）。\n\n最终计算值，四舍五入至三位有效数字，为：\n- 储存的能量：$E = 15.6\\,\\mathrm{MJ}$\n- 最小卸载电阻：$R_{dump, min} = 6.00\\,\\Omega$\n- 峰值电压幅值：$|V_L|_{peak} = 1.50\\,\\mathrm{kV}$\n- 时间常数：$\\tau = 83.3\\,\\mathrm{s}$",
            "answer": "$$\\boxed{\\begin{pmatrix} 15.6  6.00  1.50  83.3 \\end{pmatrix}}$$"
        },
        {
            "introduction": "拥有一个强大而稳定的磁场只是第一步；为了实现清晰的成像，该磁场还必须在成像区域内高度均匀。然而，制造过程中的微小瑕疵以及患者身体组织自身的磁化效应都会引入磁场不均匀性。为了校正这些偏差，MRI系统配备了一套名为“匀场线圈”的专用电磁线圈。本练习将让您扮演MRI工程师的角色，通过一个计算实践，学习如何利用线性代数和最小二乘法来确定最佳的匀场电流，从而主动“修补”磁场，使其达到所需的均匀度。",
            "id": "4928801",
            "problem": "给定一个超导磁共振成像主磁体，其具有标称均匀磁场和一组匀场线圈。在球形直径体积（Diameter Spherical Volume, DSV）内，与均匀性的偏差被测量为标量磁场误差图，以特斯拉（tesla）为单位，记为 $\\Delta B(\\mathbf{r})$。假设为静态场和线性介质，因此叠加原理成立。每个匀场通道 $k$ 每单位电流（单位：特斯拉/安培）产生一个已知的空间场模式 $s_k(\\mathbf{r})$，因此对于任意电流矢量 $\\mathbf{I} \\in \\mathbb{R}^K$，建模的校正场为\n$$\n\\Delta B_{\\text{model}}(\\mathbf{r}; \\mathbf{I}) = \\sum_{k=1}^K I_k\\, s_k(\\mathbf{r}).\n$$\n给定在采样位置 $\\mathbf{r}_i \\in \\mathbb{R}^3$ 的离散测量值 $\\Delta B(\\mathbf{r}_i)$，目标是选择匀场电流 $\\mathbf{I}$，以最小化 DSV 内残余场不均匀性的 $L_2$ 范数：\n$$\n\\min_{\\mathbf{I} \\in \\mathbb{R}^K}\\ \\left\\| \\mathbf{S}\\mathbf{I} - \\mathbf{b} \\right\\|_2,\n$$\n其中 $\\mathbf{S} \\in \\mathbb{R}^{N \\times K}$ 的元素为 $S_{i,k} = s_k(\\mathbf{r}_i)$，$\\mathbf{b} \\in \\mathbb{R}^N$ 的元素为 $b_i = \\Delta B(\\mathbf{r}_i)$。只有满足 $\\|\\mathbf{r}_i\\|_2 \\le R$（在半径为 $R$ 的 DSV 内部或其表面上）的采样点才应包含在拟合中；所有其他点都必须舍弃。如果存在多个最小化解，选择欧几里得范数 $\\|\\mathbf{I}\\|_2$ 最小的那个解。\n\n对于此问题，使用 $K = 4$ 个匀场通道，其每安培的场模式如下：\n- 通道 1（Z0 均匀匀场）：$s_1(\\mathbf{r}) = \\gamma_0$，其中 $\\gamma_0 = 20 \\times 10^{-6}\\ \\text{T/A}$。\n- 通道 2–4（一阶梯度匀场）：$s_2(\\mathbf{r}) = \\gamma_1\\, x$，$s_3(\\mathbf{r}) = \\gamma_1\\, y$，$s_4(\\mathbf{r}) = \\gamma_1\\, z$，其中 $\\gamma_1 = 40 \\times 10^{-6}\\ \\text{T}/(\\text{A}\\cdot\\text{m})$ 且 $\\mathbf{r} = (x,y,z)$ 单位为米。\n\n令用于合成以下所有案例的测量数据的底层“真实”电流为\n$$\n\\mathbf{I}_{\\text{true}} = \\begin{bmatrix} 0.5 \\\\ 1.2 \\\\ -0.8 \\\\ 0.3 \\end{bmatrix}\\ \\text{A}.\n$$\n\n每个测试案例的测量值由以下公式生成：\n$$\n\\Delta B(\\mathbf{r}_i) = \\gamma_0\\, I_1 + \\gamma_1 \\left( I_2\\, x_i + I_3\\, y_i + I_4\\, z_i \\right) + n_i,\n$$\n其中 $n_i$ 是一个已知的加性噪声项，单位为特斯拉（在下文为每个案例指定）。此问题不涉及角度。所有物理量必须使用国际单位制处理；所有电流以安培表示。\n\n实现一个程序，为每个测试案例构建 $\\mathbf{S}$ 和 $\\mathbf{b}$，按指定的 DSV 半径 $R$ 进行筛选，并计算最小化 $\\|\\mathbf{S}\\mathbf{I} - \\mathbf{b}\\|_2$ 的最小欧几里得范数最小二乘解 $\\hat{\\mathbf{I}}$。使用一种数值稳定的方法，该方法能为任意秩的矩阵返回最小范数解。\n\n您的程序必须解决以下三个测试案例并输出所有三个解。\n\n测试案例 A（理想路径，无噪声，良定）：\n- 半径 $R = 0.15\\ \\text{m}$。\n- 采样位置 $\\{\\mathbf{r}_i\\}$（单位：米）：\n  $\\left(0.10, 0.00, 0.00\\right)$,\n  $\\left(0.00, 0.10, 0.00\\right)$,\n  $\\left(0.00, 0.00, 0.10\\right)$,\n  $\\left(-0.10, 0.00, 0.00\\right)$,\n  $\\left(0.00, -0.10, 0.00\\right)$,\n  $\\left(0.00, 0.00, -0.10\\right)$,\n  $\\left(0.07, 0.07, 0.07\\right)$,\n  $\\left(-0.07, -0.02, 0.09\\right)$。\n- 噪声矢量 $\\mathbf{n}$：所有元素均为 $0$ 特斯拉。\n\n测试案例 B（欠定，无噪声，需要选择最小范数解）：\n- 半径 $R = 0.10\\ \\text{m}$。\n- 采样位置 $\\{\\mathbf{r}_i\\}$（单位：米）：\n  $\\left(0.08, 0.06, 0.00\\right)$,\n  $\\left(-0.05, 0.00, 0.0866\\right)$。\n- 噪声矢量 $\\mathbf{n}$：所有元素均为 $0$ 特斯拉。\n\n测试案例 C（舍弃 DSV 外部的点，存在微小测量噪声）：\n- 半径 $R = 0.12\\ \\text{m}$。\n- 采样位置 $\\{\\mathbf{r}_i\\}$（单位：米）：\n  $\\left(0.11, 0.00, 0.05\\right)$,\n  $\\left(0.00, 0.12, 0.00\\right)$,\n  $\\left(-0.12, 0.00, 0.00\\right)$,\n  $\\left(0.00, 0.00, 0.12\\right)$,\n  $\\left(0.10, 0.06, 0.02\\right)$,\n  $\\left(-0.09, -0.09, -0.09\\right)$。\n- 噪声矢量 $\\mathbf{n}$（单位：特斯拉），与上述顺序对齐：\n  $\\left(1.0\\times 10^{-8},\\ -2.0\\times 10^{-8},\\ 0.5\\times 10^{-8},\\ -1.5\\times 10^{-8},\\ 2.5\\times 10^{-8},\\ -0.3\\times 10^{-8}\\right)$。\n\n要求：\n- 对于每个测试案例，仅使用满足 $\\|\\mathbf{r}_i\\|_2 \\le R$ 的采样点构建 $\\mathbf{S}$，并使用给定的生成规则和噪声构建 $\\mathbf{b}$。\n- 将 $\\hat{\\mathbf{I}}$ 计算为最小二乘问题的最小欧几里得范数解。\n- 报告电流值（单位：安培），每个值四舍五入到小数点后恰好六位。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个含三个子列表的列表，每个子列表对应一个测试案例，顺序为 A、B、C。每个子列表必须包含通道 1 到 4 的四个四舍五入后的电流值（单位：安培）。例如：\n\"[[I11,I12,I13,I14],[I21,I22,I23,I24],[I31,I32,I33,I34]]\"\n其中每个 $I_{jk}$ 是一个小数点后恰好有六位的小数，不打印单位。",
            "solution": "用户的问题陈述已经过分析和验证。\n\n### 步骤 1：提取给定信息\n- **目标**：求解电流矢量 $\\mathbf{I} \\in \\mathbb{R}^K$，该矢量是最小范数最小二乘问题的解：$\\min_{\\mathbf{I} \\in \\mathbb{R}^K}\\ \\left\\| \\mathbf{S}\\mathbf{I} - \\mathbf{b} \\right\\|_2$，并附加约束条件：如果存在多个最小化解，则选择欧几里得范数 $\\|\\mathbf{I}\\|_2$ 最小的那个。\n- **模型参数**：\n    - 匀场通道数：$K = 4$。\n    - 匀场基函数：\n        - $s_1(\\mathbf{r}) = \\gamma_0$，其中 $\\gamma_0 = 20 \\times 10^{-6}\\ \\text{T/A}$。\n        - $s_2(\\mathbf{r}) = \\gamma_1\\, x$, $s_3(\\mathbf{r}) = \\gamma_1\\, y$, $s_4(\\mathbf{r}) = \\gamma_1\\, z$，其中 $\\gamma_1 = 40 \\times 10^{-6}\\ \\text{T}/(\\text{A}\\cdot\\text{m})$。此处 $\\mathbf{r} = (x,y,z)$。\n- **数据生成模型**：\n    - “真实”电流：$\\mathbf{I}_{\\text{true}} = \\begin{bmatrix} 0.5  1.2  -0.8  0.3 \\end{bmatrix}^T\\ \\text{A}$。\n    - 测量场：$\\Delta B(\\mathbf{r}_i) = \\sum_{k=1}^4 I_{\\text{true}, k} s_k(\\mathbf{r}_i) + n_i = \\gamma_0 I_{\\text{true}, 1} + \\gamma_1 (I_{\\text{true}, 2}x_i + I_{\\text{true}, 3}y_i + I_{\\text{true}, 4}z_i) + n_i$。\n- **系统矩阵**：\n    - $\\mathbf{S}$ 矩阵元素：$S_{ik} = s_k(\\mathbf{r}_i)$。\n    - $\\mathbf{b}$ 矢量元素：$b_i = \\Delta B(\\mathbf{r}_i)$。\n- **DSV 约束**：只有满足 $\\|\\mathbf{r}_i\\|_2 \\le R$ 的采样点 $\\mathbf{r}_i$ 用于构建 $\\mathbf{S}$ 和 $\\mathbf{b}$。\n- **测试案例 A**：\n    - $R = 0.15\\ \\text{m}$。\n    - 采样点 $\\{\\mathbf{r}_i\\}$: $(0.10, 0, 0)$, $(0, 0.10, 0)$, $(0, 0, 0.10)$, $(-0.10, 0, 0)$, $(0, -0.10, 0)$, $(0, 0, -0.10)$, $(0.07, 0.07, 0.07)$, $(-0.07, -0.02, 0.09)$。所有坐标单位为米。\n    - 噪声 $\\mathbf{n}$：所有元素均为 $0\\ \\text{T}$。\n- **测试案例 B**：\n    - $R = 0.10\\ \\text{m}$。\n    - 采样点 $\\{\\mathbf{r}_i\\}$: $(0.08, 0.06, 0)$, $(-0.05, 0, 0.0866)$。所有坐标单位为米。\n    - 噪声 $\\mathbf{n}$：所有元素均为 $0\\ \\text{T}$。\n- **测试案例 C**：\n    - $R = 0.12\\ \\text{m}$。\n    - 采样点 $\\{\\mathbf{r}_i\\}$: $(0.11, 0, 0.05)$, $(0, 0.12, 0)$, $(-0.12, 0, 0)$, $(0, 0, 0.12)$, $(0.10, 0.06, 0.02)$, $(-0.09, -0.09, -0.09)$。所有坐标单位为米。\n    - 噪声 $\\mathbf{n}$: $(10^{-8}, -2\\times 10^{-8}, 0.5\\times 10^{-8}, -1.5\\times 10^{-8}, 2.5\\times 10^{-8}, -0.3\\times 10^{-8})\\ \\text{T}$。\n- **输出要求**：报告每个案例的电流矢量 $\\hat{\\mathbf{I}}$，每个分量四舍五入到 6 位小数，并采用特定的字符串格式。\n\n### 步骤 2：使用提取的给定信息进行验证\n该问题具有科学依据，是适定的、客观的。它描述了 MRI 物理学（场匀场）中一个标准的线性代数应用。该模型是一个物理上合理的简化（零阶和一阶匀场）。目标函数是标准的最小二乘最小化。问题提供了所有必要的数据和常数，并且要求找到最小范数解，这使得问题即使对于秩亏系统也是适定的。给定的物理数值是合理的。没有矛盾、歧义或伪科学主张。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。将提供一个解决方案。\n\n### 基于原理的解决方案\n此问题的核心是找到最优的匀场电流 $\\mathbf{I}$，以最小化残余磁场误差的欧几里得范数的平方，这被表述为一个线性最小二乘问题：\n$$\n\\min_{\\mathbf{I} \\in \\mathbb{R}^K} \\| \\mathbf{S}\\mathbf{I} - \\mathbf{b} \\|_2^2\n$$\n问题进一步规定，如果解不唯一（即，如果系统矩阵 $\\mathbf{S}$ 是秩亏的），则应选择具有最小欧几里得范数 $\\|\\mathbf{I}\\|_2$ 的解。这定义了最小范数最小二乘问题，该问题总有一个唯一解，由下式给出：\n$$\n\\hat{\\mathbf{I}} = \\mathbf{S}^{+} \\mathbf{b}\n$$\n其中 $\\mathbf{S}^{+}$ 是 $\\mathbf{S}$ 的 Moore-Penrose 伪逆。这个单一的公式能正确处理所有情况：\n- 如果 $\\mathbf{S}$ 具有满列秩（超定或良定系统），则 $\\mathbf{S}^{+} = (\\mathbf{S}^T\\mathbf{S})^{-1}\\mathbf{S}^T$，得到标准的唯一最小二乘解。\n- 如果 $\\mathbf{S}$ 是秩亏的（欠定或病态系统），伪逆提供的解既能最小化残差 $\\| \\mathbf{S}\\mathbf{I} - \\mathbf{b} \\|_2$，又在所有此类最小化解中具有最小的范数 $\\|\\mathbf{I}\\|_2$。\n\n在计算伪逆和解决最小二乘问题时，首选数值稳定的算法，例如基于奇异值分解（SVD）的算法。Python 中的 `numpy.linalg.lstsq` 函数提供了这样的实现，默认情况下返回最小范数解。\n\n每个测试案例的流程如下：\n\n1.  **数据筛选**：第一步是根据球形直径体积（DSV）半径 $R$ 筛选给定的采样位置 $\\{\\mathbf{r}_i\\}$ 及其对应的噪声值 $\\{n_i\\}$。一个点 $\\mathbf{r}_i$ 当且仅当其欧几里得范数 $\\|\\mathbf{r}_i\\|_2 = \\sqrt{x_i^2 + y_i^2 + z_i^2}$ 小于或等于 $R$ 时才被包含在内。设筛选后的点集为 $\\{\\mathbf{r}'_j\\}_{j=1}^N$，对应的噪声矢量为 $\\mathbf{n}' \\in \\mathbb{R}^N$。\n\n2.  **系统矩阵构建**：系统矩阵 $\\mathbf{S} \\in \\mathbb{R}^{N \\times 4}$ 基于 $N$ 个筛选后的点构建。$\\mathbf{S}$ 的第 $j$ 行对应于点 $\\mathbf{r}'_j = (x'_j, y'_j, z'_j)$，并由下式给出：\n    $$\n    \\mathbf{S}_{j,:} = \\begin{bmatrix} s_1(\\mathbf{r}'_j)  s_2(\\mathbf{r}'_j)  s_3(\\mathbf{r}'_j)  s_4(\\mathbf{r}'_j) \\end{bmatrix} = \\begin{bmatrix} \\gamma_0  \\gamma_1 x'_j  \\gamma_1 y'_j  \\gamma_1 z'_j \\end{bmatrix}\n    $$\n    其中 $\\gamma_0 = 20 \\times 10^{-6}\\ \\text{T/A}$ 且 $\\gamma_1 = 40 \\times 10^{-6}\\ \\text{T/(A}\\cdot\\text{m})$。\n\n3.  **测量矢量构建**：测量矢量 $\\mathbf{b} \\in \\mathbb{R}^N$ 使用真实电流 $\\mathbf{I}_{\\text{true}}$ 和筛选后的噪声矢量 $\\mathbf{n}'$ 合成。第 $j$ 个元素 $b_j$ 是在点 $\\mathbf{r}'_j$ 处的模拟测量值：\n    $$\n    b_j = \\left( \\sum_{k=1}^4 S_{jk} I_{\\text{true},k} \\right) + n'_j\n    $$\n    以矩阵形式，这可以高效地计算为 $\\mathbf{b} = \\mathbf{S} \\mathbf{I}_{\\text{true}} + \\mathbf{n}'$。\n\n4.  **求解系统**：通过使用鲁棒的数值求解器求解系统中的 $\\mathbf{I}$ 来计算最小范数最小二乘解 $\\hat{\\mathbf{I}}$。$\\hat{\\mathbf{I}}$ 即为所求的匀场电流矢量。\n\n5.  **最终格式化**：将得到的矢量 $\\hat{\\mathbf{I}}$ 的四个分量按要求四舍五入到六位小数。\n\n对三个测试案例中的每一个重复此过程。\n- **案例 A** 代表一个超定（8 个点，4 个未知数）、无噪声的系统。所有点都在 DSV 内。我们期望解恰好是 $\\hat{\\mathbf{I}} = \\mathbf{I}_{\\text{true}}$。\n- **案例 B** 是一个欠定（2 个点，4 个未知数）、无噪声的系统。两个点都在 DSV 内。解将是 $\\mathbf{I}_{\\text{true}}$ 在 $\\mathbf{S}$ 的行空间上的一个投影，它最小化残差并具有最小范数，因此一般不等于 $\\mathbf{I}_{\\text{true}}$。\n- **案例 C** 是一个带噪声的系统。6 个初始点中有两个位于 DSV 之外，必须被舍弃，从而得到一个有 4 个点和 4 个未知数的系统（使其成为一个方阵系统）。由于噪声的存在，得到的 $\\hat{\\mathbf{I}}$ 将是 $\\mathbf{I}_{\\text{true}}$ 的一个估计值，但与它不完全相同。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the optimal shim currents for three test cases\n    using a minimum-norm least-squares approach.\n    \"\"\"\n    \n    # Define physical constants and true currents\n    gamma0 = 20e-6  # T/A\n    gamma1 = 40e-6  # T/(A*m)\n    I_true = np.array([0.5, 1.2, -0.8, 0.3]) # A\n\n    # Define the three test cases\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"R\": 0.15,\n            \"points\": np.array([\n                [0.10, 0.00, 0.00], [0.00, 0.10, 0.00], [0.00, 0.00, 0.10],\n                [-0.10, 0.00, 0.00], [0.00, -0.10, 0.00], [0.00, 0.00, -0.10],\n                [0.07, 0.07, 0.07], [-0.07, -0.02, 0.09]\n            ]),\n            \"noise\": np.zeros(8)\n        },\n        {\n            \"name\": \"Case B\",\n            \"R\": 0.10,\n            \"points\": np.array([\n                [0.08, 0.06, 0.00],\n                [-0.05, 0.00, 0.0866]\n            ]),\n            \"noise\": np.zeros(2)\n        },\n        {\n            \"name\": \"Case C\",\n            \"R\": 0.12,\n            \"points\": np.array([\n                [0.11, 0.00, 0.05], [0.00, 0.12, 0.00], [-0.12, 0.00, 0.00],\n                [0.00, 0.00, 0.12], [0.10, 0.06, 0.02], [-0.09, -0.09, -0.09]\n            ]),\n            \"noise\": np.array([1.0e-8, -2.0e-8, 0.5e-8, -1.5e-8, 2.5e-8, -0.3e-8])\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        R = case[\"R\"]\n        points = case[\"points\"]\n        noise = case[\"noise\"]\n\n        # Step 1: Filter points to be within the DSV radius R\n        norms = np.linalg.norm(points, axis=1)\n        dsv_mask = norms = R\n        \n        filtered_points = points[dsv_mask]\n        filtered_noise = noise[dsv_mask]\n\n        if filtered_points.shape[0] == 0:\n            # Handle case with no points in DSV\n            I_hat = np.zeros(4)\n        else:\n            # Step 2: Construct the system matrix S\n            N = filtered_points.shape[0] # Number of measurement points\n            K = 4                        # Number of shim channels\n            S = np.zeros((N, K))\n            \n            S[:, 0] = gamma0\n            S[:, 1] = gamma1 * filtered_points[:, 0]\n            S[:, 2] = gamma1 * filtered_points[:, 1]\n            S[:, 3] = gamma1 * filtered_points[:, 2]\n\n            # Step 3: Construct the measurement vector b\n            b = S @ I_true + filtered_noise\n\n            # Step 4: Solve the minimum-norm least-squares problem\n            # numpy.linalg.lstsq returns the min-norm solution for underdetermined systems\n            I_hat, _, _, _ = np.linalg.lstsq(S, b, rcond=None)\n\n        # Step 5: Round results to 6 decimal places\n        rounded_I_hat = [round(x, 6) for x in I_hat]\n        all_results.append(rounded_I_hat)\n\n    # Format the final output string as specified\n    final_result_string = \"[[{:.6f},{:.6f},{:.6f},{:.6f}],[{:.6f},{:.6f},{:.6f},{:.6f}],[{:.6f},{:.6f},{:.6f},{:.6f}]]\".format(\n        *all_results[0], *all_results[1], *all_results[2]\n    )\n    \n    print(final_result_string)\n\nsolve()\n```"
        }
    ]
}