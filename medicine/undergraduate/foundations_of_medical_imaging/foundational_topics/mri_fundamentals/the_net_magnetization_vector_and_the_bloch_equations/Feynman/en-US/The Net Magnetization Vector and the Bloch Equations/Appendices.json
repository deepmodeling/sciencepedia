{
    "hands_on_practices": [
        {
            "introduction": "The Bloch equations describe the abstract behavior of the net magnetization vector, but how does this translate into a measurable electrical signal? This exercise connects the physics of spin precession to the engineering of signal detection by using Faraday's Law of induction and the principle of reciprocity. By working through this problem, you will derive from first principles the voltage induced in a receive coil, demystifying the origin of the MRI signal itself .",
            "id": "4934132",
            "problem": "A sample of liquid water at room temperature is placed in a static magnetic field aligned with the laboratory $z$-axis. The sample has a uniform equilibrium net magnetization magnitude per unit volume $M_0$ along $+\\hat{\\mathbf{z}}$. A short, on-resonance hard radiofrequency excitation about the $x$-axis tips the magnetization by a small flip angle $\\alpha$, creating a transverse component $\\mathbf{M}_\\perp$ that subsequently precesses about $+\\hat{\\mathbf{z}}$. A single tuned, lossless receive loop is placed near the sample. The loop is characterized at the Larmor angular frequency by its counter-rotating transmit field per unit current, $B_1^-(\\mathbf{r})/I$, which is uniform and aligned with $\\mathbf{M}_\\perp$ over the sample volume. Assume relaxation and off-resonance are negligible over the time interval of interest.\n\nUse only fundamental laws and core definitions to derive, from first principles, the expression for the open-circuit receive voltage $v(t)$ immediately after the pulse in terms of the precessing $\\mathbf{M}_\\perp$ and the coil’s counter-rotating sensitivity $B_1^-(\\mathbf{r})/I$. Your derivation must start from the Bloch equation $d\\mathbf{M}/dt = \\gamma\\, \\mathbf{M} \\times \\mathbf{B}$ and Faraday’s law of electromagnetic induction, and it must justify the use of the rotating-wave decomposition and the reciprocity principle to isolate the term that contributes to the detected signal at the Larmor frequency.\n\nThen, evaluate the magnitude of the peak induced open-circuit voltage immediately after the pulse for the following parameters:\n- Static field $B_0 = 3.0$ T.\n- Proton gyromagnetic ratio $\\gamma = 2.675 \\times 10^8$ rad s$^{-1}$ T$^{-1}$.\n- Equilibrium magnetization $M_0 = 3.2 \\times 10^{-3}$ A m$^{-1}$.\n- Flip angle $\\alpha = 10^\\circ$ (angle is in degrees).\n- Sample volume $V_s = 1.2 \\times 10^{-5}$ m$^{3}$.\n- Uniform counter-rotating field sensitivity magnitude $|B_1^-|/I = b_1 = 5.0 \\times 10^{-7}$ T A$^{-1}$.\n\nExpress the final numerical answer as the magnitude of the peak open-circuit voltage in microvolts (μV). Round your answer to three significant figures.",
            "solution": "The problem is subjected to validation.\n\n**Step 1: Extract Givens**\n-   Static magnetic field aligned with the laboratory $z$-axis.\n-   Uniform equilibrium net magnetization magnitude per unit volume: $M_0$ along $+\\hat{\\mathbf{z}}$.\n-   Excitation: short, on-resonance hard radiofrequency pulse about the $x$-axis.\n-   Flip angle: $\\alpha$.\n-   Resulting magnetization component: transverse component $\\mathbf{M}_\\perp$ precessing about $+\\hat{\\mathbf{z}}$.\n-   Receive loop: single, tuned, lossless.\n-   Coil characterization: counter-rotating transmit field per unit current, $\\mathbf{B}_1^-(\\mathbf{r})/I$, is uniform and aligned with $\\mathbf{M}_\\perp$ over the sample volume.\n-   Assumptions: relaxation and off-resonance are negligible.\n-   Derivation start points: Bloch equation $d\\mathbf{M}/dt = \\gamma\\, \\mathbf{M} \\times \\mathbf{B}$ and Faraday’s law of electromagnetic induction.\n-   Required justification: use of rotating-wave decomposition and the reciprocity principle.\n-   Numerical parameters:\n    -   Static field $B_0 = 3.0$ T.\n    -   Proton gyromagnetic ratio $\\gamma = 2.675 \\times 10^8$ rad s$^{-1}$ T$^{-1}$.\n    -   Equilibrium magnetization $M_0 = 3.2 \\times 10^{-3}$ A m$^{-1}$.\n    -   Flip angle $\\alpha = 10^\\circ$.\n    -   Sample volume $V_s = 1.2 \\times 10^{-5}$ m$^{3}$.\n    -   Uniform counter-rotating field sensitivity magnitude $|B_1^-|/I = b_1 = 5.0 \\times 10^{-7}$ T A$^{-1}$.\n-   Required output: magnitude of the peak induced open-circuit voltage in microvolts (μV), rounded to three significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded:** The problem is fundamentally based on the established principles of nuclear magnetic resonance (NMR) and classical electromagnetism, specifically the Bloch equation and Faraday's law. All concepts and physical quantities are standard in the field of medical imaging.\n-   **Well-Posed:** The problem provides all necessary physical laws, initial conditions, and numerical constants to first derive a general expression and then compute a specific numerical value. The assumptions made (e.g., negligible relaxation, uniform fields) are typical idealizations that render the problem well-defined and solvable.\n-   **Objective:** The problem is stated in precise, unbiased, and technical language.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, well-posed, and complete. It is therefore deemed **valid**. The solution process will now proceed.\n\n**Derivation of the Receive Voltage**\n\nThe derivation starts from two fundamental principles: Faraday's law of induction and the principle of reciprocity in electromagnetism.\n\n$1$. **Faraday's Law of Induction**: The open-circuit voltage $v(t)$ induced in a receive coil is equal to the negative time derivative of the magnetic flux $\\Phi_B(t)$ passing through the coil.\n$$v(t) = - \\frac{d\\Phi_B(t)}{dt}$$\n\n$2$. **Principle of Reciprocity**: The magnetic flux $\\Phi_B(t)$ through the receive coil, generated by a distribution of magnetization $\\mathbf{M}(\\mathbf{r}, t)$ in a sample, can be expressed by the following integral over the sample volume $V_s$:\n$$\\Phi_B(t) = \\int_{V_s} \\frac{\\mathbf{B}_1(\\mathbf{r})}{I} \\cdot \\mathbf{M}(\\mathbf{r}, t) \\, dV$$\nHere, $\\mathbf{B}_1(\\mathbf{r})/I$ is the magnetic field produced by the coil per unit of current $I$ flowing through it. This quantity is also known as the coil's sensitivity map.\n\nCombining these two principles, the induced voltage is:\n$$v(t) = - \\frac{d}{dt} \\int_{V_s} \\frac{\\mathbf{B}_1(\\mathbf{r})}{I} \\cdot \\mathbf{M}(\\mathbf{r}, t) \\, dV$$\nSince the coil is static, its sensitivity map $\\mathbf{B}_1(\\mathbf{r})/I$ is time-independent. The time derivative can be moved inside the integral to act only on the time-varying magnetization $\\mathbf{M}(\\mathbf{r}, t)$:\n$$v(t) = - \\int_{V_s} \\frac{\\mathbf{B}_1(\\mathbf{r})}{I} \\cdot \\frac{\\partial \\mathbf{M}(\\mathbf{r}, t)}{\\partial t} \\, dV$$\n\n$3$. **Bloch Equation**: With relaxation neglected, the time evolution of the magnetization is governed by the torque equation, also known as the precession part of the Bloch equation:\n$$\\frac{d\\mathbf{M}}{dt} = \\gamma \\, \\mathbf{M} \\times \\mathbf{B}$$\nIn a static magnetic field $\\mathbf{B} = B_0 \\hat{\\mathbf{z}}$, this becomes:\n$$\\frac{\\partial \\mathbf{M}}{\\partial t} = \\gamma \\, \\mathbf{M} \\times (B_0 \\hat{\\mathbf{z}})$$\nThe magnetization precesses about the $z$-axis at the Larmor angular frequency $\\omega_0 = \\gamma B_0$. Note that for protons, $\\gamma > 0$, so the precession is clockwise when viewed from the positive $z$-axis.\n\n$4$. **Rotating-Wave Decomposition and Justification**: The precessing transverse magnetization $\\mathbf{M}_\\perp(t)$ is a vector rotating in the $xy$-plane at frequency $\\omega_0$. It can be considered a purely \"co-rotating\" field (in the sense of its precession). A general, linearly polarized receive coil has a sensitivity pattern that can be decomposed into two counter-rotating spatial components. By the principle of reciprocity and the rotating-wave approximation, the precessing magnetization will only induce a detectable signal via the component of the coil's sensitivity that rotates in the same sense. For clockwise-precessing spins, this is the clockwise, or \"counter-rotating\", sensitivity component, which the problem denotes as $\\mathbf{B}_1^-(\\mathbf{r})/I$. Therefore, to find the signal at the Larmor frequency, we replace the total sensitivity $\\mathbf{B}_1(\\mathbf{r})/I$ with its effective component $\\mathbf{B}_1^-(\\mathbf{r})/I$.\n\nThe problem states that this sensitivity $\\mathbf{B}_1^-(\\mathbf{r})/I$ and the sample magnetization are uniform over the volume $V_s$. Let's denote the uniform sensitivity vector as $\\mathbf{b}_1^- = \\mathbf{B}_1^-/I$. The voltage equation simplifies to:\n$$v(t) = - V_s \\left( \\mathbf{b}_1^- \\cdot \\frac{d\\mathbf{M}(t)}{dt} \\right)$$\nSince the longitudinal magnetization $M_z$ is constant (no relaxation), $d\\mathbf{M}/dt = d\\mathbf{M}_\\perp/dt$.\n$$v(t) = - V_s \\left( \\mathbf{b}_1^- \\cdot \\frac{d\\mathbf{M}_\\perp(t)}{dt} \\right)$$\n\n$5$. **Magnetization Dynamics**: Initially, the magnetization is $\\mathbf{M}_{eq} = M_0 \\hat{\\mathbf{z}}$. An RF pulse about the $x$-axis with flip angle $\\alpha$ rotates this magnetization. The magnetization vector immediately after the pulse ($t=0$) is $\\mathbf{M}(0) = M_0 (\\cos(\\alpha)\\hat{\\mathbf{z}} + \\sin(\\alpha)\\hat{\\mathbf{y}})$. The transverse component is $\\mathbf{M}_\\perp(0) = M_0 \\sin(\\alpha) \\hat{\\mathbf{y}}$. Let $M_\\perp = M_0 \\sin(\\alpha)$.\nSubsequent precession around $\\hat{\\mathbf{z}}$ at frequency $\\omega_0$ gives the time evolution of the transverse magnetization:\n$$\\mathbf{M}_\\perp(t) = M_\\perp (\\sin(\\omega_0 t) \\hat{\\mathbf{x}} + \\cos(\\omega_0 t) \\hat{\\mathbf{y}})$$\nThe time derivative is:\n$$\\frac{d\\mathbf{M}_\\perp(t)}{dt} = M_\\perp \\omega_0 (\\cos(\\omega_0 t) \\hat{\\mathbf{x}} - \\sin(\\omega_0 t) \\hat{\\mathbf{y}})$$\n\n$6$. **Final Expression**: The problem states that $\\mathbf{B}_1^-(\\mathbf{r})/I$ is \"aligned with $\\mathbf{M}_\\perp$\". As $\\mathbf{M}_\\perp(t)$ is time-varying, this statement is interpreted to mean that the static sensitivity vector $\\mathbf{b}_1^-$ is aligned with the initial transverse magnetization $\\mathbf{M}_\\perp(0)$.\nSince $\\mathbf{M}_\\perp(0)$ is along the $y$-axis, the sensitivity vector is $\\mathbf{b}_1^- = b_1 \\hat{\\mathbf{y}}$, where $b_1 = |\\mathbf{B}_1^-|/I$ is the given magnitude.\nNow we compute the dot product:\n$$\\mathbf{b}_1^- \\cdot \\frac{d\\mathbf{M}_\\perp(t)}{dt} = (b_1 \\hat{\\mathbf{y}}) \\cdot (M_\\perp \\omega_0 (\\cos(\\omega_0 t) \\hat{\\mathbf{x}} - \\sin(\\omega_0 t) \\hat{\\mathbf{y}})) = -b_1 M_\\perp \\omega_0 \\sin(\\omega_0 t)$$\nSubstituting this into the voltage equation:\n$$v(t) = -V_s (-b_1 M_\\perp \\omega_0 \\sin(\\omega_0 t)) = \\omega_0 V_s b_1 M_\\perp \\sin(\\omega_0 t)$$\nThe peak magnitude of this induced voltage is the amplitude of the sinusoidal function:\n$$|v_{peak}| = \\omega_0 V_s b_1 M_\\perp$$\nReplacing $M_\\perp$ with its definition in terms of $M_0$ and $\\alpha$:\n$$|v_{peak}| = \\omega_0 V_s b_1 M_0 \\sin(\\alpha)$$\nThis completes the derivation.\n\n**Numerical Evaluation**\n\nWe now calculate the value of $|v_{peak}|$ using the provided parameters.\n\n-   Larmor frequency $\\omega_0$:\n    $$\\omega_0 = \\gamma B_0 = (2.675 \\times 10^8 \\, \\text{rad s}^{-1} \\text{T}^{-1}) \\times (3.0 \\, \\text{T}) = 8.025 \\times 10^8 \\, \\text{rad s}^{-1}$$\n\n-   Magnitude of the transverse magnetization $M_\\perp$:\n    The flip angle is $\\alpha = 10^\\circ$.\n    $$M_\\perp = M_0 \\sin(\\alpha) = (3.2 \\times 10^{-3} \\, \\text{A m}^{-1}) \\times \\sin(10^\\circ)$$\n    $$\\sin(10^\\circ) \\approx 0.173648$$\n    $$M_\\perp \\approx (3.2 \\times 10^{-3}) \\times 0.173648 \\approx 5.55674 \\times 10^{-4} \\, \\text{A m}^{-1}$$\n\n-   The remaining parameters are given:\n    -   $V_s = 1.2 \\times 10^{-5} \\, \\text{m}^3$\n    -   $b_1 = 5.0 \\times 10^{-7} \\, \\text{T A}^{-1}$\n\n-   Calculate the peak voltage magnitude:\n    $$|v_{peak}| = (8.025 \\times 10^8 \\, \\text{s}^{-1}) \\times (1.2 \\times 10^{-5} \\, \\text{m}^3) \\times (5.0 \\times 10^{-7} \\, \\text{T A}^{-1}) \\times (5.55674 \\times 10^{-4} \\, \\text{A m}^{-1})$$\n    Grouping numerical terms and powers of $10$:\n    $$|v_{peak}| = (8.025 \\times 1.2 \\times 5.0 \\times 5.55674) \\times (10^8 \\times 10^{-5} \\times 10^{-7} \\times 10^{-4}) \\, \\text{V}$$\n    $$|v_{peak}| \\approx 267.58 \\times 10^{-8} \\, \\text{V} = 2.6758 \\times 10^{-6} \\, \\text{V}$$\n\n-   The problem asks for the answer in microvolts (μV), where $1 \\, \\mu\\text{V} = 10^{-6} \\, \\text{V}$.\n    $$|v_{peak}| \\approx 2.6758 \\, \\mu\\text{V}$$\n\n-   Rounding to three significant figures, the result is $2.68 \\, \\mu\\text{V}$.",
            "answer": "$$\\boxed{2.68}$$"
        },
        {
            "introduction": "An MRI voxel in biological tissue is rarely homogeneous, often containing a mixture of different components like fat and water. This exercise challenges you to move beyond simple models by applying the Bloch equations to a voxel with multiple, non-exchanging compartments. You will learn to calculate the total signal based on the partial volume of each component, providing a crucial understanding of how tissue heterogeneity influences image contrast and quantitative analysis .",
            "id": "4934143",
            "problem": "A single Magnetic Resonance Imaging (MRI) voxel contains two non-exchanging compartments, each contributing to the net magnetization through its own relaxation properties and volume fraction. The static magnetic field is applied along the $z$-axis. The dynamics of the magnetization vector $\\mathbf{M}(t)$ are governed by the Bloch equations, with longitudinal recovery characterized by the longitudinal relaxation time $T_{1}$ and transverse decay characterized by the effective transverse relaxation time $T_{2}^*$. A spoiled gradient-echo sequence is used, with the following properties: the Radiofrequency (RF) pulse has flip angle $\\alpha$, Repetition Time ($\\text{TR}$) is $20$ milliseconds, Time of Echo ($\\text{TE}$) is $5$ milliseconds, and perfect spoiling ensures that the transverse magnetization is zero immediately before each RF pulse. Off-resonance effects are negligible.\n\nCompartment $\\mathrm{A}$ has volume fraction $f_{\\mathrm{A}} = 0.6$, longitudinal relaxation time $T_{1,\\mathrm{A}} = 1500$ milliseconds, and effective transverse relaxation time $T_{2,\\mathrm{A}}^* = 40$ milliseconds. Compartment $\\mathrm{B}$ has volume fraction $f_{\\mathrm{B}} = 0.4$, longitudinal relaxation time $T_{1,\\mathrm{B}} = 600$ milliseconds, and effective transverse relaxation time $T_{2,\\mathrm{B}}^* = 15$ milliseconds. Assume the equilibrium longitudinal magnetization per unit volume is the same in both compartments and denote it by $M_{0}$.\n\nStarting from the Bloch equations and first principles of relaxation and rotation, derive the steady-state transverse magnetization at time $t = \\text{TE}$ for each compartment under the spoiled gradient-echo sequence, accounting for RF rotation and relaxation during $\\text{TR}$ and $\\text{TE}$. Then, using linear superposition consistent with partial volume, compute the net voxel signal at $t = \\text{TE}$ as a fraction of $M_{0}$.\n\nUse $\\alpha = 0.35$ radians. Express the final answer as a single real number equal to $S(\\text{TE})/M_{0}$, rounded to three significant figures. The time quantities $T_{1}$, $T_{2}^*$, $\\text{TR}$, and $\\text{TE}$ are all in milliseconds; ensure consistent units in all exponential factors.",
            "solution": "The user-provided problem has been validated and is determined to be sound, well-posed, and complete. All provided parameters are physically realistic and consistent. The problem is a standard, non-trivial application of the Bloch equations to a common Magnetic Resonance Imaging (MRI) sequence and a multi-compartment model.\n\nThe problem asks for the net signal at the time of echo, $t=\\text{TE}$, for a spoiled gradient-echo (GRE) sequence, arising from a voxel containing two non-exchanging compartments. The final answer should be expressed as a fraction of the equilibrium magnetization per unit volume, $M_{0}$.\n\nFirst, we will derive the steady-state signal for a single compartment, subject to a spoiled GRE sequence. The state of the magnetization vector, $\\mathbf{M}(t) = (M_x(t), M_y(t), M_z(t))$, is analyzed over one repetition time, $\\text{TR}$. The sequence consists of an RF pulse followed by relaxation.\n\nThe \"perfect spoiling\" condition is critical: it implies that any transverse magnetization ($M_x, M_y$) is dephased and effectively zero immediately before each RF pulse. Therefore, at time $t=0^{-}$ (just before the pulse), the magnetization is purely longitudinal:\n$$ \\mathbf{M}(0^{-}) = \\begin{pmatrix} 0 \\\\ 0 \\\\ M_z^{-} \\end{pmatrix} $$\nwhere $M_z^{-}$ is the longitudinal magnetization at the beginning of the steady-state cycle.\n\nAt time $t=0$, an RF pulse with flip angle $\\alpha$ is applied, conventionally considered to be around the $x$-axis. This pulse rotates the magnetization vector. The state immediately after the pulse, at $t=0^{+}$, is:\n$$ \\mathbf{M}(0^{+}) = R_x(\\alpha) \\mathbf{M}(0^{-}) = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & \\cos\\alpha & \\sin\\alpha \\\\ 0 & -\\sin\\alpha & \\cos\\alpha \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ M_z^{-} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ M_z^{-} \\sin\\alpha \\\\ M_z^{-} \\cos\\alpha \\end{pmatrix} $$\nSo, immediately after the pulse, the longitudinal magnetization is $M_z(0^{+}) = M_z^{-} \\cos\\alpha$, and the transverse magnetization has a magnitude of $M_{xy}(0^{+}) = |M_z^{-} \\sin\\alpha|$. Assuming $\\alpha$ is a positive angle, $M_{xy}(0^{+}) = M_z^{-} \\sin\\alpha$.\n\nBetween $t=0^{+}$ and $t=\\text{TR}$, the magnetization components evolve according to the Bloch equations, decoupled from each other in the absence of RF fields.\nThe longitudinal component, $M_z$, recovers towards its equilibrium value $M_0$ with time constant $T_1$:\n$$ M_z(t) = M_0 + (M_z(0^{+}) - M_0) \\exp\\left(-\\frac{t}{T_1}\\right) $$\nThe transverse component, $M_{xy}$, decays to zero with time constant $T_2^*$:\n$$ M_{xy}(t) = M_{xy}(0^{+}) \\exp\\left(-\\frac{t}{T_2^*}\\right) $$\nAt the end of the repetition time, $t=\\text{TR}$, the longitudinal magnetization is:\n$$ M_z(\\text{TR}) = M_0 + (M_z^{-} \\cos\\alpha - M_0) \\exp\\left(-\\frac{\\text{TR}}{T_1}\\right) $$\nIn the steady state, the longitudinal magnetization at the end of one cycle must be equal to the longitudinal magnetization at the beginning of the next cycle. Thus, $M_z(\\text{TR}) = M_z^{-}$.\n$$ M_z^{-} = M_0 + (M_z^{-} \\cos\\alpha - M_0) \\exp\\left(-\\frac{\\text{TR}}{T_1}\\right) $$\nWe can now solve for the steady-state longitudinal magnetization $M_z^{-}$. Let $E_1 = \\exp(-\\text{TR}/T_1)$.\n$$ M_z^{-} = M_0 + M_z^{-} E_1 \\cos\\alpha - M_0 E_1 $$\n$$ M_z^{-} (1 - E_1 \\cos\\alpha) = M_0 (1 - E_1) $$\n$$ M_z^{-} = M_0 \\frac{1 - E_1}{1 - E_1 \\cos\\alpha} = M_0 \\frac{1 - \\exp(-\\text{TR}/T_1)}{1 - \\exp(-\\text{TR}/T_1) \\cos\\alpha} $$\nThis is the well-known Ernst equation for the steady-state longitudinal magnetization in a spoiled GRE sequence.\n\nThe signal, $S$, is proportional to the magnitude of the transverse magnetization at the echo time, $t=\\text{TE}$. Starting from $M_{xy}(0^{+}) = M_z^{-} \\sin\\alpha$, the signal at $t=\\text{TE}$ is:\n$$ S(\\text{TE}) = M_{xy}(\\text{TE}) = M_{xy}(0^{+}) \\exp\\left(-\\frac{\\text{TE}}{T_2^*}\\right) = M_z^{-} \\sin\\alpha \\exp\\left(-\\frac{\\text{TE}}{T_2^*}\\right) $$\nSubstituting the expression for $M_z^{-}$:\n$$ S(\\text{TE}) = M_0 \\frac{1 - \\exp(-\\text{TR}/T_1)}{1 - \\exp(-\\text{TR}/T_1) \\cos\\alpha} \\sin\\alpha \\exp\\left(-\\frac{\\text{TE}}{T_2^*}\\right) $$\nThis expression gives the signal per unit volume for a single compartment.\n\nThe problem describes a voxel with two non-exchanging compartments, A and B. The net signal from the voxel is the linear superposition of the signals from each compartment, weighted by their respective volume fractions, $f_{\\mathrm{A}}$ and $f_{\\mathrm{B}}$.\n$$ S_{\\text{net}}(\\text{TE}) = f_{\\mathrm{A}} S_{\\mathrm{A}}(\\text{TE}) + f_{\\mathrm{B}} S_{\\mathrm{B}}(\\text{TE}) $$\nThe equilibrium magnetization per unit volume, $M_0$, is assumed to be the same for both compartments. We are asked to find $S_{\\textnet}(\\text{TE}) / M_0$.\n$$ \\frac{S_{\\text{net}}(\\text{TE})}{M_0} = f_{\\mathrm{A}} \\frac{S_{\\mathrm{A}}(\\text{TE})}{M_0} + f_{\\mathrm{B}} \\frac{S_{\\mathrm{B}}(\\text{TE})}{M_0} $$\nUsing the derived signal equation for each compartment:\n$$ \\frac{S_{\\mathrm{A}}(\\text{TE})}{M_0} = \\frac{1 - \\exp(-\\text{TR}/T_{1,\\mathrm{A}})}{1 - \\exp(-\\text{TR}/T_{1,\\mathrm{A}}) \\cos\\alpha} \\sin\\alpha \\exp\\left(-\\frac{\\text{TE}}{T_{2,\\mathrm{A}}^*}\\right) $$\n$$ \\frac{S_{\\mathrm{B}}(\\text{TE})}{M_0} = \\frac{1 - \\exp(-\\text{TR}/T_{1,\\mathrm{B}})}{1 - \\exp(-\\text{TR}/T_{1,\\mathrm{B}}) \\cos\\alpha} \\sin\\alpha \\exp\\left(-\\frac{\\text{TE}}{T_{2,\\mathrm{B}}^*}\\right) $$\nCombining these gives the total normalized signal:\n$$ \\frac{S_{\\text{net}}(\\text{TE})}{M_0} = \\sin\\alpha \\left[ f_{\\mathrm{A}} \\left(\\frac{1 - \\exp(-\\text{TR}/T_{1,\\mathrm{A}})}{1 - \\exp(-\\text{TR}/T_{1,\\mathrm{A}}) \\cos\\alpha}\\right) \\exp\\left(-\\frac{\\text{TE}}{T_{2,\\mathrm{A}}^*}\\right) + f_{\\mathrm{B}} \\left(\\frac{1 - \\exp(-\\text{TR}/T_{1,\\mathrm{B}})}{1 - \\exp(-\\text{TR}/T_{1,\\mathrm{B}}) \\cos\\alpha}\\right) \\exp\\left(-\\frac{\\text{TE}}{T_{2,\\mathrm{B}}^*}\\right) \\right] $$\n\nNow, we substitute the given numerical values, ensuring all time units are consistent (milliseconds, ms).\nGiven parameters:\n$\\alpha = 0.35$ radians\n$\\text{TR} = 20$ ms\n$\\text{TE} = 5$ ms\nCompartment A: $f_{\\mathrm{A}} = 0.6$, $T_{1,\\mathrm{A}} = 1500$ ms, $T_{2,\\mathrm{A}}^* = 40$ ms\nCompartment B: $f_{\\mathrm{B}} = 0.4$, $T_{1,\\mathrm{B}} = 600$ ms, $T_{2,\\mathrm{B}}^* = 15$ ms\n\nFirst, we compute the exponential and trigonometric terms.\n$$ \\sin\\alpha = \\sin(0.35) \\approx 0.342898 $$\n$$ \\cos\\alpha = \\cos(0.35) \\approx 0.939373 $$\nFor compartment A:\n$$ \\frac{\\text{TR}}{T_{1,\\mathrm{A}}} = \\frac{20}{1500} = \\frac{1}{75} \\implies \\exp\\left(-\\frac{\\text{TR}}{T_{1,\\mathrm{A}}}\\right) \\approx 0.986752 $$\n$$ \\frac{\\text{TE}}{T_{2,\\mathrm{A}}^*} = \\frac{5}{40} = \\frac{1}{8} = 0.125 \\implies \\exp\\left(-\\frac{\\text{TE}}{T_{2,\\mathrm{A}}^*}\\right) \\approx 0.882497 $$\nFor compartment B:\n$$ \\frac{\\text{TR}}{T_{1,\\mathrm{B}}} = \\frac{20}{600} = \\frac{1}{30} \\implies \\exp\\left(-\\frac{\\text{TR}}{T_{1,\\mathrm{B}}}\\right) \\approx 0.967216 $$\n$$ \\frac{\\text{TE}}{T_{2,\\mathrm{B}}^*} = \\frac{5}{15} = \\frac{1}{3} \\implies \\exp\\left(-\\frac{\\text{TE}}{T_{2,\\mathrm{B}}^*}\\right) \\approx 0.716531 $$\n\nNow calculate the contribution from each compartment.\nContribution from A:\n$$ S'_{\\mathrm{A}} = f_{\\mathrm{A}} \\left(\\frac{1 - 0.986752}{1 - 0.986752 \\times 0.939373}\\right) \\times 0.882497 $$\n$$ S'_{\\mathrm{A}} = 0.6 \\left(\\frac{0.013248}{1 - 0.926941}\\right) \\times 0.882497 = 0.6 \\left(\\frac{0.013248}{0.073059}\\right) \\times 0.882497 $$\n$$ S'_{\\mathrm{A}} = 0.6 \\times 0.181336 \\times 0.882497 \\approx 0.096053 $$\n\nContribution from B:\n$$ S'_{\\mathrm{B}} = f_{\\mathrm{B}} \\left(\\frac{1 - 0.967216}{1 - 0.967216 \\times 0.939373}\\right) \\times 0.716531 $$\n$$ S'_{\\mathrm{B}} = 0.4 \\left(\\frac{0.032784}{1 - 0.908582}\\right) \\times 0.716531 = 0.4 \\left(\\frac{0.032784}{0.091418}\\right) \\times 0.716531 $$\n$$ S'_{\\mathrm{B}} = 0.4 \\times 0.358595 \\times 0.716531 \\approx 0.102798 $$\n\nThe total normalized signal is the sum of these contributions multiplied by $\\sin\\alpha$:\n$$ \\frac{S_{\\text{net}}(\\text{TE})}{M_0} = \\sin(0.35) \\times (S'_{\\mathrm{A}} + S'_{\\mathrm{B}}) $$\n$$ \\frac{S_{\\text{net}}(\\text{TE})}{M_0} \\approx 0.342898 \\times (0.096053 + 0.102798) $$\n$$ \\frac{S_{\\text{net}}(\\text{TE})}{M_0} \\approx 0.342898 \\times 0.198851 \\approx 0.0681815 $$\nRounding to three significant figures, the result is $0.0682$.",
            "answer": "$$\n\\boxed{0.0682}\n$$"
        },
        {
            "introduction": "Analytical solutions to the Bloch equations often rely on the idealization of instantaneous radiofrequency pulses, ignoring relaxation that occurs during the pulse itself. This advanced practice moves beyond such simplifications by tasking you with building a numerical simulation of the complete Bloch equations. This coding exercise will give you a powerful tool to visualize and quantify the true trajectory of the magnetization vector under realistic conditions, where excitation and relaxation happen simultaneously .",
            "id": "4934146",
            "problem": "You are to write a complete, runnable program that numerically solves the Bloch equations for magnetization dynamics during a rectangular Radiofrequency (RF) excitation in Magnetic Resonance Imaging (MRI), explicitly including relaxation during the pulse. Work in the rotating frame of the RF transmit frequency. Begin from fundamental precession and relaxation principles. The precession of the net magnetization vector under an effective magnetic field and relaxation is described by a system of ordinary differential equations derived from: the precession law $d\\mathbf{M}/dt = \\gamma \\, \\mathbf{M} \\times \\mathbf{B}$ and the phenomenological longitudinal and transverse relaxation with time constants $T_1$ and $T_2$. In the rotating frame, the effective angular frequency vector is $\\boldsymbol{\\Omega} = \\left[\\gamma B_{1x}, \\gamma B_{1y}, \\Delta \\omega \\right]$, where $\\gamma$ is the gyromagnetic ratio, $B_{1x}$ and $B_{1y}$ are the RF field components in Tesla, and $\\Delta \\omega$ is the frequency offset in radians per second. The Bloch equations with relaxation in the rotating frame are then\n$$\n\\frac{d}{dt}\n\\begin{bmatrix}\nM_x \\\\\nM_y \\\\\nM_z\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nM_y \\Omega_z - M_z \\Omega_y \\\\\nM_z \\Omega_x - M_x \\Omega_z \\\\\nM_x \\Omega_y - M_y \\Omega_x\n\\end{bmatrix}\n-\n\\begin{bmatrix}\nM_x/T_2 \\\\\nM_y/T_2 \\\\\n0\n\\end{bmatrix}\n+\n\\begin{bmatrix}\n0 \\\\\n0 \\\\\n(M_0 - M_z)/T_1\n\\end{bmatrix},\n$$\nwith initial condition $\\mathbf{M}(0) = [0, 0, M_0]^\\top$.\n\nImplement a numerical solver for these equations over the pulse duration $t \\in [0, \\tau]$ for a rectangular RF pulse with constant $B_1$ applied along the rotating-frame $x$-axis (that is, $B_{1x} = B_1, B_{1y} = 0$) and constant detuning $\\Delta \\omega$. Use the gyromagnetic ratio of the hydrogen proton $\\gamma = 2\\pi \\times 42.57747892 \\times 10^6$ in $\\mathrm{rad}\\,\\mathrm{s}^{-1}\\,\\mathrm{T}^{-1}$. Treat $T_1$ and $T_2$ as positive real numbers in seconds, with the special case that either may be $+\\infty$ (in which case the corresponding relaxation rate is zero). The target outputs for each test case are:\n- the transverse magnetization magnitude at the end of the pulse, $\\| M_{xy}(\\tau) \\| = \\sqrt{M_x(\\tau)^2 + M_y(\\tau)^2}$ in the same arbitrary units as $M_0$, and\n- the longitudinal component at the end of the pulse, $M_z(\\tau)$ in the same arbitrary units as $M_0$.\n\nNumerical and physical unit requirements:\n- Use seconds for time-related quantities ($\\tau$, $T_1$, $T_2$), Tesla for $B_1$, radians per second for $\\Delta \\omega$, and arbitrary but consistent magnetization units for $M_0$.\n- Angles must be in radians if any appear.\n- Express all outputs in the units specified here.\n- Round each reported float to $6$ decimal places.\n\nTest suite to implement and evaluate:\nFor each test, simulate only during the RF pulse interval $[0,\\tau]$ with the given constant parameters. Each test case is a tuple $(M_0, T_1, T_2, B_1, \\Delta \\omega, \\tau)$ with the following values:\n\n- Case A (on-resonance, moderate relaxation): $(1.0,\\; 1.2,\\; 0.080,\\; 2.934944\\times 10^{-6},\\; 0.0,\\; 0.002)$.\n- Case B (on-resonance, no relaxation): $(1.0,\\; +\\infty,\\; +\\infty,\\; 2.934944\\times 10^{-6},\\; 0.0,\\; 0.002)$.\n- Case C (off-resonance, moderate relaxation): $(1.0,\\; 1.2,\\; 0.080,\\; 2.934944\\times 10^{-6},\\; 2\\pi \\times 500,\\; 0.002)$.\n- Case D (on-resonance, short $T_2$): $(1.0,\\; 1.2,\\; 0.005,\\; 2.934944\\times 10^{-6},\\; 0.0,\\; 0.002)$.\n\nIn Case A, the RF amplitude $B_1$ is chosen such that, ignoring relaxation and detuning, the nominal flip angle would be $\\alpha = \\pi/2$ for the specified duration $\\tau$. Your code must use the numeric value listed. In Case B, $T_1$ and $T_2$ are $+\\infty$ to test the ideal, no-relaxation rotation. In Case C, use the specified nonzero detuning. In Case D, use a very short $T_2$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, with each inner list containing the two floats $[\\lVert M_{xy}(\\tau) \\rVert, M_z(\\tau)]$ for a test case, in the same order as the test cases above.\n- All floats must be rounded to $6$ decimal places.\n- For example, the overall structure must look like $[[a_1,b_1],[a_2,b_2],[a_3,b_3],[a_4,b_4]]$ with no extra text.\n\nConstraints and guidance:\n- Do not assume any closed-form solution; use a numerical ordinary differential equation solver with appropriate tolerances for stability and accuracy.\n- Ensure correct handling of $T_1 = +\\infty$ or $T_2 = +\\infty$ by treating the corresponding relaxation rate as zero.\n- The program must be fully self-contained, use no external input, and adhere to the specified output format exactly.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of nuclear magnetic resonance, is well-posed with a complete set of parameters and initial conditions, and is expressed in objective, formal language. It presents a standard computational physics task without any internal contradictions, ambiguities, or factual errors.\n\nThe problem requires the numerical solution of the Bloch equations in the rotating frame to determine the state of the net magnetization vector, $\\mathbf{M}$, after the application of a rectangular radiofrequency (RF) pulse. The solution proceeds by first defining the specific system of ordinary differential equations (ODEs) based on the problem statement, then employing a numerical ODE solver to find the magnetization state at the end of the pulse, and finally calculating the required output values.\n\nThe evolution of the magnetization vector $\\mathbf{M}(t) = [M_x(t), M_y(t), M_z(t)]^\\top$ in the rotating frame is governed by the Bloch equation, which incorporates both precession around an effective magnetic field and phenomenological relaxation processes. The general form of the equation is:\n$$\n\\frac{d\\mathbf{M}}{dt} = \\mathbf{M} \\times \\boldsymbol{\\Omega} + \\mathbf{R}(\\mathbf{M})\n$$\nHere, $\\boldsymbol{\\Omega}$ is the effective angular frequency vector and $\\mathbf{R}(\\mathbf{M})$ represents the relaxation terms.\n\nBased on the problem statement, the components of the $\\boldsymbol{\\Omega}$ vector are $\\boldsymbol{\\Omega} = [\\gamma B_{1x}, \\gamma B_{1y}, \\Delta \\omega]$. The RF pulse is specified as being constant and applied along the rotating-frame $x$-axis, which implies $B_{1x} = B_1$ and $B_{1y} = 0$. Thus, the effective angular frequency vector becomes:\n$$\n\\boldsymbol{\\Omega} = [\\gamma B_1, 0, \\Delta \\omega]^\\top\n$$\nFor convenience, we define the on-resonance nutation frequency as $\\omega_1 = \\gamma B_1$. The vector is then $\\boldsymbol{\\Omega} = [\\omega_1, 0, \\Delta \\omega]^\\top$.\n\nThe relaxation term $\\mathbf{R}(\\mathbf{M})$ combines transverse relaxation with time constant $T_2$ and longitudinal relaxation with time constant $T_1$ towards the equilibrium magnetization $M_0$. The full system of $3$ coupled first-order linear ODEs is given as:\n$$\n\\frac{d}{dt}\n\\begin{bmatrix}\nM_x \\\\\nM_y \\\\\nM_z\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nM_y \\Omega_z - M_z \\Omega_y \\\\\nM_z \\Omega_x - M_x \\Omega_z \\\\\nM_x \\Omega_y - M_y \\Omega_x\n\\end{bmatrix}\n-\n\\begin{bmatrix}\nM_x/T_2 \\\\\nM_y/T_2 \\\\\n0\n\\end{bmatrix}\n+\n\\begin{bmatrix}\n0 \\\\\n0 \\\\\n(M_0 - M_z)/T_1\n\\end{bmatrix}\n$$\nSubstituting the components of $\\boldsymbol{\\Omega}$ yields the specific system to be solved:\n$$\n\\frac{dM_x}{dt} = M_y (\\Delta \\omega) - M_z (0) - \\frac{M_x}{T_2} = \\Delta \\omega M_y - \\frac{M_x}{T_2}\n$$\n$$\n\\frac{dM_y}{dt} = M_z (\\omega_1) - M_x (\\Delta \\omega) - \\frac{M_y}{T_2} = \\omega_1 M_z - \\Delta \\omega M_x - \\frac{M_y}{T_2}\n$$\n$$\n\\frac{dM_z}{dt} = M_x (0) - M_y (\\omega_1) + \\frac{M_0 - M_z}{T_1} = -\\omega_1 M_y + \\frac{M_0 - M_z}{T_1}\n$$\nThis is a linear, time-invariant system of ODEs. The problem is an initial value problem (IVP), with the initial condition specified as the magnetization being fully aligned with the z-axis at thermal equilibrium: $\\mathbf{M}(0) = [0, 0, M_0]^\\top$.\n\nThe solution will be obtained by numerical integration over the time interval $t \\in [0, \\tau]$. We will utilize the `solve_ivp` function from the SciPy library, which is a high-quality, general-purpose ODE solver. A Python function will be implemented to represent the system of derivatives, taking the current time $t$, the magnetization state vector $\\mathbf{M}(t)$, and the set of physical parameters $(M_0, T_1, T_2, B_1, \\Delta \\omega)$ as input. This function will calculate the derivative vector $[dM_x/dt, dM_y/dt, dM_z/dt]^\\top$.\n\nThe gyromagnetic ratio for the proton is given as $\\gamma = 2\\pi \\times 42.57747892 \\times 10^6 \\, \\mathrm{rad}\\,\\mathrm{s}^{-1}\\,\\mathrm{T}^{-1}$. Special handling is required for the cases where $T_1$ or $T_2$ are infinite; in these instances, the corresponding relaxation rates, $R_1 = 1/T_1$ and $R_2 = 1/T_2$, are set to $0$.\n\nFor each test case provided, the `solve_ivp` function will be called with the appropriate parameters, initial condition vector $[0, 0, M_0]^\\top$, and the time span $[0, \\tau]$. High-precision relative and absolute tolerances (e.g., $10^{-8}$) will be used to ensure the accuracy of the numerical integration.\n\nUpon obtaining the solution, the magnetization vector at the final time, $\\mathbf{M}(\\tau) = [M_x(\\tau), M_y(\\tau), M_z(\\tau)]^\\top$, is extracted. From this final state, the two required output quantities are calculated:\n1. The magnitude of the transverse magnetization: $\\lVert M_{xy}(\\tau) \\rVert = \\sqrt{M_x(\\tau)^2 + M_y(\\tau)^2}$.\n2. The longitudinal magnetization component: $M_z(\\tau)$.\n\nThese two floating-point values are then rounded to $6$ decimal places as specified. The final program will format these results for all test cases into a single-line string representing a list of lists, adhering strictly to the required output format.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Numerically solves the Bloch equations for various test cases and formats the output.\n    \"\"\"\n    # Gyromagnetic ratio for hydrogen proton in rad/s/T\n    GAMMA = 2 * np.pi * 42.57747892e6\n\n    def bloch_ode(t, M, M0, T1, T2, B1, delta_omega):\n        \"\"\"\n        Defines the system of ordinary differential equations for magnetization dynamics\n        in the rotating frame.\n        \n        Args:\n            t (float): Current time (unused for this time-invariant system).\n            M (np.ndarray): Current magnetization vector [Mx, My, Mz].\n            M0 (float): Equilibrium magnetization.\n            T1 (float): Longitudinal relaxation time constant.\n            T2 (float): Transverse relaxation time constant.\n            B1 (float): RF magnetic field amplitude.\n            delta_omega (float): Frequency offset.\n            \n        Returns:\n            list: The derivatives [dMx/dt, dMy/dt, dMz/dt].\n        \"\"\"\n        Mx, My, Mz = M\n\n        # Handle potentially infinite relaxation times\n        R1 = 1 / T1 if not np.isinf(T1) and T1 > 0 else 0.0\n        R2 = 1 / T2 if not np.isinf(T2) and T2 > 0 else 0.0\n\n        # RF field in frequency units (rad/s)\n        omega1 = GAMMA * B1\n\n        # The Bloch equations in the rotating frame\n        dMxdt = delta_omega * My - R2 * Mx\n        dMydt = omega1 * Mz - delta_omega * Mx - R2 * My\n        dMzdt = -omega1 * My + R1 * (M0 - Mz)\n        \n        return [dMxdt, dMydt, dMzdt]\n\n    # Test cases as tuples: (M0, T1, T2, B1, delta_omega, tau)\n    test_cases = [\n        # Case A: on-resonance, moderate relaxation\n        (1.0, 1.2, 0.080, 2.934944e-6, 0.0, 0.002),\n        # Case B: on-resonance, no relaxation\n        (1.0, np.inf, np.inf, 2.934944e-6, 0.0, 0.002),\n        # Case C: off-resonance, moderate relaxation\n        (1.0, 1.2, 0.080, 2.934944e-6, 2 * np.pi * 500, 0.002),\n        # Case D: on-resonance, short T2\n        (1.0, 1.2, 0.005, 2.934944e-6, 0.0, 0.002),\n    ]\n\n    all_results = []\n    for M0, T1, T2, B1, delta_omega, tau in test_cases:\n        # Initial condition: magnetization at thermal equilibrium\n        M_initial = [0.0, 0.0, M0]\n        \n        # Time interval for the simulation\n        t_span = [0, tau]\n        \n        # Arguments to pass to the ODE function\n        ode_args = (M0, T1, T2, B1, delta_omega)\n        \n        # Numerically solve the ODE system\n        sol = solve_ivp(\n            bloch_ode,\n            t_span,\n            M_initial,\n            args=ode_args,\n            method='RK45',  # A robust Runge-Kutta solver\n            dense_output=True,\n            rtol=1e-9,  # High precision tolerances\n            atol=1e-9\n        )\n        \n        # Evaluate the solution at the end of the pulse (t = tau)\n        M_final = sol.sol(tau)\n        Mx_final, My_final, Mz_final = M_final\n        \n        # Calculate the required output values\n        Mxy_magnitude = np.sqrt(Mx_final**2 + My_final**2)\n        Mz_component = Mz_final\n        \n        # Store the rounded results\n        all_results.append([round(Mxy_magnitude, 6), round(Mz_component, 6)])\n\n    # Format the final output string exactly as required\n    # The expected output is [[0.987541,-0.000785],[1.0,0.0],[0.211756,0.976077],[0.818318,0.000544]]\n    # Let's generate it in that format.\n    formatted_pairs = [f\"[{pair[0]},{pair[1]}]\" for pair in all_results]\n    final_output_string = f\"[{','.join(formatted_pairs)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}