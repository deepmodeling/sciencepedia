{
    "hands_on_practices": [
        {
            "introduction": "The foundation of MRI rests on the precise relationship between magnetic field strength and the resonance frequency of nuclear spins, as described by the Larmor equation. This first exercise provides a quantitative link between imperfections in the main magnetic field, often specified in parts per million (ppm), and the resulting spread of resonance frequencies across the imaging volume. By performing this calculation , you will gain a concrete understanding of why even tiny field variations are a significant concern for image quality.",
            "id": "4898475",
            "problem": "In Magnetic Resonance Imaging (MRI), the local resonance frequency of nuclear spins is determined by the Larmor relationship between angular frequency and magnetic field. Consider a scanner with nominal static field $B_{0}$ and small spatial deviations $\\Delta B(\\mathbf{r})$ around $B_{0}$ due to imperfect homogeneity. Assume the spins are hydrogen protons, with gyromagnetic ratio $\\gamma$, and recall that the ordinary frequency is related to the angular frequency by division by $2\\pi$. \n\n(a) Starting from the Larmor angular frequency relation, derive an expression for the local resonance frequency offset $\\Delta f(\\mathbf{r})$ in terms of $\\Delta B(\\mathbf{r})$ and fundamental constants.\n\n(b) Magnetic field inhomogeneity is often specified in parts per million (ppm) relative to $B_{0}$. If the inhomogeneity is bounded by $\\pm p$ ppm, express the maximum magnitude of the frequency offset and the corresponding peak-to-peak frequency spread across the object in terms of $p$, $B_{0}$, and physical constants.\n\n(c) For a $B_{0} = 3 \\ \\mathrm{T}$ scanner with hydrogen nuclei (so that $\\gamma / (2\\pi) \\approx 42.58 \\ \\mathrm{MHz/T}$), and a field inhomogeneity of $\\pm 2$ parts per million (ppm), compute the peak-to-peak frequency spread. Express your final answer in $\\mathrm{Hz}$ and round your final answer to four significant figures.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It is based on the fundamental principles of nuclear magnetic resonance and uses standard terminology and realistic physical parameters. Therefore, the problem is deemed valid and a full solution is warranted.\n\nThe solution is developed in three parts as requested.\n\n(a) Derivation of the local resonance frequency offset $\\Delta f(\\mathbf{r})$\n\nThe Larmor relationship describes the angular frequency of precession, $\\omega$, of a nuclear spin with gyromagnetic ratio $\\gamma$ in a magnetic field of strength $B$. The relationship is:\n$$ \\omega = \\gamma B $$\nIn an MRI scanner, the total magnetic field at a spatial location $\\mathbf{r}$ is the sum of the nominal static field $B_0$ and a small, position-dependent deviation $\\Delta B(\\mathbf{r})$:\n$$ B(\\mathbf{r}) = B_0 + \\Delta B(\\mathbf{r}) $$\nConsequently, the local Larmor angular frequency also becomes position-dependent:\n$$ \\omega(\\mathbf{r}) = \\gamma B(\\mathbf{r}) = \\gamma (B_0 + \\Delta B(\\mathbf{r})) $$\nExpanding this expression gives:\n$$ \\omega(\\mathbf{r}) = \\gamma B_0 + \\gamma \\Delta B(\\mathbf{r}) $$\nWe can identify the nominal angular frequency, $\\omega_0$, corresponding to the static field $B_0$, as $\\omega_0 = \\gamma B_0$. The local angular frequency offset, $\\Delta \\omega(\\mathbf{r})$, is the difference between the local frequency and the nominal frequency:\n$$ \\Delta \\omega(\\mathbf{r}) = \\omega(\\mathbf{r}) - \\omega_0 = (\\gamma B_0 + \\gamma \\Delta B(\\mathbf{r})) - \\gamma B_0 = \\gamma \\Delta B(\\mathbf{r}) $$\nThe problem asks for the offset in ordinary frequency, $f$, which is related to angular frequency by $f = \\omega / (2\\pi)$. The frequency offset in Hertz, $\\Delta f(\\mathbf{r})$, is therefore:\n$$ \\Delta f(\\mathbf{r}) = \\frac{\\Delta \\omega(\\mathbf{r})}{2\\pi} $$\nSubstituting the expression for $\\Delta \\omega(\\mathbf{r})$ yields the desired relationship:\n$$ \\Delta f(\\mathbf{r}) = \\frac{\\gamma}{2\\pi} \\Delta B(\\mathbf{r}) $$\n\n(b) Frequency offset expressions based on inhomogeneity in ppm\n\nMagnetic field inhomogeneity is often specified in parts per million (ppm) relative to the main field $B_0$. An inhomogeneity bounded by $\\pm p$ ppm means that the magnitude of the field deviation, $|\\Delta B(\\mathbf{r})|$, does not exceed $p$ millionths of $B_0$. Mathematically:\n$$ |\\Delta B(\\mathbf{r})| \\leq \\frac{p}{10^6} B_0 = p \\times 10^{-6} B_0 $$\nThe maximum magnitude of the frequency offset, $|\\Delta f(\\mathbf{r})|_{\\text{max}}$, can be found using the result from part (a):\n$$ |\\Delta f(\\mathbf{r})|_{\\text{max}} = \\left| \\frac{\\gamma}{2\\pi} \\Delta B(\\mathbf{r}) \\right|_{\\text{max}} = \\frac{\\gamma}{2\\pi} |\\Delta B(\\mathbf{r})|_{\\text{max}} $$\nSubstituting the maximum field deviation, we get:\n$$ |\\Delta f(\\mathbf{r})|_{\\text{max}} = \\frac{\\gamma}{2\\pi} (p \\times 10^{-6} B_0) $$\nThe peak-to-peak frequency spread, $\\Delta f_{\\text{p-p}}$, is the total range of frequency offsets across the object. Since the field deviation $\\Delta B(\\mathbf{r})$ spans the range from a minimum of $-p \\times 10^{-6} B_0$ to a maximum of $+p \\times 10^{-6} B_0$, the frequency offset $\\Delta f(\\mathbf{r})$ spans a corresponding range.\nThe maximum frequency offset is:\n$$ \\Delta f_{\\text{max}} = \\frac{\\gamma}{2\\pi} (p \\times 10^{-6} B_0) $$\nThe minimum frequency offset is:\n$$ \\Delta f_{\\text{min}} = \\frac{\\gamma}{2\\pi} (-p \\times 10^{-6} B_0) = - \\frac{\\gamma}{2\\pi} (p \\times 10^{-6} B_0) $$\nThe peak-to-peak spread is the difference between these extreme values:\n$$ \\Delta f_{\\text{p-p}} = \\Delta f_{\\text{max}} - \\Delta f_{\\text{min}} = \\left(\\frac{\\gamma}{2\\pi} p \\times 10^{-6} B_0\\right) - \\left(-\\frac{\\gamma}{2\\pi} p \\times 10^{-6} B_0\\right) $$\n$$ \\Delta f_{\\text{p-p}} = 2 \\left( \\frac{\\gamma}{2\\pi} \\right) p \\times 10^{-6} B_0 $$\n\n(c) Numerical calculation of the peak-to-peak frequency spread\n\nWe are given the following values:\n- Main magnetic field: $B_0 = 3 \\ \\mathrm{T}$\n- Modified gyromagnetic ratio for hydrogen: $\\frac{\\gamma}{2\\pi} \\approx 42.58 \\ \\mathrm{MHz/T} = 42.58 \\times 10^6 \\ \\mathrm{Hz/T}$\n- Inhomogeneity bound: $p = 2$ (for $\\pm 2$ ppm)\n\nWe use the expression for the peak-to-peak frequency spread derived in part (b):\n$$ \\Delta f_{\\text{p-p}} = 2 \\left( \\frac{\\gamma}{2\\pi} \\right) p \\times 10^{-6} B_0 $$\nSubstituting the numerical values:\n$$ \\Delta f_{\\text{p-p}} = 2 \\times (42.58 \\times 10^6 \\ \\mathrm{Hz/T}) \\times 2 \\times 10^{-6} \\times (3 \\ \\mathrm{T}) $$\nThe terms involving powers of $10$ cancel each other out ($10^6 \\times 10^{-6} = 10^0 = 1$). The units of Tesla ($\\mathrm{T}$) and per-Tesla ($\\mathrm{T}^{-1}$) also cancel, leaving the result in Hertz ($\\mathrm{Hz}$), as expected.\n$$ \\Delta f_{\\text{p-p}} = (2 \\times 42.58 \\times 2 \\times 3) \\ \\mathrm{Hz} $$\n$$ \\Delta f_{\\text{p-p}} = 12 \\times 42.58 \\ \\mathrm{Hz} $$\n$$ \\Delta f_{\\text{p-p}} = 510.96 \\ \\mathrm{Hz} $$\nThe problem requires the final answer to be rounded to four significant figures. The fifth significant digit is $6$, so we round up the fourth significant digit ($9$).\n$$ \\Delta f_{\\text{p-p}} \\approx 511.0 \\ \\mathrm{Hz} $$",
            "answer": "$$\n\\boxed{511.0}\n$$"
        },
        {
            "introduction": "Before an inhomogeneous field can be corrected, it must first be accurately measured. This practice explores a standard MRI technique for creating a \"field map\" that spatially details the off-resonance caused by inhomogeneity. You will derive how the phase difference between two echoes in a gradient echo sequence directly relates to the local field deviation , and tackle the common signal processing challenge of phase unwrapping to recover a continuous map.",
            "id": "4898457",
            "problem": "A Magnetic Resonance Imaging (MRI) system is used to estimate the static magnetic field inhomogeneity map $\\,\\Delta B(\\mathbf{r})\\,$ for shimming by acquiring a dual-echo gradient echo dataset at two echo times $\\,\\mathrm{TE}_1\\,$ and $\\,\\mathrm{TE}_2\\,$. The goal is to relate the spatial phase difference of the reconstructed complex images between the two echoes to the local off-resonance $\\,\\Delta B(\\mathbf{r})\\,$ and to address the need for phase unwrapping to recover a continuous field map.\n\nStarting from first principles, use the Larmor precession law and the definition of the complex MRI signal phase to derive the relationship between the dual-echo phase difference and the local off-resonance field. Specifically, consider a voxel at position $\\,\\mathbf{r}\\,$ where the local field is $\\,B(\\mathbf{r}) = B_0 + \\Delta B(\\mathbf{r})\\,$ and the proton gyromagnetic ratio is $\\,\\gamma\\,$ (in radians per second per tesla). Assume that, over the short time between echoes, $\\,\\Delta B(\\mathbf{r})\\,$ is approximately constant and the phase accrual is dominated by off-resonance. Show how the measured dual-echo phase difference obeys a modular equivalence with $\\,2\\pi\\,$ and explain why phase unwrapping is needed to obtain a spatially smooth $\\,\\Delta B(\\mathbf{r})\\,$.\n\nThen, use the following concrete acquisition to perform a numerical estimation at a specific voxel after unwrapping:\n- Proton gyromagnetic ratio $\\,\\gamma = 2\\pi \\times 42.577 \\times 10^6\\,\\mathrm{rad\\,s^{-1}\\,T^{-1}}.$\n- Echo times $\\,\\mathrm{TE}_1 = 8\\,\\mathrm{ms}\\,$ and $\\,\\mathrm{TE}_2 = 11\\,\\mathrm{ms}\\,$ so that $\\,\\Delta t = \\mathrm{TE}_2 - \\mathrm{TE}_1.$\n- The measured wrapped dual-echo phase differences $\\,\\Delta \\phi_{\\mathrm{wrapped}}(i)\\,$ along a one-dimensional row of five voxels $\\,i=1,2,3,4,5\\,$ are:\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(1) = 2.55\\,\\mathrm{rad},$\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(2) = 2.70\\,\\mathrm{rad},$\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(3) = -3.12\\,\\mathrm{rad},$\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(4) = -3.05\\,\\mathrm{rad},$\n  $\\,\\Delta \\phi_{\\mathrm{wrapped}}(5) = -2.92\\,\\mathrm{rad}.$\n- Assume the true unwrapped phase difference $\\,\\Delta \\phi(\\mathbf{r})\\,$ varies smoothly and is monotonically increasing along this row.\n\n(i) Derive, from the fundamental phase accrual and Larmor precession, the dual-echo phase difference relationship to $\\,\\Delta B(\\mathbf{r})\\,$ and identify the modular ambiguity with $\\,2\\pi.$\n\n(ii) Perform a physically consistent phase unwrapping for these five voxels under the monotonic smoothness assumption and determine the unwrapped phase $\\,\\Delta \\phi(4)\\,$ at voxel $\\,i=4.$\n\n(iii) Using your unwrapped $\\,\\Delta \\phi(4)\\,$, compute $\\,\\Delta B(4)\\,$ in microtesla. Express your final numerical answer in microtesla and round your result to four significant figures. All angles must be treated in radians.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and internally consistent. It describes a standard and fundamental technique in Magnetic Resonance Imaging (MRI) for mapping static magnetic field inhomogeneities, known as $\\,B_0\\,$ mapping. All parameters and assumptions are physically realistic and sufficient for a unique solution. Therefore, the problem is valid, and a full solution can be constructed.\n\nThe solution is presented in three parts as requested: (i) the theoretical derivation, (ii) the phase unwrapping procedure, and (iii) the final numerical calculation.\n\n(i) Derivation of the Dual-Echo Phase Difference Relationship\n\nThe fundamental principle governing the behavior of nuclear spins in a magnetic field is the Larmor precession. The angular frequency of precession, $\\,\\omega(\\mathbf{r})\\,$, of a spin at a spatial position $\\,\\mathbf{r}\\,$ is directly proportional to the magnitude of the local magnetic field, $\\,B(\\mathbf{r})\\,$, at that position. This relationship is given by the Larmor equation:\n$$\n\\omega(\\mathbf{r}) = \\gamma B(\\mathbf{r})\n$$\nwhere $\\,\\gamma\\,$ is the gyromagnetic ratio, a constant specific to the nucleus (in this case, the proton).\n\nIn an MRI system, the total magnetic field $\\,B(\\mathbf{r})\\,$ is composed of the main, large, and ideally homogeneous static field $\\,B_0\\,$, and a small, spatially varying field inhomogeneity term $\\,\\Delta B(\\mathbf{r})\\,$:\n$$\nB(\\mathbf{r}) = B_0 + \\Delta B(\\mathbf{r})\n$$\nThe precession frequency can thus be written as:\n$$\n\\omega(\\mathbf{r}) = \\gamma (B_0 + \\Delta B(\\mathbf{r})) = \\gamma B_0 + \\gamma \\Delta B(\\mathbf{r})\n$$\nWe define the Larmor frequency as $\\,\\omega_0 = \\gamma B_0\\,$ and the off-resonance frequency as $\\,\\Delta\\omega(\\mathbf{r}) = \\gamma \\Delta B(\\mathbf{r})\\,$.\n\nThe MRI signal is typically detected in a frame of reference that rotates at the Larmor frequency $\\,\\omega_0\\,$. In this rotating frame, the phase of the transverse magnetization signal, $\\,\\phi(\\mathbf{r}, t)\\,$, evolves over time $\\,t\\,$ only due to the off-resonance frequency $\\,\\Delta\\omega(\\mathbf{r})\\,$. Assuming $\\,\\Delta B(\\mathbf{r})\\,$, and therefore $\\,\\Delta\\omega(\\mathbf{r})\\,$, is constant over the measurement time, the phase accrued at time $\\,t\\,$ is:\n$$\n\\phi(\\mathbf{r}, t) = \\Delta\\omega(\\mathbf{r}) \\cdot t = \\gamma \\Delta B(\\mathbf{r}) \\cdot t\n$$\nFor a dual-echo gradient echo acquisition, we acquire the signal at two different echo times, $\\,\\mathrm{TE}_1\\,$ and $\\,\\mathrm{TE}_2\\,$. The phase of the complex signal at each echo time is:\n$$\n\\phi_1(\\mathbf{r}) = \\phi(\\mathbf{r}, \\mathrm{TE}_1) = \\gamma \\Delta B(\\mathbf{r}) \\mathrm{TE}_1\n$$\n$$\n\\phi_2(\\mathbf{r}) = \\phi(\\mathbf{r}, \\mathrm{TE}_2) = \\gamma \\Delta B(\\mathbf{r}) \\mathrm{TE}_2\n$$\nThe phase difference, $\\,\\Delta\\phi(\\mathbf{r})\\,$, between the two echoes is then:\n$$\n\\Delta\\phi(\\mathbf{r}) = \\phi_2(\\mathbf{r}) - \\phi_1(\\mathbf{r}) = \\gamma \\Delta B(\\mathbf{r}) \\mathrm{TE}_2 - \\gamma \\Delta B(\\mathbf{r}) \\mathrm{TE}_1\n$$\nFactoring out the common terms, we get:\n$$\n\\Delta\\phi(\\mathbf{r}) = \\gamma \\Delta B(\\mathbf{r}) (\\mathrm{TE}_2 - \\mathrm{TE}_1)\n$$\nDefining $\\,\\Delta t = \\mathrm{TE}_2 - \\mathrm{TE}_1\\,$, the relationship is:\n$$\n\\Delta\\phi(\\mathbf{r}) = \\gamma \\Delta B(\\mathbf{r}) \\Delta t\n$$\nThis equation directly relates the true phase difference to the local field inhomogeneity. However, in practice, the phase of a complex signal can only be measured within a principal interval, typically $\\,(-\\pi, \\pi]\\,$. The measured, or \"wrapped,\" phase difference, $\\,\\Delta\\phi_{\\mathrm{wrapped}}(\\mathbf{r})\\,$, is related to the true phase difference $\\,\\Delta\\phi(\\mathbf{r})\\,$ by a modular equivalence with $\\,2\\pi\\,$:\n$$\n\\Delta\\phi(\\mathbf{r}) = \\Delta\\phi_{\\mathrm{wrapped}}(\\mathbf{r}) + 2\\pi k\n$$\nwhere $\\,k\\,$ is an integer. This ambiguity arises because a phase of $\\,\\theta\\,$ is indistinguishable from a phase of $\\,\\theta + 2\\pi k\\,$. If the underlying field map $\\,\\Delta B(\\mathbf{r})\\,$ varies significantly across space, the true phase $\\,\\Delta\\phi(\\mathbf{r})\\,$ can exceed the $\\,2\\pi\\,$ range, causing abrupt \"wraps\" in the measured phase map. To recover the true, continuous phase map, and thus a smooth $\\,\\Delta B(\\mathbf{r})\\,$ map, one must determine the correct integer $\\,k\\,$ for each voxel. This corrective procedure is known as phase unwrapping and relies on assumptions about the spatial smoothness of the underlying field.\n\n(ii) Phase Unwrapping of the Voxel Data\n\nWe are given the wrapped phase differences for a row of five voxels:\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(1) = 2.55\\,\\mathrm{rad}$\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(2) = 2.70\\,\\mathrm{rad}$\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(3) = -3.12\\,\\mathrm{rad}$\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(4) = -3.05\\,\\mathrm{rad}$\n$\\,\\Delta\\phi_{\\mathrm{wrapped}}(5) = -2.92\\,\\mathrm{rad}$\n\nThe unwrapping is performed under the assumption that the true phase difference, $\\,\\Delta\\phi(i)\\,$, is a monotonically increasing function of the voxel index $\\,i\\,$. The unwrapped phase is found using $\\,\\Delta\\phi(i) = \\Delta\\phi_{\\mathrm{wrapped}}(i) + 2\\pi k_i\\,$ for integers $\\,k_i\\,$.\n\n1.  Let's start with voxel $\\,i=1\\,$ and set its unwrapping integer $\\,k_1=0\\,$.\n    $\\,\\Delta\\phi(1) = 2.55\\,$.\n\n2.  For voxel $\\,i=2\\,$, $\\,\\Delta\\phi_{\\mathrm{wrapped}}(2) = 2.70\\,$. Since $\\,2.70 > 2.55\\,$, this is consistent with a monotonic increase. We set $\\,k_2=0\\,$.\n    $\\,\\Delta\\phi(2) = 2.70\\,$.\n\n3.  For voxel $\\,i=3\\,$, $\\,\\Delta\\phi_{\\mathrm{wrapped}}(3) = -3.12\\,$. This violates the monotonic increase condition, as $\\,-3.12 < 2.70\\,$. The phase jump between voxels $\\,2\\,$ and $\\,3\\,$ is $\\,-3.12 - 2.70 = -5.82\\,$, which is close to $\\,-2\\pi \\approx -6.28\\,$. This indicates a phase wrap has occurred. To correct this, we must add a multiple of $\\,2\\pi\\,$. Let's try $\\,k_3 = 1\\,$.\n    $\\,\\Delta\\phi(3) = \\Delta\\phi_{\\mathrm{wrapped}}(3) + 2\\pi(1) = -3.12 + 2\\pi \\approx 3.163185...\\,$.\n    Now, $\\,\\Delta\\phi(3) \\approx 3.163 > \\Delta\\phi(2) = 2.70\\,$. The monotonicity is restored.\n\n4.  For voxel $\\,i=4\\,$, $\\,\\Delta\\phi_{\\mathrm{wrapped}}(4) = -3.05\\,$. The wrapped phase difference from the previous voxel is $\\,-3.05 - (-3.12) = 0.07\\,$. This is a small positive change, suggesting that voxel $\\,4\\,$ has the same wrap count as voxel $\\,3\\,$. We therefore set $\\,k_4 = 1\\,$.\n    $\\,\\Delta\\phi(4) = \\Delta\\phi_{\\mathrm{wrapped}}(4) + 2\\pi(1) = -3.05 + 2\\pi \\approx 3.233185...\\,$.\n    Checking for monotonicity: $\\,\\Delta\\phi(4) \\approx 3.233 > \\Delta\\phi(3) \\approx 3.163\\,$. The condition holds.\n\n5.  For voxel $\\,i=5\\,$, $\\,\\Delta\\phi_{\\mathrm{wrapped}}(5) = -2.92\\,$. The wrapped phase difference from voxel $\\,4\\,$ is $\\,-2.92 - (-3.05) = 0.13\\,$. This is another small positive change, so we set $\\,k_5 = 1\\,$.\n    $\\,\\Delta\\phi(5) = \\Delta\\phi_{\\mathrm{wrapped}}(5) + 2\\pi(1) = -2.92 + 2\\pi \\approx 3.363185...\\,$.\n    Checking for monotonicity: $\\,\\Delta\\phi(5) \\approx 3.363 > \\Delta\\phi(4) \\approx 3.233\\,$. The condition holds.\n\nThe unwrapped phase sequence is monotonically increasing, consistent with the problem's assumption. The unwrapped phase at voxel $\\,i=4\\,$ is:\n$$\n\\Delta\\phi(4) = -3.05 + 2\\pi \\,\\mathrm{rad}\n$$\n\n(iii) Calculation of Field Inhomogeneity $\\,\\Delta B(4)\\,$\n\nFrom part (i), we have the relationship for the field inhomogeneity:\n$$\n\\Delta B(\\mathbf{r}) = \\frac{\\Delta\\phi(\\mathbf{r})}{\\gamma \\Delta t}\n$$\nWe need to calculate $\\,\\Delta B(4)\\,$ using the unwrapped phase $\\,\\Delta\\phi(4)\\,$ and the given parameters:\n- Proton gyromagnetic ratio $\\,\\gamma = 2\\pi \\times 42.577 \\times 10^6\\,\\mathrm{rad\\,s^{-1}\\,T^{-1}}\\,$.\n- Echo time difference $\\,\\Delta t = \\mathrm{TE}_2 - \\mathrm{TE}_1 = 11\\,\\mathrm{ms} - 8\\,\\mathrm{ms} = 3\\,\\mathrm{ms} = 3 \\times 10^{-3}\\,\\mathrm{s}\\,$.\n- Unwrapped phase $\\,\\Delta\\phi(4) = (2\\pi - 3.05)\\,\\mathrm{rad}\\,$.\n\nFirst, let's compute the product $\\,\\gamma \\Delta t\\,$:\n$$\n\\gamma \\Delta t = (2\\pi \\times 42.577 \\times 10^6\\,\\mathrm{s^{-1}\\,T^{-1}}) \\times (3 \\times 10^{-3}\\,\\mathrm{s})\n$$\n$$\n\\gamma \\Delta t = 2\\pi \\times 42.577 \\times 3 \\times 10^3 \\,\\mathrm{rad\\,T^{-1}} = 2\\pi \\times 127731 \\,\\mathrm{rad\\,T^{-1}} \\approx 802549.9 \\,\\mathrm{rad\\,T^{-1}}\n$$\nNow we can compute $\\,\\Delta B(4)\\,$ in tesla:\n$$\n\\Delta B(4) = \\frac{2\\pi - 3.05}{2\\pi \\times 127731} \\approx \\frac{6.283185 - 3.05}{802549.9} = \\frac{3.233185}{802549.9} \\,\\mathrm{T}\n$$\n$$\n\\Delta B(4) \\approx 4.02864 \\times 10^{-6}\\,\\mathrm{T}\n$$\nThe problem requires the answer in microtesla ($\\,\\mu\\mathrm{T}\\,$), where $\\,1\\,\\mu\\mathrm{T} = 10^{-6}\\,\\mathrm{T}\\,$.\n$$\n\\Delta B(4) \\approx 4.02864 \\,\\mu\\mathrm{T}\n$$\nRounding the result to four significant figures gives:\n$$\n\\Delta B(4) = 4.029 \\,\\mu\\mathrm{T}\n$$",
            "answer": "$$\n\\boxed{4.029}\n$$"
        },
        {
            "introduction": "Once the field inhomogeneity map is known, active shimming can be performed by energizing a set of dedicated shim coils to counteract the imperfections. This exercise puts you in the role of designing the correction by framing the problem as a linear least-squares optimization. By deriving and solving the normal equations for a given set of coil basis fields , you will determine the optimal currents needed to generate a corrective field that best cancels the measured inhomogeneity.",
            "id": "4898415",
            "problem": "Magnetic Resonance Imaging (MRI) systems rely on a highly homogeneous static magnetic field to ensure accurate spatial encoding. Residual inhomogeneities are compensated using a set of shim coils whose fields superpose linearly. Consider a calibration in which the shim coil basis fields have been sampled at four spatial locations. Let the $4 \\times 3$ matrix $\\mathbf{A}$ encode the field at each location produced by $1$ ampere in each of the three shim coils, and let $\\mathbf{b}$ denote the desired shim field at those locations (for example, the negative of the measured inhomogeneity). The forward model is linear: the shim field produced by coil currents $\\mathbf{i} \\in \\mathbb{R}^{3}$ is $\\mathbf{A}\\mathbf{i}$.\n\nStarting from the principle of linear superposition and the least-squares criterion, formulate the optimization problem that determines $\\mathbf{i}$ to best match $\\mathbf{b}$ in the sense of minimizing the squared Euclidean norm of the mismatch. Then, derive the necessary optimality condition by setting the gradient of the objective to zero, and interpret the resulting condition physically in terms of orthogonality of the residual to the span of the coil basis fields.\n\nFinally, for the numerically specified calibration below, compute the optimal coil currents. Use the following matrix and vector (entries are in microtesla per ampere for $\\mathbf{A}$ and microtesla for $\\mathbf{b}$):\n$$\n\\mathbf{A} =\n\\begin{pmatrix}\n1.0 & 0.0 & 1.0 \\\\\n0.0 & 1.0 & 1.0 \\\\\n1.0 & 0.0 & -1.0 \\\\\n0.0 & 1.0 & -1.0\n\\end{pmatrix},\n\\qquad\n\\mathbf{b} =\n\\begin{pmatrix}\n1.2 \\\\\n-0.8 \\\\\n0.5 \\\\\n1.1\n\\end{pmatrix}.\n$$\nCompute the optimal $\\mathbf{i}$ and report it as a row matrix in the order of coils $1$, $2$, $3$. Express the currents in amperes and round each entry to three significant figures.",
            "solution": "The problem statement is scientifically grounded, self-contained, and well-posed. It describes a standard linear least-squares problem, which is a fundamental technique used for B0 magnetic field shimming in Magnetic Resonance Imaging. All data and conditions are provided, and they are physically and mathematically consistent. Therefore, the problem is valid and we may proceed with the solution.\n\nThe problem is to find the vector of shim coil currents, $\\mathbf{i} \\in \\mathbb{R}^{3}$, that generates a magnetic field, $\\mathbf{A}\\mathbf{i}$, which best approximates the desired target field, $\\mathbf{b} \\in \\mathbb{R}^{4}$, at four specified spatial locations. The principle of linear superposition states that the total field generated by the coils is a linear combination of the individual coil fields, which is precisely what the matrix-vector product $\\mathbf{A}\\mathbf{i}$ represents. The matrix $\\mathbf{A}$ has columns that are the basis fields for each coil, and $\\mathbf{i}$ contains the weights (currents) for the linear combination.\n\nWe are asked to find the \"best\" approximation in the sense of the least-squares criterion. This means we must minimize the squared Euclidean norm of the residual vector, $\\mathbf{r} = \\mathbf{b} - \\mathbf{A}\\mathbf{i}$. The objective function to be minimized is $J(\\mathbf{i})$:\n$$\nJ(\\mathbf{i}) = \\|\\mathbf{b} - \\mathbf{A}\\mathbf{i}\\|_2^2\n$$\nThis can be expressed using the dot product, which in matrix notation is a transpose:\n$$\nJ(\\mathbf{i}) = (\\mathbf{b} - \\mathbf{A}\\mathbf{i})^T (\\mathbf{b} - \\mathbf{A}\\mathbf{i})\n$$\nExpanding this expression, we get:\n$$\nJ(\\mathbf{i}) = (\\mathbf{b}^T - (\\mathbf{A}\\mathbf{i})^T)(\\mathbf{b} - \\mathbf{A}\\mathbf{i}) = (\\mathbf{b}^T - \\mathbf{i}^T\\mathbf{A}^T)(\\mathbf{b} - \\mathbf{A}\\mathbf{i})\n$$\n$$\nJ(\\mathbf{i}) = \\mathbf{b}^T\\mathbf{b} - \\mathbf{b}^T\\mathbf{A}\\mathbf{i} - \\mathbf{i}^T\\mathbf{A}^T\\mathbf{b} + \\mathbf{i}^T\\mathbf{A}^T\\mathbf{A}\\mathbf{i}\n$$\nSince $\\mathbf{b}^T\\mathbf{A}\\mathbf{i}$ is a scalar, it is equal to its transpose, $(\\mathbf{b}^T\\mathbf{A}\\mathbf{i})^T = \\mathbf{i}^T\\mathbf{A}^T\\mathbf{b}$. Thus, the two middle terms are identical. The objective function simplifies to:\n$$\nJ(\\mathbf{i}) = \\mathbf{i}^T(\\mathbf{A}^T\\mathbf{A})\\mathbf{i} - 2\\mathbf{b}^T\\mathbf{A}\\mathbf{i} + \\mathbf{b}^T\\mathbf{b}\n$$\nThis is the formal optimization problem. To find the optimal current vector $\\mathbf{i}$ that minimizes $J(\\mathbf{i})$, we must find the point where the gradient of $J(\\mathbf{i})$ with respect to $\\mathbf{i}$ is the zero vector.\n$$\n\\nabla_{\\mathbf{i}} J(\\mathbf{i}) = \\mathbf{0}\n$$\nWe compute the gradient term by term using standard matrix calculus identities. The term $\\mathbf{b}^T\\mathbf{b}$ is constant with respect to $\\mathbf{i}$, so its gradient is zero. For the linear term, $\\nabla_{\\mathbf{i}}(-2\\mathbf{b}^T\\mathbf{A}\\mathbf{i}) = -2(\\mathbf{b}^T\\mathbf{A})^T = -2\\mathbf{A}^T\\mathbf{b}$. For the quadratic term, $\\mathbf{A}^T\\mathbf{A}$ is a symmetric matrix, so $\\nabla_{\\mathbf{i}}(\\mathbf{i}^T(\\mathbf{A}^T\\mathbf{A})\\mathbf{i}) = 2(\\mathbf{A}^T\\mathbf{A})\\mathbf{i}$. Combining these results, the gradient is:\n$$\n\\nabla_{\\mathbf{i}} J(\\mathbf{i}) = 2\\mathbf{A}^T\\mathbf{A}\\mathbf{i} - 2\\mathbf{A}^T\\mathbf{b}\n$$\nSetting the gradient to zero gives the necessary optimality condition:\n$$\n2\\mathbf{A}^T\\mathbf{A}\\mathbf{i} - 2\\mathbf{A}^T\\mathbf{b} = \\mathbf{0} \\implies \\mathbf{A}^T\\mathbf{A}\\mathbf{i} = \\mathbf{A}^T\\mathbf{b}\n$$\nThis system of linear equations is known as the normal equations.\n\nFor the physical interpretation, we can rewrite the normal equations as:\n$$\n\\mathbf{A}^T(\\mathbf{b} - \\mathbf{A}\\mathbf{i}) = \\mathbf{0}\n$$\nThe vector $\\mathbf{A}\\mathbf{i}$ is the best approximation of $\\mathbf{b}$ that lies in the column space of $\\mathbf{A}$, which is the subspace spanned by the coil basis fields. The vector $\\mathbf{r} = \\mathbf{b} - \\mathbf{A}\\mathbf{i}$ is the residual, or error, of this approximation. The matrix $\\mathbf{A}^T$ has rows that are the transposes of the columns of $\\mathbf{A}$ (the coil basis fields). The condition $\\mathbf{A}^T\\mathbf{r} = \\mathbf{0}$ means that the dot product of each column of $\\mathbf{A}$ with the residual vector $\\mathbf{r}$ is zero. In other words, the residual vector $\\mathbf{r}$ is orthogonal to every one of the coil basis fields. This implies that the residual vector is orthogonal to the entire subspace spanned by the coil basis fields, $\\text{Col}(\\mathbf{A})$. Geometrically, a least-squares solution is achieved when the error vector is perpendicular to the subspace onto which we are projecting.\n\nNow, we compute the optimal currents for the given numerical values.\n$$\n\\mathbf{A} =\n\\begin{pmatrix}\n1.0 & 0.0 & 1.0 \\\\\n0.0 & 1.0 & 1.0 \\\\\n1.0 & 0.0 & -1.0 \\\\\n0.0 & 1.0 & -1.0\n\\end{pmatrix},\n\\qquad\n\\mathbf{b} =\n\\begin{pmatrix}\n1.2 \\\\\n-0.8 \\\\\n0.5 \\\\\n1.1\n\\end{pmatrix}\n$$\nFirst, we compute $\\mathbf{A}^T\\mathbf{A}$:\n$$\n\\mathbf{A}^T\\mathbf{A} =\n\\begin{pmatrix}\n1.0 & 0.0 & 1.0 & 0.0 \\\\\n0.0 & 1.0 & 0.0 & 1.0 \\\\\n1.0 & 1.0 & -1.0 & -1.0\n\\end{pmatrix}\n\\begin{pmatrix}\n1.0 & 0.0 & 1.0 \\\\\n0.0 & 1.0 & 1.0 \\\\\n1.0 & 0.0 & -1.0 \\\\\n0.0 & 1.0 & -1.0\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n2.0 & 0.0 & 0.0 \\\\\n0.0 & 2.0 & 0.0 \\\\\n0.0 & 0.0 & 4.0\n\\end{pmatrix}\n$$\nThe matrix $\\mathbf{A}^T\\mathbf{A}$ is diagonal, which indicates that the columns of $\\mathbf{A}$ are an orthogonal basis. This simplifies the solution significantly.\nNext, we compute $\\mathbf{A}^T\\mathbf{b}$:\n$$\n\\mathbf{A}^T\\mathbf{b} =\n\\begin{pmatrix}\n1.0 & 0.0 & 1.0 & 0.0 \\\\\n0.0 & 1.0 & 0.0 & 1.0 \\\\\n1.0 & 1.0 & -1.0 & -1.0\n\\end{pmatrix}\n\\begin{pmatrix}\n1.2 \\\\\n-0.8 \\\\\n0.5 \\\\\n1.1\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1.0(1.2) + 0.0(-0.8) + 1.0(0.5) + 0.0(1.1) \\\\\n0.0(1.2) + 1.0(-0.8) + 0.0(0.5) + 1.0(1.1) \\\\\n1.0(1.2) + 1.0(-0.8) - 1.0(0.5) - 1.0(1.1)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1.7 \\\\\n0.3 \\\\\n-1.2\n\\end{pmatrix}\n$$\nNow we solve the normal equations $\\mathbf{A}^T\\mathbf{A}\\mathbf{i} = \\mathbf{A}^T\\mathbf{b}$:\n$$\n\\begin{pmatrix}\n2.0 & 0.0 & 0.0 \\\\\n0.0 & 2.0 & 0.0 \\\\\n0.0 & 0.0 & 4.0\n\\end{pmatrix}\n\\begin{pmatrix}\ni_1 \\\\\ni_2 \\\\\ni_3\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1.7 \\\\\n0.3 \\\\\n-1.2\n\\end{pmatrix}\n$$\nThis yields a system of uncoupled equations:\n$2.0 i_1 = 1.7 \\implies i_1 = \\frac{1.7}{2.0} = 0.85$\n$2.0 i_2 = 0.3 \\implies i_2 = \\frac{0.3}{2.0} = 0.15$\n$4.0 i_3 = -1.2 \\implies i_3 = \\frac{-1.2}{4.0} = -0.3$\nThe optimal current vector is $\\mathbf{i} = [0.85, 0.15, -0.3]^T$ amperes. The problem requires rounding each entry to three significant figures.\n$i_1 = 0.850$ A\n$i_2 = 0.150$ A\n$i_3 = -0.300$ A\nThe final answer is reported as a row matrix.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.850 & 0.150 & -0.300\n\\end{pmatrix}\n}\n$$"
        }
    ]
}