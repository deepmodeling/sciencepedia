{
    "hands_on_practices": [
        {
            "introduction": "超声图像中回波的亮度由组织界面处的反射系数决定。这个基础练习将指导你计算一个常见且重要的界面——软组织与骨骼——的反射系数。通过这个实践，你将理解声阻抗失配如何直接影响图像的呈现，例如形成高回声界面和声影。",
            "id": "4860354",
            "problem": "在医学超声成像（US）中，考虑一个在均匀、无损耗的软组织介质中传播的时谐平面压缩波，垂直入射到与均匀、无损耗的皮质骨形成的平面界面上。设界面位于 $x=0$ 处，软组织占据 $x<0$ 的区域，骨骼占据 $x>0$ 的区域。介质的特性由其比声阻抗来描述，定义为 $Z=\\frac{p}{u}$，其中 $p$ 是声压，$u$ 是沿传播方向的质点速度。软组织的 $Z_1=1.5\\ \\text{MRayl}$，骨骼的 $Z_2=7\\ \\text{MRayl}$。\n\n从线性声学平面波模型和边界条件（声压和质点速度的法向分量在界面上连续）出发，推导垂直入射时声压反射系数的模的表达式，然后计算在给定阻抗下的数值。将您的数值结果四舍五入到四位有效数字，并以无量纲的小数形式表示。简要评论计算出的模值对诊断性超声中软组织-骨骼边界附近图像形成的影响。定性评论不属于数值答案要求的一部分。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n**步骤1：提取已知条件**\n- **系统**：在均匀、无损耗的软组织介质中传播的时谐平面压缩波，垂直入射到与均匀、无损耗的皮质骨形成的平面界面上。\n- **几何**：界面位于 $x=0$ 处。软组织占据 $x<0$；骨骼占据 $x>0$。\n- **模型**：线性声学平面波模型。\n- **定义**：比声阻抗定义为 $Z=\\frac{p}{u}$，其中 $p$ 是声压，$u$ 是质点速度。\n- **边界条件**：在界面（$x=0$）上，声压（$p$）和质点速度的法向分量（$u$）都是连续的。\n- **材料属性**：\n    - 软组织（介质1）：比声阻抗 $Z_1=1.5\\ \\text{MRayl}$。\n    - 皮质骨（介质2）：比声阻抗 $Z_2=7\\ \\text{MRayl}$。\n- **任务**：\n    1. 推导垂直入射时声压反射系数的模的表达式。\n    2. 计算在给定阻抗下的数值。\n    3. 将结果四舍五入到四位有效数字，并以无量纲的小数形式表示。\n    4. 简要评论其对超声（US）成像的影响。\n\n**步骤2：使用提取的已知条件进行验证**\n根据既定标准对问题进行评估：\n- **科学依据**：该问题基于波传播和声学的基本原理，特别是平面波在界面上的行为。声阻抗、反射系数以及声压和质点速度的连续性等概念是物理学和医学成像中的标准内容。提供的软组织（$1.5\\ \\text{MRayl}$）和骨骼（$7\\ \\text{MRayl}$）的阻抗值在物理上是现实的，并且在文献中被普遍引用。\n- **适定性**：该问题是适定的。它提供了推导反射系数的唯一表达式并计算其值所需的所有必要信息（两种介质的阻抗、入射性质和边界条件）。\n- **客观性**：该问题使用精确、客观的科学语言陈述，没有歧义或主观论断。\n\n该问题没有表现出验证协议中列出的任何缺陷（例如，科学上不成立、信息缺失、不切实际的条件）。它是医学成像基础中的一个标准的、可形式化的问题。\n\n**步骤3：结论与行动**\n该问题被认为是**有效**的。将提供完整的解答。\n\n**推导与求解**\n设软组织（介质1，$x<0$）和骨骼（介质2，$x>0$）之间的界面位于 $x=0$。我们考虑一个角频率为 $\\omega$ 的时谐平面波。两种介质中的声压波可以用复指数形式表示。\n\n在介质1（$x<0$）中，总声压是入射波和反射波之和：\n$$p_1(x,t) = p_i(x,t) + p_r(x,t) = P_i \\exp(j(\\omega t - k_1 x)) + P_r \\exp(j(\\omega t + k_1 x))$$\n此处，$P_i$ 和 $P_r$ 分别是入射和反射声压波的复振幅，$k_1$ 是介质1中的波数。沿 $+x$ 方向传播的波的相位项为 $-k_1 x$，而沿 $-x$ 方向传播的反射波的相位项为 $+k_1 x$。\n\n相应的质点速度 $u = p/Z$ 为：\n$$u_1(x,t) = u_i(x,t) + u_r(x,t) = \\frac{P_i}{Z_1} \\exp(j(\\omega t - k_1 x)) - \\frac{P_r}{Z_1} \\exp(j(\\omega t + k_1 x))$$\n反射速度项的负号是因为质点运动的方向与波的传播方向是耦合的。对于沿 $-x$ 方向移动的波，其关系为 $u = -p/Z$。\n\n在介质2（$x>0$）中，只有沿 $+x$ 方向传播的透射波：\n$$p_2(x,t) = p_t(x,t) = P_t \\exp(j(\\omega t - k_2 x))$$\n$$u_2(x,t) = u_t(x,t) = \\frac{P_t}{Z_2} \\exp(j(\\omega t - k_2 x))$$\n此处，$P_t$ 是透射声压波的复振幅，$k_2$ 是介质2中的波数。\n\n在界面 $x=0$ 处的边界条件要求声压和质点速度连续：\n1.  $p_1(0,t) = p_2(0,t)$\n2.  $u_1(0,t) = u_2(0,t)$\n\n在 $x=0$ 处应用第一个边界条件：\n$$P_i \\exp(j\\omega t) + P_r \\exp(j\\omega t) = P_t \\exp(j\\omega t)$$\n$$P_i + P_r = P_t \\quad (1)$$\n\n在 $x=0$ 处应用第二个边界条件：\n$$\\frac{P_i}{Z_1} \\exp(j\\omega t) - \\frac{P_r}{Z_1} \\exp(j\\omega t) = \\frac{P_t}{Z_2} \\exp(j\\omega t)$$\n$$\\frac{1}{Z_1} (P_i - P_r) = \\frac{P_t}{Z_2} \\quad (2)$$\n\n声压反射系数 $R_p$ 定义为反射声压振幅与入射声压振幅之比，即 $R_p = \\frac{P_r}{P_i}$。我们希望找到这个量的表达式。我们可以通过将方程（1）代入方程（2）来消去 $P_t$：\n$$\\frac{1}{Z_1} (P_i - P_r) = \\frac{P_i + P_r}{Z_2}$$\n为了求解 $R_p$，我们重新排列这个方程，将含有 $P_i$ 和 $P_r$ 的项分组：\n$$Z_2 (P_i - P_r) = Z_1 (P_i + P_r)$$\n$$Z_2 P_i - Z_2 P_r = Z_1 P_i + Z_1 P_r$$\n$$Z_2 P_i - Z_1 P_i = Z_1 P_r + Z_2 P_r$$\n$$P_i (Z_2 - Z_1) = P_r (Z_1 + Z_2)$$\n两边同时除以 $P_i$ 和 $(Z_1 + Z_2)$：\n$$R_p = \\frac{P_r}{P_i} = \\frac{Z_2 - Z_1}{Z_2 + Z_1}$$\n这就是垂直入射时声压反射系数的一般表达式。\n\n题目要求计算该系数的模。由于假设介质是无损耗的，它们的比声阻抗 $Z_1$ 和 $Z_2$ 都是实数。因此，模 $|R_p|$ 是该表达式的绝对值：\n$$|R_p| = \\left| \\frac{Z_2 - Z_1}{Z_2 + Z_1} \\right|$$\n\n现在，我们使用给定的数据计算数值：$Z_1 = 1.5\\ \\text{MRayl}$ 和 $Z_2 = 7\\ \\text{MRayl}$。\n$$|R_p| = \\left| \\frac{7 - 1.5}{7 + 1.5} \\right| = \\left| \\frac{5.5}{8.5} \\right|$$\n$$|R_p| = \\frac{5.5}{8.5} \\approx 0.6470588...$$\n将结果四舍五入到四位有效数字，得到：\n$$|R_p| \\approx 0.6471$$\n\n**对成像影响的评论**\n计算出的声压反射系数的模 $|R_p| \\approx 0.6471$ 是一个很大的值。这表明在软组织-骨骼界面上，大约 $64.7\\%$ 的入射声压波振幅被反射。描述能量反射分数的声强反射系数 $R_I$ 由 $R_I = |R_p|^2$ 给出。在这种情况下，$R_I \\approx (0.6471)^2 \\approx 0.4187$，意味着将近 $42\\%$ 的入射超声能量被反射回换能器。\n\n这对诊断性超声成像有两个主要影响：\n1. **高回声性**：来自骨骼表面的强反射会产生强烈的回波。在B型超声图像中，信号强度被映射为亮度。因此，软组织和骨骼之间的界面显示为一条非常明亮（高回声）的线，使得骨骼表面很容易被识别。\n2. **声影**：由于大部分能量被反射，只有一小部分能量透射到骨骼中以探查更深的结构。骨骼的高阻抗也导致透射波的强烈衰减（吸收和散射）。表面高反射和骨内高衰减的结合意味着很少甚至没有超声能量能够穿透骨骼并从其后方的组织返回。这导致了“声影”的产生，即图像中骨骼深处的一个无回声（黑色）区域，其中的解剖结构无法被看见。这种现象解释了为什么超声在通过颅骨对成人大脑成像或对被肋骨完全遮挡的器官进行可视化方面的应用有限。",
            "answer": "$$\\boxed{0.6471}$$"
        },
        {
            "introduction": "除了预测回波强度，我们还可以反向推理，从测量的信号中推断组织的物理性质。这个练习将介绍“逆问题”这一医学成像中的强大概念。你将学习如何利用已知的入射介质和测量的反射系数，来计算未知组织的声阻抗，这对于组织表征具有重要意义。",
            "id": "4860359",
            "problem": "一套医疗超声系统使用角频率为 $\\omega$ 的时谐平面波，以正入射方式探测一个平面、均匀的组织界面。介质1（耦合介质）占据 $x<0$ 的区域，其声阻抗 $Z_1$ 已知。介质2（组织）占据 $x>0$ 的区域，其声阻抗 $Z_2$ 未知，且可能因衰减和色散而是复数。界面位于 $x=0$ 处。该系统测量复压反射系数 $R$，其在界面处定义为反射复压振幅与入射复压振幅之比，即 $R = P_r/P_i$，其中 $P_i$ 和 $P_r$ 分别是 $x=0$ 处的入射和反射压力相量。\n\n假设两种介质均为线性、各向同性的，且支持平面波传播，并且没有发生波型转换。仅使用以下基本原理：\n- 平面波的声阻抗定义，$Z = p/v$，它关联了给定介质中的复压 $p$ 和复质点速度 $v$。\n- 在平面界面处，压力和法向质点速度的连续性，即 $p$ 和 $v$ 的法向分量在 $x=0$ 两侧是连续的。\n- 对于在阻抗为 $Z$ 的介质中沿 $+x$ 方向传播的平面波，$v = p/Z$；对于沿 $-x$ 方向传播的平面波，$v = -p/Z$。\n\n从这些原理出发，建立一个根据正入射时测得的复反射系数 $R$ 来估计未知 $Z_2$ 的反演问题，并推导出一个以 $Z_1$ 和 $R$ 表示 $Z_2$ 的显式闭式反演公式。请将最终答案表示为单个以 $Z_1$ 和 $R$ 表示 $Z_2$ 的解析表达式。无需进行数值取整。最终表达式中不包含单位。",
            "solution": "该问题被验证为具有科学依据、适定、客观且自洽的。解决该问题所需的所有必要原理和数据均已提供，且没有矛盾或歧义。它代表了波物理学中一个标准的反演问题，特别是在声学和医学成像的背景下。因此，我们可以进行推导。\n\n目标是根据介质1的已知声阻抗 $Z_1$ 和测得的复压反射系数 $R$，推导出介质2的未知声阻抗 $Z_2$ 的表达式。此推导将完全基于所提供的基本原理。\n\n设两种介质之间的界面位于平面 $x=0$ 处。介质1占据区域 $x<0$，介质2占据区域 $x>0$。一束入射平面波在介质1中沿 $+x$ 方向传播。在界面处，该波产生一束在介质1中沿 $-x$ 方向传播的反射波和一束在介质2中沿 $+x$ 方向传播的透射波。\n\n设 $p_i$、$p_r$ 和 $p_t$ 分别表示在界面 $x=0$ 处的入射波、反射波和透射波的复压相量。设 $v_i$、$v_r$ 和 $v_t$ 表示相应的复质点速度相量，其中速度方向垂直于界面。\n\n根据所提供的原理：\n1. 在界面处，介质1中的总压力是入射压力和反射压力之和：$p_{total,1} = p_i + p_r$。\n2. 在界面处，介质2中的总压力是透射压力：$p_{total,2} = p_t$。\n3. 界面（$x=0$）处压力的连续性要求 $p_{total,1} = p_{total,2}$，由此得出：\n$$p_i + p_r = p_t$$\n\n接下来，我们应用关于质点速度的原理。如果质点速度方向为 $+x$ 方向，则其为正。\n1. 入射波在介质1（阻抗 $Z_1$）中沿 $+x$ 方向传播，所以其质点速度为 $v_i = p_i / Z_1$。\n2. 反射波在介质1中沿 $-x$ 方向传播，所以其质点速度为 $v_r = -p_r / Z_1$。\n3. 透射波在介质2（阻抗 $Z_2$）中沿 $+x$ 方向传播，所以其质点速度为 $v_t = p_t / Z_2$。\n\n在界面处，介质1中的总法向质点速度为 $v_{total,1} = v_i + v_r$。在界面处，介质2中的总法向质点速度为 $v_{total,2} = v_t$。界面（$x=0$）处法向质点速度的连续性要求 $v_{total,1} = v_{total,2}$：\n$$v_i + v_r = v_t$$\n将用压力和阻抗表示的速度表达式代入，我们得到：\n$$\\frac{p_i}{Z_1} - \\frac{p_r}{Z_1} = \\frac{p_t}{Z_2}$$\n\n现在我们基于连续性条件得到一个方程组：\n1. $p_i + p_r = p_t$\n2. $\\frac{1}{Z_1}(p_i - p_r) = \\frac{p_t}{Z_2}$\n\n问题给出了复压反射系数 $R$ 的定义，即界面处反射复压振幅与入射复压振幅之比：\n$$R = \\frac{p_r}{p_i}$$\n这个定义使我们能用入射压力表示反射压力：$p_r = R \\cdot p_i$。\n\n现在我们可以将 $p_r = R \\cdot p_i$ 代入两个连续性方程。首先，根据压力连续性方程：\n$$p_i + R \\cdot p_i = p_t$$\n$$p_i(1 + R) = p_t$$\n\n接着，根据质点速度连续性方程：\n$$\\frac{1}{Z_1}(p_i - R \\cdot p_i) = \\frac{p_t}{Z_2}$$\n$$\\frac{p_i}{Z_1}(1 - R) = \\frac{p_t}{Z_2}$$\n\n现在我们有两个关联压力的方程。我们可以通过将第一个方程中 $p_t$ 的表达式代入第二个方程来消去 $p_t$：\n$$\\frac{p_i}{Z_1}(1 - R) = \\frac{p_i(1 + R)}{Z_2}$$\n\n为了进行有意义的测量，入射压力振幅 $p_i$ 不为零，因此我们可以将方程两边同时除以 $p_i$：\n$$\\frac{1 - R}{Z_1} = \\frac{1 + R}{Z_2}$$\n\n这个方程将未知阻抗 $Z_2$ 与已知阻抗 $Z_1$ 和测得的反射系数 $R$ 关联起来。为了解出 $Z_2$，我们对该方程进行代数整理。\n$$Z_2 (1 - R) = Z_1 (1 + R)$$\n假设 $R \\neq 1$（这种情况对应于全反射，此时没有能量透射，且 $Z_2$ 将为无穷大，这对于波传入组织而言是一个非物理场景），我们可以两边同除以 $(1 - R)$:\n$$Z_2 = Z_1 \\frac{1 + R}{1 - R}$$\n这就是用已知阻抗 $Z_1$ 和测得的复反射系数 $R$ 表示未知声阻抗 $Z_2$ 的显式闭式反演公式。该公式构成了所述反演问题的解。",
            "answer": "$$\\boxed{Z_1 \\frac{1+R}{1-R}}$$"
        },
        {
            "introduction": "真实的超声成像比简单的正入射情况要复杂得多。最后一个练习将多个关键概念——斜入射反射、斯涅尔定律和换能器指向性——整合到一个计算模型中。通过这个编程实践，你将探索当超声波束被转向不同角度时回波强度如何变化，这是理解图像质量和伪影的关键一步。",
            "id": "4860318",
            "problem": "一个位于均匀流体介质中的脉冲回波超声系统，探测一个分隔第一种流体（介质 $1$）和第二种介质（介质 $2$）的单一、无限、平坦的界面。阵列孔径是由相同、均匀激励的矩形元件组成的一维线阵，每个元件在成像（方位）平面内的宽度为 $w$，并安装在刚性障板上。波束在方位平面内被电子偏转至一个入射角 $\\theta$（从表面法线测量）。假设在方位平面的孔径上满足远场条件，并忽略介质中的衰减和多次散射。阵列被偏转，使得主瓣沿 $\\theta$ 方向指向界面，并且根据设计，沿偏转方向的阵列因子等于1。\n\n仅从基本原理出发，通过将与角度相关的界面反射率与元件方向性相结合，推导并计算归一化双程回波振幅作为偏转角的函数：\n\n- 您必须使用的基本原理：\n  - 流体声阻抗 $Z$ 的定义为 $Z = \\rho c$，其中 $\\rho$ 是质量密度， $c$ 是声速。\n  - 对于平面波在平坦界面处的声压和法向质点速度的连续性，以及斜入射平面波的声压与质点速度之间的关系。\n  - 平面声波穿过界面时的折射定律（Snell 定律），该定律通过相速度将介质 $1$ 中的入射角与介质 $2$ 中的透射角联系起来。\n  - 从孔径函数的傅里叶变换获得的、刚性障板中均匀激励的矩形活塞的远场方向性。\n\n需要执行的任务：\n\n1) 使用上述基本原理，推导从介质 $1$ 以斜角 $\\theta$ 入射到介质 $2$ 的平面纵波的复声压反射系数的闭式表达式，该表达式用 $(\\rho_1,c_1)$、$(\\rho_2,c_2)$ 和由 Snell 定律决定的透射角表示。由此，提取反射率大小作为 $\\theta$ 的函数。\n\n2) 使用上述基本原理，推导在时间频率 $f$ 下，宽度为 $w$ 的均匀激励矩形活塞的远场方位方向图 $D(\\theta)$。指明您在推导中使用的波数 $k$ 及其所属的精确介质。解释为什么沿 $\\theta$ 方向的双程脉冲回波响应与 $\\lvert D(\\theta)\\rvert^2$ 成比例。\n\n3) 结合这两个结果，将非归一化的、与角度相关的回波振幅 $A(\\theta)$ 定义为声压反射系数的大小与双程元件响应的乘积。用其在正向入射时的值进行归一化，以获得\n$$\nA_{\\text{norm}}(\\theta) \\equiv \\frac{A(\\theta)}{A(0)}。\n$$\n该量是无量纲的，并且对于每个角度，必须报告为实值标量。\n\n4) 实现一个程序，使用给定的物理参数为下面测试套件中指定的角度计算 $A_{\\text{norm}}(\\theta)$。注意：\n   - 使用角度（度）作为输入，但任何内部三角函数计算都必须使用弧度。\n   - 频率必须以赫兹（$\\mathrm{Hz}$）为单位处理，长度以米（$\\mathrm{m}$）为单位，密度以千克每立方米（$\\mathrm{kg}/\\mathrm{m}^3$）为单位，速度以米每秒（$\\mathrm{m}/\\mathrm{s}$）为单位。\n   - 如果透射角在超过临界角时变为复数，您的反射系数计算必须正确处理复数量，并且您必须在 $A(\\theta)$ 中使用其模值。\n   - 将最终输出表示为十进制浮点数，并四舍五入到小数点后恰好六位。\n\n测试套件（每行定义一个测试用例；为其有序的角度列表计算 $A_{\\text{norm}}(\\theta)$，并严格按照以下顺序将结果展平到最终输出中：首先是测试 $1$ 的所有角度，然后是测试 $2$ 的所有角度，最后是测试 $3$ 的所有角度）：\n\n- 测试 $1$（类似软组织的不匹配）：\n  - 介质 $1$：$\\rho_1 = 1000\\ \\mathrm{kg}/\\mathrm{m}^3$, $c_1 = 1480\\ \\mathrm{m}/\\mathrm{s}$\n  - 介质 $2$：$\\rho_2 = 1060\\ \\mathrm{kg}/\\mathrm{m}^3$, $c_2 = 1540\\ \\mathrm{m}/\\mathrm{s}$\n  - 频率：$f = 5.0 \\times 10^6\\ \\mathrm{Hz}$\n  - 元件宽度：$w = 3.0 \\times 10^{-4}\\ \\mathrm{m}$\n  - 角度（度）：$-30$, $-15$, $0$, $15$, $30$\n\n- 测试 $2$（类似骨组织的不匹配，包含超临界角）：\n  - 介质 $1$：$\\rho_1 = 1000\\ \\mathrm{kg}/\\mathrm{m}^3$, $c_1 = 1480\\ \\mathrm{m}/\\mathrm{s}$\n  - 介质 $2$：$\\rho_2 = 1900\\ \\mathrm{kg}/\\mathrm{m}^3$, $c_2 = 3500\\ \\mathrm{m}/\\mathrm{s}$\n  - 频率：$f = 5.0 \\times 10^6\\ \\mathrm{Hz}$\n  - 元件宽度：$w = 5.0 \\times 10^{-4}\\ \\mathrm{m}$\n  - 角度（度）：$-10$, $0$, $10$, $20$, $30$, $40$\n\n- 测试 $3$（类似空气的不匹配）：\n  - 介质 $1$：$\\rho_1 = 1000\\ \\mathrm{kg}/\\mathrm{m}^3$, $c_1 = 1480\\ \\mathrm{m}/\\mathrm{s}$\n  - 介质 $2$：$\\rho_2 = 1.2\\ \\mathrm{kg}/\\mathrm{m}^3$, $c_2 = 343\\ \\mathrm{m}/\\mathrm{s}$\n  - 频率：$f = 2.0 \\times 10^6\\ \\mathrm{Hz}$\n  - 元件宽度：$w = 2.0 \\times 10^{-4}\\ \\mathrm{m}$\n  - 角度（度）：$-20$, $0$, $20$\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含展平的结果，格式为方括号内以逗号分隔的列表，每个数字都四舍五入到小数点后恰好六位。顺序必须是 $[\\text{按顺序排列的测试 1 的角度结果}, \\text{然后是按顺序排列的测试 2 的角度结果}, \\text{然后是按顺序排列的测试 3 的角度结果}]$。例如，一个语法正确的行看起来会像 $[0.123456,0.234567, \\dots]$。",
            "solution": "我们从基本原理出发，推导由斜向镜面反射和远场中的元件方向性引起的脉冲回波振幅对偏转角的依赖关系。\n\n1) 斜入射下的声阻抗和边界反射。\n\n- 流体的声阻抗定义为 $Z = \\rho c$，其中 $\\rho$ 是质量密度，$c$ 是声速。对于斜入射的时谐平面波，声压 $p$ 与质点速度的法向分量 $u_n$ 之间的关系取决于入射角。如果传播方向与界面法线成 $\\theta$ 角，则法向比声阻抗满足\n$$\n\\frac{p}{u_n} = \\frac{Z}{\\cos \\theta}。\n$$\n- 在两种流体（介质 $1$ 和介质 $2$）之间的平坦界面上，边界条件强制声压和质点速度的法向分量连续。对于一个从介质 $1$ 以入射角 $\\theta_i$ 入射并以透射角 $\\theta_t$ 透射到介质 $2$ 的平面纵波，Snell 定律通过相速度将这些角度联系起来：\n$$\n\\frac{\\sin \\theta_i}{c_1} = \\frac{\\sin \\theta_t}{c_2}\n\\quad \\Rightarrow \\quad\n\\sin \\theta_t = \\frac{c_2}{c_1} \\sin \\theta_i。\n$$\n当 $\\sin \\theta_t > 1$ 时，透射波变为非均匀波，$\\theta_t$ 变为复数；这可以通过在主支上使用恒等式 $\\cos \\theta_t = \\sqrt{1 - \\sin^2 \\theta_t}$ 将 $\\cos \\theta_t$ 作为复数量来处理。\n\n- 使用边界条件和法向阻抗 $Z_1 / \\cos \\theta_i$ 和 $Z_2 / \\cos \\theta_t$，其中 $Z_m = \\rho_m c_m$，从介质 $1$ 入射的平面波声压反射系数为\n$$\nR(\\theta_i) = \\frac{Z_2 \\cos \\theta_i - Z_1 \\cos \\theta_t}{Z_2 \\cos \\theta_i + Z_1 \\cos \\theta_t}。\n$$\n反射率大小为 $\\lvert R(\\theta_i) \\rvert$，即使当 $\\theta_t$ 是复数时，它也是实值的。\n\n2) 矩形活塞的元件方向性。\n\n- 考虑一个在刚性障板中宽度为 $w$ 的均匀激励矩形活塞元件。在方位平面（宽度方向）的远场中，辐射声压的角谱与均匀孔径函数的一维空间傅里叶变换成正比。设时间频率为 $f$，并定义介质 $1$ 中的波数为\n$$\nk = \\frac{2\\pi f}{c_1}。\n$$\n- 采用这样的坐标约定：方位角 $\\theta$ 是相对于表面法线测量的，则远场方位方向性因子为\n$$\nD(\\theta) = \\operatorname{sinc}\\!\\Big(\\frac{k w}{2}\\sin \\theta \\Big),\n$$\n其中 $\\operatorname{sinc}(x) = \\frac{\\sin x}{x}$，且极限值为 $\\operatorname{sinc}(0)=1$。\n\n- 对于发射和接收使用同一元件的脉冲回波操作，在通常的弱散射和线性假设下，由元件引起的双程角度依赖性是发射和接收方向性的乘积，得到模的平方 $\\lvert D(\\theta)\\rvert^2$。\n\n3) 组合双程回波振幅和归一化。\n\n- 对于朝向镜面平坦界面的 $\\theta$ 角偏转，非归一化的、与角度相关的回波振幅为\n$$\nA(\\theta) = \\lvert R(\\theta)\\rvert \\, \\lvert D(\\theta)\\rvert^2,\n$$\n其中 $R(\\theta)$ 是入射角为 $\\theta$ 时的声压反射系数，$D(\\theta)$ 是如上所述的元件方向性。因为阵列被偏转使得主瓣指向 $\\theta$，所以沿偏转方向的阵列因子为1，因此不会在该角度引入额外的增益变化。\n\n- 为了消除对绝对尺度的依赖并分离出角度变化，我们用正向值进行归一化：\n$$\nA_{\\text{norm}}(\\theta) = \\frac{A(\\theta)}{A(0)} = \\frac{\\lvert R(\\theta)\\rvert \\, \\lvert D(\\theta)\\rvert^2}{\\lvert R(0)\\rvert \\, \\lvert D(0)\\rvert^2}。\n$$\n由于 $\\lvert D(0)\\rvert = 1$，分母简化为 $\\lvert R(0)\\rvert$。\n\n4) 适合实现的算法步骤：\n\n- 对于每个给定的测试用例，包括 $(\\rho_1, c_1)$、$(\\rho_2, c_2)$、频率 $f$、宽度 $w$ 和以度为单位的角度列表：\n  - 计算 $Z_1 = \\rho_1 c_1$ 和 $Z_2 = \\rho_2 c_2$。\n  - 计算 $k = 2\\pi f / c_1$。\n  - 对于每个偏转角 $\\theta$（度），将其转换为弧度 $\\theta_{\\mathrm{rad}}$。\n  - 计算 $\\sin \\theta_t = (c_2/c_1)\\sin \\theta_{\\mathrm{rad}}$，然后如有需要使用复数运算计算 $\\cos \\theta_t = \\sqrt{1 - \\sin^2 \\theta_t}$；计算 $\\cos \\theta_i = \\cos \\theta_{\\mathrm{rad}}$。\n  - 构建 $R(\\theta) = \\dfrac{Z_2 \\cos \\theta_i - Z_1 \\cos \\theta_t}{Z_2 \\cos \\theta_i + Z_1 \\cos \\theta_t}$ 并求其模 $\\lvert R(\\theta)\\rvert$。\n  - 根据约定 $\\operatorname{sinc}(0)=1$ 计算 $D(\\theta) = \\operatorname{sinc}\\!\\big(\\tfrac{k w}{2}\\sin \\theta_{\\mathrm{rad}}\\big)$ 并取其模的平方 $\\lvert D(\\theta)\\rvert^2$。\n  - 构建 $A(\\theta) = \\lvert R(\\theta)\\rvert \\, \\lvert D(\\theta)\\rvert^2$。\n- 通过在 $\\theta = 0$ 处重复上述步骤计算 $A(0)$，并对每个角度进行归一化 $A_{\\text{norm}}(\\theta) = A(\\theta)/A(0)$。\n- 将每个 $A_{\\text{norm}}(\\theta)$ 四舍五入到小数点后恰好六位。\n- 输出单行，其中包含一个展平的列表，该列表包含按顺序排列的测试 1 的所有结果，接着是按顺序排列的测试 2 的结果，再接着是按顺序排列的测试 3 的结果，列表用方括号括起来，并用逗号分隔。\n\n以上仅使用了已确立的定律：声阻抗的定义、斜入射下的边界条件和平面波关系、折射的 Snell 定律，以及均匀激励矩形孔径的夫琅禾费衍射结果，通过乘法组合来捕捉在镜面平坦界面上回波振幅随偏转角的变化。归一化确保了一个与总增益无关的无量纲量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef sinc(x):\n    # Compute sin(x)/x with proper handling at x=0\n    out = np.ones_like(x, dtype=np.complex128)\n    nz = np.abs(x) > 0\n    out[nz] = np.sin(x[nz]) / x[nz]\n    return out\n\ndef reflection_magnitude(theta_rad, rho1, c1, rho2, c2):\n    # Acoustic impedances\n    Z1 = rho1 * c1\n    Z2 = rho2 * c2\n    # Snell's law: sin(theta_t) = (c2/c1) * sin(theta_i)\n    sin_t = (c2 / c1) * np.sin(theta_rad)\n    # Handle possible evanescent transmission with complex sqrt\n    cos_t = np.sqrt(1.0 - sin_t**2 + 0j)\n    cos_i = np.cos(theta_rad) + 0j\n    R = (Z2 * cos_i - Z1 * cos_t) / (Z2 * cos_i + Z1 * cos_t)\n    return np.abs(R)\n\ndef element_two_way_directivity(theta_rad, f, c1, w):\n    # Wavenumber in medium 1\n    k = 2.0 * np.pi * f / c1\n    x = 0.5 * k * w * np.sin(theta_rad)\n    D = sinc(np.array([x], dtype=np.complex128)).ravel()[0]\n    # Two-way magnitude squared\n    return np.abs(D)**2\n\ndef normalized_echo_amplitudes(angles_deg, rho1, c1, rho2, c2, f, w):\n    angles_rad = np.deg2rad(np.array(angles_deg, dtype=float))\n    # Compute unnormalized A(theta) for each angle\n    A_vals = []\n    for th in angles_rad:\n        Rmag = reflection_magnitude(th, rho1, c1, rho2, c2)\n        D2 = element_two_way_directivity(th, f, c1, w)\n        A_vals.append(Rmag * D2)\n    A_vals = np.array(A_vals, dtype=float)\n    # Normalize by broadside (theta=0)\n    R0 = reflection_magnitude(0.0, rho1, c1, rho2, c2)\n    D20 = element_two_way_directivity(0.0, f, c1, w)\n    A0 = float(R0 * D20)\n    A_norm = A_vals / A0\n    return A_norm\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (rho1, c1, rho2, c2, f, w, angles_deg_list)\n    test_cases = [\n        (1000.0, 1480.0, 1060.0, 1540.0, 5.0e6, 3.0e-4, [-30.0, -15.0, 0.0, 15.0, 30.0]),\n        (1000.0, 1480.0, 1900.0, 3500.0, 5.0e6, 5.0e-4, [-10.0, 0.0, 10.0, 20.0, 30.0, 40.0]),\n        (1000.0, 1480.0, 1.2,    343.0,  2.0e6, 2.0e-4, [-20.0, 0.0, 20.0]),\n    ]\n\n    results = []\n    for rho1, c1, rho2, c2, f, w, angles in test_cases:\n        A_norm = normalized_echo_amplitudes(angles, rho1, c1, rho2, c2, f, w)\n        for val in A_norm:\n            results.append(f\"{val:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}