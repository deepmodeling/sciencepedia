{
    "hands_on_practices": [
        {
            "introduction": "在深入探讨完整的ROC曲线之前，我们首先需要理解其基本构成要素。这个练习将带你回到最核心的概念：对于一个给定的决策阈值，如何从一组患者和健康者的评分中计算出真阳性率（TPR）和假阳性率（FPR）。通过这个基础计算，你将掌握构建ROC曲线上单个点的具体方法。",
            "id": "4918260",
            "problem": "在医学成像基础的一项诊断任务中，使用一个标量成像生物标志物分数 $s$ 通过阈值法来判定是否存在疾病：如果 $s \\geq \\tau$ 则分类为阳性，否则分类为阴性。考虑一个患病受试者样本，其分数为 $\\{2.1, 1.8, 3.3, 0.9\\}$，以及一个未患病受试者样本，其分数为 $\\{0.5, 0.7, 1.2, 2.4, 2.6\\}$，并将阈值设定为 $\\tau = 2.0$。根据此规则下混淆矩阵的各个类别——真阳性、假阴性、真阴性、假阳性——的定义，构建混淆矩阵的各项计数。然后，使用受试者工作特征 (ROC) 分析中真阳性率 (TPR) 和假阳性率 (FPR) 的基本定义，计算 $\\mathrm{TPR}$ 和 $\\mathrm{FPR}$ 的值。最后，计算约登指数 $J$，其定义为 $J = \\mathrm{TPR} - \\mathrm{FPR}$。\n\n将您计算出的 $J$ 的最终数值答案四舍五入至四位有效数字，并以小数形式表示。",
            "solution": "分类规则是：如果 $s \\geq \\tau$ 则将案例标记为阳性，否则标记为阴性，其中 $\\tau = 2.0$。患病者的分数为集合 $\\{2.1, 1.8, 3.3, 0.9\\}$，未患病者的分数为 $\\{0.5, 0.7, 1.2, 2.4, 2.6\\}$。受试者工作特征 (ROC) 分析将真阳性率 (TPR) 定义为患病样本中被正确分类为阳性的比例，而假阳性率 (FPR) 定义为未患病样本中被错误分类为阳性的比例。形式上，若真阳性、假阴性、真阴性和假阳性的计数分别用 $\\mathrm{TP}$、$\\mathrm{FN}$、$\\mathrm{TN}$ 和 $\\mathrm{FP}$ 表示，则定义如下：\n$$\n\\mathrm{TPR} = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}}, \\quad \\mathrm{FPR} = \\frac{\\mathrm{FP}}{\\mathrm{FP} + \\mathrm{TN}}.\n$$\n\n我们首先将阈值应用于每个分数，来构建混淆矩阵的各项计数。\n\n对于阈值为 $\\tau = 2.0$ 时的患病者集合 $\\{2.1, 1.8, 3.3, 0.9\\}$：\n- 分数 $2.1$ 和 $3.3$ 满足 $s \\geq 2.0$，被分类为阳性；由于这些受试者是患病的，它们计入 $\\mathrm{TP}$。因此，$\\mathrm{TP} = 2$。\n- 分数 $1.8$ 和 $0.9$ 满足 $s  2.0$，被分类为阴性；由于这些受试者是患病的，它们计入 $\\mathrm{FN}$。因此，$\\mathrm{FN} = 2$。\n\n对于阈值为 $\\tau = 2.0$ 时的未患病者集合 $\\{0.5, 0.7, 1.2, 2.4, 2.6\\}$：\n- 分数 $2.4$ 和 $2.6$ 满足 $s \\geq 2.0$，被分类为阳性；由于这些受试者是未患病的，它们计入 $\\mathrm{FP}$。因此，$\\mathrm{FP} = 2$。\n- 分数 $0.5$、$0.7$ 和 $1.2$ 满足 $s  2.0$，被分类为阴性；由于这些受试者是未患病的，它们计入 $\\mathrm{TN}$。因此，$\\mathrm{TN} = 3$。\n\n有了这些计数，我们使用定义来计算真阳性率和假阳性率：\n$$\n\\mathrm{TPR} = \\frac{\\mathrm{TP}}{\\mathrm{TP} + \\mathrm{FN}} = \\frac{2}{2 + 2} = \\frac{2}{4} = 0.5,\n$$\n$$\n\\mathrm{FPR} = \\frac{\\mathrm{FP}}{\\mathrm{FP} + \\mathrm{TN}} = \\frac{2}{2 + 3} = \\frac{2}{5} = 0.4.\n$$\n\n约登指数 $J$ 定义为 $J = \\mathrm{TPR} - \\mathrm{FPR}$，所以我们有\n$$\nJ = 0.5 - 0.4 = 0.1.\n$$\n\n将 $J$ 四舍五入至四位有效数字并以小数形式表示，得到 $0.1000$。",
            "answer": "$$\\boxed{0.1000}$$"
        },
        {
            "introduction": "掌握了如何确定单个(FPR, TPR)点之后，下一步自然是构建完整的ROC曲线。此练习将指导你通过系统地移动决策阈值，从一组离散的评分数据中生成一系列(FPR, TPR)点，并将它们连接起来形成经验ROC曲线。最终，你将学习如何使用梯形法则计算曲线下面积（AUC），这是衡量诊断测试整体性能的关键指标。",
            "id": "4918235",
            "problem": "在医学成像中，一个二元诊断任务通过受试者工作特性 (ROC) 分析进行评估。一个分类器产生在区间 $[0,1]$ 内的连续置信度得分，这些得分反映了患病的可能性。对于一个阈值 $\\tau$，决策规则是：如果图像的得分 $\\geq \\tau$，则将其声明为阳性（患病），否则声明为阴性（非患病）。在阈值 $\\tau$ 下，真阳性率（$\\mathrm{TPR}$，灵敏度）定义为被声明为阳性的患病病例的比例，而假阳性率（$\\mathrm{FPR}$，一减去特异性）是被声明为阳性的非患病病例的比例。\n\n给定三个患病病例的得分 $\\{0.3,\\,0.6,\\,0.9\\}$ 和四个非患病病例的得分 $\\{0.1,\\,0.2,\\,0.4,\\,0.8\\}$。使用上述经验性定义：\n\n1) 通过枚举从给定分数的并集中提取的唯一阈值 $\\tau$，并辅以端点约定 $\\tau\\max$（无病例为阳性）和 $\\tau\\le\\min$（所有病例为阳性），来构建经验ROC曲线。对于每个阈值，计算对应的点 $(\\mathrm{FPR},\\,\\mathrm{TPR})$。\n\n2) 根据经验ROC曲线，通过对沿$\\mathrm{FPR}$轴的连续点之间形成的梯形面积求和，计算曲线下面积 (AUC)。\n\n将最终的AUC表示为一个精确的分数。不需要单位。",
            "solution": "该问题要求针对一组给定的分类器得分，构建经验ROC曲线并计算该曲线下面积 (AUC)。\n\n首先，我们确定给定的信息。患病病例的得分集合为 $S_D = \\{0.3, 0.6, 0.9\\}$，患病病例数为 $N_D = 3$。非患病病例的得分集合为 $S_{ND} = \\{0.1, 0.2, 0.4, 0.8\\}$，非患病病例数为 $N_{ND} = 4$。\n\n一个决策阈值 $\\tau$ 应用于这些得分。如果一个病例的得分大于或等于 $\\tau$，则被分类为阳性。\n真阳性率 $\\mathrm{TPR}(\\tau)$ 是得分 $\\geq \\tau$ 的患病病例所占的比例：\n$$ \\mathrm{TPR}(\\tau) = \\frac{|\\{s \\in S_D \\mid s \\geq \\tau\\}|}{N_D} $$\n假阳性率 $\\mathrm{FPR}(\\tau)$ 是得分 $\\geq \\tau$ 的非患病病例所占的比例：\n$$ \\mathrm{FPR}(\\tau) = \\frac{|\\{s \\in S_{ND} \\mid s \\geq \\tau\\}|}{N_{ND}} $$\nROC曲线是对于所有可能的阈值 $\\tau$，$\\mathrm{TPR}$ 相对于 $\\mathrm{FPR}$ 的图。\n\n第1部分：构建经验ROC曲线。\n经验ROC曲线的顶点是通过考虑取值为给定分数值的阈值来生成的。一种标准方法是将所有得分按降序排序，然后将阈值依次向下移动过每个得分。这会在$\\mathrm{FPR}$-$\\mathrm{TPR}$平面上生成一条路径。\n合并后的得分集合，按降序排列并标注其类别（D代表患病，ND代表非患病），为：\n$0.9(\\text{D}), 0.8(\\text{ND}), 0.6(\\text{D}), 0.4(\\text{ND}), 0.3(\\text{D}), 0.2(\\text{ND}), 0.1(\\text{ND})$\n\n曲线从点 $(0, 0)$ 开始，这对应于阈值 $\\tau  0.9$ 的情况，此时没有病例被分类为阳性。随着阈值的降低，每遇到一个患病病例，曲线向上移动一个步长 $\\frac{1}{N_D} = \\frac{1}{3}$。每遇到一个非患病病例，曲线向右移动一个步长 $\\frac{1}{N_{ND}} = \\frac{1}{4}$。\n\n设ROC曲线上的有序点为 $(x_i, y_i)$，其中 $x_i = \\mathrm{FPR}$ 且 $y_i = \\mathrm{TPR}$。\n1.  从点 $p_0 = (x_0, y_0) = (0, 0)$ 开始。\n2.  最高分是 $0.9$，来自一个患病病例。曲线向上移动。$p_1 = (0, 0 + \\frac{1}{3}) = (0, \\frac{1}{3})$。\n3.  下一个分数是 $0.8$，来自一个非患病病例。曲线向右移动。$p_2 = (0 + \\frac{1}{4}, \\frac{1}{3}) = (\\frac{1}{4}, \\frac{1}{3})$。\n4.  下一个分数是 $0.6$，来自一个患病病例。曲线向上移动。$p_3 = (\\frac{1}{4}, \\frac{1}{3} + \\frac{1}{3}) = (\\frac{1}{4}, \\frac{2}{3})$。\n5.  下一个分数是 $0.4$，来自一个非患病病例。曲线向右移动。$p_4 = (\\frac{1}{4} + \\frac{1}{4}, \\frac{2}{3}) = (\\frac{1}{2}, \\frac{2}{3})$。\n6.  下一个分数是 $0.3$，来自一个患病病例。曲线向上移动。$p_5 = (\\frac{1}{2}, \\frac{2}{3} + \\frac{1}{3}) = (\\frac{1}{2}, 1)$。\n7.  下一个分数是 $0.2$，来自一个非患病病例。曲线向右移动。$p_6 = (\\frac{1}{2} + \\frac{1}{4}, 1) = (\\frac{3}{4}, 1)$。\n8.  最后一个分数是 $0.1$，来自一个非患病病例。曲线向右移动。$p_7 = (\\frac{3}{4} + \\frac{1}{4}, 1) = (1, 1)$。\n\n经验ROC曲线的顶点序列是：\n$p_0 = (0, 0)$\n$p_1 = (0, \\frac{1}{3})$\n$p_2 = (\\frac{1}{4}, \\frac{1}{3})$\n$p_3 = (\\frac{1}{4}, \\frac{2}{3})$\n$p_4 = (\\frac{1}{2}, \\frac{2}{3})$\n$p_5 = (\\frac{1}{2}, 1)$\n$p_6 = (\\frac{3}{4}, 1)$\n$p_7 = (1, 1)$\n\n第2部分：计算曲线下面积 (AUC)。\nAUC是通过对由连续点 $(x_{i-1}, y_{i-1})$ 和 $(x_i, y_i)$ 与 $\\mathrm{FPR}$ 轴所形成的梯形面积求和来计算的。每个梯形的面积由以下公式给出：\n$$ A_i = (x_i - x_{i-1}) \\times \\frac{y_i + y_{i-1}}{2} $$\n总AUC是这些面积的和：\n$$ \\mathrm{AUC} = \\sum_{i=1}^{7} A_i = \\sum_{i=1}^{7} (x_i - x_{i-1}) \\times \\frac{y_i + y_{i-1}}{2} $$\n我们计算曲线每个部分的面积：\n-   在 $p_0$ 和 $p_1$ 之间的面积：$A_1 = (0 - 0) \\times \\frac{\\frac{1}{3} + 0}{2} = 0$。\n-   在 $p_1$ 和 $p_2$ 之间的面积：$A_2 = (\\frac{1}{4} - 0) \\times \\frac{\\frac{1}{3} + \\frac{1}{3}}{2} = \\frac{1}{4} \\times \\frac{1}{3} = \\frac{1}{12}$。\n-   在 $p_2$ 和 $p_3$ 之间的面积：$A_3 = (\\frac{1}{4} - \\frac{1}{4}) \\times \\frac{\\frac{2}{3} + \\frac{1}{3}}{2} = 0$。\n-   在 $p_3$ 和 $p_4$ 之间的面积：$A_4 = (\\frac{1}{2} - \\frac{1}{4}) \\times \\frac{\\frac{2}{3} + \\frac{2}{3}}{2} = \\frac{1}{4} \\times \\frac{2}{3} = \\frac{2}{12} = \\frac{1}{6}$。\n-   在 $p_4$ 和 $p_5$ 之间的面积：$A_5 = (\\frac{1}{2} - \\frac{1}{2}) \\times \\frac{1 + \\frac{2}{3}}{2} = 0$。\n-   在 $p_5$ 和 $p_6$ 之间的面积：$A_6 = (\\frac{3}{4} - \\frac{1}{2}) \\times \\frac{1 + 1}{2} = \\frac{1}{4} \\times 1 = \\frac{1}{4}$。\n-   在 $p_6$ 和 $p_7$ 之间的面积：$A_7 = (1 - \\frac{3}{4}) \\times \\frac{1 + 1}{2} = \\frac{1}{4} \\times 1 = \\frac{1}{4}$。\n\n总AUC是这些单个面积的和：\n$$ \\mathrm{AUC} = 0 + \\frac{1}{12} + 0 + \\frac{1}{6} + 0 + \\frac{1}{4} + \\frac{1}{4} $$\n为了对这些分数求和，我们找到一个公分母，即 $12$：\n$$ \\mathrm{AUC} = \\frac{1}{12} + \\frac{2}{12} + \\frac{3}{12} + \\frac{3}{12} = \\frac{1+2+3+3}{12} = \\frac{9}{12} $$\n简化分数得到最终结果：\n$$ \\mathrm{AUC} = \\frac{3}{4} $$\n这个结果可以使用Wilcoxon-Mann-Whitney U统计量进行验证，该统计量指出，AUC是一个随机选择的患病病例得分高于一个随机选择的非患病病例得分的概率。一个患病病例和一个非患病病例组成的配对数量为 $N_D \\times N_{ND} = 3 \\times 4 = 12$。其中患病病例得分较高的配对数量为 $9$。因此，AUC为 $\\frac{9}{12} = \\frac{3}{4}$，这证实了我们的计算。",
            "answer": "$$\\boxed{\\frac{3}{4}}$$"
        },
        {
            "introduction": "虽然经验ROC曲线对于评估现有数据非常有用，但理论模型使我们能够从更根本的层面理解和预测诊断性能。本练习将介绍经典的“双正态模型”，其中患病和非患病群体的得分被假定服从高斯分布。你将从第一性原理出发，推导并计算理论AUC，从而深入理解分布参数（如均值和方差）如何直接影响诊断测试的区分能力。",
            "id": "4918289",
            "problem": "一种源自医学成像模式的诊断评分系统为每位受试者分配一个连续的分数。设非患病受试者的分数被建模为高斯随机变量 $S_{0} \\sim \\mathcal{N}(0, 1)$，而患病受试者的分数被建模为独立的高斯随机变量 $S_{1} \\sim \\mathcal{N}(1, 2^{2})$。在双正态模型下，受试者工作特征（ROC）曲线是通过对分数进行阈值处理生成的。使用检测理论和概率论的基本定义，从第一性原理计算该模型的受试者工作特征曲线下面积（AUC），从 AUC 等于随机选择的患病受试者的分数高于随机选择的非患病受试者的分数的概率这一条定义开始。提供保留4位有效数字的 $AUC$ 最终数值。然后，简要讨论该值对诊断性能的意义，以及与等方差情景相比，不等方差如何影响 $AUC$。仅报告数值 $AUC$ 作为您的最终答案。",
            "solution": "该问题要求计算一项诊断测试的AUC。非患病受试者的分数由随机变量 $S_0 \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$ 给出，其中均值 $\\mu_0 = 0$，方差 $\\sigma_0^2 = 1$。患病受试者的分数由独立的随机变量 $S_1 \\sim \\mathcal{N}(\\mu_1, \\sigma_1^2)$ 给出，其中均值 $\\mu_1 = 1$，方差 $\\sigma_1^2 = 2^2 = 4$。\n\nAUC 从第一性原理定义为随机选择的患病受试者的分数高于随机选择的非患病受试者的分数的概率。在数学上，这表示为：\n$$\nAUC = P(S_1 > S_0)\n$$\n为了计算这个概率，我们可以定义一个新的随机变量 $D$，作为患病受试者和非患病受试者分数之间的差值：\n$$\nD = S_1 - S_0\n$$\n概率 $P(S_1 > S_0)$ 等价于 $P(D > 0)$。\n\n由于 $S_1$ 和 $S_0$ 是独立的高斯随机变量，它们的差 $D$ 也是一个高斯随机变量。$D$ 的均值，记为 $\\mu_D$，是 $S_1$ 和 $S_0$ 均值的差：\n$$\n\\mu_D = E[D] = E[S_1 - S_0] = E[S_1] - E[S_0] = \\mu_1 - \\mu_0 = 1 - 0 = 1\n$$\n$D$ 的方差，记为 $\\sigma_D^2$，是 $S_1$ 和 $S_0$ 方差的和，因为它们是独立变量：\n$$\n\\sigma_D^2 = \\text{Var}(D) = \\text{Var}(S_1 - S_0) = \\text{Var}(S_1) + \\text{Var}(-S_0) = \\text{Var}(S_1) + (-1)^2 \\text{Var}(S_0) = \\sigma_1^2 + \\sigma_0^2 = 4 + 1 = 5\n$$\n因此，差值变量 $D$ 的分布是 $D \\sim \\mathcal{N}(1, 5)$。\n\n现在我们计算概率 $P(D > 0)$。为此，我们使用变换 $Z = \\frac{D - \\mu_D}{\\sigma_D}$ 将随机变量 $D$ 标准化为一个标准正态变量 $Z \\sim \\mathcal{N}(0, 1)$：\n$$\nP(D > 0) = P\\left(\\frac{D - \\mu_D}{\\sigma_D} > \\frac{0 - \\mu_D}{\\sigma_D}\\right)\n$$\n代入值 $\\mu_D = 1$ 和 $\\sigma_D = \\sqrt{5}$：\n$$\nP(D > 0) = P\\left(Z > \\frac{-1}{\\sqrt{5}}\\right)\n$$\n设 $\\Phi(z)$ 为标准正态分布的累积分布函数（CDF），定义为 $\\Phi(z) = P(Z \\leq z)$。概率 $P(Z > a)$ 等于 $1 - P(Z \\leq a) = 1 - \\Phi(a)$。\n$$\nP\\left(Z > \\frac{-1}{\\sqrt{5}}\\right) = 1 - \\Phi\\left(\\frac{-1}{\\sqrt{5}}\\right)\n$$\n使用标准正态分布的对称性质 $\\Phi(-z) = 1 - \\Phi(z)$，我们可以重写该表达式：\n$$\nAUC = 1 - \\left(1 - \\Phi\\left(\\frac{1}{\\sqrt{5}}\\right)\\right) = \\Phi\\left(\\frac{1}{\\sqrt{5}}\\right)\n$$\n这个结果符合双正态模型 AUC 的通用公式：$AUC = \\Phi\\left(\\frac{\\mu_1 - \\mu_0}{\\sqrt{\\sigma_1^2 + \\sigma_0^2}}\\right)$。\n\n为了求出数值，我们首先计算 $\\Phi$ 的自变量：\n$$\n\\frac{1}{\\sqrt{5}} \\approx \\frac{1}{2.2360679...} \\approx 0.4472136\n$$\n然后我们计算此值处的标准正态 CDF：\n$$\nAUC = \\Phi(0.4472136) \\approx 0.672635\n$$\n四舍五入到4位有效数字，我们得到 $AUC = 0.6726$。\n\n关于此结果的简要讨论：\nAUC 为 $1.0$ 代表完美的诊断测试，而 AUC 为 $0.5$ 代表没有诊断能力的测试（等同于随机猜测）。计算出的 $AUC \\approx 0.6726$ 值表明诊断性能优于随机，但通常被认为是较差到一般的水平。它意味着从患病人群中随机抽取的受试者比从非患病人群中随机抽取的受试者得分更高的概率为 $67.26\\%$。\n\n不等方差对AUC有显著影响。$\\Phi$ 自变量的分母是 $\\sqrt{\\sigma_1^2 + \\sigma_0^2} = \\sqrt{5}$。让我们考虑一个可比较的等方差情景，其中两个分布的方差与非患病人群的方差相同，即 $\\sigma_0^2 = \\sigma_1^2 = 1$。在这种情况下，AUC将是：\n$$\nAUC_{eq} = \\Phi\\left(\\frac{1 - 0}{\\sqrt{1^2 + 1^2}}\\right) = \\Phi\\left(\\frac{1}{\\sqrt{2}}\\right) \\approx \\Phi(0.7071) \\approx 0.7602\n$$\n在给定问题中，AUC ($0.6726$) 低于此等方差情况下的值 ($0.7602$)。原因是AUC对差值的总方差 $\\sigma_1^2 + \\sigma_0^2$ 很敏感。患病人群的较大方差 ($\\sigma_1^2 = 4$) 显著增加了这个和，导致项 $\\frac{\\mu_1 - \\mu_0}{\\sqrt{\\sigma_1^2 + \\sigma_0^2}}$ 中分母更大。对于单调递增函数 $\\Phi(z)$ 来说，一个较小的自变量会导致一个较小的AUC。本质上，患病受试者分数的更大离散度（方差）导致其与非患病受试者分数的重叠更多，从而降低了测试的区分能力。",
            "answer": "$$\n\\boxed{0.6726}\n$$"
        }
    ]
}