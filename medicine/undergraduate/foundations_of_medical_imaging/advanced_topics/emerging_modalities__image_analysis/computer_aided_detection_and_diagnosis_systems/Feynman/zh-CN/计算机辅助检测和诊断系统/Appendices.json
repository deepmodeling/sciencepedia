{
    "hands_on_practices": [
        {
            "introduction": "计算机辅助检测（CAD）系统的基本任务是根据从图像中提取的特征来区分“有病”和“无病”两种状态。本练习将指导你推导“Hotelling观察者”，这是一种在常见的多元高斯统计模型下的理想线性分类器。通过这个实践，你将掌握如何通过最大化决策信噪比（Signal-to-Noise Ratio）来实现类别之间的最佳分离，这是信号检测理论中的一个核心原则。",
            "id": "4871522",
            "problem": "在一个用于医学成像的计算机辅助检测（CAD）系统中，假设从图像中提取的特征向量（表示为 $\\mathbf{x} \\in \\mathbb{R}^{n}$）被建模为来自以下两种假设之一：$H_{0}$（无疾病）或 $H_{1}$（有疾病）。假设基于经过充分检验的统计原理，存在以下生成模型：在假设 $H_{i}$ 下，$\\mathbf{x}$ 服从均值为 $\\boldsymbol{\\mu}_{i} \\in \\mathbb{R}^{n}$、协方差矩阵为公共对称正定矩阵 $\\boldsymbol{\\Sigma} \\in \\mathbb{R}^{n \\times n}$ 的多元高斯分布，因此\n$$\n\\mathbf{x} \\mid H_{i} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_{i}, \\boldsymbol{\\Sigma}), \\quad i \\in \\{0,1\\}。\n$$\n一个线性观察者通过某个模板 $\\mathbf{w} \\in \\mathbb{R}^{n}$ 形成一个标量检验统计量 $T = \\mathbf{w}^{\\mathsf{T}} \\mathbf{x}$。设计目标是最大化决策信噪比（SNR），其定义为\n$$\nd'(\\mathbf{w}) \\equiv \\frac{\\mathbb{E}[T \\mid H_{1}] - \\mathbb{E}[T \\mid H_{0}]}{\\sqrt{\\operatorname{Var}[T \\mid H_{0}]}}。\n$$\n\n从多元高斯随机向量线性变换的基本性质以及均值和协方差的定义出发：\n\n- 推导 $\\mathbb{E}[T \\mid H_{i}]$ 和 $\\operatorname{Var}[T \\mid H_{i}]$ 关于 $\\mathbf{w}$、$\\boldsymbol{\\mu}_{i}$ 和 $\\boldsymbol{\\Sigma}$ 的表达式。\n- 将 $d'(\\mathbf{w})$ 明确地表示为关于 $\\mathbf{w}$、$\\boldsymbol{\\mu}_{0}$、$\\boldsymbol{\\mu}_{1}$ 和 $\\boldsymbol{\\Sigma}$ 的函数。\n- 使用基本原理（例如，约束优化）确定使 $d'(\\mathbf{w})$ 最大化的模板 $\\mathbf{w}$，并提供其关于 $\\boldsymbol{\\mu}_{0}$、$\\boldsymbol{\\mu}_{1}$ 和 $\\boldsymbol{\\Sigma}$ 的闭式表达式。\n- 对于此最优模板，推导在假设 $H_{0}$ 和 $H_{1}$ 下 $T$ 的分布，并分别指明其均值和方差。\n- 最后，将最优可检测性指数 $d'_{\\star}$（即 $d'(\\mathbf{w})$ 的最大值）写成一个关于 $\\boldsymbol{\\mu}_{0}$、$\\boldsymbol{\\mu}_{1}$ 和 $\\boldsymbol{\\Sigma}$ 的闭式解析表达式。\n\n您提交的答案必须仅为 $d'_{\\star}$ 的最终单个闭式表达式，不带单位，并按要求括起来。请勿在最终答案框中提供中间步骤。无需四舍五入；请提供精确表达式。",
            "solution": "问题陈述具有科学依据、提法恰当且客观。它提出了一个统计信号处理和模式识别中的标准任务，具体来说是推导具有高斯分布和相等协方差的两个类别的最优线性分类器。所有提供的信息都是自洽和一致的。因此，该问题是有效的，我们可以继续进行求解。\n\n该问题要求进行一系列与二元信号检测任务中线性观察者相关的推导。我们将按顺序处理每个部分。\n\n首先，我们推导检验统计量 $T = \\mathbf{w}^{\\mathsf{T}} \\mathbf{x}$ 的条件期望和条件方差的表达式。特征向量 $\\mathbf{x}$ 在条件 $H_i$ 下的分布为 $\\mathbf{x} \\mid H_{i} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_{i}, \\boldsymbol{\\Sigma})$，其中 $i \\in \\{0, 1\\}$。\n\n期望 $\\mathbb{E}[\\cdot]$ 是一个线性算子。对于一个常数向量 $\\mathbf{w}$，$T$ 的条件期望为：\n$$\n\\mathbb{E}[T \\mid H_{i}] = \\mathbb{E}[\\mathbf{w}^{\\mathsf{T}} \\mathbf{x} \\mid H_{i}] = \\mathbf{w}^{\\mathsf{T}} \\mathbb{E}[\\mathbf{x} \\mid H_{i}]\n$$\n使用给定的均值 $\\mathbb{E}[\\mathbf{x} \\mid H_{i}] = \\boldsymbol{\\mu}_{i}$，我们得到：\n$$\n\\mathbb{E}[T \\mid H_{i}] = \\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\mu}_{i}\n$$\n\n接下来，我们求条件方差。对于一个协方差矩阵为 $\\operatorname{Cov}[\\mathbf{y}]$ 的随机向量 $\\mathbf{y}$ 和一个常数矩阵 $\\mathbf{A}$，变换后向量 $\\mathbf{A}\\mathbf{y}$ 的协方差为 $\\mathbf{A} \\operatorname{Cov}[\\mathbf{y}] \\mathbf{A}^{\\mathsf{T}}$。在这里，$T$ 是一个标量，因此 $\\mathbf{w}^{\\mathsf{T}}$ 充当矩阵 $\\mathbf{A}$ 的角色。$T$ 的方差是：\n$$\n\\operatorname{Var}[T \\mid H_{i}] = \\operatorname{Var}[\\mathbf{w}^{\\mathsf{T}} \\mathbf{x} \\mid H_{i}] = \\mathbf{w}^{\\mathsf{T}} \\operatorname{Cov}[\\mathbf{x} \\mid H_{i}] \\mathbf{w}\n$$\n使用给定的公共协方差矩阵 $\\operatorname{Cov}[\\mathbf{x} \\mid H_{i}] = \\boldsymbol{\\Sigma}$，我们有：\n$$\n\\operatorname{Var}[T \\mid H_{i}] = \\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}\n$$\n注意到 $T$ 的方差在两种假设下是相同的，所以我们可以写作 $\\operatorname{Var}[T] = \\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}$。\n\n现在，我们使用这些结果来表示决策信噪比（SNR），即 $d'(\\mathbf{w})$。将推导出的表达式代入 $d'(\\mathbf{w})$ 的定义中：\n$$\nd'(\\mathbf{w}) = \\frac{\\mathbb{E}[T \\mid H_{1}] - \\mathbb{E}[T \\mid H_{0}]}{\\sqrt{\\operatorname{Var}[T \\mid H_{0}]}} = \\frac{\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\mu}_{1} - \\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\mu}_{0}}{\\sqrt{\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}}}\n$$\n利用转置运算的线性性质，我们合并分子中的项：\n$$\nd'(\\mathbf{w}) = \\frac{\\mathbf{w}^{\\mathsf{T}} (\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0})}{\\sqrt{\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}}}\n$$\n\n下一步是找到使 $d'(\\mathbf{w})$ 最大化的模板向量 $\\mathbf{w}$。令 $\\Delta \\boldsymbol{\\mu} = \\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0}$。SNR 的表达式变为：\n$$\nd'(\\mathbf{w}) = \\frac{\\mathbf{w}^{\\mathsf{T}} \\Delta \\boldsymbol{\\mu}}{\\sqrt{\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}}}\n$$\n由于 $\\boldsymbol{\\Sigma}$ 是对称正定的，存在一个对称正定的平方根矩阵 $\\boldsymbol{\\Sigma}^{1/2}$，使得 $\\boldsymbol{\\Sigma} = \\boldsymbol{\\Sigma}^{1/2} \\boldsymbol{\\Sigma}^{1/2}$。我们定义新向量 $\\mathbf{u} = \\boldsymbol{\\Sigma}^{1/2} \\mathbf{w}$ 和 $\\mathbf{v} = \\boldsymbol{\\Sigma}^{-1/2} \\Delta \\boldsymbol{\\mu}$。那么 $\\mathbf{w} = \\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u}$。将这些代入 $d'(\\mathbf{w})$ 的表达式中：\n分子变为：$\\mathbf{w}^{\\mathsf{T}} \\Delta \\boldsymbol{\\mu} = (\\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u})^{\\mathsf{T}} (\\boldsymbol{\\Sigma}^{1/2} \\mathbf{v}) = \\mathbf{u}^{\\mathsf{T}} (\\boldsymbol{\\Sigma}^{-1/2})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{1/2} \\mathbf{v} = \\mathbf{u}^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1/2} \\boldsymbol{\\Sigma}^{1/2} \\mathbf{v} = \\mathbf{u}^{\\mathsf{T}} \\mathbf{v}$。\n分母中的项变为：$\\mathbf{w}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w} = (\\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u})^{\\mathsf{T}} \\boldsymbol{\\Sigma} (\\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u}) = \\mathbf{u}^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1/2} \\boldsymbol{\\Sigma} \\boldsymbol{\\Sigma}^{-1/2} \\mathbf{u} = \\mathbf{u}^{\\mathsf{T}} \\mathbf{u} = \\|\\mathbf{u}\\|_{2}^{2}$。\n因此，SNR 变换为：\n$$\nd'(\\mathbf{w}) = \\frac{\\mathbf{u}^{\\mathsf{T}} \\mathbf{v}}{\\sqrt{\\|\\mathbf{u}\\|_{2}^{2}}} = \\frac{\\mathbf{u}^{\\mathsf{T}} \\mathbf{v}}{\\|\\mathbf{u}\\|_{2}}\n$$\n根据柯西-施瓦茨不等式，有 $|\\mathbf{u}^{\\mathsf{T}} \\mathbf{v}| \\le \\|\\mathbf{u}\\|_{2} \\|\\mathbf{v}\\|_{2}$。因此，\n$$\n|d'(\\mathbf{w})| \\le \\frac{\\|\\mathbf{u}\\|_{2} \\|\\mathbf{v}\\|_{2}}{\\|\\mathbf{u}\\|_{2}} = \\|\\mathbf{v}\\|_{2}\n$$\n当柯西-施瓦茨不等式取等号时，$d'(\\mathbf{w})$ 达到最大值，这发生在向量 $\\mathbf{u}$ 与 $\\mathbf{v}$ 共线时，即对于某个标量 $c > 0$，有 $\\mathbf{u} = c\\mathbf{v}$。\n代回 $\\mathbf{w}$、$\\Delta \\boldsymbol{\\mu}$ 和 $\\boldsymbol{\\Sigma}$：\n$$\n\\boldsymbol{\\Sigma}^{1/2} \\mathbf{w}_{\\star} = c (\\boldsymbol{\\Sigma}^{-1/2} \\Delta \\boldsymbol{\\mu})\n$$\n$$\n\\mathbf{w}_{\\star} = c \\boldsymbol{\\Sigma}^{-1/2} \\boldsymbol{\\Sigma}^{-1/2} \\Delta \\boldsymbol{\\mu} = c \\boldsymbol{\\Sigma}^{-1} \\Delta \\boldsymbol{\\mu}\n$$\n$\\mathbf{w}$ 的大小与 $d'(\\mathbf{w})$ 的值无关（它对于 $\\mathbf{w}$ 乘以一个正常数是不变的）。因此，我们可以选择 $c=1$。最优模板，通常称为预白化匹配滤波器，是：\n$$\n\\mathbf{w}_{\\star} = \\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})\n$$\n\n现在，我们确定在该最优模板 $\\mathbf{w}_{\\star}$ 下，每个假设下 $T$ 的分布。由于 $\\mathbf{x}$ 是一个多元高斯随机向量，它的任何线性变换，例如 $T = \\mathbf{w}_{\\star}^{\\mathsf{T}} \\mathbf{x}$，都是一个单变量高斯随机变量。其分布完全由其均值和方差决定。\n在假设 $H_{i}$ 下的均值为：\n$$\n\\mathbb{E}[T \\mid H_{i}] = \\mathbf{w}_{\\star}^{\\mathsf{T}} \\boldsymbol{\\mu}_{i} = (\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}))^{\\mathsf{T}} \\boldsymbol{\\mu}_{i} = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_{i} \\quad (\\text{因为 } \\boldsymbol{\\Sigma}^{-1} \\text{ 是对称的})\n$$\n方差对两个假设是共同的，由下式给出：\n$$\n\\operatorname{Var}[T] = \\mathbf{w}_{\\star}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}_{\\star} = (\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}))^{\\mathsf{T}} \\boldsymbol{\\Sigma} (\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}))\n$$\n$$\n\\operatorname{Var}[T] = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\Sigma} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}) = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})\n$$\n因此，分布为：\n$T \\mid H_{0} \\sim \\mathcal{N}\\left( (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_{0}, (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}) \\right)$\n$T \\mid H_{1} \\sim \\mathcal{N}\\left( (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} \\boldsymbol{\\mu}_{1}, (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}) \\right)$\n\n最后，我们推导最优可检测性指数 $d'_{\\star}$，即 $d'(\\mathbf{w})$ 在 $\\mathbf{w} = \\mathbf{w}_{\\star}$ 处的值。\n$$\nd'_{\\star} = d'(\\mathbf{w}_{\\star}) = \\frac{\\mathbf{w}_{\\star}^{\\mathsf{T}} (\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0})}{\\sqrt{\\mathbf{w}_{\\star}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}_{\\star}}}\n$$\n分子是：\n$$\n\\mathbf{w}_{\\star}^{\\mathsf{T}} (\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0}) = (\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}))^{\\mathsf{T}} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0}) = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})\n$$\n分母平方根下的项是：\n$$\n\\mathbf{w}_{\\star}^{\\mathsf{T}} \\boldsymbol{\\Sigma} \\mathbf{w}_{\\star} = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})\n$$\n这与分子的表达式相同。令这个标量值为 $M^{2} = (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})$。该量是 $\\boldsymbol{\\mu}_{1}$ 和 $\\boldsymbol{\\mu}_{0}$ 之间马氏距离的平方。由于 $\\boldsymbol{\\Sigma}^{-1}$ 是正定的，所以 $M^{2} \\ge 0$。\n将此代入 $d'_{\\star}$ 的表达式中：\n$$\nd'_{\\star} = \\frac{M^2}{\\sqrt{M^2}} = \\frac{M^2}{|M|}\n$$\n假设 $\\boldsymbol{\\mu}_{1} \\neq \\boldsymbol{\\mu}_{0}$，则 $M > 0$，因此 $d'_{\\star} = M$。\n所以，最优可检测性指数是：\n$$\nd'_{\\star} = \\sqrt{(\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1}-\\boldsymbol{\\mu}_{0})}\n$$\n这就是所要求的最终闭式解析表达式。",
            "answer": "$$\n\\boxed{\\sqrt{(\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0})^{\\mathsf{T}} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{0})}}\n$$"
        },
        {
            "introduction": "在设计出分类器后，我们需要一个稳健的方法来衡量其区分性能。本练习聚焦于受试者工作特征曲线下面积（Area Under the ROC Curve, AUC），这是一个评估诊断模型性能的黄金标准。你不仅将从一组给定的模型分数中计算AUC值，还将学习使用DeLong方法估算其方差，这对于统计比较不同模型的性能至关重要。",
            "id": "4871482",
            "problem": "一个计算机辅助诊断 (CADx) 系统产生连续的置信度分数，旨在区分患病患者和未患病患者。考虑一个二元分类任务，其中该系统在一个包含 $m$ 个真阳性病例和 $n$ 个真阴性病例的测试集上进行评估。受试者工作特征 (ROC) 曲线定义为当决策阈值在实数线上变化时，真阳性率对假阳性率的参数轨迹。ROC 曲线下面积 (AUC) 是我们关注的预期性能指标。\n\n严格从这些基本定义出发，推导与基于正类和负类分数之间成对比较的 Mann–Whitney 公式一致的 AUC 估计量。您的推导必须从对阈值决策的 ROC 曲线的解释开始，并以成对比较的封闭形式经验估计量结束，同时阐明当两个分数相等时比较如何贡献。\n\n然后，使用您推导的估计量，为以下 CADx 分数评估 AUC。$m=4$ 个正类分数是 $s=(0.92,\\,0.87,\\,0.55,\\,0.60)$，$n=5$ 个负类分数是 $t=(0.80,\\,0.58,\\,0.40,\\,0.62,\\,0.55)$。最后，使用 DeLong 方法计算 AUC 的估计方差，该方法将 AUC 估计量建模为 U-统计量，并考虑了在所有成对比较中重复使用相同受试者所引起的相关性。将您最终的方差估计值四舍五入到四位有效数字。以小数形式表示答案，不带百分号。",
            "solution": "该问题需要一个三部分的回应：首先，从 ROC 曲线的定义出发，推导 ROC 曲线下面积 (AUC) 的 Mann-Whitney U-统计量估计量；其次，为给定的一组分数计算此 AUC 估计量；第三，使用 DeLong 方法估计此 AUC 估计量的方差。\n\n### 1. AUC 估计量的推导\n\n设 $S$ 是来自真阳性病例的连续值分数， $T$ 是来自真阴性病例的分数。设 $F_S(s) = P(S \\le s)$ 和 $F_T(t) = P(T \\le t)$ 分别是它们的累积分布函数 (CDF)， $f_S(s)$ 和 $f_T(t)$ 是它们的概率密度函数 (PDF)。\n\n使用决策阈值 $\\tau$ 对病例进行分类，如果其分数超过 $\\tau$，则分类为阳性。真阳性率 (TPR) 和假阳性率 (FPR) 是该阈值的函数：\n$$ TPR(\\tau) = P(S > \\tau) = 1 - F_S(\\tau) $$\n$$ FPR(\\tau) = P(T > \\tau) = 1 - F_T(\\tau) $$\nROC 曲线是对于 $\\tau \\in (-\\infty, \\infty)$ 的点 $(FPR(\\tau), TPR(\\tau))$ 的轨迹。它是 $TPR$ 作为 $FPR$ 函数的图像。设 $x = FPR(\\tau)$。ROC 曲线是函数 $y = R(x)$，其中 $x \\in [0, 1]$。\n\nROC 曲线下面积 (AUC) 定义为 ROC 曲线从 $FPR=0$ 到 $FPR=1$ 的积分：\n$$ AUC = \\int_{0}^{1} R(x) \\, dx $$\n为了计算这个积分，我们将积分变量从 $x$ 更改为 $\\tau$。从 $x = FPR(\\tau) = 1 - F_T(\\tau)$，我们得到 $dx = -f_T(\\tau) d\\tau$。积分的上下限也随之改变：当 $\\tau$ 从 $-\\infty$ 变化到 $+\\infty$ 时， $x$ 从 $1$ 变化到 $0$。\n函数 $R(x)$ 是用 $x$ 表示的 $TPR$。我们有 $R(x) = TPR(\\tau) = 1 - F_S(\\tau)$。\n将这些代入积分：\n$$ AUC = \\int_{x=0}^{x=1} R(x) \\, dx = \\int_{\\tau=+\\infty}^{\\tau=-\\infty} (1 - F_S(\\tau)) (-f_T(\\tau)) \\, d\\tau $$\n$$ AUC = \\int_{-\\infty}^{+\\infty} (1 - F_S(\\tau)) f_T(\\tau) \\, d\\tau $$\n这个积分可以从概率的角度来解释。表达式 $(1-F_S(\\tau))$ 是 $P(S>\\tau)$。因此，该积分是 $P(S>\\tau)$ 的期望，其中 $\\tau$ 是一个具有 PDF $f_T(\\tau)$ 的随机变量，也就是负类分数的分布。这等价于 $P(S > T)$。\n让我们通过分部积分法来证实这一点。设 $u = 1 - F_S(\\tau)$ 和 $dv = f_T(\\tau)d\\tau$。则 $du = -f_S(\\tau)d\\tau$ 且 $v = F_T(\\tau)$。\n$$ AUC = \\left[ (1 - F_S(\\tau)) F_T(\\tau) \\right]_{-\\infty}^{+\\infty} - \\int_{-\\infty}^{+\\infty} F_T(\\tau) (-f_S(\\tau)) \\, d\\tau $$\n边界项的值为 $0$，因为 $F_S(\\infty)=1$，$F_T(-\\infty)=0$。\n$$ AUC = \\int_{-\\infty}^{+\\infty} F_T(\\tau) f_S(\\tau) \\, d\\tau $$\n这是 $F_T(S)$ 的期望，对于连续变量，即 $P(T \\leq S)$ 或 $P(S \\geq T)$。因此，AUC 精确地是随机选择一个正类病例的分数高于随机选择一个负类病例分数的概率。\n$$ AUC = P(S > T) $$\n给定来自正类病例的 $m$ 个分数样本 $\\{s_i\\}_{i=1}^m$ 和来自负类病例的 $n$ 个分数样本 $\\{t_j\\}_{j=1}^n$，$AUC = P(S > T)$ 的一个非参数、无偏估计量是满足 $s_i > t_j$ 的配对 $(s_i, t_j)$ 的经验比例。\n我们定义一个比较函数 $\\Psi(x, y)$:\n$$ \\Psi(x, y) = \\begin{cases} 1  & \\text{if } x > y \\\\ \\frac{1}{2}  & \\text{if } x = y \\\\ 0  & \\text{if } x < y \\end{cases} $$\n包含 $x=y$ 的情况是为了处理平局，这在离散或四舍五入的分数中可能发生。赋值为 $\\frac{1}{2}$ 对应于随机打破平局的惯例，并确保估计量对于 $P(S > T) + \\frac{1}{2}P(S = T)$ 保持无偏。\n\nAUC 的经验估计量，记为 $\\hat{\\theta}_{AUC}$，是所有 $m \\times n$ 个配对的 $\\Psi(s_i, t_j)$ 的平均值：\n$$ \\hat{\\theta}_{AUC} = \\frac{1}{mn} \\sum_{i=1}^{m} \\sum_{j=1}^{n} \\Psi(s_i, t_j) $$\n这个公式与 Mann-Whitney U-统计量直接相关。统计量 $U$ 定义为 $U = \\sum_{i=1}^{m} \\sum_{j=1}^{n} \\Psi(s_i, t_j)$。因此，AUC 估计量由下式给出：\n$$ \\hat{\\theta}_{AUC} = \\frac{U}{mn} $$\n推导至此完成。\n\n### 2. AUC 的计算\n\n给定的分数是：\n正类 ($m=4$)：$s = (0.92, 0.87, 0.55, 0.60)$\n负类 ($n=5$)：$t = (0.80, 0.58, 0.40, 0.62, 0.55)$\n\n我们计算成对比较的总和，$U = \\sum_{i=1}^{4} \\sum_{j=1}^{5} \\Psi(s_i, t_j)$。让我们为每个正类分数 $s_i$ 评估其贡献：\n- 对于 $s_1=0.92$：它大于所有 $5$ 个负类分数 $(0.80, 0.58, 0.40, 0.62, 0.55)$。贡献是 $5 \\times 1 = 5$。\n- 对于 $s_2=0.87$：它大于所有 $5$ 个负类分数。贡献是 $5 \\times 1 = 5$。\n- 对于 $s_3=0.60$：它大于 $0.58, 0.40, 0.55$ (3 个分数)。它小于 $0.80, 0.62$ (2 个分数)。贡献是 $3 \\times 1 + 2 \\times 0 = 3$。\n- 对于 $s_4=0.55$：它大于 $0.40$ (1 个分数)。它小于 $0.80, 0.58, 0.62$ (3 个分数)。它等于 $0.55$ (1 个分数)。贡献是 $1 \\times 1 + 3 \\times 0 + 1 \\times \\frac{1}{2} = 1.5$。\n\n总和是 $U = 5 + 5 + 3 + 1.5 = 14.5$。\nAUC 估计值为：\n$$ \\hat{\\theta}_{AUC} = \\frac{U}{mn} = \\frac{14.5}{4 \\times 5} = \\frac{14.5}{20} = 0.725 $$\n\n### 3. 使用 DeLong 方法估计方差\n\nDeLong 方法将 $\\hat{\\theta}_{AUC}$ 视为一个广义 U-统计量，并提供其方差的非参数估计。方差被分解为来自正样本和负样本的贡献。\n\n首先，我们为每个正类和负类病例定义分量。\n对于每个正类病例 $i$，其分量 $V_{10}(s_i)$ 为：\n$$ V_{10}(s_i) = \\frac{1}{n} \\sum_{j=1}^{n} \\Psi(s_i, t_j) $$\n对于每个负类病例 $j$，其分量 $V_{01}(t_j)$ 为：\n$$ V_{01}(t_j) = \\frac{1}{m} \\sum_{i=1}^{m} \\Psi(s_i, t_j) $$\n\n让我们计算这些分量。\n对于正类分数 ($m=4$, $n=5$):\n- $V_{10}(0.92) = \\frac{5}{5} = 1$\n- $V_{10}(0.87) = \\frac{5}{5} = 1$\n- $V_{10}(0.60) = \\frac{3}{5} = 0.6$\n- $V_{10}(0.55) = \\frac{1.5}{5} = 0.3$\n\n对于负类分数 ($m=4$, $n=5$):\n- 对于 $t_j = 0.80$：$s_i>0.80$ 的 $s_i \\in \\{0.92, 0.87\\}$。因此，$\\sum_i \\Psi(s_i, 0.80) = 2$。$V_{01}(0.80) = \\frac{2}{4} = 0.5$。\n- 对于 $t_j = 0.58$：$s_i>0.58$ 的 $s_i \\in \\{0.92, 0.87, 0.60\\}$。因此，$\\sum_i \\Psi(s_i, 0.58) = 3$。$V_{01}(0.58) = \\frac{3}{4} = 0.75$。\n- 对于 $t_j = 0.40$：所有 $4$ 个正类分数都大于 $0.40$。因此，$\\sum_i \\Psi(s_i, 0.40) = 4$。$V_{01}(0.40) = \\frac{4}{4} = 1$。\n- 对于 $t_j = 0.62$：$s_i>0.62$ 的 $s_i \\in \\{0.92, 0.87\\}$。因此，$\\sum_i \\Psi(s_i, 0.62) = 2$。$V_{01}(0.62) = \\frac{2}{4} = 0.5$。\n- 对于 $t_j = 0.55$：$s_i>0.55$ 的 $s_i \\in \\{0.92, 0.87, 0.60\\}$。有一个病例 $s_i=0.55$。因此，$\\sum_i \\Psi(s_i, 0.55) = 3 \\times 1 + 1 \\times 0.5 = 3.5$。$V_{01}(0.55) = \\frac{3.5}{4} = 0.875$。\n\n$\\hat{\\theta}_{AUC}$ 的估计方差由下式给出：\n$$ \\widehat{Var}(\\hat{\\theta}_{AUC}) = \\frac{1}{m} S_{10} + \\frac{1}{n} S_{01} $$\n其中 $S_{10}$ 和 $S_{01}$ 是分量的样本方差：\n$$ S_{10} = \\frac{1}{m-1} \\sum_{i=1}^{m} (V_{10}(s_i) - \\hat{\\theta}_{AUC})^2 $$\n$$ S_{01} = \\frac{1}{n-1} \\sum_{j=1}^{n} (V_{01}(t_j) - \\hat{\\theta}_{AUC})^2 $$\n\n现在，我们计算 $S_{10}$ 和 $S_{01}$。我们有 $\\hat{\\theta}_{AUC}=0.725$。\n对于 $S_{10}$ ($m=4$):\n$V_{10}$ 的值是 $(1, 1, 0.6, 0.3)$。\n$$ \\sum_{i=1}^{4} (V_{10}(s_i) - 0.725)^2 = (1-0.725)^2 + (1-0.725)^2 + (0.6-0.725)^2 + (0.3-0.725)^2 $$\n$$ = (0.275)^2 + (0.275)^2 + (-0.125)^2 + (-0.425)^2 $$\n$$ = 0.075625 + 0.075625 + 0.015625 + 0.180625 = 0.3475 $$\n$$ S_{10} = \\frac{0.3475}{4-1} = \\frac{0.3475}{3} $$\n\n对于 $S_{01}$ ($n=5$):\n$V_{01}$ 的值是 $(0.5, 0.75, 1, 0.5, 0.875)$。\n$$ \\sum_{j=1}^{5} (V_{01}(t_j) - 0.725)^2 = (0.5-0.725)^2 + (0.75-0.725)^2 + (1-0.725)^2 + (0.5-0.725)^2 + (0.875-0.725)^2 $$\n$$ = (-0.225)^2 + (0.025)^2 + (0.275)^2 + (-0.225)^2 + (0.15)^2 $$\n$$ = 0.050625 + 0.000625 + 0.075625 + 0.050625 + 0.0225 = 0.2 $$\n$$ S_{01} = \\frac{0.2}{5-1} = \\frac{0.2}{4} = 0.05 $$\n\n最后，我们计算总方差：\n$$ \\widehat{Var}(\\hat{\\theta}_{AUC}) = \\frac{1}{4} S_{10} + \\frac{1}{5} S_{01} = \\frac{1}{4} \\left( \\frac{0.3475}{3} \\right) + \\frac{1}{5} (0.05) $$\n$$ = \\frac{0.3475}{12} + 0.01 $$\n$$ \\approx 0.02895833... + 0.01 = 0.03895833... $$\n将最终方差估计值四舍五入到四位有效数字，我们得到 $0.03896$。",
            "answer": "$$\n\\boxed{0.03896}\n$$"
        },
        {
            "introduction": "一个计算机辅助诊断（CADx）系统通常会输出一个关于疾病存在的概率，但临床应用的最终目标是做出决策。本练习将演示如何运用决策理论来确定用于触发警报的最佳概率阈值。通过权衡不同类型错误（即假阳性和假阴性）所带来的代价，我们可以将模型的概率输出转化为一个能够最大化预期效用的决策策略，从而将抽象的概率与具体的临床行动联系起来。",
            "id": "4871526",
            "problem": "一家医院部署了一套计算机辅助检测和诊断系统（CADx），用于对低剂量计算机断层扫描上的肺结节进行分诊。对于每个候选结节，CADx模型会输出一个校准过的恶性肿瘤后验概率 $p$，其中“校准”意味着 $p$ 等于真实的条件概率 $\\mathbb{P}(Y=1 \\mid \\text{features})$。分诊策略是一个阈值规则：如果 $p \\geq t$，则向放射科医生发出警报；否则不发出警报。\n\n为了形式化决策质量，定义一个单例效用函数，其中正确决策的基线效用为 $0$，假阳性产生效用 $-c_{\\mathrm{FP}}$，假阴性产生效用 $-c_{\\mathrm{FN}}$。假设医院的卫生经济学分析得出，以可比较的效用损失单位计，$c_{\\mathrm{FP}}=3$ 且 $c_{\\mathrm{FN}}=57$。\n\n在一个校准过的概率模型下，使用期望效用最大化原则，推导出使单个案例的期望效用最大化的阈值 $t^{\\ast}$，并给出其值。请将最终阈值 $t^{\\ast}$ 表示为一个精确的数字（小数或分数）。如果您选择小数表示，请将答案四舍五入到四位有效数字。",
            "solution": "问题要求解计算机辅助检测和诊断（CADx）系统的最佳决策阈值 $t^{\\ast}$，该阈值能够最大化期望效用。该系统为给定案例提供一个校准过的恶性肿瘤后验概率 $p$。决策是根据 $p$ 是否大于或等于阈值 $t$ 来决定是否发出警报。\n\n让我们来形式化这个决策问题。对于任何给定案例，存在两种可能的真实自然状态，用随机变量 $Y$ 表示：\n1.  结节是恶性的（$Y=1$）。\n2.  结节是良性的（$Y=0$）。\n\nCADx系统提供校准过的后验概率 $p = \\mathbb{P}(Y=1 \\mid \\text{features})$。因此，结节为良性的概率是 $\\mathbb{P}(Y=0 \\mid \\text{features}) = 1-p$。\n\n根据 $p$ 的值，可以采取两种可能的行动 $A$：\n1.  $A_{\\text{alert}}$：向放射科医生发出警报。这对应于阳性诊断。\n2.  $A_{\\text{no alert}}$：不发出警报。这对应于阴性诊断。\n\n决策规则由一个阈值 $t$ 定义：\n- 如果 $p \\geq t$，采取行动 $A_{\\text{alert}}$。\n- 如果 $p  < t$，采取行动 $A_{\\text{no alert}}$。\n\n决策的效用取决于所采取的行动和真实的自然状态。问题定义了一个效用函数，其中正确决策的基线效用为 $0$，而错误决策会产生效用损失（负效用）。让我们为四种可能的结果定义效用 $U(A, Y)$：\n\n1.  **真阳性 (TP)**：$A=A_{\\text{alert}}$ 且 $Y=1$。正确决策。$U(A_{\\text{alert}}, Y=1) = 0$。\n2.  **真阴性 (TN)**：$A=A_{\\text{no alert}}$ 且 $Y=0$。正确决策。$U(A_{\\text{no alert}}, Y=0) = 0$。\n3.  **假阳性 (FP)**：$A=A_{\\text{alert}}$ 且 $Y=0$。错误决策。$U(A_{\\text{alert}}, Y=0) = -c_{\\mathrm{FP}}$。\n4.  **假阴性 (FN)**：$A=A_{\\text{no alert}}$ 且 $Y=1$。错误决策。$U(A_{\\text{no alert}}, Y=1) = -c_{\\mathrm{FN}}$。\n\n期望效用最大化原则规定，对于一个给定概率为 $p$ 的案例，我们应该选择具有较高期望效用的行动。每个行动的期望效用 $\\mathbb{E}[U(A)]$，是通过对其可能结果的效用按其概率进行加权平均计算得出的。\n\n采取行动 $A_{\\text{alert}}$ 的期望效用是：\n$$\n\\mathbb{E}[U(A_{\\text{alert}})] = U(A_{\\text{alert}}, Y=1) \\cdot \\mathbb{P}(Y=1) + U(A_{\\text{alert}}, Y=0) \\cdot \\mathbb{P}(Y=0)\n$$\n代入效用和概率：\n$$\n\\mathbb{E}[U(A_{\\text{alert}})] = (0) \\cdot p + (-c_{\\mathrm{FP}}) \\cdot (1-p) = -c_{\\mathrm{FP}}(1-p)\n$$\n\n采取行动 $A_{\\text{no alert}}$ 的期望效用是：\n$$\n\\mathbb{E}[U(A_{\\text{no alert}})] = U(A_{\\text{no alert}}, Y=1) \\cdot \\mathbb{P}(Y=1) + U(A_{\\text{no alert}}, Y=0) \\cdot \\mathbb{P}(Y=0)\n$$\n代入效用和概率：\n$$\n\\mathbb{E}[U(A_{\\text{no alert}})] = (-c_{\\mathrm{FN}}) \\cdot p + (0) \\cdot (1-p) = -c_{\\mathrm{FN}}p\n$$\n\n为了最大化期望效用，我们应该在 $\\mathbb{E}[U(A_{\\text{alert}})] \\geq \\mathbb{E}[U(A_{\\text{no alert}})]$ 时选择发出警报。这为触发警报设定了关于 $p$ 的条件：\n$$\n-c_{\\mathrm{FP}}(1-p) \\geq -c_{\\mathrm{FN}}p\n$$\n两边同乘以 $-1$ 会使不等号反向：\n$$\nc_{\\mathrm{FP}}(1-p) \\leq c_{\\mathrm{FN}}p\n$$\n展开左侧：\n$$\nc_{\\mathrm{FP}} - c_{\\mathrm{FP}}p \\leq c_{\\mathrm{FN}}p\n$$\n重新整理各项以解出 $p$：\n$$\nc_{\\mathrm{FP}} \\leq c_{\\mathrm{FN}}p + c_{\\mathrm{FP}}p\n$$\n$$\nc_{\\mathrm{FP}} \\leq (c_{\\mathrm{FP}} + c_{\\mathrm{FN}})p\n$$\n$$\np \\geq \\frac{c_{\\mathrm{FP}}}{c_{\\mathrm{FP}} + c_{\\mathrm{FN}}}\n$$\n这个不等式定义了最优决策规则。如果恶性肿瘤的概率 $p$ 大于或等于比率 $\\frac{c_{\\mathrm{FP}}}{c_{\\mathrm{FP}} + c_{\\mathrm{FN}}}$，则应发出警报。最优阈值 $t^{\\ast}$ 是决策发生改变时的值，即这个条件的边界。\n$$\nt^{\\ast} = \\frac{c_{\\mathrm{FP}}}{c_{\\mathrm{FP}} + c_{\\mathrm{FN}}}\n$$\n问题提供了效用损失常数的数值：$c_{\\mathrm{FP}}=3$ 和 $c_{\\mathrm{FN}}=57$。将这些值代入 $t^{\\ast}$ 的表达式中：\n$$\nt^{\\ast} = \\frac{3}{3 + 57} = \\frac{3}{60}\n$$\n化简分数可得：\n$$\nt^{\\ast} = \\frac{1}{20}\n$$\n表示为小数，即为：\n$$\nt^{\\ast} = 0.05\n$$\n这个值代表了分诊策略的最优阈值。如果 CADx 模型输出的概率 $p \\geq 0.05$，则通过发出警报可以最大化期望效用。如果 $p < 0.05$，则通过不发出警报可以最大化期望效用。值 $0.05$ 是一个精确的数值答案。",
            "answer": "$$\\boxed{0.05}$$"
        }
    ]
}