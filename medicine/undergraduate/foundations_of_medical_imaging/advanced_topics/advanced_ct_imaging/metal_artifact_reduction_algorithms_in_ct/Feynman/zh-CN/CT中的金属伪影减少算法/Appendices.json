{
    "hands_on_practices": [
        {
            "introduction": "在处理金属伪影时，首要任务是精确地识别出CT数据中哪些部分受到了金属的污染。本练习将指导你构建一个贝叶斯分类器，利用体素的强度、梯度和位置等特征来生成一个概率性的“金属掩模”。通过这个实践，你将掌握将统计模式识别应用于医学图像分析的基本技能，并为理解现代MAR算法流程的第一步打下坚实基础。",
            "id": "4900160",
            "problem": "您正在设计一个概率性金属掩模，作为计算机断层扫描（CT）中金属伪影校正（MAR）处理流程的一部分。您使用贝叶斯分类器，根据一个由亨斯菲尔德单位（HU）表示的强度、以HU/毫米表示的图像梯度幅值以及与已知高衰减结构（例如，牙科填充物、髋关节假体）的接近度（以毫米为单位）组成的特征向量，将每个体素分类为金属或非金属。您必须使用贝叶斯定理将该分类问题形式化，并计算一个体素包含金属的后验概率。\n\n假设如下：\n\n- 类别：金属，用标签 $M$ 表示；非金属，用标签 $N$ 表示。\n- 先验概率：$\\mathbb{P}(M)=0.03$ 和 $\\mathbb{P}(N)=0.97$。\n- 似然模型：给定类别，三个特征条件独立，并且每个特征都服从具有指定类别相关均值和标准差的正态分布（高斯分布）。\n- 特征定义和单位：\n  1. 强度 $I$，单位为亨斯菲尔德单位（HU）。\n  2. 梯度幅值 $G$，单位为 HU/毫米。\n  3. 接近度 $D$，单位为毫米。\n\n每个特征的类别条件高斯参数（均值和标准差）如下：\n- 对于 $M$（金属）：\n  - $I \\sim \\mathcal{N}(\\mu_{I|M}=3500,\\ \\sigma_{I|M}=400)$，\n  - $G \\sim \\mathcal{N}(\\mu_{G|M}=1200,\\ \\sigma_{G|M}=400)$，\n  - $D \\sim \\mathcal{N}(\\mu_{D|M}=0.5,\\ \\sigma_{D|M}=0.5)$。\n- 对于 $N$（非金属）：\n  - $I \\sim \\mathcal{N}(\\mu_{I|N}=300,\\ \\sigma_{I|N}=600)$，\n  - $G \\sim \\mathcal{N}(\\mu_{G|N}=100,\\ \\sigma_{G|N}=100)$，\n  - $D \\sim \\mathcal{N}(\\mu_{D|N}=12,\\ \\sigma_{D|N}=6)$。\n\n您的任务是：\n- 从贝叶斯定理和上述建模假设出发，推导具有特征 $(I,G,D)$ 的体素的后验概率 $\\mathbb{P}(M \\mid I,G,D)$。\n- 实现一个程序，为每个指定的测试用例计算 $\\mathbb{P}(M \\mid I,G,D)$，并返回是否存在金属痕迹的二元检测决策。该决策定义为：如果 $\\mathbb{P}(M \\mid I,G,D) \\ge 0.5$，则为 $1$；否则为 $0$。\n- 所有数值答案必须表示为浮点数。后验概率必须四舍五入到 $6$ 位小数。检测决策必须是 $\\{0,1\\}$ 中的整数。\n\n使用以下带单位的特征向量 $(I,G,D)$ 测试套件：\n- 案例 $1$：$(4200,\\ 1800,\\ 0.2)$。\n- 案例 $2$：$(30,\\ 20,\\ 25)$。\n- 案例 $3$：$(1200,\\ 200,\\ 18)$。\n- 案例 $4$：$(900,\\ 700,\\ 2.0)$。\n- 案例 $5$：$(3500,\\ 0,\\ 5)$。\n- 案例 $6$：$(500,\\ 150,\\ 0.1)$。\n\n计算：\n- 六个案例的后验概率 $\\mathbb{P}(M \\mid I,G,D)$，结果为浮点数并四舍五入到 $6$ 位小数。\n- 使用上述阈值规则得出的检测决策，结果为 $\\{0,1\\}$ 中的整数。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。此列表包含两个子列表：第一个按顺序列出六个后验概率，第二个按顺序列出六个检测决策。例如，要求的输出格式为 $[[p_1,p_2,p_3,p_4,p_5,p_6],[d_1,d_2,d_3,d_4,d_5,d_6]]$，其中每个 $p_i$ 是一个四舍五入到 $6$ 位小数的浮点数，每个 $d_i$ 是一个等于 $0$ 或 $1$ 的整数。",
            "solution": "该问题已经过审查并被认定有效。这是一个基于医学图像分析和统计模式识别既定原则的、适定的贝叶斯分类问题。所有必要的数据，包括先验概率和类别条件似然模型，均已提供，且目标明确。\n\n任务是给定代表强度、梯度幅值和接近度的特征向量 $(I,G,D)$，计算一个体素包含金属的后验概率 $\\mathbb{P}(M \\mid I,G,D)$。分类使用朴素贝叶斯分类器执行。\n\n根据贝叶斯定理，给定证据 $(I,G,D)$，类别 $M$（金属）的后验概率为：\n$$\n\\mathbb{P}(M \\mid I,G,D) = \\frac{\\mathbb{P}(I,G,D \\mid M) \\mathbb{P}(M)}{\\mathbb{P}(I,G,D)}\n$$\n分母中的项 $\\mathbb{P}(I,G,D)$ 是观测到该证据的边缘概率，可以使用全概率公式在两个类别 $M$（金属）和 $N$（非金属）上展开：\n$$\n\\mathbb{P}(I,G,D) = \\mathbb{P}(I,G,D \\mid M) \\mathbb{P}(M) + \\mathbb{P}(I,G,D \\mid N) \\mathbb{P}(N)\n$$\n将此代入贝叶斯公式可得：\n$$\n\\mathbb{P}(M \\mid I,G,D) = \\frac{\\mathbb{P}(I,G,D \\mid M) \\mathbb{P}(M)}{\\mathbb{P}(I,G,D \\mid M) \\mathbb{P}(M) + \\mathbb{P}(I,G,D \\mid N) \\mathbb{P}(N)}\n$$\n问题陈述，给定类别，特征 $I$、$G$ 和 $D$ 是条件独立的。这是朴素贝叶斯分类器中的“朴素”假设。这使我们能够将联合类别条件似然表示为各个特征似然的乘积：\n$$\n\\mathbb{P}(I,G,D \\mid C) = \\mathbb{P}(I \\mid C) \\cdot \\mathbb{P}(G \\mid C) \\cdot \\mathbb{P}(D \\mid C) \\quad \\text{for } C \\in \\{M, N\\}\n$$\n每个特征的似然 $\\mathbb{P}(x \\mid C)$ 由正态（高斯）分布 $\\mathcal{N}(\\mu_{x|C}, \\sigma_{x|C})$ 建模。正态分布的概率密度函数（PDF）为：\n$$\nf(x; \\mu, \\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\left(-\\frac{(x - \\mu)^2}{2\\sigma^2}\\right)\n$$\n直接计算后验概率容易出现数值下溢，因为在浮点运算中，小的似然值之积可能变为零。一种更稳定的方法是使用对数概率。我们为每个类别定义一个得分 $S_C$，即类别与证据的联合概率的对数：\n$$\nS_C = \\log\\left( \\mathbb{P}(I,G,D \\mid C) \\mathbb{P}(C) \\right) = \\log\\mathbb{P}(I,G,D \\mid C) + \\log\\mathbb{P}(C)\n$$\n使用条件独立性假设，上式可展开为：\n$$\nS_C = \\sum_{x \\in \\{I,G,D\\}} \\log\\mathbb{P}(x \\mid C) + \\log\\mathbb{P}(C)\n$$\n高斯 PDF 的对数为：\n$$\n\\log f(x; \\mu, \\sigma) = -\\log(\\sigma) - \\frac{1}{2}\\log(2\\pi) - \\frac{(x - \\mu)^2}{2\\sigma^2}\n$$\n后验概率 $\\mathbb{P}(M \\mid I,G,D)$ 可以用得分 $S_M$ 和 $S_N$ 表示：\n$$\n\\mathbb{P}(M \\mid I,G,D) = \\frac{e^{S_M}}{e^{S_M} + e^{S_N}}\n$$\n为进一步提高数值稳定性，可将其重新排列为：\n$$\n\\mathbb{P}(M \\mid I,G,D) = \\frac{1}{1 + \\frac{e^{S_N}}{e^{S_M}}} = \\frac{1}{1 + e^{S_N - S_M}}\n$$\n这是应用于得分差的 logistic sigmoid 函数，它对下溢和上溢都具有鲁棒性。\n\n检测决策基于 $0.5$ 的阈值。如果 $\\mathbb{P}(M \\mid I,G,D) \\ge 0.5$，则体素被分类为金属。此条件等价于：\n$$\n\\frac{1}{1 + e^{S_N - S_M}} \\ge 0.5 \\implies 1 \\ge 0.5(1 + e^{S_N - S_M}) \\implies 2 \\ge 1 + e^{S_N - S_M} \\implies 1 \\ge e^{S_N - S_M}\n$$\n对两边取自然对数，我们得到：\n$$\n\\log(1) \\ge S_N - S_M \\implies 0 \\ge S_N - S_M \\implies S_M \\ge S_N\n$$\n这是最大后验概率（MAP）决策规则：我们选择得分较高的类别。\n\n实现将按以下步骤进行：\n1.  定义给定两个类别（$M$ 和 $N$）的均值、标准差和先验概率。\n2.  创建一个函数，用于计算给定值 $x$、均值 $\\mu$ 和标准差 $\\sigma$ 的高斯分布的对数概率密度函数（log-PDF）。\n3.  对于每个测试用例向量 $(I,G,D)$：\n    a. 使用金属类别的参数，对 $I$、$G$ 和 $D$ 的对数概率密度函数求和，并加上先验概率 $\\mathbb{P}(M)$ 的对数，以计算得分 $S_M$。\n    b. 类似地，计算非金属类别的得分 $S_N$。\n    c. 使用公式 $1 / (1 + e^{S_N - S_M})$ 计算后验概率 $\\mathbb{P}(M \\mid I,G,D)$。\n    d. 将后验概率四舍五入到 $6$ 位小数。\n    e. 确定检测决策：如果后验概率 $\\ge 0.5$，则为 $1$；否则为 $0$。\n4.  将计算出的概率和决策收集到两个单独的列表中。\n5.  将最终输出格式化为一个字符串，该字符串表示这两个列表的列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the posterior probability of a voxel being metal and makes a binary\n    detection decision using a Naive Bayes classifier.\n    \"\"\"\n\n    # Class-conditional parameters and priors from the problem statement\n    params = {\n        'M': {  # Metal\n            'prior': 0.03,\n            'I': {'mu': 3500, 'sigma': 400},\n            'G': {'mu': 1200, 'sigma': 400},\n            'D': {'mu': 0.5, 'sigma': 0.5}\n        },\n        'N': {  # Non-metal\n            'prior': 0.97,\n            'I': {'mu': 300, 'sigma': 600},\n            'G': {'mu': 100, 'sigma': 100},\n            'D': {'mu': 12, 'sigma': 6}\n        }\n    }\n\n    # Test cases: (I, G, D)\n    test_cases = [\n        (4200.0, 1800.0, 0.2),\n        (30.0, 20.0, 25.0),\n        (1200.0, 200.0, 18.0),\n        (900.0, 700.0, 2.0),\n        (3500.0, 0.0, 5.0),\n        (500.0, 150.0, 0.1)\n    ]\n\n    features = ['I', 'G', 'D']\n    \n    def log_gaussian_pdf(x, mu, sigma):\n        \"\"\"\n        Calculates the logarithm of the Gaussian Probability Density Function.\n        \"\"\"\n        # Ensure sigma is not zero to avoid division errors\n        if sigma == 0:\n            return -np.inf\n        log_pdf = -np.log(sigma * np.sqrt(2 * np.pi)) - 0.5 * ((x - mu) / sigma) ** 2\n        return log_pdf\n\n    posterior_probabilities = []\n    detection_decisions = []\n\n    for case_values in test_cases:\n        case_dict = dict(zip(features, case_values))\n        \n        # Calculate scores S_M and S_N\n        log_prob_m = np.log(params['M']['prior'])\n        log_prob_n = np.log(params['N']['prior'])\n\n        for feat in features:\n            val = case_dict[feat]\n            \n            # Add log-likelihood for Metal class\n            mu_m = params['M'][feat]['mu']\n            sigma_m = params['M'][feat]['sigma']\n            log_prob_m += log_gaussian_pdf(val, mu_m, sigma_m)\n            \n            # Add log-likelihood for Non-metal class\n            mu_n = params['N'][feat]['mu']\n            sigma_n = params['N'][feat]['sigma']\n            log_prob_n += log_gaussian_pdf(val, mu_n, sigma_n)\n\n        # Calculate posterior probability for Metal class using the numerically stable formula\n        # P(M|x) = 1 / (1 + exp(S_N - S_M))\n        score_diff = log_prob_n - log_prob_m\n        if score_diff > 700: # Avoid overflow in np.exp\n            posterior_m = 0.0\n        else:\n            posterior_m = 1.0 / (1.0 + np.exp(score_diff))\n        \n        # Round the posterior probability to 6 decimal places\n        rounded_posterior = round(posterior_m, 6)\n        \n        # Apply threshold for detection decision\n        decision = 1 if rounded_posterior >= 0.5 else 0\n        \n        posterior_probabilities.append(rounded_posterior)\n        detection_decisions.append(decision)\n\n    # Format the final output string exactly as required\n    prob_str = ','.join([f\"{p:.6f}\" for p in posterior_probabilities])\n    dec_str = ','.join(map(str, detection_decisions))\n    \n    print(f\"[[{prob_str}],[{dec_str}]]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一旦识别出损坏的数据区域，一种常见的策略是用合理的数据填补这些空白，这一过程称为“修复”（inpainting）。本练习要求你通过最小化一个各向异性的平滑度泛函来插值计算缺失的正弦图数据点。这个过程清晰地展示了如何利用局部图像结构（如梯度）来引导插值，从而恢复受损信息。",
            "id": "4900085",
            "problem": "一个平行束计算机断层扫描（CT）系统通过 Radon 变换采集线性衰减系数的线积分，生成一个由投影角度 $\\theta$ 和探测器坐标 $t$ 索引的二维正弦图。在固定位置 $(\\theta_{1}, t_{1})$ 附近的一小块正弦图区域被高衰减金属污染，导致中心样本 $s(\\theta_{1}, t_{1})$ 未知，而其四个轴对齐的邻近点 $s(\\theta_{1}, t_{1}\\pm \\Delta t)$ 和 $s(\\theta_{1}\\pm \\Delta \\theta, t_{1})$ 保持可靠。为减少金属伪影，考虑一种方向性插值方法，该方法通过最小化一个由正弦图梯度构建的局部各向异性平滑泛函来实现。\n\n使用以下基本原理：\n\n- 正弦图编码了线积分：$s(\\theta, t) = \\int \\mu(x, y) \\,\\mathrm{d}\\ell$，其中 $\\mu$ 是线性衰减系数，$\\mathrm{d}\\ell$ 是沿由 $(\\theta, t)$ 定义的射线进行的积分。\n- 局部平滑性可以通过惩罚沿 $(\\theta, t)$ 轴的方向差分的平方来实现，其权重由从可靠邻近数据估计的局部正弦图梯度确定。\n\n令未知中心值为 $x := s(\\theta_{1}, t_{1})$。仅使用可靠样本，定义在 $(\\theta_{1}, t_{1})$ 处的局部正弦图梯度的离散中心差分估计：\n$$\ng_{t} \\approx \\frac{s(\\theta_{1}, t_{1}+\\Delta t) - s(\\theta_{1}, t_{1}-\\Delta t)}{2\\,\\Delta t},\\quad\ng_{\\theta} \\approx \\frac{s(\\theta_{1}+\\Delta \\theta, t_{1}) - s(\\theta_{1}-\\Delta \\theta, t_{1})}{2\\,\\Delta \\theta}.\n$$\n为单个未知数 $x$ 构建一个各向异性平滑泛函，\n$$\n\\mathcal{J}(x) = w_{t}\\Big[(x - s(\\theta_{1}, t_{1}-\\Delta t))^{2} + (s(\\theta_{1}, t_{1}+\\Delta t) - x)^{2}\\Big] + w_{\\theta}\\Big[(x - s(\\theta_{1}-\\Delta \\theta, t_{1}))^{2} + (s(\\theta_{1}+\\Delta \\theta, t_{1}) - x)^{2}\\Big],\n$$\n其中权重由梯度大小定义为\n$$\nw_{t} = \\frac{1}{1 + \\left(\\frac{|g_{t}|}{g_{0t}}\\right)^{2}},\\quad\nw_{\\theta} = \\frac{1}{1 + \\left(\\frac{|g_{\\theta}|}{g_{0\\theta}}\\right)^{2}},\n$$\n其中对比度参数 $g_{0t} > 0$ 且 $g_{0\\theta} > 0$。\n\n假设有以下可靠的邻近数据和采样步长：\n- $s(\\theta_{1}, t_{1}-\\Delta t) = 0.51$, $s(\\theta_{1}, t_{1}+\\Delta t) = 0.63$, $s(\\theta_{1}-\\Delta \\theta, t_{1}) = 0.52$, $s(\\theta_{1}+\\Delta \\theta, t_{1}) = 0.54$。\n- $\\Delta t = 1$, $\\Delta \\theta = 0.02$ (弧度)。\n- $g_{0t} = 0.05$, $g_{0\\theta} = 0.50$。\n\n从上述基本定义和平滑泛函出发，推导最小化子 $x^{\\star}$ 的表达式，该最小化子通过在可靠邻近点提供的边界约束下最小化 $\\mathcal{J}(x)$ 来插值缺失的正弦图值。然后根据给定数据数值计算 $x^{\\star}$。将您的最终数值答案四舍五入至四位有效数字。将插值得到的正弦图值以 $\\mathrm{cm}^{-1}$ 为单位表示。",
            "solution": "首先验证问题，以确保其具有科学依据、适定、客观和完整。\n\n### 步骤1：提取已知条件\n给定信息如下：\n- 一个未知的正弦图值 $x := s(\\theta_{1}, t_{1})$。\n- 可靠的邻近数据：\n  - $s(\\theta_{1}, t_{1}-\\Delta t) = 0.51$\n  - $s(\\theta_{1}, t_{1}+\\Delta t) = 0.63$\n  - $s(\\theta_{1}-\\Delta \\theta, t_{1}) = 0.52$\n  - $s(\\theta_{1}+\\Delta \\theta, t_{1}) = 0.54$\n- 采样间隔：\n  - $\\Delta t = 1$\n  - $\\Delta \\theta = 0.02$\n- 中心差分的梯度定义：\n  - $g_{t} \\approx \\frac{s(\\theta_{1}, t_{1}+\\Delta t) - s(\\theta_{1}, t_{1}-\\Delta t)}{2\\,\\Delta t}$\n  - $g_{\\theta} \\approx \\frac{s(\\theta_{1}+\\Delta \\theta, t_{1}) - s(\\theta_{1}-\\Delta \\theta, t_{1})}{2\\,\\Delta \\theta}$\n- 待最小化的各向异性平滑泛函：\n  - $\\mathcal{J}(x) = w_{t}\\Big[(x - s(\\theta_{1}, t_{1}-\\Delta t))^{2} + (s(\\theta_{1}, t_{1}+\\Delta t) - x)^{2}\\Big] + w_{\\theta}\\Big[(x - s(\\theta_{1}-\\Delta \\theta, t_{1}))^{2} + (s(\\theta_{1}+\\Delta \\theta, t_{1}) - x)^{2}\\Big]$\n- 权重定义：\n  - $w_{t} = \\frac{1}{1 + \\left(\\frac{|g_{t}|}{g_{0t}}\\right)^{2}}$\n  - $w_{\\theta} = \\frac{1}{1 + \\left(\\frac{|g_{\\theta}|}{g_{0\\theta}}\\right)^{2}}$\n- 对比度参数：\n  - $g_{0t} = 0.05$\n  - $g_{0\\theta} = 0.50$\n- 最终插值结果应四舍五入至四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题描述了一个使用加权平均插值方案的正弦图修复任务，其中的权重源自一个各向异性平滑泛函。这种方法是图像处理和医学成像中的一种标准技术，通常与各向异性扩散有关。泛函 $\\mathcal{J}(x)$ 是关于未知数 $x$ 的二次函数。权重 $w_{t}$ 和 $w_{\\theta}$ 由梯度大小导出，且始终为正。因此，$\\mathcal{J}(x)$ 是一个开口向上的凸抛物线，这保证了唯一最小值的存在。问题是自洽的，提供了所有必要的数据和定义。不存在科学或逻辑上的矛盾。要求正弦图值的单位为 $\\mathrm{cm}^{-1}$（它是一个线积分 $\\int \\mu \\, \\mathrm{d}\\ell$，因此单位应为 $\\text{长度}^{-1} \\times \\text{长度} = \\text{无量纲}$）是一个轻微的术语歧义，但这不影响优化问题本身的数学有效性。该问题被认为是有效的。\n\n### 步骤3：结论与行动\n问题有效。将提供完整的解答。\n\n目标是找到使泛函 $\\mathcal{J}(x)$ 最小化的 $x$ 值。这个值记为 $x^{\\star}$，可以通过对 $\\mathcal{J}(x)$ 关于 $x$ 求导并令其等于零来找到。\n\n让我们简化邻近值的符号表示：\n- $s_{t-} = s(\\theta_{1}, t_{1}-\\Delta t)$\n- $s_{t+} = s(\\theta_{1}, t_{1}+\\Delta t)$\n- $s_{\\theta-} = s(\\theta_{1}-\\Delta \\theta, t_{1})$\n- $s_{\\theta+} = s(\\theta_{1}+\\Delta \\theta, t_{1})$\n\n泛函为：\n$$\n\\mathcal{J}(x) = w_{t}\\Big[(x - s_{t-})^{2} + (s_{t+} - x)^{2}\\Big] + w_{\\theta}\\Big[(x - s_{\\theta-})^{2} + (s_{\\theta+} - x)^{2}\\Big]\n$$\n为了找到最小值，我们计算导数 $\\frac{\\mathrm{d}\\mathcal{J}}{\\mathrm{d}x}$：\n$$\n\\frac{\\mathrm{d}\\mathcal{J}}{\\mathrm{d}x} = w_{t}\\Big[2(x - s_{t-})(1) + 2(s_{t+} - x)(-1)\\Big] + w_{\\theta}\\Big[2(x - s_{\\theta-})(1) + 2(s_{\\theta+} - x)(-1)\\Big]\n$$\n$$\n\\frac{\\mathrm{d}\\mathcal{J}}{\\mathrm{d}x} = 2w_{t}(x - s_{t-} - s_{t+} + x) + 2w_{\\theta}(x - s_{\\theta-} - s_{\\theta+} + x)\n$$\n$$\n\\frac{\\mathrm{d}\\mathcal{J}}{\\mathrm{d}x} = 2w_{t}\\Big(2x - (s_{t-} + s_{t+})\\Big) + 2w_{\\theta}\\Big(2x - (s_{\\theta-} + s_{\\theta+})\\Big)\n$$\n将导数设为零以找到临界点 $x^{\\star}$：\n$$\n2w_{t}\\Big(2x^{\\star} - (s_{t-} + s_{t+})\\Big) + 2w_{\\theta}\\Big(2x^{\\star} - (s_{\\theta-} + s_{\\theta+})\\Big) = 0\n$$\n两边除以 $2$：\n$$\nw_{t}\\Big(2x^{\\star} - (s_{t-} + s_{t+})\\Big) + w_{\\theta}\\Big(2x^{\\star} - (s_{\\theta-} + s_{\\theta+})\\Big) = 0\n$$\n现在，我们求解 $x^{\\star}$：\n$$\n2x^{\\star}w_{t} - w_{t}(s_{t-} + s_{t+}) + 2x^{\\star}w_{\\theta} - w_{\\theta}(s_{\\theta-} + s_{\\theta+}) = 0\n$$\n$$\n2x^{\\star}(w_{t} + w_{\\theta}) = w_{t}(s_{t-} + s_{t+}) + w_{\\theta}(s_{\\theta-} + s_{\\theta+})\n$$\n$$\nx^{\\star} = \\frac{w_{t}(s_{t-} + s_{t+}) + w_{\\theta}(s_{\\theta-} + s_{\\theta+})}{2(w_{t} + w_{\\theta})}\n$$\n这个表达式给出了最优插值 $x^{\\star}$。它可以被解释为沿每个轴的邻近点平均值的加权平均。\n\n现在，我们将使用给定数据计算 $x^{\\star}$ 的数值。\n\n首先，计算局部梯度 $g_{t}$ 和 $g_{\\theta}$：\n$$\ng_{t} = \\frac{s_{t+} - s_{t-}}{2\\Delta t} = \\frac{0.63 - 0.51}{2(1)} = \\frac{0.12}{2} = 0.06\n$$\n$$\ng_{\\theta} = \\frac{s_{\\theta+} - s_{\\theta-}}{2\\Delta \\theta} = \\frac{0.54 - 0.52}{2(0.02)} = \\frac{0.02}{0.04} = 0.5\n$$\n接下来，计算权重 $w_{t}$ 和 $w_{\\theta}$：\n$$\nw_{t} = \\frac{1}{1 + \\left(\\frac{|g_{t}|}{g_{0t}}\\right)^{2}} = \\frac{1}{1 + \\left(\\frac{0.06}{0.05}\\right)^{2}} = \\frac{1}{1 + (1.2)^{2}} = \\frac{1}{1 + 1.44} = \\frac{1}{2.44}\n$$\n$$\nw_{\\theta} = \\frac{1}{1 + \\left(\\frac{|g_{\\theta}|}{g_{0\\theta}}\\right)^{2}} = \\frac{1}{1 + \\left(\\frac{0.5}{0.50}\\right)^{2}} = \\frac{1}{1 + 1^{2}} = \\frac{1}{2}\n$$\n现在，将权重和邻近值代入 $x^{\\star}$ 的表达式中：\n- 沿 $t$ 轴的邻近点之和：$s_{t-} + s_{t+} = 0.51 + 0.63 = 1.14$\n- 沿 $\\theta$ 轴的邻近点之和：$s_{\\theta-} + s_{\\theta+} = 0.52 + 0.54 = 1.06$\n\n$$\nx^{\\star} = \\frac{w_{t}(1.14) + w_{\\theta}(1.06)}{2(w_{t} + w_{\\theta})}\n$$\n代入权重的值：\n$$\nx^{\\star} = \\frac{(\\frac{1}{2.44})(1.14) + (\\frac{1}{2})(1.06)}{2(\\frac{1}{2.44} + \\frac{1}{2})}\n$$\n计算分子：\n$$\n\\text{Numerator} = \\frac{1.14}{2.44} + \\frac{1.06}{2} = \\frac{1.14}{2.44} + 0.53\n$$\n计算分母：\n$$\n\\text{Denominator} = 2\\left(\\frac{1}{2.44} + \\frac{1}{2}\\right) = 2\\left(\\frac{1 + 1.22}{2.44}\\right) = 2\\left(\\frac{2.22}{2.44}\\right) = \\frac{4.44}{2.44}\n$$\n所以，我们有：\n$$\nx^{\\star} = \\frac{\\frac{1.14}{2.44} + 0.53}{\\frac{4.44}{2.44}} = \\frac{1.14 + 0.53(2.44)}{4.44} = \\frac{1.14 + 1.2932}{4.44} = \\frac{2.4332}{4.44}\n$$\n$$\nx^{\\star} \\approx 0.547995495...\n$$\n题目要求最终答案四舍五入至四位有效数字。\n$$\nx^{\\star} \\approx 0.5480\n$$\n尽管题目要求插值值的单位以 $\\mathrm{cm}^{-1}$ 表示，但计算是基于无量纲的数值输入。最终结果是一个无量纲数。根据输出格式规则，方框内的答案不包含单位。该数值代表插值的正弦图数据点，其物理意义与线性衰减系数的线积分有关。",
            "answer": "$$\\boxed{0.5480}$$"
        },
        {
            "introduction": "除了数据修复，更先进的MAR技术，如双能CT，旨在从物理原理上校正束流硬化效应。然而，即使是这些先进方法也并非完美，本练习将探讨基物质分解中路径长度的微小估计误差如何导致残留伪影。通过这个实践，你将深入理解双能成像的物理原理和残留伪影的来源，从而对先进MAR算法的局限性有更批判性的认识。",
            "id": "4900133",
            "problem": "一种双能计算机断层扫描（CT）金属伪影校正方法将通过射线的测量线积分建模为在少量能箱和两种基材料上的多色 Beer-Lambert 积分。设基材料为软组织和钛。校正后投影的正演模型由估计的基材料路径长度构建，其形式为\n$$\np(\\{l_j\\}) \\equiv -\\ln\\left(\\frac{I(\\{l_j\\})}{I_0}\\right), \\quad I(\\{l_j\\}) = \\sum_{i=1}^{2} w_i \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right), \\quad I_0=\\sum_{i=1}^{2} w_i,\n$$\n其中 $w_i$ 是在能量 $E_1$ 和 $E_2$ 的两个能箱中的入射谱权重，$\\mu_j(E_i)$ 是基材料 $j$ 在能量 $E_i$ 处的线性衰减系数。考虑一条穿过软组织和小型钛植入物的射线，其真实路径长度为 $l_{\\text{soft}}$ 和 $l_{\\text{Ti}}$。在有金属存在的情况下，基材料分解可能会在用于合成校正后投影的路径长度估计中引入误差 $\\delta l_j$。假设校正后投影 $p$ 是用错误的路径长度 $l_j+\\delta l_j$ 计算的。\n\n从上述 Beer-Lambert 定律和多色正演模型出发（不引入任何特定的校正公式），推导校正后投影 $p$ 对基材料路径长度误差 $\\delta l_j$ 的一阶灵敏度，即，用 $\\mu_j(E_i)$、$w_i$ 和 $l_j$ 表示 $\\delta l_j$ 的一阶项 $\\delta p$。然后，对于以下物理上合理的参数值：\n- $E_1 = 60\\,\\text{keV}$，$E_2 = 100\\,\\text{keV}$，\n- $w_1 = 0.7$，$w_2 = 0.3$（因此 $I_0 = 1.0$），\n- $\\mu_{\\text{soft}}(E_1) = 0.20\\,\\text{cm}^{-1}$，$\\mu_{\\text{soft}}(E_2) = 0.17\\,\\text{cm}^{-1}$，\n- $\\mu_{\\text{Ti}}(E_1) = 4.0\\,\\text{cm}^{-1}$，$\\mu_{\\text{Ti}}(E_2) = 3.0\\,\\text{cm}^{-1}$，\n- $l_{\\text{soft}} = 20.0\\,\\text{cm}$，$l_{\\text{Ti}} = 0.15\\,\\text{cm}$，\n计算当 $\\delta l_{\\text{soft}} = 0.20\\,\\text{cm}$ 和 $\\delta l_{\\text{Ti}} = 0.010\\,\\text{cm}$ 时产生的一阶残余阴影 $\\delta p$ 的数值。\n\n将最终答案表示为一个无量纲数（自然对数单位），并四舍五入到四位有效数字。",
            "solution": "用户提供了一个问题陈述，在尝试解答之前需要对其进行验证。\n\n### 第1步：提取已知条件\n问题陈述中的已知条件如下：\n- 校正后投影 $p(\\{l_j\\})$ 由多色 Beer-Lambert 定律定义：\n$$\np(\\{l_j\\}) \\equiv -\\ln\\left(\\frac{I(\\{l_j\\})}{I_0}\\right)\n$$\n- 对于两个能箱和两种基材料，多色透射强度 $I(\\{l_j\\})$ 为：\n$$\nI(\\{l_j\\}) = \\sum_{i=1}^{2} w_i \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right)\n$$\n- 入射强度是谱权重的总和：\n$$\nI_0=\\sum_{i=1}^{2} w_i\n$$\n- $w_i$ 是能量为 $E_1, E_2$ 的能箱 $i=1, 2$ 的入射谱权重。\n- $\\mu_j(E_i)$ 是基材料 $j$ 在能量 $E_i$ 处的线性衰减系数。\n- 路径长度受到误差扰动：$l_j \\to l_j + \\delta l_j$。\n- 数值参数值：\n  - $E_1 = 60\\,\\text{keV}$, $E_2 = 100\\,\\text{keV}$\n  - $w_1 = 0.7$, $w_2 = 0.3$ (意味着 $I_0 = 1.0$)\n  - 基材料1（软组织）：$\\mu_{\\text{soft}}(E_1) = 0.20\\,\\text{cm}^{-1}$，$\\mu_{\\text{soft}}(E_2) = 0.17\\,\\text{cm}^{-1}$\n  - 基材料2（钛）：$\\mu_{\\text{Ti}}(E_1) = 4.0\\,\\text{cm}^{-1}$，$\\mu_{\\text{Ti}}(E_2) = 3.0\\,\\text{cm}^{-1}$\n  - 真实路径长度：$l_{\\text{soft}} = 20.0\\,\\text{cm}$，$l_{\\text{Ti}} = 0.15\\,\\text{cm}$\n  - 路径长度误差：$\\delta l_{\\text{soft}} = 0.20\\,\\text{cm}$，$\\delta l_{\\text{Ti}} = 0.010\\,\\text{cm}$\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据（关键）：** 该问题基于 Beer-Lambert 定律，这是X射线衰减的基本原理。多色模型是双能CT中使用的标准且物理上正确的扩展。给定的能量范围（$60-100\\,\\text{keV}$）内，软组织和钛的线性衰减系数值在物理上是合理的。基材料分解中路径长度误差的前提是金属伪影校正算法中一个众所周知的挑战。该问题在科学上是合理的。\n- **适定性：** 该问题是适定的。它要求推导一阶灵敏度，这对应于一阶泰勒展开。函数 $p(\\{l_j\\})$ 是可微的，确保了此展开的存在性和唯一性。数值计算所需的所有参数都已提供。\n- **客观性（关键）：** 问题以精确、定量和无偏见的语言陈述。\n- **不完整或矛盾的设定：** 问题提供了一套完整的数据和定义。没有矛盾之处。$I_0$ 的显式值与给定的权重一致 ($w_1 + w_2 = 0.7 + 0.3 = 1.0$)。\n- **不切实际或不可行：** 物理场景和参数值对于涉及金属植入物的医学CT扫描是现实的。\n- **不适定或结构不良：** 问题结构清晰，包括推导部分和随后的数值计算部分。解是唯一且稳定的。\n- **其他缺陷：** 问题不是无关紧要、比喻性或同义反复的。它探讨了医学成像物理学中一个具体且相关的概念。\n\n### 第3步：结论与行动\n问题是**有效的**。将提供解答。\n\n问题要求做两件事：首先，推导投影 $p$ 对路径长度估计 $l_j$ 中误差 $\\delta l_j$ 的一阶灵敏度；其次，对一组给定的参数计算这个变化量 $\\delta p$ 的数值。\n\n多变量函数的一阶变化由其全微分给出。投影 $p$ 是路径长度 $l_1$ 和 $l_2$ 的函数（我们将索引 $j=1$ 与软组织关联，将 $j=2$ 与钛关联）。由微小变化 $\\delta l_1$ 和 $\\delta l_2$ 引起的一阶变化 $\\delta p$ 是：\n$$\n\\delta p \\approx \\frac{\\partial p}{\\partial l_1} \\delta l_1 + \\frac{\\partial p}{\\partial l_2} \\delta l_2\n$$\n偏导数在真实路径长度 $(l_1, l_2)$ 处计算。我们必须首先找到对于任意基材料 $k$ 的偏导数 $\\frac{\\partial p}{\\partial l_k}$ 的通用表达式。\n\n根据定义 $p = -\\ln\\left(\\frac{I}{I_0}\\right) = \\ln(I_0) - \\ln(I)$，它对 $l_k$ 的偏导数使用链式法则求得：\n$$\n\\frac{\\partial p}{\\partial l_k} = \\frac{\\partial}{\\partial l_k} (\\ln(I_0) - \\ln(I)) = -\\frac{1}{I} \\frac{\\partial I}{\\partial l_k}\n$$\n接下来，我们计算透射强度 $I$ 对 $l_k$ 的偏导数。$I$ 的表达式为：\n$$\nI = \\sum_{i=1}^{2} w_i \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right)\n$$\n对特定路径长度 $l_k$ 求导：\n$$\n\\frac{\\partial I}{\\partial l_k} = \\frac{\\partial}{\\partial l_k} \\sum_{i=1}^{2} w_i \\exp\\!\\left(-(\\mu_1(E_i)l_1 + \\mu_2(E_i)l_2)\\right)\n$$\n指数项对 $l_k$ 的导数是：\n$$\n\\frac{\\partial}{\\partial l_k} \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right) = \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right) \\cdot (-\\mu_k(E_i))\n$$\n因此，$I$ 的偏导数是：\n$$\n\\frac{\\partial I}{\\partial l_k} = \\sum_{i=1}^{2} w_i \\left[ -\\mu_k(E_i) \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right) \\right] = - \\sum_{i=1}^{2} w_i \\mu_k(E_i) \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right)\n$$\n将此代回 $\\frac{\\partial p}{\\partial l_k}$ 的表达式中：\n$$\n\\frac{\\partial p}{\\partial l_k} = -\\frac{1}{I} \\left( - \\sum_{i=1}^{2} w_i \\mu_k(E_i) \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right) \\right) = \\frac{\\sum_{i=1}^{2} w_i \\mu_k(E_i) \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right)}{\\sum_{i=1}^{2} w_i \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right)}\n$$\n这是投影对基材料 $k$ 路径长度变化的灵敏度的通用表达式。总的一阶变化 $\\delta p$ 则是：\n$$\n\\delta p \\approx \\sum_{k=1}^{2} \\left[ \\frac{\\sum_{i=1}^{2} w_i \\mu_k(E_i) \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right)}{\\sum_{i=1}^{2} w_i \\exp\\!\\left(-\\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j\\right)} \\right] \\delta l_k\n$$\n这就完成了问题的推导部分。\n\n现在，我们进行数值计算。我们来分配索引：\n- 基材料 $j=1$：软组织 (`soft`)\n- 基材料 $j=2$：钛 (`Ti`)\n- 能箱 $i=1$：$E_1 = 60\\,\\text{keV}$\n- 能箱 $i=2$：$E_2 = 100\\,\\text{keV}$\n\n参数如下：\n- $w_1 = 0.7$, $w_2 = 0.3$\n- $l_1 = 20.0\\,\\text{cm}$, $l_2 = 0.15\\,\\text{cm}$\n- $\\delta l_1 = 0.20\\,\\text{cm}$, $\\delta l_2 = 0.010\\,\\text{cm}$\n- $\\mu_1(E_1) = 0.20\\,\\text{cm}^{-1}$, $\\mu_1(E_2) = 0.17\\,\\text{cm}^{-1}$\n- $\\mu_2(E_1) = 4.0\\,\\text{cm}^{-1}$, $\\mu_2(E_2) = 3.0\\,\\text{cm}^{-1}$\n\n首先，我们计算每个能箱的总衰减，也就是指数函数的参数。我们将其表示为 $A_i = \\sum_{j=1}^{2} \\mu_j(E_i)\\,l_j$。\n$$\nA_1 = \\mu_1(E_1)\\,l_1 + \\mu_2(E_1)\\,l_2 = (0.20\\,\\text{cm}^{-1})(20.0\\,\\text{cm}) + (4.0\\,\\text{cm}^{-1})(0.15\\,\\text{cm}) = 4.0 + 0.60 = 4.60\n$$\n$$\nA_2 = \\mu_1(E_2)\\,l_1 + \\mu_2(E_2)\\,l_2 = (0.17\\,\\text{cm}^{-1})(20.0\\,\\text{cm}) + (3.0\\,\\text{cm}^{-1})(0.15\\,\\text{cm}) = 3.4 + 0.45 = 3.85\n$$\n接下来，我们计算总透射强度 $I$，它是我们灵敏度表达式中的分母。\n$$\nI = w_1 \\exp(-A_1) + w_2 \\exp(-A_2) = 0.7 \\exp(-4.60) + 0.3 \\exp(-3.85)\n$$\n使用计算器：\n$$\n\\exp(-4.60) \\approx 0.0100518\n$$\n$$\n\\exp(-3.85) \\approx 0.0212780\n$$\n$$\nI \\approx 0.7 \\times 0.0100518 + 0.3 \\times 0.0212780 \\approx 0.0070363 + 0.0063834 = 0.0134197\n$$\n现在，我们计算偏导数 $\\frac{\\partial p}{\\partial l_k}$。\n对于 $k=1$（软组织）：\n$$\n\\frac{\\partial p}{\\partial l_1} = \\frac{w_1 \\mu_1(E_1) \\exp(-A_1) + w_2 \\mu_1(E_2) \\exp(-A_2)}{I}\n$$\n$$\n\\frac{\\partial p}{\\partial l_1} \\approx \\frac{(0.7)(0.20)(0.0100518) + (0.3)(0.17)(0.0212780)}{0.0134197} = \\frac{0.00140725 + 0.00108518}{0.0134197} = \\frac{0.00249243}{0.0134197} \\approx 0.18573\\,\\text{cm}^{-1}\n$$\n对于 $k=2$（钛）：\n$$\n\\frac{\\partial p}{\\partial l_2} = \\frac{w_1 \\mu_2(E_1) \\exp(-A_1) + w_2 \\mu_2(E_2) \\exp(-A_2)}{I}\n$$\n$$\n\\frac{\\partial p}{\\partial l_2} \\approx \\frac{(0.7)(4.0)(0.0100518) + (0.3)(3.0)(0.0212780)}{0.0134197} = \\frac{0.0281451 + 0.0191502}{0.0134197} = \\frac{0.0472953}{0.0134197} \\approx 3.5243\\,\\text{cm}^{-1}\n$$\n最后，我们计算一阶残余阴影 $\\delta p$：\n$$\n\\delta p \\approx \\frac{\\partial p}{\\partial l_1} \\delta l_1 + \\frac{\\partial p}{\\partial l_2} \\delta l_2\n$$\n$$\n\\delta p \\approx (0.18573\\,\\text{cm}^{-1})(0.20\\,\\text{cm}) + (3.5243\\,\\text{cm}^{-1})(0.010\\,\\text{cm})\n$$\n$$\n\\delta p \\approx 0.037146 + 0.035243 = 0.072389\n$$\n问题要求将答案四舍五入到四位有效数字。\n$$\n\\delta p \\approx 0.07239\n$$\n该值为无量纲数，符合要求。",
            "answer": "$$\n\\boxed{0.07239}\n$$"
        }
    ]
}