{
    "hands_on_practices": [
        {
            "introduction": "The entire principle of K-edge subtraction relies on the dramatic change in a material's X-ray attenuation coefficient at a specific energy. This first exercise allows you to calculate this \"jump\" for a realistic contrast agent mixture. By applying the Beer-Lambert law and the rule for combining attenuations in a mixture, you will gain a concrete understanding of the physical phenomenon that makes this imaging technique possible. ",
            "id": "4896256",
            "problem": "In X-ray imaging, the Beer–Lambert law states that for a monochromatic X-ray beam of energy $E$, the transmitted intensity through a homogeneous slab of thickness $x$ is $I(E) = I_{0}(E)\\exp(-\\mu(E)x)$, where $\\mu(E)$ is the linear attenuation coefficient. For a mixture of components indexed by $i$ with mass fractions $w_{i}$, the mass attenuation coefficient of the mixture is defined as $(\\mu/\\rho)_{\\text{mix}}(E) = \\sum_{i} w_{i}(\\mu/\\rho)_{i}(E)$, and the linear attenuation coefficient is $\\mu_{\\text{mix}}(E) = \\rho_{\\text{mix}}(\\mu/\\rho)_{\\text{mix}}(E)$, where $\\rho_{\\text{mix}}$ is the mixture density. Under ideal mixing (no volume change on mixing), the mixture density satisfies $\\frac{1}{\\rho_{\\text{mix}}} = \\sum_{i} \\frac{w_{i}}{\\rho_{i}}$, where $\\rho_{i}$ is the pure-component density.\n\nConsider a liquid mixture of water and iodine used for $K$-edge subtraction imaging near the iodine $K$-edge energy $E_{K} \\approx 33.2\\,\\text{keV}$. The mass fractions are $w_{\\text{W}} = 0.96$ for water and $w_{\\text{I}} = 0.04$ for iodine. The pure-component densities are $\\rho_{\\text{W}} = 1.00\\,\\text{g}\\,\\text{cm}^{-3}$ and $\\rho_{\\text{I}} = 4.93\\,\\text{g}\\,\\text{cm}^{-3}$. At energies just below and just above the $K$-edge, take the following mass attenuation coefficients (data representative of the National Institute of Standards and Technology (NIST) X-ray attenuation database, XCOM):\n- Below the edge at $E_{-} = 32.0\\,\\text{keV}$: $(\\mu/\\rho)_{\\text{W}}(E_{-}) = 0.285\\,\\text{cm}^{2}\\,\\text{g}^{-1}$ and $(\\mu/\\rho)_{\\text{I}}(E_{-}) = 9.74\\,\\text{cm}^{2}\\,\\text{g}^{-1}$.\n- Above the edge at $E_{+} = 35.0\\,\\text{keV}$: $(\\mu/\\rho)_{\\text{W}}(E_{+}) = 0.211\\,\\text{cm}^{2}\\,\\text{g}^{-1}$ and $(\\mu/\\rho)_{\\text{I}}(E_{+}) = 48.6\\,\\text{cm}^{2}\\,\\text{g}^{-1}$.\n\nUsing the ideal mixing assumption and the foundational definitions above, compute the effective linear attenuation coefficients $\\mu(E_{-})$ and $\\mu(E_{+})$ of the mixture, and the jump magnitude $\\Delta\\mu = \\mu(E_{+}) - \\mu(E_{-})$. Express $\\mu$ and $\\Delta\\mu$ in $\\text{cm}^{-1}$. Round your final values to four significant figures. Report your final answer as a row vector $\\big(\\mu(E_{-}),\\,\\mu(E_{+}),\\,\\Delta\\mu\\big)$.",
            "solution": "### Step 1: Calculate the Density of the Mixture\n\nUsing the formula for the density of an ideal mixture:\n$$\n\\frac{1}{\\rho_{\\text{mix}}} = \\frac{w_{\\text{W}}}{\\rho_{\\text{W}}} + \\frac{w_{\\text{I}}}{\\rho_{\\text{I}}}\n$$\nSubstitute the given values:\n$$\n\\frac{1}{\\rho_{\\text{mix}}} = \\frac{0.96}{1.00\\,\\text{g}\\,\\text{cm}^{-3}} + \\frac{0.04}{4.93\\,\\text{g}\\,\\text{cm}^{-3}} = 0.96\\,\\text{cm}^{3}\\,\\text{g}^{-1} + 0.00811359...\\,\\text{cm}^{3}\\,\\text{g}^{-1} = 0.96811359...\\,\\text{cm}^{3}\\,\\text{g}^{-1}\n$$\nSolving for the mixture density gives:\n$$\n\\rho_{\\text{mix}} = \\frac{1}{0.96811359...}\\,\\text{g}\\,\\text{cm}^{-3} \\approx 1.032936\\,\\text{g}\\,\\text{cm}^{-3}\n$$\n\n### Step 2: Calculate the Mass Attenuation Coefficients of the Mixture\n\nThe mass attenuation coefficient of the mixture is the weighted sum of the component coefficients:\n$$\n(\\mu/\\rho)_{\\text{mix}}(E) = w_{\\text{W}}(\\mu/\\rho)_{\\text{W}}(E) + w_{\\text{I}}(\\mu/\\rho)_{\\text{I}}(E)\n$$\nAt energy $E_{-} = 32.0\\,\\text{keV}$:\n$$\n(\\mu/\\rho)_{\\text{mix}}(E_{-}) = (0.96)(0.285) + (0.04)(9.74) = 0.2736 + 0.3896 = 0.6632\\,\\text{cm}^{2}\\,\\text{g}^{-1}\n$$\nAt energy $E_{+} = 35.0\\,\\text{keV}$:\n$$\n(\\mu/\\rho)_{\\text{mix}}(E_{+}) = (0.96)(0.211) + (0.04)(48.6) = 0.20256 + 1.944 = 2.14656\\,\\text{cm}^{2}\\,\\text{g}^{-1}\n$$\n\n### Step 3: Calculate the Linear Attenuation Coefficients and the Jump Magnitude\n\nThe linear attenuation coefficient is the product of the mixture density and the mixture mass attenuation coefficient:\n$$\n\\mu(E) = \\rho_{\\text{mix}} \\times (\\mu/\\rho)_{\\text{mix}}(E)\n$$\nFor $\\mu(E_{-})$:\n$$\n\\mu(E_{-}) = (1.032936\\,\\text{g}\\,\\text{cm}^{-3}) \\times (0.6632\\,\\text{cm}^{2}\\,\\text{g}^{-1}) \\approx 0.684988\\,\\text{cm}^{-1}\n$$\nRounding to four significant figures gives $\\mu(E_{-}) = 0.6850\\,\\text{cm}^{-1}$.\n\nFor $\\mu(E_{+})$:\n$$\n\\mu(E_{+}) = (1.032936\\,\\text{g}\\,\\text{cm}^{-3}) \\times (2.14656\\,\\text{cm}^{2}\\,\\text{g}^{-1}) \\approx 2.217270\\,\\text{cm}^{-1}\n$$\nRounding to four significant figures gives $\\mu(E_{+}) = 2.217\\,\\text{cm}^{-1}$.\n\nThe jump magnitude $\\Delta\\mu$ is the difference between the two linear attenuation coefficients. Using the unrounded intermediate values for precision:\n$$\n\\Delta\\mu = \\mu(E_{+}) - \\mu(E_{-}) = 2.217270...\\,\\text{cm}^{-1} - 0.684988...\\,\\text{cm}^{-1} \\approx 1.532282\\,\\text{cm}^{-1}\n$$\nRounding to four significant figures gives $\\Delta\\mu = 1.532\\,\\text{cm}^{-1}$.\n\nThe final result as a row vector is $(\\mu(E_{-}),\\,\\mu(E_{+}),\\,\\Delta\\mu) = (0.6850, 2.217, 1.532)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.6850 & 2.217 & 1.532\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A large attenuation jump is only useful if our imaging system can accurately distinguish between photons with energies just below and just above the K-edge. This practice explores a critical aspect of the detector: its energy resolution. You will model the detector's imperfect energy measurement and calculate the performance needed to correctly classify photons, a crucial step for preventing errors in the final material-decomposed image. ",
            "id": "4896295",
            "problem": "A photon-counting X-ray detector is used for K-edge subtraction imaging of iodine. The iodine K-edge is at $E_{K} = 33.2\\,\\mathrm{keV}$. The detector’s single-photon energy response function is well modeled by a Gaussian with mean equal to the true photon energy and standard deviation $\\sigma$, so the probability density function for a photon of true energy $E_{0}$ being measured at energy $E$ is\n$$\np(E \\mid E_{0}) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{(E - E_{0})^{2}}{2\\sigma^{2}}\\right).\n$$\nTwo narrow acquisition windows are used: a pre-edge window centered at $E_{-} = 32.8\\,\\mathrm{keV}$ and a post-edge window centered at $E_{+} = 33.6\\,\\mathrm{keV}$. Each window is sufficiently narrow that its photons can be treated as monoenergetic at its center. Classification is performed by a single threshold at the K-edge: any measured photon with $E  E_{K}$ is assigned to the pre-edge bin, and any measured photon with $E \\ge E_{K}$ is assigned to the post-edge bin.\n\nDefine the Full Width at Half Maximum (FWHM) as the full width of the Gaussian response at half of its maximum value. To ensure reliable material separation, require that, for photons originating from either window center, the probability of misclassification (i.e., a pre-edge photon measured at or above $E_{K}$ or a post-edge photon measured below $E_{K}$) is no greater than $0.05$.\n\nUnder these assumptions, determine the largest allowable energy resolution, expressed as the FWHM in $\\mathrm{keV}$, that guarantees the misclassification probability requirement for both windows. Round your answer to three significant figures and express the energy resolution in $\\mathrm{keV}$.",
            "solution": "### Step 1: Relate FWHM to Standard Deviation $\\sigma$\nThe energy resolution is given by the Full Width at Half Maximum (FWHM) of the Gaussian response. The FWHM is related to the standard deviation $\\sigma$ by the formula:\n$$ \\text{FWHM} = 2\\sqrt{2\\ln(2)}\\,\\sigma \\approx 2.355\\,\\sigma $$\nTo find the largest allowable FWHM, we must first find the largest allowable $\\sigma$ that meets the problem's constraints.\n\n### Step 2: Formulate Misclassification Probabilities\nWe need to consider two cases of misclassification.\n\n**Case 1: Misclassification of a pre-edge photon.**\nA photon with true energy $E_0 = E_{-} = 32.8\\,\\mathrm{keV}$ is misclassified if it is measured at an energy $E \\ge E_K = 33.2\\,\\mathrm{keV}$. The probability for this is:\n$$ P_{-} = P(E \\ge E_K \\mid E_0=E_{-}) = \\int_{E_K}^{\\infty} p(E \\mid E_{-}) dE $$\nThis can be expressed using the cumulative distribution function (CDF) of the standard normal distribution, $\\Phi(z)$, as:\n$$ P_{-} = 1 - \\Phi\\left(\\frac{E_K - E_{-}}{\\sigma}\\right) $$\nThe problem requires $P_{-} \\le 0.05$, which implies $\\Phi\\left(\\frac{E_K - E_{-}}{\\sigma}\\right) \\ge 0.95$.\n\n**Case 2: Misclassification of a post-edge photon.**\nA photon with true energy $E_0 = E_{+} = 33.6\\,\\mathrm{keV}$ is misclassified if it is measured at an energy $E  E_K = 33.2\\,\\mathrm{keV}$. The probability for this is:\n$$ P_{+} = P(E  E_K \\mid E_0=E_{+}) = \\int_{-\\infty}^{E_K} p(E \\mid E_{+}) dE = \\Phi\\left(\\frac{E_K - E_{+}}{\\sigma}\\right) $$\nThe problem requires $P_{+} \\le 0.05$.\n\n### Step 3: Solve for the Maximum Standard Deviation $\\sigma$\nLet $z_{0.95} = \\Phi^{-1}(0.95)$ be the z-score for a cumulative probability of 0.95. From standard tables, $z_{0.95} \\approx 1.645$. By symmetry, $\\Phi^{-1}(0.05) = -z_{0.95}$.\n\nFrom Case 1, we get the condition:\n$$ \\frac{E_K - E_{-}}{\\sigma} \\ge z_{0.95} \\implies \\sigma \\le \\frac{E_K - E_{-}}{z_{0.95}} $$\nFrom Case 2, we get:\n$$ \\frac{E_K - E_{+}}{\\sigma} \\le -z_{0.95} \\implies E_K - E_{+} \\le -z_{0.95}\\sigma \\implies E_{+} - E_K \\ge z_{0.95}\\sigma \\implies \\sigma \\le \\frac{E_{+} - E_K}{z_{0.95}} $$\n\nNow, substitute the given energy values:\n$E_K - E_{-} = 33.2 - 32.8 = 0.4\\,\\mathrm{keV}$\n$E_{+} - E_K = 33.6 - 33.2 = 0.4\\,\\mathrm{keV}$\n\nBoth conditions are identical due to the symmetric placement of the energy windows. To satisfy the constraint, $\\sigma$ must be no larger than this upper bound. The largest allowable $\\sigma$ is:\n$$ \\sigma_{\\max} = \\frac{0.4\\,\\mathrm{keV}}{z_{0.95}} \\approx \\frac{0.4\\,\\mathrm{keV}}{1.64485} \\approx 0.24318\\,\\mathrm{keV} $$\n\n### Step 4: Calculate the Maximum FWHM\nFinally, we convert $\\sigma_{\\max}$ to the largest allowable FWHM:\n$$ \\text{FWHM}_{\\max} = 2\\sqrt{2\\ln(2)}\\,\\sigma_{\\max} \\approx 2.355 \\times 0.24318\\,\\mathrm{keV} \\approx 0.57266\\,\\mathrm{keV} $$\nRounding the result to three significant figures gives $0.573\\,\\mathrm{keV}$.",
            "answer": "$$\n\\boxed{0.573}\n$$"
        },
        {
            "introduction": "This final exercise simulates the core computational task of K-edge imaging: using multi-energy measurements to calculate the amount of contrast agent present. You will set up and solve a system of linear equations to separate the contributions of a contrast agent and soft tissue. This practice also introduces the critical concept of sensitivity, helping you quantify how measurement noise can affect the accuracy of your results and why the choice of X-ray energies is so important for a stable solution. ",
            "id": "4896320",
            "problem": "A two-energy, two-material imaging system is used to exploit K-edge subtraction imaging. Consider a narrow-beam X-ray system that measures transmitted intensities at two discrete photon energies near the K-shell absorption edge of a contrast agent. Let the two materials be a K-edge contrast agent and soft tissue. Assume straight-ray geometry and negligible scatter. The system obeys the Beer–Lambert law: for each energy $E_i$, the transmitted intensity $I_i$ through a path consisting of the two materials with unknown thicknesses $x_1$ and $x_2$ is related to the incident intensity $I_{0,i}$ by\n$$\nI_i = I_{0,i}\\,\\exp\\!\\left(-\\mu_1(E_i)\\,x_1 - \\mu_2(E_i)\\,x_2\\right),\n$$\nwhere $\\mu_j(E_i)$ is the linear attenuation coefficient of material $j$ at energy $E_i$. Define the log measurement $y_i$ by\n$$\ny_i = -\\ln\\!\\left(\\frac{I_i}{I_{0,i}}\\right).\n$$\nMeasurements are corrupted by additive noise in log-space modeled as $y_i^{\\text{meas}} = y_i + n_i$, where $n \\sim \\mathcal{N}(0,\\Sigma)$ is a zero-mean Gaussian with covariance $\\Sigma = \\operatorname{diag}(\\sigma_1^2,\\sigma_2^2)$, and $\\sigma_i$ are known standard deviations in log units. The goal is to numerically estimate the material thicknesses $x_1$ and $x_2$ and quantify the sensitivity of these estimates to measurement noise.\n\nStarting from the Beer–Lambert model and the statistical noise model, formulate the estimation problem for the unknown vector $x = [x_1, x_2]^\\top$ using the two log measurements at two energies. Derive a principled estimator for $x$ that is unbiased and minimizes the weighted squared discrepancy under the given Gaussian noise model, and derive the covariance of this estimator in terms of $\\mu_j(E_i)$ and $\\sigma_i$. Define a quantitative sensitivity metric for each component $x_j$ as the predicted standard deviation (square root of the variance) of its estimator, and also report the matrix $2$-norm condition number of the system matrix that maps $x$ to $y$.\n\nImplement the estimator and sensitivity quantification in a program that uses the following test suite. In every case, the output thicknesses and standard deviations must be expressed in centimeters (cm). Energies are provided in kiloelectronvolts (keV), and attenuation coefficients in inverse centimeters (cm$^{-1}$). The incident intensities are unitless, and the condition number is unitless. The program should compute $y_i$ from the given ground-truth $x$ values via the Beer–Lambert law (i.e., using noise-free $I_i$ consistent with the provided parameters), and then apply the estimator and sensitivity formulas using the specified $\\sigma_i$ values.\n\nTest Suite:\n- Case $1$ (happy path near the K-edge):\n  - Energies: $E_1 = 32.0$ keV, $E_2 = 36.0$ keV.\n  - Attenuation coefficients: $\\mu_1(E_1) = 2.0$ cm$^{-1}$, $\\mu_1(E_2) = 5.0$ cm$^{-1}$; $\\mu_2(E_1) = 0.5$ cm$^{-1}$, $\\mu_2(E_2) = 0.4$ cm$^{-1}$.\n  - Ground-truth thicknesses: $x_1 = 0.05$ cm, $x_2 = 10.0$ cm.\n  - Incident intensities: $I_{0,1} = 1.0$, $I_{0,2} = 1.0$.\n  - Log-space noise standard deviations: $\\sigma_1 = 0.02$, $\\sigma_2 = 0.02$.\n- Case $2$ (near-ill-conditioned system far from the K-edge):\n  - Energies: $E_1 = 60.0$ keV, $E_2 = 65.0$ keV.\n  - Attenuation coefficients: $\\mu_1(E_1) = 2.0$ cm$^{-1}$, $\\mu_1(E_2) = 2.51$ cm$^{-1}$; $\\mu_2(E_1) = 0.4$ cm$^{-1}$, $\\mu_2(E_2) = 0.5$ cm$^{-1}$.\n  - Ground-truth thicknesses: $x_1 = 0.02$ cm, $x_2 = 20.0$ cm.\n  - Incident intensities: $I_{0,1} = 1.0$, $I_{0,2} = 1.0$.\n  - Log-space noise standard deviations: $\\sigma_1 = 0.02$, $\\sigma_2 = 0.02$.\n- Case $3$ (large measurement noise near the K-edge):\n  - Energies: $E_1 = 32.0$ keV, $E_2 = 36.0$ keV.\n  - Attenuation coefficients: $\\mu_1(E_1) = 2.0$ cm$^{-1}$, $\\mu_1(E_2) = 5.0$ cm$^{-1}$; $\\mu_2(E_1) = 0.5$ cm$^{-1}$, $\\mu_2(E_2) = 0.4$ cm$^{-1}$.\n  - Ground-truth thicknesses: $x_1 = 0.01$ cm, $x_2 = 5.0$ cm.\n  - Incident intensities: $I_{0,1} = 1.0$, $I_{0,2} = 1.0$.\n  - Log-space noise standard deviations: $\\sigma_1 = 0.20$, $\\sigma_2 = 0.20$.\n- Case $4$ (balanced low-attenuation scenario across the K-edge):\n  - Energies: $E_1 = 33.0$ keV, $E_2 = 34.0$ keV.\n  - Attenuation coefficients: $\\mu_1(E_1) = 2.5$ cm$^{-1}$, $\\mu_1(E_2) = 4.5$ cm$^{-1}$; $\\mu_2(E_1) = 0.45$ cm$^{-1}$, $\\mu_2(E_2) = 0.44$ cm$^{-1}$.\n  - Ground-truth thicknesses: $x_1 = 0.005$ cm, $x_2 = 1.0$ cm.\n  - Incident intensities: $I_{0,1} = 1.0$, $I_{0,2} = 1.0$.\n  - Log-space noise standard deviations: $\\sigma_1 = 0.01$, $\\sigma_2 = 0.01$.\n\nFor each test case, your program must output a list of five values in the following order: the estimated thickness $x_1$ in cm, the estimated thickness $x_2$ in cm, the sensitivity metric for $x_1$ in cm (predicted standard deviation), the sensitivity metric for $x_2$ in cm (predicted standard deviation), and the unitless matrix $2$-norm condition number of the system matrix. Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each test case result is itself a list with the five values in the specified order (e.g., \"[[x1_case1,x2_case1,s1_case1,s2_case1,kappa_case1],[x1_case2,x2_case2,s1_case2,s2_case2,kappa_case2],...]\"). The numeric values must be floats. No additional text should be printed.",
            "solution": "### 1. Formulation of the Linear System\n\nThe log-transformed Beer-Lambert law provides a system of linear equations:\n$$\ny_1 = \\mu_1(E_1)x_1 + \\mu_2(E_1)x_2 \\\\\ny_2 = \\mu_1(E_2)x_1 + \\mu_2(E_2)x_2\n$$\nThis can be written in matrix form as $y = Ax$, where:\n$$\ny = \\begin{bmatrix} y_1 \\\\ y_2 \\end{bmatrix}, \\quad\nA = \\begin{bmatrix} \\mu_1(E_1)  \\mu_2(E_1) \\\\ \\mu_1(E_2)  \\mu_2(E_2) \\end{bmatrix}, \\quad\nx = \\begin{bmatrix} x_1 \\\\ x_2 \\end{bmatrix}\n$$\nThe matrix $A$ is the system matrix.\n\n### 2. Derivation of the Estimator\n\nThe measurement model is $y^{\\text{meas}} = Ax + n$, where the noise vector $n$ has a zero mean and covariance $\\Sigma = \\operatorname{diag}(\\sigma_1^2, \\sigma_2^2)$. The problem asks for an unbiased estimator that minimizes the weighted squared discrepancy. This is the Generalized Least Squares (GLS) estimator, which is also the Best Linear Unbiased Estimator (BLUE). It is given by:\n$$\n\\hat{x} = (A^\\top \\Sigma^{-1} A)^{-1} A^\\top \\Sigma^{-1} y^{\\text{meas}}\n$$\nSince the problem states that the estimation should be performed on the noise-free log-measurements ($y^{\\text{meas}} = y = Ax_{\\text{true}}$), the estimator will perfectly recover the ground-truth thicknesses:\n$$\n\\hat{x} = (A^\\top \\Sigma^{-1} A)^{-1} A^\\top \\Sigma^{-1} (Ax_{\\text{true}}) = x_{\\text{true}}\n$$\nTherefore, the first two outputs for each test case are the ground-truth thicknesses.\n\n### 3. Derivation of Estimator Covariance and Sensitivity\n\nThe sensitivity of the estimator to noise is quantified by its covariance matrix. For the GLS estimator, this is:\n$$\n\\operatorname{Cov}(\\hat{x}) = (A^\\top \\Sigma^{-1} A)^{-1}\n$$\nThe sensitivity metrics, $s_1$ and $s_2$, are the predicted standard deviations of the thickness estimates, which are the square roots of the diagonal elements of the covariance matrix:\n$$\ns_1 = \\sqrt{(\\operatorname{Cov}(\\hat{x}))_{11}} \\quad \\text{and} \\quad s_2 = \\sqrt{(\\operatorname{Cov}(\\hat{x}))_{22}}\n$$\nFor the specific test cases where the noise is white ($\\sigma_1 = \\sigma_2 = \\sigma$), the covariance simplifies to $\\operatorname{Cov}(\\hat{x}) = \\sigma^2 (A^\\top A)^{-1}$.\n\n### 4. Condition Number\n\nThe matrix $2$-norm condition number, $\\kappa(A)$, measures the sensitivity of the solution $x$ to perturbations in the measurement vector $y$. It is defined as the ratio of the largest to the smallest singular values of $A$:\n$$\n\\kappa(A) = \\frac{\\sigma_{\\max}(A)}{\\sigma_{\\min}(A)}\n$$\nA large condition number indicates an ill-conditioned system, where small measurement errors can lead to large errors in the estimated thicknesses. This typically occurs when the rows of the matrix $A$ (the spectral signatures of the materials) are nearly linearly dependent.\nThe provided Python code implements these calculations for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the K-edge subtraction imaging problem for a given test suite.\n\n    This function implements a generalized least squares (GLS) estimator for\n    material thicknesses in a two-material, two-energy X-ray system. It calculates\n    the estimated thicknesses, the sensitivity of these estimates (as standard\n    deviations), and the condition number of the system matrix.\n    \"\"\"\n\n    # Test Suite:\n    # Each case is a tuple containing:\n    # ( mu1_E1, mu1_E2, mu2_E1, mu2_E2 ),\n    # ( x1_true, x2_true ),\n    # ( sigma1, sigma2 )\n    test_cases = [\n        # Case 1: happy path near the K-edge\n        {\n            \"mus\": (2.0, 5.0, 0.5, 0.4),\n            \"xs_true\": (0.05, 10.0),\n            \"sigmas\": (0.02, 0.02),\n        },\n        # Case 2: near-ill-conditioned system far from the K-edge\n        {\n            \"mus\": (2.0, 2.51, 0.4, 0.5),\n            \"xs_true\": (0.02, 20.0),\n            \"sigmas\": (0.02, 0.02),\n        },\n        # Case 3: large measurement noise near the K-edge\n        {\n            \"mus\": (2.0, 5.0, 0.5, 0.4),\n            \"xs_true\": (0.01, 5.0),\n            \"sigmas\": (0.20, 0.20),\n        },\n        # Case 4: balanced low-attenuation scenario across the K-edge\n        {\n            \"mus\": (2.5, 4.5, 0.45, 0.44),\n            \"xs_true\": (0.005, 1.0),\n            \"sigmas\": (0.01, 0.01),\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        mu1_E1, mu1_E2, mu2_E1, mu2_E2 = case[\"mus\"]\n        x1_true, x2_true = case[\"xs_true\"]\n        sigma1, sigma2 = case[\"sigmas\"]\n\n        # 1. Define the system matrix A\n        # A = [[mu1(E1), mu2(E1)],\n        #      [mu1(E2), mu2(E2)]]\n        A = np.array([[mu1_E1, mu2_E1], [mu1_E2, mu2_E2]])\n\n        # 2. Estimated thicknesses\n        # As per the problem, estimation is done on noise-free data y = A*x_true.\n        # The GLS/OLS estimator is x_hat = (A.T @ A)^-1 @ A.T @ y.\n        # Substituting y = A*x_true, we get x_hat = x_true.\n        x1_hat, x2_hat = x1_true, x2_true\n\n        # 3. Calculate estimator covariance and sensitivity\n        # For the given cases, sigma1 = sigma2 = sigma, so the noise is white.\n        # The GLS estimator simplifies to the OLS estimator, and its covariance is\n        # Cov(x_hat) = sigma^2 * (A.T @ A)^-1.\n        if sigma1 != sigma2:\n            # General case for GLS (not needed for this problem's test suite)\n            Sigma_inv = np.diag([1/sigma1**2, 1/sigma2**2])\n            cov_x = np.linalg.inv(A.T @ Sigma_inv @ A)\n        else:\n            # Simplified case for OLS\n            sigma = sigma1\n            A_T_A = A.T @ A\n            A_T_A_inv = np.linalg.inv(A_T_A)\n            cov_x = (sigma**2) * A_T_A_inv\n\n        # Sensitivity metrics are the standard deviations (sqrt of variance)\n        var_x1 = cov_x[0, 0]\n        var_x2 = cov_x[1, 1]\n        s1 = np.sqrt(var_x1)\n        s2 = np.sqrt(var_x2)\n\n        # 4. Calculate the matrix 2-norm condition number of A\n        kappa = np.linalg.cond(A, 2)\n\n        # 5. Store the results for this case\n        result = [x1_hat, x2_hat, s1, s2, kappa]\n        all_results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}