{
    "hands_on_practices": [
        {
            "introduction": "双能CT物质分解的核心在于利用材料在不同能量下X射线衰减特性的差异。在一个理想的单能X射线模型中，我们可以将问题简化为一个线性方程组。本练习将引导你从基本的贝尔-朗伯定律出发，建立并求解这个方程组，从而确定X射线路径上两种不同材料的厚度 。这是理解双能分解背后数学原理的基础性一步。",
            "id": "4899336",
            "problem": "在X射线衰减成像中，比尔-朗伯定律指出，能量为 $E$ 的入射光子通量沿路径 $\\mathcal{L}$ 发生衰减，遵循公式 $I(E)=I_{0}(E)\\exp\\!\\big(-\\int_{\\mathcal{L}}\\mu(E,\\mathbf{r})\\,dl\\big)$，其中 $\\mu(E,\\mathbf{r})$ 是在位置 $\\mathbf{r}$ 和能量 $E$ 处的线性衰减系数。将投影值 $p(E)$ 定义为 $p(E)\\equiv -\\ln\\!\\big(I(E)/I_{0}(E)\\big)=\\int_{\\mathcal{L}}\\mu(E,\\mathbf{r})\\,dl$。考虑一束直线射线依次穿过两块均匀板：厚度为 $t_{1}$ 的板1和厚度为 $t_{2}$ 的板2。每块板都是均匀的，具有与能量相关但空间上恒定的线性衰减系数，板1为 $\\mu_{1}(E)$，板2为 $\\mu_{2}(E)$。\n\n(a) 仅从比尔-朗伯定律和 $p(E)$ 的定义出发，推导当路径由上述两块板组成时，对于能量为 $E_{0}$ 的单能源，$p(E_{0})$ 的闭式表达式。\n\n(b) 在双能计算机断层扫描 (CT) 中，同一束射线在两个不同的有效单色能量 $E_{L}$ 和 $E_{H}$ 下进行测量，利用衰减的能量依赖性来实现材料分解。设材料1为水，材料2为碘，并假设在两个有效能量下，具有以下科学上合理的线性衰减系数 (单位为 $\\mathrm{cm}^{-1}$)：\n$$\nE_{L}=60\\,\\mathrm{keV},\\quad \\mu_{\\text{water}}(E_{L})=0.200,\\quad \\mu_{\\text{iodine}}(E_{L})=1.50,\n$$\n$$\nE_{H}=120\\,\\mathrm{keV},\\quad \\mu_{\\text{water}}(E_{H})=0.170,\\quad \\mu_{\\text{iodine}}(E_{H})=0.420.\n$$\n假设对同一束射线测得的投影值为\n$$\np(E_{L})=0.62,\\qquad p(E_{H})=0.30.\n$$\n将板1建模为纯水，板2建模为纯碘，并确定与这些双能测量值一致的板厚度 $t_{1}$ 和 $t_{2}$。最终厚度以 $\\mathrm{cm}$ 为单位表示，并将您的数值答案四舍五入到四位有效数字。您最终报告的结果应包括(a)部分得到的 $p(E_{0})$ 的符号表达式以及(b)部分得到的两个数值厚度。",
            "solution": "该问题陈述已经过严格验证，被认为是科学上合理、定义明确且客观的。它基于X射线物理学的既定原理（比尔-朗伯定律）及其在标准医学成像背景（双能CT）中的应用。所有必要的数据和定义均已提供，约束条件一致，且该问题存在唯一、有意义的解。\n\n(a) 两块相继均匀板的投影值推导。\n\n投影值 $p(E)$ 定义为线性衰减系数 $\\mu(E,\\mathbf{r})$ 沿X射线路径 $\\mathcal{L}$ 的线积分：\n$$\np(E) = \\int_{\\mathcal{L}} \\mu(E, \\mathbf{r}) \\, dl\n$$\n路径 $\\mathcal{L}$ 是一条依次穿过两块均匀板的直线。设穿过第一块板的路径长度为其厚度 $t_{1}$，穿过第二块板的路径长度为其厚度 $t_{2}$。由于板是均匀的，它们的线性衰减系数在各自的板内是空间恒定的。对于板1，系数为 $\\mu_{1}(E)$，对于板2，系数为 $\\mu_{2}(E)$。\n\n沿整个路径 $\\mathcal{L}$ 的积分可以分解为两个独立的积分，每个板一个：\n$$\np(E) = \\int_{\\text{slab 1}} \\mu_1(E) \\, dl + \\int_{\\text{slab 2}} \\mu_2(E) \\, dl\n$$\n因为 $\\mu_1(E)$ 和 $\\mu_2(E)$ 在各自的区域内相对于空间变量 $l$ 是常数，所以它们可以从积分中提出来：\n$$\np(E) = \\mu_1(E) \\int_0^{t_1} dl + \\mu_2(E) \\int_0^{t_2} dl\n$$\n计算简单的长度积分得出：\n$$\np(E) = \\mu_1(E) t_1 + \\mu_2(E) t_2\n$$\n对于能量为 $E_{0}$ 的单能源，我们只需将 $E=E_{0}$ 代入通用表达式。得到的投影值闭式表达式为：\n$$\np(E_0) = \\mu_1(E_0) t_1 + \\mu_2(E_0) t_2\n$$\n\n(b) 使用双能测量确定板的厚度。\n\n(a)部分的结果可以应用于双能测量场景。我们有一个由厚度为 $t_{1}$ 的水板（材料1）和厚度为 $t_{2}$ 的碘板（材料2）组成的系统。我们被给予了在两个不同能量，即低能量 $E_{L}$ 和高能量 $E_{H}$ 下的测量值。对每个能量应用推导出的公式，得到一个包含两个未知数 $t_{1}$ 和 $t_{2}$ 的二元一次方程组：\n$$\np(E_L) = \\mu_{\\text{water}}(E_L) t_1 + \\mu_{\\text{iodine}}(E_L) t_2\n$$\n$$\np(E_H) = \\mu_{\\text{water}}(E_H) t_1 + \\mu_{\\text{iodine}}(E_H) t_2\n$$\n我们获得以下数值：\n$p(E_L) = 0.62$\n$p(E_H) = 0.30$\n$\\mu_{\\text{water}}(E_L) = 0.200 \\, \\mathrm{cm}^{-1}$\n$\\mu_{\\text{iodine}}(E_L) = 1.50 \\, \\mathrm{cm}^{-1}$\n$\\mu_{\\text{water}}(E_H) = 0.170 \\, \\mathrm{cm}^{-1}$\n$\\mu_{\\text{iodine}}(E_H) = 0.420 \\, \\mathrm{cm}^{-1}$\n\n将这些值代入方程组（注意单位是一致的，因此我们可以使用无量纲的数值进行计算，得到的厚度单位将是 $\\mathrm{cm}$）：\n$$\n0.62 = 0.200 t_1 + 1.50 t_2\n$$\n$$\n0.30 = 0.170 t_1 + 0.420 t_2\n$$\n该方程组可以写成矩阵形式 $\\mathbf{M} \\mathbf{t} = \\mathbf{p}$，其中：\n$$\n\\mathbf{M} = \\begin{pmatrix} 0.200 & 1.50 \\\\ 0.170 & 0.420 \\end{pmatrix}, \\quad \\mathbf{t} = \\begin{pmatrix} t_1 \\\\ t_2 \\end{pmatrix}, \\quad \\mathbf{p} = \\begin{pmatrix} 0.62 \\\\ 0.30 \\end{pmatrix}\n$$\n我们可以使用克莱姆法则求解 $t_1$ 和 $t_2$。首先，我们计算系数矩阵 $\\mathbf{M}$ 的行列式：\n$$\n\\det(\\mathbf{M}) = (0.200)(0.420) - (1.50)(0.170) = 0.084 - 0.255 = -0.171\n$$\n由于行列式不为零，存在唯一解。厚度 $t_1$ 和 $t_2$ 由以下公式给出：\n$$\nt_1 = \\frac{\\det \\begin{pmatrix} 0.62 & 1.50 \\\\ 0.30 & 0.420 \\end{pmatrix}}{\\det(\\mathbf{M})} = \\frac{(0.62)(0.420) - (1.50)(0.30)}{-0.171} = \\frac{0.2604 - 0.45}{-0.171} = \\frac{-0.1896}{-0.171} \\approx 1.10877 \\, \\mathrm{cm}\n$$\n$$\nt_2 = \\frac{\\det \\begin{pmatrix} 0.200 & 0.62 \\\\ 0.170 & 0.30 \\end{pmatrix}}{\\det(\\mathbf{M})} = \\frac{(0.200)(0.30) - (0.62)(0.170)}{-0.171} = \\frac{0.06 - 0.1054}{-0.171} = \\frac{-0.0454}{-0.171} \\approx 0.26550 \\, \\mathrm{cm}\n$$\n按要求将这些结果四舍五入到四位有效数字：\n$t_1 = 1.109 \\, \\mathrm{cm}$\n$t_2 = 0.2655 \\, \\mathrm{cm}$\n\n因此，该路径由一块厚度为 $1.109 \\, \\mathrm{cm}$ 的水板和一块厚度为 $0.2655 \\, \\mathrm{cm}$ 的碘板组成。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\mu_{1}(E_{0}) t_{1} + \\mu_{2}(E_{0}) t_{2} & 1.109 & 0.2655 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "真实世界中的X射线源是多色谱的，而非理想化的单能谱，这引入了所谓的“线束硬化”效应。如果我们继续使用简单的线性模型进行分解，就会产生系统性的误差或“偏倚”。本计算练习  将让你模拟这一过程，通过对比多色谱数据和单能谱近似反演的结果，来量化线束硬化所引入的偏倚，从而揭示CT成像中的一个基本伪影。",
            "id": "4899370",
            "problem": "给定一个使用两种基准材料（在此任务中为碘和水）进行材料分解的双能计算机断层扫描 (DECT) 测量模型。设 $f_1$ 和 $f_2$ 分别表示沿单条 X 射线路径的碘和水的面密度（单位为 $\\mathrm{g/cm^2}$）。在多色谱下，对于具有权重 $\\{w_k\\}$、处于离散光子能量 $\\{E_k\\}$ 的谱，其归一化透射强度根据比尔-朗伯定律建模为\n$$\n\\frac{I}{I_0} \\;=\\; \\sum_{k} w_k \\exp\\!\\left(- f_1\\,\\mu_1(E_k) - f_2\\,\\mu_2(E_k)\\right),\n$$\n其中 $\\mu_1(E)$ 和 $\\mu_2(E)$ 分别是碘和水在能量 $E$ 处的质量衰减系数（单位为 $\\mathrm{cm^2/g}$），且 $\\sum_k w_k = 1$。相应的对数衰减（正弦图样本）为\n$$\np \\;=\\; -\\ln\\!\\left(\\frac{I}{I_0}\\right),\n$$\n其为无量纲量。对于 DECT，您有两个谱，分别称为低能谱和高能谱，它们在相同的能量节点 $\\{E_k\\}$ 上各自具有权重 $\\{w_k^{(L)}\\}$ 和 $\\{w_k^{(H)}\\}$。\n\n在单能近似下，每个对数衰减在单个有效能量处被近似为基准面密度的线性组合：\n$$\np_L \\approx \\mu_1(E_L^\\ast) f_1 + \\mu_2(E_L^\\ast) f_2,\\quad\np_H \\approx \\mu_1(E_H^\\ast) f_1 + \\mu_2(E_H^\\ast) f_2,\n$$\n其中 $E_L^\\ast$ 和 $E_H^\\ast$ 是所选的低能和高能有效能量。您的任务是：\n\n1. 构建一个算法，在单能近似下从测量的 $p_L$ 和 $p_H$ 中恢复 $f_1$ 和 $f_2$。您的算法必须从第一性原理（比尔-朗伯定律）出发，通过建立并求解适当的方程组来进行，不得使用任何预先推导的材料分解快捷公式。\n\n2. 当真实测量值由多色谱生成时，通过计算恢复的 $(f_1, f_2)$ 与真实值 $(f_1, f_2)$ 之间的差异，来分析使用单能近似所引入的偏差。\n\n使用以下科学上合理的离散能量节点和质量衰减系数数据（对于 $E_L^\\ast$ 和 $E_H^\\ast$ 允许进行线性插值）：\n- 能量（单位 $\\mathrm{keV}$）：$[40, 60, 80, 100, 120]$。\n- 碘质量衰减系数 $\\mu_1(E)$（单位 $\\mathrm{cm^2/g}$）：在相应能量下为 $[4.700, 1.940, 1.210, 0.870, 0.690]$。\n- 水质量衰减系数 $\\mu_2(E)$（单位 $\\mathrm{cm^2/g}$）：在相应能量下为 $[0.192, 0.186, 0.180, 0.176, 0.173]$。\n\n使用以下用于低能谱和高能谱的归一化谱权重（无量纲且总和为 $1$）：\n- 低能谱权重 $w^{(L)}$：在能量 $[40,60,80,100,120]$ $\\mathrm{keV}$ 上为 $[0.35, 0.30, 0.20, 0.10, 0.05]$。\n- 高能谱权重 $w^{(H)}$：在能量 $[40,60,80,100,120]$ $\\mathrm{keV}$ 上为 $[0.05, 0.15, 0.25, 0.25, 0.30]$。\n\n对于单能近似，使用有效能量 $E_L^\\ast = 60\\,\\mathrm{keV}$ 和 $E_H^\\ast = 100\\,\\mathrm{keV}$。对于给定的真实值 $(f_1, f_2)$，使用上述权重在多色谱模型下生成 $p_L$ 和 $p_H$，然后应用您的单能重建算法以获得估计值 $(\\hat f_1, \\hat f_2)$。\n\n测试套件：\n计算以下六个真实值案例的结果（所有面密度单位均为 $\\mathrm{g/cm^2}$）：\n- 案例 1: $(f_1, f_2) = (0.000, 0.000)$。\n- 案例 2: $(f_1, f_2) = (0.000, 10.000)$。\n- 案例 3: $(f_1, f_2) = (0.050, 10.000)$。\n- 案例 4: $(f_1, f_2) = (0.500, 20.000)$。\n- 案例 5: $(f_1, f_2) = (0.020, 30.000)$。\n- 案例 6: $(f_1, f_2) = (0.001, 0.500)$。\n\n对于每个案例，输出一个包含四个浮点数的列表：\n- $\\hat f_1$（单位 $\\mathrm{g/cm^2}$），\n- $\\hat f_2$（单位 $\\mathrm{g/cm^2}$），\n- 碘面密度的偏差 $\\hat f_1 - f_1$（单位 $\\mathrm{g/cm^2}$），\n- 水面密度的偏差 $\\hat f_2 - f_2$（单位 $\\mathrm{g/cm^2}$）。\n\n数值和输出要求：\n- 所有面密度输出必须以 $\\mathrm{g/cm^2}$ 为单位。\n- 将所有浮点数四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表，每个内部列表对应一个案例，格式严格如下：\n\"[ [f1_hat_case1,f2_hat_case1,bias1_case1,bias2_case1], [f1_hat_case2,f2_hat_case2,bias1_case2,bias2_case2], ... ]\"",
            "solution": "该问题要求开发并分析一种用于双能计算机断层扫描 (DECT) 的材料分解算法。其目标是，当真实测量值由更符合物理实际的多色 X 射线谱模型生成时，量化简化的单能近似所引入的偏差。两种基准材料是碘和水。\n\n解决方案分为三个主要步骤：\n1.  构建多色谱正向模型以生成真实的对数衰减测量值。\n2.  推导单能逆向模型以估计材料的面密度。\n3.  将模型应用于指定的测试案例，以计算估计的面密度及其相关偏差。\n\n**步骤 1：多色谱正向模型**\n\nX 射线穿过材料的衰减物理过程由比尔-朗伯定律描述。对于多色 X 射线谱（即不同能量光子的叠加），总衰减是能量加权平均。归一化透射强度 $\\frac{I}{I_0}$ 在穿过两种材料组合（面密度分别为 $f_1$ (碘) 和 $f_2$ (水)，单位为 $\\mathrm{g/cm^2}$）后，由下式给出：\n$$\n\\frac{I}{I_0} \\;=\\; \\sum_{k} w_k \\exp\\!\\left(- \\left(f_1\\,\\mu_1(E_k) + f_2\\,\\mu_2(E_k)\\right)\\right)\n$$\n这里，$\\{E_k\\}$ 是离散的光子能量，$\\{w_k\\}$ 是相应的归一化谱权重，使得 $\\sum_k w_k = 1$，$\\mu_1(E)$ 和 $\\mu_2(E)$ 分别是碘和水随能量变化的质量衰减系数（单位为 $\\mathrm{cm^2/g}$）。\n\n对数衰减，或称正弦图值 $p$，定义为：\n$$\np \\;=\\; -\\ln\\!\\left(\\frac{I}{I_0}\\right) \\;=\\; -\\ln\\!\\left( \\sum_{k} w_k \\exp\\!\\left(- f_1\\,\\mu_1(E_k) - f_2\\,\\mu_2(E_k)\\right) \\right)\n$$\n由于对数内是一个和式，该方程相对于面密度 $f_1$ 和 $f_2$ 是非线性的。这种非线性是束流硬化效应的来源。\n\n在 DECT 系统中，使用低能谱和高能谱（其权重分别为 $\\{w_k^{(L)}\\}$ 和 $\\{w_k^{(H)}\\}$）采集两次测量值。对于给定的真实值对 $(f_1, f_2)$，真实的对数衰减值 $p_L$ 和 $p_H$ 计算如下：\n$$\np_L \\;=\\; -\\ln\\!\\left( \\sum_{k} w_k^{(L)} \\exp\\!\\left(- f_1\\,\\mu_1(E_k) - f_2\\,\\mu_2(E_k)\\right) \\right)\n$$\n$$\np_H \\;=\\; -\\ln\\!\\left( \\sum_{k} w_k^{(H)} \\exp\\!\\left(- f_1\\,\\mu_1(E_k) - f_2\\,\\mu_2(E_k)\\right) \\right)\n$$\n这些方程构成了生成“测量”数据的正向模型。\n\n**步骤 2：单能逆向模型**\n\n材料分解旨在解决逆问题：即给定测量值 $(p_L, p_H)$，求 $(f_1, f_2)$。一个常见的简化是单能近似，它假设每个多色谱的行为如同一个具有“有效”能量的单能射线束。在此近似下，对数衰减成为面密度的线性组合。\n\n设 $E_L^\\ast$ 和 $E_H^\\ast$ 分别为低能谱和高能谱的有效能量。对于估计的面密度（我们表示为 $(\\hat{f}_1, \\hat{f}_2)$），方程组为：\n$$\np_L \\approx \\mu_1(E_L^\\ast) \\hat{f}_1 + \\mu_2(E_L^\\ast) \\hat{f}_2\n$$\n$$\np_H \\approx \\mu_1(E_H^\\ast) \\hat{f}_1 + \\mu_2(E_H^\\ast) \\hat{f}_2\n$$\n这是一个关于两个未知数 $(\\hat{f}_1, \\hat{f}_2)$ 的二元线性方程组。其矩阵形式为 $\\mathbf{p} = M \\mathbf{\\hat{f}}$，其中：\n$$\n\\mathbf{p} = \\begin{pmatrix} p_L \\\\ p_H \\end{pmatrix}, \\quad\nM = \\begin{pmatrix} \\mu_1(E_L^\\ast) & \\mu_2(E_L^\\ast) \\\\ \\mu_1(E_H^\\ast) & \\mu_2(E_H^\\ast) \\end{pmatrix}, \\quad\n\\mathbf{\\hat{f}} = \\begin{pmatrix} \\hat{f}_1 \\\\ \\hat{f}_2 \\end{pmatrix}\n$$\n解 $\\mathbf{\\hat{f}}$ 可通过对系统矩阵 $M$ 求逆得到：\n$$\n\\mathbf{\\hat{f}} = M^{-1} \\mathbf{p}\n$$\n为了存在唯一解，矩阵 $M$ 必须是可逆的，即其行列式必须非零。行列式由下式给出：\n$$\n\\det(M) = \\mu_1(E_L^\\ast)\\mu_2(E_H^\\ast) - \\mu_2(E_L^\\ast)\\mu_1(E_H^\\ast)\n$$\n非零行列式表明两种基准材料具有足够不同的能量依赖性衰减特性，这是双能材料分解的基本要求。\n\n逆矩阵为：\n$$\nM^{-1} = \\frac{1}{\\det(M)} \\begin{pmatrix} \\mu_2(E_H^\\ast) & -\\mu_2(E_L^\\ast) \\\\ -\\mu_1(E_H^\\ast) & \\mu_1(E_L^\\ast) \\end{pmatrix}\n$$\n这提供了估计面密度的显式公式：\n$$\n\\hat{f}_1 = \\frac{1}{\\det(M)} \\left( p_L \\mu_2(E_H^\\ast) - p_H \\mu_2(E_L^\\ast) \\right)\n$$\n$$\n\\hat{f}_2 = \\frac{1}{\\det(M)} \\left( -p_L \\mu_1(E_H^\\ast) + p_H \\mu_1(E_L^\\ast) \\right)\n$$\n\n**步骤 3：算法与偏差计算**\n\n评估单能近似偏差的整体流程如下：\n1.  选择一对真实的面密度 $(f_1, f_2)$。\n2.  使用提供的谱数据和质量衰减系数，通过步骤 1 中的方程计算多色谱对数衰减 $p_L$ 和 $p_H$。\n3.  使用在指定有效能量 $E_L^\\ast$ 和 $E_H^\\ast$ 处的质量衰减系数构建系统矩阵 $M$。问题说明允许线性插值，但由于给定的有效能量 $E_L^\\ast=60\\,\\mathrm{keV}$ 和 $E_H^\\ast=100\\,\\mathrm{keV}$ 是所提供能量网格上的节点，因此可以直接使用这些值。\n4.  求解线性系统 $M \\mathbf{\\hat{f}} = \\mathbf{p}$ 以找到估计的面密度 $(\\hat{f}_1, \\hat{f}_2)$。\n5.  计算每种材料的偏差：bias$_1 = \\hat{f}_1 - f_1$ 和 bias$_2 = \\hat{f}_2 - f_2$。\n\n具体的数值如下：\n-   能量 $E_k$：$[40, 60, 80, 100, 120] \\, \\mathrm{keV}$。\n-   碘 $\\mu_1(E_k)$：$[4.700, 1.940, 1.210, 0.870, 0.690] \\, \\mathrm{cm^2/g}$。\n-   水 $\\mu_2(E_k)$：$[0.192, 0.186, 0.180, 0.176, 0.173] \\, \\mathrm{cm^2/g}$。\n-   低能权重 $w^{(L)}$：$[0.35, 0.30, 0.20, 0.10, 0.05]$。\n-   高能权重 $w^{(H)}$：$[0.05, 0.15, 0.25, 0.25, 0.30]$。\n-   有效能量：$E_L^\\ast = 60\\,\\mathrm{keV}$ 和 $E_H^\\ast = 100\\,\\mathrm{keV}$。\n\n系统矩阵 $M$ 使用 $60\\,\\mathrm{keV}$ 和 $100\\,\\mathrm{keV}$ 处的值构建：\n$$\nM = \\begin{pmatrix} \\mu_1(60) & \\mu_2(60) \\\\ \\mu_1(100) & \\mu_2(100) \\end{pmatrix} = \\begin{pmatrix} 1.940 & 0.186 \\\\ 0.870 & 0.176 \\end{pmatrix}\n$$\n行列式为 $\\det(M) = (1.940)(0.176) - (0.186)(0.870) = 0.34144 - 0.16182 = 0.17962$。由于 $\\det(M) \\neq 0$，该系统是良态的，并有唯一解。\n\n此流程将应用于六个测试案例中的每一个，以计算估计的密度和偏差，然后按要求格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the dual-energy CT material decomposition problem.\n    1. Generates 'true' polychromatic log-attenuation measurements (p_L, p_H) from ground truth\n       areal densities (f1, f2).\n    2. Solves for estimated areal densities (f1_hat, f2_hat) using a simplified monoenergetic model.\n    3. Calculates the bias introduced by the monoenergetic approximation.\n    \"\"\"\n\n    # --- Problem Givens ---\n\n    # Discrete energy nodes in keV\n    energies = np.array([40.0, 60.0, 80.0, 100.0, 120.0])\n\n    # Mass attenuation coefficients (mu) in cm^2/g\n    # mu1 for iodine, mu2 for water\n    mu1 = np.array([4.700, 1.940, 1.210, 0.870, 0.690])\n    mu2 = np.array([0.192, 0.186, 0.180, 0.176, 0.173])\n\n    # Normalized spectral weights (dimensionless)\n    # w_l for low-energy, w_h for high-energy\n    w_l = np.array([0.35, 0.30, 0.20, 0.10, 0.05])\n    w_h = np.array([0.05, 0.15, 0.25, 0.25, 0.30])\n\n    # Effective energies for monoenergetic approximation in keV\n    e_l_eff = 60.0\n    e_h_eff = 100.0\n\n    # Test suite: ground truth areal densities (f1, f2) in g/cm^2\n    test_cases = [\n        (0.000, 0.000),  # Case 1\n        (0.000, 10.000), # Case 2\n        (0.050, 10.000), # Case 3\n        (0.500, 20.000), # Case 4\n        (0.020, 30.000), # Case 5\n        (0.001, 0.500),  # Case 6\n    ]\n\n    # --- Solution Logic ---\n\n    # Get mass attenuation coefficients at effective energies for the monoenergetic system matrix\n    # Since effective energies are on the grid, no interpolation is needed.\n    mu1_l_eff = mu1[np.where(energies == e_l_eff)[0][0]]\n    mu2_l_eff = mu2[np.where(energies == e_l_eff)[0][0]]\n    mu1_h_eff = mu1[np.where(energies == e_h_eff)[0][0]]\n    mu2_h_eff = mu2[np.where(energies == e_h_eff)[0][0]]\n\n    # Construct the 2x2 monoenergetic system matrix M\n    M = np.array([\n        [mu1_l_eff, mu2_l_eff],\n        [mu1_h_eff, mu2_h_eff]\n    ])\n\n    results = []\n    for f1_true, f2_true in test_cases:\n        # Step 1: Generate measurements using the polychromatic model\n        \n        # Attenuation exponent for each energy bin\n        exponent = - (f1_true * mu1 + f2_true * mu2)\n        \n        # Transmitted intensity sums\n        i_ratio_l = np.sum(w_l * np.exp(exponent))\n        i_ratio_h = np.sum(w_h * np.exp(exponent))\n        \n        # Log-attenuation measurements (p_L, p_H)\n        # Handle the case of zero attenuation to avoid log(1.0) floating point issues\n        p_l = -np.log(i_ratio_l) if i_ratio_l  1.0 else 0.0\n        p_h = -np.log(i_ratio_h) if i_ratio_h  1.0 else 0.0\n        \n        p_vector = np.array([p_l, p_h])\n\n        # Step 2: Solve for estimated areal densities (f_hat) using the monoenergetic model\n        # M * f_hat = p_vector => f_hat = inv(M) * p_vector\n        # np.linalg.solve is numerically preferred over explicit inversion\n        if f1_true == 0.0 and f2_true == 0.0:\n            f_hat = np.array([0.0, 0.0])\n        else:\n            f_hat = np.linalg.solve(M, p_vector)\n        \n        f1_hat, f2_hat = f_hat\n\n        # Step 3: Calculate biases\n        bias1 = f1_hat - f1_true\n        bias2 = f2_hat - f2_true\n\n        # Round all results to six decimal places for output\n        case_result = [\n            round(f1_hat, 6),\n            round(f2_hat, 6),\n            round(bias1, 6),\n            round(bias2, 6)\n        ]\n        results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # The format is a string representation of a list of lists.\n    result_str = \", \".join([f\"[{f1:.6f}, {f2:.6f}, {b1:.6f}, {b2:.6f}]\" for f1, f2, b1, b2 in results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "成功的物质分解不仅取决于算法，还依赖于系统的物理设计，尤其是基材料和X射线能谱的选择。不当的选择可能导致数值不稳定性，使得分解结果对噪声极其敏感。本练习  将介绍矩阵的“条件数”这一强大工具，用以评估反问题的稳定性。你将通过计算比较不同基材料对的数值稳定性，从而理解如何设计一个更可靠的分解系统。",
            "id": "4899416",
            "problem": "给定用于双能计算机断层扫描（CT）材料分解的两种候选基对：水/碘和水/骨。目标是通过计算系统矩阵的条件数，来确定哪种基对于从每条射线的两个能量积分测量中重建基线积分更具数值稳定性。请从第一性原理出发，构建您的推理和计算。\n\n从多色X射线穿过基材料混合物时的比尔-朗伯定律开始。如果测量通道 $k$ 的入射谱通量随光子能量 $E$ 的变化为 $S_k(E)$，材料 $m$ 的线性衰减系数为 $\\mu_m(E)$，那么对于路径长度 $l_m$，透射强度为 $I_k = \\int S_k(E) \\exp\\left(-\\sum_m l_m \\mu_m(E)\\right) \\, dE$。在两个测量通道具有不同有效能谱且衰减表示为基材料加权和的情况下，通过定义一个 $2 \\times 2$ 的系统矩阵 $ \\mathbf{W} $ 来线性化正向模型，其条目为 $W_{k,m} = \\int S_k(E) \\, \\mu_m(E) \\, dE$，其中堆叠了两个通道 $k \\in \\{ \\text{low}, \\text{high} \\}$ 和两种材料 $m \\in \\{ \\text{basis 1}, \\text{basis 2} \\}$。测量向量和基线积分之间的映射受 $ \\mathbf{W} $ 的数值属性制约。\n\n谱范数（矩阵 $2$-范数）下的条件数定义为 $ \\kappa_2(\\mathbf{W}) = \\sigma_{\\max}(\\mathbf{W}) / \\sigma_{\\min}(\\mathbf{W}) $，其中 $ \\sigma_{\\max} $ 和 $ \\sigma_{\\min} $ 分别是 $ \\mathbf{W} $ 的最大和最小奇异值。较小的 $ \\kappa_2(\\mathbf{W}) $ 意味着反演的数值稳定性更高。\n\n假设能量域在以下光子能量（单位为 $\\mathrm{keV}$）处离散化：$[40, 60, 80, 100]$。给定水、碘和骨在这些能量下的质量衰减系数 $ \\left( \\mu / \\rho \\right)_m(E) $（单位：$\\mathrm{cm^2/g}$）。要获得线性衰减系数 $ \\mu_m(E) $（单位：$\\mathrm{cm^{-1}}$），需乘以材料密度 $ \\rho_m $（单位：$\\mathrm{g/cm^3}$）：$ \\mu_m(E) = \\rho_m \\left( \\mu / \\rho \\right)_m(E) $。使用 $ \\rho_{\\text{water}} = 1.0 \\, \\mathrm{g/cm^3} $，$ \\rho_{\\text{iodine}} = 4.93 \\, \\mathrm{g/cm^3} $ 和 $ \\rho_{\\text{bone}} = 1.85 \\, \\mathrm{g/cm^3} $。质量衰减系数数组（按能量 $[40, 60, 80, 100]$ $\\mathrm{keV}$ 的顺序索引）如下：\n\n- 水：$[0.25, 0.20, 0.18, 0.16]$ $\\mathrm{cm^2/g}$。\n- 碘：$[5.00, 1.94, 1.25, 0.97]$ $\\mathrm{cm^2/g}$。\n- 骨：$[0.55, 0.38, 0.30, 0.27]$ $\\mathrm{cm^2/g}$。\n\n对于下面的每个测试用例，您将获得在相同能量箱 $E_i$ 处的两个测量光谱，作为离散权重 $S_{\\text{low}}(E_i)$ 和 $S_{\\text{high}}(E_i)$。假设这些是无量纲的相对通量权重，使用前必须归一化使其总和为 $1$。通过用离散和近似积分，计算每个候选基对的 $2 \\times 2$ 系统矩阵 $ \\mathbf{W} $：\n$$\nW_{k,m} = \\sum_{i=1}^{4} S_k(E_i) \\, \\mu_m(E_i),\n$$\n其中 $k \\in \\{\\text{low}, \\text{high}\\}$，$m$ 是基对中的两种材料。然后通过 $ \\mathbf{W} $ 的奇异值计算 $ \\kappa_2(\\mathbf{W}) $。通过选择 $ \\kappa_2(\\mathbf{W}) $ 较小者来决定每个测试用例中更稳定的基。如果条件数在 $10^{-9}$ 的容差范围内相等，则视为平局。\n\n测试套件（每个用例提供与能量 $[40, 60, 80, 100]$ $\\mathrm{keV}$ 对齐的数组 $S_{\\text{low}}$ 和 $S_{\\text{high}}$）：\n\n- 用例 $1$（典型的双能分离）：\n  - $S_{\\text{low}} = [0.40, 0.35, 0.20, 0.05]$\n  - $S_{\\text{high}} = [0.10, 0.25, 0.35, 0.30]$\n- 用例 $2$（光谱更相似，可能存在病态条件）：\n  - $S_{\\text{low}} = [0.25, 0.25, 0.25, 0.25]$\n  - $S_{\\text{high}} = [0.23, 0.27, 0.25, 0.25]$\n- 用例 $3$（强光谱分离）：\n  - $S_{\\text{low}} = [0.60, 0.30, 0.08, 0.02]$\n  - $S_{\\text{high}} = [0.02, 0.08, 0.30, 0.60]$\n\n每个测试用例的必需输出：\n- 计算水/碘基的 $ \\kappa_2(\\mathbf{W}) $ 和水/骨基的 $ \\kappa_2(\\mathbf{W}) $（无量纲浮点数）。\n- 决策代码（整数）：如果水/碘更稳定，则为 $0$；如果水/骨更稳定，则为 $1$；如果在容差范围内平局，则为 $-1$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个测试用例贡献一个形式为 $[\\kappa_{\\text{WI}}, \\kappa_{\\text{WB}}, d]$ 的子列表，因此整个输出必须看起来像 $[[\\kappa_{\\text{WI,1}}, \\kappa_{\\text{WB,1}}, d_1],[\\kappa_{\\text{WI,2}}, \\kappa_{\\text{WB,2}}, d_2],[\\kappa_{\\text{WI,3}}, \\kappa_{\\text{WB,3}}, d_3]]$。所有条件数都是无量纲的，必须表示为浮点数；决策必须是整数。无需打印任何物理单位。",
            "solution": "问题要求评估两种材料基对——水/碘和水/骨——在双能计算机断层扫描（CT）材料分解中的数值稳定性。稳定性的度量标准是线性化系统矩阵 $\\mathbf{W}$ 的条件数 $\\kappa_2$。该分析将在三种不同的双能光谱配置下进行。\n\n解决方案分四个阶段进行：\n$1$. 根据提供的质量衰减系数 $(\\mu/\\rho)_m(E)$ 和密度 $\\rho_m$，计算基材料的线性衰减系数 $\\mu_m(E)$。\n$2$. 基于提供的光谱权重和计算出的线性衰减系数，为每个基对和每个测试用例构建 $2 \\times 2$ 系统矩阵 $\\mathbf{W}$。\n$3$. 计算每个矩阵的矩阵 $2$-范数条件数 $\\kappa_2(\\mathbf{W})$。\n$4$. 比较每个测试用例中两个基对的条件数，以确定数值上更稳定的选项。\n\n**第 1 步：计算线性衰减系数**\n\n线性衰减系数 $\\mu_m(E)$（单位为 $\\mathrm{cm}^{-1}$）通过以下公式与质量衰减系数 $(\\mu/\\rho)_m(E)$（单位为 $\\mathrm{cm}^2/\\mathrm{g}$）和材料密度 $\\rho_m$（单位为 $\\mathrm{g}/\\mathrm{cm}^3$）相关联：\n$$\n\\mu_m(E) = \\rho_m \\left( \\frac{\\mu}{\\rho} \\right)_m(E)\n$$\n问题在 4 个离散能量箱处提供数据：$E_i \\in \\{40, 60, 80, 100\\}$ $\\mathrm{keV}$。\n\n给定密度：\n$\\rho_{\\text{water}} = 1.0 \\, \\mathrm{g/cm^3}$\n$\\rho_{\\text{iodine}} = 4.93 \\, \\mathrm{g/cm^3}$\n$\\rho_{\\text{bone}} = 1.85 \\, \\mathrm{g/cm^3}$\n\n给定质量衰减系数 $(\\mu/\\rho)_m(E_i)$，单位为 $\\mathrm{cm^2/g}$：\n- 水：$[0.25, 0.20, 0.18, 0.16]$\n- 碘：$[5.00, 1.94, 1.25, 0.97]$\n- 骨：$[0.55, 0.38, 0.30, 0.27]$\n\n计算出的线性衰减系数 $\\mu_m(E_i)$（单位为 $\\mathrm{cm^{-1}}$）如下：\n\n- 对于水：\n$\\boldsymbol{\\mu}_{\\text{water}} = 1.0 \\, \\mathrm{g/cm^3} \\times [0.25, 0.20, 0.18, 0.16] \\, \\mathrm{cm^2/g} = [0.25, 0.20, 0.18, 0.16] \\, \\mathrm{cm^{-1}}$\n\n- 对于碘：\n$\\boldsymbol{\\mu}_{\\text{iodine}} = 4.93 \\, \\mathrm{g/cm^3} \\times [5.00, 1.94, 1.25, 0.97] \\, \\mathrm{cm^2/g} = [24.65, 9.5642, 6.1625, 4.7821] \\, \\mathrm{cm^{-1}}$\n\n- 对于骨：\n$\\boldsymbol{\\mu}_{\\text{bone}} = 1.85 \\, \\mathrm{g/cm^3} \\times [0.55, 0.38, 0.30, 0.27] \\, \\mathrm{cm^2/g} = [1.0175, 0.703, 0.555, 0.4995] \\, \\mathrm{cm^{-1}}$\n\n这些向量表示在后续步骤中使用的材料的能量依赖性衰减特性。\n\n**第 2 步：构建系统矩阵 $\\mathbf{W}$**\n\n问题定义了一个线性化模型，其中系统矩阵 $\\mathbf{W}$ 的元素由离散和给出：\n$$\nW_{k,m} = \\sum_{i=1}^{4} S_k(E_i) \\, \\mu_m(E_i)\n$$\n这里，$k \\in \\{\\text{low}, \\text{high}\\}$ 表示测量通道（低能或高能谱），$m$ 代表一种基材料。每个测试用例都给出了光谱权重 $S_k(E_i)$，并且必须将其归一化以使总和为 1。对于所有提供的测试用例，给定的光谱权重总和已为 1，因此不需要进一步归一化。\n\n对于一个基对 $\\{m_1, m_2\\}$，其 $2 \\times 2$ 系统矩阵为：\n$$\n\\mathbf{W} = \\begin{pmatrix} W_{\\text{low}, m_1}  W_{\\text{low}, m_2} \\\\ W_{\\text{high}, m_1}  W_{\\text{high}, m_2} \\end{pmatrix}\n$$\n\n我们将为三个测试用例中的每一个，都为两个基对（水/碘，记作 WI；水/骨，记作 WB）构建此矩阵。\n\n**第 3 步：计算条件数**\n\n线性系统反演的数值稳定性通过矩阵 $2$-范数条件数 $\\kappa_2(\\mathbf{W})$ 进行评估，其定义为：\n$$\n\\kappa_2(\\mathbf{W}) = \\frac{\\sigma_{\\max}(\\mathbf{W})}{\\sigma_{\\min}(\\mathbf{W})}\n$$\n其中 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 分别是 $\\mathbf{W}$ 的最大和最小奇异值。较小的条件数表示一个条件更好的系统，它在反演过程中对噪声和数值误差更具鲁棒性。奇异值是矩阵 $\\mathbf{W}^T\\mathbf{W}$ 的特征值的平方根。\n\n**第 4 步：每个测试用例的计算与决策**\n\n该程序应用于每个测试用例。决策代码分配如下：如果水/碘更稳定（$\\kappa_2(\\mathbf{W}_{\\text{WI}})  \\kappa_2(\\mathbf{W}_{\\text{WB}})$），则为 $0$；如果水/骨更稳定（$\\kappa_2(\\mathbf{W}_{\\text{WB}})  \\kappa_2(\\mathbf{W}_{\\text{WI}})$），则为 $1$；如果为平局（绝对差在 $10^{-9}$ 的容差范围内），则为 $-1$。\n\n**用例 1：典型的双能分离**\n- $S_{\\text{low}} = [0.40, 0.35, 0.20, 0.05]$\n- $S_{\\text{high}} = [0.10, 0.25, 0.35, 0.30]$\n\n对于水/碘基：\n$W_{\\text{low, water}} = \\sum S_{\\text{low}}(E_i) \\mu_{\\text{water}}(E_i) = 0.214$\n$W_{\\text{low, iodine}} = \\sum S_{\\text{low}}(E_i) \\mu_{\\text{iodine}}(E_i) \\approx 14.679$\n$W_{\\text{high, water}} = \\sum S_{\\text{high}}(E_i) \\mu_{\\text{water}}(E_i) = 0.186$\n$W_{\\text{high, iodine}} = \\sum S_{\\text{high}}(E_i) \\mu_{\\text{iodine}}(E_i) \\approx 8.448$\n$$ \\mathbf{W}_{\\text{WI}} \\approx \\begin{pmatrix} 0.214  14.679 \\\\ 0.186  8.448 \\end{pmatrix} \\implies \\kappa_2(\\mathbf{W}_{\\text{WI}}) \\approx 42.607 $$\n\n对于水/骨基：\n$W_{\\text{low, bone}} = \\sum S_{\\text{low}}(E_i) \\mu_{\\text{bone}}(E_i) \\approx 0.789$\n$W_{\\text{high, bone}} = \\sum S_{\\text{high}}(E_i) \\mu_{\\text{bone}}(E_i) \\approx 0.622$\n$$ \\mathbf{W}_{\\text{WB}} \\approx \\begin{pmatrix} 0.214  0.789 \\\\ 0.186  0.622 \\end{pmatrix} \\implies \\kappa_2(\\mathbf{W}_{\\text{WB}}) \\approx 18.525 $$\n比较：$\\kappa_2(\\mathbf{W}_{\\text{WB}})  \\kappa_2(\\mathbf{W}_{\\text{WI}})$。水/骨基更稳定。决策：$1$。\n\n**用例 2：相似的光谱**\n- $S_{\\text{low}} = [0.25, 0.25, 0.25, 0.25]$\n- $S_{\\text{high}} = [0.23, 0.27, 0.25, 0.25]$\n\n对于水/碘基：$\\kappa_2(\\mathbf{W}_{\\text{WI}}) \\approx 122.915$\n对于水/骨基：$\\kappa_2(\\mathbf{W}_{\\text{WB}}) \\approx 67.926$\n比较：$\\kappa_2(\\mathbf{W}_{\\text{WB}})  \\kappa_2(\\mathbf{W}_{\\text{WI}})$。水/骨基更稳定。决策：$1$。两个系统的高条件数反映了由于两次测量使用非常相似的光谱而引入的病态问题。\n\n**用例 3：强光谱分离**\n- $S_{\\text{low}} = [0.60, 0.30, 0.08, 0.02]$\n- $S_{\\text{high}} = [0.02, 0.08, 0.30, 0.60]$\n\n对于水/碘基：$\\kappa_2(\\mathbf{W}_{\\text{WI}}) \\approx 25.321$\n对于水/骨基：$\\kappa_2(\\mathbf{W}_{\\text{WB}}) \\approx 8.300$\n比较：$\\kappa_2(\\mathbf{W}_{\\text{WB}})  \\kappa_2(\\mathbf{W}_{\\text{WI}})$。水/骨基更稳定。决策：$1$。与用例 2 相比，强的光谱分离导致了条件更好的系统。\n\n在所有三个测试场景中，水/骨基对产生的系统矩阵具有更低的条件数，这表明对于所构建的材料分解问题，其数值稳定性更高。这表明稳定性是一个复杂的函数，它既取决于基材料之间固有的衰减差异，也取决于所使用的特定X射线光谱如何对这些差异进行采样。衰减特性的较大差异（如水和碘之间）本身并不能保证问题具有更好的条件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the dual-energy CT material decomposition stability problem\n    by calculating and comparing condition numbers for two basis pairs.\n    \"\"\"\n    \n    # Material densities (g/cm^3)\n    rho_water = 1.0\n    rho_iodine = 4.93\n    rho_bone = 1.85\n\n    # Mass attenuation coefficients (cm^2/g) for energies [40, 60, 80, 100] keV\n    mass_atten_water = np.array([0.25, 0.20, 0.18, 0.16])\n    mass_atten_iodine = np.array([5.00, 1.94, 1.25, 0.97])\n    mass_atten_bone = np.array([0.55, 0.38, 0.30, 0.27])\n\n    # Calculate linear attenuation coefficients (cm^-1)\n    mu_water = rho_water * mass_atten_water\n    mu_iodine = rho_iodine * mass_atten_iodine\n    mu_bone = rho_bone * mass_atten_bone\n\n    # Define basis pairs using the calculated linear attenuation vectors\n    basis_pairs = [\n        {\"name\": \"Water/Iodine\", \"materials\": (mu_water, mu_iodine)},\n        {\"name\": \"Water/Bone\", \"materials\": (mu_water, mu_bone)},\n    ]\n\n    # Test suite: spectra for low and high energy channels\n    test_cases = [\n        {\n            \"name\": \"Case 1 (typical dual-energy separation)\",\n            \"spectra\": {\n                \"low\": np.array([0.40, 0.35, 0.20, 0.05]),\n                \"high\": np.array([0.10, 0.25, 0.35, 0.30]),\n            }\n        },\n        {\n            \"name\": \"Case 2 (spectra more similar)\",\n            \"spectra\": {\n                \"low\": np.array([0.25, 0.25, 0.25, 0.25]),\n                \"high\": np.array([0.23, 0.27, 0.25, 0.25]),\n            }\n        },\n        {\n            \"name\": \"Case 3 (strong spectral separation)\",\n            \"spectra\": {\n                \"low\": np.array([0.60, 0.30, 0.08, 0.02]),\n                \"high\": np.array([0.02, 0.08, 0.30, 0.60]),\n            }\n        },\n    ]\n\n    tolerance = 1e-9\n    all_results = []\n\n    for case in test_cases:\n        s_low = case[\"spectra\"][\"low\"]\n        s_high = case[\"spectra\"][\"high\"]\n        \n        # Normalize spectra to sum to 1, as per problem description\n        s_low_norm = s_low / np.sum(s_low)\n        s_high_norm = s_high / np.sum(s_high)\n\n        case_cond_numbers = []\n        # Calculate condition number for Water/Iodine basis\n        mu_m1_wi, mu_m2_wi = basis_pairs[0][\"materials\"]\n        W_low_m1_wi = np.dot(s_low_norm, mu_m1_wi)\n        W_low_m2_wi = np.dot(s_low_norm, mu_m2_wi)\n        W_high_m1_wi = np.dot(s_high_norm, mu_m1_wi)\n        W_high_m2_wi = np.dot(s_high_norm, mu_m2_wi)\n        W_wi = np.array([[W_low_m1_wi, W_low_m2_wi], [W_high_m1_wi, W_high_m2_wi]])\n        kappa_wi = np.linalg.cond(W_wi, 2)\n        \n        # Calculate condition number for Water/Bone basis\n        mu_m1_wb, mu_m2_wb = basis_pairs[1][\"materials\"]\n        W_low_m1_wb = np.dot(s_low_norm, mu_m1_wb)\n        W_low_m2_wb = np.dot(s_low_norm, mu_m2_wb)\n        W_high_m1_wb = np.dot(s_high_norm, mu_m1_wb)\n        W_high_m2_wb = np.dot(s_high_norm, mu_m2_wb)\n        W_wb = np.array([[W_low_m1_wb, W_low_m2_wb], [W_high_m1_wb, W_high_m2_wb]])\n        kappa_wb = np.linalg.cond(W_wb, 2)\n        \n        # Make decision\n        decision = 0\n        if np.abs(kappa_wi - kappa_wb) = tolerance:\n            decision = -1  # Tie\n        elif kappa_wb  kappa_wi:\n            decision = 1  # Water/Bone is more stable\n        # else decision remains 0 for Water/Iodine\n        \n        all_results.append([kappa_wi, kappa_wb, decision])\n\n    # Format the final output string exactly as required\n    result_str = str(all_results).replace(\" \", \"\")\n    print(result_str)\n\nsolve()\n```"
        }
    ]
}