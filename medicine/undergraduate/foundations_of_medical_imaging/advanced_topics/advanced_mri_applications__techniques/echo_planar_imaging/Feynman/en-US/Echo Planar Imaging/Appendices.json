{
    "hands_on_practices": [
        {
            "introduction": "A hallmark artifact of Echo Planar Imaging is the \"N/2 ghost,\" a fainter copy of the main image shifted by half the field-of-view. This practice delves into the physical origins of this phenomenon, which stems from the rapid, alternating gradient scheme that gives EPI its speed. By applying fundamental principles of the Fourier transform, this exercise mathematically reveals how minute, alternating phase inconsistencies between k-space lines inevitably lead to the creation of this characteristic ghost artifact .",
            "id": "4880976",
            "problem": "Consider a two-dimensional Echo Planar Imaging (EPI) acquisition in the foundations of medical imaging, where the phase-encode dimension is along $y$ with a field of view $\\text{FOV}_y$ and $N$ uniformly spaced phase-encode lines indexed by integer $n \\in \\{0,1,\\dots,N-1\\}$. Let the ideal, artifact-free k-space data be $K_{0}(n,k_{x})$, which produce the ideal image $I_{0}(y,x)$ via a discrete inverse Fourier relationship along $y$ given by\n$$\nI_{0}(y,x) = \\sum_{n=0}^{N-1} K_{0}(n,k_{x}) \\exp\\!\\left(i \\frac{2\\pi n y}{\\text{FOV}_y}\\right),\n$$\nwith the dependence on $k_{x}$ suppressed by the sum over $k_{x}$ in the final image formation. Due to system timing imperfections or eddy currents, assume that all odd phase-encode lines (those with $n$ odd) acquire an additional constant phase offset $\\phi$ relative to the even lines. The measured k-space is therefore modeled as\n$$\nK(n,k_{x}) = K_{0}(n,k_{x}) \\exp\\!\\left(i \\phi\\, s(n)\\right),\n$$\nwhere $s(n)$ equals $1$ for odd $n$ and $0$ for even $n$. The reconstructed image along $y$ is\n$$\nI(y,x) = \\sum_{n=0}^{N-1} K(n,k_{x}) \\exp\\!\\left(i \\frac{2\\pi n y}{\\text{FOV}_y}\\right).\n$$\nStarting from the Fourier relationship between k-space modulation and image-domain shifts, and using only fundamental properties of the discrete Fourier transform, derive how this alternating line phase produces a ghost displaced by $\\pm \\text{FOV}_y/2$ in the image domain. Then, express the ratio of the ghost magnitude to the main image magnitude (i.e., the magnitude of the coefficient multiplying the ghost image divided by the magnitude of the coefficient multiplying the main image), as a closed-form analytic expression in terms of $\\phi$. Your final answer must be a single real-valued analytic expression. No numerical evaluation is required, and no rounding is needed. The answer should be dimensionless.",
            "solution": "The reconstructed image $I(y,x)$ is formed by applying an inverse discrete Fourier transform to the measured k-space data $K(n,k_x)$. The measured data is the ideal data $K_0(n,k_x)$ multiplied by a modulation factor $m(n) = \\exp(i\\phi s(n))$ that applies a phase $\\phi$ to odd lines ($n$ is odd) and no phase to even lines ($n$ is even).\n$$\nI(y,x) = \\sum_{n=0}^{N-1} K_{0}(n,k_{x}) \\exp(i \\phi s(n)) \\exp\\left(i \\frac{2\\pi n y}{\\text{FOV}_y}\\right)\n$$\nTo analyze the effect of the modulation $m(n)$, we express it as a linear combination of a constant sequence and a purely alternating sequence. Let $m(n) = A + B(-1)^n$. We can solve for the coefficients $A$ and $B$:\nFor an even line ($n=0$): $m(0) = 1 = A + B$.\nFor an odd line ($n=1$): $m(1) = e^{i\\phi} = A - B$.\n\nSolving this system of two linear equations yields:\n$A = \\frac{1 + e^{i\\phi}}{2}$\n$B = \\frac{1 - e^{i\\phi}}{2}$\n\nSubstituting this decomposition back into the image reconstruction formula:\n$$\nI(y,x) = \\sum_{n=0}^{N-1} K_{0}(n,k_{x}) [A + B(-1)^n] \\exp\\left(i \\frac{2\\pi n y}{\\text{FOV}_y}\\right)\n$$\nThis sum can be split into two parts:\n$$\nI(y,x) = A \\sum_{n=0}^{N-1} K_{0}(n,k_{x}) \\exp\\left(i \\frac{2\\pi n y}{\\text{FOV}_y}\\right) + B \\sum_{n=0}^{N-1} K_{0}(n,k_{x}) (-1)^n \\exp\\left(i \\frac{2\\pi n y}{\\text{FOV}_y}\\right)\n$$\nThe first term is simply $A \\cdot I_0(y,x)$, which is the ideal image scaled by a complex coefficient $A$.\n\nFor the second term, we use the identity $(-1)^n = e^{i\\pi n}$. This modifies the exponential term:\n$$\n\\text{Second term} = B \\sum_{n=0}^{N-1} K_{0}(n,k_{x}) \\exp(i\\pi n) \\exp\\left(i \\frac{2\\pi n y}{\\text{FOV}_y}\\right) = B \\sum_{n=0}^{N-1} K_{0}(n,k_{x}) \\exp\\left(i \\frac{2\\pi n}{\\text{FOV}_y} \\left(y + \\frac{\\text{FOV}_y}{2}\\right)\\right)\n$$\nBy the shift property of the discrete Fourier transform, this is equivalent to the ideal image shifted by half the field of view:\n$$\n\\text{Second term} = B \\cdot I_0\\left(y + \\frac{\\text{FOV}_y}{2}, x\\right)\n$$\nThis is the \"ghost\" image. The reconstructed image is a superposition of the main image and its shifted ghost:\n$$\nI(y,x) = A \\cdot I_0(y,x) + B \\cdot I_0\\left(y + \\frac{\\text{FOV}_y}{2}, x\\right)\n$$\nThe ratio of the ghost magnitude to the main image magnitude is the ratio of the magnitudes of their complex coefficients, $|B|/|A|$.\n\nUsing Euler's formula, we find the magnitudes:\n$|A| = \\left| \\frac{1 + \\cos(\\phi) + i\\sin(\\phi)}{2} \\right| = \\left| \\frac{2\\cos^2(\\phi/2) + i(2\\sin(\\phi/2)\\cos(\\phi/2))}{2} \\right| = |\\cos(\\phi/2)(\\cos(\\phi/2) + i\\sin(\\phi/2))| = |\\cos(\\phi/2)|$\n$|B| = \\left| \\frac{1 - \\cos(\\phi) - i\\sin(\\phi)}{2} \\right| = \\left| \\frac{2\\sin^2(\\phi/2) - i(2\\sin(\\phi/2)\\cos(\\phi/2))}{2} \\right| = |\\sin(\\phi/2)(\\sin(\\phi/2) - i\\cos(\\phi/2))| = |\\sin(\\phi/2)|$\n\nThe ratio is therefore:\n$$\n\\frac{|B|}{|A|} = \\frac{|\\sin(\\phi/2)|}{|\\cos(\\phi/2)|} = |\\tan(\\phi/2)|\n$$\nThis is the closed-form analytic expression for the magnitude ratio.",
            "answer": "$$\n\\boxed{|\\tan(\\phi/2)|}\n$$"
        },
        {
            "introduction": "Beyond ghosting, EPI is susceptible to geometric distortions, causing images to appear warped, stretched, or compressed, particularly near air-tissue interfaces where the magnetic field is inhomogeneous. This effect is a direct consequence of EPI's long data acquisition window, which allows phase errors from local field offsets to accumulate. This exercise provides a quantitative framework to calculate the magnitude of this distortion and prompts you to think like a sequence designer, exploring practical strategies to mitigate it by adjusting imaging parameters .",
            "id": "4881057",
            "problem": "A single-shot two-dimensional gradient-echo Echo Planar Imaging (EPI) acquisition is performed with the following parameters along the phase-encode direction: number of phase-encode lines $N_{\\text{pe}} = 128$, echo spacing $\\text{ESP} = 0.60$ ms, and phase-encode k-space increment $\\Delta k_y = 3.90625$ m$^{-1}$ (a value consistent with a phase-encode field of view of $0.256$ m). An independently measured static off-resonance field inhomogeneity map reports a local frequency offset of $\\Delta f = 80$ Hz at a particular voxel. Using only fundamental signal formation principles, derive from first principles the relationship between $\\Delta f$, $\\text{ESP}$, and $\\Delta k_y$ that predicts the geometric displacement along the phase-encode direction, convert that displacement to pixels, and then evaluate it for the given parameters. Next, based on the same physical reasoning, propose at least two concrete sequence parameter changes that would reduce the geometric distortion while maintaining the same single-scan Signal-to-Noise Ratio (SNR) per voxel, and briefly justify each proposal qualitatively.\n\nReport only the magnitude of the geometric distortion as a pure number in pixels, rounded to three significant figures, as your final answer.",
            "solution": "The problem asks for a derivation of geometric displacement, its calculation in pixels, and proposals for its reduction.\n\n**Part 1: Derivation of Geometric Displacement**\n\nIn MRI, spatial location is encoded in signal phase. The total phase $\\phi_{\\text{total}}(t)$ accumulated at time $t$ for a spin at true position $y$ in the presence of an off-resonance frequency offset $\\Delta f$ is the sum of the intended encoding phase and an error phase:\n$$\n\\phi_{\\text{total}}(t) = \\phi_{\\text{intended}}(t) + \\phi_{\\text{error}}(t) = 2\\pi k_y(t) y + 2\\pi \\Delta f t\n$$\nThe image reconstruction algorithm misinterprets this total phase as originating from an apparent position $y'$:\n$$\n\\phi_{\\text{total}}(t) = 2\\pi k_y(t) y'\n$$\nEquating the two expressions gives:\n$$\n2\\pi k_y(t) y' = 2\\pi k_y(t) y + 2\\pi \\Delta f t \\implies k_y(t) y' = k_y(t) y + \\Delta f t\n$$\nIn single-shot EPI, the $n$-th k-space line, $k_{y,n} = n \\cdot \\Delta k_y$, is acquired at time $t_n = n \\cdot \\text{ESP}$ (relative to k-space center). Substituting these discrete values (for $n \\neq 0$):\n$$\n(n \\cdot \\Delta k_y) y' = (n \\cdot \\Delta k_y) y + \\Delta f (n \\cdot \\text{ESP})\n$$\nThe apparent position $y'$ is thus:\n$$\ny' = y + \\frac{\\Delta f \\cdot \\text{ESP}}{\\Delta k_y}\n$$\nThe geometric displacement $\\Delta y$ is the difference between the apparent and true positions:\n$$\n\\Delta y = y' - y = \\frac{\\Delta f \\cdot \\text{ESP}}{\\Delta k_y}\n$$\n\n**Part 2: Evaluation of Displacement in Pixels**\n\nFirst, calculate the displacement $\\Delta y$ in meters:\n$\\Delta f = 80 \\text{ Hz}$\n$\\text{ESP} = 0.60 \\text{ ms} = 0.60 \\times 10^{-3} \\text{ s}$\n$\\Delta k_y = 3.90625 \\text{ m}^{-1}$\n\n$$\n\\Delta y = \\frac{(80 \\text{ s}^{-1}) \\cdot (0.60 \\times 10^{-3} \\text{ s})}{3.90625 \\text{ m}^{-1}} = 0.012288 \\text{ m}\n$$\nNext, convert this to pixels. The pixel size $\\delta y$ in the phase-encode direction is the field of view ($\\text{FoV}_y$) divided by the number of pixels ($N_{\\text{pe}}$). Since $\\text{FoV}_y = 1/\\Delta k_y$:\n$$\n\\delta y = \\frac{\\text{FoV}_y}{N_{\\text{pe}}} = \\frac{1}{N_{\\text{pe}} \\Delta k_y} = \\frac{1}{128 \\cdot 3.90625 \\text{ m}^{-1}} = \\frac{1}{500} \\text{ m} = 0.002 \\text{ m}\n$$\nThe displacement in pixels is $\\Delta y_{\\text{pixels}} = \\Delta y / \\delta y$:\n$$\n\\Delta y_{\\text{pixels}} = \\frac{0.012288 \\text{ m}}{0.002 \\text{ m/pixel}} = 6.144 \\text{ pixels}\n$$\nAlternatively, the displacement in pixels can be calculated directly: $\\Delta y_{\\text{pixels}} = \\Delta f \\cdot N_{\\text{pe}} \\cdot \\text{ESP} = 80 \\cdot 128 \\cdot (0.60 \\times 10^{-3}) = 6.144$.\nRounded to three significant figures, the displacement is 6.14 pixels.\n\n**Part 3: Proposals for Reducing Geometric Distortion**\n\nThe distortion in pixels is proportional to the total echo train duration, $N_{\\text{pe}} \\cdot \\text{ESP}$. To reduce distortion, this duration must be shortened, while maintaining SNR.\n\n1.  **Employ parallel imaging (e.g., SENSE, GRAPPA).**\n    *   **Justification:** Using an acceleration factor $R > 1$ reduces the number of acquired phase-encode lines to $N_{\\text{pe}}/R$. This shortens the echo train duration by a factor of $R$, directly reducing the geometric distortion. Parallel imaging incurs an SNR penalty, approximately $1/(g\\sqrt{R})$, where $g \\ge 1$ is the geometry factor. To satisfy the constraint of maintaining SNR, one could increase the voxel volume, for example by increasing the slice thickness $\\delta_z$, since SNR is proportional to voxel volume. This is a common and practical trade-off.\n\n2.  **Increase the readout gradient amplitude to shorten the Echo Spacing (ESP).**\n    *   **Justification:** A stronger, faster-switching readout gradient allows for a shorter ESP. This reduces the total echo train duration ($N_{\\text{pe}} \\cdot \\text{ESP}$), thereby reducing distortion. A shorter ESP implies a wider readout bandwidth per pixel. This increases thermal noise, reducing SNR. To maintain SNR, one can compensate by increasing the voxel volume, for example by reducing the in-plane resolution (decreasing $N_{\\text{pe}}$ and $N_{ro}$ for a fixed FOV) or increasing the slice thickness $\\delta_z$. This strategy trades spatial resolution for reduced distortion and maintained SNR.",
            "answer": "$$\\boxed{6.14}$$"
        },
        {
            "introduction": "After tackling artifacts, we now turn to optimization for one of EPI's most powerful applications: functional MRI (fMRI). The sensitivity to the Blood Oxygen Level Dependent (BOLD) signal depends critically on the echo time ($TE$). This practice introduces the concept of an \"effective\" echo time ($TE_{\\text{eff}}$), determined by when the center of k-space is acquired, and demonstrates how a simple change in the k-space traversal order can profoundly impact the sequence's sensitivity to brain activation, a crucial concept in fMRI experimental design .",
            "id": "4880953",
            "problem": "A single-shot gradient-echo Echo Planar Imaging (EPI) acquisition is used for Functional Magnetic Resonance Imaging (fMRI) to detect Blood Oxygen Level Dependent (BOLD) contrast. In gradient-echo imaging, the image contrast that reflects effective transverse relaxation is dominated by when the low spatial frequencies near the center of phase-encode space are acquired. Define the effective echo time as the time from excitation to the acquisition of the center of phase-encode space, denoted by $TE_{\\text{eff}}$.\n\nConsider an EPI sequence that acquires a total of $N$ phase-encode lines in one shot, with the time separation between the centers of successive k-space lines equal to $\\Delta t_{\\text{line}}$. Assume the center of phase-encode space ($k_{y}=0$) is acquired:\n- for linear ordering, halfway through the train of $N$ lines,\n- for centric ordering, as the very first line.\n\nAssume the scanner timing is unchanged when switching between these two traversal orders, so the time from excitation to the center of the first acquired readout line remains the same. For small activation-induced changes in the effective transverse relaxation rate $R_{2}^{*}$, you may use the well-tested small-signal approximation that the magnitude of the fractional BOLD signal change scales linearly with the effective echo time, $|\\Delta S|/S \\approx TE_{\\text{eff}}\\cdot|\\Delta R_{2}^{*}|$, when all other acquisition parameters are held fixed.\n\nGiven:\n- $N = 64$,\n- $\\Delta t_{\\text{line}} = 0.8\\,\\text{ms}$,\n- the sequence echo time that coincides with the center of $k$-space for linear ordering is $TE_{\\text{linear}} = 35\\,\\text{ms}$,\n\ncompute the ratio of BOLD sensitivity (magnitude of fractional signal change) for centric ordering relative to linear ordering under these conditions. Round your answer to $3$ significant figures. Express your answer as a pure number with no units.",
            "solution": "The problem asks for the ratio of BOLD sensitivity between centric and linear k-space ordering schemes. According to the provided approximation, BOLD sensitivity is directly proportional to the effective echo time, $TE_{\\text{eff}}$. Therefore, the desired ratio is:\n$$\n\\frac{\\text{Sensitivity}_{\\text{centric}}}{\\text{Sensitivity}_{\\text{linear}}} = \\frac{TE_{\\text{centric}}}{TE_{\\text{linear}}}\n$$\nWe are given $TE_{\\text{linear}} = 35\\,\\text{ms}$. We need to find $TE_{\\text{centric}}$.\n\nLet $t_1$ be the time from the RF excitation to the acquisition of the *first* line in the echo train. For a sequence of $N$ lines with spacing $\\Delta t_{\\text{line}}$, the $k$-th line is acquired at time $t_k = t_1 + (k-1)\\Delta t_{\\text{line}}$.\n\nFor the **linear ordering** scheme, the center of k-space ($k_y=0$) is acquired halfway through the train of $N$ lines. For a discrete set of $N$ echoes, this corresponds to the time to acquire the line at the temporal midpoint. This time is $TE_{\\text{linear}}$:\n$$\nTE_{\\text{linear}} = t_1 + \\frac{N-1}{2}\\Delta t_{\\text{line}}\n$$\nWe can use the given values to solve for the unknown start time $t_1$:\n$N = 64$\n$\\Delta t_{\\text{line}} = 0.8\\,\\text{ms}$\n$TE_{\\text{linear}} = 35\\,\\text{ms}$\n\nPlugging these into the equation:\n$$\n35\\,\\text{ms} = t_1 + \\frac{64-1}{2} \\times 0.8\\,\\text{ms}\n$$\n$$\n35\\,\\text{ms} = t_1 + 31.5 \\times 0.8\\,\\text{ms}\n$$\n$$\n35\\,\\text{ms} = t_1 + 25.2\\,\\text{ms}\n$$\nSolving for $t_1$:\n$$\nt_1 = 35\\,\\text{ms} - 25.2\\,\\text{ms} = 9.8\\,\\text{ms}\n$$\nFor the **centric ordering** scheme, the center of k-space is acquired as the very first line. Therefore, the effective echo time for this scheme is the time to acquire the first line:\n$$\nTE_{\\text{centric}} = t_1 = 9.8\\,\\text{ms}\n$$\nNow, we can compute the ratio of BOLD sensitivities:\n$$\n\\frac{\\text{Sensitivity}_{\\text{centric}}}{\\text{Sensitivity}_{\\text{linear}}} = \\frac{TE_{\\text{centric}}}{TE_{\\text{linear}}} = \\frac{9.8\\,\\text{ms}}{35\\,\\text{ms}} = 0.28\n$$\nRounding to 3 significant figures, the ratio is $0.280$.",
            "answer": "$$\\boxed{0.280}$$"
        }
    ]
}