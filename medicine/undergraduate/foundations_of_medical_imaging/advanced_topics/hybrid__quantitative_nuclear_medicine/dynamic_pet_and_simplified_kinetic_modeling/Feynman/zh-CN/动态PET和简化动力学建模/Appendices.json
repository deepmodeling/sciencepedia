{
    "hands_on_practices": [
        {
            "introduction": "Patlak 图解分析是一种强大的简化方法，但其有效性取决于一个关键假设：可逆的组织室必须与血浆达到准平衡状态。本练习将指导您推导达到这种平衡状态的精确条件。通过计算系统达到此状态所需的最短时间 $t^*$，您将更深入地理解这种广泛应用的动力学建模技术的理论基础。",
            "id": "4880104",
            "problem": "一次推注动态正电子发射断层扫描（PET）的葡萄糖代谢过程采用不可逆二室模型进行建模，其中示踪剂在血浆和可逆组织室之间交换，然后不可逆地积聚在捕获室中。忽略全血（血管）容积。设血浆输入函数表示为 $C_P(t)$，可逆组织室为 $C_1(t)$，捕获组织室为 $C_2(t)$，因此总组织活性为 $C_T(t) = C_1(t) + C_2(t)$。微观参数包括从血浆到组织的流入速率常数 $K_1$，从可逆室返回血浆的流出速率常数 $k_2$，以及从可逆室到捕获室的捕获速率常数 $k_3$，其中 $k_4=0$。对于此次扫描，假设在首次通过峰值后，动脉输入函数的尾部可以很好地由单指数函数 $C_P(t) = A \\exp(-\\lambda t)$（对于 $t \\ge 0$）近似，其中 $A>0$ 和 $\\lambda>0$ 是常数。\n\n当可逆室对归一化组织浓度 $C_T(t)/C_P(t)$ 的贡献随时间变得基本恒定时，即达到 Patlak 线性。定义 $t^{\\ast}$ 为最早的时间点，此时可逆室对 $C_T(t)/C_P(t)$ 的贡献与其渐近常数值的偏差不超过分数容差 $\\varepsilon = 0.01$。使用以下微观参数和尾部衰减常数：$K_1 = 0.10$ $\\mathrm{mL}\\,\\mathrm{min}^{-1}\\,\\mathrm{mL}^{-1}$，$k_2 = 0.15$ $\\mathrm{min}^{-1}$，$k_3 = 0.05$ $\\mathrm{min}^{-1}$，以及 $\\lambda = 0.02$ $\\mathrm{min}^{-1}$。\n\n从质量平衡和所述的模型假设与定义出发，确定 $t^{\\ast}$（单位为分钟）。将您的答案四舍五入到四位有效数字。最终时间以分钟表示。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、提法恰当且客观。\n\n### 第1步：提取已知条件\n-   **模型**：不可逆二室模型。\n-   **房室**：血浆 ($C_P(t)$)、可逆组织 ($C_1(t)$)、捕获组织 ($C_2(t)$)。\n-   **总组织活性**：$C_T(t) = C_1(t) + C_2(t)$。\n-   **血浆输入函数**：$C_P(t) = A \\exp(-\\lambda t)$，对于 $t \\ge 0$，其中 $A > 0$ 且 $\\lambda > 0$。\n-   **微观参数**：\n    -   流入速率常数：$K_1 = 0.10$ $\\mathrm{mL}\\,\\mathrm{min}^{-1}\\,\\mathrm{mL}^{-1}$ (等效于 $0.10$ $\\mathrm{min}^{-1}$)。\n    -   流出速率常数：$k_2 = 0.15$ $\\mathrm{min}^{-1}$。\n    -   捕获速率常数：$k_3 = 0.05$ $\\mathrm{min}^{-1}$。\n    -   反向捕获速率：$k_4 = 0$。\n-   **输入函数衰减常数**：$\\lambda = 0.02$ $\\mathrm{min}^{-1}$。\n-   **Patlak 线性条件**：可逆室对归一化组织浓度 $C_T(t)/C_P(t)$ 的贡献变得基本恒定。此贡献被确定为 $C_1(t)/C_P(t)$。\n-   **$t^{\\ast}$ 的定义**：最早的时间点，使得 $C_1(t)/C_P(t)$ 与其渐近常数值的分数偏差不超过 $\\varepsilon = 0.01$。\n-   **初始条件**：隐含地，$C_1(0) = 0$ 和 $C_2(0) = 0$，因为示踪剂是在 $t=0$ 时引入的。\n\n### 第2步：使用提取的已知条件进行验证\n-   **科学依据**：不可逆二室模型是定量PET中的一个标准和基本构造，特别是对于像 [$^{18}$F]FDG 这样的示踪剂。基于质量平衡的微分方程是正确的物理基础。Patlak 分析的概念和线性条件是公认的。该模型具有科学合理性。\n-   **提法恰当**：问题为待计算量（$t^*$）提供了明确的定义，给出了充足的参数和条件（所有速率常数、输入函数的形式以及容差 $\\varepsilon$），并要求一个唯一的数值。该设定导向一个唯一的、稳定的解。\n-   **客观性**：问题以精确、定量且无偏见的科学语言陈述。\n-   **完整性和一致性**：提供了所有必要的数值和函数形式。所有参数的单位一致（所有速率单位均为 $\\mathrm{min}^{-1}$）。没有矛盾之处。\n\n### 第3步：结论与行动\n问题有效。将提供解答。\n\n### 解题推导\n可逆组织室 $C_1(t)$ 的动态由质量平衡原理描述。该室中示踪剂浓度的变化率等于从血浆的流入速率减去返回血浆的流出速率以及捕获到第二组织室的速率。这由以下微分方程表示：\n$$\n\\frac{dC_1(t)}{dt} = K_1 C_P(t) - k_2 C_1(t) - k_3 C_1(t)\n$$\n这可以重排成一个标准的一阶线性常微分方程：\n$$\n\\frac{dC_1(t)}{dt} + (k_2 + k_3) C_1(t) = K_1 C_P(t)\n$$\n问题指定了 $t \\ge 0$ 时的血浆输入函数为 $C_P(t) = A \\exp(-\\lambda t)$。将其代入微分方程，得到：\n$$\n\\frac{dC_1(t)}{dt} + (k_2 + k_3) C_1(t) = K_1 A \\exp(-\\lambda t)\n$$\n该方程在初始条件 $C_1(0) = 0$ 下求解。解可以通过积分因子法找到，或者假设解的形式为 $C_1(t) = C_{1,h}(t) + C_{1,p}(t)$，其中 $C_{1,h}$ 是齐次解，$C_{1,p}$ 是特解。通解为：\n$$\nC_1(t) = \\frac{K_1 A}{k_2 + k_3 - \\lambda} \\exp(-\\lambda t) + C \\exp(-(k_2 + k_3)t)\n$$\n其中 $C$ 是一个积分常数。我们假设 $k_2 + k_3 \\neq \\lambda$。根据给定的参数，$k_2 + k_3 = 0.15 + 0.05 = 0.20$ $\\mathrm{min}^{-1}$ 且 $\\lambda = 0.02$ $\\mathrm{min}^{-1}$，因此这个条件成立。\n应用初始条件 $C_1(0) = 0$：\n$$\n0 = \\frac{K_1 A}{k_2 + k_3 - \\lambda} \\exp(0) + C \\exp(0) \\implies C = -\\frac{K_1 A}{k_2 + k_3 - \\lambda}\n$$\n将 $C$ 代回，得到 $C_1(t)$ 的特解为：\n$$\nC_1(t) = \\frac{K_1 A}{k_2 + k_3 - \\lambda} \\left( \\exp(-\\lambda t) - \\exp(-(k_2 + k_3)t) \\right)\n$$\n问题要求我们分析可逆室对归一化组织浓度的贡献。该项为 $R(t) = C_1(t) / C_P(t)$。\n$$\nR(t) = \\frac{C_1(t)}{C_P(t)} = \\frac{\\frac{K_1 A}{k_2 + k_3 - \\lambda} \\left( \\exp(-\\lambda t) - \\exp(-(k_2 + k_3)t) \\right)}{A \\exp(-\\lambda t)}\n$$\n$$\nR(t) = \\frac{K_1}{k_2 + k_3 - \\lambda} \\left( 1 - \\frac{\\exp(-(k_2 + k_3)t)}{\\exp(-\\lambda t)} \\right)\n$$\n$$\nR(t) = \\frac{K_1}{k_2 + k_3 - \\lambda} \\left( 1 - \\exp(-(k_2 + k_3 - \\lambda)t) \\right)\n$$\n问题指出当此项变得基本恒定时，即达到 Patlak 线性。我们求 $R(t)$ 在 $t \\to \\infty$ 时的渐近值。设其为 $R_{\\text{asymp}}$。\n$$\nR_{\\text{asymp}} = \\lim_{t \\to \\infty} R(t) = \\lim_{t \\to \\infty} \\frac{K_1}{k_2 + k_3 - \\lambda} \\left( 1 - \\exp(-(k_2 + k_3 - \\lambda)t) \\right)\n$$\n由于 $k_2 + k_3 - \\lambda = 0.20 - 0.02 = 0.18 > 0$，指数项 $\\exp(-(k_2 + k_3 - \\lambda)t)$ 在 $t \\to \\infty$ 时趋近于 $0$。\n$$\nR_{\\text{asymp}} = \\frac{K_1}{k_2 + k_3 - \\lambda}\n$$\n时间 $t^{\\ast}$ 的定义是 $R(t)$ 相对于 $R_{\\text{asymp}}$ 的分数偏差等于容差 $\\varepsilon = 0.01$。分数偏差由 $\\frac{|R(t) - R_{\\text{asymp}}|}{R_{\\text{asymp}}}$ 给出。\n绝对偏差为：\n$$\n|R(t) - R_{\\text{asymp}}| = \\left| \\frac{K_1}{k_2 + k_3 - \\lambda} \\left( 1 - \\exp(-(k_2 + k_3 - \\lambda)t) \\right) - \\frac{K_1}{k_2 + k_3 - \\lambda} \\right|\n$$\n$$\n|R(t) - R_{\\text{asymp}}| = \\left| -\\frac{K_1}{k_2 + k_3 - \\lambda} \\exp(-(k_2 + k_3 - \\lambda)t) \\right| = \\frac{K_1}{k_2 + k_3 - \\lambda} \\exp(-(k_2 + k_3 - \\lambda)t)\n$$\n在时间 $t = t^{\\ast}$ 时的分数偏差为：\n$$\n\\frac{|R(t^{\\ast}) - R_{\\text{asymp}}|}{R_{\\text{asymp}}} = \\frac{\\frac{K_1}{k_2 + k_3 - \\lambda} \\exp(-(k_2 + k_3 - \\lambda)t^{\\ast})}{\\frac{K_1}{k_2 + k_3 - \\lambda}} = \\exp(-(k_2 + k_3 - \\lambda)t^{\\ast})\n$$\n我们令其等于 $\\varepsilon$：\n$$\n\\exp(-(k_2 + k_3 - \\lambda)t^{\\ast}) = \\varepsilon\n$$\n为求解 $t^{\\ast}$，我们对两边取自然对数：\n$$\n-(k_2 + k_3 - \\lambda)t^{\\ast} = \\ln(\\varepsilon)\n$$\n$$\nt^{\\ast} = -\\frac{\\ln(\\varepsilon)}{k_2 + k_3 - \\lambda}\n$$\n现在，我们代入给定的数值：\n-   $k_2 = 0.15$ $\\mathrm{min}^{-1}$\n-   $k_3 = 0.05$ $\\mathrm{min}^{-1}$\n-   $\\lambda = 0.02$ $\\mathrm{min}^{-1}$\n-   $\\varepsilon = 0.01$\n\n分母为 $k_2 + k_3 - \\lambda = 0.15 + 0.05 - 0.02 = 0.18$ $\\mathrm{min}^{-1}$。\n分子为 $-\\ln(\\varepsilon) = -\\ln(0.01) = -\\ln(10^{-2}) = 2\\ln(10)$。\n数值上，$\\ln(0.01) \\approx -4.605170$。\n$$\nt^{\\ast} = -\\frac{-4.605170}{0.18} \\approx 25.584278 \\text{ min}\n$$\n问题要求将答案四舍五入到四位有效数字。\n$$\nt^{\\ast} \\approx 25.58 \\text{ min}\n$$",
            "answer": "$$\\boxed{25.58}$$"
        },
        {
            "introduction": "从理论走向应用，本练习专注于如何从离散采样的 PET 数据中计算净摄取率 $K_i$。您将使用梯形法则这一基本数值积分方法来构建 Patlak 图所需的变量。此外，本练习还提出了一个涉及数据采样间隙的假设情景，使您能够量化不完整数据可能引入的显著偏差，并强调高质量数据采集在定量成像中的重要性。",
            "id": "4880125",
            "problem": "一项不可逆示踪剂的动态正电子发射断层扫描 (PET) 研究由一个不可逆二组织室模型来建模，该模型包含一个浓度为 $C_{f}(t)$ 的自由室和一个浓度为 $C_{b}(t)$ 的捕获室。动脉血浆输入函数为 $C_{P}(t)$（已进行衰变校正至扫描开始时刻）。总组织浓度为 $C_{T}(t) = C_{f}(t) + C_{b}(t)$。该系统由质量平衡方程控制：\n- $\\dfrac{d C_{f}}{dt} = k_{1} C_{P}(t) - (k_{2} + k_{3}) C_{f}(t)$，\n- $\\dfrac{d C_{b}}{dt} = k_{3} C_{f}(t)$，\n初始条件为 $C_{f}(0) = 0$ 和 $C_{b}(0) = 0$。假设在测量的组织信号中，血容量分数可以忽略不计。\n\n在足够晚的时间点，当可逆室 $C_{f}(t)$ 与血浆处于准稳态时，血浆标准化的组织函数与血浆标准化的输入积分之间存在线性关系，其斜率等于净流入速率常数 $K_{i}$，其截距等于可逆室的分布容积。仅从上述质量平衡方程和标准微积分出发，推导这种晚期线性化关系，并用模型参数表示其斜率。\n\n给定以下在时间点 $t$（单位：$\\mathrm{min}$）测得的经过衰变校正的动脉血浆输入函数样本 $C_{P}(t)$（单位：$\\mathrm{kBq}/\\mathrm{mL}$）：\n- $(t, C_{P}(t)) = (0, 0.0)$,\n- $(0.5, 6.0)$,\n- $(1, 5.0)$,\n- $(2, 3.0)$,\n- $(5, 1.5)$,\n- $(10, 1.0)$,\n- $(20, 0.6)$,\n- $(30, 0.45)$,\n- $(40, 0.35)$.\n\n在 $t = 30$ 分钟和 $t = 40$ 分钟时，测得的组织浓度分别为 $C_{T}(30) = 0.3675$ $\\mathrm{kBq}/\\mathrm{mL}$ 和 $C_{T}(40) = 0.4025$ $\\mathrm{kBq}/\\mathrm{mL}$。仅使用这两个晚期时间点来线性估算净流入速率常数 $K_{i}$。\n\n任务：\n1) 对上述完整的动脉输入样本数据集使用梯形法则，计算积分 $\\int_{0}^{30} C_{P}(t)\\,dt$ 和 $\\int_{0}^{40} C_{P}(t)\\,dt$，单位为 $\\mathrm{kBq}\\cdot\\mathrm{min}/\\mathrm{mL}$。\n\n2) 使用您推导的晚期线性化关系，构建适当的血浆标准化变量，并使用 $t = 30$ 分钟和 $t = 40$ 分钟的晚期样本计算两点斜率，从而根据全采样积分估算 $K_{i}$。\n\n3) 现在考虑一个采样间断的情景：假设严格在 $t = 2$ 分钟和 $t = 20$ 分钟之间的所有动脉输入样本都缺失了，分析师在对简化的样本集 $\\{0, 0.5, 1, 2, 20, 30, 40\\}$ 分钟应用梯形法则之前，对保留的 $t = 2$ 分钟和 $t = 20$ 分钟的锚点样本之间的 $C_{P}(t)$ 进行线性插值。使用这个简化的数据集重新计算 $\\int_{0}^{30} C_{P}(t)\\,dt$ 和 $\\int_{0}^{40} C_{P}(t)\\,dt$，并使用相同的两个晚期时间点重新估算 $K_{i}$。\n\n4) 最后，通过计算估算的净流入速率的相对偏差来量化采样间断的影响，该偏差定义为 $\\big(K_{i,\\mathrm{gap}} - K_{i,\\mathrm{full}}\\big) / K_{i,\\mathrm{full}}$。请将您的最终答案以小数形式表示（不带百分号），并四舍五入到四位有效数字。最终答案中不要包含单位。",
            "solution": "该问题具有科学依据、是适定且客观的。它描述了正电子发射断层扫描 (PET) 中的一种标准动力学分析方法（Patlak 图），并为获得一个完整、唯一的解提供了所有必要的数据和条件。因此，该问题是有效的，将提供解答。\n\n该问题要求推导不可逆二组织室模型的晚期线性化关系，并应用该关系估算净流入速率常数 $K_i$。\n\n首先，我们推导线性化关系。该系统由以下方程描述：\n$$ \\frac{d C_{f}}{dt} = k_{1} C_{P}(t) - (k_{2} + k_{3}) C_{f}(t) $$\n$$ \\frac{d C_{b}}{dt} = k_{3} C_{f}(t) $$\n总组织浓度为 $C_{T}(t) = C_{f}(t) + C_{b}(t)$。\n问题陈述，在足够晚的时间点，自由室与血浆处于准稳态。这意味着 $C_f(t)$ 的变化率与流入和流出速率相比可以忽略不计，即 $\\frac{dC_f}{dt} \\approx 0$。\n将此假设应用于第一个微分方程，得到：\n$$ 0 \\approx k_{1} C_{P}(t) - (k_{2} + k_{3}) C_{f}(t) $$\n求解 $C_f(t)$，得到准稳态浓度：\n$$ C_{f}(t) \\approx \\frac{k_{1}}{k_{2} + k_{3}} C_{P}(t) $$\n现在，我们考虑捕获室。通过将其速率方程从 $0$ 积分到 $t$ 来求得浓度 $C_b(t)$：\n$$ C_b(t) = C_b(0) + \\int_{0}^{t} \\frac{dC_b}{d\\tau} d\\tau = 0 + \\int_{0}^{t} k_{3} C_f(\\tau) d\\tau = k_3 \\int_{0}^{t} C_f(\\tau) d\\tau $$\n因此，总组织浓度为：\n$$ C_T(t) = C_f(t) + C_b(t) = C_f(t) + k_3 \\int_{0}^{t} C_f(\\tau) d\\tau $$\n将 $C_f(t)$ 的准稳态近似值代入 $C_T(t)$ 的表达式中：\n$$ C_T(t) \\approx \\left(\\frac{k_{1}}{k_{2} + k_{3}}\\right) C_{P}(t) + k_3 \\int_{0}^{t} \\left(\\frac{k_{1}}{k_{2} + k_{3}}\\right) C_P(\\tau) d\\tau $$\n项 $\\frac{k_1}{k_2+k_3}$ 可以从积分中提出：\n$$ C_T(t) \\approx \\left(\\frac{k_{1}}{k_{2} + k_{3}}\\right) C_{P}(t) + \\left(\\frac{k_{1} k_3}{k_{2} + k_{3}}\\right) \\int_{0}^{t} C_P(\\tau) d\\tau $$\n为了得到指定的线性关系，我们两边同时除以 $C_P(t)$：\n$$ \\frac{C_T(t)}{C_P(t)} \\approx \\left(\\frac{k_{1} k_3}{k_{2} + k_{3}}\\right) \\frac{\\int_{0}^{t} C_P(\\tau) d\\tau}{C_P(t)} + \\frac{k_{1}}{k_{2} + k_{3}} $$\n这是一个 $Y(t) = m X(t) + c$ 形式的线性方程，其中：\n- $Y(t) = \\frac{C_T(t)}{C_P(t)}$\n- $X(t) = \\frac{\\int_{0}^{t} C_P(\\tau) d\\tau}{C_P(t)}$\n- 斜率 $m$ 是净流入速率常数 $K_i = \\frac{k_{1} k_3}{k_{2} + k_{3}}$。\n- 截距 $c$ 是可逆室分布容积 $V_e = \\frac{k_{1}}{k_{2} + k_{3}}$。\n\n推导出线性化关系后，我们继续进行数值计算任务。\n\n**任务1：使用完整数据计算积分**\n我们使用梯形法则，$\\int_{t_i}^{t_{i+1}} f(t) dt \\approx \\frac{t_{i+1}-t_i}{2} (f(t_i)+f(t_{i+1}))$。\n给定的 C_P(t) 数据点为：\n$(t, C_{P}(t)) = \\{(0, 0.0), (0.5, 6.0), (1, 5.0), (2, 3.0), (5, 1.5), (10, 1.0), (20, 0.6), (30, 0.45), (40, 0.35)\\}$.\n\n$\\int_{0}^{30} C_{P}(t)\\,dt = \\frac{0.5-0}{2}(0.0+6.0) + \\frac{1-0.5}{2}(6.0+5.0) + \\frac{2-1}{2}(5.0+3.0) + \\frac{5-2}{2}(3.0+1.5) + \\frac{10-5}{2}(1.5+1.0) + \\frac{20-10}{2}(1.0+0.6) + \\frac{30-20}{2}(0.6+0.45)$\n$= 0.25(6.0) + 0.25(11.0) + 0.5(8.0) + 1.5(4.5) + 2.5(2.5) + 5.0(1.6) + 5.0(1.05)$\n$= 1.5 + 2.75 + 4.0 + 6.75 + 6.25 + 8.0 + 5.25 = 34.5$\n\n$\\int_{0}^{40} C_{P}(t)\\,dt = \\int_{0}^{30} C_{P}(t)\\,dt + \\int_{30}^{40} C_{P}(t)\\,dt$\n$= 34.5 + \\frac{40-30}{2}(0.45+0.35) = 34.5 + 5(0.8) = 34.5 + 4.0 = 38.5$\n\n积分为 $\\int_{0}^{30} C_{P}(t)\\,dt = 34.5 \\ \\mathrm{kBq}\\cdot\\mathrm{min}/\\mathrm{mL}$ 和 $\\int_{0}^{40} C_{P}(t)\\,dt = 38.5 \\ \\mathrm{kBq}\\cdot\\mathrm{min}/\\mathrm{mL}$。\n\n**任务2：使用完整数据估算 $K_i$ ($K_{i,\\mathrm{full}}$)**\n我们计算 $t=30$ 和 $t=40$ 时的作图变量 $X(t)$ 和 $Y(t)$。\n在 $t=30 \\ \\mathrm{min}$ 时：\n$C_T(30)=0.3675$, $C_P(30)=0.45$, $\\int_0^{30}C_P(\\tau)d\\tau = 34.5$。\n$Y(30) = \\frac{0.3675}{0.45} = \\frac{49}{60} \\approx 0.8167$\n$X(30) = \\frac{34.5}{0.45} = \\frac{230}{3} \\approx 76.67$\n\n在 $t=40 \\ \\mathrm{min}$ 时：\n$C_T(40)=0.4025$, $C_P(40)=0.35$, $\\int_0^{40}C_P(\\tau)d\\tau = 38.5$。\n$Y(40) = \\frac{0.4025}{0.35} = 1.15 = \\frac{23}{20}$\n$X(40) = \\frac{38.5}{0.35} = 110$\n\n斜率 $K_{i,\\mathrm{full}}$ 估算如下：\n$K_{i,\\mathrm{full}} = \\frac{Y(40)-Y(30)}{X(40)-X(30)} = \\frac{1.15 - 49/60}{110 - 230/3} = \\frac{23/20 - 49/60}{330/3 - 230/3} = \\frac{(69-49)/60}{100/3} = \\frac{20/60}{100/3} = \\frac{1/3}{100/3} = \\frac{1}{100} = 0.01$\n\n**任务3：使用带采样间断的数据重新估算 $K_i$ ($K_{i,\\mathrm{gap}}$)**\n移除 $t=2$ 和 $t=20$ 之间的样本。现在使用端点 $(2, 3.0)$ 和 $(20, 0.6)$ 之间的一个梯形来计算此区间的积分。\n$[0, 2]$ 上的积分保持不变：$\\int_0^2 C_P dt = 1.5 + 2.75 + 4.0 = 8.25$。\n$[2, 20]$ 上的修正积分为：$\\int_2^{20} C_{P,\\text{interp}} dt = \\frac{20-2}{2}(C_P(2)+C_P(20)) = 9(3.0+0.6) = 9(3.6) = 32.4$。\n$[20, 40]$ 上的积分保持不变。\n\n新的总积分：\n$\\int_0^{30} C_{P,\\text{gap}}(t) dt = \\int_0^2 C_P dt + \\int_2^{20} C_{P,\\text{interp}} dt + \\int_{20}^{30} C_P dt = 8.25 + 32.4 + 5.25 = 45.9$。\n$\\int_0^{40} C_{P,\\text{gap}}(t) dt = \\int_0^{30} C_{P,\\text{gap}} dt + \\int_{30}^{40} C_P dt = 45.9 + 4.0 = 49.9$。\n\n现在我们重新计算 $X$ 变量。$Y$ 变量保持不变。\n在 $t=30 \\ \\mathrm{min}$ 时：\n$X_{\\text{gap}}(30) = \\frac{45.9}{0.45} = 102$\n\n在 $t=40 \\ \\mathrm{min}$ 时：\n$X_{\\text{gap}}(40) = \\frac{49.9}{0.35} = \\frac{499}{3.5} = \\frac{998}{7} \\approx 142.57$\n\n新的斜率估计值 $K_{i,\\mathrm{gap}}$ 为：\n$K_{i,\\mathrm{gap}} = \\frac{Y(40)-Y(30)}{X_{\\text{gap}}(40)-X_{\\text{gap}}(30)} = \\frac{1/3}{998/7 - 102} = \\frac{1/3}{(998 - 714)/7} = \\frac{1/3}{284/7} = \\frac{7}{3 \\times 284} = \\frac{7}{852}$\n\n**任务4：计算相对偏差**\n相对偏差定义为 $\\frac{K_{i,\\mathrm{gap}} - K_{i,\\mathrm{full}}}{K_{i,\\mathrm{full}}}$。\n相对偏差 = $\\frac{7/852 - 0.01}{0.01} = \\frac{7/852}{1/100} - 1 = \\frac{700}{852} - 1 = \\frac{700-852}{852} = \\frac{-152}{852}$\n将分子和分母除以它们的最大公约数 $4$ 来化简分数：\n相对偏差 = $\\frac{-38}{213}$\n换算成小数，约等于 $-0.17840375...$。四舍五入到四位有效数字，相对偏差为 $-0.1784$。\n\n对间断区域的线性插值显著高估了凸形的 $C_P(t)$ 曲线下的真实面积。这导致 Patlak 图中 X 轴变量的值变大，从而“拉平”了估算的斜率，并导致 $K_i$ 估算出现负偏差。\n$[2, 20]$ 上的真实积分为 $6.75+6.25+8.0 = 21.0$。插值得出的积分为 $32.4$，这是一个显著的高估。",
            "answer": "$$\\boxed{-0.1784}$$"
        },
        {
            "introduction": "在真实的临床成像中，测量信号常常会受到扫描仪物理限制的干扰，其中一个主要例子就是部分容积效应 (PVE)，这对小结构（如肿瘤）的成像尤其严重。这项高级练习将挑战您建立一个仿真模型，以直观地了解 PVE 如何系统性地使估算的动力学参数产生偏差。通过使用已知的恢复系数实施校正，您将学会一种实用的方法来减轻这种在定量 PET 分析中常见的误差来源。",
            "id": "4880162",
            "problem": "要求您编写一个完整的、可运行的程序，该程序模拟小肿瘤中具有部分容积效应的动态正电子发射断层扫描 (PET) 时间-活度数据，执行 Patlak 图形分析以估计净流入速率常数，然后应用已知的恢复系数对估计值进行校正。该程序必须遵循基于不可逆示踪剂（例如，氟代脱氧葡萄糖）的房室质量平衡的原理性方法，而不是使用问题中提供的简化公式。\n\n基本原理如下。在一个不可逆双组织房室模型中，令 $C_p(t)$ 为血浆输入函数，$C_t(t)$ 为组织中的示踪剂浓度，$K_i$ 为净流入速率常数（单位为 $\\text{min}^{-1}$），$V$ 为表观分布容积（无量纲，$\\text{mL}/\\text{mL}$）。在不可逆捕获占主导地位的条件下，组织活度浓度可以用 $C_p(t)$ 及其时间积分来表示，并且 Patlak 变换产生一个线性关系，其斜率等于净流入速率常数。在对小肿瘤进行的真实 PET 测量中，测得的组织浓度会因部分容积效应而降低，该效应通常由恢复系数 $RC$（满足 $0 < RC \\le 1$）来参数化，并且存在测量噪声。\n\n您的程序必须：\n\n- 在时间间隔 $t \\in [0,60]$ 分钟内，以时间步长 $\\Delta t = 0.5$ 分钟的规则时间网格上，使用符合物理规律的三指数形式模拟血浆输入函数 $C_p(t)$：\n  $$C_p(t) = A_1 e^{-\\lambda_1 t} + A_2 e^{-\\lambda_2 t} + A_3 e^{-\\lambda_3 t},$$\n  其中 $(A_1,A_2,A_3) = (12,3,1)$，单位为 $\\text{kBq}/\\text{mL}$，以及 $(\\lambda_1,\\lambda_2,\\lambda_3) = (0.5,0.05,0.005)$，单位为 $\\text{min}^{-1}$。\n- 使用不可逆累积关系生成无噪声的组织浓度：\n  $$C_t^{\\text{true}}(t) = K_i \\int_0^t C_p(\\tau)\\, d\\tau + V\\, C_p(t),$$\n  其中 $K_i$ 的单位为 $\\text{min}^{-1}$，$V$ 为无量纲。\n- 应用部分容积效应以获得测量浓度：\n  $$C_t^{\\text{meas}}(t) = RC \\cdot C_t^{\\text{true}}(t),$$\n  然后添加均值为零的高斯噪声，其标准差为：\n  $$\\sigma(t) = \\sigma_{\\text{rel}} \\cdot C_t^{\\text{meas}}(t) + \\sigma_{\\text{abs}},$$\n  其中 $\\sigma_{\\text{rel}}$ 是一个无量纲的相对噪声水平，$\\sigma_{\\text{abs}}$ 是一个绝对噪声水平，单位为 $\\text{kBq}/\\text{mL}$。\n- 针对从指定时间 $t_{\\text{lin}}$ 开始的线性阶段，构建 Patlak 变量：\n  $$x(t) = \\frac{\\int_0^t C_p(\\tau)\\, d\\tau}{C_p(t)}, \\quad y(t) = \\frac{C_t^{\\text{obs}}(t)}{C_p(t)},$$\n  其中 $C_t^{\\text{obs}}(t)$ 是含噪声的测量浓度。使用普通最小二乘法对 $t \\ge t_{\\text{lin}}$ 的数据拟合 $y(t) = s \\cdot x(t) + b$，并将斜率估计值 $s$（单位为 $\\text{min}^{-1}$）作为朴素 Patlak 斜率。\n- 计算净流入速率常数的恢复校正估计值：\n  $$\\widehat{K}_i^{\\text{corr}} = \\frac{s}{RC}.$$\n\n物理单位：所有斜率和校正后净流入速率常数的输出值都必须以 $\\text{min}^{-1}$ 为单位，并四舍五入到小数点后四位。不涉及角度。不要使用百分比；任何比例都必须以小数形式表示。\n\n测试套件和参数：您的程序必须评估以下四个测试用例，每个用例由 $(K_i, V, RC, \\sigma_{\\text{rel}}, t_{\\text{lin}}, \\text{seed})$ 指定，其中 $K_i$ 单位为 $\\text{min}^{-1}$，$V$ 无量纲，$RC$ 无量纲，$\\sigma_{\\text{rel}}$ 无量纲，$t_{\\text{lin}}$ 单位为分钟，$\\text{seed}$ 用于生成可复现的随机噪声。\n\n- 案例 1：$(0.010, 0.5, 1.0, 0.02, 20, 42)$，无部分容积损失的基线情况。\n- 案例 2：$(0.015, 0.4, 0.6, 0.03, 20, 43)$，代表小病灶的中等恢复系数。\n- 案例 3：$(0.005, 0.8, 0.35, 0.05, 20, 44)$，低恢复系数和较高的相对噪声。\n- 案例 4：$(0.001, 1.0, 0.2, 0.03, 20, 45)$，具有极低 $K_i$ 和严重部分容积损失的边界类情况。\n\n在所有案例中，使用 $\\sigma_{\\text{abs}} = 0.05$ $\\text{kBq}/\\text{mL}$。通过必要时在零处截断，确保模拟的浓度在添加噪声后保持物理上的非负性。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个嵌套列表，按顺序包含四个案例的配对。每个配对为 $[s,\\widehat{K}_i^{\\text{corr}}]$，两个条目均四舍五入到小数点后四位，并以 $\\text{min}^{-1}$ 为单位。例如，输出格式必须为\n$$[ [s_1,\\widehat{K}_{i,1}^{\\text{corr}}], [s_2,\\widehat{K}_{i,2}^{\\text{corr}}], [s_3,\\widehat{K}_{i,3}^{\\text{corr}}], [s_4,\\widehat{K}_{i,4}^{\\text{corr}}] ].$$",
            "solution": "用户提供的问题已经过严格验证，被认为是有效的。它在科学上基于正电子发射断层扫描 (PET) 的示踪剂动力学建模原理，问题设定良好，具有完整且一致的参数和指令，并且表述客观。该问题要求实现一个在定量医学影像领域中属于标准流程的模拟和分析管道。\n\n解决方案首先根据所提供的模型模拟动态 PET 数据，然后使用 Patlak 图形方法分析模拟数据。该过程分解为以下步骤，并对四个测试用例中的每一个执行这些步骤。\n\n**1. 生成时间网格和血浆输入函数**\n\n模拟在 $t \\in [0, 60]$ 分钟的时间区间内进行。我们定义一个离散时间网格 $t_j = j \\cdot \\Delta t$，其中 $j = 0, 1, \\dots, N$，时间步长为 $\\Delta t = 0.5$ 分钟，$N = 60 / 0.5 = 120$。\n\n动脉血浆输入函数 $C_p(t)$ 描述了示踪剂在血浆中随时间变化的浓度，由三指数函数建模：\n$$C_p(t) = A_1 e^{-\\lambda_1 t} + A_2 e^{-\\lambda_2 t} + A_3 e^{-\\lambda_3 t}$$\n参数给定为 $(A_1, A_2, A_3) = (12, 3, 1)$，单位为 $\\text{kBq}/\\text{mL}$，以及 $(\\lambda_1, \\lambda_2, \\lambda_3) = (0.5, 0.05, 0.005)$，单位为 $\\text{min}^{-1}$。该函数在我们离散时间网格的每个点 $t_j$ 上进行求值。\n\n**2. 模拟真实的组织示踪剂浓度**\n\n该问题基于一个不可逆双组织房室模型。组织中示踪剂的总浓度 $C_t(t)$ 是可逆房室（游离和非特异性结合）和不可逆房室（代谢捕获）中示踪剂之和。该模型解的简化积分形式如下：\n$$C_t^{\\text{true}}(t) = K_i \\int_0^t C_p(\\tau)\\, d\\tau + V\\, C_p(t)$$\n此处，$K_i$ 是净流入速率常数（单位为 $\\text{min}^{-1}$），代表不可逆捕获的速率；$V$ 是可逆房室的表观分布容积（无量纲）。\n\n积分项 $\\int_0^t C_p(\\tau)\\, d\\tau$ 在每个时间点 $t_j$ 进行数值计算。由于 $C_p(t)$ 是一个离散时间序列，累积梯形法是进行此数值积分的适当且标准的方法。令 $I(t_j) = \\int_0^{t_j} C_p(\\tau)\\, d\\tau$。该积分计算如下：\n$$I(t_j) = \\sum_{k=1}^{j} \\frac{C_p(t_k) + C_p(t_{k-1})}{2} \\Delta t$$\n初始条件为 $I(t_0) = 0$。\n\n使用计算出的 $C_p(t_j)$ 和 $I(t_j)$ 的值，以及特定案例的 $K_i$ 和 $V$ 参数，计算出每个时间点的“真实”无噪声组织浓度 $C_t^{\\text{true}}(t_j)$。\n\n**3. 应用部分容积效应和噪声模型**\n\n真实的 PET 测量，尤其是对肿瘤等小结构的测量，会受到扫描仪有限空间分辨率的影响。这会导致部分容积效应 (PVE)，即测量的活度浓度是目标物体内的真实浓度与周围组织浓度的混合，从而有效地低估了真实值。这通过恢复系数 $RC \\in (0, 1]$ 进行建模，其中较小的 $RC$ 对应于较大的信号损失。无噪声的测量浓度为：\n$$C_t^{\\text{meas}}(t) = RC \\cdot C_t^{\\text{true}}(t)$$\n\n为模拟真实的测量条件，向 $C_t^{\\text{meas}}(t)$ 添加均值为零的高斯噪声。噪声的标准差 $\\sigma(t)$ 是随时间变化的，并遵循一个包含相对和绝对分量的混合模型：\n$$\\sigma(t) = \\sigma_{\\text{rel}} \\cdot C_t^{\\text{meas}}(t) + \\sigma_{\\text{abs}}$$\n其中 $\\sigma_{\\text{rel}}$ 是一个无量纲的相对噪声水平，$\\sigma_{\\text{abs}} = 0.05$ $\\text{kBq}/\\text{mL}$ 是一个恒定的绝对噪声水平。对于每个时间点，使用带种子的伪随机数生成器从正态分布 $\\mathcal{N}(0, \\sigma(t_j)^2)$ 中抽取一个噪声值 $\\epsilon(t_j)$，以确保可复现性。最终观测到的组织浓度为：\n$$C_t^{\\text{obs}}(t_j) = C_t^{\\text{meas}}(t_j) + \\epsilon(t_j)$$\n由于示踪剂浓度必须为非负值，任何小于 0 的 $C_t^{\\text{obs}}(t_j)$ 结果值都将被截断为 0。\n\n**4. Patlak 图形分析与参数估计**\n\nPatlak 图是一种图形分析技术，它将动力学模型方程在时间 $t$ 足够大以至于可逆房室达到平衡时进行线性化。该变换由以下变量定义：\n$$x(t) = \\frac{\\int_0^t C_p(\\tau)\\, d\\tau}{C_p(t)} \\quad \\text{and} \\quad y(t) = \\frac{C_t^{\\text{obs}}(t)}{C_p(t)}$$\n对于所建模型系统，代入 $C_t^{\\text{obs}}(t)$ 的表达式，我们得到：\n$$y(t) \\approx \\frac{RC \\cdot \\left(K_i \\int_0^t C_p(\\tau)\\, d\\tau + V\\, C_p(t)\\right)}{C_p(t)} = (RC \\cdot K_i) \\cdot x(t) + (RC \\cdot V)$$\n这预测了 $y(t)$ 和 $x(t)$ 之间存在线性关系。Patlak 分析包括对 $t_j \\ge t_{\\text{lin}}$ 的数据点 $(x(t_j), y(t_j))$ 执行普通最小二乘 (OLS) 线性回归，其中 $t_{\\text{lin}}$ 是假定线性阶段开始的时间。对于所有测试用例，$t_{\\text{lin}} = 20$ 分钟。\n\nOLS 拟合提供斜率 $s$ 的估计值，根据模型，该值是乘积 $RC \\cdot K_i$ 的估计。\n$$s \\approx RC \\cdot K_i$$\n\n**5. 恢复系数校正**\n\n从受 PVE 影响的数据的 Patlak 图中朴素估计出的斜率 $s$ 会以因子 $RC$ 低估真实的 $K_i$。为了获得净流入速率的校正估计值 $\\widehat{K}_i^{\\text{corr}}$，将斜率 $s$ 除以已知的恢复系数 $RC$：\n$$\\widehat{K}_i^{\\text{corr}} = \\frac{s}{RC}$$\n对四个测试用例中的每一个都执行此过程，并收集得到的配对 $[s, \\widehat{K}_i^{\\text{corr}}]$。最终值按要求四舍五入到小数点后四位。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Simulates dynamic PET data with partial volume effects, performs Patlak analysis,\n    and applies a recovery coefficient correction for multiple test cases.\n    \"\"\"\n    \n    # Define simulation time parameters\n    t_max = 60.0  # minutes\n    dt = 0.5      # minutes\n    time_points = np.arange(0, t_max + dt, dt)\n\n    # Define plasma input function C_p(t) parameters\n    A = np.array([12.0, 3.0, 1.0])      # kBq/mL\n    lambdas = np.array([0.5, 0.05, 0.005]) # min^-1\n    \n    # Calculate C_p(t) and its cumulative integral\n    Cp_t = A[0] * np.exp(-lambdas[0] * time_points) + \\\n           A[1] * np.exp(-lambdas[1] * time_points) + \\\n           A[2] * np.exp(-lambdas[2] * time_points)\n\n    # Use scipy's cumulative_trapezoid for numerical integration\n    Int_Cp_t = cumulative_trapezoid(Cp_t, time_points, initial=0)\n\n    # Define test cases\n    # (Ki, V, RC, sigma_rel, t_lin, seed)\n    test_cases = [\n        (0.010, 0.5, 1.0, 0.02, 20, 42),\n        (0.015, 0.4, 0.6, 0.03, 20, 43),\n        (0.005, 0.8, 0.35, 0.05, 20, 44),\n        (0.001, 1.0, 0.2, 0.03, 20, 45)\n    ]\n    \n    sigma_abs = 0.05 # kBq/mL\n\n    results = []\n    \n    for case in test_cases:\n        Ki, V, RC, sigma_rel, t_lin, seed = case\n        \n        # 1. Generate true tissue concentration\n        Ct_true = Ki * Int_Cp_t + V * Cp_t\n        \n        # 2. Apply partial volume effect\n        Ct_meas = RC * Ct_true\n        \n        # 3. Add noise\n        rng = np.random.default_rng(seed)\n        sigma_t = sigma_rel * Ct_meas + sigma_abs\n        noise = rng.normal(0, sigma_t)\n        Ct_obs = Ct_meas + noise\n        \n        # 4. Enforce non-negativity\n        Ct_obs = np.maximum(0, Ct_obs)\n        \n        # 5. Perform Patlak analysis\n        # Select data points for the linear phase\n        linear_phase_indices = np.where(time_points >= t_lin)\n        \n        # Avoid division by zero, although unlikely for t>=20\n        # for the given Cp(t)\n        Cp_lin = Cp_t[linear_phase_indices]\n        valid_indices = np.where(Cp_lin > 1e-9)\n\n        # Form Patlak variables\n        x = Int_Cp_t[linear_phase_indices][valid_indices] / Cp_lin[valid_indices]\n        y = Ct_obs[linear_phase_indices][valid_indices] / Cp_lin[valid_indices]\n\n        # Perform ordinary least squares fit to get the slope 's'\n        # np.polyfit returns [slope, intercept] for degree 1\n        s, _ = np.polyfit(x, y, 1)\n\n        # 6. Compute recovery-corrected Ki\n        Ki_corr = s / RC if RC > 0 else 0\n        \n        results.append([s, Ki_corr])\n\n    # Format the final output string exactly as specified\n    formatted_results = [f\"[{round(s, 4):.4f},{round(k, 4):.4f}]\" for s, k in results]\n    final_output = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}