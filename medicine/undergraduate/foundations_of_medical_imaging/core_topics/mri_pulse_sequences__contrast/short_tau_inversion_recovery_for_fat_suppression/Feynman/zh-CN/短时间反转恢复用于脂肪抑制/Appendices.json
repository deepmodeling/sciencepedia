{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导您从第一性原理出发，推导理想的反转时间（$TI$），为理解STIR技术奠定基础。通过求解完美$180^\\circ$脉冲后纵向弛豫的布洛赫方程，您将揭示$TI$与组织$T_1$弛豫时间之间的基本关系。这项练习对于掌握STIR如何抑制脂肪信号的核心机制至关重要。",
            "id": "4922663",
            "problem": "在磁共振成像中，短T1反转恢复（STIR）序列通过在脂肪的纵向磁化强度过零的瞬间进行读出，来抑制脂肪信号。考虑一个翻转角为 $180^{\\circ}$ 的理想绝热反转脉冲，之后在激励和读出之前有一个延迟时间 $TI$。假设重复时间很长，以至于 $TR \\gg T_{1,\\text{fat}}$，并忽略在 $TI$ 期间的横向弛豫和读出效应。使用布洛赫方程的纵向分量，写作一阶线性微分方程 $dM_{z}(t)/dt = \\left(M_{0} - M_{z}(t)\\right)/T_{1}$，并结合反转脉冲刚结束后的初始条件 $M_{z}(0^{+}) = -M_{0}$，来推导使脂肪磁化强度归零的 $TI$ 条件。\n\n计算在 $3$ T 场强下，纵向弛豫时间为 $T_{1,\\text{fat}} = 370$ ms 的脂肪的理想反转时间 $TI_{\\text{ideal}}$。你的最终数值答案以 ms 为单位，并四舍五入到三位有效数字。\n\n此外，基于同一纵向恢复模型的物理和经验考虑，简要解释为什么在实践中，即使在相同的场强和温度下，放射科医生通常使用比计算出的理想值稍短的 $TI$ 值。你的解释不会被数字评分，但它应与基础物理原理保持一致。",
            "solution": "该问题要求推导短T1反转恢复（STIR）序列的理想反转时间（$TI$），计算其对脂肪组织的数值，并解释一种常见的临床实践。对问题陈述的验证证实了其科学性、适定性和客观性。所提供的物理模型和参数与磁共振成像的原理一致。\n\n纵向磁化强度 $M_z(t)$ 在受到扰动偏离其热平衡值 $M_0$ 后的时间演化，由布洛赫方程的纵向分量描述。问题将其提供为一个一阶线性常微分方程：\n$$\n\\frac{dM_{z}(t)}{dt} = \\frac{M_{0} - M_{z}(t)}{T_{1}}\n$$\n在此，$T_1$ 是目标组织的纵向（或自旋-晶格）弛豫时间常数。该方程描述了 $M_z$ 向其平衡值 $M_0$ 恢复的过程。\n\nSTIR序列以一个 $180^{\\circ}$ 的反转脉冲开始。假设在脉冲前磁化强度处于平衡状态（$M_z = M_0$），一个完美的 $180^{\\circ}$ 脉冲会翻转磁化矢量，使得在脉冲刚结束时，即时间 $t=0^{+}$，纵向分量被完全反转。这给出了初始条件：\n$$\nM_{z}(0^{+}) = -M_{0}\n$$\n我们必须在满足此初始条件的约束下求解该微分方程。该方程可以通过分离变量法重新整理以进行积分：\n$$\n\\frac{dM_{z}}{M_{0} - M_{z}} = \\frac{dt}{T_{1}}\n$$\n对两边进行积分得到：\n$$\n\\int \\frac{dM_{z}}{M_{0} - M_{z}} = \\int \\frac{dt}{T_{1}} \\\\\n-\\ln|M_{0} - M_{z}(t)| = \\frac{t}{T_{1}} + C'\n$$\n其中 $C'$ 是积分常数。对两边取指数得到：\n$$\n|M_{0} - M_{z}(t)| = \\exp\\left(-\\frac{t}{T_{1}} - C'\\right) = C \\exp\\left(-\\frac{t}{T_{1}}\\right)\n$$\n其中 $C = e^{-C'}$。由于 $M_z(t)$ 从 $-M_0$ 开始并向 $+M_0$ 恢复，对于 $t \\ge 0$，量 $M_0 - M_z(t)$ 总是非负的，因此可以去掉绝对值符号。\n$$\nM_{0} - M_{z}(t) = C \\exp\\left(-\\frac{t}{T_{1}}\\right)\n$$\n$M_z(t)$ 的解为：\n$$\nM_{z}(t) = M_{0} - C \\exp\\left(-\\frac{t}{T_{1}}\\right)\n$$\n为了求出常数 $C$，我们应用初始条件 $M_{z}(0) = -M_{0}$：\n$$\n-M_{0} = M_{0} - C \\exp(0) = M_{0} - C\n$$\n求解 $C$，我们得到 $C = M_{0} - (-M_{0}) = 2M_{0}$。将此代回通解，得到完美反转后纵向磁化强度恢复的具体方程：\n$$\nM_{z}(t) = M_{0}\\left(1 - 2\\exp\\left(-\\frac{t}{T_{1}}\\right)\\right)\n$$\nSTIR的目标是通过在特定组织（本例中为脂肪）的纵向磁化强度为零的精确时刻施加后续的激励脉冲，来抑制该组织的信号。这个时间就是反转时间 $TI$。我们通过设置 $M_{z}(TI) = 0$ 来找到这个时间：\n$$\n0 = M_{0}\\left(1 - 2\\exp\\left(-\\frac{TI}{T_{1,\\text{fat}}}\\right)\\right)\n$$\n由于平衡磁化强度 $M_0$ 非零，括号中的项必须为零：\n$$\n1 - 2\\exp\\left(-\\frac{TI}{T_{1,\\text{fat}}}\\right) = 0 \\\\\n2\\exp\\left(-\\frac{TI}{T_{1,\\text{fat}}}\\right) = 1 \\\\\n\\exp\\left(-\\frac{TI}{T_{1,\\text{fat}}}\\right) = \\frac{1}{2}\n$$\n为了求解 $TI$，我们对两边取自然对数：\n$$\n-\\frac{TI}{T_{1,\\text{fat}}} = \\ln\\left(\\frac{1}{2}\\right) = -\\ln(2)\n$$\n这给出了理想反转时间 $TI_{\\text{ideal}}$ 的表达式：\n$$\nTI_{\\text{ideal}} = T_{1,\\text{fat}} \\ln(2)\n$$\n问题指明，在 $3$ T 的场强下，脂肪的纵向弛豫时间为 $T_{1,\\text{fat}} = 370$ ms。我们现在可以计算 $TI_{\\text{ideal}}$ 的数值：\n$$\nTI_{\\text{ideal}} = 370 \\, \\text{ms} \\times \\ln(2) \\approx 370 \\times 0.693147 \\approx 256.46459 \\, \\text{ms}\n$$\n按照要求，将此结果四舍五入到三位有效数字，我们得到：\n$$\nTI_{\\text{ideal}} = 256 \\, \\text{ms}\n$$\n\n问题的第二部分要求解释为什么在实践中，放射科医生通常使用比这个计算出的理想值稍短的 $TI$。该解释必须基于相同的物理模型。理想计算假设了一个完美的 $180^{\\circ}$ 反转脉冲。在现实中，射频（$B_1$）场的不完美性会导致翻转角的空间变化，这意味着对于大部分组织体积，翻转角 $\\alpha$ 可能小于 $180^{\\circ}$。\n\n让我们使用相同的纵向恢复模型来分析不完美翻转角 $\\alpha  180^{\\circ}$ 的影响。脉冲后的初始条件变为 $M_{z}(0^{+}) = M_{0} \\cos(\\alpha)$。通解 $M_{z}(t) = M_{0} - C \\exp(-t/T_{1})$ 中的积分常数 $C$ 现在是：\n$$\nM_{0} \\cos(\\alpha) = M_{0} - C \\implies C = M_{0}(1 - \\cos(\\alpha))\n$$\n恢复方程变为：\n$$\nM_{z}(t) = M_{0}\\left(1 - (1 - \\cos(\\alpha))\\exp\\left(-\\frac{t}{T_{1}}\\right)\\right)\n$$\n设置 $M_{z}(TI) = 0$ 来找到新的归零时间：\n$$\n1 - (1 - \\cos(\\alpha))\\exp\\left(-\\frac{TI}{T_{1}}\\right) = 0 \\\\\n\\exp\\left(-\\frac{TI}{T_{1}}\\right) = \\frac{1}{1 - \\cos(\\alpha)} \\\\\nTI = T_{1} \\ln(1 - \\cos(\\alpha))\n$$\n对于一个完美的脉冲，$\\alpha = 180^{\\circ}$，因此 $\\cos(\\alpha) = -1$，且 $TI = T_{1}\\ln(1 - (-1)) = T_{1}\\ln(2)$，这是我们的理想情况。对于一个不完美的脉冲，其中 $\\alpha  180^{\\circ}$（但对于反转来说 $\\alpha > 90^{\\circ}$），我们有 $-1  \\cos(\\alpha)  0$。这意味着 $1  1 - \\cos(\\alpha)  2$。由于 $\\ln(x)$ 是对于 $x>0$ 的单调递增函数，因此可以得出 $\\ln(1 - \\cos(\\alpha))  \\ln(2)$。因此，非理想脉冲所需的反转时间比理想反转时间短：$TI  TI_{\\text{ideal}}$。由于实际的STIR序列必须对 $B_1$ 不均匀性具有鲁棒性，选择一个稍短的 $TI$ 可以在翻转角通常小于规定的 $180^{\\circ}$ 的成像体积内提供更好的平均归零效果。\n\n此外，生物脂肪不是具有单一 $T_1$ 值的单一物质，而是具有 $T_1$ 值分布的甘油三酯混合物。选择一个比平均 $T_1$ 的理想值稍短的 $TI$ 可以对来自整个脂肪成分分布的信号产生更鲁棒的整体抑制效果。",
            "answer": "$$\\boxed{256}$$"
        },
        {
            "introduction": "在理想$TI$计算的基础上，本练习探讨了时间精度的实际问题。您将运用微积分来确定残余脂肪信号对反转时间微小误差的敏感度。这项分析揭示了信号零点的“尖锐”程度，并让您从定量的角度理解为什么精确的计时对于有效的脂肪抑制至关重要。",
            "id": "4922673",
            "problem": "磁共振成像 (MRI) 中的短时间反转恢复 (STIR) 使用一个反转脉冲，其后跟随一个反转时间 $TI$，该时间的选择旨在使脂肪信号归零。考虑一次针对脂肪的单次反转恢复准备，其中纵向磁化强度 $M_z(t)$ 服从纵向 Bloch 方程 $dM_z/dt = (M_0 - M_z)/T_1$，其中 $M_0$ 是热平衡磁化强度，$T_1$ 是脂肪的纵向弛豫时间。假设在 $t=0$ 时有一个完美的 $180^\\circ$ 反转，因此 $M_z(0^+) = -M_0$，并且重复时间 $TR$ 满足 $TR \\gg T_1$，从而在两次准备之间发生完全恢复，并且在时间 $TI$ 之前读出扰动可以忽略不计。\n\n从该微分方程及其初始条件出发，推导脂肪的 $M_z(TI)$ 的形式，确定满足 $M_z(TI_0)=0$ 的零点反转时间 $TI_0$，然后通过在 $TI=TI_0$ 处计算导数 $\\partial (M_z/M_0)/\\partial TI$ 来计算残余脂肪信号对微小 $TI$ 误差的灵敏度。最后，使用 $T_{1,\\mathrm{fat}} = 280\\,\\mathrm{ms}$，计算此灵敏度的数值，单位为 $\\mathrm{s}^{-1}$。将您的答案四舍五入到 $4$ 位有效数字，并以 $\\mathrm{s}^{-1}$ 为单位表示。用一两句话解释该值对于零点附近的脂肪抑制所需的时间精度意味着什么。",
            "solution": "在尝试解答之前，将对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- 纵向磁化强度 $M_z(t)$ 服从微分方程：$\\frac{dM_z}{dt} = \\frac{M_0 - M_z}{T_1}$。\n- $M_0$ 是热平衡磁化强度。\n- $T_1$ 是脂肪的纵向弛豫时间。\n- 在 $t=0$ 时，经过一个完美的 $180^\\circ$ 反转脉冲后的初始条件是 $M_z(0^+) = -M_0$。\n- 重复时间 $TR$ 满足 $TR \\gg T_1$。\n- 给定的脂肪特定纵向弛豫时间为 $T_{1,\\mathrm{fat}} = 280\\,\\mathrm{ms}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：**该问题描述了在 MRI 中，反转脉冲后由 Bloch 方程控制的磁化强度纵向弛豫过程。这是 MRI 物理学中一个基础且成熟的概念。该方程和初始条件是反转恢复序列的标准形式。$T_{1,\\mathrm{fat}}$ 的值是在常见场强下一个典型且物理上现实的数值。\n- **适定性：**该问题提供了一个具有明确初始条件的一阶线性常微分方程。所要求的任务（求解常微分方程、寻找特定时间、计算导数和评估数值）在数学上都是明确定义的，并能导出一个唯一解。\n- **客观性：**该问题使用来自物理学和数学的精确、标准术语进行陈述。它不含主观、模糊或基于观点性的语言。\n\n### 步骤 3：结论与行动\n问题有效。它在科学上是合理的、适定的和客观的。将提供解答。\n\n反转脉冲后纵向磁化强度 $M_z$ 的演变由纵向弛豫的 Bloch 方程描述：\n$$\n\\frac{dM_z}{dt} = \\frac{M_0 - M_z}{T_1}\n$$\n这是一个一阶线性常微分方程。我们可以将其重排为标准形式：\n$$\n\\frac{dM_z}{dt} + \\frac{1}{T_1} M_z = \\frac{M_0}{T_1}\n$$\n该方程的通解是齐次解与一个特解之和。齐次方程为 $\\frac{dM_{z,h}}{dt} + \\frac{1}{T_1} M_{z,h} = 0$，其解为 $M_{z,h}(t) = C \\exp(-t/T_1)$，其中 $C$ 是积分常数。一个特解是常数值 $M_{z,p} = M_0$。\n因此，通解为：\n$$\nM_z(t) = M_0 + C \\exp\\left(-\\frac{t}{T_1}\\right)\n$$\n为了求出常数 $C$，我们应用初始条件。问题陈述，在 $t=0$ 时，施加一个完美的 $180^\\circ$ 反转脉冲，将磁化强度从其平衡值 $M_0$（因为 $TR \\gg T_1$ 确保了脉冲前完全恢复）翻转到 $-M_0$。因此，初始条件为 $M_z(0^+) = -M_0$。\n将此代入 $t=0$ 时的通解中：\n$$\nM_z(0) = M_0 + C \\exp(0) = M_0 + C\n$$\n$$\n-M_0 = M_0 + C \\implies C = -2M_0\n$$\n将 $C$ 的值代回通解中，得到磁化恢复的特解：\n$$\nM_z(t) = M_0 - 2M_0 \\exp\\left(-\\frac{t}{T_1}\\right)\n$$\n可以将其因式分解，得到反转脉冲后任意时刻 $t$ 的纵向磁化强度形式：\n$$\nM_z(t) = M_0 \\left(1 - 2\\exp\\left(-\\frac{t}{T_1}\\right)\\right)\n$$\n问题要求 $M_z(TI)$，通过设 $t=TI$ 得到：\n$$\nM_z(TI) = M_0 \\left(1 - 2\\exp\\left(-\\frac{TI}{T_1}\\right)\\right)\n$$\n接下来，我们确定零点反转时间 $TI_0$，即脂肪信号为零的特定时间。这通过设置 $M_z(TI_0) = 0$ 来实现：\n$$\n0 = M_0 \\left(1 - 2\\exp\\left(-\\frac{TI_0}{T_1}\\right)\\right)\n$$\n由于 $M_0 \\neq 0$，我们必须有：\n$$\n1 - 2\\exp\\left(-\\frac{TI_0}{T_1}\\right) = 0\n$$\n$$\n2\\exp\\left(-\\frac{TI_0}{T_1}\\right) = 1\n$$\n$$\n\\exp\\left(-\\frac{TI_0}{T_1}\\right) = \\frac{1}{2}\n$$\n对两边取自然对数：\n$$\n-\\frac{TI_0}{T_1} = \\ln\\left(\\frac{1}{2}\\right) = -\\ln(2)\n$$\n求解 $TI_0$：\n$$\nTI_0 = T_1 \\ln(2)\n$$\n现在，我们计算残余脂肪信号对反转时间 $TI$ 微小误差的灵敏度。残余信号是归一化的磁化强度 $M_z/M_0$。我们将这个归一化信号定义为 $S(TI)$：\n$$\nS(TI) = \\frac{M_z(TI)}{M_0} = 1 - 2\\exp\\left(-\\frac{TI}{T_1}\\right)\n$$\n灵敏度是 $S(TI)$ 关于 $TI$ 的导数，在零点 $TI = TI_0$ 处求值。\n首先，我们求导数：\n$$\n\\frac{\\partial S}{\\partial TI} = \\frac{\\partial}{\\partial TI} \\left(1 - 2\\exp\\left(-\\frac{TI}{T_1}\\right)\\right) = -2 \\cdot \\left(-\\frac{1}{T_1}\\right) \\exp\\left(-\\frac{TI}{T_1}\\right) = \\frac{2}{T_1} \\exp\\left(-\\frac{TI}{T_1}\\right)\n$$\n现在，我们在 $TI = TI_0 = T_1 \\ln(2)$ 处计算这个导数：\n$$\n\\left. \\frac{\\partial S}{\\partial TI} \\right|_{TI=TI_0} = \\frac{2}{T_1} \\exp\\left(-\\frac{T_1 \\ln(2)}{T_1}\\right) = \\frac{2}{T_1} \\exp(-\\ln(2))\n$$\n使用性质 $\\exp(-\\ln(x)) = \\exp(\\ln(x^{-1})) = x^{-1}$，我们有 $\\exp(-\\ln(2)) = 1/2$。\n$$\n\\left. \\frac{\\partial S}{\\partial TI} \\right|_{TI=TI_0} = \\frac{2}{T_1} \\cdot \\frac{1}{2} = \\frac{1}{T_1}\n$$\n零点处残余信号的灵敏度就是纵向弛豫时间​​的倒数。\n\n最后，我们使用给定的值 $T_{1,\\mathrm{fat}} = 280\\,\\mathrm{ms}$ 计算此灵敏度的数值。单位必须是 $\\mathrm{s}^{-1}$，所以我们首先将 $T_1$ 转换为秒：\n$$\nT_{1,\\mathrm{fat}} = 280\\,\\mathrm{ms} = 0.280\\,\\mathrm{s}\n$$\n灵敏度为：\n$$\n\\text{灵敏度} = \\frac{1}{T_{1,\\mathrm{fat}}} = \\frac{1}{0.280\\,\\mathrm{s}} \\approx 3.571428...\\,\\mathrm{s}^{-1}\n$$\n四舍五入到 $4$ 位有效数字，数值为 $3.571\\,\\mathrm{s}^{-1}$。\n\n这个大约为 $3.571\\,\\mathrm{s}^{-1}$ 的灵敏度值表明，在零点附近，归一化残余脂肪信号的幅度增加量约为时间误差（以秒为单位）的 $3.571$ 倍。这凸显了为了有效抑制脂肪，必须高精度地选择反转时间 $TI$，因为与理想 $TI_0$ 的微小偏差可能导致脂肪信号明显重现。",
            "answer": "$$\n\\boxed{3.571}\n$$"
        },
        {
            "introduction": "最后的这项练习将从解析推导转向构建完整的计算模型，这是现代医学成像领域的一项关键技能。您将通过编程实现一个STIR序列的数值模拟，综合考虑射频脉冲和弛豫过程的影响。通过构建这个模型，您可以探索各种序列参数如何相互作用，最终影响脂肪和水等不同组织之间的图像对比度。",
            "id": "4922701",
            "problem": "您需要使用布洛赫方程对用于脂肪抑制的短T_I反转恢复（STIR）序列及后续的涡轮自旋回波（TSE）读出进行建模，并将最终模型实现为一个可运行的程序。物理场景如下：一个翻转角为 $180^\\circ$ 的非选择性反转射频脉冲，在反转时间 $TI$ 内的自由弛豫，一个翻转角为 $90^\\circ$ 的层选择性激发射频脉冲，以及一个在回波时间 $TE$ 产生第一个自旋回波的 TSE 脉冲链。短T_I反转恢复（STIR）指选择一个较短的 $TI$ 来使脂肪信号归零。涡轮自旋回波（TSE）指使用重复的 $180^\\circ$ 重聚脉冲进行快速自旋回波读出。\n\n使用的基本原理是包含弛豫项的旋转坐标系中的布洛赫方程。设磁化矢量为 $\\mathbf{M}(t) = [M_x(t), M_y(t), M_z(t)]^\\top$，平衡磁化强度为 $M_0$，纵向弛豫时间为 $T_1$，横向弛豫时间为 $T_2$。在旋转坐标系中未施加射频场的情况下，布洛赫方程为：\n$$\n\\frac{d}{dt}\\begin{bmatrix} M_x \\\\ M_y \\\\ M_z \\end{bmatrix} = \\begin{bmatrix} -\\frac{M_x}{T_2} \\\\ -\\frac{M_y}{T_2} \\\\ \\frac{M_0 - M_z}{T_1} \\end{bmatrix}\n$$\n在一个模拟为绕 $x$ 轴的硬脉冲、翻转角为 $\\alpha$（单位：度）的射频脉冲作用下，磁化矢量由旋转矩阵 $R_x(\\alpha)$ 进行瞬时旋转：\n$$\nR_x(\\alpha) =\n\\begin{bmatrix}\n1  0  0\\\\\n0  \\cos(\\alpha_\\mathrm{rad})  -\\sin(\\alpha_\\mathrm{rad})\\\\\n0  \\sin(\\alpha_\\mathrm{rad})  \\cos(\\alpha_\\mathrm{rad})\n\\end{bmatrix},\n\\quad\n\\alpha_\\mathrm{rad} = \\alpha \\cdot \\frac{\\pi}{180}.\n$$\n\n您的程序必须：\n- 对每种组分，从初始条件 $\\mathbf{M}(0^-) = [0,0,M_0]^\\top$ 开始。\n- 施加一个非选择性反转脉冲，该脉冲模拟为绕 $x$ 轴、翻转角为 $\\alpha_\\mathrm{inv}$（单位：度）的旋转，以获得 $\\mathbf{M}(0^+)$。\n- 在反转时间 $TI$（单位：毫秒）内，对未施加场的布洛赫方程进行数值积分，采用固定时间步长 $\\Delta t = 0.1\\,\\mathrm{ms}$ 的前向欧拉离散化方法，以获得 $\\mathbf{M}(TI^-)$。\n- 施加一个层选择性激发脉冲，该脉冲模拟为绕 $x$ 轴、翻转角为 $\\alpha_\\mathrm{exc}$（单位：度）的旋转，以获得 $\\mathbf{M}(TI^+)$。\n- 将 TSE 读出建模为在激发后 $TE$（单位：毫秒）时刻产生第一个自旋回波，假设重聚脉冲是理想的 $180^\\circ$ 脉冲，且扩散和离共振效应可忽略不计，因此横向磁化强度的大小按 $\\exp(-TE/T_2)$ 衰减。则一个组分的回波幅度定义为\n$$\nS = \\left\\|\\begin{bmatrix}M_x(TI^+)\\\\ M_y(TI^+)\\end{bmatrix}\\right\\| \\cdot \\exp\\!\\left(-\\frac{TE}{T_2}\\right).\n$$\n\n为了探究脂肪抑制，考虑两种组分：“类脂肪”组分和“类水”组分。每种组分都有其自身的 $T_1$、$T_2$ 和 $M_0$，但经历相同的射频脉冲和时序。射频翻转角可以由一个无量纲的发射灵敏度因子 $b$ 进行缩放，使得有效施加的翻转角为 $b \\cdot \\alpha_\\mathrm{inv}$ 和 $b \\cdot \\alpha_\\mathrm{exc}$。\n\n您的任务是实现这个模型，并针对一小组测试用例，计算比率 $r = S_\\mathrm{fat}/S_\\mathrm{water}$，其中 $S_\\mathrm{fat}$ 和 $S_\\mathrm{water}$ 分别是类脂肪组分和类水组分的回波幅度。所有时间以毫秒表示，角度以度表示，并将比率输出为无单位的浮点数。\n\n测试用例集：\n- 组分参数（用于所有测试用例）：\n  - 类脂肪：$T_{1,\\mathrm{fat}} = 250\\,\\mathrm{ms}$，$T_{2,\\mathrm{fat}} = 80\\,\\mathrm{ms}$，$M_{0,\\mathrm{fat}} = 1.0$。\n  - 类水：$T_{1,\\mathrm{water}} = 1000\\,\\mathrm{ms}$，$T_{2,\\mathrm{water}} = 100\\,\\mathrm{ms}$，$M_{0,\\mathrm{water}} = 1.0$。\n- 用例 $1$（接近脂肪信号零点的理想路径）：$TI = 175\\,\\mathrm{ms}$，$TE = 10\\,\\mathrm{ms}$，$\\alpha_\\mathrm{inv} = 180^\\circ$，$\\alpha_\\mathrm{exc} = 90^\\circ$，$b = 1.0$。\n- 用例 $2$（$TI$ 极短的边界情况）：$TI = 0\\,\\mathrm{ms}$，$TE = 10\\,\\mathrm{ms}$，$\\alpha_\\mathrm{inv} = 180^\\circ$，$\\alpha_\\mathrm{exc} = 90^\\circ$，$b = 1.0$。\n- 用例 $3$（发射翻转不足的边缘情况）：$TI = 175\\,\\mathrm{ms}$，$TE = 10\\,\\mathrm{ms}$，$\\alpha_\\mathrm{inv} = 180^\\circ$，$\\alpha_\\mathrm{exc} = 90^\\circ$，$b = 0.9$。\n- 用例 $4$（长反转时间）：$TI = 1000\\,\\mathrm{ms}$，$TE = 10\\,\\mathrm{ms}$，$\\alpha_\\mathrm{inv} = 180^\\circ$，$\\alpha_\\mathrm{exc} = 90^\\circ$，$b = 1.0$。\n- 用例 $5$（增加 $TE$ 以探测 $T_2$ 加权）：$TI = 175\\,\\mathrm{ms}$，$TE = 80\\,\\mathrm{ms}$，$\\alpha_\\mathrm{inv} = 180^\\circ$，$\\alpha_\\mathrm{exc} = 90^\\circ$，$b = 1.0$。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含结果，格式为方括号内以逗号分隔的列表，按用例 1 到 5 的顺序排列，每个条目是该用例的浮点比率 $r = S_\\mathrm{fat}/S_\\mathrm{water}$。例如，正确格式的输出为 $[r_1,r_2,r_3,r_4,r_5]$，其中每个 $r_i$ 是一个浮点数。",
            "solution": "该问题要求对短T_I反转恢复（STIR）脉冲序列及后续的涡轮自旋回波（TSE）读出进行建模，以确定类脂肪组织和类水组织之间的信号比。解决方案通过根据布洛赫方程模拟每种组分的磁化矢量 $\\mathbf{M}(t)$ 在经历一系列射频（RF）脉冲和弛豫周期后的行为来得出。\n\n对于单个组分（由 $T_1$、$T_2$ 和 $M_0$ 表征），模拟过程如下：\n\n1.  **初始状态**：在施加任何射频脉冲之前的时间 $t=0^-$，系统处于热平衡状态。磁化矢量与主磁场（通常是 $z$ 轴）对齐，没有横向分量。\n    $$\n    \\mathbf{M}(0^-) = \\begin{bmatrix} 0 \\\\ 0 \\\\ M_0 \\end{bmatrix}\n    $$\n\n2.  **反转脉冲**：在 $t=0$ 时，施加一个非选择性反转脉冲。这被建模为磁化矢量围绕旋转坐标系 $x$ 轴的瞬时旋转。翻转角 $\\alpha_\\mathrm{inv}$ 由发射灵敏度因子 $b$ 缩放。以弧度为单位的有效翻转角为 $\\alpha'_\\mathrm{inv} = (b \\cdot \\alpha_\\mathrm{inv}) \\cdot (\\pi/180)$。脉冲刚结束后的磁化状态 $\\mathbf{M}(0^+)$ 通过应用旋转矩阵 $R_x(\\alpha'_\\mathrm{inv})$ 计算得出：\n    $$\n    \\mathbf{M}(0^+) = R_x(\\alpha'_\\mathrm{inv}) \\mathbf{M}(0^-) =\n    \\begin{bmatrix}\n    1  0  0 \\\\\n    0  \\cos(\\alpha'_\\mathrm{inv})  -\\sin(\\alpha'_\\mathrm{inv}) \\\\\n    0  \\sin(\\alpha'_\\mathrm{inv})  \\cos(\\alpha'_\\mathrm{inv})\n    \\end{bmatrix}\n    \\begin{bmatrix} 0 \\\\ 0 \\\\ M_0 \\end{bmatrix}\n    =\n    \\begin{bmatrix} 0 \\\\ -M_0 \\sin(\\alpha'_\\mathrm{inv}) \\\\ M_0 \\cos(\\alpha'_\\mathrm{inv}) \\end{bmatrix}\n    $$\n    对于理想的反转脉冲，$\\alpha_\\mathrm{inv}=180^\\circ$ 且 $b=1$，因此 $\\alpha'_\\mathrm{inv}=\\pi$，且 $\\mathbf{M}(0^+) = [0, 0, -M_0]^\\top$。\n\n3.  **反转时间内（$TI$）的自由弛豫**：在从 $t=0^+$ 到 $t=TI^-$ 的反转时间内，磁化根据没有施加射频场的布洛赫方程进行演化。问题指定使用前向欧拉法进行数值积分，时间步长为 $\\Delta t = 0.1 \\, \\mathrm{ms}$。单个时间步的离散化方程为：\n    $$\n    M_x(t+\\Delta t) = M_x(t) \\left(1 - \\frac{\\Delta t}{T_2}\\right)\n    $$\n    $$\n    M_y(t+\\Delta t) = M_y(t) \\left(1 - \\frac{\\Delta t}{T_2}\\right)\n    $$\n    $$\n    M_z(t+\\Delta t) = M_z(t) \\left(1 - \\frac{\\Delta t}{T_1}\\right) + \\frac{M_0 \\Delta t}{T_1}\n    $$\n    从初始状态 $\\mathbf{M}(0^+)$ 开始，将此迭代更新应用 $N = \\text{int}(TI / \\Delta t)$ 次，以计算反转周期结束时的最终状态 $\\mathbf{M}(TI^-)$。\n\n4.  **激发脉冲**：在 $t=TI$ 时，施加一个层选择性激发脉冲。这也建模为绕 $x$ 轴的瞬时旋转。以弧度为单位的有效翻转角为 $\\alpha'_\\mathrm{exc} = (b \\cdot \\alpha_\\mathrm{exc}) \\cdot (\\pi/180)$。激发脉冲后的磁化状态 $\\mathbf{M}(TI^+)$ 为：\n    $$\n    \\mathbf{M}(TI^+) = R_x(\\alpha'_\\mathrm{exc}) \\mathbf{M}(TI^-) =\n    \\begin{bmatrix}\n    1  0  0 \\\\\n    0  \\cos(\\alpha'_\\mathrm{exc})  -\\sin(\\alpha'_\\mathrm{exc}) \\\\\n    0  \\sin(\\alpha'_\\mathrm{exc})  \\cos(\\alpha'_\\mathrm{exc})\n    \\end{bmatrix}\n    \\begin{bmatrix} M_x(TI^-) \\\\ M_y(TI^-) \\\\ M_z(TI^-) \\end{bmatrix}\n    $$\n\n5.  **回波信号计算**：TSE 读出在激发脉冲后，于回波时间 $TE$ 产生一个自旋回波。该模型假设完美的重聚，因此信号幅度由激发后瞬时的横向磁化强度大小 $\\left\\| \\mathbf{M}_{xy}(TI^+) \\right\\|$ 决定，该强度随后在 $TE$ 时间内因 $T_2$ 弛豫而衰减。回波幅度 $S$ 由下式给出：\n    $$\n    S = \\left\\| \\begin{bmatrix} M_x(TI^+) \\\\ M_y(TI^+) \\end{bmatrix} \\right\\| \\cdot \\exp\\left(-\\frac{TE}{T_2}\\right) = \\sqrt{M_x(TI^+)^2 + M_y(TI^+)^2} \\cdot \\exp\\left(-\\frac{TE}{T_2}\\right)\n    $$\n\n为了解决该问题，对每个测试用例，此完整过程执行两次：一次使用类脂肪组分的参数（$T_{1,\\mathrm{fat}}, T_{2,\\mathrm{fat}}, M_{0,\\mathrm{fat}}$）计算 $S_\\mathrm{fat}$，另一次使用类水组分的参数（$T_{1,\\mathrm{water}}, T_{2,\\mathrm{water}}, M_{0,\\mathrm{water}}$）计算 $S_\\mathrm{water}$。每个用例的最终结果是比率 $r = S_\\mathrm{fat} / S_\\mathrm{water}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Models a STIR-TSE sequence and computes the fat-to-water signal ratio for a suite of test cases.\n    \"\"\"\n    \n    # Species parameters (fixed for all test cases)\n    species_params = {\n        'fat': {'T1': 250.0, 'T2': 80.0, 'M0': 1.0},\n        'water': {'T1': 1000.0, 'T2': 100.0, 'M0': 1.0}\n    }\n    \n    # Test cases\n    test_cases = [\n        {'TI': 175.0, 'TE': 10.0, 'alpha_inv': 180.0, 'alpha_exc': 90.0, 'b': 1.0}, # Case 1\n        {'TI': 0.0, 'TE': 10.0, 'alpha_inv': 180.0, 'alpha_exc': 90.0, 'b': 1.0},   # Case 2\n        {'TI': 175.0, 'TE': 10.0, 'alpha_inv': 180.0, 'alpha_exc': 90.0, 'b': 0.9}, # Case 3\n        {'TI': 1000.0, 'TE': 10.0, 'alpha_inv': 180.0, 'alpha_exc': 90.0, 'b': 1.0},# Case 4\n        {'TI': 175.0, 'TE': 80.0, 'alpha_inv': 180.0, 'alpha_exc': 90.0, 'b': 1.0}, # Case 5\n    ]\n\n    dt = 0.1  # Time step in milliseconds for numerical integration\n\n    def compute_signal(species_props, seq_params):\n        \"\"\"\n        Computes the echo signal for a single species given sequence parameters.\n        \"\"\"\n        T1, T2, M0 = species_props['T1'], species_props['T2'], species_props['M0']\n        TI, TE = seq_params['TI'], seq_params['TE']\n        alpha_inv_deg, alpha_exc_deg = seq_params['alpha_inv'], seq_params['alpha_exc']\n        b = seq_params['b']\n\n        # Step 1: Initial state\n        M = np.array([0.0, 0.0, M0])\n\n        # Step 2: Inversion pulse\n        alpha_inv_rad = b * alpha_inv_deg * np.pi / 180.0\n        cos_a_inv = np.cos(alpha_inv_rad)\n        sin_a_inv = np.sin(alpha_inv_rad)\n        Rx_inv = np.array([\n            [1, 0, 0],\n            [0, cos_a_inv, -sin_a_inv],\n            [0, sin_a_inv, cos_a_inv]\n        ])\n        M = Rx_inv @ M\n\n        # Step 3: Free relaxation during inversion time (TI)\n        num_steps = int(TI / dt)\n        if num_steps  0:\n            # Pre-calculate factors for Euler integration\n            e1 = dt / T1\n            e2 = dt / T2\n            c1z = 1.0 - e1\n            c2z = e1 * M0\n            c_xy = 1.0 - e2\n\n            for _ in range(num_steps):\n                M[0] *= c_xy\n                M[1] *= c_xy\n                M[2] = M[2] * c1z + c2z\n\n        # Step 4: Excitation pulse\n        alpha_exc_rad = b * alpha_exc_deg * np.pi / 180.0\n        cos_a_exc = np.cos(alpha_exc_rad)\n        sin_a_exc = np.sin(alpha_exc_rad)\n        Rx_exc = np.array([\n            [1, 0, 0],\n            [0, cos_a_exc, -sin_a_exc],\n            [0, sin_a_exc, cos_a_exc]\n        ])\n        M = Rx_exc @ M\n\n        # Step 5: Echo signal calculation\n        M_xy = np.sqrt(M[0]**2 + M[1]**2)\n        S = M_xy * np.exp(-TE / T2)\n        \n        return S\n\n    results = []\n    for case in test_cases:\n        S_fat = compute_signal(species_params['fat'], case)\n        S_water = compute_signal(species_params['water'], case)\n        \n        if S_water != 0:\n            ratio = S_fat / S_water\n        else:\n            # Handle the case of zero water signal to avoid division by zero.\n            # In practice, with noise, this would be a large, poorly-defined number.\n            # For this simulation, if fat signal is also zero, ratio is NaN (becomes 0/0), \n            # otherwise it's infinity. We can cap it or represent as a large number\n            # but given the physics, if S_water is 0, S_fat will be non-zero,\n            # so the ratio is effectively infinite. Let's use numpy's representation.\n            ratio = np.inf if S_fat  0 else 0.0\n\n        results.append(ratio)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}