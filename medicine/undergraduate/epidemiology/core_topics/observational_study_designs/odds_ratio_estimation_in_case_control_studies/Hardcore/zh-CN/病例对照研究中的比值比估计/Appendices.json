{
    "hands_on_practices": [
        {
            "introduction": "这项练习是掌握比值比分析的基石。通过将比值比（$OR$）、其对数（$\\log(OR)$）、标准误以及相应的置信区间和假设检验的公式转化为代码，您将对这些基本流行病学工具的计算机制有更深刻的理解。此练习  强调了在对数尺度上进行统计推断的重要性，这是流行病学数据分析中的一个核心概念。",
            "id": "4616344",
            "problem": "一项病例对照研究评估了二元暴露与二元疾病结局之间的关联。建立如下的 $2 \\times 2$ 计数表：第一行对应患病个体（病例），其中 $a$ 为暴露者，$b$ 为未暴露者；第二行对应未患病个体（对照），其中 $c$ 为暴露者，$d$ 为未暴露者。病例组中的暴露比值定义为 $a/b$，对照组中的暴露比值定义为 $c/d$。比值比定义为这两个比值的比率。假设在病例组和对照组内部进行独立抽样。\n\n从这些核心定义出发，推导一个程序以执行以下操作：\n- 估计比值比、其自然对数以及估计的比值比的自然对数的标准误。\n- 使用大样本正态近似，为真实比值比构建一个双侧 $(1-\\alpha)$ 置信区间 (CI)，其中 $\\alpha = 0.05$ 是以小数形式表示的I类错误率。\n- 对真实比值比等于1的原假设进行双侧Wald假设检验。\n- 当 $a$、$b$、$c$ 或 $d$ 中任何一个等于0时，应用Haldane–Anscombe校正（将所有四个单元格计数都加上0.5），以避免出现未定义量。\n\n您的程序必须实现上述推导，并为每个测试用例计算一个按顺序包含以下七个元素的列表：\n1. 估计的比值比 $\\widehat{\\mathrm{OR}}$，四舍五入到六位小数。\n2. 估计的自然对数 $\\log(\\widehat{\\mathrm{OR}})$，四舍五入到六位小数。\n3. 估计的 $\\log(\\widehat{\\mathrm{OR}})$ 的标准误，四舍五入到六位小数。\n4. 比值比的 $(1-\\alpha)$ CI 的下限，四舍五入到六位小数。\n5. 比值比的 $(1-\\alpha)$ CI 的上限，四舍五入到六位小数。\n6. 用于检验真实比值比是否等于1的双侧Wald检验p值，四舍五入到六位小数。\n7. 一个布尔值，指示在显著性水平 $\\alpha$ 下是否拒绝原假设（使用 $True$ 表示拒绝，否则使用 $False$）。\n\n测试套件：\n使用以下六个测试用例，每个用例按 $(a,b,c,d)$ 的顺序指定：\n- 案例1（一般中等计数）：$(40,60,20,80)$。\n- 案例2（含零单元格的边界条件）：$(0,50,30,70)$。\n- 案例3（接近零关联）：$(30,70,28,72)$。\n- 案例4（关联小于1）：$(10,90,30,70)$。\n- 案例5（对照组暴露单元格为零的边界条件）：$(5,95,0,100)$。\n- 案例6（大样本稳定性）：$(1000,1500,1100,1400)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身也是一个按上述相同顺序排列、用方括号括起来的逗号分隔列表。输出中不要包含任何空格。例如，输出格式应如下所示：\n$[\\,[x_{11},x_{12},\\dots,x_{17}],[x_{21},x_{22},\\dots,x_{27}],\\dots\\,]$,\n其中 $x_{ij}$ 是案例 $i$ 和元素 $j$ 的计算值。",
            "solution": "该问题是有效的，因为它提出了一个基于生物统计学和流行病学标准原则的、定义明确、有科学依据的客观任务。它是自包含的，所有必要的数据和方法都已指定。不存在不一致、模糊或不可靠的前提。因此，我们可以继续进行推导和求解。\n\n该问题需要分析来自病例对照研究的数据，这些数据呈现在一个具有以下单元格计数的 $2 \\times 2$ 列联表中：\n- $a$：暴露病例（疾病存在，暴露存在）\n- $b$：未暴露病例（疾病存在，暴露不存在）\n- $c$：暴露对照（疾病不存在，暴露存在）\n- $d$：未暴露对照（疾病不存在，暴露不存在）\n\n病例总数为 $n_1 = a+b$，对照总数为 $n_2 = c+d$。抽样的方式是选定一定数量的病例和对照，然后确定他们的暴露史。\n\n**1. 比值比（$\\mathrm{OR}$）的估计**\n\n病例组中的暴露比值估计为暴露病例与未暴露病例的比率，即 $\\mathrm{Odds}_{\\text{cases}} = a/b$。\n对照组中的暴露比值估计为暴露对照与未暴露对照的比率，即 $\\mathrm{Odds}_{\\text{controls}} = c/d$。\n\n样本比值比，记作 $\\widehat{\\mathrm{OR}}$，是这两个比值的比率。它作为真实总体比值比 $\\mathrm{OR}$ 的估计量。\n\n$$\n\\widehat{\\mathrm{OR}} = \\frac{a/b}{c/d} = \\frac{ad}{bc}\n$$\n\n这是比值比的最大似然估计量。$\\widehat{\\mathrm{OR}} > 1$ 的值表明暴露与疾病之间存在正相关，$\\widehat{\\mathrm{OR}}  1$ 的值表明存在负相关（保护性），而接近1的值则表明无关联。\n\n如果任何单元格计数 $a, b, c, d$ 为零，就会出现一个实际问题。如果 $b=0$ 或 $c=0$，估计量是未定义的。如果 $a=0$ 或 $d=0$ (且 $b, c \\neq 0$），估计量会变为0或无穷大。为规避此问题，应用Haldane–Anscombe校正。按照规定，如果任何单元格计数为0，我们将所有四个单元格都加上0.5。设（可能经过校正的）计数为 $a', b', c', d'$。校正后的估计量为：\n\n$$\n\\widehat{\\mathrm{OR}} = \\frac{a'd'}{b'c'}\n$$\n其中，如果任何原始计数为0，则 $a' = a+0.5$，$b' = b+0.5$，$c' = c+0.5$，$d' = d+0.5$；否则 $a'=a$，$b'=b$，$c'=c$，$d'=d$。\n\n**2. 对数比值比及其标准误**\n\n对于统计推断，使用比值比的自然对数 $\\log(\\widehat{\\mathrm{OR}})$ 进行分析非常有利。$\\log(\\widehat{\\mathrm{OR}})$ 的抽样分布比 $\\widehat{\\mathrm{OR}}$ 的抽样分布更接近正态分布，尤其是在有限样本中。\n\n估计的对数比值比为：\n$$\n\\log(\\widehat{\\mathrm{OR}}) = \\log\\left(\\frac{a'd'}{b'c'}\\right) = \\log(a') + \\log(d') - \\log(b') - \\log(c')\n$$\n\n对数比值比估计量的方差可以使用delta方法进行近似。$\\log(\\widehat{\\mathrm{OR}})$ 的方差的大样本近似值由各单元格计数的倒数之和给出：\n$$\n\\mathrm{Var}(\\log(\\widehat{\\mathrm{OR}})) \\approx \\frac{1}{a'} + \\frac{1}{b'} + \\frac{1}{c'} + \\frac{1}{d'}\n$$\n\n对数比值比的标准误 $\\widehat{\\mathrm{SE}}[\\log(\\widehat{\\mathrm{OR}})]$ 是这个估计方差的平方根：\n$$\n\\widehat{\\mathrm{SE}}[\\log(\\widehat{\\mathrm{OR}})] = \\sqrt{\\frac{1}{a'} + \\frac{1}{b'} + \\frac{1}{c'} + \\frac{1}{d'}}\n$$\n\n**3. 比值比的置信区间**\n\n利用对数比值比的正态近似，为真实对数比值比 $\\log(\\mathrm{OR})$ 构建一个双侧 $(1-\\alpha)$ 置信区间 (CI)，如下所示：\n$$\n\\log(\\widehat{\\mathrm{OR}}) \\pm z_{1-\\alpha/2} \\cdot \\widehat{\\mathrm{SE}}[\\log(\\widehat{\\mathrm{OR}})]\n$$\n其中 $z_{1-\\alpha/2}$ 是标准正态分布的 $(1-\\alpha/2)$-分位数。对于显著性水平 $\\alpha = 0.05$，我们需要 $1 - 0.05/2 = 0.975$ 分位数，其值为 $z_{0.975} \\approx 1.95996$。\n\n设此置信区间的下限和上限分别为 $L = \\log(\\widehat{\\mathrm{OR}}) - z_{0.975} \\cdot \\widehat{\\mathrm{SE}}[\\log(\\widehat{\\mathrm{OR}})]$ 和 $U = \\log(\\widehat{\\mathrm{OR}}) + z_{0.975} \\cdot \\widehat{\\mathrm{SE}}[\\log(\\widehat{\\mathrm{OR}})]$。\n\n为了获得比值比 $\\mathrm{OR}$ 本身的置信区间，我们对这些界限取指数：\n$$\n\\text{CI for OR} = [\\exp(L), \\exp(U)]\n$$\n\n**4. Wald假设检验**\n\n我们希望检验原假设 $H_0$，即暴露与疾病之间无关联，这对应于真实比值比为1。备择假设 $H_1$ 是存在关联。\n- $H_0: \\mathrm{OR} = 1$\n- $H_1: \\mathrm{OR} \\neq 1$\n\n在对数尺度上，这等价于：\n- $H_0: \\log(\\mathrm{OR}) = 0$\n- $H_1: \\log(\\mathrm{OR}) \\neq 0$\n\nWald检验统计量 $Z$ 的构建方法是将估计的对数比值比除以其标准误。这衡量了估计值偏离零值0的程度（以标准误为单位）。\n$$\nZ = \\frac{\\log(\\widehat{\\mathrm{OR}}) - 0}{\\widehat{\\mathrm{SE}}[\\log(\\widehat{\\mathrm{OR}})]} = \\frac{\\log(\\widehat{\\mathrm{OR}})}{\\widehat{\\mathrm{SE}}[\\log(\\widehat{\\mathrm{OR}})]}\n$$\n在 $H_0$ 成立的条件下，该统计量 $Z$ 近似服从标准正态分布 $\\mathcal{N}(0, 1)$。\n\n双侧p值是在假设 $H_0$ 为真的情况下，观察到至少与观测值一样极端的检验统计量的概率。其计算公式为：\n$$\np = P(|Z_{obs}| \\ge |z|) = 2 \\times P(Z_{obs} \\ge |z|) = 2 \\times (1 - \\Phi(|z|))\n$$\n其中 $z$ 是检验统计量 $Z$ 的观测值，$\\Phi(\\cdot)$ 是标准正态分布的累积分布函数 (CDF)。\n\n如果计算出的p值小于或等于显著性水平 $\\alpha$，则在显著性水平 $\\alpha$ 下拒绝原假设 $H_0$。对于本问题，如果 $p \\le 0.05$，我们就拒绝 $H_0$。\n\n该程序将应用于每个测试用例，产生七个所需的输出：\n1. $\\widehat{\\mathrm{OR}}$\n2. $\\log(\\widehat{\\mathrm{OR}})$\n3. $\\widehat{\\mathrm{SE}}[\\log(\\widehat{\\mathrm{OR}})]$\n4. OR的95%CI下限\n5. OR的95%CI上限\n6. 双侧Wald检验p值\n7. 一个布尔值，指示在 $\\alpha=0.05$ 时是否拒绝 $H_0$。\n所有数值结果将四舍五入到六位小数。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\n\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and generate the final output string.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (a, b, c, d)\n        (40, 60, 20, 80),    # Case 1: general moderate counts\n        (0, 50, 30, 70),     # Case 2: boundary condition with a zero cell\n        (30, 70, 28, 72),    # Case 3: near-null association\n        (10, 90, 30, 70),    # Case 4: association below one\n        (5, 95, 0, 100),     # Case 5: boundary condition with a zero control exposure cell\n        (1000, 1500, 1100, 1400), # Case 6: large-sample stability\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _calculate_or_statistics(*case)\n        results.append(result)\n\n    # Format the final output string as per the problem specification.\n    # e.g., [[val1,val2,...],[val1,val2,...]] with no spaces.\n    # The str() function for a boolean correctly produces 'True' or 'False'.\n    output_str = f\"[{','.join([f'[{\",\".join(map(str, r))}]' for r in results])}]\"\n    print(output_str)\n\ndef _calculate_or_statistics(a, b, c, d):\n    \"\"\"\n    Calculates statistics related to the odds ratio for a 2x2 table.\n\n    Args:\n        a (int): Exposed cases\n        b (int): Unexposed cases\n        c (int): Exposed controls\n        d (int): Unexposed controls\n\n    Returns:\n        list: A list containing 7 elements:\n              1. Estimated odds ratio\n              2. Natural log of the estimated odds ratio\n              3. Standard error of the log odds ratio\n              4. Lower bound of the 95% CI for the odds ratio\n              5. Upper bound of the 95% CI for the odds ratio\n              6. Wald test p-value\n              7. Boolean for rejection of the null hypothesis at alpha=0.05\n    \"\"\"\n    alpha = 0.05\n    a_calc, b_calc, c_calc, d_calc = float(a), float(b), float(c), float(d)\n\n    # Apply Haldane–Anscombe correction if any cell is zero.\n    if a == 0 or b == 0 or c == 0 or d == 0:\n        a_calc += 0.5\n        b_calc += 0.5\n        c_calc += 0.5\n        d_calc += 0.5\n\n    # 1. Estimate the odds ratio (OR_hat)\n    # Check for division by zero in the denominator, even after correction (though unlikely)\n    if b_calc == 0 or c_calc == 0:\n        # This case is highly pathological and shouldn't occur with the correction\n        # in place for non-negative integer inputs. We handle it defensively.\n        return [None] * 7\n        \n    or_hat = (a_calc * d_calc) / (b_calc * c_calc)\n\n    # 2. Estimate the natural logarithm of the odds ratio\n    log_or_hat = np.log(or_hat)\n\n    # 3. Estimate the standard error of the log odds ratio\n    se_log_or_hat = np.sqrt(1/a_calc + 1/b_calc + 1/c_calc + 1/d_calc)\n\n    # 4.  5. Construct a (1-alpha) CI for the true odds ratio\n    z_alpha_2 = norm.ppf(1 - alpha / 2)\n    log_ci_lower = log_or_hat - z_alpha_2 * se_log_or_hat\n    log_ci_upper = log_or_hat + z_alpha_2 * se_log_or_hat\n    \n    ci_or_lower = np.exp(log_ci_lower)\n    ci_or_upper = np.exp(log_ci_upper)\n\n    # 6. Perform a two-sided Wald hypothesis test (H0: OR = 1, i.e., log(OR) = 0)\n    wald_z_stat = log_or_hat / se_log_or_hat\n    p_value = 2 * norm.sf(np.abs(wald_z_stat)) # sf = 1 - cdf, more accurate for tails\n\n    # 7. Determine whether to reject the null hypothesis\n    reject_h0 = p_value = alpha\n\n    # Round numerical results to six decimal places\n    return [\n        round(or_hat, 6),\n        round(log_or_hat, 6),\n        round(se_log_or_hat, 6),\n        round(ci_or_lower, 6),\n        round(ci_or_upper, 6),\n        round(p_value, 6),\n        reject_h0\n    ]\n\n# Execute the main function\nsolve()\n```"
        },
        {
            "introduction": "在处理真实世界数据时，我们经常会遇到挑战，其中常见的一种是 $2 \\times 2$ 表中出现零单元格。这种情况（在逻辑回归中称为“分离”）会导致标准大样本方法失效，例如产生无限大的比值比估计。本练习  将引导您探讨稀疏数据带来的后果，并介绍更稳健的替代方法，如费希尔精确检验（Fisher's exact test），帮助您理解其在小样本情况下的优势。",
            "id": "4616364",
            "problem": "一项非匹配病例对照研究调查了暴露于一种罕见污染物是否与某种疾病相关。数据汇总在如下的 $2\\times 2$ 表格中，其格子计数如下（使用常规表示法，其中 $a$ 为暴露病例数，$b$ 为非暴露病例数，$c$ 为暴露对照数，$d$ 为非暴露对照数）：$a=2$，$b=4$，$c=0$，$d=6$。病例总数为 $n_{1}=6$，对照总数为 $n_{0}=6$，暴露研究对象总数为 $m_1=2$。假设采用标准病例对照抽样，其中 $n_{1}$ 和 $n_{0}$ 由研究设计固定。\n\n仅使用流行病学和概率论的核心定义，包括比值和比值比 (OR) 的定义，以及在无关联的原假设下，给定固定边际总计时暴露病例数的条件分布为超几何分布这一事实，判断下列哪个陈述是正确的。选择所有适用的选项。\n\nA. 从该 $2\\times 2$ 表格的交叉乘积计算出的常规样本比值比，对于这些数据是无穷大。\n\nB. 如果应用 Haldane–Anscombe 校正（仅对零值格子加 0.5）来处理零值格子，然后计算比值比，则估计值约为 $8.13$。\n\nC. 使用 Fisher 精确检验（对在原假设下与观测表格相同或更极端的表格的超几何概率求和），用于检验无关联性的双侧精确 $p$ 值为 $0.454$。\n\nD. 比值比的等尾精确条件 $95\\%$ 置信区间没有有限的上界，并且包含 $1$。\n\nE. 基于渐近正态性的对数比值比的 Wald $95\\%$ 置信区间在这里是有效的，因为 $n_{1}$ 和 $n_{0}$ 是由研究设计固定的。",
            "solution": "该问题陈述已经过验证，被认为是科学合理的、提法得当且客观的。它为标准的流行病学分析提供了一个完整且一致的数据集。\n\n来自非匹配病例对照研究的数据可汇总为以下 $2 \\times 2$ 表格：\n\n| | 病例 (疾病 +) | 对照 (疾病 -) | 总计 |\n| :--- | :--- | :--- | :--- |\n| **暴露** | $a=2$ | $c=0$ | $m_1=2$ |\n| **非暴露** | $b=4$ | $d=6$ | $m_0=10$|\n| **总计** | $n_1=6$ | $n_0=6$ | $N=12$ |\n\n边际总计是固定的：病例总数 $n_1 = a+b = 6$，对照总数 $n_0 = c+d = 6$，暴露总数 $m_1 = a+c = 2$，非暴露总数 $m_0 = b+d=10$。总样本量为 $N=12$。\n\n我们现在来评估每个陈述。\n\n### 对选项 A 的分析\n**陈述：** 从该 $2\\times 2$ 表格的交叉乘积计算出的常规样本比值比，对于这些数据是无穷大。\n\n样本比值比 ($OR$) 是总体比值比的估计量。对于病例对照研究，它被计算为病例中暴露的比值与对照中暴露的比值之比。\n病例中暴露的比值为 $\\frac{a}{b}$。\n对照中暴露的比值为 $\\frac{c}{d}$。\n因此，样本比值比 $\\widehat{OR}$ 为：\n$$ \\widehat{OR} = \\frac{a/b}{c/d} = \\frac{ad}{bc} $$\n代入给定的格子计数：\n$$ \\widehat{OR} = \\frac{(2)(6)}{(4)(0)} = \\frac{12}{0} $$\n除以零是未定义的操作。在比值比的背景下，分母中（$b$ 或 $c$）出现零值格子会导致点估计值为 $0$ 或无穷大。在这里，由于 $c=0$，比值比的估计值为无穷大。\n\n**对 A 的结论：** 正确。计算结果导致除以零，从而得出无穷大的样本比值比。\n\n### 对选项 B 的分析\n**陈述：** 如果应用 Haldane–Anscombe 校正（仅对零值格子加 0.5）来处理零值格子，然后计算比值比，则估计值约为 $8.13$。\n\n该陈述描述了一个特定的、尽管非标准的程序：“仅对零值格子加 0.5”。让我们应用这个程序。\n唯一的零值格子是 $c=0$。修改后的格子计数将是：$a' = 2$，$b' = 4$，$c' = 0+0.5 = 0.5$，$d' = 6$。根据这些修改后的计数计算出的比值比是：\n$$ \\widehat{OR} = \\frac{a'd'}{b'c'} = \\frac{(2)(6)}{(4)(0.5)} = \\frac{12}{2} = 6 $$\n这个值不约等于 $8.13$。\n\n“Haldane-Anscombe 校正”更常见的做法是指对表格中*所有*格子都加 0.5。让我们用这个标准程序来计算比值比：\n校正后的格子计数为：$a''=2.5$，$b''=4.5$，$c''=0.5$，$d''=6.5$。由此产生的比值比为：\n$$ \\widehat{OR} = \\frac{a''d''}{b''c''} = \\frac{(2.5)(6.5)}{(4.5)(0.5)} = \\frac{16.25}{2.25} \\approx 7.22 $$\n这个值也不约等于 $8.13$。无论根据其自己描述的程序，还是根据与其同名的标准程序，该陈述在事实上都是不正确的。\n\n**对 B 的结论：** 不正确。基于所描述程序计算得出的比值比为 $6$，而标准的 Haldane-Anscombe 校正得出的比值比约为 $7.22$。两者都与声称的值 $8.13$ 不符。\n\n### 对选项 C 的分析\n**陈述：** 使用 Fisher 精确检验（对在原假设下与观测表格相同或更极端的表格的超几何概率求和），用于检验无关联性的双侧精确 $p$ 值为 $0.454$。\n\n在无关联的原假设下，并以边际总计（$n_1=6, n_0=6, m_1=2, m_0=10$）为条件，暴露病例数 $a$ 服从超几何分布。观测到具有 $a$ 个暴露病例的表格的概率由以下公式给出：\n$$ P(a) = \\frac{\\binom{m_1}{a} \\binom{m_0}{n_1-a}}{\\binom{N}{n_1}} = \\frac{\\binom{2}{a} \\binom{10}{6-a}}{\\binom{12}{6}} $$\n$a$ 的可能值受边际总计的约束：$\\max(0, n_1-m_0) \\le a \\le \\min(n_1, m_1)$，这意味着 $\\max(0, 6-10) \\le a \\le \\min(6, 2)$，所以 $a \\in \\{0, 1, 2\\}$。\n\n让我们计算 $a$ 所有可能值的概率：\n分母是 $\\binom{12}{6} = \\frac{12!}{6!6!} = 924$。\n- 当 $a=0$ 时：$P(a=0) = \\frac{\\binom{2}{0}\\binom{10}{6}}{924} = \\frac{1 \\cdot 210}{924} = \\frac{210}{924}$。\n- 当 $a=1$ 时：$P(a=1) = \\frac{\\binom{2}{1}\\binom{10}{5}}{924} = \\frac{2 \\cdot 252}{924} = \\frac{504}{924}$。\n- 当 $a=2$ （观测值）时：$P(a=2) = \\frac{\\binom{2}{2}\\binom{10}{4}}{924} = \\frac{1 \\cdot 210}{924} = \\frac{210}{924}$。\n\n双侧 p 值是与观测表格相同或更极端的表格的概率之和。“更极端”通常定义为概率等于或小于观测表格的概率。\n我们观测到的表格（$a=2$）的概率是 $P(a=2) = 210/924$。\n概率小于或等于此值的表格是 $a=2$ 和 $a=0$ 的情况。\n因此，双侧 p 值为：\n$$ p = P(a=2) + P(a=0) = \\frac{210}{924} + \\frac{210}{924} = \\frac{420}{924} $$\n化简分数：$\\frac{420}{924} = \\frac{210}{462} = \\frac{105}{231} = \\frac{35}{77} = \\frac{5}{11}$。\n以小数表示，$p = 5/11 \\approx 0.454545...$。\n截断至三位小数得到 $0.454$，四舍五入则得到 $0.455$。陈述的值 $0.454$ 是对此结果的有效表示。\n\n**对 C 的结论：** 正确。双侧 Fisher 精确检验 p 值的计算是准确的。\n\n### 对选项 D 的分析\n**陈述：** 比值比的等尾精确条件 $95\\%$ 置信区间没有有限的上界，并且包含 $1$。\n\n比值比（$OR$ 或 $\\psi$）的精确条件置信区间是通过反转 Fisher 精确检验来构建的。区间 $[\\psi_L, \\psi_U]$ 通过求解以下方程得到：\n1. 对下界求解 $P(X \\ge a | \\psi = \\psi_L) = \\alpha/2$。\n2. 对上界求解 $P(X \\le a | \\psi = \\psi_U) = \\alpha/2$。\n此处，$a=2$ 且 $\\alpha=0.05$。\n\n**上界：** 我们需要求解 $P(X \\le 2 | \\psi_U) = 0.025$。格子计数 $a$ 的可能值为 $\\{0, 1, 2\\}$。观测值 $a=2$ 是可能的最大值。因此，累积概率 $P(X \\le 2 | \\psi)$ 是所有可能结果的概率之和，对于任何 $\\psi > 0$ 的值，这个和总是 $1$：\n$$ P(X \\le 2 | \\psi) = P(X=0|\\psi) + P(X=1|\\psi) + P(X=2|\\psi) = 1 $$\n方程 $1 = 0.025$ 对于 $\\psi_U$ 没有解。按照惯例，当观测值是可能的最大（或最小）值时，相应的置信限设为无穷大（或零）。因此，上界为 $\\psi_U = \\infty$。\n\n**是否包含 1：** 要确定 $OR=1$ 是否在置信区间内，我们可以进行一个显著性水平为 $\\alpha=0.05$ 的假设检验 $H_0: OR=1$。如果我们未能拒绝原假设，则 $OR=1$ 包含在 $95\\%$ 置信区间内。在选项 C 中，检验 $H_0: OR=1$ 的双侧 p 值已经计算为 $p=5/11 \\approx 0.455$。\n由于 $p \\approx 0.455 > 0.05$，我们不拒绝原假设。因此，比值比为 $1$ 是一个合理值，并且包含在 $95\\%$ 置信区间内。\n\n**对 D 的结论：** 正确。该区间没有有限的上界，因为观测到的格子计数是可能的最大值。它包含 $1$，因为原假设 $OR=1$ 的 p 值大于 $0.05$。\n\n### 对选项 E 的分析\n**陈述：** 基于渐近正态性的对数比值比的 Wald $95\\%$ 置信区间在这里是有效的，因为 $n_{1}$ 和 $n_{0}$ 是由研究设计固定的。\n\n构建置信区间的 Wald 方法依赖于对数比值比估计量的渐近正态性。置信区间的公式为 $\\log(\\widehat{OR}) \\pm z_{\\alpha/2} \\sqrt{\\widehat{Var}(\\log(\\widehat{OR}))}$，其中估计方差为：\n$$ \\widehat{Var}(\\log(\\widehat{OR})) = \\frac{1}{a} + \\frac{1}{b} + \\frac{1}{c} + \\frac{1}{d} $$\n对于给定的数据，$c=0$。这直接导致两个问题：\n1. 对数比值比本身，$\\log(\\frac{ad}{bc})$，因除以零而未定义。\n2. 方差估计包含项 $1/c$，即 $1/0$，因此是无穷大。\nWald 方法在未经修改（如 Haldane-Anscombe 校正）的情况下不适用于这些数据。更根本的是，像 Wald 区间这样的渐近方法的有效性依赖于大样本量，具体来说，是表格中所有格子的计数都相当大。对于像 $a=2$, $b=4$, $d=6$ 这样的小计数，尤其是零计数 $c=0$，正态性假设被严重违反。所提供的理由，“因为 $n_1$ 和 $n_0$ 是由研究设计固定的”，是使用精确条件方法（如 Fisher 检验）的条件，而不是将渐近方法应用于稀疏数据的理由。\n\n**对 E 的结论：** 不正确。由于零值格子计数和小样本量违反了渐近假设，Wald 区间对这些数据无效。所提供的理由与 Wald 方法的有效性无关。",
            "answer": "$$\\boxed{ACD}$$"
        },
        {
            "introduction": "混杂是观察性研究中需要解决的核心问题。本练习向您介绍 Mantel-Haenszel (MH) 方法，这是一种从多个数据层（例如，按年龄或性别分组）中计算合并比值比的经典而强大的技术。这项实践  不仅涉及计算，更重要的是，它通过对比可估计的比值比和在病例对照研究中通常无法直接估计的风险比（Risk Ratio），来强化您对该研究设计基本原则的理解。",
            "id": "4808937",
            "problem": "一位医学研究者进行了一项分层病例对照研究，以评估二元暴露 $E$ 与二元疾病结局 $D$ 之间的关联，并通过在 $3$ 个水平（例如，年龄组或医院地点）上进行分层来控制一个潜在的混杂因素。在每个层 $k \\in \\{1,2,3\\}$ 内，数据构成一个 $2 \\times 2$ 的计数表格，其中 $a_k$ 为暴露病例数，$b_k$ 为暴露对照数，$c_k$ 为非暴露病例数，$d_k$ 为非暴露对照数。观察到的计数如下：\n\n- 第 $1$ 层：$a_1 = 72$，$b_1 = 96$，$c_1 = 48$，$d_1 = 144$。\n- 第 $2$ 层：$a_2 = 48$，$b_2 = 64$，$c_2 = 32$，$d_2 = 96$。\n- 第 $3$ 层：$a_3 = 36$，$b_3 = 48$，$c_3 = 24$，$d_3 = 72$。\n\n假设各层间的层特异性比值比是共同的。使用 Mantel-Haenszel (MH) 方法进行病例对照研究的分层分析，根据这些数据计算共同比值比估计量 $\\hat{\\theta}_{MH}$。将最终数值答案四舍五入至四位有效数字。\n\n然后，基于病例对照抽样和分层分析的基本原理，解释为什么在没有额外信息或假设的情况下，从相同的 $2 \\times 2$ 表格计算出的 Mantel-Haenszel 风险比估计量 $\\hat{R}_{MH}$ 在这种病例对照设计中通常是不可解释的。你的解释应该依据病例对照抽样下哪些参数是可识别的、哪些是不可识别的第一性原理，并且不应引用任何未经证实的简化公式。需要报告的最终答案仅为计算出的 $\\hat{\\theta}_{MH}$ 的值（按指定要求四舍五入）。",
            "solution": "该问题要求计算 Mantel-Haenszel (MH) 共同比值比估计量 $\\hat{\\theta}_{MH}$，该估计量来自一项分层病例对照研究，并解释为什么相应的 MH 风险比估计量在这种情况下是不可解释的。\n\n首先，我们验证问题陈述。\n给定条件如下：\n- 一项具有 $3$ 个分层的分层病例对照研究，层索引为 $k \\in \\{1, 2, 3\\}$。\n- 对于每个层 $k$，数据以 $2 \\times 2$ 表格形式给出：$a_k$（暴露病例），$b_k$（暴露对照），$c_k$（非暴露病例）和 $d_k$（非暴露对照）。\n- 第 $1$ 层的数据：$a_1 = 72$，$b_1 = 96$，$c_1 = 48$，$d_1 = 144$。\n- 第 $2$ 层的数据：$a_2 = 48$，$b_2 = 64$，$c_2 = 32$，$d_2 = 96$。\n- 第 $3$ 层的数据：$a_3 = 36$，$b_3 = 48$，$c_3 = 24$，$d_3 = 72$。\n- 提供了各层间比值比共同的假设。\n- 任务是计算 $\\hat{\\theta}_{MH}$ 并解释 MH 风险比估计量在此实验设计中的不可解释性。\n\n这个问题具有科学依据，因为它涉及生物统计学和流行病学中的一个标准和基本方法。它的提法是适定的，为获得唯一解提供了所有必要的数据和定义。语言客观而精确。数据内部一致，对于此类研究是现实的。因此，该问题是有效的。\n\n我们开始解题。\n\n第 1 部分：计算 Mantel-Haenszel 共同比值比估计量 $\\hat{\\theta}_{MH}$。\n\n跨越 $K$ 个分层的共同比值比 $\\theta$ 的 Mantel-Haenszel 估计量由以下公式给出：\n$$ \\hat{\\theta}_{MH} = \\frac{\\sum_{k=1}^{K} R_k}{\\sum_{k=1}^{K} S_k} = \\frac{\\sum_{k=1}^{K} \\frac{a_k d_k}{N_k}}{\\sum_{k=1}^{K} \\frac{b_k c_k}{N_k}} $$\n其中 $N_k = a_k + b_k + c_k + d_k$ 是第 $k$ 层中的总受试者数。\n\n我们计算 $3$ 个分层中每一层的分量。\n\n对于第 1 层 ($k=1$)：\n- $a_1 = 72$，$b_1 = 96$，$c_1 = 48$，$d_1 = 144$。\n- 总受试者数为 $N_1 = 72 + 96 + 48 + 144 = 360$。\n- 分子分量为 $R_1 = \\frac{a_1 d_1}{N_1} = \\frac{72 \\times 144}{360} = \\frac{10368}{360} = 28.8$。\n- 分母分量为 $S_1 = \\frac{b_1 c_1}{N_1} = \\frac{96 \\times 48}{360} = \\frac{4608}{360} = 12.8$。\n\n对于第 2 层 ($k=2$)：\n- $a_2 = 48$，$b_2 = 64$，$c_2 = 32$，$d_2 = 96$。\n- 总受试者数为 $N_2 = 48 + 64 + 32 + 96 = 240$。\n- 分子分量为 $R_2 = \\frac{a_2 d_2}{N_2} = \\frac{48 \\times 96}{240} = \\frac{4608}{240} = 19.2$。\n- 分母分量为 $S_2 = \\frac{b_2 c_2}{N_2} = \\frac{64 \\times 32}{240} = \\frac{2048}{240} = \\frac{128}{15}$。\n\n对于第 3 层 ($k=3$)：\n- $a_3 = 36$，$b_3 = 48$，$c_3 = 24$，$d_3 = 72$。\n- 总受试者数为 $N_3 = 36 + 48 + 24 + 72 = 180$。\n- 分子分量为 $R_3 = \\frac{a_3 d_3}{N_3} = \\frac{36 \\times 72}{180} = \\frac{2592}{180} = 14.4$。\n- 分母分量为 $S_3 = \\frac{b_3 c_3}{N_3} = \\frac{48 \\times 24}{180} = \\frac{1152}{180} = 6.4$。\n\n现在，我们将所有分层的分量相加：\n$$ \\sum_{k=1}^{3} R_k = R_1 + R_2 + R_3 = 28.8 + 19.2 + 14.4 = 62.4 $$\n$$ \\sum_{k=1}^{3} S_k = S_1 + S_2 + S_3 = 12.8 + \\frac{128}{15} + 6.4 = 19.2 + \\frac{128}{15} = \\frac{19.2 \\times 15 + 128}{15} = \\frac{288 + 128}{15} = \\frac{416}{15} $$\n\n最后，我们计算 Mantel-Haenszel 估计量：\n$$ \\hat{\\theta}_{MH} = \\frac{\\sum R_k}{\\sum S_k} = \\frac{62.4}{\\frac{416}{15}} = \\frac{62.4 \\times 15}{416} = \\frac{936}{416} $$\n化简分数：\n$$ \\hat{\\theta}_{MH} = \\frac{936 \\div 104}{416 \\div 104} = \\frac{9}{4} = 2.25 $$\n问题要求答案四舍五入至四位有效数字。这得到 $2.250$。\n\n该数据集的一个显著特点是层特异性比值比是恒定的：\n$\\hat{OR}_1 = \\frac{a_1 d_1}{b_1 c_1} = \\frac{72 \\times 144}{96 \\times 48} = 2.25$。\n$\\hat{OR}_2 = \\frac{a_2 d_2}{b_2 c_2} = \\frac{48 \\times 96}{64 \\times 32} = 2.25$。\n$\\hat{OR}_3 = \\frac{a_3 d_3}{b_3 c_3} = \\frac{36 \\times 72}{48 \\times 24} = 2.25$。\n当层特异性比值比相同时，MH 估计量等于这个共同值，我们的计算证实了这一点。\n\n第 2 部分：Mantel-Haenszel 风险比 ($\\hat{R}_{MH}$) 在病例对照研究中的不可解释性。\n\n解释依赖于研究设计的基本原理以及哪些参数可以从所得数据中识别出来。\n\n$1$. **病例对照抽样原理**：病例对照研究根据受试者的疾病结局状态（$D$）进行抽样。招募一组患有该疾病的个体（病例组，$D=1$）和另一组未患该疾病的个体（对照组，$D=0$）。然后，研究人员确定两组受试者之前的暴露状态（$E$）。研究中的病例数和对照数由研究设计固定，通常不反映源人群中疾病的患病率。\n\n$2$. **可识别参数与不可识别参数**：\n   - 由于抽样以 $D$ 为条件，病例对照研究允许直接估计给定疾病状态下的暴露概率，$P(E|D)$。在第 $k$ 层内，我们可以通过比例 $\\frac{a_k}{a_k+c_k}$ 估计 $P(E=1|D=1, k)$，通过 $\\frac{b_k}{b_k+d_k}$ 估计 $P(E=1|D=0, k)$。\n   - 这允许计算*暴露比值比*：\n     $$ OR_{\\text{exposure}, k} = \\frac{P(E=1|D=1, k) / P(E=0|D=1, k)}{P(E=1|D=0, k) / P(E=0|D=0, k)} = \\frac{a_k/c_k}{b_k/d_k} = \\frac{a_k d_k}{b_k c_k} $$\n   - 比值比的一个关键特性是其对研究设计的不变性。暴露比值比在数学上等同于在队列研究中估计的*疾病比值比*：\n     $$ OR_{\\text{disease}, k} = \\frac{P(D=1|E=1, k) / P(D=0|E=1, k)}{P(D=1|E=0, k) / P(D=0|E=0, k)} $$\n   - 因此，比值比在病例对照研究中是一个可识别的参数。\n\n$3$. **风险和风险比的问题**：\n   - 疾病*风险*是条件概率 $P(D|E)$。具体来说，暴露组的风险是 $P(D=1|E=1)$，非暴露组的风险是 $P(D=1|E=0)$。\n   - *风险比*（$RR$）是这些风险的比率：$RR = \\frac{P(D=1|E=1)}{P(D=1|E=0)}$。\n   - 为了估计风险，需要根据暴露状态（$E$）进行抽样，就像在队列研究中所做的那样。在队列研究中，比例 $\\frac{a_k}{a_k+b_k}$ 和 $\\frac{c_k}{c_k+d_k}$ 分别是第 $k$ 层内暴露组和非暴露组风险的有效估计。\n   - 然而，在病例对照研究中，数量 $a_k+b_k$（样本中的总暴露受试者）和 $c_k+d_k$（样本中的总非暴露受试者）并不代表源人群中所有暴露和非暴露个体的随机样本。这些总数中的病例数（$a_k$，$c_k$）和对照数（$b_k$，$d_k$）是研究者选择的抽样比的人为结果。\n   - 因此，从病例对照数据计算出的数量 $\\frac{a_k}{a_k+b_k}$ 和 $\\frac{c_k}{c_k+d_k}$ 并不能估计真实的人群风险。它们不能被解释为 $P(D=1|E=1, k)$ 和 $P(D=1|E=0, k)$。\n\n$4$. **$\\hat{R}_{MH}$ 公式的无效性**：Mantel-Haenszel 风险比估计量的公式为：\n   $$ \\hat{R}_{MH} = \\frac{\\sum_{k=1}^{K} \\frac{a_k (c_k+d_k)}{N_k}}{\\sum_{k=1}^{K} \\frac{c_k (a_k+b_k)}{N_k}} $$\n   该公式是层特异性风险比的加权平均，由用于估计队列研究中风险的项构成。由于从病例对照数据中无法识别估计层特异性风险所需的分量，将此公式应用于此类数据会产生一个缺乏预期流行病学解释的数值。它并不估计真实的共同风险比。只有在附加假设（例如，罕见病假设，此时 $OR \\approx RR$）或外部信息（例如，人群疾病患病率）下，才能从病例对照数据中获得风险比的估计，而问题陈述中并未提供这些条件。",
            "answer": "$$\\boxed{2.250}$$"
        }
    ]
}