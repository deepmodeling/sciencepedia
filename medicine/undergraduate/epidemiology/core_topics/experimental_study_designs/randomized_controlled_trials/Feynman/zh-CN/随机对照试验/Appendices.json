{
    "hands_on_practices": [
        {
            "introduction": "理论是基石，但实践才是试金石。要设计一项严谨的随机对照试验（RCT），首要任务是确定需要多少参与者。样本量估算不仅是一个数学练习，更是研究伦理和效率的核心：样本太少，研究可能无法检测到真实效应，浪费资源；样本太多，则会让不必要的参与者暴露于潜在风险中。这个练习将引导你从第一性原理出发，推导出样本量计算公式，让你深入理解统计功效（power）、效应大小（effect size）和样本量之间的内在联系。",
            "id": "4628034",
            "problem": "考虑一项双臂随机对照试验，干预组和对照组按等量分配，在稳定条件下，于一个共同的随访时间点为每位参与者评估一次二元结局。设 $p_0$ 表示对照组的真实事件概率，$p_1$ 表示干预组的真实事件概率。目标效应为风险差 $\\Delta = p_1 - p_0$，并假设设计的目的是检验原假设 $H_0: p_1 - p_0 = 0$ 与双侧备择假设 $H_1: p_1 - p_0 \\neq 0$。该检验的I类错误率为 $\\,\\alpha\\,$，并能在风险差为预先设定的非零值 $\\,\\Delta\\,$ 时达到 $\\,1 - \\beta\\,$ 的检验效能。\n\n使用以下基本依据：\n- 在独立抽样下，根据中心极限定理，对于每组 $n$ 名参与者，组 $a \\in \\{0,1\\}$ 中的样本比例 $\\hat{p}_a$ 的大样本分布为 $\\hat{p}_a \\approx \\mathcal{N}\\!\\left(p_a,\\, p_a(1 - p_a)/n\\right)$，并且在等量分配下两组是独立的。\n- 根据独立性，样本比例之差 $D = \\hat{p}_1 - \\hat{p}_0$ 近似服从正态分布，其均值为 $p_1 - p_0$，方差为 $p_1(1 - p_1)/n + p_0(1 - p_0)/n$。\n- 对于 $H_0$ 的双侧 $\\alpha$ 水平检验，使用标准正态分位数函数 $\\Phi^{-1}(\\cdot)$ 和一个设计阶段的原假设方差来设定拒绝阈值。设设计阶段的合并计划值为 $p_{\\ast} = (p_0 + p_1)/2$，则 $D$ 在原假设下的标准差为 $\\sqrt{2\\,p_{\\ast}(1 - p_{\\ast})/n}$。\n\n从这些基本依据出发，不引用任何预先记忆的样本量公式，推导在等量分配下，为检测风险差 $\\Delta$ 时确保I类错误率为 $\\,\\alpha\\,$ 且检验效能为 $\\,1 - \\beta\\,$ 所需的每组样本量 $n$ 的闭式解析表达式（不要求为整数，忽略任何取整）。最终答案必须表示为关于 $p_0$、$p_1$、$\\alpha$、$\\beta$、$\\Delta$ 和标准正态分位数函数 $\\Phi^{-1}(\\cdot)$ 的单一解析表达式。可以假设 $\\Delta \\neq 0$。无需进行数值计算，也无需取整。答案必须是每组的样本量。",
            "solution": "该问题陈述是生物统计学领域中一个有效且定义明确的问题，具体涉及随机对照试验的设计。它提供了一套完整且一致的给定条件和假设，可以从中推导出唯一的解析解。\n\n### 步骤 1：提取给定条件\n-   **研究设计**：双臂随机对照试验，等量分配（每组 $n$ 名参与者）。\n-   **结局**：二元结局。\n-   **参数**：$p_0$ 是对照组的真实事件概率；$p_1$ 是干预组的真实事件概率。\n-   **效应指标**：风险差，$\\Delta = p_1 - p_0$。\n-   **假设**：原假设 $H_0: p_1 - p_0 = 0$；备择假设 $H_1: p_1 - p_0 \\neq 0$。\n-   **错误率**：I类错误率为 $\\alpha$；II类错误率为 $\\beta$，对应检验效能为 $1 - \\beta$。\n-   **分布假设**：\n    1.  组 $a \\in \\{0,1\\}$ 中的样本比例，记为 $\\hat{p}_a$，近似服从正态分布：$\\hat{p}_a \\sim \\mathcal{N}(p_a, \\frac{p_a(1-p_a)}{n})$。\n    2.  样本比例之差 $D = \\hat{p}_1 - \\hat{p}_0$ 近似服从正态分布：$D \\sim \\mathcal{N}(p_1 - p_0, \\frac{p_1(1-p_1)}{n} + \\frac{p_0(1-p_0)}{n})$。\n-   **检验的构建**：\n    1.  检验使用标准正态分位数函数 $\\Phi^{-1}(\\cdot)$。\n    2.  在设计阶段，$D$ 的原假设方差基于计划值 $p_{\\ast} = (p_0 + p_1)/2$ 构建，得出 $D$ 在 $H_0$ 下的标准差为 $\\sqrt{2 p_{\\ast}(1-p_{\\ast})/n}$。\n\n### 步骤 2：使用提取的给定条件进行验证\n-   **科学依据充分**：该问题基于比较两个比例的成熟统计理论，即使用二项分布的正态近似法，这是设计临床试验的一个基本概念。\n-   **定义明确**：该问题定义清晰，提供了推导所需样本量 $n$ 的所有必要参数（$\\alpha, \\beta, p_0, p_1$）和分布基础。指令明确，可导向一个唯一解。\n-   **客观性**：其语言严谨、精确，没有任何主观性或模糊性。\n\n该问题有效，因为它满足了一个形式完备的科学问题的所有标准。\n\n### 样本量公式的推导\n\n目标是推导满足指定的I类和II类错误约束的每组样本量 $n$ 的表达式。推导从给定的基本原理出发。\n\n**1. I类错误与拒绝法则**\n\n原假设为 $H_0: \\Delta = p_1 - p_0 = 0$。检验统计量是观察到的比例差 $D = \\hat{p}_1 - \\hat{p}_0$。\n\n根据问题陈述，为了试验设计的目的，$D$ 在 $H_0$ 下的分布被视为近似正态分布，其均值为 $0$，方差为 $\\text{Var}_0(D)$，该方差使用计划值 $p_{\\ast} = (p_0 + p_1)/2$ 构建。\n$$ \\text{Var}_0(D) = \\frac{2 p_{\\ast}(1 - p_{\\ast})}{n} = \\frac{2 \\left(\\frac{p_0+p_1}{2}\\right) \\left(1 - \\frac{p_0+p_1}{2}\\right)}{n} $$\n对于I类错误率为 $\\alpha$ 的双侧检验，如果观察到的差值 $|D|$ 大于一个临界值 $C$，我们就拒绝 $H_0$。这个临界值由原假设分布的尾部决定。$H_0$ 下的标准化统计量为 $Z = D / \\sqrt{\\text{Var}_0(D)}$。如果 $|Z| > \\Phi^{-1}(1 - \\alpha/2)$，我们就拒绝原假设。\n这意味着对于未标准化的差值 $D$，其拒绝域为 $|D| > C$，其中：\n$$ C = \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right) \\sqrt{\\text{Var}_0(D)} = \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right) \\sqrt{\\frac{2 p_{\\ast}(1 - p_{\\ast})}{n}} $$\n\n**2. II类错误与检验效能**\n\n检验效能是在备择假设 $H_1$ 为真时正确拒绝 $H_0$ 的概率。在 $H_1$ 下，真实差值为 $\\Delta = p_1 - p_0 \\neq 0$。\n\n$D$ 在 $H_1$ 下的分布近似为正态分布，均值为 $\\Delta$，方差为 $\\text{Var}_1(D)$：\n$$ D \\sim \\mathcal{N}\\left(\\Delta, \\text{Var}_1(D)\\right) \\quad \\text{其中} \\quad \\text{Var}_1(D) = \\frac{p_1(1-p_1)}{n} + \\frac{p_0(1-p_0)}{n} $$\n检验效能 $1 - \\beta$ 是 $D$ 落入拒绝域的概率，即 $P(|D| > C | H_1)$。\n$$ 1 - \\beta = P(D > C | H_1) + P(D  -C | H_1) $$\n假设 $\\Delta  0$（$\\Delta  0$ 的情况是对称的），对于一个检验效能充分的研究，项 $P(D  -C | H_1)$ 通常可以忽略不计，因为 $D$ 的分布中心远离 $-C$。因此，我们可以用第一项来近似检验效能：\n$$ 1 - \\beta \\approx P(D  C | H_1) $$\n为了计算这个概率，我们使用 $D$ 在 $H_1$ 下的分布对其进行标准化：\n$$ 1 - \\beta \\approx P\\left( \\frac{D - \\Delta}{\\sqrt{\\text{Var}_1(D)}}  \\frac{C - \\Delta}{\\sqrt{\\text{Var}_1(D)}} \\right) $$\n概率括号内左侧的项是一个标准正态变量 $Z \\sim \\mathcal{N}(0,1)$。\n$$ P\\left( Z  \\frac{C - \\Delta}{\\sqrt{\\text{Var}_1(D)}} \\right) = 1 - \\beta $$\n根据标准正态累积分布函数 $\\Phi$ 的定义，这意味着：\n$$ \\frac{C - \\Delta}{\\sqrt{\\text{Var}_1(D)}} = \\Phi^{-1}(1 - (1-\\beta)) = \\Phi^{-1}(\\beta) $$\n解出临界值 $C$，我们得到其第二个表达式，这次是根据检验效能的要求得出的：\n$$ C = \\Delta + \\Phi^{-1}(\\beta) \\sqrt{\\text{Var}_1(D)} $$\n\n**3. 求解样本量 n**\n\n现在我们有两个关于临界值 $C$ 的表达式，一个来自I类错误约束，另一个来自检验效能约束。令它们相等，我们就可以解出 $n$。\n$$ \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right) \\sqrt{\\text{Var}_0(D)} = \\Delta + \\Phi^{-1}(\\beta) \\sqrt{\\text{Var}_1(D)} $$\n代入方差的表达式，两者都与 $1/\\sqrt{n}$ 相关：\n$$ \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right) \\frac{\\sqrt{2 p_{\\ast}(1 - p_{\\ast})}}{\\sqrt{n}} = \\Delta + \\Phi^{-1}(\\beta) \\frac{\\sqrt{p_1(1-p_1) + p_0(1-p_0)}}{\\sqrt{n}} $$\n整理方程以分离出 $\\Delta$：\n$$ \\Delta = \\frac{1}{\\sqrt{n}} \\left[ \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right) \\sqrt{2 p_{\\ast}(1 - p_{\\ast})} - \\Phi^{-1}(\\beta) \\sqrt{p_1(1-p_1) + p_0(1-p_0)} \\right] $$\n使用标准正态分位数函数的对称性，$\\Phi^{-1}(\\beta) = -\\Phi^{-1}(1-\\beta)$：\n$$ \\Delta = \\frac{1}{\\sqrt{n}} \\left[ \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right) \\sqrt{2 p_{\\ast}(1 - p_{\\ast})} + \\Phi^{-1}(1-\\beta) \\sqrt{p_1(1-p_1) + p_0(1-p_0)} \\right] $$\n现在，我们解出 $\\sqrt{n}$，然后将结果平方以求得 $n$：\n$$ \\sqrt{n} = \\frac{\\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right) \\sqrt{2 p_{\\ast}(1 - p_{\\ast})} + \\Phi^{-1}(1-\\beta) \\sqrt{p_1(1-p_1) + p_0(1-p_0)}}{\\Delta} $$\n$$ n = \\left( \\frac{\\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right) \\sqrt{2 p_{\\ast}(1 - p_{\\ast})} + \\Phi^{-1}(1-\\beta) \\sqrt{p_1(1-p_1) + p_0(1-p_0)}}{\\Delta} \\right)^2 $$\n代入 $p_{\\ast} = (p_0+p_1)/2$ 的定义，并将表达式写成一个单一的分数形式，即可得到每组样本量 $n$ 的最终闭式表达式。\n$$ n = \\frac{\\left( \\Phi^{-1}\\left(1 - \\frac{\\alpha}{2}\\right) \\sqrt{2 \\left(\\frac{p_0+p_1}{2}\\right)\\left(1 - \\frac{p_0+p_1}{2}\\right)} + \\Phi^{-1}(1-\\beta) \\sqrt{p_0(1-p_0) + p_1(1-p_1)} \\right)^2}{\\Delta^2} $$\n该表达式提供了每组所需样本量，它是指定参数 $p_0$、$p_1$、$\\alpha$、$\\beta$ 以及风险差 $\\Delta = p_1-p_0$ 的函数。",
            "answer": "$$ \\boxed{ \\frac{\\left( \\Phi^{-1}\\left(1-\\frac{\\alpha}{2}\\right) \\sqrt{2 \\left(\\frac{p_0+p_1}{2}\\right) \\left(1 - \\frac{p_0+p_1}{2}\\right)} + \\Phi^{-1}(1-\\beta) \\sqrt{p_0(1-p_0) + p_1(1-p_1)} \\right)^{2}}{\\Delta^{2}} } $$"
        },
        {
            "introduction": "试验数据收集完毕后，我们的核心任务是量化干预措施的效果。对于二元结局（如事件发生/未发生），我们通常使用风险差异（Risk Difference, RD）、风险比（Risk Ratio, RR）和比值比（Odds Ratio, OR）来衡量效应大小。这个练习将让你亲手计算这些关键指标，并探讨一个更深层次的概念——“可折叠性”（collapsibility），帮助你理解为什么在不同情况下选择不同的效应度量，以及它们在分层分析中的表现。",
            "id": "4628160",
            "problem": "一项随机对照试验（RCT）评估了一种旨在减少二元结局的预防性干预措施。在随机分配到干预组的 $1000$ 名参与者中，有 $100$ 人出现了该结局。在随机分配到对照组的 $1000$ 名参与者中，有 $150$ 人出现了该结局。从流行病学的第一性原理出发，利用概率、比值和随机化所带来的独立性的核心定义，从观测数据中推导并计算以下人群效应度量：风险差、风险比和比值比。然后，根据可合并性（在随机化和无效应修正的条件下，边际效应等于共同的层特异性效应）的定义进行推理，以确定在这三种度量中，哪些在随机分配且无未测量混杂因素的背景下是可合并的。将最终答案表示为一个行矩阵，顺序为 $[\\text{风险差}, \\text{风险比}, \\text{比值比}, I_{\\text{RD}}, I_{\\text{RR}}, I_{\\text{OR}}]$，其中 $I_{\\text{RD}}$, $I_{\\text{RR}}$ 和 $I_{\\text{OR}}$ 是指示变量，如果该度量是可合并的，则取值为 $1$，否则为 $0$。如果可能，请以精确分数形式提供风险差、风险比和比值比；如果选择提供小数近似值，请四舍五入到 $4$ 位有效数字。不涉及物理单位；所有量均以无量纲数报告。",
            "solution": "该问题是有效的，因为它在科学上基于流行病学和生物统计学的原理，问题陈述清晰，信息充分且一致，并且表述客观。\n\n设 $X$ 表示处理分配，其中 $X=1$ 代表干预组，$X=0$ 代表对照组。设 $Y$ 表示二元结局，其中 $Y=1$ 表示结局发生，$Y=0$ 表示结局未发生。该问题提供了一项随机对照试验（RCT）的以下数据：\n对于干预组（$X=1$）：\n- 参与者人数：$N_1 = 1000$\n- 出现结局的人数：$A_1 = 100$\n- 未出现结局的人数：$B_1 = N_1 - A_1 = 1000 - 100 = 900$\n\n对于对照组（$X=0$）：\n- 参与者人数：$N_0 = 1000$\n- 出现结局的人数：$A_0 = 150$\n- 未出现结局的人数：$B_0 = N_0 - A_0 = 1000 - 150 = 850$\n\n任务是推导并计算三种效应度量（风险差、风险比、比值比）并确定它们的可合并性属性。\n\n首先，我们定义各组中结局的风险（概率）。风险是在给定处理分配下结局发生的条件概率，即 $P(Y=1|X=x)$。在RCT中，这些概率可以直接从各组的观测比例中估计。\n\n干预组的风险估计为：\n$$ \\hat{R}_1 = \\frac{A_1}{N_1} = \\frac{100}{1000} = \\frac{1}{10} $$\n对照组的风险估计为：\n$$ \\hat{R}_0 = \\frac{A_0}{N_0} = \\frac{150}{1000} = \\frac{15}{100} = \\frac{3}{20} $$\n\n**第1部分：效应度量的计算**\n\n1.  **风险差 (RD)**：风险差是两组风险的算术差。\n    $$ RD = R_1 - R_0 $$\n    使用样本估计值：\n    $$ \\hat{RD} = \\hat{R}_1 - \\hat{R}_0 = \\frac{1}{10} - \\frac{3}{20} = \\frac{2}{20} - \\frac{3}{20} = -\\frac{1}{20} $$\n\n2.  **风险比 (RR)**：风险比是两组风险的比率。\n    $$ RR = \\frac{R_1}{R_0} $$\n    使用样本估计值：\n    $$ \\hat{RR} = \\frac{\\hat{R}_1}{\\hat{R}_0} = \\frac{1/10}{3/20} = \\frac{1}{10} \\times \\frac{20}{3} = \\frac{20}{30} = \\frac{2}{3} $$\n\n3.  **比值比 (OR)**：首先，我们将结局的比值定义为结局发生的概率与不发生的概率之比。\n    $$ \\text{Odds}(x) = \\frac{P(Y=1|X=x)}{P(Y=0|X=x)} = \\frac{R_x}{1-R_x} $$\n    比值比是干预组的比值与对照组的比值之比。\n    $$ OR = \\frac{\\text{Odds}(1)}{\\text{Odds}(0)} = \\frac{R_1 / (1-R_1)}{R_0 / (1-R_0)} $$\n    样本比值为：\n    $$ \\hat{\\text{Odds}}_1 = \\frac{\\hat{R}_1}{1-\\hat{R}_1} = \\frac{1/10}{1 - 1/10} = \\frac{1/10}{9/10} = \\frac{1}{9} $$\n    $$ \\hat{\\text{Odds}}_0 = \\frac{\\hat{R}_0}{1-\\hat{R}_0} = \\frac{3/20}{1 - 3/20} = \\frac{3/20}{17/20} = \\frac{3}{17} $$\n    样本比值比为：\n    $$ \\hat{OR} = \\frac{\\hat{\\text{Odds}}_1}{\\hat{\\text{Odds}}_0} = \\frac{1/9}{3/17} = \\frac{1}{9} \\times \\frac{17}{3} = \\frac{17}{27} $$\n    或者，比值比可以从 $2 \\times 2$ 列联表中通过交叉乘积比计算：\n    $$ \\hat{OR} = \\frac{A_1 B_0}{A_0 B_1} = \\frac{100 \\times 850}{150 \\times 900} = \\frac{85000}{135000} = \\frac{85}{135} = \\frac{17}{27} $$\n\n**第2部分：可合并性分析**\n\n可合并性指的是，在各分层间不存在效应修正的情况下，边际（粗略）效应度量等于共同的层特异性效应度量的性质。分层是通过第三个变量，例如 $Z$ 来完成的。问题明确了“随机分配且无未测量混杂因素”和“无效应修正”的背景。\n\n设 $Z$ 是一个基线协变量（例如，年龄、性别），其水平为 $k=1, 2, \\dots, K$。\n$x$ 组的边际风险是 $R_x = P(Y=1|X=x)$。根据全概率定律，我们可以在 $Z$ 的各层上展开此式：\n$$ R_x = \\sum_{k=1}^{K} P(Y=1|X=x, Z=k) P(Z=k|X=x) $$\n设 $R_{xk} = P(Y=1|X=x, Z=k)$ 为层特异性风险。\n在RCT中，随机化确保了处理分配 $X$ 与任何基线协变量 $Z$ 在统计上是独立的。因此，对于所有 $x$，$P(Z=k|X=x) = P(Z=k)$。设 $p_k = P(Z=k)$。\n边际风险是层特异性风险的加权平均值：\n$$ R_1 = \\sum_{k} R_{1k} p_k $$\n$$ R_0 = \\sum_{k} R_{0k} p_k $$\n“无效应修正”条件意味着效应度量在 $Z$ 的各层中是恒定的。\n\n- **风险差 (RD)**：\n  边际RD是 $RD = R_1 - R_0$。层特异性RD是 $RD_k = R_{1k} - R_{0k}$。\n  “无效应修正”条件意味着对所有 $k$ 都有 $RD_k = RD_{\\text{common}}$。\n  $$ RD = R_1 - R_0 = \\sum_{k} R_{1k} p_k - \\sum_{k} R_{0k} p_k = \\sum_{k} (R_{1k} - R_{0k}) p_k = \\sum_{k} RD_k p_k $$\n  代入 $RD_k = RD_{\\text{common}}$：\n  $$ RD = \\sum_{k} RD_{\\text{common}} p_k = RD_{\\text{common}} \\sum_{k} p_k = RD_{\\text{common}} \\times 1 = RD_{\\text{common}} $$\n  边际RD等于共同的层特异性RD。因此，风险差是可合并的。$I_{\\text{RD}} = 1$。\n\n- **风险比 (RR)**：\n  边际RR是 $RR = R_1 / R_0$。层特异性RR是 $RR_k = R_{1k} / R_{0k}$。\n  “无效应修正”条件意味着对所有 $k$ 都有 $RR_k = RR_{\\text{common}}$，所以 $R_{1k} = RR_{\\text{common}} \\times R_{0k}$。\n  $$ RR = \\frac{R_1}{R_0} = \\frac{\\sum_{k} R_{1k} p_k}{\\sum_{k} R_{0k} p_k} $$\n  代入 $R_{1k} = RR_{\\text{common}} R_{0k}}$：\n  $$ RR = \\frac{\\sum_{k} (RR_{\\text{common}} R_{0k}) p_k}{\\sum_{k} R_{0k} p_k} = \\frac{RR_{\\text{common}} \\sum_{k} R_{0k} p_k}{\\sum_{k} R_{0k} p_k} = RR_{\\text{common}} $$\n  边际RR等于共同的层特异性RR。因此，风险比是可合并的。$I_{\\text{RR}} = 1$。\n\n- **比值比 (OR)**：\n  边际OR是 $OR = \\frac{R_1/(1-R_1)}{R_0/(1-R_0)}$。层特异性OR是 $OR_k = \\frac{R_{1k}/(1-R_{1k})}{R_{0k}/(1-R_{0k})}$。\n  “无效应修正”条件意味着对所有 $k$ 都有 $OR_k = OR_{\\text{common}}$。\n  比值函数 $f(p) = p/(1-p)$，当 $p \\in (0, 0.5)$ 时是非线性凸函数，当 $p \\in (0.5, 1)$ 时是凹函数。由于这种非线性，风险的加权平均值不能简单地转换成比值的形式。边际比值为：\n  $$ \\text{Odds}_1 = \\frac{\\sum_k R_{1k}p_k}{1 - \\sum_k R_{1k}p_k} \\quad \\text{和} \\quad \\text{Odds}_0 = \\frac{\\sum_k R_{0k}p_k}{1 - \\sum_k R_{0k}p_k} $$\n  根据 Jensen不等式，对于一个非线性函数 $f$，$f(E[X]) \\neq E[f(X)]$。在这里，边际风险 $R_x$ 是层特异性风险 $R_{xk}$ 在 $Z$ 分布上的期望。因此，边际比值 $\\text{Odds}_x = f(R_x) = f(E[R_{xk}])$ 不等于层特异性比值的加权平均值 $E[f(R_{xk})] = \\sum_k f(R_{xk}) p_k$。\n  因此，边际比值比 $OR = \\text{Odds}_1 / \\text{Odds}_0$ 通常不等于共同的层特异性比值比 $OR_{\\text{common}}$，除非 $Z$ 不是结局的风险因素（即 $R_{0k}$ 在 $k$ 上是常数）或处理没有效果（$OR_{\\text{common}}=1$）。由于这些例外情况通常不成立，所以比值比是不可合并的。$I_{\\text{OR}} = 0$。\n\n综合结果，最终值为：\n- 风险差：$-\\frac{1}{20}$\n- 风险比：$\\frac{2}{3}$\n- 比值比：$\\frac{17}{27}$\n- $I_{\\text{RD}} = 1$ (可合并)\n- $I_{\\text{RR}} = 1$ (可合并)\n- $I_{\\text{OR}} = 0$ (不可合并)\n\n最终答案将表示为一个行矩阵。\n$$\n\\begin{pmatrix}\n-\\frac{1}{20}  \\frac{2}{3}  \\frac{17}{27}  1  1  0\n\\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\n\\left[ -\\frac{1}{20}, \\frac{2}{3}, \\frac{17}{27}, 1, 1, 0 \\right]\n}\n$$"
        },
        {
            "introduction": "在理想世界中，所有参与者都会严格遵守分配给他们的干预方案，但这在现实中很少发生。当部分参与者未遵循医嘱（即“不依从”现象）时，我们如何评估干预措施的“真实”效果？本练习将引入一个精妙的工具——工具变量法，来估计“依从者平均因果效应”（Complier Average Causal Effect, CACE）。通过将随机分配本身作为工具，你可以估算出对于那些实际接受了干预的个体，干预措施所产生的效果，从而超越标准的“意向性治疗”（Intention-to-Treat, ITT）分析，获得更深入的因果洞察。",
            "id": "4568066",
            "problem": "考虑一项预防医学领域的随机对照试验 (RCT)，该试验评估一项二元预防性干预措施，例如跌倒预防计划。\n\n设随机分配由 $Z \\in \\{0,1\\}$ 表示，其中 $Z=1$ 表示被分配接受预防计划，而 $Z=0$ 表示对照组。设计划的实际接受情况由 $D \\in \\{0,1\\}$ 表示，其中 $D=1$ 表示接受，而 $D=0$ 表示未接受。设主要结局为不良事件（例如，$12$ 个月内的任何跌倒）发生的二元指标 $Y \\in \\{0,1\\}$。\n\n对于 $z \\in \\{0,1\\}$，定义潜在接受情况 $D(z)$；对于 $d \\in \\{0,1\\}$，定义潜在结局 $Y(d)$。假设稳定单位处理值假设 (SUTVA) 成立，因此观测到的接受情况为 $D = D(Z)$，观测到的结局为 $Y = Y(D)$。\n\n从潜在结局的核心定义和 RCT 中随机分配所保证的属性出发，请从第一性原理推导依从者平均因果效应 (CACE) 的 Wald 估计量。CACE 定义为依从者中接受干预对结局的平均因果效应。请用给定 $Z$ 时 $Y$ 和 $D$ 的可观测条件期望来表示你的最终估计量。在推导过程中，请使用潜在结局的语言，正式陈述在该情境下进行识别所需的单调性假设和排他性限制假设。\n\n你的最终答案必须是单一的闭式解析表达式。不要提供数值。无需四舍五入，也无需在最终答案中报告单位。",
            "solution": "本题要求在一个具有二元处理、二元接受度和二元结局的随机对照试验 (RCT) 背景下，从第一性原理出发，推导依从者平均因果效应 (CACE) 的 Wald 估计量。\n\n首先，我们使用给定的定义和潜在结局模型来建立理论框架。处理分配为 $Z \\in \\{0, 1\\}$，处理的接受情况为 $D \\in \\{0, 1\\}$，结局为 $Y \\in \\{0, 1\\}$。给定对于分配 $z \\in \\{0, 1\\}$ 的潜在接受情况 $D(z)$ 和对于接受情况 $d \\in \\{0, 1\\}$ 的潜在结局 $Y(d)$。假设稳定单位处理值假设 (SUTVA) 成立，这意味着单位之间没有干扰且存在一致性，因此观测到的接受情况为 $D = D(Z)$，观测到的结局为 $Y = Y(D)$。\n\n目标量是 CACE，即“依从者”亚群中处理对结局的平均因果效应。为了定义依从者，我们首先根据其潜在接受行为将人群分为四个主分层，由数对 $(D(0), D(1))$ 表示：\n1.  **依从者** (Compliers)：对于这些个体，$(D(0), D(1)) = (0, 1)$。他们当且仅当被分配到处理组时才接受处理。\n2.  **始终接受者** (Always-Takers)：对于这些个体，$(D(0), D(1)) = (1, 1)$。无论分配如何，他们都接受处理。\n3.  **从不接受者** (Never-Takers)：对于这些个体，$(D(0), D(1)) = (0, 0)$。无论分配如何，他们都从不接受处理。\n4.  **违逆者** (Defiers)：对于这些个体，$(D(0), D(1)) = (1, 0)$。他们当且仅当被分配到对照组时才接受处理。\n\nCACE 正式定义为依从者组的平均处理效应：\n$$\n\\text{CACE} \\equiv E[Y(1) - Y(0) | D(1)=1, D(0)=0]\n$$\n这个量是无法直接观测的，因为我们永远无法对同一个体同时观测到 $Y(1)$ 和 $Y(0)$，也无法直接从数据中识别出依从者群体，因为对每个人我们只能观测到 $D(1)$ 或 $D(0)$ 中的一个。\n\n为了从可观测数据中识别 CACE，我们必须援引几个关键假设。\n\n**识别所需的假设：**\n\n1.  **随机分配（独立性）**：作为 RCT 的一个核心属性，处理分配 $Z$ 在统计上独立于所有潜在结局和潜在接受情况。正式地：\n    $$\n    Z \\perp (Y(1), Y(0), D(1), D(0))\n    $$\n2.  **排他性限制**：分配 $Z$ 仅通过其对接受情况 $D$ 的影响来影响结局 $Y$。问题陈述通过将潜在结局定义为仅是接受情况的函数 $Y(d)$ 来暗示这一点。一个更基本的定义是 $Y(z, d)$，即在分配为 $z$ 和接受情况为 $d$ 下的潜在结局。排他性限制假设指出，对于所有的 $z, d$，都有 $Y(z, d) = Y(d)$。这意味着工具变量 $Z$ 对结局 $Y$ 没有绕过处理 $D$ 的直接因果效应。\n3.  **单调性**：人群中没有违逆者。这意味着对于任何个体，被提供处理不会使其更不可能接受处理。正式地，对于人群中的每个个体：\n    $$\n    D(1) \\ge D(0)\n    $$\n4.  **相关性/Z对D的非零效应**：处理分配必须对处理的实际平均接受情况产生影响。这意味着 $E[D|Z=1] \\neq E[D|Z=0]$。\n\n在这些假设下，我们可以进行推导。Wald 估计量是意向性治疗 (ITT) 对结局 $Y$ 的效应与 ITT 对接受情况 $D$ 的效应之比。\n\n**分子：ITT 对结局 (Y) 的效应**\n\nITT 对结局的效应是处理组和对照组之间平均结局的差异：$E[Y|Z=1] - E[Y|Z=0]$。\n\n使用 SUTVA，有 $Y = Y(D) = Y(D(Z))$。所以，$E[Y|Z=1] = E[Y(D(1))|Z=1]$。根据随机分配假设，这等于 $E[Y(D(1))]$。类似地，$E[Y|Z=0] = E[Y(D(0))|Z=0]$，这等于 $E[Y(D(0))]$。\n\n因此，ITT 效应为 $E[Y(D(1))] - E[Y(D(0))]$。我们可以通过对主分层（依从类型）进行条件化来展开这个表达式。设 $\\pi_c, \\pi_a, \\pi_n, \\pi_d$ 分别为依从者、始终接受者、从不接受者和违逆者的人群比例。\n\n$E[Y(D(1))]$ 对于依从者和始终接受者来说是 $E[Y(1)]$（因为 $D(1)=1$），对于从不接受者和违逆者来说是 $E[Y(0)]$（因为 $D(1)=0$）。\n$$\nE[Y(D(1))] = E[Y(1)|D(1)=1, D(0)=0]\\pi_c + E[Y(1)|D(1)=1, D(0)=1]\\pi_a + E[Y(0)|D(1)=0, D(0)=0]\\pi_n + E[Y(0)|D(1)=0, D(0)=1]\\pi_d\n$$\n$E[Y(D(0))]$ 对于依从者和从不接受者来说是 $E[Y(0)]$（因为 $D(0)=0$），对于始终接受者和违逆者来说是 $E[Y(1)]$（因为 $D(0)=1$）。\n$$\nE[Y(D(0))] = E[Y(0)|D(1)=1, D(0)=0]\\pi_c + E[Y(1)|D(1)=1, D(0)=1]\\pi_a + E[Y(0)|D(1)=0, D(0)=0]\\pi_n + E[Y(1)|D(1)=0, D(0)=1]\\pi_d\n$$\n从第一个表达式中减去第二个表达式，始终接受者和从不接受者的项会抵消掉：\n$$\nE[Y|Z=1] - E[Y|Z=0] = \\pi_c (E[Y(1)|C] - E[Y(0)|C]) + \\pi_d (E[Y(0)|D] - E[Y(1)|D])\n$$\n其中 $C$ 和 $D$ 分别表示依从者和违逆者群体。这可以简化为：\n$$\nE[Y|Z=1] - E[Y|Z=0] = \\pi_c \\text{CACE} - \\pi_d E[Y(1) - Y(0)|D]\n$$\n现在，我们应用**单调性假设**，该假设假定 $\\pi_d = 0$。这就消除了涉及违逆者的项。\n$$\nE[Y|Z=1] - E[Y|Z=0] = \\pi_c \\cdot \\text{CACE}\n$$\n\n**分母：ITT 对接受情况 (D) 的效应**\n\nITT 对接受情况的效应是处理组和对照组之间平均接受情况的差异：$E[D|Z=1] - E[D|Z=0]$。\n\n使用 SUTVA，有 $D=D(Z)$。$E[D|Z=1] = E[D(1)|Z=1]$。根据随机分配，这等于 $E[D(1)]$。$E[D|Z=0] = E[D(0)|Z=0]$。根据随机分配，这等于 $E[D(0)]$。所以分母是 $E[D(1)] - E[D(0)]$。\n由于 $D$ 是一个二元变量，所以 $E[D(z)] = P(D(z)=1)$。\n$P(D(1)=1)$ 是指如果被分配到处理组就会接受处理的人群比例。这些人是依从者和始终接受者。因此，$E[D(1)] = \\pi_c + \\pi_a$。\n$P(D(0)=1)$ 是指如果被分配到对照组就会接受处理的人群比例。这些人是始终接受者和违逆者。因此，$E[D(0)] = \\pi_a + \\pi_d$。\n\n差值为：\n$$\nE[D|Z=1] - E[D|Z=0] = (\\pi_c + \\pi_a) - (\\pi_a + \\pi_d) = \\pi_c - \\pi_d\n$$\n应用**单调性假设** ($\\pi_d = 0$)，分母简化为依从者的比例：\n$$\nE[D|Z=1] - E[D|Z=0] = \\pi_c\n$$\n相关性假设确保这个分母不为零，即 $\\pi_c  0$。\n\n**结合分子和分母**\n\n我们现在有了两个必要的部分：\n1.  分子：$E[Y|Z=1] - E[Y|Z=0] = \\pi_c \\cdot \\text{CACE}$\n2.  分母：$E[D|Z=1] - E[D|Z=0] = \\pi_c$\n\n将第一项除以第二项得到 CACE：\n$$\n\\text{CACE} = \\frac{\\pi_c \\cdot \\text{CACE}}{\\pi_c} = \\frac{E[Y|Z=1] - E[Y|Z=0]}{E[D|Z=1] - E[D|Z=0]}\n$$\n这个表达式就是 Wald 估计量。它完全用可观测变量（$Y$，$D$，$Z$）的条件期望来表示，因此可以从 RCT 收集的数据中进行估计。分子是 ITT 对结局的效应，分母是人群中依从者的比例。",
            "answer": "$$\n\\boxed{\\frac{E[Y | Z=1] - E[Y | Z=0]}{E[D | Z=1] - E[D | Z=0]}}\n$$"
        }
    ]
}