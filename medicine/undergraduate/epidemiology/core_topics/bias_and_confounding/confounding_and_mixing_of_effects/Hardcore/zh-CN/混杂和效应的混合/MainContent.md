## 引言
在流行病学及众多科学领域，从观察数据中推断因果关系是核心目标，但这一过程常受到**混杂（confounding）**的挑战。混杂是一种系统性偏倚，当一个外部因素同时与暴露和结局相关时，它会扭曲或制造出虚假的关联，严重威胁研究结论的有效性。许多研究者对混杂的理解停留在“第三个变量”的模糊概念上，缺乏一个系统性的框架来精确识别、区分并有效控制它。本文旨在填补这一知识鸿沟，为读者构建一个关于混杂的完整认知体系。

在接下来的内容中，我们将分三步深入探索混杂的世界。首先，在“**原理与机制**”一章，我们将超越传统定义，引入反事实框架和有向无环图（DAGs），从根本上理解混杂的本质，并学会如何区分混杂与[对撞偏倚](@entry_id:163186)、过度调整等相关陷阱。接着，在“**应用与跨学科关联**”一章，我们将通过经典的流行病学案例和多种实用的控制方法（如标准化、回归模型、边际结构模型等），展示这些理论在真实世界研究中的具体应用。最后，“**动手实践**”部分将提供具体的计算练习，让您亲手操作数据，加深对混杂识别与调整的理解。通过这一系列学习，您将能够更自信地应对观察性研究中的因果推断挑战。

## 原理与机制

在流行病学和相关科学领域，研究的核心目标之一是识别因果关系。然而，在观测性研究中，从观察到的关联中推断因果关系充满了挑战。暴露与结局之间的[统计关联](@entry_id:172897)可能并不代表真实的因果效应，而是由一个或多个外部变量引起的虚假关联。这种现象，即**混杂（confounding）**，是流行病学研究有效性的主要威胁之一。本章将深入探讨混杂的根本原理、识别混杂的机制，以及区分混杂与其他相关偏倚的方法。

### 混杂的形式化定义：反事实框架

要精确理解混杂，我们必须超越“与暴露和结局都有关的第三个变量”这一初步描述，进入**反事实（counterfactual）**或**潜在结局（potential outcomes）**的理论框架。在这个框架中，我们为每个个体设想其在不同暴露水平下的潜在结局。

让我们用 $X$ 表示一个二元暴露（例如，接受治疗 $X=1$，或未接受治疗 $X=0$），用 $Y$ 表示结局。对于任何一个个体，我们定义两个潜在结局：$Y_1$ 是该个体在接受暴露（$X=1$）的情况下将会观察到的结局；$Y_0$ 是该个体在未接受暴露（$X=0$）的情况下将会观察到的结局。对于任何一个个体，我们只能观察到这两个潜在结局中的一个，即与其真实暴露水平相对应的那个。这就是因果推断的根本难题。

在理想化的**随机对照试验（RCT）**中，暴露被随机分配。随机化的强大之处在于，它能在期望上确保暴露组和非暴露组在所有基线特征（无论是已测量还是未测量的）上都是可比的。这意味着，在随机化后，接受治疗的个体与未接受治疗的个体除了所接受的干预措施不同之外，在其他所有方面都相似。用反事实的语言来说，暴露组的潜在结局分布与非暴露组的潜在结局分布是相同的。这被称为**可交换性（exchangeability）**。数学上，这意味着潜在结局 $Y_x$ 与实际接受的暴露 $X$ 是独立的，记为 $Y_x \perp\!\!\!\perp X$。因此，在可交换性成立的情况下，暴露组的平均结局就等于人群在暴露下的平均潜在结局，即 $E[Y \mid X=1] = E[Y_1 \mid X=1] = E[Y_1]$。

然而，在观测性研究中，可交换性通常不成立。例如，决定是否服用某种非处方安眠药（暴露 $X$）的个体，可能原本就存在更严重的睡眠困难（一个基线变量 $U$），而严重的睡眠困难本身也可能增加未来一年内发生抑郁症（结局 $Y$）的风险。在这种情况下，服用安眠药的组（$X=1$）和未服用的组（$X=0$）在研究开始时就存在系统性差异。

**混杂（Confounding）**在反事实框架下被精确地定义为**不[可交换性](@entry_id:263314)（non-exchangeability）**。当潜在结局的分布在不同暴露组之间存在差异时，混杂就存在了。数学上，这意味着对于某些暴露水平 $x$，潜在结局 $Y_x$ 与实际接受的暴露 $X$ 不是独立的，即 $Y_x \not\perp\!\!\!\perp X$。用[期望值](@entry_id:150961)来表达，混杂存在，当且仅当：

$$
E[Y_x \mid X] \neq E[Y_x]
$$

对于某些 $x$ 成立。这意味着，在某个固定的（可能是反事实的）暴露水平 $x$ 下，那些实际接受了某种暴露的个体的平均潜在结局，与整个人群的平均潜在结局不同。例如，如果 $E[Y_0 \mid X=1] \neq E[Y_0 \mid X=0]$，就意味着即使暴露组的成员没有接受暴露，他们的结局风险也与非暴露组不同。这个差值 $E[Y_0 \mid X=1] - E[Y_0 \mid X=0]$ 就构成了**混杂偏倚**，它污染了我们观察到的关联 。

#### 一个量化示例

为了使这个抽象概念更具体，我们来看一个简单的数字示例 。假设一个二元混杂因素 $U$（例如，存在某种遗传倾向 $U=1$），一个二元暴露 $X$（例如，采纳某种生活方式 $X=1$），和一个二元结局 $Y$（例如，患上某种疾病 $Y=1$）。

假设数据生成过程如下：
-   $P(U=1) = 0.5$
-   暴露 $X$ 的概率依赖于 $U$：$P(X=1 \mid U=1) = 0.8$，$P(X=1 \mid U=0) = 0.2$。这意味着有遗传倾向的人更可能采纳该生活方式。
-   潜在结局 $Y_1$（即如果接受暴露，则患病的结局）的概率依赖于 $U$：$P(Y_1=1 \mid U=1) = 0.9$，$P(Y_1=1 \mid U=0) = 0.1$。这意味着有遗传倾向的人即使在采纳该生活方式后，患病风险也更高。

首先，我们计算整个人群的平均潜在结局 $E[Y_1]$，它等于[边际概率](@entry_id:201078) $P(Y_1=1)$：
$$
E[Y_1] = P(Y_1=1) = P(Y_1=1 \mid U=1)P(U=1) + P(Y_1=1 \mid U=0)P(U=0)
$$
$$
E[Y_1] = (0.9)(0.5) + (0.1)(0.5) = 0.45 + 0.05 = 0.5
$$
这意味着，如果整个人群都采纳该生活方式，患病率为 $0.5$。

现在，我们计算在实际接受了暴露的亚组（$X=1$）中，这个潜在结局的平均值 $E[Y_1 \mid X=1]$。这需要我们计算在 $X=1$ 的条件下 $U$ 的分布 $P(U=u \mid X=1)$。通过[贝叶斯定理](@entry_id:151040)，我们可以算出 $P(X=1)=0.5$，然后得到 $P(U=1 \mid X=1) = 0.8$ 和 $P(U=0 \mid X=1) = 0.2$。因此：
$$
E[Y_1 \mid X=1] = P(Y_1=1 \mid X=1) = \sum_{u \in \{0,1\}} P(Y_1=1 \mid U=u, X=1) P(U=u \mid X=1)
$$
假设在给定 $U$ 的条件下，$Y_1$ 与 $X$ 独立（即条件可交换性 $Y_1 \perp\!\!\!\perp X \mid U$），则 $P(Y_1=1 \mid U=u, X=1) = P(Y_1=1 \mid U=u)$。
$$
E[Y_1 \mid X=1] = (0.9)(0.8) + (0.1)(0.2) = 0.72 + 0.02 = 0.74
$$
我们看到 $E[Y_1 \mid X=1] = 0.74$ 显著不等于 $E[Y_1] = 0.5$。这个差异 $0.24$ 表明，实际选择暴露的群体，其患病倾向（即使在相同的暴露条件下）本身就高于普通人群。这就是混杂的具体体现：暴露组和非暴露组是不可交换的。

### 混杂作为一种“效应混合”

流行病学家常将混杂描述为一种**“效应混合”（mixing of effects）**。这个术语可以通过反事实框架得到精确的数学解释 。我们观察到的关联参数，例如暴露组的平均结局 $E[Y \mid A=a]$（这里我们用 $A$ 代表暴露），并不是我们想要的因果参数 $E[Y^a]$。

通过应用[全期望定律](@entry_id:265946)和条件[可交换性](@entry_id:263314)假设（$Y^a \perp\!\!\!\perp A \mid U$，其中 $U$ 是所有共同原因的集合），我们可以推导出：
-   **观察关联**：$E[Y \mid A=a] = \sum_{u} E[Y^a \mid U=u] \, P(U=u \mid A=a)$
-   **因果目标**：$E[Y^a] = \sum_{u} E[Y^a \mid U=u] \, P(U=u)$

比较这两个表达式，我们可以清楚地看到“混合”的来源。两者都是对特定于协变量层 $U=u$ 的因果效应 $E[Y^a \mid U=u]$ 的加权平均。然而，观察到的关联使用的是**暴露组特定的权重** $P(U=u \mid A=a)$，而真正的因果参数使用的是**整个人群的权重** $P(U=u)$。当混杂因素 $U$ 与暴露 $A$ 相关时（即 $P(U \mid A=a) \neq P(U)$），这两个加权平均值就会不同。因此，观察到的关联将真实的因果效应（$E[Y^a \mid U=u]$）与暴露组和非暴露组之间混杂因素分布的不平衡（$P(U \mid A=a)$ 与 $P(U)$ 的差异）**混合**在了一起。

### 使用有向无环图识别和控制混杂

为了系统地识别和处理混杂，现代流行病学广泛使用**有向无环图（Directed Acyclic Graphs, DAGs）**。DAGs 是一种强大的可视化工具，它能将我们关于变量间因果关系的假设明确地编码出来。在 DAG 中，节点代表变量，箭头代表直接的因果效应。

#### 因果路径与后门路径

在 DAG 中，连接暴露 $X$ 和结局 $Y$ 的路径有两种[基本类](@entry_id:158335)型：
-   **因果路径（Causal Paths）**：是从 $X$ 到 $Y$ 的一系列首尾相连的箭头，例如 $X \to M \to Y$。这些路径传递了 $X$ 对 $Y$ 的真实因果效应。为了估计总因果效应，我们必须保持这些路径畅通。
-   **后门路径（Backdoor Paths）**：是任何连接 $X$ 和 $Y$ 但起始于一个指向 $X$ 的箭头的路径（例如 $X \leftarrow U \to Y$）。这种路径代表了 $X$ 和 $Y$ 的共同原因，是混杂的图形化表达。它们打开了一条非因果的关联“后门”，造成了虚假关联 。

#### [后门准则](@entry_id:637856)

**[后门准则](@entry_id:637856)（The Backdoor Criterion）**提供了一个图形化的标准，用于选择一个协变量集合 $Z$ 进行调整（例如，在回归模型中控制或进行分层），以消除混杂。一个集合 $Z$ 满足相对于 $(X, Y)$ 的[后门准则](@entry_id:637856)，如果：
1.  $Z$ 阻断了所有从 $X$到 $Y$ 的后门路径。
2.  $Z$ 中不包含任何 $X$ 的后代（即由 $X$ 引起的变量）。

如果一个集合 $Z$ 满足[后门准则](@entry_id:637856)，并且满足其他标准假设（如**正性 (positivity)**，即在 $Z$ 的每个层内都有暴露和非暴露的个体），那么通过对 $Z$ 进行调整，我们就可以得到 $X$ 对 $Y$ 的无偏因果效应估计。

例如，在经典的混杂结构 $U \to X$, $U \to Y$, $X \to Y$ 中，存在一条后门路径 $X \leftarrow U \to Y$。要阻断这条路径，我们需要对非对撞节点 $U$ 进行调整。因此，集合 $\{U\}$ 就是一个充分的调整集。由于其唯一的子集空集 $\varnothing$ 不能阻断该路径，所以 $\{U\}$ 是一个**最小充分调整集** 。如果 $U$ 无法测量，但我们能测量一个 $U$ 的完美**代理变量（proxy variable）** $Z$（即 $Z$ 是 $U$ 的确定性函数），那么调整 $\{Z\}$ 同样可以满足[后门准则](@entry_id:637856)。

### 与混杂相关但不同的偏倚

理解混杂，也意味着要能将其与其他类型的偏倚区分开来，尤其是在选择调整变量时。

#### 混杂、选择偏倚与信息偏倚

系统性误差（偏倚）主要分为三类 ：
-   **混杂偏倚（Confounding Bias）**：如前所述，由暴露和结局的[共同原因](@entry_id:266381)引起。在随机对照试验（RCT）中，**随机化**通过在期望上平衡所有基线变量（已测量和未测量的），从而打破了暴露与这些[共同原因](@entry_id:266381)之间的关联，从根本上消除了基线混杂。
-   **选择偏倚（Selection Bias）**：由于研究对象的选择或保留过程不当而产生的偏倚。例如，如果研究的随访完成率同时受暴露和结局的影响（或其原因），那么仅分析完成随访的个体就会引入偏倚。随机化本身并不能防止随访中的差异性脱落，因此无法消除选择偏倚。
-   **信息偏倚（Information Bias）**：由于对暴露、结局或其他变量的测量存在系统性误差而产生的偏倚。例如，如果研究者在知道患者分组的情况下进行结局测量，可能会无意识地对治疗组的测量更为仔细，导致差异性测量误差。随机化本身不保证测量的准确性，**设盲（blinding）**才是控制信息偏倚的主要手段。

#### [对撞偏倚](@entry_id:163186)：调整中的陷阱

在 DAG 中，当一条路径上的某个节点有两条或多条箭头指向它时，该节点被称为**对撞节点（collider）**。例如，在 $X \to Y \leftarrow Z$ 的结构中，$Y$ 就是一个对撞节点。一条包含对撞节点的路径，其本身是天然**阻断**的，不会传递关联。然而，一个非常重要的规则是：**对一个对撞节点（或其后代）进行调整（或分层），会打开这条原本被阻断的路径**，从而在两个原本独立的父节点之间（例如 $X$ 和 $Z$）制造出虚假的关联。这种偏倚被称为**[对撞偏倚](@entry_id:163186)（collider bias）**或选择偏倚的一种形式。

例如，假设才华（$X$）和努力（$Z$）是两个独立的因素，它们共同决定了一个人是否能成为明星（$Y$），即 $X \to Y \leftarrow Z$ 。在普通人群中，才华和努力是无关的。但如果我们只看明星这个群体（即以 $Y=1$ 为条件），我们会发现一种负相关：在同样是明星的前提下，才华横溢的人可能不那么努力，而极其努力的人可能才华稍逊。这种“此消彼长”的现象就是[对撞偏倚](@entry_id:163186)。在数据分析中，若不慎将一个对撞节点作为协变量进行调整，就会引入这种偏倚。

### 调整中的失误：过度调整偏倚

选择错误的变量进行调整不仅无法控制混杂，反而可能引入新的偏倚。这种现象统称为**过度调整偏倚（overadjustment bias）**。

#### 调整中介体

当一个变量位于暴露和结局的因果链条上时（$E \to M \to D$），它被称为**中介体（mediator）**。例如，体育锻炼（$E$）通过降低体重（$M$）来预防糖尿病（$D$）。中介体不是混杂因素，因为它是由暴露引起的，而不是暴露的原因。如果我们想估计暴露的总因果效应，调整中介体是错误的 。这样做会阻断通过中介体传递的因果效应，导致我们估计的只是暴露的**直接效应**（未通过该中介体的部分），从而低估了总效应。

更糟糕的是，如果存在一个未测量的变量 $U$ 同时影响中介体 $M$ 和结局 $D$（即 $E \to M \leftarrow U \to D$），那么 $M$ 就成了一个对撞节点。在这种情况下，调整中介体 $M$ 不仅会阻断部分因果路径，还会因打开对撞路径 $E \to M \leftarrow U \to D$ 而引入[对撞偏倚](@entry_id:163186)，使得对直接效应的估计也产生偏倚 。

#### 调整变量分类总结

基于 DAG 原则，我们可以对不同类型的变量在估计总效应时的调整策略进行总结 ：
-   **必须调整**：混杂因素（如 $U$ 在 $E \leftarrow U \to D$ 中），它们位于后门路径上。
-   **禁止调整**：中介体（如 $M$ 在 $E \to M \to D$ 中）和对撞节点（如 $L$ 在 $E \to L \leftarrow U$ 中）。调整它们会引入偏倚。
-   **可选调整**：仅与结局相关的独立危险因素（如 $Z$ 在 $E \dots Z \to D$ 结构中，且 $Z$ 与 $E$ 无关）。调整它们不会引入偏倚，且通常能提高估计的统计**精度（precision）**。
-   **通常不调整**：仅与暴露相关的变量，即**工具变量（instrumental variables）**（如 $I$ 在 $I \to E \to D$ 中）。调整它们虽然不引入偏倚，但会不必要地消耗统计自由度，可能降低精度。

### 高级主题与细微差别

最后，我们讨论两个与混杂密切相关但更为复杂的概念。

#### 效应量修饰：当效应不均一

**效应量修饰（Effect Measure Modification, EMM）**是指暴露对结局的因果效应的大小或方向在某个第三个变量（修饰变量）的不同水平上有所不同。与混杂不同，效应量修饰不是一种需要被“消除”的偏倚，而是对因果关系异质性的一种真实描述，具有重要的公共卫生和临床意义。

效应量修饰的判断是**依尺度（scale-dependent）**的 。同一个效应在一种尺度（如绝对差异）上表现出异质性，但在另一种尺度（如相对差异）上可能表现出同质性。

例如，假设一项干预在低风险人群（基线风险 $0.01$）中将风险从 $0.01$ 降至 $0.005$，而在高风险人群（基线风险 $0.20$）中将风险从 $0.20$ 降至 $0.10$。
-   在**乘法尺度**上，两组的**风险比（Risk Ratio, RR）**是相同的：$RR_L = 0.005 / 0.01 = 0.5$，$RR_H = 0.10 / 0.20 = 0.5$。在乘法尺度上，没有效应量修饰。
-   在**加法尺度**上，两组的**风险差（Risk Difference, RD）**是不同的：$RD_L = 0.005 - 0.01 = -0.005$，$RD_H = 0.10 - 0.20 = -0.10$。在加法尺度上，存在显著的效应量修饰。干预在高风险人群中避免了更多的病例。

这种[尺度依赖性](@entry_id:197044)强调了在报告和解释效应异质性时，明确指出所用效应度量的重要性。

#### 比值比的不可坍缩性

在流行病学中，**比值比（Odds Ratio, OR）**是一个常用的关联度量，尤其是在病例对照研究和logistic回归中。然而，OR 具有一个独特的数学性质，称为**不可坍缩性（non-collapsibility）** 。

这意味着，即使在**没有混杂**的情况下（即暴露与协变量独立），分层的（或条件）OR 也通常不等于边际（或粗）OR。具体来说，当协变量是结局的危险因素时，边际 OR 通常会比条件 OR 更接近于 1（即更接近无效值）。

例如，在一个 logistic 回归模型 $\operatorname{logit}(\Pr(Y=1 \mid E,Z)) = \alpha + \beta E + \gamma Z$ 中，调整了 $Z$ 后的条件 OR 就是 $\exp(\beta)$。但如果我们计算未调整的边际 OR，我们会发现它不等于 $\exp(\beta)$，尽管我们可能假设暴露 $E$ 和协变量 $Z$ 是独立的。这是因为将概率 $p$ 转换为比值（odds）的函数 $p/(1-p)$ 是非线性的。对概率进行平均，然后计算比值，与先计算各层的比值再进行平均，得到的结果是不同的。

这个性质非常重要，因为它意味着在比较logistic回归中调整后和未调整的 OR 时，其变化可能不仅仅反映了混杂的控制，也可能反映了 OR 的不可坍缩性。这与风险比（RR）和风险差（RD）不同，后两者是**可坍缩的**，即在没有混杂的情况下，[边际效应](@entry_id:634982)等于条件效应的加权平均。