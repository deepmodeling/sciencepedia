## 引言
在实证研究中，从观测数据中区分[统计关联](@entry_id:172897)与真实因果关系，是科学家面临的核心挑战。简单的相关性分析往往会因混杂、选择偏倚等问题而导致错误结论。为了应对这一挑战，有向无环图（Directed Acyclic Graphs, DAGs）应运而生，它提供了一套严谨、直观的图形化语言，使研究者能够清晰地表达其对世界运作方式的因果假设，并系统地推断这些假设的统计学后果。本文旨在为读者提供一个关于使用DAG进行因果识别的全面指南。

我们将分三部分展开：首先，在“原理与机制”一章中，我们将深入探讨DAG的基本构件、路径规则以及[d-分离](@entry_id:748152)等核心概念，为您打下坚实的理论基础。接着，在“应用与跨学科联系”一章中，我们将通过流行病学、遗传学等领域的丰富案例，展示如何运用[后门准则](@entry_id:637856)、[前门准则](@entry_id:636516)和工具变量等策略解决实际研究中的偏倚问题。最后，“动手实践”部分将提供一系列练习，帮助您将理论知识转化为可操作的技能。

通过学习本文，您将掌握使用DAG进行因果推断的系统性方法，从而在您的研究中做出更可靠的结论。让我们首先进入第一章，探索构成这一强大框架的核心原理与机制。

## 原理与机制

在流行病学和因果推断领域，[有向无环图](@entry_id:164045)（Directed Acyclic Graphs, DAGs）已成为一种不可或缺的语言，用于清晰地编码、可视化和分析关于变量间因果关系的假设。本章将深入探讨构成这一强大框架的核心原理与机制。我们将从 DAG 的基本构件出发，逐步解析其如何表达因果路径与非因果关联，并最终阐明如何利用这些原理来识别因果效应以及规避常见的统计偏倚。

### 基本构件：因果 DAG 的语言

#### 什么是[有向无环图](@entry_id:164045)？

从形式上看，一个**[有向无环图 (DAG)](@entry_id:748452)** 是一个由节点（或顶点）和有向边组成的数学结构。在因果推断的语境下，这些组成部分被赋予了深刻的流行病学意义。

- **节点 (Nodes)**：图中的每个节点代表一个变量。这些变量可以是暴露（$E$）、结局（$Y$）、协变量（$C$），甚至是未被测量的潜在因素（$U$）。
- **有向边 (Directed Edges)**：连接两个节点的箭头，如 $A \to B$，代表了一个直接的因果效应。箭头从原因（$A$）指向结果（$B$）。一条边的存在声明了变量 $A$ 是变量 $B$ 的一个直接原因（相对于图中包含的其他变量而言）。反之，边的缺失则是一个更强的声明：它断言不存在从 $A$到 $B$ 的直接因果效应。

将这些元素结合起来，一个 DAG 就构成了一个关于我们所研究系统中[因果结构](@entry_id:159914)的非[参数化](@entry_id:265163)假设网络。这一结构与**结构因果模型 (Structural Causal Model, SCM)** 紧密相连。在一个 SCM 中，系统中的每个变量（内生变量）都被定义为其直接原因（即图中的父节点）和一个独特的外生随机扰动项的函数。例如，一个节点 $X$ 的值可以由以下结构方程确定：

$$X = f_X(\text{pa}(X), U_X)$$

其中，$\text{pa}(X)$ 是 $X$ 在图中的父节点集合，$U_X$ 是代表所有未在模型中明确包含的、$X$ 特有的外生原因的随机误差项。因此，DAG 中的一条边 $Z \to X$ 明确表示，$Z$ 是 $\text{pa}(X)$ 的一个元素，并且 $X$ 的值在因果上依赖于 $Z$ 的值 。例如，在研究暴露 $E$ 对结局 $Y$ 的影响时，一个常见的混杂因子 $C$ 会同时影响 $E$ 和 $Y$。这种关系在 DAG 中被表示为两条边：$C \to E$ 和 $C \to Y$。

#### 无环性假说与反馈处理

DAG 的一个定义性特征是“无环性”（Acyclicity），即图中不存在任何从一个节点出发，沿着箭头的方向最终能回到自身的**有向路径**（directed path）。例如，结构 $A \to B \to C \to A$ 是一个环，在 DAG 中是不被允许的。

这一限制并非随意的数学约束，而是源于一个根本的哲学和物理前提：一个事件不能成为其自身的原因，即便通过一系列中介变量也不行。因果关系被假定为在时间上是单向的。无环性确保了系统中所有变量存在一个[拓扑排序](@entry_id:156507)，允许我们通过其祖先节点和外生误差项以非递归的方式唯一确定每个变量的值。这为定义和识别干预（intervention）的效果提供了坚实的数学基础 。

然而，许多生物和社会系统确实表现出**反馈回路 (feedback loops)**。例如，在传染病研究中，当前的细菌载量（$Y_t$）可能会影响患者的治疗决策，从而影响其未来的抗生素暴露（$E_{t+1}$）。为了在保持无环性的同时模拟这种动态关系，标准方法是进行**时间展开 (time-unrolling)**。我们将变量在不同时间点的[状态表示](@entry_id:141201)为图中的不同节点。这样，一个看似循环的反馈过程——暴露影响结局，结局反过来又影响暴露——被展开成一个遵循时间顺序的、无环的链条。例如，上述反馈可以表示为 $Y_t \to E_{t+1}$ 和 $E_t \to Y_{t+1}$。由于时间索引总是增加的（$t  t+1$），任何有向路径都只能在时间上前进，从而保证了整个图的无环性，同时精确地捕捉了系统的动态[反馈机制](@entry_id:269921)  。

### 追踪关联：DAG 中的路径

DAG 中的边代表直接因果效应，而变量间的统计关联则通过路径（paths）来传递。一个**路径**是连接两个节点的一系列连续的边，在追踪路径时我们暂时忽略边的方向。然而，箭头的方向对于理[解路径](@entry_id:755046)的性质和其传递的关联类型至关重要。在暴露 $E$ 和结局 $Y$ 之间，主要有三种基本路径类型。

- **有向路径 (Directed Paths)**：也称为因果路径（causal paths），是指从 $E$ 到 $Y$ 的所有箭头都指向前方的路径。例如，在 $E \to M \to Y$ 中，$M$ 是一个中介变量，该路径传递了 $E$ 通过 $M$ 对 $Y$ 产生的因果效应。这是唯一能够传递因果效应的路径类型 。

- **后门路径 (Backdoor Paths)**：这是一种非因果路径，它连接 $E$ 和 $Y$，但其第一条边指向 $E$（即“从 $E$ 的后门溜出”）。典型的后门路径由一个共同原因（混杂因子）产生，如 $E \leftarrow C \to Y$。这条路径在 $E$ 和 $Y$ 之间产生了一种非因果的统计关联，因为它们共享一个共同的原因 $C$。这种关联是**混杂偏倚 (confounding bias)** 的来源 。

- **对撞机路径 (Collider Paths)**：这类路径的特征是其上至少存在一个**对撞机 (collider)** 节点。对撞机是指在一个路径上，有两支箭头同时指向的节点，形成“头对头”的碰撞结构，例如 $A \to B \leftarrow C$ 中的节点 $B$。一个包含对撞机的路径，如 $E \to S \leftarrow Y$，具有独特的性质，它在默认情况下是“封闭”的，不会在 $E$ 和 $Y$ 之间传递关联 。然而，正如我们稍后将看到的，对这种路径的特殊处理（如对其进行统计学调整）可能会出乎意料地“打开”它，从而引入偏倚。

### 从图结构到[统计独立性](@entry_id:150300)：D-分离

DAG 不仅仅是因果假设的可视化工具，它还是一个严格的逻辑机器，可以用来推断在给定[因果结构](@entry_id:159914)下，哪些变量之间应该存在[统计独立性](@entry_id:150300)。这个推断机制被称为**[d-分离](@entry_id:748152) (d-separation)**，其中“d”代表“方向性 (directional)”。

[d-分离](@entry_id:748152)的核心思想是**路径阻断 (path blocking)**。如果连接两个节点（或节点集）$A$ 和 $B$ 的**所有**路径都被一个节点集 $Z$ 所“阻断”，那么我们说 $A$ 和 $B$ 被 $Z$ [d-分离](@entry_id:748152)。

一条路径被节点集 $Z$ 阻断，当且仅当该路径上至少存在一个满足以下条件之一的节点：
1.  该节点是一个**非[对撞机](@entry_id:192770)**（即链式结构 $\to M \to$ 或[分叉](@entry_id:270606)结构 $\leftarrow M \to$ 的中间节点 $M$），并且该节点**属于**条件集 $Z$。
2.  该节点是一个**对撞机**（$\to M \leftarrow$），并且该对撞机本身及其任何后代节点都**不属于**条件集 $Z$。

从这两个规则可以推导出路径“开放”（即传递关联）的条件：一条路径是开放的，当且仅当路径上所有的非[对撞机](@entry_id:192770)都**不在**条件集 $Z$ 中，并且路径上所有的[对撞机](@entry_id:192770)都**在**条件集 $Z$ 中（或其某个后代在 $Z$ 中）。

规则1符合我们的直觉：如果我们控制（调整）了一个位于因果链或[共同原因](@entry_id:266381)路径上的变量，那么该路径上的关联就会被阻断。规则2则揭示了一个深刻且违反直觉的现象：对撞机天然地阻断路径，但对它进行调整（即将其纳入条件集 $Z$）反而会**打开**路径，创造出原本不存在的关联。这种现象是**选择偏倚 (selection bias)** 和其他几种复杂偏倚的根源 。

[d-分离](@entry_id:748152)的图论概念通过两个关键假设与现实世界的数据联系起来：
- **因果马尔可夫假设 (Causal Markov Assumption)**：如果在一个 DAG 中，$A$ 和 $B$ 被 $Z$ [d-分离](@entry_id:748152)，那么在由该 DAG 生成的任何数据分布中，$A$ 和 $B$ 在给定 $Z$ 的条件下是统计独立的。形式化地写为：$A \perp_G B \mid Z \implies A \perp_P B \mid Z$。
- **忠实性假设 (Faithfulness Assumption)**：如果在数据分布中观察到 $A$ 和 $B$ 在给定 $Z$ 的条件下是统计独立的，那么在底层的 DAG 中，$A$ 和 $B$ 必定被 $Z$ [d-分离](@entry_id:748152)。形式化地写为：$A \perp_P B \mid Z \implies A \perp_G B \mid Z$。

当这两个假设同时成立时，图上的 [d-分离](@entry_id:748152)就等同于数据中的[条件独立性](@entry_id:262650)，这使得我们能够仅通过观察数据中的（条件）独立关系来推断潜在的[因果结构](@entry_id:159914)，或者反过来，利用假设的[因果结构](@entry_id:159914)来预测数据中应有的统计模式 。

### 应用原理：识别因果效应

在流行病学中，我们的最终目标通常是量化一项暴露或干预措施的因果效应。这等价于估计**干预分布 (interventional distribution)** $p(Y \mid do(E=e))$，它描述了如果我们强制将人群中每个个体的暴露水平设定为 $e$ 后，结局 $Y$ 的分布会是怎样。这与从观测数据中直接计算的条件概率 $p(Y \mid E=e)$ 有本质区别，后者可能受到混杂等偏倚的污染。DAG 为我们提供了从观测数据中识别（即计算）干预分布的系统性策略。

#### 策略一：[后门准则](@entry_id:637856)（控制混杂）

混杂偏倚的本质是存在一条或多条从 $E$ 到 $Y$ 的开放的后门路径。**[后门准则](@entry_id:637856) (backdoor criterion)** 提供了一套充分条件，用于选择一个协变量集 $Z$ 进行调整（如通过分层或回归调整），以阻断所有这些非因果路径。

一个节点集 $Z$ 相对于 $(E, Y)$ 满足[后门准则](@entry_id:637856)，如果：
1.  $Z$ 阻断了所有连接 $E$ 和 $Y$ 且第一条边指向 $E$ 的路径（即所有后门路径）。
2.  $Z$ 中不包含任何 $E$ 的后代节点。

第一条规则确保了所有混杂路径都被关闭。第二条规则则至关重要，它防止我们因不当调整而引入新的问题 ：
- **阻断因果路径**：如果 $Z$ 中包含了一个位于 $E$ 到 $Y$ 因果路径上的中介变量（例如 $E \to M \to Y$ 中的 $M$），那么调整 $Z$ 就会阻断我们正试图测量的部分因果效应。
- **引入对撞机偏倚**：如果 $Z$ 中包含一个 $E$ 的后代，该后代可能是某个非因果路径上的[对撞机](@entry_id:192770)。调整它可能会打开一条原本封闭的路径，从而引入偏倚。

如果一个可观测的变量集 $Z$ 满足[后门准则](@entry_id:637856)，那么 $E$ 对 $Y$ 的因果效应就是可识别的，并且可以通过**校正公式 (adjustment formula)** 进行计算：
$$p(Y \mid do(E=e)) = \sum_{z} p(Y \mid E=e, Z=z) p(z)$$

#### 策略二：[前门准则](@entry_id:636516)（当混杂无法测量时）

在许多实际情况中，混杂因子是未知的或无法测量的（例如，遗传倾向、社会经济地位的某些方面）。这种情况下，后门路径无法被直接阻断。**[前门准则](@entry_id:636516) (frontdoor criterion)** 提供了一种巧妙的替代方案，它利用一个中介变量 $M$ 来识别因果效应。

假设存在一个中介变量 $M$，它满足以下三个条件：
1.  $M$ 拦截了所有从 $E$ 到 $Y$ 的有向路径（即 $E$ 对 $Y$ 的所有影响都必须通过 $M$）。
2.  从 $E$ 到 $M$ 没有开放的后门路径（即 $E \to M$ 的关系没有被混杂）。
3.  所有从 $M$ 到 $Y$ 的后门路径都被 $E$ 阻断。

直观地理解，[前门准则](@entry_id:636516)分两步走：首先，由于 $E \to M$ 的关系是无偏的，我们可以估计 $E$ 对 $M$ 的影响；其次，我们可以估计 $M$ 对 $Y$ 的影响，并通过调整 $E$ 来控制 $M-Y$ 之间的混杂。最后，将这两部分效应“拼接”起来，得到 $E$ 对 $Y$ 的总因果效应。

满足[前门准则](@entry_id:636516)时，因果效应可以通过**前门公式 (frontdoor formula)** 识别 ：
$$p(Y \mid do(E=e)) = \sum_{m} p(M=m \mid E=e) \sum_{e'} p(Y \mid M=m, E=e') p(E=e')$$

### 常见陷阱与偏倚来源

DAG 不仅帮助我们识别因果效应，更能揭示导致错误结论的各种偏倚的底层结构。

#### 未测混杂

这是最经典的一种偏倚，其结构为一个未测量的[共同原因](@entry_id:266381) $U$ 同时影响暴露 $E$ 和结局 $Y$ ($E \leftarrow U \to Y$) 。这会留下一条无法通过调整观察变量来阻断的后门路径，导致观测到的 $E-Y$ 关联与真实的因果效应不符 。

#### 选择偏倚（[对撞机](@entry_id:192770)偏倚）

选择偏倚是一种更为隐蔽的偏倚，它并非源于研究设计初期变量间的固有关系，而是由数据分析过程中的选择行为（如样本选择、处理缺失数据）所**引入**的。其底层机制几乎总是**对撞机偏倚 (collider bias)**。

当我们的分析局限于某个变量的特定值时，如果该变量是某条路径上的对撞机，这个条件限制行为就会打开这条原本封闭的路径。一个典型的例子是研究参与选择。假设暴露 $E$ 和某个未测因素 $U$ 都会影响一个人是否参与研究（$S=1$），而 $U$ 也同时影响结局 $Y$。这个结构是 $E \to S \leftarrow U \to Y$。在这个图中，$S$ 是一个[对撞机](@entry_id:192770)。在整个人群中，$E$ 和 $Y$ 之间没有开放路径，因此没有关联。然而，如果我们的分析仅限于参与研究的人（即条件限制在 $S=1$），我们就等于对[对撞机](@entry_id:192770) $S$ 进行了调整，从而打开了 $E \to S \leftarrow U \to Y$ 这条路径。这会在 $E$ 和 $Y$ 之间引入一条虚假的、非因果的关联，导致选择偏倚 。

这一原理也适用于理解**缺失数据 (missing data)** 带来的偏倚。我们可以将变量 $Y$ 是否缺失表示为一个指标变量 $R_Y$。
- **[完全随机缺失](@entry_id:170286) (MCAR)**：$R_Y$ 与模型中所有变量都独立。在 DAG 中，$R_Y$ 没有任何父节点。
- **[随机缺失](@entry_id:168632) (MAR)**：$R_Y$ 的缺失性可能依赖于其他观测变量 $L$，但在给定 $L$ 的条件下，与 $Y$ 本身的值无关。DAG 结构为 $L \to R_Y$，但没有 $Y \to R_Y$ 的箭头。
- **[非随机缺失](@entry_id:163489) (MNAR)**：$R_Y$ 的缺失性依赖于 $Y$ 本身未被观测到的值。DAG 结构为 $Y \to R_Y$。

当数据是 MNAR 时，如果我们只分析数据完整的观测（即条件限制在 $R_Y=1$），而 $Y$ 和其他某个变量（如 $E$）都是 $R_Y$ 的原因，那么 $R_Y$ 就扮演了[对撞机](@entry_id:192770)的角色，对它进行条件限制会引入偏倚 。

#### M-偏倚

M-偏倚是一种特别微妙且具有警示意义的[对撞机](@entry_id:192770)偏倚。它揭示了“调整所有暴露前的协变量”这一传统做法可能带来的风险。考虑以下 M 形结构：$E \leftarrow U_1 \to C \leftarrow U_2 \to Y$，其中 $E$ 是暴露，$Y$ 是结局，$C$ 是一个可测量的暴露前协变量，而 $U_1$ 和 $U_2$ 是两个独立的未测因素。

在这个结构中，$E$ 和 $Y$ 之间没有共同的祖先，因此不存在混杂。不调整任何变量时，$E$ 和 $Y$ 之间的关联可以无偏地估计因果效应（在此例中为零）。然而，$C$ 是路径 $U_1 \to C \leftarrow U_2$ 上的一个[对撞机](@entry_id:192770)。如果我们遵循传统智慧，因为 $C$ 在暴露前，就对它进行调整，那么我们就会打开 $E \leftarrow U_1 \to C \leftarrow U_2 \to Y$ 这条路径，从而在 $E$ 和 $Y$ 之间凭空制造出一条非因果的关联。因此，对 $C$ 的调整反而**引入**了偏倚。M-偏倚是强有力的反例，说明协变量的选择必须基于其在[因果结构](@entry_id:159914)中的作用，而非仅仅依据时间顺序 。

#### 测量误差

当暴露或结局等变量无法被精确测量时，就会产生测量误差。在 DAG 中，一个存在经典测量误差的暴露可以用 $E \to E^*$ 来表示，其中 $E$ 是真实的暴露值，$E^*$ 是我们观测到的代理值。在这种情况下，即使我们调整了所有 $E-Y$ 关系中的混杂因子，使用 $E^*$ 代替 $E$ 进行分析通常仍会导致对因果效应的有偏估计。此外，需要注意的是，调整 $E^*$ 并不能阻断通往真实暴露 $E$ 的后门路径（例如，在 $E \leftarrow U \to Y$ 和 $E \to E^*$ 的结构中，调整 $E^*$ 无法阻断经由 $U$ 的混杂路径）。

综上所述，[有向无环图](@entry_id:164045)为我们提供了一套严谨的原理和机制，使我们能够超越简单的统计关联，深入探索数据背后的因果世界。通过掌握其语言和规则，研究者可以更清晰地思考、交流和检验因果假设，从而做出更可靠的推断。