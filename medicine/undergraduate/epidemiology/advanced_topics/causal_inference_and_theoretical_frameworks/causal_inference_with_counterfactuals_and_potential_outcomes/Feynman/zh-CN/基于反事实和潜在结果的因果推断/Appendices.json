{
    "hands_on_practices": [
        {
            "introduction": "在观察性研究中，区分相关性与因果性是核心挑战之一，而混杂（confounding）是两者产生差异的主要原因。本练习  提供了一个具体的数值场景，旨在帮助您亲手计算混杂如何扭曲我们观察到的关联，并实践如何通过分层调整来估计真实的平均处理效应（Average Treatment Effect, ATE），从而将抽象的理论转化为切实的计算。",
            "id": "4576153",
            "problem": "考虑一项观察性队列研究，旨在评估一个二元处理 $A \\in \\{0,1\\}$ 对一个二元结局 $Y \\in \\{0,1\\}$ 的影响，其中有一个在处理前测量的基线混杂因素 $X \\in \\{0,1\\}$。令 $Y(1)$ 和 $Y(0)$ 分别表示接受处理和不接受处理下的潜在结局，并假设在整个研究中以下核心定义成立：一致性 ($Y = Y(A)$)、可交换性 ($Y(a) \\perp\\!\\!\\!\\perp A$ for $a \\in \\{0,1\\}$)、条件可交换性 ($Y(a) \\perp\\!\\!\\!\\perp A \\mid X$ for $a \\in \\{0,1\\}$) 和正值性 ($0  P(A=a \\mid X=x)$ for all $x$ with $P(X=x)  0$)。平均处理效应 (ATE) 定义为 $E(Y(1)) - E(Y(0))$。\n\n假设以下数据生成机制成立：\n- $P(X=1) = 0.5$ 且 $P(X=0) = 0.5$。\n- $P(A=1 \\mid X=1) = 0.8$ 且 $P(A=1 \\mid X=0) = 0.2$。\n- $E(Y(1) \\mid X=1) = 0.9$，$E(Y(1) \\mid X=0) = 0.5$；$E(Y(0) \\mid X=1) = 0.7$，$E(Y(0) \\mid X=0) = 0.2$。\n\n假设处理分配取决于 $X$，但在给定 $X$ 的条件下与潜在结局无关，并且所有模型假设在流行病学背景下都是科学合理的。\n\n仅使用上述定义和给定的概率，评估以下哪些陈述是正确的：\n\nA. 因为一致性和正值性成立，未经调整的观测均值差异 $E(Y \\mid A=1) - E(Y \\mid A=0)$ 可以识别 $E(Y(1)) - E(Y(0))$，所以不需要无条件可交换性。\n\nB. 在此设定下，无条件可交换性不成立，因为 $E(Y(1) \\mid A=1) \\neq E(Y(1))$，具体来说 $E(Y(1) \\mid A=1) = 0.82$ 而 $E(Y(1)) = 0.7$。通过以 $X$ 为条件，条件可交换性得以恢复，并且标准化方法计算出 $E(Y(1)) = 0.7$ 和 $E(Y(0)) = 0.45$，从而得出平均处理效应为 $0.25$。\n\nC. 对 $X$ 进行调整会引入选择偏倚，因为 $X$ 是一个受处理影响的对撞因子，所以在此场景下以 $X$ 为条件是不合适的。\n\nD. 正值性假设被违反，因为 $P(A=1 \\mid X=0) = 0$，这意味着即使以 $X$ 为条件，$E(Y(a))$ 也是不可识别的。\n\nE. 在 $X$ 的各分层内，$A=1$ 和 $A=0$ 之间的观测结局差异等于该分层内的因果效应，并且用 $P(X=x)$ 对这些分层特异性因果效应进行加权平均，可以得出真实的平均处理效应。\n\n选择所有适用项。",
            "solution": "用户提供了一个因果推断问题，并要求评估几个陈述。我将首先验证问题陈述的有效性。\n\n### 步骤1：提取已知条件\n\n-   **变量**：二元处理 $A \\in \\{0,1\\}$，二元结局 $Y \\in \\{0,1\\}$，以及二元基线混杂因素 $X \\in \\{0,1\\}$。\n-   **潜在结局**：$Y(1)$ (若$A=1$时的结局)，$Y(0)$ (若$A=0$时的结局)。\n-   **定义和假设**：\n    -   一致性：$Y = Y(A)$。\n    -   可交换性：$Y(a) \\perp\\!\\!\\!\\perp A$ for $a \\in \\{0,1\\}$。\n    -   条件可交换性：$Y(a) \\perp\\!\\!\\!\\perp A \\mid X$ for $a \\in \\{0,1\\}$。此项被陈述为成立。\n    -   正值性：$0  P(A=a \\mid X=x)$ for all $x$ with $P(X=x) > 0$。\n-   **关注量**：平均处理效应 (ATE) $= E(Y(1)) - E(Y(0))$。\n-   **数据生成机制**：\n    -   $P(X=1) = 0.5$ 且 $P(X=0) = 0.5$。\n    -   $P(A=1 \\mid X=1) = 0.8$ 且 $P(A=1 \\mid X=0) = 0.2$。\n    -   $E(Y(1) \\mid X=1) = 0.9$ 且 $E(Y(1) \\mid X=0) = 0.5$。\n    -   $E(Y(0) \\mid X=1) = 0.7$ 且 $E(Y(0) \\mid X=0) = 0.2$。\n\n### 步骤2：使用提取的已知条件进行验证\n\n-   **科学依据**：该问题设置在潜在结局框架（也称为Rubin因果模型）内，这是流行病学、统计学和其他定量科学中进行因果推断的一种标准且严格定义的方法。可交换性、正值性、一致性、混杂以及ATE等概念是该框架的基本原则。该设定描述了一个经典的混杂场景，其中变量 $X$ 是处理 $A$ 和结局 $Y$ 的共同原因。所有元素在科学上都是合理的。\n-   **良构性**：问题提供了足够的数值数据和清晰的定义，以计算感兴趣的因果效应（ATE）和相应的关联度量（未经调整的平均结局差异）。问题是明确的。\n-   **客观性**：问题使用精确、形式化的数学和统计语言陈述，没有主观性或模糊性。\n-   **缺陷检查**：\n    1.  **科学/事实上不合理**：无。该概率模型是自洽的，并遵守概率公理。\n    2.  **不可形式化/不相关**：无。该问题是一个应用概率论和因果理论的形式化练习。\n    3.  **不完整/矛盾的设定**：无。所有必要信息都已提供。例如，$P(A=0 \\mid X=1) = 1 - P(A=1 \\mid X=1) = 1 - 0.8 = 0.2$，以及 $P(A=0 \\mid X=0) = 1 - P(A=1 \\mid X=0) = 1 - 0.2 = 0.8$。所有概率都是一致的。\n    4.  **不现实/不可行**：无。这些值是假设的，但代表了观察性研究中一种可能的情景。\n    5.  **不良构/结构不良**：无。问题结构良好。\n    6.  **伪深刻/琐碎**：无。该问题测试了流行病学中的一个基础概念：关联与因果的区别，以及用于校正混杂的方法（标准化/分层）。\n    7.  **超出科学可验证性范围**：无。所有主张都可以通过计算来验证。\n\n### 步骤3：结论和行动\n\n该问题是**有效的**。我将继续进行完整推导并评估每个选项。\n\n### 因果量和关联量的推导\n\n**1. 计算平均处理效应 (ATE)**\n\nATE, $E(Y(1)) - E(Y(0))$，是一个因果量。由于假设了条件可交换性 ($Y(a) \\perp\\!\\!\\!\\perp A \\mid X$)，我们可以通过对混杂因素 $X$ 的分布进行标准化来识别潜在结局的边际均值。\n\n标准化公式为 $E(Y(a)) = \\sum_{x} E(Y(a) \\mid X=x) P(X=x)$。\n\n对于 $Y(1)$:\n$$ E(Y(1)) = E(Y(1) \\mid X=1)P(X=1) + E(Y(1) \\mid X=0)P(X=0) $$\n$$ E(Y(1)) = (0.9)(0.5) + (0.5)(0.5) = 0.45 + 0.25 = 0.70 $$\n\n对于 $Y(0)$:\n$$ E(Y(0)) = E(Y(0) \\mid X=1)P(X=1) + E(Y(0) \\mid X=0)P(X=0) $$\n$$ E(Y(0)) = (0.7)(0.5) + (0.2)(0.5) = 0.35 + 0.10 = 0.45 $$\n\n因此，ATE是：\n$$ \\text{ATE} = E(Y(1)) - E(Y(0)) = 0.70 - 0.45 = 0.25 $$\n\n**2. 计算未经调整的关联差异**\n\n这是处理组和未处理组之间非因果的“粗略”均值差异：$E(Y \\mid A=1) - E(Y \\mid A=0)$。我们使用全期望定律，以 $X$ 为条件。\n$$ E(Y \\mid A=a) = \\sum_{x} E(Y \\mid A=a, X=x) P(X=x \\mid A=a) $$\n在一致性 ($Y=Y(A)$) 和条件可交换性 ($Y(a) \\perp\\!\\!\\!\\perp A \\mid X$) 下，我们有 $E(Y \\mid A=a, X=x) = E(Y(a) \\mid A=a, X=x) = E(Y(a) \\mid X=x)$。所以：\n$$ E(Y \\mid A=1, X=1) = E(Y(1) \\mid X=1) = 0.9 $$\n$$ E(Y \\mid A=1, X=0) = E(Y(1) \\mid X=0) = 0.5 $$\n$$ E(Y \\mid A=0, X=1) = E(Y(0) \\mid X=1) = 0.7 $$\n$$ E(Y \\mid A=0, X=0) = E(Y(0) \\mid X=0) = 0.2 $$\n\n接下来，我们需要条件概率 $P(X=x \\mid A=a)$，我们可以使用贝叶斯法则找到它。首先，我们找到处理的边际概率 $P(A=1)$：\n$$ P(A=1) = P(A=1 \\mid X=1)P(X=1) + P(A=1 \\mid X=0)P(X=0) $$\n$$ P(A=1) = (0.8)(0.5) + (0.2)(0.5) = 0.4 + 0.1 = 0.5 $$\n因此，$P(A=0) = 1 - P(A=1) = 0.5$。\n\n现在应用贝叶斯法则：\n$$ P(X=1 \\mid A=1) = \\frac{P(A=1 \\mid X=1) P(X=1)}{P(A=1)} = \\frac{(0.8)(0.5)}{0.5} = 0.8 $$\n$$ P(X=0 \\mid A=1) = 1 - P(X=1 \\mid A=1) = 0.2 $$\n$$ P(X=1 \\mid A=0) = \\frac{P(A=0 \\mid X=1) P(X=1)}{P(A=0)} = \\frac{(1-0.8)(0.5)}{0.5} = 0.2 $$\n$$ P(X=0 \\mid A=0) = 1 - P(X=1 \\mid A=0) = 0.8 $$\n\n现在我们可以计算观测均值：\n$$ E(Y \\mid A=1) = E(Y \\mid A=1, X=1)P(X=1 \\mid A=1) + E(Y \\mid A=1, X=0)P(X=0 \\mid A=1) $$\n$$ E(Y \\mid A=1) = (0.9)(0.8) + (0.5)(0.2) = 0.72 + 0.10 = 0.82 $$\n\n$$ E(Y \\mid A=0) = E(Y \\mid A=0, X=1)P(X=1 \\mid A=0) + E(Y \\mid A=0, X=0)P(X=0 \\mid A=0) $$\n$$ E(Y \\mid A=0) = (0.7)(0.2) + (0.2)(0.8) = 0.14 + 0.16 = 0.30 $$\n\n未经调整的关联差异是：\n$$ E(Y \\mid A=1) - E(Y \\mid A=0) = 0.82 - 0.30 = 0.52 $$\n\n### 逐项分析\n\n**A. 因为一致性和正值性成立，未经调整的观测均值差异 $E(Y \\mid A=1) - E(Y \\mid A=0)$ 可以识别 $E(Y(1)) - E(Y(0))$，所以不需要无条件可交换性。**\n该陈述声称未经调整的差异 ($0.52$) 可以识别ATE ($0.25$)。我们的计算表明这是错误的 ($0.52 \\neq 0.25$)。这种差异的原因是混杂，这等同于无条件可交换性的不成立。为了使未经调整的差异能够识别ATE，需要三个假设：一致性、正值性和无条件可交换性。该陈述错误地声称第三个假设不是必需的。\n**结论：不正确。**\n\n**B. 在此设定下，无条件可交换性不成立，因为 $E(Y(1) \\mid A=1) \\neq E(Y(1))$，具体来说 $E(Y(1) \\mid A=1) = 0.82$ 而 $E(Y(1)) = 0.7$。通过以 $X$ 为条件，条件可交换性得以恢复，并且标准化方法计算出 $E(Y(1)) = 0.7$ 和 $E(Y(0)) = 0.45$，从而得出平均处理效应为 $0.25$。**\n让我们逐一验证此陈述中的主张。\n1.  无条件可交换性不成立：这意味着 $E(Y(a) \\mid A=1) \\neq E(Y(a))$。对于 $a=1$，我们需要检查是否 $E(Y(1) \\mid A=1) \\neq E(Y(1))$。\n    根据我们对ATE的计算，$E(Y(1))=0.70$。\n    $E(Y(1) \\mid A=1)$ 可以计算为：\n    $E(Y(1) \\mid A=1) = \\sum_{x} E(Y(1) \\mid A=1, X=x)P(X=x \\mid A=1)$。由于条件可交换性，这等于 $\\sum_{x} E(Y(1) \\mid X=x)P(X=x \\mid A=1)$。\n    $E(Y(1) \\mid A=1) = E(Y(1) \\mid X=1)P(X=1 \\mid A=1) + E(Y(1) \\mid X=0)P(X=0 \\mid A=1) = (0.9)(0.8) + (0.5)(0.2) = 0.72 + 0.10 = 0.82$。\n    该陈述正确地断言了 $E(Y(1) \\mid A=1) = 0.82 \\neq E(Y(1)) = 0.7$。\n2.  恢复可交换性：“条件可交换性得以恢复”的说法略显不正式；关键点在于，假设条件可交换性成立，这使得调整成为可能。\n3.  标准化的值：该陈述声称标准化得出 $E(Y(1)) = 0.7$ 和 $E(Y(0)) = 0.45$。这些与我们的计算完全匹配。\n4.  ATE值：该陈述声称ATE为 $0.7 - 0.45 = 0.25$。这也与我们的计算相符。\n每个数值声明和核心概念点都是正确的。\n**结论：正确。**\n\n**C. 对 $X$ 进行调整会引入选择偏倚，因为 $X$ 是一个受处理影响的对撞因子，所以在此场景下以 $X$ 为条件是不合适的。**\n该陈述错误地描述了因果结构。$X$ 是在处理前测量的基线变量，因此它不可能“受处理影响”($A$)。数据生成过程意味着 $X$ 既影响处理分配 ($P(A=1|X)$ 取决于 $X$) 也影响潜在结局 ($E(Y(a)|X)$ 取决于 $X$)。这使得 $X$ 成为 $A$ 和 $Y$ 的共同原因，即混杂因素，其结构为 $A \\leftarrow X \\rightarrow Y$。对撞因子结构应为 $A \\rightarrow X \\leftarrow Y$。对混杂因素进行条件化是阻断后门路径和消除混杂偏倚的标准且正确的过程。对对撞因子进行条件化会引入偏倚（选择偏倚），但在这里 $X$ 不是对撞因子。\n**结论：不正确。**\n\n**D. 正值性假设被违反，因为 $P(A=1 \\mid X=0) = 0$，这意味着即使以 $X$ 为条件，$E(Y(a))$ 也是不可识别的。**\n正值性假设要求对于人群中存在的所有 $a$ 和 $x$ 的水平，$0  P(A=a \\mid X=x)$。我们已知 $P(A=1 \\mid X=0) = 0.2$。该值大于 $0$。该陈述的前提 $P(A=1 \\mid X=0) = 0$ 基于给定的信息是事实错误的。我们也可以检查其他条件：\n$P(A=0 \\mid X=0) = 1 - 0.2 = 0.8 > 0$。\n$P(A=1 \\mid X=1) = 0.8 > 0$。\n$P(A=0 \\mid X=1) = 1 - 0.8 = 0.2 > 0$。\n在所有分层中，对于两种处理水平，正值性都得到满足。因此，效应因正值性被违反而不可识别的结论也是错误的。\n**结论：不正确。**\n\n**E. 在 $X$ 的各分层内，$A=1$ 和 $A=0$ 之间的观测结局差异等于该分层内的因果效应，并且用 $P(X=x)$ 对这些分层特异性因果效应进行加权平均，可以得出真实的平均处理效应。**\n让我们分两部分分析这个陈述。\n1.  “在 $X$ 的各分层内，观测结局差异……等于该分层内的因果效应”。\n    分层 $x$ 内的观测差异为 $E(Y \\mid A=1, X=x) - E(Y \\mid A=0, X=x)$。\n    分层 $x$ 内的因果效应为 $E(Y(1) \\mid X=x) - E(Y(0) \\mid X=x)$。\n    给定一致性和条件可交换性，$E(Y \\mid A=a, X=x) = E(Y(a) \\mid X=x)$。因此，一个分层内的观测差异确实等于该分层的因果效应。这部分是正确的。\n    对于 $X=1$: $E(Y(1)|X=1)-E(Y(0)|X=1) = 0.9 - 0.7 = 0.2$。\n    对于 $X=0$: $E(Y(1)|X=0)-E(Y(0)|X=0) = 0.5 - 0.2 = 0.3$。\n2.  “用 $P(X=x)$ 对这些分层特异性因果效应进行加权平均，可以得出真实的平均处理效应。”\n    ATE是 $E(Y(1)) - E(Y(0))$。根据全期望定律：\n    $E(Y(1)) - E(Y(0)) = \\sum_{x} E(Y(1) \\mid X=x)P(X=x) - \\sum_{x} E(Y(0) \\mid X=x)P(X=x) = \\sum_{x} [E(Y(1) \\mid X=x) - E(Y(0) \\mid X=x)]P(X=x)$。\n    这个方程表明，ATE是层特异性因果效应的加权平均值，权重由每个分层的比例 $P(X=x)$ 给出。这个原则被称为标准化或分层。这部分也是正确的。\n    计算检查：$(0.2)P(X=1) + (0.3)P(X=0) = (0.2)(0.5) + (0.3)(0.5) = 0.10 + 0.15 = 0.25$。这与我们的ATE相匹配。\n整个陈述正确地描述了通过分层进行识别的过程。\n**结论：正确。**",
            "answer": "$$\\boxed{BE}$$"
        },
        {
            "introduction": "掌握了如何调整混杂之后，我们可以从一个更深刻的理论视角来理解因果推断的基本假设。这个思想实验  将指导您把因果推断问题重新构建为一个“缺失数据”（missing data）问题。通过这种类比，您将揭示核心的“可交换性”（exchangeability）假设与统计学中“随机缺失”（Missing at Random, MAR）概念之间的深刻联系，从而加深对因果推断理论基础的理解。",
            "id": "4576125",
            "problem": "一位研究者分析了一个观察性队列，以估计一个二元处理 $A \\in \\{0,1\\}$ 对一个标量结果 $Y$ 的因果效应。令潜在结果为 $Y(1)$ 和 $Y(0)$，并令观测结果满足稳定单位处理值假设 (SUTVA) 的一致性部分：$Y = Y(A)$。令 $X$ 表示一个测量的基线协变量向量。该研究者假设条件可交换性，即对于每个 $a \\in \\{0,1\\}$，$Y(a) \\perp A \\mid X$，并且还假设正性，即对于每个具有正密度的协变量值，$0  \\Pr(A=1 \\mid X)  1$。\n\n考虑以下使用潜在结果进行因果推断的缺失数据框架：对于每个个体，两个潜在结果中的一个是未被观测到的。为潜在结果定义观测指示符如下：对于每个 $a \\in \\{0,1\\}$，如果该个体的 $Y(a)$ 被观测到，则 $R_a$ 等于 $1$，否则为 $0$。\n\n在条件可交换性下，哪个选项最能描述如何将此设置构建为一个缺失数据问题，并正确地对 $Y(1)$ 和 $Y(0)$ 的缺失机制进行分类？请选择唯一最佳选项。\n\nA. 定义 $R_a = \\mathbb{I}(A=a)$，使得当且仅当 $A=a$ 时观测到 $Y(a)$。在条件可交换性 $Y(a) \\perp A \\mid X$ 下，$Y(a)$ 的缺失在给定 $X$ 时是随机缺失 (Missing At Random, MAR)，因为在给定 $(Y(a),X)$ 的条件下 $R_a=1$ 的概率不依赖于 $Y(a)$。在一个 $A \\perp (X,Y(0),Y(1))$ 的完全随机试验中，缺失是完全随机缺失 (Missing Completely At Random, MCAR)。\n\nB. 定义 $R_a = \\mathbb{I}(A=a)$，使得当且仅当 $A=a$ 时观测到 $Y(a)$。即使在条件可交换性 $Y(a) \\perp A \\mid X$ 下，$Y(a)$ 的缺失也是非随机缺失 (Missing Not At Random, MNAR)，因为未观测到的 $Y(a)$ 必然在 $X$ 之外影响处理选择。\n\nC. 定义 $R_a = \\mathbb{I}(A=a)$，使得当且仅当 $A=a$ 时观测到 $Y(a)$。在任何具有正性的观察性研究中，$Y(a)$ 的缺失是完全随机缺失 (Missing Completely At Random, MCAR)，因为正性意味着处理是随机分配的。\n\nD. 定义 $R_a = \\mathbb{I}(Y=a)$，使得当实现的结果等于 $a$ 时观测到 $Y(a)$。在条件可交换性 $Y(a) \\perp A \\mid X$ 下，$Y(a)$ 的缺失是随机缺失 (MAR) 而无需以 $X$ 为条件，因为 $A$ 与 $Y(a)$ 边际独立。",
            "solution": "问题陈述已经过验证，被认为是合理的。它描述了现代因果推断中使用潜在结果框架的标准设置，并正确地提出了一个关于因果假设与缺失数据机制之间关系的问题。所有术语都定义明确，前提内部一致，并基于已建立的统计理论。\n\n该问题要求将潜在结果的观测构建为一个缺失数据问题，并对由此产生的缺失机制进行分类。\n\n首先，让我们将缺失数据框架形式化。对于每个个体，“完整数据”可以被认为是潜在结果对 $(Y(0), Y(1))$ 以及基线协变量 $X$。由于处理分配的性质，这些潜在结果中只有一个能被观测到。观测结果 $Y$ 由一致性假设给出：$Y = Y(A)$。这意味着如果一个个体接受处理 $A=1$，我们观测到 $Y=Y(1)$，而 $Y(0)$ 是未被观测到的（缺失）。如果一个个体接受处理 $A=0$，我们观测到 $Y=Y(0)$，而 $Y(1)$ 是缺失的。\n\n因此，用于观测潜在结果 $Y(a)$ 的指示变量 $R_a$ 由处理分配 $A$ 定义。当且仅当个体接受了处理 $a$ 时，我们才能观测到 $Y(a)$。因此，对于 $a \\in \\{0,1\\}$，观测指示符是 $R_a = \\mathbb{I}(A=a)$，其中 $\\mathbb{I}(\\cdot)$ 是指示函数。\n\n接下来，我们对缺失机制进行分类。分类取决于缺失概率与数据（包括观测到的和未观测到的）之间的关系。让我们分析观测到 $Y(a)$ 的概率，即 $\\Pr(R_a=1, \\dots)$。\n\n标准定义如下：\n- **完全随机缺失 (MCAR):** 缺失概率与观测数据和未观测数据都无关。形式上，$\\Pr(R_a = 1 \\mid Y(a), Y(1-a), X) = \\Pr(R_a = 1)$。\n- **随机缺失 (MAR):** 在给定观测数据的条件下，缺失概率与未观测数据无关。对于 $Y(a)$ 的缺失，这意味着观测到 $Y(a)$ 的概率可以依赖于观测变量（如 $X$），但不依赖于 $Y(a)$ 本身的值。形式上，$\\Pr(R_a = 1 \\mid Y(a), Y(1-a), X) = \\Pr(R_a = 1 \\mid Y(1-a), X)$。\n- **非随机缺失 (MNAR):** 即使在以观测数据为条件后，缺失概率仍然依赖于未观测数据。\n\n让我们在给定假设下评估观测到 $Y(a)$ 的概率。事件 $\\{R_a=1\\}$ 等同于事件 $\\{A=a\\}$。因此，我们正在研究概率 $\\Pr(A=a \\mid Y(a), Y(1-a), X)$。条件可交换性假设 $Y(a) \\perp A \\mid X$ 的一个更强且标准的版本是联合条件可交换性，即 $(Y(0),Y(1)) \\perp A \\mid X$。我们以此标准假设进行分析。\n\n在条件可交换性下，我们有：\n$$ \\Pr(R_a = 1 \\mid Y(a), Y(1-a), X) = \\Pr(A=a \\mid Y(0), Y(1), X) = \\Pr(A=a \\mid X) $$\n这个结果概率 $\\Pr(A=a \\mid X)$ 依赖于协变量向量 $X$，而 $X$ 是完全观测到的。它不依赖于潜在结果 $Y(a)$（当 $A \\neq a$ 时，这将是“缺失值”），也不依赖于 $Y(1-a)$。这符合 MAR 的定义，其中 $Y(a)$ 的缺失是以观测变量 $X$ 为条件的。\n\n现在，让我们考虑完全随机试验的特殊情况。在此类试验中，处理分配 $A$ 与所有处理前变量无关，包括已测量的 ($X$) 和未测量的（潜在结果 $Y(0), Y(1)$）。这对应于一个更强的假设，即无条件可交换性：$A \\perp (X, Y(0), Y(1))$。\n在此假设下：\n$$ \\Pr(R_a = 1 \\mid Y(a), Y(1-a), X) = \\Pr(A=a \\mid Y(0), Y(1), X) = \\Pr(A=a) $$\n观测到 $Y(a)$ 的概率是一个常数 $\\Pr(A=a)$，它不依赖于 $X$ 或潜在结果。这就是 MCAR 的定义。\n\n通过这个推导，我们现在可以评估各个选项。\n\nA. 定义 $R_a = \\mathbb{I}(A=a)$，使得当且仅当 $A=a$ 时观测到 $Y(a)$。在条件可交换性 $Y(a) \\perp A \\mid X$ 下，$Y(a)$ 的缺失在给定 $X$ 时是随机缺失 (Missing At Random, MAR)，因为在给定 $(Y(a),X)$ 的条件下 $R_a=1$ 的概率不依赖于 $Y(a)$。在一个 $A \\perp (X,Y(0),Y(1))$ 的完全随机试验中，缺失是完全随机缺失 (Missing Completely At Random, MCAR)。\n- $R_a = \\mathbb{I}(A=a)$ 的定义是正确的。\n- 在条件可交换性下，将缺失机制分类为给定 $X$ 时的 MAR 是正确的，如我们的推导所示。所提供的理由也是正确的。$\\Pr(R_a=1 \\mid Y(a),X) = \\Pr(A=a \\mid Y(a),X)$，根据条件可交换性，这等于 $\\Pr(A=a \\mid X)$，此量不依赖于 $Y(a)$。\n- 在完全随机试验中将缺失机制分类为 MCAR 也是正确的，如上文推导。\n- **结论：正确。**\n\nB. 定义 $R_a = \\mathbb{I}(A=a)$，使得当且仅当 $A=a$ 时观测到 $Y(a)$。即使在条件可交换性 $Y(a) \\perp A \\mid X$ 下，$Y(a)$ 的缺失也是非随机缺失 (MNAR)，因为未观测到的 $Y(a)$ 必然在 $X$ 之外影响处理选择。\n- $R_a = \\mathbb{I}(A=a)$ 的定义是正确的。\n- 声称缺失是 MNAR 是不正确的。条件可交换性假设 $Y(a) \\perp A \\mid X$ 正是确保一旦以 $X$ 为条件，缺失就*不是* MNAR（相对于 $Y(a)$）的条件。该选项的理由描述了一种违反给定假设的情景。\n- **结论：不正确。**\n\nC. 定义 $R_a = \\mathbb{I}(A=a)$，使得当且仅当 $A=a$ 时观测到 $Y(a)$。在任何具有正性的观察性研究中，$Y(a)$ 的缺失是完全随机缺失 (MCAR)，因为正性意味着处理是随机分配的。\n- $R_a = \\mathbb{I}(A=a)$ 的定义是正确的。\n- 声称在任何观察性研究中缺失都是 MCAR 是不正确的。要使缺失为 MCAR，我们需要 $\\Pr(A=a \\mid X)$ 在所有 $X$ 上都是常数，这是随机试验的定义特征，而不是一般观察性研究的特征，在后者中混淆（$A$ 对 $X$ 的依赖性）是主要问题。\n- “正性意味着处理是随机分配的”这一理由是错误的。正性 ($0  \\Pr(A=1|X)  1$) 仅仅确保对于由 $X$ 定义的任何组，都有一定的机会接受任一处理，这对于估计是必要的。它并不意味着这个机会对所有组都是相同的。\n- **结论：不正确。**\n\nD. 定义 $R_a = \\mathbb{I}(Y=a)$，使得当实现的结果等于 $a$ 时观测到 $Y(a)$。在条件可交换性 $Y(a) \\perp A \\mid X$ 下，$Y(a)$ 的缺失是随机缺失 (MAR) 而无需以 $X$ 为条件，因为 $A$ 与 $Y(a)$ 边际独立。\n- 定义 $R_a = \\mathbb{I}(Y=a)$ 是不合逻辑的。一个用于观测 $Y(a)$ 的指示符不能以这种方式依赖于观测结果 $Y$。当分配了处理 $A=a$ 时，我们才能观测到 $Y(a)$。这个初始前提是有缺陷的。\n- 对于一般的观察性研究，结论“缺失是 MAR 而无需以 $X$ 为条件”也是不正确的。这需要边际独立性 $A \\perp Y(a)$，这是随机试验的无条件可交换性假设，而不是问题中给出的条件可交换性假设。一般来说，$Y(a) \\perp A \\mid X$ 并不意味着 $Y(a) \\perp A$。\n- **结论：不正确。**\n\n基于此分析，选项 A 是唯一一个正确构建问题并根据指定条件准确分类缺失机制的选项。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "反事实框架下的因果推断不仅依赖于可交换性，还依赖于其他关键假设，例如“一致性”（consistency），即观察到的结果等于特定处理下的潜在结果（$Y=Y(A)$）。本练习  探讨了一个普遍存在的实际问题——暴露测量误差，并要求您通过一个具体的概率模型来证明，使用被错误分类的暴露变量（$A^\\ast$）将如何从根本上破坏一致性假设，进而强调了数据质量在因果分析中的关键作用。",
            "id": "4576112",
            "problem": "考虑一项队列研究，其中真实的二元暴露由 $A \\in \\{0,1\\}$ 表示，二元结局为 $Y \\in \\{0,1\\}$。对于每个个体，潜在结局为 $(Y(1),Y(0))$。稳定单位治疗价值假设 (Stable Unit Treatment Value Assumption, SUTVA) 指出，如果一个个体接受暴露水平 $A=a$，那么观察到的结局满足一致性关系 $Y=Y(a)$。然而，分析师观察不到真实的暴露 $A$，而是从一个易出错的记录中获得一个被错误测量的二元代理变量 $A^\\ast \\in \\{0,1\\}$。\n\n假设以下科学上合理的数据生成结构：\n- 人群中潜在结局的分布如下：有 $0.4$ 的概率，个体是响应者，其 $(Y(1),Y(0))=(0,1)$；有 $0.6$ 的概率，个体无论暴露与否都是非病例，其 $(Y(1),Y(0))=(0,0)$。不存在暴露会增加风险的个体。\n- 真实暴露 $A$ 独立于潜在结局，且 $\\Pr(A=1)=0.5$。\n- 错误测量的暴露 $A^\\ast$ 对于 $A$ 的灵敏度为 $0.8$，特异度为 $0.8$，并且是无差异的，即 $A^\\ast \\perp\\!\\!\\!\\perp (Y(1),Y(0)) \\mid A$。\n\n一位分析师不知道 $A$ 和 $A^\\ast$ 之间的区别，尝试使用 $A^\\ast$ 应用一致性关系，并非正式地推理，就好像 $Y=Y(A^\\ast)$ 是有效的一样。\n\n仅使用上述定义和给定的数据生成结构（不要假设任何额外的捷径或未提及的公式），以下哪个或哪些陈述是正确的？\n\nA. 在此设定中，等式 $Y=Y(A^\\ast)$ 不成立，因为对于 $A^\\ast \\neq A$ 的个体，根据 SUTVA，观察到的结局 $Y$ 等于 $Y(A)$，而除非对所有个体都有 $Y(0)=Y(1)$，否则 $Y(A)$ 不必等于 $Y(A^\\ast)$。\n\nB. 错误分类的无差异性质意味着 $Y=Y(A^\\ast)$ 在平均意义上成立，因此在此设定中，通过用 $A^\\ast$ 替代 $A$ 计算出的因果效应是无偏的。\n\nC. 如果灵敏度和特异度都恰好为 $1$，那么 $A^\\ast=A$ 几乎必然成立，并且根据 SUTVA，等式 $Y=Y(A^\\ast)$ 将成立。\n\nD. 即使灵敏度和特异度已知且严格小于 $1$，平均处理效应 $\\mathbb{E}[Y(1)-Y(0)]$ 也总能仅从 $(Y,A^\\ast)$ 的联合分布中被识别，而无需任何关于 $A$ 和 $(Y(1),Y(0))$ 之间关系的进一步假设。\n\n选择所有适用的选项。",
            "solution": "该问题设置了一个包含暴露测量误差的因果推断场景，并要求评估关于“一致性”假设后果的陈述。该问题设定合理，所有概率均已明确定义，允许进行直接计算和逻辑推导。\n\n**分析选项A：**\n该选项声称 $Y=Y(A^\\ast)$ 不成立。一致性假设（SUTVA 的一部分）指出，观察到的结局 $Y$ 等于真实暴露水平下的潜在结局，即 $Y=Y(A)$。如果一个体被错误分类，即 $A \\neq A^\\ast$，那么 $Y(A)$ 不一定等于 $Y(A^\\ast)$。\n具体来说，考虑一个“响应者”类型的个体，其潜在结局为 $(Y(1),Y(0))=(0,1)$。假设该个体真实暴露为 $A=1$，但被错误地测量为 $A^\\ast=0$。\n- 根据真实的一致性，其观察结局为 $Y = Y(A) = Y(1) = 0$。\n- 如果我们错误地应用基于 $A^\\ast$ 的一致性，我们会得出 $Y = Y(A^\\ast) = Y(0) = 1$。\n由于 $0 \\neq 1$，对于这个被错误分类的个体，$Y=Y(A^\\ast)$ 不成立。因为存在错误分类（灵敏度和特异度小于1）和效应异质性（即存在 $Y(1) \\neq Y(0)$ 的个体），所以该等式在总体上不成立。因此，陈述A是正确的。\n\n**分析选项B：**\n该选项声称因果效应的估计是无偏的。这是一个错误的结论。测量误差通常会导致偏倚。我们可以计算真实的平均处理效应（ATE）和使用 $A^\\ast$ 计算出的朴素关联差异来验证。\n- **真实 ATE**: ATE = $E[Y(1)] - E[Y(0)]$。\n  - $E[Y(1)] = 1 \\cdot \\Pr(Y(1)=1) = 0$。根据设定，所有个体的 $Y(1)$ 都是0。\n  - $E[Y(0)] = 1 \\cdot \\Pr(Y(0)=1) = 1 \\cdot \\Pr(\\text{类型}=(0,1)) = 0.4$。\n  - 因此，真实 ATE = $0 - 0.4 = -0.4$。\n- **朴素关联差异**: $E[Y \\mid A^\\ast=1] - E[Y \\mid A^\\ast=0]$。\n  - 首先，由于真实暴露 $A$ 与潜在结局无关（无条件可交换性），我们有 $E[Y \\mid A=a] = E[Y(a)]$。所以 $E[Y \\mid A=1]=0$，$E[Y \\mid A=0]=0.4$。\n  - 使用全期望定律：$E[Y \\mid A^\\ast=a^\\ast] = E[Y \\mid A=1]\\Pr(A=1 \\mid A^\\ast=a^\\ast) + E[Y \\mid A=0]\\Pr(A=0 \\mid A^\\ast=a^\\ast) = 0.4 \\cdot \\Pr(A=0 \\mid A^\\ast=a^\\ast)$。\n  - 利用贝叶斯定理计算后验概率（使用 $\\Pr(A=1)=\\Pr(A=0)=0.5$，Se=0.8, Sp=0.8）：\n    - $\\Pr(A^\\ast=1) = \\Pr(A^\\ast=1|A=1)\\Pr(A=1) + \\Pr(A^\\ast=1|A=0)\\Pr(A=0) = 0.8 \\cdot 0.5 + 0.2 \\cdot 0.5 = 0.5$。\n    - $\\Pr(A=0 \\mid A^\\ast=1) = \\frac{\\Pr(A^\\ast=1 \\mid A=0)\\Pr(A=0)}{\\Pr(A^\\ast=1)} = \\frac{0.2 \\cdot 0.5}{0.5} = 0.2$。\n    - $\\Pr(A=0 \\mid A^\\ast=0) = \\frac{\\Pr(A^\\ast=0 \\mid A=0)\\Pr(A=0)}{\\Pr(A^\\ast=0)} = \\frac{0.8 \\cdot 0.5}{0.5} = 0.8$。\n  - 因此：\n    - $E[Y \\mid A^\\ast=1] = 0.4 \\cdot 0.2 = 0.08$。\n    - $E[Y \\mid A^\\ast=0] = 0.4 \\cdot 0.8 = 0.32$。\n  - 朴素关联差异 = $0.08 - 0.32 = -0.24$。\n由于 $-0.24 \\neq -0.4$，使用错误测量的暴露得出的关联差异是有偏的，不能作为ATE的无偏估计。因此，陈述B是不正确的。\n\n**分析选项C：**\n该选项陈述，如果灵敏度和特异度都为1，那么 $Y=Y(A^\\ast)$ 将成立。\n- 灵敏度为1意味着 $\\Pr(A^\\ast=1 \\mid A=1)=1$。\n- 特异度为1意味着 $\\Pr(A^\\ast=0 \\mid A=0)=1$（等价于 $\\Pr(A^\\ast=1 \\mid A=0)=0$）。\n这两个条件共同意味着 $\\Pr(A^\\ast \\neq A) = 0$，即 $A^\\ast = A$ 几乎必然成立。\n在这种情况下，SUTVA假设 $Y=Y(A)$ 直接可以写成 $Y=Y(A^\\ast)$。因此，陈述C是正确的。\n\n**分析选项D：**\n该选项声称，即使知道测量误差参数，ATE也可以仅从 $(Y, A^\\ast)$ 的联合分布中被识别，而无需关于 $A$ 和潜在结局之间关系的进一步假设。\n这是一个关于因果可识别性的深刻问题。从观测数据 $(Y, A^\\ast)$ 和已知的测量误差参数（Se, Sp），我们可以通过统计方法（如期望最大化算法或贝叶斯方法）来估计真实暴露和结局的联合分布 $\\Pr(Y, A)$。然而，从 $\\Pr(Y, A)$ 得到因果效应 ATE = $E[Y(1)] - E[Y(0)]$，需要一个关键的、不可检验的因果假设，通常是可交换性（例如，本题中给出的 $A \\perp (Y(1),Y(0))$）。这个假设是关于数据生成过程的，它无法仅从 $\\Pr(Y,A)$ 的分布中得到验证或推断。选项明确排除了这类“进一步假设”。没有可交换性假设，我们就无法将关联 $\\Pr(Y|A)$ 与因果效应 $E[Y(a)]$ 联系起来。因此，陈述D是不正确的。\n\n综上所述，正确的陈述是A和C。",
            "answer": "$$\\boxed{AC}$$"
        }
    ]
}