{
    "hands_on_practices": [
        {
            "introduction": "在任何回归断点设计（RDD）分析中，可视化检验都是至关重要的第一步。一幅精心构建的图表不仅能直观地揭示在断点处的潜在处理效应，还能作为一种强大的诊断工具，用以评估设计的有效性。本练习  聚焦于创建RDD图表的最佳实践，包括数据分箱散点图和局部多项式拟合。掌握这项技能将使你能够有效地沟通研究发现，并批判性地评估RDD核心假设的合理性，例如检验是否存在驱动变量的人为操控。",
            "id": "4629748",
            "problem": "一个流行病学团队评估一项公共资助的流感疫苗接种计划的参与资格对一年内住院率的因果效应。参与资格由一个年龄断点 $c = 65$ 岁确定性地分配：个体的驱动变量 $X_i$ 为其精确年龄（以年为单位，精确到天），当且仅当 $X_i \\ge c$ 时，该个体接受处理。设观测结果为 $Y_i$，处理指标为 $D_i = \\mathbf{1}\\{X_i \\ge c\\}$，潜在结果为 $Y_i(1)$ 和 $Y_i(0)$。回归断点设计依赖于连续性假设，即 $\\mathbb{E}[Y_i(d)\\mid X_i = x]$ 对于 $d \\in \\{0,1\\}$ 在 $x = c$ 处是连续的，因此目标参数是断点处的跳跃，\n$$\n\\tau = \\lim_{x \\downarrow c} \\mathbb{E}[Y_i \\mid X_i = x] - \\lim_{x \\uparrow c} \\mathbb{E}[Y_i \\mid X_i = x].\n$$\n该团队希望构建一个信息丰富的回归断点图，图中包含分箱散点，并在 $c$ 的两侧叠加局部多项式拟合，以便直观地评估该设计及其假设的合理性。\n\n以下哪些程序和解释正确描述了如何构建这样的图，以及哪些视觉特征支持或削弱了该设计的有效性？\n\nA. 对驱动变量 $X_i$ 创建不跨越 $c$ 的分箱；在每个箱内，计算 $Y_i$ 的均值，并在该箱的中点处绘制该均值。在 $c$ 的左侧和右侧叠加独立的局部多项式拟合（例如，局部线性），这些拟合仅使用相应一侧满足 $|X_i - c| \\le h$ 的观测值进行估计，并使用核权重来降低离 $c$ 较远的点的影响，同时不强制曲线在 $x=c$ 处相交。\n\nB. 汇集 $c$ 两侧的所有观测值，并在 $X_i$ 的整个支撑集上拟合一个次数为 $k \\ge 4$ 的高阶全局多项式；使用拟合的曲线来推断 $c$ 处的跳跃，因为高阶多项式能够灵活地在各处逼近条件均值函数。\n\nC. 设置足够大的箱宽，使得大多数箱都跨越很宽的 $X_i$ 范围（例如，箱宽远大于用于局部多项式的带宽 $h$），因为更大的箱可以减少分箱均值中的噪声，并使得在 $x = c$ 附近绘制的曲线更平滑。\n\nD. 直观地检查叠加的局部拟合在远离 $x = c$ 的地方是否平滑，以及 $Y_i$ 在 $x = c$ 处是否有明显的离散跳跃，同时检查辅助图以确认预定协变量或 $X_i$ 的密度在 $x = c$ 处没有可见的不连续性；$X_i$ 在 $c$ 附近没有聚集现象支持了设计的有效性。\n\nE. 为了避免图中断点处的选择偏误，丢弃所有满足 $|X_i - c| \\le \\delta$（对于某个小的 $\\delta  0$）的观测值，这样所绘制的不连续性就不会被接近 $c$ 的特异观测值所驱动。\n\nF. 可以接受使用分位数等距分箱，使得每侧每个箱内的计数大致相等；计算箱内 $Y_i$ 的均值，并根据箱内 $X_i$ 的均值或中位数进行绘图，同时确保分箱不跨越 $c$。作为稳健性检验，应使用几个合理的带宽 $h$ 和多项式次数重复绘图，以评估明显的跳跃和远离 $c$ 的平滑性是否稳定。\n\n选择所有适用项。",
            "solution": "问题陈述描述了一个清晰回归断点 (RD) 设计，这是一种用于因果推断的准实验方法。该设定在科学上是有效的，并且定义明确。RD设计的核心是比较驱动变量 $X_i$ 恰好在断点 $c$ 以下的观测值与恰好在其以上的观测值。关键的识别假设是在 $x=c$ 处，潜在结果的条件期望 $\\mathbb{E}[Y_i(d) \\mid X_i = x]$ 是连续的。目标是评估构建和解释RD图的程序，RD图是可视化处理效应和评估设计合理性的主要工具。\n\n让我们根据回归断点分析的既定原则来分析每个选项。\n\n**A. 对驱动变量 $X_i$ 创建不跨越 $c$ 的分箱；在每个箱内，计算 $Y_i$ 的均值，并在该箱的中点处绘制该均值。在 $c$ 的左侧和右侧叠加独立的局部多项式拟合（例如，局部线性），这些拟合仅使用相应一侧满足 $|X_i - c| \\le h$ 的观测值进行估计，并使用核权重来降低离 $c$ 较远的点的影响，同时不强制曲线在 $x=c$ 处相交。**\n\n该选项精确且正确地描述了创建RD图的现代最佳实践。\n1.  **分箱**：原始数据通常过于密集，难以有效可视化。将数据按驱动变量 $X_i$ 分成离散的区间（分箱），并为每个箱绘制平均结果 $\\bar{Y}$ 是一种标准技术。至关重要的是，任何箱都不能跨越断点 $c$，因为这会混合处理组和未处理组的单位，从而掩盖不连续性。在箱的中点（或者更准确地说，在箱内 $X_i$ 的均值处）绘制箱的均值是正确的程序。\n2.  **局部多项式回归**：估计断点两侧回归函数的最先进方法是局部多项式回归（最常见的是局部线性回归，即次数 $p=1$ 的多项式）。此方法优于全局多项式，因为RD估计量是在点 $x=c$ 处定义的*局部*参数。\n3.  **分别拟合**：必须对 $X_i  c$ 和 $X_i \\ge c$ 的数据分别估计回归函数。强制曲线在 $c$ 处连续将意味着假设没有处理效应的原假设（$\\tau=0$），这会使分析的目的落空。\n4.  **带宽和核函数**：局部多项式回归是在断点的一个带宽 $h$ 内的数据子集上执行的（即 $c-h \\le X_i  c$ 和 $c \\le X_i \\le c+h$）。通常会应用核权重，以给予更靠近断点 $c$ 的观测值更大的影响，这是该估计量局部性质的核心。\n\n整个程序旨在为断点处的跳跃提供一个稳健的视觉和定量估计。\n\n**对A的结论：正确。**\n\n**B. 汇集 $c$ 两侧的所有观测值，并在 $X_i$ 的整个支撑集上拟合一个次数为 $k \\ge 4$ 的高阶全局多项式；使用拟合的曲线来推断 $c$ 处的跳跃，因为高阶多项式能够灵活地在各处逼近条件均值函数。**\n\n这描述了一种过时且现在被强烈反对的方法。虽然理论上可以使用带有处理指标的全局多项式（例如，$Y_i = P_k(X_i) + \\tau D_i + \\epsilon_i$）来为不连续性建模，但这种方法已被证明非常不可靠。\n1.  **不稳定性**：高阶多项式（$k \\ge 2$，尤其是 $k \\ge 4$）众所周知容易产生人为的“摆动”，并且在数据支撑集的边界附近表现不佳。估计的跳跃 $\\hat{\\tau}$ 对多项式次数 $k$ 的选择可能极其敏感。\n2.  **局部与全局**：RD效应本质上是断点 $c$ 处的局部现象。全局多项式使用远处的观测值来推断断点处函数的形状，这会引入显著的偏误。如选项A所述，局部多项式方法更为稳健，并且与估计量的局部性质更相符。该领域的领军方法学家已强烈建议不要在RD分析中使用高阶全局多项式。\n\n**对B的结论：不正确。**\n\n**C. 设置足够大的箱宽，使得大多数箱都跨越很宽的 $X_i$ 范围（例如，箱宽远大于用于局部多项式的带宽 $h$），因为更大的箱可以减少分箱均值中的噪声，并使得在 $x = c$ 附近绘制的曲线更平滑。**\n\n这个程序是不明智的。虽然更大的箱确实能减少分箱均值的方差（更少的“噪声”），但这是以引入巨大偏误为代价的。RD图旨在可视化断点周围条件均值函数的局部行为。使用非常大的箱宽会在很宽的 $X_i$ 值范围内对结果 $Y_i$ 进行平均。如果底层函数 $\\mathbb{E}[Y_i \\mid X_i = x]$ 不是平坦的，这种平均将产生一个不能准确代表函数在箱中心值的的分箱均值。这在断点附近尤其成问题，因为大箱会模糊并隐藏我们希望观察到的不连续性。分箱是一种视觉辅助工具；其分辨率应足够精细以跟踪局部多项式拟合，而不应粗糙到与之相矛盾。使用远宽于估计带宽 $h$ 的分箱在概念上是不一致的。\n\n**对C的结论：不正确。**\n\n**D. 直观地检查叠加的局部拟合在远离 $x = c$ 的地方是否平滑，以及 $Y_i$ 在 $x = c$ 处是否有明显的离散跳跃，同时检查辅助图以确认预定协变量或 $X_i$ 的密度在 $x = c$ 处没有可见的不连续性；$X_i$ 在 $c$ 附近没有聚集现象支持了设计的有效性。**\n\n该选项正确描述了RD图的解释和必要的辅助诊断检验。\n1.  **结果图的检查**：如果存在处理效应，$Y_i$ 相对于 $X_i$ 的主图应在 $c$ 处显示出清晰的跳跃，并且两侧的函数应相当平滑，没有其他跳跃或奇怪的模式。\n2.  **协变量平衡检验**：一个关键的有效性检验是为预定协变量（在处理决定前其值就已确定的变量，例如性别、基线健康状况）创建RD图。连续性假设意味着潜在结果的分布在阈值两侧是平滑的。推而广之，任何预定特征的分布也应该是平滑的。协变量在 $c$ 处的跳跃表明，断点上下的人群在处理分配之外的其他方面也存在差异，这削弱了因果解释。\n3.  **密度检验（操纵检验）**：另一个关键检验是检查驱动变量 $X_i$ 的密度。如果个体能够精确操纵他们的 $X_i$ 值以获得或避免处理，我们可能会看到一个非随机的分类模式，例如在 $c$ 正下方密度下降，而在 $c$ 正上方密度激增。这将违反代理人无法完全控制驱动变量的假设。穿过断点的平滑密度支持了设计的有效性。“没有聚集现象”与密度平滑是同义词。\n\n**对D的结论：正确。**\n\n**E. 为了避免图中断点处的选择偏误，丢弃所有满足 $|X_i - c| \\le \\delta$（对于某个小的 $\\delta  0$）的观测值，这样所绘制的不连续性就不会被接近 $c$ 的特异观测值所驱动。**\n\n这描述了一种“甜甜圈空洞”RD。这不是一种标准或推荐的主要分析策略。RD的全部逻辑依赖于断点*两侧紧邻*的个体的可比性。丢弃这些信息最丰富的观测值，就是抛弃了识别策略核心的数据。这种方法从根本上改变了估计量，并且如果回归函数不是平坦的，它可能会引入自身的偏误。虽然在极少数情况下，当对断点附近的数据质量有特定担忧时，它可能被用作补充性的敏感性分析，但将其描述为“避免选择偏误”的标准方法是不正确的。标准的RD框架已经通过连续性假设解释了基于 $X_i$ 的处理选择。\n\n**对E的结论：不正确。**\n\n**F. 可以接受使用分位数等距分箱，使得每侧每个箱内的计数大致相等；计算箱内 $Y_i$ 的均值，并根据箱内 $X_i$ 的均值或中位数进行绘图，同时确保分箱不跨越 $c$。作为稳健性检验，应使用几个合理的带宽 $h$ 和多项式次数重复绘图，以评估明显的跳跃和远离 $c$ 的平滑性是否稳定。**\n\n该选项描述了RD分析中其他有效且重要的程序。\n1.  **分位数等距分箱**：与等宽分箱（如果数据稀疏，可能导致某些箱的观测值很少）不同，创建包含相同数量观测值的箱是一种常见且可接受的做法。这有助于在 $X_i$ 的支撑集上稳定分箱均值的方差。与任何分箱方法一样，必须将箱的结果均值与箱内 $X_i$ 的均值进行绘图，并确保没有箱跨越断点 $c$。\n2.  **稳健性检验**：一个可信的RD分析必须证明其主要发现不过分依赖于任意的模型选择。因此，通过使用不同的带宽 ($h$) 和不同的局部多项式次数（例如，比较局部线性, $p=1$, 和局部二次, $p=2$）重新估计效应来检查结果的稳健性是至关重要的。如果估计的跳跃和图的整体形状在这些变化中保持稳定，就会增加研究结果的可信度。\n\n**对F的结论：正确。**",
            "answer": "$$\\boxed{ADF}$$"
        },
        {
            "introduction": "在完成数据的可视化检查之后，下一步是量化处理效应。局部线性回归是现代RDD分析的基石，它为估计断点处的跳跃提供了一种稳健的方法。本练习  将指导你通过编码实现一个核加权的局部线性回归模型来估计处理效应，并引入了加入协变量以检验结果稳健性的重要实践。通过完成此练习，你将获得从零开始实施RDD估计器的实践经验，并理解协变量调整如何增强因果推断的可信度。",
            "id": "3168528",
            "problem": "考虑一个在医疗分诊场景下的精确断点回归设计 (RDD)，其中重症监护是根据一个阈值规则来分配的。设驱动变量为临床风险评分 $X \\in \\mathbb{R}$，断点为 $c \\in \\mathbb{R}$，处理指标定义为 $T = \\mathbb{1}\\{X \\geq c\\}$。结果变量 $Y \\in \\{0,1\\}$ 表示死亡率（$Y=1$ 表示死亡），风险调整协变量 $Z \\in \\mathbb{R}$ 概括了基线风险。我们感兴趣的因果估计量是断点处的局部平均处理效应，即 $Y$ 的条件期望在 $X=c$ 处的跳跃。您的任务是使用核加权最小二乘法实现一个局部线性估计量，以估计在断点处的不连续性，包括不使用和使用协变量 $Z$ 进行风险调整两种情况，然后评估估计效应对于此调整的稳健性。\n\n该设计的基本依据如下：\n- 令 $Y(1)$ 和 $Y(0)$ 分别表示在处理和控制下的潜在结果，并假定满足稳定单位处理价值假设 (SUTVA)。在精确分配机制 $T=\\mathbb{1}\\{X \\ge c\\}$ 以及条件期望 $\\mathbb{E}[Y(0)\\mid X=x]$ 和 $\\mathbb{E}[Y(1)\\mid X=x]$ 在 $x=c$ 处连续的假设下，断点处的局部平均处理效应等于 $\\mathbb{E}[Y\\mid X=x]$ 在 $x=c$ 处的不连续性。\n- 局部线性估计量通过在断点 $c$ 两侧使用中心化的驱动变量 $R = X - c$ 的线性函数来近似条件期望，该拟合在带宽 $h0$ 内进行，并使用核权重来降低离断点较远的数据点的影响。\n\n实现要求：\n- 在带宽 $h$ 内，使用三角核权重 $K(u) = (1 - |u|)\\mathbb{1}\\{|u|\\le 1\\}$，其中 $u = R/h$，因此每个点的权重为 $w_i = (1 - |R_i|/h)\\mathbb{1}\\{|R_i|\\le h\\}$。\n- 对满足 $|R|\\le h$ 的观测值，通过加权最小二乘法拟合以下局部线性设定：\n  1. 未调整：将 $Y$ 对列向量 $(1, T, R, T\\cdot R)$ 进行回归，并将 $T$ 的系数作为估计的不连续性。\n  2. 风险调整：将 $Y$ 对 $(1, T, R, T\\cdot R, Z)$ 进行回归，并同样将 $T$ 的系数作为估计的不连续性。\n- 对于每个测试用例，报告三个量：未调整的估计值（浮点数）、风险调整的估计值（浮点数），以及一个稳健性指标（布尔值）。如果调整后和未调整的估计值之间的绝对差值小于或等于容差 $\\delta0$，则该指标为真，否则为假。\n\n测试套件和输入：\n对于每个测试用例，您将获得 $X$、$Y$、$Z$ 的数组，以及断点 $c$、带宽 $h$ 和稳健性容差 $\\delta$。数组如下：\n\n测试用例 1 (正常路径，中等带宽)：\n- $X = [\\,45,\\,47,\\,49,\\,50,\\,51,\\,53,\\,55,\\,46,\\,48,\\,52,\\,54,\\,44,\\,56,\\,57,\\,43,\\,58\\,]$\n- $Y = [\\,1,\\,1,\\,1,\\,0,\\,0,\\,0,\\,0,\\,1,\\,1,\\,0,\\,0,\\,1,\\,0,\\,0,\\,1,\\,0\\,]$\n- $Z = [\\,0.6,\\,0.5,\\,0.55,\\,0.58,\\,0.62,\\,0.65,\\,0.7,\\,0.52,\\,0.57,\\,0.63,\\,0.66,\\,0.48,\\,0.72,\\,0.74,\\,0.46,\\,0.76\\,]$\n- $c = 50$, $h = 5$, $\\delta = 0.05$。\n\n测试用例 2 (边界情况，小带宽)：\n- $X = [\\,45,\\,47,\\,49,\\,50,\\,51,\\,53,\\,55,\\,46,\\,48,\\,52,\\,54,\\,44,\\,56,\\,57,\\,43,\\,58\\,]$\n- $Y = [\\,1,\\,1,\\,1,\\,0,\\,0,\\,0,\\,0,\\,1,\\,1,\\,0,\\,0,\\,1,\\,0,\\,0,\\,1,\\,0\\,]$\n- $Z = [\\,0.6,\\,0.5,\\,0.55,\\,0.58,\\,0.62,\\,0.65,\\,0.7,\\,0.52,\\,0.57,\\,0.63,\\,0.66,\\,0.48,\\,0.72,\\,0.74,\\,0.46,\\,0.76\\,]$\n- $c = 50$, $h = 2$, $\\delta = 0.10$。\n\n测试用例 3 (边缘情况，强协变量影响)：\n- $X = [\\,48,\\,49,\\,50,\\,51,\\,52,\\,53,\\,47,\\,46,\\,54,\\,55,\\,45,\\,56\\,]$\n- $Y = [\\,1,\\,1,\\,0,\\,0,\\,0,\\,0,\\,1,\\,1,\\,0,\\,0,\\,1,\\,0\\,]$\n- $Z = [\\,0.9,\\,0.85,\\,0.88,\\,0.86,\\,0.83,\\,0.8,\\,0.92,\\,0.95,\\,0.78,\\,0.75,\\,0.97,\\,0.74\\,]$\n- $c = 50$, $h = 6$, $\\delta = 0.08$。\n\n算法规格：\n- 构建中心化的驱动变量 $R = X - c$。\n- 计算权重 $w_i = (1 - |R_i|/h)\\mathbb{1}\\{|R_i|\\le h\\}$，并仅限于 $w_i0$ 的观测值。\n- 为未调整和调整后的模型，按照上述描述构建设计矩阵 $D$。\n- 使用 Moore–Penrose 伪逆计算加权最小二乘估计量，以处理近奇异矩阵：估计 $\\hat{\\beta} = (D^{\\top} W D)^{+} D^{\\top} W Y$，其中 $W$ 是权重的对角矩阵，$(\\cdot)^{+}$ 表示伪逆。提取 $T$ 的系数作为估计的不连续性。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含所有三个测试用例的连接结果，格式为方括号内的逗号分隔列表。顺序必须是，先测试用例 1，然后测试用例 2，再然后测试用例 3：$[\\text{unadjusted}_1,\\text{adjusted}_1,\\text{robust}_1,\\text{unadjusted}_2,\\text{adjusted}_2,\\text{robust}_2,\\text{unadjusted}_3,\\text{adjusted}_3,\\text{robust}_3]$。布尔值必须以编程语言的原生布尔表示（true 或 false）打印，浮点数必须以十进制形式打印。不涉及物理单位或角度单位。任何百分比都必须以小数形式表示。",
            "solution": "此问题经评估为 **有效**。它在科学上基于因果推断和统计学习的原理，特别是断点回归设计 (RDD)。该问题提法明确，提供了所有必要的数据、参数以及一个清晰、数学上合理的估计算法。语言客观精确，设定自成体系且一致。\n\n任务是使用局部线性估计量来估计精确断点回归 (RDD) 中断点处的局部平均处理效应 (LATE)。这在两种设定下执行：一个未调整的模型和一个经风险协变量 $Z$ 调整的模型。然后评估估计值对这种调整的稳健性。估计过程基于核加权最小二乘法。\n\n分步过程如下：\n\n1.  **数据筛选和准备**：对于每个观测值 $i$，我们首先计算中心化的驱动变量 $R_i = X_i - c$，其中 $X_i$ 是临床风险评分，$c$ 是断点。分析被限制在断点周围的一个局部邻域内，该邻域由带宽 $h  0$ 定义。问题指定使用三角核，权重由 $w_i = (1 - |R_i|/h)\\mathbb{1}\\{|R_i|\\le h\\}$ 给出。指令“仅限于 $w_i  0$ 的观测值”意味着只有满足 $|R_i|  h$ 的观测值才被包含在回归中。对于这些选定的观测值，我们定义处理指标 $T_i = \\mathbb{1}\\{X_i \\geq c\\}$，如果观测值接受了处理，则为 1，否则为 0。\n\n2.  **未调整的局部线性 RDD 估计**：第一个模型在不调整协变量 $Z$ 的情况下估计处理效应。我们在带宽内拟合一个加权最小二乘 (WLS) 回归。模型设定为：\n    $$\n    Y_i = \\beta_0 + \\tau T_i + \\beta_1 R_i + \\beta_2 (T_i \\cdot R_i) + \\epsilon_i\n    $$\n    此模型在断点两侧分别拟合线性趋势。参数 $\\tau$ 表示在断点 $c$ 处（即 $R_i=0$）截距的跳跃，这是 LATE 的 RDD 估计值。回归量包括一个截距项 ($1$)、处理指标 ($T$)、中心化的驱动变量 ($R$) 和一个交互项 ($T \\cdot R$)。未调整模型的设计矩阵是 $D_{\\text{unadj}} = [1, T, R, T \\cdot R]$。\n\n3.  **风险调整的局部线性 RDD 估计**：第二个模型将基线风险协变量 $Z$ 作为一个额外的线性控制变量包含在内。这样做是为了评估处理效应的估计值是否对包含其他预后因素敏感。模型设定为：\n    $$\n    Y_i = \\beta_0 + \\tau_{adj} T_i + \\beta_1 R_i + \\beta_2 (T_i \\cdot R_i) + \\beta_3 Z_i + \\nu_i\n    $$\n    我们感兴趣的参数仍然是处理指标的系数 $\\tau_{adj}$。包含 $Z$ 可以提高估计的精度并检验稳健性。调整后模型的设计矩阵是 $D_{\\text{adj}} = [1, T, R, T \\cdot R, Z]$。\n\n4.  **加权最小二乘 (WLS) 计算**：两个模型都使用 WLS 进行估计。系数向量 $\\hat{\\beta}$ 使用问题陈述中指定的公式计算，该公式涉及 Moore-Penrose 伪逆 $(\\cdot)^{+}$ 以确保稳定性，特别是在存在共线性或观测值较少的情况下：\n    $$\n    \\hat{\\beta} = (D^{\\top} W D)^{+} D^{\\top} W Y\n    $$\n    在这里，$Y$ 是筛选后观测值的结果向量，$D$ 是相应的设计矩阵（$D_{\\text{unadj}}$ 或 $D_{\\text{adj}}$），$W$ 是一个对角矩阵，其对角线上是三角核权重 $w_i$。估计的处理效应（$\\hat{\\tau}$ 或 $\\hat{\\tau}_{adj}$）是所得 $\\hat{\\beta}$ 向量的第二个元素，对应于处理指标 $T$ 的系数。\n\n5.  **稳健性评估**：最后一步是比较未调整的估计值 $\\hat{\\tau}_{\\text{unadj}}$ 和风险调整的估计值 $\\hat{\\tau}_{\\text{adj}}$。如果两者之间的绝对差值在给定的容差 $\\delta$ 之内，则该估计被认为是稳健的：\n    $$\n    \\text{robust} = (|\\hat{\\tau}_{\\text{adj}} - \\hat{\\tau}_{\\text{unadj}}| \\le \\delta)\n    $$\n    这提供了一个关于研究发现稳定性的布尔指标。对于每个测试用例，最终输出将是三元组 $(\\hat{\\tau}_{\\text{unadj}}, \\hat{\\tau}_{\\text{adj}}, \\text{robust})$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef _calculate_rdd_estimate(X: np.ndarray, Y: np.ndarray, Z: np.ndarray, c: float, h: float, adjusted: bool) - float:\n    \"\"\"\n    Calculates the RDD estimate using local linear regression via WLS.\n    \"\"\"\n    # 1. Center the running variable\n    R = X - c\n    \n    # 2. Filter data to be strictly within the bandwidth (where weight w_i  0)\n    mask = np.abs(R)  h\n    \n    # If no data points are within the bandwidth, return NaN.\n    if not np.any(mask):\n        return np.nan\n\n    R_filt = R[mask]\n    Y_filt = Y[mask]\n    X_filt = X[mask]\n    Z_filt = Z[mask]\n\n    # 3. Compute triangular kernel weights\n    weights = 1 - np.abs(R_filt) / h\n    W = np.diag(weights)\n\n    # 4. Construct the design matrix D\n    intercept = np.ones_like(R_filt)\n    T_filt = (X_filt = c).astype(float)\n    TR_interaction = T_filt * R_filt\n\n    if adjusted:\n        # Columns: (1, T, R, T*R, Z)\n        D = np.stack([intercept, T_filt, R_filt, TR_interaction, Z_filt], axis=1)\n    else:\n        # Columns: (1, T, R, T*R)\n        D = np.stack([intercept, T_filt, R_filt, TR_interaction], axis=1)\n\n    # Check for underdetermined system (fewer obs than params)\n    # The use of pinv is specified to handle this case.\n    n_obs, n_params = D.shape\n    if n_obs == 0:\n        return np.nan\n\n    # 5. Compute the WLS estimator using the Moore-Penrose pseudoinverse\n    try:\n        D_T_W = D.T @ W\n        # The core formula: beta = (D'WD)^+ D'WY\n        pinv_term = np.linalg.pinv(D_T_W @ D)\n        beta_hat = pinv_term @ D_T_W @ Y_filt\n    except np.linalg.LinAlgError:\n        # This branch is unlikely with pinv but included for robustness\n        return np.nan\n\n    # 6. The RDD estimate is the coefficient on the treatment indicator T, which is the second regressor (index 1).\n    rdd_estimate = beta_hat[1]\n    \n    return rdd_estimate\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"X\": np.array([45, 47, 49, 50, 51, 53, 55, 46, 48, 52, 54, 44, 56, 57, 43, 58]),\n            \"Y\": np.array([1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0]),\n            \"Z\": np.array([0.6, 0.5, 0.55, 0.58, 0.62, 0.65, 0.7, 0.52, 0.57, 0.63, 0.66, 0.48, 0.72, 0.74, 0.46, 0.76]),\n            \"c\": 50.0,\n            \"h\": 5.0,\n            \"delta\": 0.05\n        },\n        {\n            \"X\": np.array([45, 47, 49, 50, 51, 53, 55, 46, 48, 52, 54, 44, 56, 57, 43, 58]),\n            \"Y\": np.array([1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0]),\n            \"Z\": np.array([0.6, 0.5, 0.55, 0.58, 0.62, 0.65, 0.7, 0.52, 0.57, 0.63, 0.66, 0.48, 0.72, 0.74, 0.46, 0.76]),\n            \"c\": 50.0,\n            \"h\": 2.0,\n            \"delta\": 0.10\n        },\n        {\n            \"X\": np.array([48, 49, 50, 51, 52, 53, 47, 46, 54, 55, 45, 56]),\n            \"Y\": np.array([1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0]),\n            \"Z\": np.array([0.9, 0.85, 0.88, 0.86, 0.83, 0.8, 0.92, 0.95, 0.78, 0.75, 0.97, 0.74]),\n            \"c\": 50.0,\n            \"h\": 6.0,\n            \"delta\": 0.08\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        X, Y, Z, c, h, delta = case[\"X\"], case[\"Y\"], case[\"Z\"], case[\"c\"], case[\"h\"], case[\"delta\"]\n\n        # Calculate unadjusted estimate\n        unadjusted_est = _calculate_rdd_estimate(X, Y, Z, c, h, adjusted=False)\n        \n        # Calculate risk-adjusted estimate\n        adjusted_est = _calculate_rdd_estimate(X, Y, Z, c, h, adjusted=True)\n        \n        # Assess robustness\n        is_robust = np.abs(adjusted_est - unadjusted_est) = delta\n        \n        results.extend([unadjusted_est, adjusted_est, is_robust])\n\n    # Final print statement in the exact required format.\n    # str() converts booleans to 'True'/'False' and floats to decimal strings.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "任何单一的RDD估计值都依赖于一系列分析选择，例如带宽 $h$ 和多项式阶数 $p$。为了构建一个有说服力的因果论证，证明研究结果并非特定模型设定的偶然产物至关重要。本练习  要求你设计一个全面的敏感性分析方案，它将严谨、透明的方法与常见但有缺陷的做法（如“p值操纵”或“模型筛选”）进行对比。这项实践将教会你如何系统地评估结果的稳健性，这是产出可信、可靠实证研究的关键技能。",
            "id": "4629776",
            "problem": "一位流行病学家评估一个针对老年人的免费流感疫苗接种项目的效果，该项目的参与资格由年龄决定。个体在诊所就诊时的年龄由运行变量 $X_i$ 表示，如果 $X_i \\ge c$，则符合资格，其中断点为 $c = 65$。设处理状态为 $T_i = \\mathbf{1}\\{X_i \\ge c\\}$，结果 $Y_i$ 为在随后的流感季节中是否住院的指示变量。假设这是一个清晰断点设计，其中 $T_i$ 在 $c$ 处发生确定性变化。关注的估计量是在断点处的因果效应，定义为\n$$\n\\tau \\equiv \\lim_{x \\downarrow c} \\mathbb{E}[Y_i \\mid X_i = x] - \\lim_{x \\uparrow c} \\mathbb{E}[Y_i \\mid X_i = x],\n$$\n其依据是回归断点 (RD) 识别假设，即潜在结果的条件期望在 $x = c$ 处是连续的。一个局部多项式 RD 估计量在断点 $c$ 的两侧分别拟合 $p$ 阶的核加权多项式，其核权重为 $K\\!\\left(\\frac{X_i - c}{h}\\right)$，带宽为 $h$，并通过在 $c$ 处的估计极限之差来构建 $\\hat{\\tau}$。\n\n为了评估 RD 结果的稳健性，该流行病学家希望实施一项敏感性分析，该分析系统地改变带宽、核函数和多项式阶数，同时遵循 RD 识别框架，并避免那些会引发设定搜寻或违反核心假设（例如在整个支持域上使用全局函数形式或在断点两侧使用不对称权重）的做法。\n\n以下哪个方案最能满足这一目标？\n\nA. 定义一个从样本中获得的基准均方误差最优带宽 $h^\\star$，然后在一个带宽网格 $h \\in \\{0.8h^\\star, h^\\star, 1.2h^\\star, 1.6h^\\star\\}$ 上，使用围绕 $c$ 的对称窗口来估计局部多项式 RD 效应。对于每个 $h$，拟合局部线性 ($p = 1$) 和局部二次 ($p = 2$) 设定，并将多项式以 $c$ 为中心。对于每对 $(h,p)$，使用多种核函数 $K(u)$ 进行估计，包括三角核 $K(u) = (1 - |u|)\\mathbf{1}(|u| \\le 1)$、Epanechnikov 核 $K(u) = \\frac{3}{4}(1 - u^2)\\mathbf{1}(|u| \\le 1)$ 和均匀核 $K(u) = \\mathbf{1}(|u| \\le 1)$。报告每种组合的 $\\hat{\\tau}$、标准误和置信区间，评估估计值在整个网格上的视觉稳定性，并进行诊断性检验：前置处理协变量在 $c$ 处的连续性、$X_i$ 在 $c$ 附近的密度以及安慰剂结果。不改变 $c$，并保持左右带宽相等。\n\nB. 选择使 $\\hat{\\tau}$ 的绝对 t 统计量最大化的带宽 $h$，并且只报告统计显著性最大的设定。在 $X_i$ 的整个支持域上使用全局三次多项式 ($p = 3$) 和高斯核，并且不对 $X_i$ 的操纵或协变量的连续性进行任何诊断性检验。\n\nC. 将带宽固定在基准值 $h^\\star$，并将多项式阶数固定为局部线性 ($p = 1$)。仅在三角核、Epanechnikov 核和均匀核之间改变核函数，并为每个核函数计算 $X_i \\in [c - h^\\star, c)$ 和 $X_i \\in [c, c + h^\\star]$ 之间的均值简单差异，在估计中忽略核权重，并跳过对协变量和密度的诊断性检验。\n\nD. 使用局部线性 ($p = 1$) 回归和三角核，并且仅在处理组一侧 $X_i \\ge c$ 上将 $h$ 在 $\\{h^\\star, 1.5h^\\star\\}$ 范围内变动，同时将控制组一侧的带宽固定为 $h^\\star$。将多项式以 $X_i$ 的样本均值而不是以 $c$ 为中心，检验处理后结果的不连续性，并报告所选设定的 $\\hat{\\tau}$。\n\n从选项 A–D 中选择唯一的最佳方案，该方案系统地改变带宽、核函数和多项式阶数以评估稳健性，同时遵守 RD 假设和良好的流行病学实践。",
            "solution": "问题陈述是有效的。它提出了一个在流行病学和计量经济学中关于清晰回归断点 (RD) 设计的标准情景。所有术语——运行变量 ($X_i$)、断点 ($c$)、处理状态 ($T_i$)、结果 ($Y_i$)、估计量 ($\\tau$)、识别假设和局部多项式估计——都定义正确，并与既有的科学文献一致。其目标是为敏感性分析确定最佳方案，这是应用研究中确保研究结果稳健性的一个关键步骤。为一个好方案设定的约束条件（遵循 RD 框架、避免设定搜寻以及避免违反核心假设）是严谨科学探究的标准准则。这个问题有科学依据，提法得当且客观。\n\n回归断点 (RD) 分析的目标是通过利用一个决定资格的连续变量中的断点来估计一项处理或干预的因果效应。关键的识别假设是，在没有处理的情况下，期望结果在断点处将是运行变量的连续函数。关注的估计量是在断点 $c$ 两侧结果的条件期望极限之差：\n$$\n\\tau \\equiv \\lim_{x \\downarrow c} \\mathbb{E}[Y_i \\mid X_i = x] - \\lim_{x \\uparrow c} \\mathbb{E}[Y_i \\mid X_i = x]\n$$\n这通常使用局部多项式回归来估计。在断点 $c$ 两侧，分别在围绕 $c$ 且带宽为 $h$ 的窗口内对数据拟合一个 $p$ 阶多项式。估计值 $\\hat{\\tau}$ 是这两个回归在断点 $c$ 处的预测值之差。\n\n带宽 $h$、多项式阶数 $p$ 和核函数 $K(\\cdot)$ 的选择是关键的“调整参数”。一个最优带宽 $h^\\star$ 通常被选择来最小化估计量的均方误差 (MSE)，以平衡偏差（来自使用远离 $c$ 的观测值）和方差（来自使用过少的观测值）。然而，最终的估计值 $\\hat{\\tau}$ 可能对这些选择很敏感。一个稳健的研究结果应该在一系列合理的设定下保持稳定。\n\n因此，敏感性分析的目的不是找到“最佳”或“最显著”的结果，而是为了证明其结论并非由某一组单一、任意的调整参数所造成的人为结果。对于 RD 设计，一个方法论上合理的敏感性分析应该：\n1.  围绕一个合理的基准（例如，一个均方误差最优带宽），系统地改变主要的调整参数（$h, p, K$）。\n2.  使用局部估计方法，因为 RD 识别是在断点 $c$ 处的一个局部性质。全局多项式通常是不合适的。\n3.  报告所有测试过的设定的结果，以展示透明度并避免“p值操纵” (p-hacking) 或设定搜寻。\n4.  在断点两侧保持对称和一致的估计（例如，相同的带宽，相同的多项式阶数），以避免引入偏差。\n5.  包括一套标准的诊断性检验来检查 RD 假设的有效性，例如前置处理协变量的连续性以及断点周围不存在策略性排序（对运行变量的操纵）。\n\n我们现在将根据这些原则评估每个提议的方案。\n\n**选项 A 评估**\n本方案提议：\n-   定义一个基准的均方误差最优带宽 $h^\\star$。这是一个标准的起点。\n-   围绕此基准系统地改变带宽 $h$：$\\{0.8h^\\star, h^\\star, 1.2h^\\star, 1.6h^\\star\\}$。这是检查对带宽选择敏感性的良好做法。\n-   在局部线性 ($p=1$) 和局部二次 ($p=2$) 之间改变多项式阶数 $p$。这是至关重要的，因为在 $p=1$ 和 $p=2$ 之间的选择是一个涉及偏差-方差权衡的关键决策。\n-   在标准选择（三角核、Epanechnikov 核、均匀核）中改变核函数 $K(\\cdot)$。虽然核函数的选择通常被认为是次要的，但将其包括在内会使分析更加全面。\n-   保持对称性：“对称窗口”和“保持左右带宽相等”。这遵循了最佳实践。\n-   使用正确的中心化：“将多项式以 $c$ 为中心”。这在方法论上是正确的，用于估计断点处的截距。\n-   报告所有结果：“报告每种组合的 $\\hat{\\tau}$、标准误和置信区间”。这展示了透明度，并且与设定搜寻相反。\n-   执行必要的诊断性检验：“前置处理协变量在 $c$ 处的连续性、$X_i$ 在 $c$ 附近的密度以及安慰剂结果”。这是一个严谨 RD 分析的标志。\n\n这个方案是一个全面且方法论上合理的敏感性分析的教科书式例子。它以透明的方式系统地探索了关键的分析选择，同时执行了必要的有效性检验。\n\n**结论：正确**\n\n**选项 B 评估**\n本方案提议：\n-   选择“使 $\\hat{\\tau}$ 的绝对 t 统计量最大化”的带宽 $h$。这是一个明显的设定搜寻或“p值操纵” (p-hacking) 的案例，这种做法通过挑选看起来统计上最显著的结果来使统计推断无效。\n-   在“$X_i$ 的整个支持域上使用全局三次多项式 ($p=3$)”。这违反了 RD 分析的“局部”原则。全局多项式对模型误设高度敏感，并且可能产生在断点处效应的严重偏差估计。\n-   “只报告统计显著性最大的设定”。这进一步证实了 p 值操纵和缺乏透明度。\n-   “不执行任何诊断性检验”。省略这些检验是一个严重的失败，因为这意味着整个 RD 设计的有效性没有受到审查。\n\n这个方案代表了为达到预期结果而蓄意滥用统计方法，并且在科学上是不道德的。\n\n**结论：不正确**\n\n**选项 C 评估**\n本方案提议：\n-   固定带宽 $h^\\star$ 和多项式阶数 $p=1$。这严重限制了敏感性分析的范围，因为没有评估对带宽和多项式阶数选择的稳健性。\n-   “计算均值的简单差异”。窗口内的均值简单差异对应于局部常数回归 ($p=0$)，而不是所声称的局部线性回归 ($p=1$)。局部线性回归在每一侧拟合一条直线，众所周知，它在边界（断点）处的偏差属性优于局部常数模型。\n-   “在估计中忽略核权重”。核加权估计量的定义本身就是使用权重。忽略它们在方法论上是不正确的，除非是均匀核的特殊情况。对于三角核或 Epanechnikov 核，这不是正确的程序。\n-   “跳过诊断性检验”。与选项 B 一样，这是一个重大的方法论缺陷。\n\n这个方案作为敏感性分析既不充分，其对估计程序的描述在方法论上也有缺陷。\n\n**结论：不正确**\n\n**选项 D 评估**\n本方案提议：\n-   使用不对称带宽作为敏感性检查：“仅在处理组一侧改变 $h$...同时固定控制组一侧的带宽”。虽然数据驱动的方法有时可以为每一侧选择不同的最优带宽，但在进行敏感性分析时，改变一侧而固定另一侧是一种非标准且无原则的方法。它违反了问题陈述本身提到的作为应避免的做法的对称性指导原则。\n-   将多项式以“$X_i$ 的样本均值而不是以 $c$ 为中心”。这是一个根本性错误。RD 中的局部多项式回归以断点 $c$ 为中心，这样回归的截距参数直接估计了断点处的条件均值。以样本均值 $\\bar{X}$ 为中心将意味着截距估计的是 $\\bar{X}$ 处的条件均值，这使得在 $c$ 处提取 RD 效应变得不必要地复杂且稳定性较差。\n-   “检验处理后结果的不连续性”。这不是一个诊断性检验；这是主要的分析本身（估计 $\\tau$）。诊断性检验通过检查那些*不应该*受处理影响的变量（如前置处理协变量或安慰剂结果）的不连续性来评估假设的有效性。这部分描述显示了对 RD 诊断的误解。\n\n这个方案包含了几个会使分析无效的根本性方法论错误。\n\n**结论：不正确**\n\n**总结**\n方案 A 是唯一描述了一种全面、透明且方法论严谨的方法来评估回归断点发现稳健性的选项。它系统地改变关键的调整参数，遵循像对称估计和正确中心化这样的最佳实践，并包括验证设计假设所需的关键诊断性检验。其他选项包含严重缺陷，范围从科学不端行为（B）到方法论错误（C, D）和严谨性不足（C）。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}