{
    "hands_on_practices": [
        {
            "introduction": "要真正理解双重差分法，最好的方法就是从一次直接计算开始。这项练习将引导您使用一个公共卫生干预的假设案例，从原始数据出发，一步步计算双重差分估计量，从而巩固该方法的核心逻辑。通过这个过程，您将亲身体验如何通过比较处理组和对照组的变化，来分离出政策的净效应。",
            "id": "4586279",
            "problem": "一个市政公共卫生部门在A社区实施了一项使用点水氯化消毒项目，以减少腹泻病。B社区在同一时期未实施该项目。监测系统记录了两个为期八周的时间窗口内的新发腹泻病例和风险人群：一个在项目开始前（pre），一个在项目开始后（post）。假设没有人口迁移，且记录的人口代表了每个时间窗口的风险分母。记录的计数如下：\n- A社区，项目前：$6000$人中出现$240$例病例。\n- A社区，项目后：$6100$人中出现$160$例病例。\n- B社区，项目前：$5900$人中出现$210$例病例。\n- B社区，项目后：$6000$人中出现$200$例病例。\n\n从风险（发病比例）的定义（新发病例数除以风险人数）出发，并援引核心的因果推断思想，即在平行趋势假设下，通过比较处理组和未处理组之间的时间变化，可以分离出共同的时变影响，请使用双重差分分析计算干预对风险差的效应估计值。请将最终答案表示为小数比例，并四舍五入到四位有效数字。",
            "solution": "目标是使用双重差分框架来估计氯化消毒项目对腹泻病风险（发病比例）的因果效应。其基本依据是风险的定义和因果推断原则，即在平行趋势假设下，处理组的时间变化减去同期未处理对照组的变化后，将剩余的变化归因于干预措施。\n\n首先，定义任何组和时期的风险。对于给定的组和时期，设 $C$ 表示观察窗口内的新发病例数， $N$ 表示风险人数。风险（发病比例）为\n$$\nR \\equiv \\frac{C}{N}.\n$$\n\n计算每个组-时期单元的风险：\n- A社区（处理组），项目前：\n$$\nR_{A,\\mathrm{pre}} = \\frac{240}{6000} = \\frac{24}{600} = \\frac{2}{50} = 0.04.\n$$\n- A社区（处理组），项目后：\n$$\nR_{A,\\mathrm{post}} = \\frac{160}{6100} = \\frac{16}{610} \\approx 0.026229508.\n$$\n- B社区（对照组），项目前：\n$$\nR_{B,\\mathrm{pre}} = \\frac{210}{5900} = \\frac{21}{590} \\approx 0.035593220.\n$$\n- B社区（对照组），项目后：\n$$\nR_{B,\\mathrm{post}} = \\frac{200}{6000} = \\frac{1}{30} \\approx 0.033333333.\n$$\n\n接下来，计算每个社区从项目前到项目后风险的时间变化：\n- 处理组社区变化：\n$$\n\\Delta R_{A} = R_{A,\\mathrm{post}} - R_{A,\\mathrm{pre}} \\approx 0.026229508 - 0.04 = -0.013770492.\n$$\n- 对照组社区变化：\n$$\n\\Delta R_{B} = R_{B,\\mathrm{post}} - R_{B,\\mathrm{pre}} \\approx 0.033333333 - 0.035593220 = -0.002259887.\n$$\n\n在平行趋势假设下——即在没有干预的情况下，处理组本应经历与对照组相同的潜在风险时间变化——干预对风险差的效应是处理组的时间变化减去对照组的时间变化：\n$$\n\\text{DiD RD} = \\Delta R_{A} - \\Delta R_{B} \\approx (-0.013770492) - (-0.002259887) = -0.011510605.\n$$\n\n该值表示归因于氯化消毒项目的风险降低的估计值，以小数比例表示。四舍五入到四位有效数字，得到\n$$\n-0.01151.\n$$",
            "answer": "$$\\boxed{-0.01151}$$"
        },
        {
            "introduction": "应用双重差分法的一个关键步骤是为您的结果变量选择正确的函数形式，因为这一选择与平行趋势假设的合理性息息相关。本练习通过一个假设场景，展示了为什么在某些情况下，对原始数值（水平）进行分析可能会产生误导，而对数值的对数进行分析才能准确识别因果效应。这有助于您理解何时以及为何要对数据进行对数转换，以确保模型假设更贴近现实。",
            "id": "4792531",
            "problem": "一个卫生系统评估一项旨在减少可避免住院的政策。观察了两个组：一个处理区域和一个对照区域。对于每个组 $g \\in \\{T, C\\}$ 和时期 $t \\in \\{0,1\\}$，令 $Y_{gt}$ 表示在一个由 $n$ 个相同个体组成的固定人口中，每个个体被观察一个时期的住院总次数。假设在给定组和时期的条件下，个体事件是独立的，并且计数由泊松过程生成，其均值等于人口规模与组-时期发生率的乘积：$Y_{gt} \\sim \\text{Poisson}(\\mu_{gt})$，其中 $\\mu_{gt} = n \\lambda_{gt}$。\n\n基线发生率为 $\\lambda_{T0} = 0.20$ 和 $\\lambda_{C0} = 0.10$。在没有该政策的情况下，存在一个共同的乘性趋势变化 $g = 1.10$，使得 $\\lambda_{g1}^{\\text{cf}} = g \\lambda_{g0}$。该政策仅在时期 $t=1$ 在处理区域实施，并将处理后的发生率乘以一个因子 $\\theta = 0.80$，因此 $\\lambda_{T1} = \\theta \\cdot g \\cdot \\lambda_{T0}$，而 $\\lambda_{C1} = g \\cdot \\lambda_{C0}$。每个单元的人口规模为 $n = 1000$。\n\n从期望的定义、样本单元均值的大数定律以及将乘积转换为和的对数性质出发，推导以下两种双时期、双组的双重差分法（DiD）被估量的大样本极限（即，在单元级别无限重复下的概率极限）：\n\n1) 水平值DiD：处理区域的平均计数随时间的变化量减去对照区域的类似变化量所构成的对比。\n\n2) 对数DiD：处理区域的平均计数的对数值随时间的变化量减去对照区域的类似变化量所构成的对比。\n\n证明这两个被估量在所描述的数据生成过程下旨在衡量不同的因果对比。然后，使用给定的数值 $(n, \\lambda_{T0}, \\lambda_{C0}, g, \\theta)$，计算每个被估量的大样本值。\n\n将您的最终数值结果报告为一个包含两个条目（先是水平值，后是对数值）的行矩阵。将您的答案四舍五入到四位有效数字。将第一个条目以每$1000$个患者-时期的事件数单位表示，并认识到第二个条目在自然对数尺度上是无量纲的。在您的最终方框答案中不要包含单位。",
            "solution": "该问题要求我们推导两种不同的双重差分法（DiD）被估量的大样本极限：一种是基于结果（计数）的水平值，另一种是基于结果的对数值。“大样本极限”或概率极限是通过将随机样本量替换为其总体期望来找到的，这是大数定律的结果。结果变量是总计数 $Y_{gt}$，其期望是 $E[Y_{gt}] = \\mu_{gt}$。我们已知 $Y_{gt} \\sim \\text{Poisson}(\\mu_{gt})$，其中 $\\mu_{gt} = n \\lambda_{gt}$。\n\n首先，让我们使用给定的参数计算四个单元中每个单元的总体均值（期望计数）：$n = 1000$，$\\lambda_{T0} = 0.20$，$\\lambda_{C0} = 0.10$，$g = 1.10$ 和 $\\theta = 0.80$。\n\n政策前的期望计数是：\n$$ \\mu_{T0} = n \\lambda_{T0} = 1000 \\times 0.20 = 200 $$\n$$ \\mu_{C0} = n \\lambda_{C0} = 1000 \\times 0.10 = 100 $$\n\n政策后的期望计数由事实发生率 $\\lambda_{T1} = \\theta g \\lambda_{T0}$ 和 $\\lambda_{C1} = g \\lambda_{C0}$ 决定。\n$$ \\lambda_{T1} = 0.80 \\times 1.10 \\times 0.20 = 0.176 $$\n$$ \\lambda_{C1} = 1.10 \\times 0.10 = 0.11 $$\n因此，政策后的期望计数是：\n$$ \\mu_{T1} = n \\lambda_{T1} = 1000 \\times 0.176 = 176 $$\n$$ \\mu_{C1} = n \\lambda_{C1} = 1000 \\times 0.11 = 110 $$\n\n**1) 水平值DiD**\n\n水平值DiD被估量是处理组平均结果的变化量与对照组平均结果的变化量之差。其大样本极限，我们记为 $\\Delta_{\\text{levels}}$，由应用于期望结果的相同对比给出：\n$$ \\Delta_{\\text{levels}} = (E[Y_{T1}] - E[Y_{T0}]) - (E[Y_{C1}] - E[Y_{C0}]) $$\n代入期望值 $\\mu_{gt}$：\n$$ \\Delta_{\\text{levels}} = (\\mu_{T1} - \\mu_{T0}) - (\\mu_{C1} - \\mu_{C0}) $$\n让我们用底层的模型参数来表示它：\n$$ \\Delta_{\\text{levels}} = (n \\lambda_{T1} - n \\lambda_{T0}) - (n \\lambda_{C1} - n \\lambda_{C0}) $$\n$$ \\Delta_{\\text{levels}} = n [(\\theta g \\lambda_{T0} - \\lambda_{T0}) - (g \\lambda_{C0} - \\lambda_{C0})] $$\n$$ \\Delta_{\\text{levels}} = n [\\lambda_{T0}(\\theta g - 1) - \\lambda_{C0}(g - 1)] $$\n这个表达式是水平值DiD估计量的目标。该政策对处理组的真实因果效应（处理组的平均处理效应，或ATT）是处理组在政策后时期的事实期望结果与反事实期望结果之差：\n$$ \\text{ATT}_{\\text{levels}} = E[Y_{T1}] - E[Y_{T1}^{\\text{cf}}] = n\\lambda_{T1} - n\\lambda_{T1}^{\\text{cf}} = n(\\theta g \\lambda_{T0}) - n(g \\lambda_{T0}) = n g \\lambda_{T0} (\\theta - 1) $$\n只有当水平值上的平行趋势假设成立时，水平值DiD估计量才能正确识别ATT：$E[Y_{T1}^{\\text{cf}}] - E[Y_{T0}] = E[Y_{C1}] - E[Y_{C0}]$。\n让我们检验这个假设：\n左侧：$E[Y_{T1}^{\\text{cf}}] - E[Y_{T0}] = n g \\lambda_{T0} - n \\lambda_{T0} = n \\lambda_{T0} (g - 1)$。\n右侧：$E[Y_{C1}] - E[Y_{C0}] = n g \\lambda_{C0} - n \\lambda_{C0} = n \\lambda_{C0} (g - 1)$。\n由于 $\\lambda_{T0} \\neq \\lambda_{C0}$，所以左侧 $\\neq$ 右侧。平行趋势假设被违反了。因此，$\\Delta_{\\text{levels}}$ 并不以真实的ATT为目标；它是一个有偏的因果效应估计量。\n\n**2) 对数DiD**\n\n对数DiD被估量是通过取平均计数的对数来构成的。其大样本极限 $\\Delta_{\\text{logs}}$ 是：\n$$ \\Delta_{\\text{logs}} = (\\ln(E[Y_{T1}]) - \\ln(E[Y_{T0}])) - (\\ln(E[Y_{C1}]) - \\ln(E[Y_{C0}])) $$\n代入 $\\mu_{gt} = n \\lambda_{gt}$：\n$$ \\Delta_{\\text{logs}} = (\\ln(n \\lambda_{T1}) - \\ln(n \\lambda_{T0})) - (\\ln(n \\lambda_{C1}) - \\ln(n \\lambda_{C0})) $$\n使用性质 $\\ln(ab) = \\ln(a) + \\ln(b)$，$\\ln(n)$ 项被消掉：\n$$ \\Delta_{\\text{logs}} = (\\ln \\lambda_{T1} - \\ln \\lambda_{T0}) - (\\ln \\lambda_{C1} - \\ln \\lambda_{C0}) $$\n现在，我们代入发生率的模型：\n$$ \\Delta_{\\text{logs}} = (\\ln(\\theta g \\lambda_{T0}) - \\ln(\\lambda_{T0})) - (\\ln(g \\lambda_{C0}) - \\ln(\\lambda_{C0})) $$\n使用相同的对数性质：\n$$ \\Delta_{\\text{logs}} = ((\\ln\\theta + \\ln g + \\ln\\lambda_{T0}) - \\ln\\lambda_{T0}) - ((\\ln g + \\ln\\lambda_{C0}) - \\ln\\lambda_{C0}) $$\n$$ \\Delta_{\\text{logs}} = (\\ln\\theta + \\ln g) - (\\ln g) = \\ln\\theta $$\n这个被估量旨在衡量 $\\ln\\theta$。对数发生率尺度上的因果效应是 $\\text{ATT}_{\\text{logs}} = \\ln(\\lambda_{T1}) - \\ln(\\lambda_{T1}^{\\text{cf}}) = \\ln(\\theta g \\lambda_{T0}) - \\ln(g \\lambda_{T0}) = \\ln\\theta$。对数DiD估计量能正确识别因果效应，因为对于此数据生成过程，平行趋势假设在对数尺度上成立：$\\ln(\\lambda_{T1}^{\\text{cf}}) - \\ln(\\lambda_{T0}) = \\ln(g\\lambda_{T0}) - \\ln(\\lambda_{T0}) = \\ln(g)$，这等于对照组的趋势，$\\ln(\\lambda_{C1}) - \\ln(\\lambda_{C0}) = \\ln(g\\lambda_{C0}) - \\ln(\\lambda_{C0}) = \\ln(g)$。\n\n这两个被估量显然旨在衡量不同的因果对比。$\\Delta_{\\text{levels}}$ 旨在衡量一个有偏的计数绝对变化度量，而 $\\Delta_{\\text{logs}}$ 旨在衡量真实的乘性（或比例）处理效应 $\\theta$，以对数尺度表示。\n\n**数值计算**\n\n我们现在使用给定的数值计算这些大样本被估量的值。\n\n对于 $\\Delta_{\\text{levels}}$：\n$$ \\Delta_{\\text{levels}} = (\\mu_{T1} - \\mu_{T0}) - (\\mu_{C1} - \\mu_{C0}) = (176 - 200) - (110 - 100) = -24 - 10 = -34 $$\n或者，使用推导出的公式：\n$$ \\Delta_{\\text{levels}} = 1000 \\times [0.20 \\times (0.80 \\times 1.10 - 1) - 0.10 \\times (1.10 - 1)] $$\n$$ \\Delta_{\\text{levels}} = 1000 \\times [0.20 \\times (0.88 - 1) - 0.10 \\times (0.10)] $$\n$$ \\Delta_{\\text{levels}} = 1000 \\times [0.20 \\times (-0.12) - 0.01] = 1000 \\times [-0.024 - 0.01] = 1000 \\times [-0.034] = -34 $$\n问题要求这个值以每$1000$个患者-时期的事件数单位表示，此计算直接提供了这个值。保留四位有效数字，结果是 $-34.00$。\n\n对于 $\\Delta_{\\text{logs}}$：\n$$ \\Delta_{\\text{logs}} = \\ln(\\theta) = \\ln(0.80) $$\n$$ \\Delta_{\\text{logs}} \\approx -0.22314355... $$\n四舍五入到四位有效数字，得到 $-0.2231$。\n\n最终结果是水平值被估量为 $-34.00$，对数被估量为 $-0.2231$。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} -34.00  -0.2231 \\end{pmatrix} } $$"
        },
        {
            "introduction": "任何双重差分分析的有效性都取决于其核心——平行趋势假设，即在没有干预的情况下，处理组和控制组会遵循相似的时间趋势。本练习探讨了检验这一关键假设的主要方法：事件研究图和安慰剂检验。理解这些诊断工具对于评估您的研究设计的稳健性、建立对因果推断结论的信心至关重要。",
            "id": "4792450",
            "problem": "一个医院网络评估一项新的抗生素管理方案对每$100$个患者天数中不适当抗生素使用天数的影响。设$i$为医院索引，$t$为月份索引。一些医院在月份$T_i$实施该方案，而另一些医院在研究窗口期内从未实施。结果是$Y_{it}$，医院$i$是否最终接受处理的指示变量是$D_i \\in \\{0,1\\}$。分析目标是使用双重差分法来恢复该方案的因果效应，同时考虑到交错采纳的情况。\n\n假设以下潜在结果框架：$Y_{it}(d)$是单位$i$在时间$t$、处理状态为$d \\in \\{0,1\\}$时的结果。两个关键基础适用：\n- 双重差分估计量依赖于潜在结果中的平行趋势条件，该条件要求对于所有$t$，满足$\\mathbb{E}\\big[Y_{it}(0) - Y_{i,t-1}(0) \\mid D_i = 1\\big] = \\mathbb{E}\\big[Y_{it}(0) - Y_{i,t-1}(0) \\mid D_i = 0\\big].$\n- 如果该方案没有因果效应，那么对于所有的$i$和$t$，满足$Y_{it}(1) = Y_{it}(0)。$\n\n假设真实政策没有效果，但处理组医院和对照组医院在未处理状态下有不同的潜在时间趋势，因此平行趋势假设被违反。考虑通过双向固定效应（TWFE）实现的事件研究设定，其中您相对于“政策日期”定义事件时间，并估计分箱的领先和滞后系数。\n\n您被要求构建一个安慰剂政策日期检验，以探查因违反平行趋势而产生的伪治疗效应，并确定在$Y_{it}(1) = Y_{it}(0)$但各组趋势不同的假定数据生成过程中，估计的事件研究系数的预期定性模式。\n\n当真实政策没有效果，但处理组和对照组单位具有不同的潜在趋势时，哪个选项最好地描述了（i）安慰剂政策日期检验的有效构建方法和（ii）事件研究系数$\\beta_\\ell$在领先期和滞后期上的预期模式？\n\nA. 通过将处理组医院的政策日期提前$k$个月（即$T_i^{\\text{pl}} = T_i - k$）来重新定义政策日期，保持对照组医院为未处理，并在与原始分析相同的样本上重新估计相同的TWFE事件研究。使用事件时间$\\ell = t - T_i^{\\text{pl}}$的指示变量（省略一个处理前时期作为参照），并加入单位和月份固定效应，标准误按医院聚类。如果该方案确实没有效果但趋势不同，那么估计的系数$\\beta_\\ell$将在政策前领先期（$\\ell  0$）和政策后滞后期（$\\ell \\ge 0$）上表现出平滑且统计显著的趋势，在$\\ell = 0$处没有离散跳跃，这反映了潜在的斜率差异而非因果效应。\n\nB. 保留原始政策日期，删除所有处理前观测值，并在TWFE回归中估计单个政策后指示变量。如果该方案没有效果但趋势不同，那么政策前系数将近似为零，并且在政策日期处会出现一个离散跳跃，随后是平坦的政策后系数，这表明存在因果效应。\n\nC. 将安慰剂政策日期随机分配给对照组医院，并将它们视为已实施该方案，然后将这些重新分配的对照组与原始处理组医院结合起来，估计一个TWFE事件研究。如果该方案没有效果但趋势不同，那么事件研究系数将在零附近摆动，在领先期和滞后期上交替出现正负号，不会显示出系统性模式。\n\nD. 将安慰剂政策日期设置得比实际政策日期晚，即$T_i^{\\text{pl}} = T_i + k,$，并估计一个TWFE事件研究。如果该方案没有效果但趋势不同，那么政策前系数将都接近于零，而政策后系数将在$\\ell = 0$处显示出立即的离散跳跃，随后衰减至零，这证实了平行趋势。\n\n选择唯一的最佳答案。",
            "solution": "该问题旨在考察在双重差分分析的核心假设——平行趋势假设——被违反但真实处理效应为零的情况下，如何诊断此问题以及事件研究图会呈现何种模式。\n\n**1. 事件研究系数的预期模式**\n\n事件研究模型通过估计一系列相对于事件发生时间（$\\ell=0$）的系数（$\\beta_\\ell$）来展示动态效应。\n\n*   **处理前系数（$\\ell  0$）**：这些系数用于检验平行趋势。如果趋势平行，它们应接近于零。\n*   **处理后系数（$\\ell \\ge 0$）**：这些系数用于估计处理的动态效应。\n\n在本题设定的数据生成过程（DGP）中，**没有真实的处理效应**，但处理组和对照组有**不同的潜在时间趋势**。这意味着：\n\n*   由于没有真实效应，在事件发生时点（$\\ell=0$）不会有任何“跳跃”或不连续的变化。\n*   由于存在不同的潜在趋势，双重差分估计量会错误地将这种处理前就已存在的趋势差异归因于处理。因此，处理前系数（$\\beta_\\ell$ for $\\ell  0$）将不为零，而是会系统性地反映出这种趋势差异。\n*   这种趋势差异会平滑地延续到处理后时期，因此处理后系数（$\\beta_\\ell$ for $\\ell \\ge 0$）将继续沿着处理前系数所揭示的轨迹发展。\n\n综上所述，事件研究图将显示一条贯穿处理前和处理后时期的平滑、显著的趋势线，但在$\\ell=0$处没有离散的跳跃。\n\n**2. 安慰剂政策日期检验的构建**\n\n安慰剂检验（或证伪检验）是用于检测模型设定问题（如违反平行趋势）的有力工具。一个标准的做法是人为地将政策实施日期移动到一个已知的没有发生政策影响的时期，然后重新进行分析。\n\n*   一个有效的构建方法是，将处理组的实际政策日期$T_i$提前$k$个月，定义一个“安慰剂”日期$T_i^{\\text{pl}} = T_i - k$。这样，原始分析中的一段处理前时期在安慰剂检验中被当作“处理后”时期。\n*   如果平行趋势假设成立，那么在这个安慰剂检验中不应发现任何显著的“效应”（即所有$\\beta_\\ell$都应接近零）。\n*   然而，如果平行趋势假设被违反，这个安慰剂检验就会捕捉到这种潜在的趋势差异，并错误地报告一个围绕安慰剂日期的“伪效应”，其模式与上述分析一致。\n\n**3. 评估选项**\n\n*   **选项A**：正确地描述了安慰剂检验的构建方法（将政策日期提前）和在该DGP下事件研究系数的预期模式（平滑趋势，无跳跃）。这与我们的分析完全吻合。\n*   **选项B**：删除了进行双重差分所必需的处理前数据，这是一种错误的方法。\n*   **选项C**：提出了一个复杂的安慰剂设计，并且对结果模式的预测（在零附近摆动）没有理论依据。\n*   **选项D**：将安慰剂日期后移，这种设计会因真实处理已经发生而变得复杂和混淆。其对结果的预测（处理前系数为零，有跳跃）也与DGP的设定直接矛盾。\n\n因此，选项A是唯一一个既描述了有效的诊断检验，又准确预测了在给定情景下其结果的选项。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}