## 引言
在流行病学研究中，评估短暂、[间歇性](@entry_id:275330)暴露（如服用一次药物或短暂暴露于空气污染）与急性健康结局（如心肌梗死或过敏反应）之间的因果关联，始终面临着一个核心挑战：混杂。传统的[观察性研究](@entry_id:174507)设计，如队列研究和病例对照研究，常常难以充分控制那些难以测量或未知的个体层面差异，例如遗传易感性、稳定的生活习惯等，这些因素可能同时影响暴露和结局，从而扭曲真实的效应评估。

为了解决这一根本性难题，流行病学家发展出了一类巧妙而强大的研究方法——自控设计。这些方法通过将比较从“个体之间”转移到“个体之内”，让每个经历事件的个体都成为其自身的完美对照，从而在设计层面消除了所有不随时间变化的混杂因素。本文旨在系统性地介绍两种最核心的自控设计：病例交叉设计（Case-Crossover, CCO）和自控病例系列设计（Self-Controlled Case Series, SCCS）。

通过本文，读者将踏上一段从理论到实践的完整学习旅程。在第一章“原理与机制”中，我们将深入剖析这两种设计的统计学基础和核心思想，揭示它们如何巧妙地控制混杂。接着，在第二章“应用与交叉学科联系”中，我们将通过药物警戒、环境健康和精神病学等领域的真实案例，展示这些设计的强大实用性。最后，在第三章“动手实践”中，读者将有机会通过具体问题，亲手应用所学知识。现在，让我们首先进入第一章，深入探索自控设计的核心原理与机制。

## 原理与机制

本章在前一章介绍性概述的基础上，深入探讨病例交叉设计和自控设计方法的核心科学原理与统计机制。这些“自控”方法在流行病学研究中，尤其是在药物警戒和环境健康领域，已成为评估短暂暴露（transient exposures）对急性结局（acute outcomes）影响的有力工具。我们的目标是不仅要理解这些设计“如何”运作，更要理解“为何”如此运作，包括它们的理论基础、关键假设，以及在实践中可能遇到的挑战和偏倚。

### 自控设计的核心思想：作为自身对照的个体

传统观察性研究（如队列研究和病例对照研究）通过比较不同个体组（暴露组 vs. 非暴露组）的疾病风险来估计效应。这些研究的一个核心挑战是**组间可比性**问题。暴露组和非暴露组可能在许多已知和未知的基线特征上存在差异，这些差异如果也与结局相关，就会成为**混杂因素（confounders）**，从而扭曲真实的因果效应。研究者可以通过匹配、分层或在回归模型中进行调整来控制已知的混杂因素，但对于未测量或未知的因素则无能为力。

自控设计通过一种巧妙的范式转变克服了这一根本性难题：它们将比较从**个体之间（between-person）**转移到**个体之内（within-person）**。在这种框架下，每个经历结局事件的个体（即“病例”）都充当其自身的对照。通过比较同一个体在不同时间点（即暴露风险期和非暴露参照期）的暴露状态，所有不随时间变化的个体层面混杂因素，无论已知还是未知，都被完美地消除了。这些**时间不变混杂因素（time-invariant confounders）**包括遗传易感性、性别、种族、社会经济地位的稳定部分，以及不随时间改变的慢性合并症等。因为在同一个体内部进行比较时，这些因素在所有比较窗口中都是恒定的，因此它们对风险的任何影响都会在效应估计的计算中被抵消。

这一原理的数学形式化将在后文详述，但其直观理解至关重要：自控设计通过利用个体自身作为完美的“匹配对照”，实现了对所有时间不变混杂的内在控制 。接下来，我们将分别探讨实现这一核心思想的两种主要设计：病例交叉设计和自控病例系列设计。

### 病例交叉设计（Case-Crossover Design）

病例交叉设计的核心问题可以概括为：“个体在事件发生前瞬间的暴露状态，是否与其在未发生事件的其他可比时间点的暴露状态有所不同？” 这种设计可以被看作是一种特殊的匹配病例对照研究，其中每个病例都与过去的自己进行匹配。

#### 设计要素与适用条件

病例交叉设计并非普遍适用，它的有效性依赖于暴露和结局的特定性质 。

1.  **短暂暴露（Transient Exposure）**：暴露必须是短暂、偶发的，且在个体内的状态会频繁改变。例如，一次剧烈运动、使用短效止痛药或暴露于短暂的空气污染高峰。如果暴露是慢性的或长期稳定的（如长期服用降压药），那么个体在不同时间窗口的暴露状态将是相同的（即“一致的”），无法形成有效对比，从而导致该设计失效。

2.  **急性结局（Abrupt Outcome）**：结局的发生必须是突然的，并且其发生时间可以被精确定位。例如，心肌梗死、中风或一次癫痫发作。这一定位对于准确界定事件发生前的“危险窗口”至关重要。对于发病缓慢、潜移默化的慢性病，则难以应用此设计。

3.  **短暂诱导期（Short Induction Period）**：暴露的因果效应必须在暴露后很短的时间内显现。这意味着从暴露到结局发生的诱导期很短。病例交叉设计旨在检验暴露是否是结局的“触发因素”。如果诱导期很长，那么事件发生前短时间内的暴露状态就与结局的发生无关，研究将无法捕捉到真实效应。

#### 机制、估计量与分析

在病例交叉设计中，研究仅纳入经历过结局事件的个体（病例）。对于每个病例，研究者需要定义：

*   **危险窗口（Hazard Window）**：紧邻事件发生前的一段预定时间区间，例如事件发生前的 $24$ 小时或 $7$ 天。这是假定的暴露发挥作用的时期。
*   **参照窗口（Referent Windows）**：从同一个体的其他时间段中选取的一个或多个与危险窗口等长的时间区间。这些窗口代表了个体未发生事件时的“对照”时期。

参照窗口的选择至关重要，必须谨慎以避免引入偏倚。一种常用策略是采用**时间[分层抽样](@entry_id:138654)（time-stratified sampling）**，例如，如果事件发生在某个周三下午，参照窗口可以选自同一个月内其他所有周三的同一时间段。这种方法有助于控制由于星期、季节或一天中的时间等因素引起的短期时间趋势。

分析时，将每个病例及其对应的危险窗口和参照窗口构成一个独立的**分层（stratum）**。通过比较危险窗口和参照窗口中的暴露状态差异，可以估计暴露与结局的关联。标准的统计方法是**条件[逻辑斯谛回归](@entry_id:136386)（conditional logistic regression）**。该模型直接估计的是一个**匹配比值比（matched odds ratio, OR）**。在结局罕见且[窗口期](@entry_id:196836)较短的假设下，这个OR可以作为**发生率比（incidence rate ratio, IRR）**的一个良好近似 。

该设计的目标估计量，即因果IRR，可以形式化地表示为在时间 $t$ 的瞬时风险率（hazard rate）之比：
$$
\theta(t) = \frac{\lambda(t \mid X(t)=1, \mathbf{Z}(t))}{\lambda(t \mid X(t)=0, \mathbf{Z}(t))}
$$
其中，$\lambda(t \mid \cdot)$ 是给定暴露 $X(t)$ 和其他协变量 $\mathbf{Z}(t)$ 时的瞬时风险率。病例交叉设计通过其巧妙的自身匹配，有效地估计了这一比率，同时控制了所有时间不变的 $\mathbf{Z}(t)$ 组分 。

### 自控病例系列设计（Self-Controlled Case Series, SCCS）

与病例交叉设计不同，自控病例系列（SCCS）设计的核心问题是：“在同一个体的观察期内，其暴露期间的事件发生率是否不同于其非暴露（基线）期间的事件发生率？” 这种设计可以被看作是在每个个体内部进行的一项队列研究。

#### 机制、估计量与分析

SCCS设计同样只使用经历过至少一次结局事件的个体。对于每个个体，其整个观察期被根据暴露状态划分为多个不重叠的时间段 。例如，一个接种疫苗的研究可能将观察期划分为：疫苗接种前（基线期）、接种后 $1-14$ 天（高风险期）、接种后 $15-42$ 天（中风险期）以及之后的时期（回归基线期）。

SCCS设计需要的数据是：

*   每个预定义时间窗口内的**事件计数（event counts）**。
*   每个预定义时间窗口的**人时数（person-time）**。

该方法的基础是假设在每个时间窗口内，事件的发生遵循一个**泊松过程（Poisson process）**。对于个体 $i$ 在第 $k$ 个时间窗口内，其事件计数 $Y_{ik}$ 遵循泊松分布，其均值等于该窗口的事件率乘以其持续时间 $t_{ik}$。该事件率被建模为个体基线率 $\mu_i$ 和由时变暴露决定的相对发生率 $r_{ik}$ 的乘积。模型可以表示为：
$$
Y_{ik} \sim \text{Poisson}(\mu_i r_{ik} t_{ik})
$$
其中 $r_{ik} = \exp(\boldsymbol{\beta}^{\top} \mathbf{x}_{ik})$，$\mathbf{x}_{ik}$ 是指示该窗口暴露状态的协变量向量。

为了消除个体特异性的基线率 $\mu_i$（它包含了所有时间不变混杂因素），SCCS采用了**条件泊松回归（conditional Poisson regression）**。分析以每个个体的总事件数 $N_i = \sum_k Y_{ik}$ 为条件。在这种条件下，SCCS模型直接估计参数 $\boldsymbol{\beta}$，而 $\exp(\boldsymbol{\beta})$ 就是我们感兴趣的**发生率比（IRR）** 。这种方法自然地处理了复发事件（即一个个体可以发生多次事件），也适用于单次事件（$N_i=1$）的情况 。

### 两种设计的对比

尽管病例交叉和SCCS都属于自控设计，但它们在数据要求、模型和直接估计量上存在关键区别 。

| 特征 | 病例交叉设计 (CCO) | 自控病例系列设计 (SCCS) |
| :--- | :--- | :--- |
| **核心概念** | 每个病例是自己的对照 | 每个病例内部的队列研究 |
| **数据要求** | 精确的事件时间和暴露史，用于定义离散的危险窗口和参照窗口 | 观察期内所有事件的时间和所有暴露时段的起止时间，用于计算各窗口内的事件数和人时数 |
| **主要效应估计量** | 匹配比值比 (OR) | 发生率比 (IRR) |
| **标准分析模型** | 条件[逻辑斯谛回归](@entry_id:136386) | 条件泊松回归 |
| **对复发事件** | 标准设计通常处理首次事件，处理复发事件需要特殊扩展 | 自然地处理复发事件 |

### 消除时间不变混杂的统一机制

两种设计控制时间不变混杂的背后是相同的统计原理：通过**条件似然（conditional likelihood）**消除个体特异性参数。

我们可以用一个统一的[广义线性模型](@entry_id:171019)框架来理解这一点。假设对于个体 $i$ 在时间（或时间窗口）$t$，事件发生率 $\mu_{it}$ 遵循一个对数线性模型：
$$
\log \mu_{it} = \alpha_i + \beta X_{it} + s(t) + \log o_{it}
$$
其中：
*   $\alpha_i$ 是个体特异性截距（或称固定效应），它捕获了所有影响个体基线风险的时间不变因素（如遗传、性别等）。
*   $X_{it}$ 是时变暴露。
*   $\beta$ 是我们关心的对数发生率比。
*   $s(t)$ 代表任何共享的时间趋势（如年龄、季节性）。
*   $o_{it}$ 是人时数的偏置项（offset）。

如果我们试图直接估计所有参数（包括每个个体的 $\alpha_i$），会遇到“偶然参数问题”（incidental parameters problem），导致对 $\beta$ 的估计产生偏倚。自控设计的精髓在于不直接估计 $\alpha_i$，而是通过构建一个不依赖于 $\alpha_i$ 的条件似然来估计 $\beta$。

在SCCS中，我们假设事件数 $Y_{it}$ 服从泊松分布，其均值为 $\mu_{it}$。通过以每个个体的总事件数 $Y_{i+} = \sum_t Y_{it}$ 为条件，我们可以推导出条件似然。在这个过程中，包含 $\alpha_i$ 的项在分子和分母中被约去，从而将其从估计中消除 。

在病例交叉设计中，情况类似，但通过在条件[逻辑斯谛回归](@entry_id:136386)中按个体进行分层来实现。每个分层（即每个病例）包含一个危险窗口和一个或多个参照窗口。条件似然是基于“在观察到暴露发生在这些窗口之一的情况下，它恰好发生在危险窗口”的概率，这同样有效地消除了任何只在个体间变化而不在个体内部窗口间变化的因素（即 $\alpha_i$）。

因此，无论采用何种具体形式，自控设计的“魔力”都源于这种严谨的统计条件化过程，它为控制所有稳定的个体层面混杂提供了理论保证。

### 关键假设与潜在偏倚

自控设计的优雅和强大并非没有代价，它们依赖于一些严格的假设。违反这些假设可能导致严重的偏倚。

#### 假设一：存在显著的个体内暴露变异

这是自控设计能够运作的最基本前提。因为效应估计完全依赖于个体内暴露状态的变化，如果暴露对于大多数个体是恒定的，那么研究将几乎没有信息量。

例如，在一项评估慢性降压药对晕厥短期风险的研究中，如果在10,000名发生晕厥的病例中，有9,900人在整个观察期内要么一直服药，要么从未服药，那么只有100名（1%）暴露状态发生改变的个体能为分析提供信息。在这种情况下，效应参数 $\beta$ 将是**弱可识别（weakly identified）**或**不可识别（not identified）**的，导致估计值极不稳定或模型无法收敛 。因此，对于变化极少或极慢的长期持续性暴露，自控设计通常是不合适的。

#### 假设二：窗口间的基线风险是可交换的（Exchangeability）

自控设计的一个核心假设是，在没有暴露效应的情况下，事件在危险窗口和参照窗口发生的基线概率是相同的。这被称为**[可交换性](@entry_id:263314)**。这一假设可能被**时变混杂因素（time-varying confounders）**所破坏。

自控设计只能自动控制时间*不变*的混杂因素，而无法控制随时间变化的混杂因素。例如，假设我们研究[体力](@entry_id:174230)活动（暴露）与心脏病发作（结局）的关系，而感染（一种时变混杂因素）会同时增加心脏病发作的风险并减少[体力](@entry_id:174230)活动。如果感染的概率在不同时间窗口内波动，就会违反可交换性假设。

我们可以量化这种偏倚。假设一个时变混杂因素 $U_t$（例如，感染状态）影响事件风险，其效应为 $\exp\{\gamma\}$。如果 $U_t$ 在危险窗口和参照窗口中的分布不同，就会引入一个乘性偏倚。偏倚因子 $B$ 等于 $U_t$ 对风险的平均贡献在危险窗口与参照窗口之比 ：
$$
B = \frac{E[\exp\{\gamma U_t\} \mid \text{危险窗口}]}{E[\exp\{\gamma U_t\} \mid \text{参照窗口}]}
$$
最终观察到的比值比将是真实效应 $\exp\{\beta\}$ 与这个偏倚因子 $B$ 的乘积。例如，如果一个风险因素在危险窗口中更常见，将导致 $B > 1$，从而高估暴露的风险。为了应对时变混杂，研究者必须通过设计（如仔细选择参照窗口）或分析（在模型中明确调整时变混杂因素）来控制它们。

#### 假设三：事件不影响后续暴露（Event-Independent Exposure）

SCCS和病例交叉设计都假设结局事件的发生不会反过来影响未来的暴露模式。如果存在这种**[反向因果关系](@entry_id:265624)**，就会产生偏倚。一个典型的例子是**前驱症状性偏倚（protopathic bias）** 。

前驱症状性偏倚指的是，一个尚未被诊断的疾病的早期症状（前驱症状）促使患者开始使用某种药物，随后该疾病被正式诊断。这会造成一种虚假的关联，仿佛是药物导致了该疾病。例如，在研究非[甾体](@entry_id:146569)抗炎药（NSAID）与心肌梗死（MI）风险的关联时，MI的前驱症状（如胸痛）可能促使患者服用NSAID止痛。

这种偏倚可以通过在分析中设置一个**暴露前窗口（pre-exposure window）**来检测。这个窗口是紧邻药物启用前的一段时间（例如7天）。通过比较这个暴露前窗口的事件率与更早的基线期事件率，我们可以发现是否存在风险异常升高。

例如，在一项研究中，研究者发现暴露前7天的MI发生率是之前基线期的6倍 。这个信号强烈表明，是即将发生的MI的症状导致了NSAID的使用，而不是相反。对此类偏倚的调整方法包括：在模型中为暴露前窗口设置一个独立的参数，或者在定义风险期时跳过药物启用后的一小段时间（即“洗脱期”）。

这一假设的更广泛版本是，事件的发生本身不应成为改变未来暴露决策的因素 。例如，如果发生不良事件后，临床指南建议停止使用某种药物，这也违反了该假设 。

#### 假设四：观察期不依赖于事件（Non-Informative Observation Period）

SCCS设计还假设个体的观察期长度独立于事件的发生时间。当结局事件可能致命或导致研究终止（例如，导致住院从而中断门诊记录）时，这个假设就会被违反，这种情况被称为**事件依赖性删失（event-dependent censoring）** 。

例如，假设暴露（如某种药物）往往在老年时使用，而事件（可能致命）在较年轻时也时有发生。当一个年轻患者发生致命事件时，其观察期被截断。所有在该事件之后可能发生的观察时间，包括潜在的暴露时间，都从分析中丢失了。SCCS分析只能看到该患者在事件发生前的历史，这段历史相对于其完整的潜在生命历程来说，不成比例地包含了较多的非暴露时间。这会导致对暴露效应的偏倚估计，通常是人为地显示出一种虚假的保护性效应（即估计的IRR小于1）或削弱一个真实的有害效应。

解决事件依赖性删失问题有几种高级策略 ：
1.  **加权SCCS（Weighted SCCS）**：在条件泊松回归中，对每个个体的贡献按其在每个年龄被观察到的概率的倒数进行加权（即[逆概率](@entry_id:196307)加权）。
2.  **联合建模（Joint Modeling）**：建立一个同时模拟事件过程和观察终止过程的联合[统计模型](@entry_id:755400)。
3.  **限制风险区间**：采用类似于病例交叉设计的方法，仅比较紧邻暴露前后的预设窗口，从而避免使用可能被删失的远期对照时间。

总之，病例交叉和自控病例系列设计是流行病学研究中控制时间不变混杂的强大工具。然而，它们的应用者必须深刻理解其背后的原理和关键假设。对时变混杂的敏感性、对暴露变异的需求，以及关于事件与暴露及观察期之间相互作用的严格假定，都要求研究者在设计和分析阶段进行审慎的思考和检查。