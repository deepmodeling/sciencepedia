## 引言
大型前瞻性队列研究是流行病学病因探索的基石，但当需要测量昂贵或稀有的暴露变量（如新型生物标志物）时，对整个数万甚至数十万人的队列进行检测往往面临巨大的经济和后勤挑战。为了在保证[统计效率](@entry_id:164796)的同时显著节约成本，研究人员开发了多种在队列内部进行抽样的巧妙策略。其中，巢式病例对照（Nested Case-control, NCC）设计与病例队列（Case-cohort, CCH）设计是最为经典和强大的两种方法。本文旨在系统性地解析这两种高效研究设计，帮助读者建立从理论到实践的完整认知框架。

在“**原理与机制**”一章中，我们将深入探讨两种设计的核心抽样逻辑——NCC的风险集抽样和CCH的基线亚队列抽样，并阐明其各自对应的统计分析方法如何有效[估计风险](@entry_id:139340)比。接着，在“**应用与跨学科关联**”部分，我们将通过真实世界的研究案例，展示这些设计在[癌症流行病学](@entry_id:204025)、药物安全监测等领域的具体应用，并探讨它们处理时变暴露、[竞争风险](@entry_id:173277)等复杂数据的能力，以及与因果推断等更广阔理论的联系。最后，“**动手实践**”将提供一系列精心设计的问题，帮助读者巩固核心概念，并将其应用于解决实际问题。

通过这三个层层递进的章节，读者将能够全面掌握NCC和CCH设计的精髓，并学会在自己的研究中做出明智的设计选择。让我们首先从这两种设计的基础——其内在的原理与机制——开始探索。

## 原理与机制

在大型前瞻性队列研究中，研究人员通常旨在估计特定暴露（如生物标志物或基因变异）与某个时间-事件结局（如疾病发生）之间的关联强度。[Cox比例风险模型](@entry_id:174252)是分析此[类数](@entry_id:156164)据的黄金标准，它通过[估计风险](@entry_id:139340)比（Hazard Ratio, HR）来量化这种关联。然而，对整个队列（可能包含数万甚至数十万名参与者）测量昂贵的暴露变量，在经济上或后勤上往往是不可行的 。例如，当一项生物标志物检测耗资不菲，或储存在生物样本库中的样本量有限时，研究人员必须采取更具成本效益的策略。

为了解决这一挑战，流行病学家和生物统计学家开发了在队列内进行抽样的有效设计，其中最经典的两种是**巢式病例对照（Nested Case-control, NCC）设计**和**病例队列（Case-cohort, CCH）设计**。这两种设计都属于“两阶段”设计，其核心思想是仅对队列中的一个子集测量昂贵的暴露变量，同时通过精巧的抽样和专门的统计分析方法，仍然能够获得对全队列分析中风险比的有效估计。本章将深入探讨这两种设计的核心原理和统计机制。

### 巢式病例对照设计的原理与机制

巢式病例对照（NCC）设计的核心是一种被称为**发生密度抽样（incidence density sampling）**或**风险集抽样（risk-set sampling）**的策略。其基本思想是在队列中每个新病例发生的时刻，从当时仍然“处于风险中”的个体中为其匹配一组对照。

#### 风险集抽样：发生密度抽样的逻辑

要理解NCC设计，首先必须掌握**风险集（risk set）**的概念。在一个队列研究中，于任何一个特定的时间点 $t$，风险集 $R(t)$ 由所有在该时间点之前既未发生结局事件也未被删失（例如失访或研究结束）的队列成员组成。换言之，他们是当时有资格发生结局事件的个体群体 。

NCC设计的具体抽样过程如下 ：
1.  研究人员对整个队列进行随访，识别出所有新发病例及其发生时间。假设在时间点 $t_j$ 出现了一个病例。
2.  确定该时间点的风险集 $R(t_j)$。
3.  从这个风险集 $R(t_j)$ 中，除去刚刚发生的这个病例外，随机抽取一定数量（例如 $m$ 个）的个体作为该病例的**对照**。
4.  对每个病例及其匹配的对照，测量昂贵的暴露变量。对于队列中的其他成员，则无需测量。
5.  对每一个病例，这个过程都会重复进行，从而形成一系列由“病例-对照”组成的匹配集（strata）。

这一抽样机制具有几个至关重要的特征：
*   **动态抽样**：对照不是在研究开始时一次性选定的，而是在每个病例事件发生时动态地从当时的风险集中抽取。这确保了对照在时间上与病例是可比的，因为他们在病例发病的那一刻同样处于风险之中。
*   **对照的非唯一性**：同一个体可能在研究的不同时间点被多次抽中为不同病例的对照。只要他/她仍在风险集中，就有可能被选中。
*   **对照可能成为病例**：由于对照是从风险集中选出的，他们本身也处于发生结局的风险中。因此，在较早时间点被选为对照的个体，完全有可能在之后的随访中成为一个病例 。排除这些未来会成为病例的个体作为对照是一种严重的方法学错误，会引入选择偏倚。

在某些情况下，为了控制已知的混杂因素（如年龄、性别），抽样还可以在风险集内部分层进行。例如，可以要求为一名60岁的男性病例匹配同样是60岁的男性对照。这被称为**条件抽样（conditional sampling）**，而简单的随机抽样则被称为**均匀抽样（uniform sampling）** 。

#### 估计目标与统计分析：为何无需罕见病假设

NCC设计旨在估计的目标参数正是全队列[Cox模型](@entry_id:164053)中的**风险比（Hazard Ratio, HR）**，即 $\exp(\beta)$，其中 $\beta$ 是[Cox模型](@entry_id:164053) $h(t | X) = h_0(t)\exp(\beta X)$ 中的对数风险比参数 。

NCC研究的数据分析通常采用**条件[逻辑斯谛回归](@entry_id:136386)（conditional logistic regression）**。在该模型中，每一个“病例-对照”匹配集被视为一个独立的层。模型估计的是在每个层内，暴露对成为“病例”而非“对照”的几率的影响。该分析方法所得的条件比值比（conditional odds ratio）是[Cox模型](@entry_id:164053)中风险比 $\exp(\beta)$ 的一个一致性估计。

一个经典且常被误解的问题是，这种对比值比的估计是否需要**罕见病假设（rare disease assumption）**才能近似等于风险比。答案是否定的，而其原因正是发生密度抽样的精妙之处 。

我们可以从第一性原理来理解这一点 。考虑一个[二分类](@entry_id:142257)暴露变量 $X \in \{0, 1\}$。在任意一个病例发生时间点 $t$：
*   **病例的暴露几率**：在时间点 $t$ 附近一个极小的时间窗内，暴露组 $(X=1)$ 产生的病例数正比于处于风险中的暴露人数 $n_1(t)$ 与其瞬时风险（hazard）$\lambda_1(t)$ 的乘积，即 $n_1(t)\lambda_1(t)$。同理，非暴露组 $(X=0)$ 产生的病例数正比于 $n_0(t)\lambda_0(t)$。因此，一个在时间 $t$ 发生的病例，其暴露为 $X=1$ 的几率（Odds）为：
    $$ \text{Odds}(X=1 \mid \text{病例 at } t) = \frac{n_1(t)\lambda_1(t)}{n_0(t)\lambda_0(t)} = \frac{n_1(t)}{n_0(t)} \times \frac{\lambda_1(t)}{\lambda_0(t)} $$
*   **对照的暴露几率**：对照是从整个风险集 $R(t)$ 中随机抽取的。风险集中暴露人数为 $n_1(t)$，非暴露人数为 $n_0(t)$。因此，被抽中的对照其暴露为 $X=1$ 的几率就是风险集中暴露与非暴露人数的比值：
    $$ \text{Odds}(X=1 \mid \text{对照 at } t) = \frac{n_1(t)}{n_0(t)} $$
*   **比值比的计算**：条件[逻辑斯谛回归](@entry_id:136386)估计的比值比（OR）即为病例的暴露几率与对照的暴露几率之比：
    $$ OR_t = \frac{\text{Odds}(X=1 \mid \text{病例 at } t)}{\text{Odds}(X=1 \mid \text{对照 at } t)} = \frac{\frac{n_1(t)}{n_0(t)} \times \frac{\lambda_1(t)}{\lambda_0(t)}}{\frac{n_1(t)}{n_0(t)}} = \frac{\lambda_1(t)}{\lambda_0(t)} = HR(t) $$

从上式可见，代表风险集中暴露分布的项 $\frac{n_1(t)}{n_0(t)}$ 被完美地抵消了，使得计算出的比值比直接等于该时刻的风险比 $HR(t)$。这一推导过程不依赖于疾病在整个研究期间的累积发病率是高还是低。因此，NCC设计通过其“实时”的对照[抽样策略](@entry_id:188482)，绕过了传统病例对照研究中通常需要的罕见病假设，可以直接、有效地[估计风险](@entry_id:139340)比 。

### 病例队列设计的原理与机制

病例队列（CCH）设计是另一种在大型队列中进行有效抽样的强大工具。与NCC设计在每个事件时间点进行动态抽样不同，CCH设计的核心是在研究**开始时（基线）**就确定一个固定的比较组。

#### 基线抽样：亚队列的代表性作用

CCH设计的第一步是在研究基线时刻（$t=0$），从整个 $N$ 人的队列中，通过简单随机抽样，选出一个子集，这个子集被称为**亚队列（subcohort）** 。这个抽样过程完全独立于任何个体未来的结局状态（即，与他们将来是否会成为病例无关）。

随后的数据收集遵循以下规则：
1.  对亚队列中的**所有成员**测量昂贵的暴露变量。
2.  在整个随访期间，对所有新发生的**病例**（无论他们是否在亚队列中）测量暴露变量。

这样，最终拥有暴露信息的数据集包括两部分人：所有亚队列成员，以及所有不在亚队列中的病例。

CCH设计的核心逻辑在于，基线时随机抽取的亚队列可以被视为整个队列在随访期间“人-时（person-time）”构成的一个缩影。在任何一个病例发生的时间点 $t_j$，我们虽然不知道整个风险集 $R(t_j)$ 中所有成员的暴露情况，但我们可以用当时仍然处于风险中的亚队列成员来代表整个风险集。

CCH设计的关键特征包括：
*   **一次性抽样**：亚队列在基线时一次性确定，并在整个研究期间保持固定。
*   **对照的复用**：同一个亚队列被用作所有病例的比较组。一个亚队列成员如果持续处于风险中，他/她可以作为不同时间点发生的多个病例的对照 。
*   **亚队列中的病例**：由于亚队列是随机抽取的，其中自然会包含一部分未来会成为病例的个体。这些个体在他们发病前，作为亚队列成员为分母的估计做贡献；在他们发病时，则作为分子（病例）进入分析。

#### 估计目标与加权分析

与NCC设计一样，CCH设计的目标也是估计Cox模型中的风险比 $\exp(\beta)$。然而，其分析方法有本质不同。由于亚队列只是风险集的一个样本，而病例则是被全部纳入，直接进行标准Cox回归会导致偏倚。因此，CCH设计需要采用特殊的**加权分析方法**来修正抽样带来的影响。

分析的核心是构建一个加权的伪似然函数（pseudo-likelihood），它模仿全队列的Cox[偏序](@entry_id:145467)[似然函数](@entry_id:141927)，但用一个加权和来近似真实风险集中的分母。多种加权方案被提出，其中由Prentice提出的经典方案非常直观 。

在一个基于[计数过程](@entry_id:260664)的通用框架下，我们可以定义一个随时间变化的权重函数 $w_i(t)$。Prentice权重方案的逻辑是：
*   对于亚队列成员（用[指示变量](@entry_id:266428) $S_i=1$ 表示），他们在任何时候都对风险集的估计有贡献，因此给予权重 $1$。
*   对于非亚队列成员（$S_i=0$），他们只有在自己成为病例的那一刻才被纳入分析，因此仅在他们的发病时间点 $T_i$ 给予权重 $1$，其他时间权重为 $0$。

这个权重函数可以精确地表示为 ：
$$ w_i(t) = S_i + (1 - S_i) \cdot \mathbf{1}\{t = T_i, \Delta_i = 1\} $$
其中 $\mathbf{1}\{\cdot\}$ 是指示函数，$\Delta_i=1$ 表示个体 $i$ 确实发生了事件。

使用这样的权重，在任何一个病例发生时间 $t_j$，用于构建似然函数分母的“[对照组](@entry_id:188599)”就由两部分人构成：所有当时仍在风险集中的亚队列成员，以及（如果该病例恰好不在亚队列中）该病例本人。通过这种方式，加权分析能够对抽样设计进行校正，从而得到风险比的[无偏估计](@entry_id:756289)。

### 设计选择：比较分析与实践考量

NCC和CCH设计都是强大的工具，但它们各有优劣。在实际研究中，选择哪种设计取决于多种科学和后勤因素。

#### 核心差异总结

下表总结了两种设计的根本区别 ：

| 特征 | 巢式病例对照 (NCC) 设计 | 病例队列 (CCH) 设计 |
| :--- | :--- | :--- |
| **抽样时间** | 动态进行，在每个病例发生时 | 一次性完成，在研究基线时 |
| **抽样框架** | 随时间变化的风险集 $R(t)$ | 固定的基线全队列 $N$ |
| **对照选择** | 为每个病例单独抽样一组对照（时间匹配） | 所有病例共享同一个亚队列作为比较组 |
| **对照复用** | 同一个体可被多次抽为不同病例的对照 | 亚队列成员自动作为所有病例的潜在对照 |
| **标准分析方法** | 条件[逻辑斯谛回归](@entry_id:136386) | 加权的Cox回归 |

#### 实践中的选择标准

根据研究的具体目标和限制，研究者可以依据以下标准进行决策 ：

1.  **暴露变量的性质（是否时依）**：
    *   如果关键暴露是一个**时依变量（time-dependent covariate）**，即其值随时间变化，且接近事件发生时的暴露水平具有重要的病因学意义，那么**NCC设计通常是更优选择**。因为NCC在事件发生时进行匹配抽样，天然地允许研究者在病例和对照之间同步测量该时点的暴露值。
    *   对于CCH设计，处理时依变量非常复杂。要获得有效的估计，理论上需要知道亚队列所有成员在每个病例事件发生时的暴露值，这在实践中往往不可行。

2.  **实验室工作流程与后勤**：
    *   如果实验室处理能力有限，无法一次性处理大批量样本，而更适合将工作量分散在数年内完成，那么**NCC设计在操作上更具优势**。其“即时（just-in-time）”的检测模式与这种分布式的工作流程完美契合。
    *   相反，CCH设计通常需要在研究初期对整个亚队列的样本进行检测，导致工作量高度集中在[前期](@entry_id:170157)。

3.  **多个结局的研究**：
    *   如果研究者计划在一个队列中研究**多种不同的结局**，**CCH设计通常效率更高**。因为同一个基线亚队列可以作为所有不同结局分析的通用比较组，避免了为每种结局重新抽样对照的麻烦和成本。

4.  **事件发生的数量**：
    *   当结局**非常罕见**时，总病例数 $E$ 很小，NCC设计的总样本量（约为 $E \times (m+1)$）也较小，可能比建立一个合理规模的亚队列更经济。
    *   当结局**相对常见**时，$E$ 较大，NCC设计需要抽样的总人数会显著增加。此时，CCH设计的“一次性投资、多次复用”的特点可能使其在总样本量和成本上更具效率。

综上所述，NCC和CCH设计为在大型队列中开展高成本暴露研究提供了灵活而高效的解决方案。深刻理解它们各自的抽样原理、统计机制和操作特性，是研究设计者做出明智选择的关键。