{
    "hands_on_practices": [
        {
            "introduction": "Cox回归模型的核心在于其巧妙的偏似然函数，它将需要估计的回归系数与未知的基线风险函数分离开来。本练习将引导你为一个包含交错入组和删失数据的小型数据集，从第一性原理出发构建该函数，通过亲手处理风险集和事件时间的贡献，你将深刻理解偏似然的构建逻辑。",
            "id": "4624085",
            "problem": "考虑一个使用 Cox 比例风险 (CPH) 模型建模的事件发生时间结果的队列研究。对于个体 $i$ 在时间 $t$，给定一个不随时间变化的协变量 $X_{i}$，其风险函数为 $h_{i}(t \\mid X_{i}) = h_{0}(t) \\exp(\\beta X_{i})$，其中 $h_{0}(t)$ 是一个未指定的基线风险函数，$\\beta$ 是一个待估计的未知回归系数。\n\n采用计数过程表示法：定义计数过程 $N_{i}(t)$，对于个体 $i$，该过程在其事件发生时间点上跳跃 1，在其他时间保持不变；定义在险指示过程 $Y_{i}(t)$，如果个体 $i$ 在时间 $t$ 之前正在被观察且未发生事件，则其值为 1，否则为 0。在 CPH 模型和独立删失的条件下，$N_{i}(t)$ 的强度函数为 $\\lambda_{i}(t) = Y_{i}(t) h_{0}(t) \\exp(\\beta X_{i})$。\n\n一项包含 4 个体的小型研究，采用交错进入和管理删失的方式进行观察，具体情况如下：\n- 个体 1：在时间 $t=0$ 进入，协变量 $X_{1} = 1$，在时间 $t=2$ 发生事件。\n- 个体 2：在时间 $t=1$ 进入，协变量 $X_{2} = 0$，在时间 $t=5$ 发生事件。\n- 个体 3：在时间 $t=0$ 进入，协变量 $X_{3} = 1$，在时间 $t=4$ 被删失。\n- 个体 4：在时间 $t=3$ 进入，协变量 $X_{4} = 0$，在直到时间 $t=6$ 的观察期内均未发生事件。\n\n假设没有相同的事件时间。使用上述基本定义，并将 $h_{0}(t)$ 在独立删失下视为一个滋扰函数，从第一性原理出发，推导基于在时间 $t=2$ 和 $t=5$ 观察到的事件的 $\\beta$ 的偏似然。该偏似然需用由在险指示符 $Y_{i}(t)$ 决定的风险集来表示。提供偏似然 $L(\\beta)$ 作为 $\\beta$ 的函数的最终简化解析闭式表达式。无需四舍五入，也无需单位。你的最终答案必须是单个表达式。",
            "solution": "该问题要求在 Cox 比例风险 (CPH) 模型下，为给定的数据集推导偏似然函数 $L(\\beta)$。推导将从计数过程背景下的偏似然的基本定义出发。\n\nCPH 模型将个体 $i$ 在时间 $t$ 的风险指定为 $h_{i}(t \\mid X_{i}) = h_{0}(t) \\exp(\\beta X_{i})$，其中 $h_0(t)$ 是基线风险， $X_i$ 是协变量，$\\beta$ 是待估计的系数。在计数过程框架中，个体 $i$ 的过程 $N_i(t)$ 的强度由 $\\lambda_i(t) = Y_i(t) h_i(t \\mid X_i) = Y_i(t) h_0(t) \\exp(\\beta X_i)$ 给出。此处，$Y_i(t)$ 是在险指示符，如果个体 $i$ 在时间 $t$ 之前处于在险状态（即正在被观察且未发生事件），则为 1，否则为 0。\n\n由 D.R. Cox 提出的偏似然，是通过考虑在每个事件时间点，给定该时间点的在险个体集合以及一个事件已发生的事实，观察到实际发生事件的个体是该特定个体的条件概率来构建的。设排序后的不同事件时间为 $t_1  t_2  \\dots  t_k$。设 $d_j$ 是在时间 $t_j$ 发生事件的个体的索引。时间 $t_j$ 的风险集，记作 $R(t_j)$，是所有在 $t_j$ 之前处于在险状态的个体 $i$ 的集合，即 $R(t_j) = \\{i \\mid Y_i(t_j) = 1\\}$。\n\n在事件时间 $t_j$ 对偏似然的贡献是，给定在 $R(t_j)$ 中的研究对象中恰好发生一次失败的条件下，个体 $d_j$ 发生失败的条件概率。该概率由个体 $d_j$ 的风险与风险集中所有个体的风险之和的比值给出：\n$$ L_j(\\beta) = \\frac{h_{d_j}(t_j \\mid X_{d_j})}{\\sum_{i \\in R(t_j)} h_i(t_j \\mid X_i)} $$\n代入 CPH 模型形式 $h_i(t_j \\mid X_i) = h_0(t_j)\\exp(\\beta X_i)$:\n$$ L_j(\\beta) = \\frac{h_0(t_j) \\exp(\\beta X_{d_j})}{\\sum_{i \\in R(t_j)} h_0(t_j) \\exp(\\beta X_i)} $$\n基线风险项 $h_0(t_j)$ 在分子和分母的和的每一项中都是公共的，因此可以消去。这是偏似然的关键思想，因为它允许在不指定或估计 $h_0(t)$ 的情况下估计 $\\beta$。\n$$ L_j(\\beta) = \\frac{\\exp(\\beta X_{d_j})}{\\sum_{i \\in R(t_j)} \\exp(\\beta X_i)} $$\n假设这些条件概率之间相互独立，总偏似然 $L(\\beta)$ 是在所有观察到的事件时间上这些条件概率的乘积。\n$$ L(\\beta) = \\prod_{j=1}^{k} L_j(\\beta) = \\prod_{j=1}^{k} \\frac{\\exp(\\beta X_{d_j})}{\\sum_{i \\in R(t_j)} \\exp(\\beta X_i)} $$\n现在我们将此原理应用于为这 4 个个体提供的具体数据。\n\n数据集是：\n- 个体 1：在 $t=0$ 进入，$X_1 = 1$，在 $t=2$ 发生事件。\n- 个体 2：在 $t=1$ 进入，$X_2 = 0$，在 $t=5$ 发生事件。\n- 个体 3：在 $t=0$ 进入，$X_3 = 1$，在 $t=4$ 被删失。\n- 个体 4：在 $t=3$ 进入，$X_4 = 0$，在 $t=6$ 被删失。\n\n观察到的事件时间是 $t=2$ 和 $t=5$。我们需要为这两个事件中的每一个构建偏似然项。\n\n**1. 在 $t_1 = 2$ 时的事件**\n事件发生在个体 $d_1 = 1$ 身上。我们必须确定风险集 $R(2)$，它由所有在 $t=2$ 之前或之时进入研究，并且在 $t=2$ 之前没有被删失或发生事件的个体组成。\n- 个体 1：在 $t=0$ 进入。在 $t=2$ 时处于在险状态。$Y_1(2)=1$。\n- 个体 2：在 $t=1$ 进入。在 $t=2$ 时处于在险状态。$Y_2(2)=1$。\n- 个体 3：在 $t=0$ 进入。在 $t=2$ 时处于在险状态。$Y_3(2)=1$。\n- 个体 4：在 $t=3$ 进入。在 $t=2$ 时尚未进入研究。$Y_4(2)=0$。\n因此，风险集为 $R(2) = \\{1, 2, 3\\}$。\n\n来自此事件对偏似然的贡献是：\n$$ L_1(\\beta) = \\frac{\\exp(\\beta X_1)}{\\sum_{i \\in R(2)} \\exp(\\beta X_i)} = \\frac{\\exp(\\beta X_1)}{\\exp(\\beta X_1) + \\exp(\\beta X_2) + \\exp(\\beta X_3)} $$\n代入协变量值 $X_1=1$, $X_2=0$ 和 $X_3=1$：\n$$ L_1(\\beta) = \\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1)} = \\frac{\\exp(\\beta)}{\\exp(\\beta) + 1 + \\exp(\\beta)} = \\frac{\\exp(\\beta)}{2\\exp(\\beta) + 1} $$\n\n**2. 在 $t_2 = 5$ 时的事件**\n事件发生在个体 $d_2 = 2$ 身上。我们必须确定风险集 $R(5)$。\n- 个体 1：在 $t=2$ 时发生事件。不再处于在险状态。$Y_1(5)=0$。\n- 个体 2：在 $t=1$ 进入。在 $t=5$ 时处于在险状态。$Y_2(5)=1$。\n- 个体 3：在 $t=4$ 时被删失。不再处于在险状态。$Y_3(5)=0$。\n- 个体 4：在 $t=3$ 进入。在 $t=5$ 时处于在险状态。$Y_4(5)=1$。\n因此，风险集为 $R(5) = \\{2, 4\\}$。\n\n来自此事件对偏似然的贡献是：\n$$ L_2(\\beta) = \\frac{\\exp(\\beta X_2)}{\\sum_{i \\in R(5)} \\exp(\\beta X_i)} = \\frac{\\exp(\\beta X_2)}{\\exp(\\beta X_2) + \\exp(\\beta X_4)} $$\n代入协变量值 $X_2=0$ 和 $X_4=0$：\n$$ L_2(\\beta) = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{1 + 1} = \\frac{1}{2} $$\n\n**3. 总偏似然 $L(\\beta)$**\n总偏似然是每个事件贡献的乘积：\n$$ L(\\beta) = L_1(\\beta) \\times L_2(\\beta) $$\n$$ L(\\beta) = \\left( \\frac{\\exp(\\beta)}{2\\exp(\\beta) + 1} \\right) \\times \\left( \\frac{1}{2} \\right) $$\n简化此表达式可得到偏似然的最终解析闭式表达式：\n$$ L(\\beta) = \\frac{\\exp(\\beta)}{2(2\\exp(\\beta) + 1)} = \\frac{\\exp(\\beta)}{4\\exp(\\beta) + 2} $$\n这就是基于所提供数据的关于 $\\beta$ 的所需偏似然函数。",
            "answer": "$$\\boxed{\\frac{\\exp(\\beta)}{4\\exp(\\beta) + 2}}$$"
        },
        {
            "introduction": "Cox模型的一个强大应用是预测个体的生存结局，例如在特定时间内的发病风险。本练习将演示如何将已估计的回归系数与基线累积风险的非参数估计（Breslow估计量）相结合，从而为具有特定协变量的新病人计算其在特定时间范围内的个体化累积发生率。",
            "id": "4624090",
            "problem": "一项传染病队列研究对 $6$ 名成年人进行了从基线（时间 $0$ 个月）到时间 $12$ 个月的随访，以评估其住院时间。所有个体在时间 $0$ 个月时进入风险集，没有延迟进入（无左删失），且事件时间没有重复值。使用协变量向量 $x=(A,B)$ 拟合了一个 Cox 比例风险回归（Cox 比例风险 (PH) 模型），其中 $A$ 是一个年龄指标（如果年龄 $\\geq 65$ 岁，则 $A=1$，否则 $A=0$），$B$ 是一个基线生物标志物（连续型）。拟合的回归系数为 $\\beta_{A}=0.7$ 和 $\\beta_{B}=0.03$，因此模型风险为 $h(t \\mid x) = h_{0}(t)\\exp(\\beta_{A}A + \\beta_{B}B)$。\n\n这 $6$ 名个体的观测数据如下：\n- 个体 $1$：$A=1$，$B=40$，事件时间 $T=3$ 个月，事件指标 $\\delta=1$。\n- 个体 $2$：$A=0$，$B=20$，事件时间 $T=5$ 个月，事件指标 $\\delta=1$。\n- 个体 $3$：$A=1$，$B=35$，事件时间 $T=8$ 个月，事件指标 $\\delta=1$。\n- 个体 $4$：$A=0$，$B=50$，删失时间 $T=12$ 个月，事件指标 $\\delta=0$。\n- 个体 $5$：$A=1$，$B=30$，事件时间 $T=11$ 个月，事件指标 $\\delta=1$。\n- 个体 $6$：$A=0$，$B=25$，删失时间 $T=12$ 个月，事件指标 $\\delta=0$。\n\n假设基线累积风险 $H_{0}(t)$ 是使用标准的无重复值部分似然法，在观测到的事件时间点上，从拟合的 Cox 模型中估计得到的。考虑一个协变量为 $A_{\\text{new}}=1$ 和 $B_{\\text{new}}=28$ 的新患者。使用比例风险框架和拟合系数，计算该患者个体化的 12 个月累积发病率（12 个月内的住院风险），其定义为 $1 - S(12 \\mid x_{\\text{new}})$，其中 $S(t \\mid x)$ 是 Cox 比例风险模型下的生存函数。\n\n将最终答案四舍五入到四位有效数字，并以小数形式表示（不带百分号）。最终答案无需单位。",
            "solution": "该问题要求在给定一个拟合的 Cox 比例风险 (PH) 模型和一个小队列数据的情况下，计算一个新患者的 12 个月住院累积发病率。对于协变量向量为 $x$ 的患者，其在时间 $t$ 的累积发病率定义为 $1 - S(t \\mid x)$，其中 $S(t \\mid x)$ 是生存函数。\n\nCox PH 模型将风险函数指定为 $h(t \\mid x) = h_0(t) \\exp(\\beta'x)$，其中 $h_0(t)$ 是基线风险函数，$\\beta'x$ 是协变量的线性组合。对应的生存函数由下式给出：\n$$S(t \\mid x) = \\exp(-H(t \\mid x)) = \\exp(-H_0(t) \\exp(\\beta'x))$$\n其中 $H(t \\mid x) = \\int_0^t h(u \\mid x) du$ 是累积风险函数，$H_0(t) = \\int_0^t h_0(u) du$ 是基线累积风险函数。\n\n我们的目标是为协变量为 $A_{\\text{new}}=1$ 和 $B_{\\text{new}}=28$ 的新患者计算 $1 - S(12 \\mid x_{\\text{new}})$。这需要两个组成部分：\n1. 在 $t=12$ 个月时的估计基线累积风险 $\\hat{H}_0(12)$。\n2. 新患者的线性预测值 $\\beta'x_{\\text{new}}$ 和风险评分 $\\exp(\\beta'x_{\\text{new}})$。\n\n拟合模型的系数为 $\\beta_{A}=0.7$ 和 $\\beta_{B}=0.03$。新患者的线性预测值为：\n$$ \\beta'x_{\\text{new}} = \\beta_A A_{\\text{new}} + \\beta_B B_{\\text{new}} = (0.7)(1) + (0.03)(28) = 0.7 + 0.84 = 1.54 $$\n相应的风险评分为 $\\exp(\\beta'x_{\\text{new}}) = \\exp(1.54)$。\n\n接下来，我们使用 Breslow 估计量来估计基线累积风险函数 $H_0(t)$。由于没有重复的事件时间，公式为：\n$$ \\hat{H}_0(t) = \\sum_{j: t_{(j)} \\le t} \\frac{1}{\\sum_{i \\in R(t_{(j)})} \\exp(\\beta'x_i)} $$\n其中 $t_{(j)}$ 是排序后的事件时间，$R(t_{(j)})$ 是就在时间 $t_{(j)}$ 之前的风险集（即仍然处于风险中的个体集合）。队列中观测到的事件时间为 $3$、$5$、$8$ 和 $11$ 个月。\n\n我们必须首先为原始研究中的 $6$ 名个体分别计算风险评分 $\\exp(\\beta'x_i) = \\exp(0.7 A_i + 0.03 B_i)$。\n- 个体 $1$ ($A=1, B=40$)：$\\exp(0.7(1) + 0.03(40)) = \\exp(1.9) \\approx 6.6859$\n- 个体 $2$ ($A=0, B=20$)：$\\exp(0.7(0) + 0.03(20)) = \\exp(0.6) \\approx 1.8221$\n- 个体 $3$ ($A=1, B=35$)：$\\exp(0.7(1) + 0.03(35)) = \\exp(1.75) \\approx 5.7546$\n- 个体 $4$ ($A=0, B=50$)：$\\exp(0.7(0) + 0.03(50)) = \\exp(1.5) \\approx 4.4817$\n- 个体 $5$ ($A=1, B=30$)：$\\exp(0.7(1) + 0.03(30)) = \\exp(1.6) \\approx 4.9530$\n- 个体 $6$ ($A=0, B=25$)：$\\exp(0.7(0) + 0.03(25)) = \\exp(0.75) \\approx 2.1170$\n\n现在，我们计算在每个事件时间点，风险集内个体的风险评分总和。\n1.  **在 $t=3$ 个月时的事件（个体 $1$）：**\n    风险集 $R(3)$ 包括所有 $6$ 名个体。\n    $$ \\sum_{i \\in R(3)} \\exp(\\beta'x_i) \\approx 6.6859 + 1.8221 + 5.7546 + 4.4817 + 4.9530 + 2.1170 = 25.8143 $$\n2.  **在 $t=5$ 个月时的事件（个体 $2$）：**\n    个体 $1$ 已经发生事件，不再处于风险集中。$R(5) = \\{2, 3, 4, 5, 6\\}$。\n    $$ \\sum_{i \\in R(5)} \\exp(\\beta'x_i) \\approx 1.8221 + 5.7546 + 4.4817 + 4.9530 + 2.1170 = 19.1284 $$\n3.  **在 $t=8$ 个月时的事件（个体 $3$）：**\n    个体 $1$ 和 $2$ 已经发生事件。$R(8) = \\{3, 4, 5, 6\\}$。\n    $$ \\sum_{i \\in R(8)} \\exp(\\beta'x_i) \\approx 5.7546 + 4.4817 + 4.9530 + 2.1170 = 17.3063 $$\n4.  **在 $t=11$ 个月时的事件（个体 $5$）：**\n    个体 $1$、$2$ 和 $3$ 已经发生事件。$R(11) = \\{4, 5, 6\\}$。\n    $$ \\sum_{i \\in R(11)} \\exp(\\beta'x_i) \\approx 4.4817 + 4.9530 + 2.1170 = 11.5517 $$\n\n我们要求解在 12 个月时的基线累积风险值。由于最后一个事件发生在 $t=11$，估计量 $\\hat{H}_0(t)$ 对于 $t \\ge 11$ 是一个常数。因此，$\\hat{H}_0(12) = \\hat{H}_0(11)$。我们将所有事件时间的贡献相加：\n$$ \\hat{H}_0(12) = \\frac{1}{25.8143} + \\frac{1}{19.1284} + \\frac{1}{17.3063} + \\frac{1}{11.5517} $$\n$$ \\hat{H}_0(12) \\approx 0.038738 + 0.052279 + 0.057782 + 0.086567 \\approx 0.235366 $$\n\n现在我们可以计算新患者在 $t=12$ 个月时的估计累积风险：\n$$ \\hat{H}(12 \\mid x_{\\text{new}}) = \\hat{H}_0(12) \\exp(\\beta'x_{\\text{new}}) \\approx 0.235366 \\times \\exp(1.54) $$\n使用 $\\exp(1.54) \\approx 4.664603$，\n$$ \\hat{H}(12 \\mid x_{\\text{new}}) \\approx 0.235366 \\times 4.664603 \\approx 1.09798 $$\n\n接下来，我们计算新患者在 $t=12$ 个月时的估计生存概率：\n$$ \\hat{S}(12 \\mid x_{\\text{new}}) = \\exp(-\\hat{H}(12 \\mid x_{\\text{new}})) \\approx \\exp(-1.09798) \\approx 0.33355 $$\n\n最后，12 个月的累积发病率（风险）是：\n$$ \\text{风险} = 1 - \\hat{S}(12 \\mid x_{\\text{new}}) \\approx 1 - 0.33355 = 0.66645 $$\n问题要求将最终答案四舍五入到四位有效数字。数值 $0.66645$ 四舍五入到四位有效数字是 $0.6664$。",
            "answer": "$$\\boxed{0.6664}$$"
        },
        {
            "introduction": "任何模型的应用都离不开对其拟合优度的检验。鞅残差是诊断Cox模型拟合情况的基本工具，它通过比较个体的实际观测事件数与模型的期望事件数，帮助我们识别模型预测效果不佳的个体。本练习将指导你完成鞅残差的计算，从而深入理解模型验证的关键步骤。",
            "id": "4624088",
            "problem": "考虑一项在流行病学中使用Cox比例风险（PH）模型进行分析的队列研究。存在一个单一的时不变协变量 $x$。假设协变量值为 $x$ 的个体在时间 $t$ 的风险遵循 $h(t \\mid x) = h_{0}(t)\\,\\exp(\\beta x)$，其中 $h_{0}(t)$ 是基线风险，$\\beta$ 是一个有限参数。假设 $\\beta$ 的最大偏似然估计为 $\\hat{\\beta} = 0.5$。对于 $n=5$ 个个体，观测数据如下，其中 $t_{i}$ 是观测时间（以任意时间单位计），$\\delta_{i}$ 是事件指示符（若个体在 $t_{i}$ 时刻发生事件，则 $\\delta_{i}=1$；若个体在 $t_{i}$ 时刻被右删失，则 $\\delta_{i}=0$），$x_{i}$ 是协变量值：\n\n- 个体 $1$：$(t_{1}, \\delta_{1}, x_{1}) = (2, 1, 0)$。\n- 个体 $2$：$(t_{2}, \\delta_{2}, x_{2}) = (3, 0, 1)$。\n- 个体 $3$：$(t_{3}, \\delta_{3}, x_{3}) = (4, 1, 2)$。\n- 个体 $4$：$(t_{4}, \\delta_{4}, x_{4}) = (4, 1, 1)$。\n- 个体 $5$：$(t_{5}, \\delta_{5}, x_{5}) = (5, 0, 0)$。\n\n将时间 $t=4$ 时的结事件（tied failures）视为同时事件。从Cox模型结构和计数过程强度的解释出发，构建与基线风险的偏似然剖分（profiling）一致的基线累积风险的非参数估计量。使用该估计量计算个体3的鞅残差。你的推导必须从模型和强度的定义开始，并逻辑地推导出估计量和残差值。将最终数值答案四舍五入至四位有效数字。将答案表示为一个不带任何单位的纯数字。",
            "solution": "本题要求基于Cox比例风险模型分析，计算个体3的鞅残差。该问题陈述清晰，并且在科学上基于生存分析理论。所有必要信息均已提供。\n\n解答过程分三个阶段进行：\n$1$. 定义理论框架，包括计数过程、Cox模型强度和鞅残差。\n$2$. 使用所提供的数据和参数估计值，构建基线累积风险函数 $\\hat{H}_0(t)$ 的Breslow估计量。\n$3$. 计算个体3的鞅残差 $\\hat{M}_3$。\n\n**1. 理论框架**\n\n在生存分析的计数过程表述中，对于一个大小为 $n$ 的队列中的每个个体 $i$，我们定义：\n- 一个计数过程 $N_i(t)$，它记录个体 $i$ 在时间区间 $[0, t]$ 内观测到的事件数量。对于每个个体最多只有一个事件的事件时间数据，$N_i(t)$ 在个体到时间 $t$ 仍未经历事件时为 $0$，在已经历事件时为 $1$。\n- 一个风险过程 $Y_i(t)$，它是一个指示函数：如果个体 $i$ 在紧邻时间 $t$ 之前处于事件风险中，则 $Y_i(t) = 1$，否则 $Y_i(t)=0$。\n\nCox比例风险模型将计数过程 $N_i(t)$ 的强度过程 $\\lambda_i(t)$ 指定为：\n$$ \\lambda_i(t) = Y_i(t) h(t \\mid x_i) = Y_i(t) h_0(t) \\exp(\\beta x_i) $$\n其中 $h_0(t)$ 是未指定的基线风险函数，$x_i$ 是个体 $i$ 的时不变协变量，$\\beta$ 是对数风险比参数。\n\n计数过程理论中的一个基本结果是，对于每个个体 $i$，由下式定义的过程 $M_i(t)$\n$$ M_i(t) = N_i(t) - \\Lambda_i(t) = N_i(t) - \\int_0^t \\lambda_i(u) du $$\n是一个鞅。过程 $\\Lambda_i(t) = \\int_0^t \\lambda_i(u) du$ 是累积强度。代入Cox模型强度，我们得到：\n$$ \\Lambda_i(t) = \\int_0^t Y_i(u) \\exp(\\beta x_i) h_0(u) du = \\exp(\\beta x_i) \\int_0^t Y_i(u) dH_0(u) $$\n其中 $H_0(t) = \\int_0^t h_0(u) du$ 是基线累积风险函数。\n\n个体 $i$ 的鞅残差是此鞅在其观测结束时的估计值，$\\hat{M}_i = \\hat{M}_i(t_i)$。它的计算方法是个体 $i$ 的观测事件数 $\\delta_i$ 减去该个体的估计累积风险 $\\hat{\\Lambda}_i(t_i)$。\n$$ \\hat{M}_i = \\delta_i - \\hat{\\Lambda}_i(t_i) = \\delta_i - \\exp(\\hat{\\beta} x_i) \\hat{H}_0(t_i; \\hat{\\beta}) $$\n在这里，$\\hat{\\beta}$ 是 $\\beta$ 的估计值，而 $\\hat{H}_0(t; \\hat{\\beta})$ 是使用 $\\hat{\\beta}$ 计算的基线累积风险的估计量。\n\n**2. 基线累积风险的估计**\n\n问题指定使用与偏似然剖分一致的 $H_0(t)$ 估计量。这就是Breslow估计量，它是一个在不同事件时间点发生跳跃的阶梯函数。设排序后的不同事件时间为 $\\tau_1  \\tau_2  \\dots  \\tau_D$。设 $d_j$ 为时间 $\\tau_j$ 的事件数，$R(\\tau_j)$ 为时间 $\\tau_j$ 的风险集（即处于风险中的个体集合）。Breslow估计量在 $\\tau_j$ 的增量为：\n$$ \\Delta\\hat{H}_0(\\tau_j) = \\frac{d_j}{\\sum_{k \\in R(\\tau_j)} \\exp(\\hat{\\beta} x_k)} $$\n在时间 $t$ 的累积估计量是所有不晚于 $t$ 的事件时间的增量之和：\n$$ \\hat{H}_0(t; \\hat{\\beta}) = \\sum_{\\tau_j \\le t} \\Delta\\hat{H}_0(\\tau_j) $$\n\n根据数据，不同的事件时间是 $\\tau_1=2$ 和 $\\tau_2=4$。参数估计值为 $\\hat{\\beta} = 0.5$。\n\n在事件时间 $\\tau_1 = 2$：\n- 事件发生在个体1身上，因此事件数为 $d_1 = 1$。\n- 风险集 $R(2)$ 包括所有个体，因为在时间2之前没有个体发生事件或被删失。$R(2) = \\{1, 2, 3, 4, 5\\}$。\n- 风险集中的协变量为 $x_1=0$, $x_2=1$, $x_3=2$, $x_4=1$, $x_5=0$。\n- 增量的分母是：\n$$ \\sum_{k \\in R(2)} \\exp(\\hat{\\beta} x_k) = \\exp(0.5 \\cdot 0) + \\exp(0.5 \\cdot 1) + \\exp(0.5 \\cdot 2) + \\exp(0.5 \\cdot 1) + \\exp(0.5 \\cdot 0) $$\n$$ = 1 + \\exp(0.5) + \\exp(1) + \\exp(0.5) + 1 = 2 + 2\\exp(0.5) + \\exp(1) $$\n- 增量为 $\\Delta\\hat{H}_0(2) = \\frac{1}{2 + 2\\exp(0.5) + \\exp(1)}$。\n\n在事件时间 $\\tau_2 = 4$：\n- 事件发生在个体3和个体4身上。根据将结事件视为同时事件的指示，事件数为 $d_2 = 2$。\n- 风险集 $R(4)$ 包括所有在时间4之前未发生事件或被删失的个体。个体1在 $t=2$ 时发生事件，个体2在 $t=3$ 时被删失。因此，$R(4) = \\{3, 4, 5\\}$。\n- 该风险集中的协变量为 $x_3=2$, $x_4=1$, $x_5=0$。\n- 增量的分母是：\n$$ \\sum_{k \\in R(4)} \\exp(\\hat{\\beta} x_k) = \\exp(0.5 \\cdot 2) + \\exp(0.5 \\cdot 1) + \\exp(0.5 \\cdot 0) $$\n$$ = \\exp(1) + \\exp(0.5) + 1 = 1 + \\exp(0.5) + \\exp(1) $$\n- 增量为 $\\Delta\\hat{H}_0(4) = \\frac{2}{1 + \\exp(0.5) + \\exp(1)}$。\n\n**3. 计算个体3的鞅残差**\n\n个体3的数据为 $(t_3, \\delta_3, x_3) = (4, 1, 2)$。鞅残差为：\n$$ \\hat{M}_3 = \\delta_3 - \\exp(\\hat{\\beta} x_3) \\hat{H}_0(t_3; \\hat{\\beta}) $$\n我们需要计算 $\\hat{H}_0(t_3; \\hat{\\beta}) = \\hat{H}_0(4; 0.5)$。这是直到并包括时间 $t=4$ 的所有增量之和。\n$$ \\hat{H}_0(4; 0.5) = \\Delta\\hat{H}_0(2) + \\Delta\\hat{H}_0(4) = \\frac{1}{2 + 2\\exp(0.5) + \\exp(1)} + \\frac{2}{1 + \\exp(0.5) + \\exp(1)} $$\n个体3的指数项是 $\\exp(\\hat{\\beta} x_3) = \\exp(0.5 \\cdot 2) = \\exp(1)$。\n\n将这些代入 $\\hat{M}_3$ 的公式：\n$$ \\hat{M}_3 = 1 - \\exp(1) \\left[ \\frac{1}{2 + 2\\exp(0.5) + \\exp(1)} + \\frac{2}{1 + \\exp(0.5) + \\exp(1)} \\right] $$\n现在，我们进行数值计算。\n第一项的分母是：\n$2 + 2\\exp(0.5) + \\exp(1) \\approx 2 + 2(1.648721) + 2.718282 = 8.015724$。\n第二项的分母是：\n$1 + \\exp(0.5) + \\exp(1) \\approx 1 + 1.648721 + 2.718282 = 5.367003$。\n在 $t=4$ 时的基线累积风险估计为：\n$$ \\hat{H}_0(4; 0.5) \\approx \\frac{1}{8.015724} + \\frac{2}{5.367003} \\approx 0.124754 + 0.372571 = 0.497325 $$\n个体3的估计累积风险为：\n$$ \\hat{\\Lambda}_3(4) = \\exp(1) \\times \\hat{H}_0(4; 0.5) \\approx 2.718282 \\times 0.497325 \\approx 1.352054 $$\n最后，个体3的鞅残差为：\n$$ \\hat{M}_3 = \\delta_3 - \\hat{\\Lambda}_3(4) = 1 - 1.352054 = -0.352054 $$\n将结果四舍五入至四位有效数字，得到 $-0.3521$。",
            "answer": "$$ \\boxed{-0.3521} $$"
        }
    ]
}