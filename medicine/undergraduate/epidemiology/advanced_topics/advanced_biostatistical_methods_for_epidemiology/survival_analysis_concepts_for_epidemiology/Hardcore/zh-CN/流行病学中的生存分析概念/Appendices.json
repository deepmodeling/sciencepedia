{
    "hands_on_practices": [
        {
            "introduction": "Kaplan-Meier (KM) 估计方法是非参数生存分析的基石。第一个练习将指导您完成从原始数据计算 KM 生存函数 $\\widehat{S}(t)$ 的基本步骤，并使用 Greenwood 公式量化其不确定性。掌握这一过程对于解读任何流行病学研究中的生存数据都至关重要。",
            "id": "4640253",
            "problem": "一位研究人员正在研究一个存在右删失的传染病队列中发生临床事件的时间。生存时间 $T$ 定义为从研究入组到首次观察到事件的时间。生存函数为 $S(t) = \\Pr(T > t)$。假设右删失为非信息性的，且各参与者的生存时间相互独立。乘积极限估计量，也称为 Kaplan-Meier (KM) 估计量，用于根据事件时间和删失时间来估计 $S(t)$。当事件和删失记录在同一时间点时，处理时将事件视为在该时间点删失之前发生。\n\n观察了一个包含 $12$ 名参与者的小数据集，每名参与者都有一个时间（单位：月）和一个指示该时间是事件（$\\delta = 1$）还是右删失（$\\delta = 0$）的指标：\n- 参与者 $1$：时间 $2$，$\\delta = 1$\n- 参与者 $2$：时间 $3$，$\\delta = 0$\n- 参与者 $3$：时间 $4$，$\\delta = 1$\n- 参与者 $4$：时间 $5$，$\\delta = 1$\n- 参与者 $5$：时间 $6$，$\\delta = 0$\n- 参与者 $6$：时间 $7$，$\\delta = 1$\n- 参与者 $7$：时间 $8$，$\\delta = 1$\n- 参与者 $8$：时间 $9$，$\\delta = 0$\n- 参与者 $9$：时间 $10$，$\\delta = 1$\n- 参与者 $10$：时间 $12$，$\\delta = 1$\n- 参与者 $11$：时间 $12$，$\\delta = 0$\n- 参与者 $12$：时间 $15$，$\\delta = 0$\n\n使用 Kaplan-Meier 估计量，计算在选定时间点 $t \\in \\{3, 6, 9, 12\\}$ 月时的 $\\widehat{S}(t)$。然后，使用 Greenwood 公式计算 Kaplan-Meier 估计量的方差，并求出 $\\widehat{S}(12)$ 的标准误。\n\n将最终答案四舍五入至四位有效数字。将最终答案表示为不带单位的小数。",
            "solution": "生存函数为 $S(t) = \\Pr(T > t)$，定义于非负时间 $t$。在生存时间独立和非信息性右删失的条件下，Kaplan-Meier 估计量 $\\widehat{S}(t)$ 是通过在每个不同事件时间点，基于风险集计算的条件生存概率的乘积得到的。设不同的事件时间为 $\\{t_{(1)}, t_{(2)}, \\dots\\}$，在每个事件时间 $t_{(j)}$，令 $n_j$ 为紧邻 $t_{(j)}$ 之前处于风险中的个体数，$d_j$ 为在 $t_{(j)}$ 发生的事件数；则乘积极限估计为\n$$\n\\widehat{S}(t) = \\prod_{j: t_{(j)} \\le t} \\left(1 - \\frac{d_j}{n_j}\\right) = \\prod_{j: t_{(j)} \\le t} \\frac{n_j - d_j}{n_j}.\n$$\n在右删失下，于时间 $c$ 被删失的个体对直至时间 $c$ 的风险集有贡献，但之后则没有；如果事件和删失发生在同一时间，为了风险集核算，事件在删失之前处理。\n\n我们首先对观察到的时间进行排序，并确定不同的事件时间和风险集。事件时间为 $2, 4, 5, 7, 8, 10, 12$，每个时间点有一次事件。删失时间为 $3, 6, 9, 12, 15$。最初有 $12$ 名参与者处于风险中。\n\n我们按时间顺序计算 $n_j$ 和 $d_j$（在时间相同时，事件先于删失发生）：\n- 在时间 2：$n_1 = 12$，$d_1 = 1$。\n- 在时间 4：$n_2 = 10$，$d_2 = 1$。\n- 在时间 5：$n_3 = 9$，$d_3 = 1$。\n- 在时间 7：$n_4 = 7$，$d_4 = 1$。\n- 在时间 8：$n_5 = 6$，$d_5 = 1$。\n- 在时间 10：$n_6 = 4$，$d_6 = 1$。\n- 在时间 12：事件先于同一时间的删失发生，所以 $n_7 = 3$，$d_7 = 1$。\n\n因此，在事件时间点的 $(n_j, d_j)$ 对为 $(12,1), (10,1), (9,1), (7,1), (6,1), (4,1), (3,1)$。\n\n通过将截至时间 $t$ 的相应项相乘，计算在选定时间点 $t \\in \\{3,6,9,12\\}$ 月时的 $\\widehat{S}(t)$：\n- 对于 $t = 3$：$\\widehat{S}(3) = \\frac{12 - 1}{12} = \\frac{11}{12}$。\n- 对于 $t = 6$：$\\widehat{S}(6) = \\frac{11}{12} \\cdot \\frac{10 - 1}{10} \\cdot \\frac{9 - 1}{9} = \\frac{11}{12} \\cdot \\frac{9}{10} \\cdot \\frac{8}{9} = \\frac{11}{15}$。\n- 对于 $t = 9$：$\\widehat{S}(9) = \\widehat{S}(6) \\cdot \\frac{7 - 1}{7} \\cdot \\frac{6 - 1}{6} = \\frac{11}{15} \\cdot \\frac{6}{7} \\cdot \\frac{5}{6} = \\frac{11}{21}$。\n- 对于 $t = 12$：$\\widehat{S}(12) = \\widehat{S}(9) \\cdot \\frac{4 - 1}{4} \\cdot \\frac{3 - 1}{3} = \\frac{11}{21} \\cdot \\frac{3}{4} \\cdot \\frac{2}{3} = \\frac{11}{42}$。\n\n为使用 Greenwood 公式计算 $t = 12$ 时的标准误，我们使用乘积极限估计量的方差估计：\n$$\n\\widehat{\\operatorname{Var}}\\!\\left(\\widehat{S}(t)\\right) = \\widehat{S}(t)^{2} \\sum_{j: t_{(j)} \\le t} \\frac{d_j}{n_j \\left(n_j - d_j\\right)}.\n$$\n此处，每个事件时间点的 $d_j = 1$，因此对于 $t = 12$，总和为\n$$\n\\sum_{j=1}^7 \\frac{1}{n_j \\left(n_j - 1\\right)} = \\frac{1}{12 \\cdot 11} + \\frac{1}{10 \\cdot 9} + \\frac{1}{9 \\cdot 8} + \\frac{1}{7 \\cdot 6} + \\frac{1}{6 \\cdot 5} + \\frac{1}{4 \\cdot 3} + \\frac{1}{3 \\cdot 2} = \\frac{3139}{9240}.\n$$\n因此，\n$$\n\\widehat{\\operatorname{Var}}\\!\\left(\\widehat{S}(12)\\right) = \\left(\\frac{11}{42}\\right)^{2} \\cdot \\frac{3139}{9240} = \\frac{121}{1764} \\cdot \\frac{3139}{9240} \\approx 0.02330168.\n$$\nGreenwood 标准误是方差的平方根：\n$$\n\\widehat{\\operatorname{SE}}\\!\\left(\\widehat{S}(12)\\right) = \\sqrt{0.02330168} \\approx 0.15265.\n$$\n四舍五入到四位有效数字，标准误为 $0.1527$。",
            "answer": "$$\\boxed{0.1527}$$"
        },
        {
            "introduction": "在许多队列研究中，受试者在不同时间点入组，这种现象被称为左截断或延迟进入。本练习将演示如何在 Kaplan-Meier 分析中为左截断数据正确调整风险集，并通过与忽略截断的朴素方法进行对比，量化由此产生的误差。理解如何处理这类真实世界数据的复杂性对于获得无偏的生存估计至关重要。",
            "id": "4640230",
            "problem": "一项针对诊断患有慢性病的患者的流行病学队列研究旨在估计自诊断以来的生存函数（以月为单位），并允许由于交错入组而导致的延迟进入。个体只有在入组后才被观察；因此，生存时间会受到左截断（延迟进入）的影响。在独立右删失和独立延迟进入的条件下，生存函数 $S(t)$ 定义为事件时间 $T$ 超过 $t$ 的概率，而 Kaplan-Meier (KM) 估计量是非参数最大似然估计量，它是根据不同事件时间点的条件生存概率，使用相应的风险集构建的。\n\n给定一个包含 $8$ 个体的小数据集。对于每个个体 $i$，自诊断以来的进入时间为 $L_i$（月），观测时间为 $O_i$（月），事件指示符为 $\\delta_i$（在时间 $O_i$ 死亡时 $\\delta_i = 1$；在时间 $O_i$ 右删失时 $\\delta_i = 0$）。数据如下：\n\n- 个体 $1$：$L_1 = 0$，$O_1 = 5$，$\\delta_1 = 1$。\n- 个体 $2$：$L_2 = 3$，$O_2 = 10$，$\\delta_2 = 0$。\n- 个体 $3$：$L_3 = 2$，$O_3 = 8$，$\\delta_3 = 1$。\n- 个体 $4$：$L_4 = 6$，$O_4 = 12$，$\\delta_4 = 1$。\n- 个体 $5$：$L_5 = 0$，$O_5 = 7$，$\\delta_5 = 0$。\n- 个体 $6$：$L_6 = 9$，$O_6 = 15$，$\\delta_6 = 1$。\n- 个体 $7$：$L_7 = 4$，$O_7 = 11$，$\\delta_7 = 1$。\n- 个体 $8$：$L_8 = 1$，$O_8 = 14$，$\\delta_8 = 0$。\n\n请用两种方法计算在 $t = 12$ 个月时生存函数的 KM 估计值：\n\n$1.$ 正确处理左截断的 KM 估计，其中每个事件时间的风险集仅包括那些在该事件时间之前严格进入研究 ($L_i  t_j$)，并且之前未经历事件或删失 ($O_i \\geq t_j$) 的个体。\n\n$2.$ 忽略左截断的朴素 KM 估计，其中所有个体都被视为从时间 $0$ 开始就处于观察之下，无论其实际进入时间如何，并且每个事件时间的风险集包括所有观测时间至少为该事件时间且之前未经历事件或删失的个体。\n\n使用这两种构建方法，计算差值 $\\hat{S}_{\\text{LT}}(12) - \\hat{S}_{\\text{naive}}(12)$，结果为一个精确值。请将您的最终答案表示为单个数字或单个闭式解析表达式，不带单位。无需四舍五入。",
            "solution": "生存函数 $S(t)$ 的 Kaplan-Meier (KM) 乘积极限估计量由以下公式给出：\n$$ \\hat{S}(t) = \\prod_{j: t_j \\leq t} \\left(1 - \\frac{d_j}{n_j}\\right) $$\n其中 $t_j$ 是不同的事件时间，$d_j$ 是在时间 $t_j$ 发生的事件数，$n_j$ 是在时间 $t_j$ 之前瞬间风险集中的个体数。我们需要计算 $t=12$ 时的这个值。\n\n首先，我们从数据中识别出不同的事件时间。事件对应于 $\\delta_i=1$。排序后的不同事件时间为 $t_1=5$, $t_2=8$, $t_3=11$, $t_4=12$ 和 $t_5=15$。为了计算在 $t=12$ 时的生存函数，我们需要考虑所有直到并包括 $12$ 的事件时间：$5$, $8$, $11$ 和 $12$。在这些时间点，每个时间点都发生了一个事件，因此对于 $j=1, 2, 3, 4$，$d_j=1$。\n\n**1. 计算左截断 KM 估计值, $\\hat{S}_{\\text{LT}}(12)$**\n在事件时间 $t_j$，风险集 $R(t_j)$ 由已进入研究 ($L_i  t_j$) 且仍在观察中 ($O_i \\geq t_j$) 的个体 $i$ 组成。风险集的大小为 $n_j = |R(t_j)|$。\n- **在事件时间 $t_1 = 5$ 时**：风险集 $R(5)$ 包括 $L_i  5$ 且 $O_i \\geq 5$ 的个体。风险中的个体为 $\\{1, 2, 3, 5, 7, 8\\}$。因此 $n_1 = 6$，$d_1 = 1$。\n- **在事件时间 $t_2 = 8$ 时**：风险集 $R(8)$ 包括 $L_i  8$ 且 $O_i \\geq 8$ 的个体。风险中的个体为 $\\{2, 3, 4, 7, 8\\}$。因此 $n_2 = 5$，$d_2 = 1$。\n- **在事件时间 $t_3 = 11$ 时**：风险集 $R(11)$ 包括 $L_i  11$ 且 $O_i \\geq 11$ 的个体。风险中的个体为 $\\{4, 6, 7, 8\\}$。因此 $n_3 = 4$，$d_3 = 1$。\n- **在事件时间 $t_4 = 12$ 时**：风险集 $R(12)$ 包括 $L_i  12$ 且 $O_i \\geq 12$ 的个体。风险中的个体为 $\\{4, 6, 8\\}$。因此 $n_4 = 3$，$d_4 = 1$。\n\n在 $t=12$ 时的左截断 KM 估计值是这些因子的乘积：\n$$ \\hat{S}_{\\text{LT}}(12) = \\left(1-\\frac{1}{6}\\right) \\left(1-\\frac{1}{5}\\right) \\left(1-\\frac{1}{4}\\right) \\left(1-\\frac{1}{3}\\right) = \\frac{5}{6} \\times \\frac{4}{5} \\times \\frac{3}{4} \\times \\frac{2}{3} = \\frac{2}{6} = \\frac{1}{3} $$\n\n**2. 计算朴素 KM 估计值, $\\hat{S}_{\\text{naive}}(12)$**\n在事件时间 $t_j$，朴素风险集 $R(t_j)$ 包括所有仍在观察中 ($O_i \\geq t_j$) 的个体 $i$，忽略其进入时间 $L_i$。\n- **在事件时间 $t_1 = 5$ 时**：风险集 $R(5)$ 包括所有 $O_i \\geq 5$ 的 $8$ 个个体。$n_1 = 8$, $d_1 = 1$。\n- **在事件时间 $t_2 = 8$ 时**：风险集 $R(8)$ 包括 $O_i \\geq 8$ 的 $6$ 个个体。$n_2 = 6$, $d_2 = 1$。\n- **在事件时间 $t_3 = 11$ 时**：风险集 $R(11)$ 包括 $O_i \\geq 11$ 的 $4$ 个个体。$n_3 = 4$, $d_3 = 1$。\n- **在事件时间 $t_4 = 12$ 时**：风险集 $R(12)$ 包括 $O_i \\geq 12$ 的 $3$ 个个体。$n_4 = 3$, $d_4 = 1$。\n\n在 $t=12$ 时的朴素 KM 估计值是这些因子的乘积：\n$$ \\hat{S}_{\\text{naive}}(12) = \\left(1-\\frac{1}{8}\\right) \\left(1-\\frac{1}{6}\\right) \\left(1-\\frac{1}{4}\\right) \\left(1-\\frac{1}{3}\\right) = \\frac{7}{8} \\times \\frac{5}{6} \\times \\frac{3}{4} \\times \\frac{2}{3} = \\frac{35}{96} $$\n\n**3. 计算差值**\n$$ \\hat{S}_{\\text{LT}}(12) - \\hat{S}_{\\text{naive}}(12) = \\frac{1}{3} - \\frac{35}{96} = \\frac{32}{96} - \\frac{35}{96} = -\\frac{3}{96} = -\\frac{1}{32} $$",
            "answer": "$$\\boxed{-\\frac{1}{32}}$$"
        },
        {
            "introduction": "除了描述生存状况，我们通常还想了解暴露或协变量如何影响生存。Cox比例风险模型使我们能够估计风险比，但真实世界的数据常常带来挑战，例如事件时间出现平局（tied events）。本练习将探讨两种常用方法——Breslow近似和Efron近似——如何处理平局数据以估计风险比，从而突显应用这一强大模型时的实践细节。",
            "id": "4640241",
            "problem": "在一个事件发生时间结果的队列研究中，考虑使用 Cox 比例风险 (PH) 模型，其风险函数为 $h(t \\mid x) = h_{0}(t)\\exp(\\beta x)$，其中 $x \\in \\{0,1\\}$ 是一个二元暴露变量。观察到一个包含相同事件时间的小型数据集，其受试者级别的信息 $(t_i, d_i, x_i)$ 如下：\n- 受试者 1： $(t_1 = 2, d_1 = 1, x_1 = 1)$\n- 受试者 2： $(t_2 = 2, d_2 = 1, x_2 = 0)$\n- 受试者 3： $(t_3 = 3, d_3 = 0, x_3 = 1)$\n- 受试者 4： $(t_4 = 5, d_4 = 1, x_4 = 1)$\n- 受试者 5： $(t_5 = 5, d_5 = 1, x_5 = 0)$\n- 受试者 6： $(t_6 = 7, d_6 = 0, x_6 = 0)$\n\n此处，$t_i$ 是观测时间，$d_i$ 是事件指示符（如果事件发生则为 $1$，如果删失则为 $0$），$x_i$ 是暴露情况。假设为独立的非信息性删失。使用 Cox PH 部分似然，并分别通过 Breslow 近似和 Efron 近似来处理相同事件时间，计算在这两种近似下风险比 $\\exp(\\beta)$ 的最大部分似然估计。然后计算这两个估计的风险比之比，定义为\n$$\nR \\equiv \\frac{\\widehat{\\exp(\\beta)}_{\\text{Efron}}}{\\widehat{\\exp(\\beta)}_{\\text{Breslow}}}.\n$$\n报告 $R$ 的值，四舍五入到四位有效数字。最终答案中不要包含任何单位。",
            "solution": "该问题要求计算基于 Cox 比例风险模型的风险比 $\\theta \\equiv \\exp(\\beta)$ 的两个估计值之比，这两个估计值分别通过最大化 Breslow 和 Efron 近似的部分似然函数得到。\n\n首先，我们整理数据并识别事件时间。唯一的有序事件时间是 $\\tau_1 = 2$ 和 $\\tau_2 = 5$。在每个时间点都有两个事件发生（即平局）。\n\n**事件时间 $\\tau_1 = 2$**：\n- 风险集 $R_1 = \\{1, 2, 3, 4, 5, 6\\}$。\n- 事件集 $D_1 = \\{1, 2\\}$，事件数量 $m_1 = 2$。\n- 失败者的协变量之和 $S_1 = \\sum_{i \\in D_1} x_i = x_1 + x_2 = 1 + 0 = 1$。\n- 风险集中的风险权重总和：$\\sum_{k \\in R_1} \\theta^{x_k} = \\theta^1 + \\theta^0 + \\theta^1 + \\theta^1 + \\theta^0 + \\theta^0 = 3\\theta + 3$。\n- 风险集中加权的协变量总和：$\\sum_{k \\in R_1} x_k \\theta^{x_k} = 1\\cdot\\theta^1 + 0\\cdot\\theta^0 + 1\\cdot\\theta^1 + 1\\cdot\\theta^1 + 0\\cdot\\theta^0 + 0\\cdot\\theta^0 = 3\\theta$。\n\n**事件时间 $\\tau_2 = 5$**：\n- 风险集 $R_2$ 包括在 $t=5$ 之前未失败或删失的受试者：$R_2 = \\{4, 5, 6\\}$。\n- 事件集 $D_2 = \\{4, 5\\}$，事件数量 $m_2 = 2$。\n- 失败者的协变量之和 $S_2 = \\sum_{i \\in D_2} x_i = x_4 + x_5 = 1 + 0 = 1$。\n- 风险集中的风险权重总和：$\\sum_{k \\in R_2} \\theta^{x_k} = \\theta^1 + \\theta^0 + \\theta^0 = \\theta + 2$。\n- 风险集中加权的协变量总和：$\\sum_{k \\in R_2} x_k \\theta^{x_k} = 1\\cdot\\theta^1 + 0\\cdot\\theta^0 + 0\\cdot\\theta^0 = \\theta$。\n\n**Breslow 近似**\n通过求解得分方程 $U_{\\text{Breslow}}(\\beta) = 0$ 得到最大部分似然估计 (MPLE)，其中：\n$$U_{\\text{Breslow}}(\\beta) = \\sum_{j=1}^2 \\left[ S_j - m_j \\frac{\\sum_{k \\in R_j} x_k \\theta^{x_k}}{\\sum_{k \\in R_j} \\theta^{x_k}} \\right] = 0$$\n代入数值：\n$$ \\left[ 1 - 2 \\frac{3\\theta}{3\\theta+3} \\right] + \\left[ 1 - 2 \\frac{\\theta}{\\theta+2} \\right] = 0 $$\n$$ 2 = 2 \\left( \\frac{\\theta}{\\theta+1} + \\frac{\\theta}{\\theta+2} \\right) \\implies 1 = \\frac{\\theta(\\theta+2) + \\theta(\\theta+1)}{(\\theta+1)(\\theta+2)} $$\n$$ \\theta^2 + 3\\theta + 2 = 2\\theta^2 + 3\\theta \\implies \\theta^2 = 2 $$\n因此，$\\widehat{\\theta}_{\\text{Breslow}} = \\sqrt{2}$。\n\n**Efron 近似**\nEfron 的得分方程为：\n$$U_{\\text{Efron}}(\\beta) = \\sum_{j=1}^2 \\left[ S_j - \\sum_{l=0}^{m_j-1} \\frac{\\sum_{k \\in R_j} x_k \\theta^{x_k} - \\frac{l}{m_j}\\sum_{i \\in D_j} x_i \\theta^{x_i}}{\\sum_{k \\in R_j} \\theta^{x_k} - \\frac{l}{m_j}\\sum_{i \\in D_j} \\theta^{x_i}} \\right] = 0$$\n对于 $\\tau_1=2$ ($m_1=2$)：\n- 事件集风险权重：$\\sum_{D_1} \\theta^{x_i} = \\theta+1$，加权协变量和：$\\sum_{D_1} x_i \\theta^{x_i} = \\theta$。\n- 减去项为：$\\frac{3\\theta}{3\\theta+3} + \\frac{3\\theta - \\frac{1}{2}\\theta}{3\\theta+3 - \\frac{1}{2}(\\theta+1)} = \\frac{\\theta}{\\theta+1} + \\frac{2.5\\theta}{2.5\\theta+2.5} = \\frac{2\\theta}{\\theta+1}$。\n对于 $\\tau_2=5$ ($m_2=2$)：\n- 事件集风险权重：$\\sum_{D_2} \\theta^{x_i} = \\theta+1$，加权协变量和：$\\sum_{D_2} x_i \\theta^{x_i} = \\theta$。\n- 减去项为：$\\frac{\\theta}{\\theta+2} + \\frac{\\theta - \\frac{1}{2}\\theta}{\\theta+2 - \\frac{1}{2}(\\theta+1)} = \\frac{\\theta}{\\theta+2} + \\frac{0.5\\theta}{0.5\\theta+1.5} = \\frac{\\theta}{\\theta+2} + \\frac{\\theta}{\\theta+3}$。\n得分方程为：\n$$ \\left(1 - \\frac{2\\theta}{\\theta+1}\\right) + \\left(1 - \\left(\\frac{\\theta}{\\theta+2} + \\frac{\\theta}{\\theta+3}\\right)\\right) = 0 $$\n$$ \\frac{2}{\\theta+1} = \\frac{\\theta}{\\theta+2} + \\frac{\\theta}{\\theta+3} \\implies \\frac{2}{\\theta+1} = \\frac{2\\theta^2+5\\theta}{\\theta^2+5\\theta+6} $$\n整理后得到三次方程：\n$$ 2\\theta^3 + 5\\theta^2 - 5\\theta - 12 = 0 $$\n通过数值方法求解，得到正实根 $\\widehat{\\theta}_{\\text{Efron}} \\approx 1.5615555$。\n\n**计算比率 R**\n$$ R = \\frac{\\widehat{\\theta}_{\\text{Efron}}}{\\widehat{\\theta}_{\\text{Breslow}}} \\approx \\frac{1.5615555}{\\sqrt{2}} \\approx 1.1041865 $$\n四舍五入到四位有效数字，我们得到 $1.104$。",
            "answer": "$$ \\boxed{1.104} $$"
        }
    ]
}