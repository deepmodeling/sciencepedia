{
    "hands_on_practices": [
        {
            "introduction": "生存分析的核心任务之一是估计生存函数，即个体在某个时间点之后仍然存活的概率。Kaplan-Meier（KM）估计量是实现这一目标的最基本也是最强大的非参数工具，它能够有效处理删失数据。通过亲手计算KM生存曲线及其标准误，你将深入理解风险集、事件数和条件生存概率这些构建所有生存模型的基础概念。",
            "id": "4640253",
            "problem": "一位研究者正在研究一个传染病队列中发生临床事件的时间，数据存在右删失。生存时间 $T$ 定义为从研究开始到首次观测到事件的时间。生存函数为 $S(t) = \\Pr(T > t)$。假设参与者间的生存时间独立且为非信息性右删失。乘积极限估计量，也称为 Kaplan-Meier (KM) 估计量，用于根据事件时间和删失时间来估计 $S(t)$。当事件和删失记录在同一时间点时，处理时应将事件视为在该时间点删失发生之前发生。\n\n观测了一个包含 $12$ 名参与者的小型数据集，每名参与者都有一个单一时间（单位：月）和一个指示该时间是事件（$\\delta = 1$）还是右删失（$\\delta = 0$）的指示符：\n- 参与者 $1$：时间 $2$，$\\delta = 1$\n- 参与者 $2$：时间 $3$，$\\delta = 0$\n- 参与者 $3$：时间 $4$，$\\delta = 1$\n- 参与者 $4$：时间 $5$，$\\delta = 1$\n- 参与者 $5$：时间 $6$，$\\delta = 0$\n- 参与者 $6$：时间 $7$，$\\delta = 1$\n- 参与者 $7$：时间 $8$，$\\delta = 1$\n- 参与者 $8$：时间 $9$，$\\delta = 0$\n- 参与者 $9$：时间 $10$，$\\delta = 1$\n- 参与者 $10$：时间 $12$，$\\delta = 1$\n- 参与者 $11$：时间 $12$，$\\delta = 0$\n- 参与者 $12$：时间 $15$，$\\delta = 0$\n\n使用 Kaplan-Meier 估计量，计算在选定的时间点 $t \\in \\{3, 6, 9, 12\\}$ 月时 $\\widehat{S}(t)$ 的值。然后，使用 Greenwood 公式计算 Kaplan-Meier 估计量的方差，并求出 $\\widehat{S}(12)$ 的标准误。\n\n将最终答案四舍五入至四位有效数字。最终答案以小数形式表示，不带单位。",
            "solution": "生存函数为 $S(t) = \\Pr(T > t)$，定义在非负时间 $t$ 上。在生存时间独立和非信息性右删失的条件下，Kaplan-Meier 估计量 $\\widehat{S}(t)$ 是通过基于风险集在每个不同事件时间点估计的条件生存概率的乘积得到的。设不同的事件时间为 $\\{t_{(1)}, t_{(2)}, \\dots\\}$，在每个事件时间 $t_{(j)}$，设 $n_j$ 为紧接在 $t_{(j)}$ 之前的风险人数，$d_j$ 为在 $t_{(j)}$ 发生的事件数；那么乘积极限估计为\n$$\n\\widehat{S}(t) \\;=\\; \\prod_{j: t_{(j)} \\le t} \\left(1 - \\frac{d_j}{n_j}\\right) \\;=\\; \\prod_{j: t_{(j)} \\le t} \\frac{n_j - d_j}{n_j}.\n$$\n在右删失下，于时间 $c$ 被删失的个体在时间 $c$ 之前（包括 $c$）对风险集有贡献，但在该时间点之后则没有；如果事件和删失发生在同一时间，为了计算风险集，事件应在删失之前处理。\n\n我们首先对观测到的时间进行排序，并识别出不同的事件时间和风险集。事件时间为\n$$\n2, \\; 4, \\; 5, \\; 7, \\; 8, \\; 10, \\; 12,\n$$\n每个时间点有一次事件。删失时间为\n$$\n3, \\; 6, \\; 9, \\; 12, \\; 15.\n$$\n最初有 $12$ 名参与者处于风险中。\n\n我们按时间顺序计算 $n_j$ 和 $d_j$（在时间点相同时，事件先于删失发生）：\n- 在时间 $2$：$n_1 = 12$, $d_1 = 1$。事件发生后，剩余 $11$ 人。\n- 在时间 $3$（删失）：删失后，从 $11$ 人变为 $10$ 人。\n- 在时间 $4$：$n_2 = 10$, $d_2 = 1$。事件发生后，剩余 $9$ 人。\n- 在时间 $5$：$n_3 = 9$, $d_3 = 1$。事件发生后，剩余 $8$ 人。\n- 在时间 $6$（删失）：从 $8$ 人变为 $7$ 人。\n- 在时间 $7$：$n_4 = 7$, $d_4 = 1$。事件发生后，剩余 $6$ 人。\n- 在时间 $8$：$n_5 = 6$, $d_5 = 1$。事件发生后，剩余 $5$ 人。\n- 在时间 $9$（删失）：从 $5$ 人变为 $4$ 人。\n- 在时间 $10$：$n_6 = 4$, $d_6 = 1$。事件发生后，剩余 $3$ 人。\n- 在时间 $12$：事件先于同一时间的删失发生，所以 $n_7 = 3$, $d_7 = 1$；事件发生后，剩余 $2$ 人，然后在时间 $12$ 的删失事件使得剩余人数减少到 $1$ 人。\n- 在时间 $15$（删失）：从 $1$ 人变为 $0$ 人。\n\n因此，在各事件时间点的 $(n_j, d_j)$ 对为\n$$\n(12,1),\\; (10,1),\\; (9,1),\\; (7,1),\\; (6,1),\\; (4,1),\\; (3,1).\n$$\n\n通过将截至时间 $t$ 的相应项相乘，计算在选定时间点 $t \\in \\{3,6,9,12\\}$ 月的 $\\widehat{S}(t)$：\n- 对于 $t = 3$：只有时间 $2$ 有贡献，\n$$\n\\widehat{S}(3) \\;=\\; \\frac{12 - 1}{12} \\;=\\; \\frac{11}{12}.\n$$\n- 对于 $t = 6$：时间 $2,4,5$ 有贡献，\n$$\n\\widehat{S}(6) \\;=\\; \\frac{11}{12} \\cdot \\frac{10 - 1}{10} \\cdot \\frac{9 - 1}{9}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{9}{10} \\cdot \\frac{8}{9}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{8}{10}\n\\;=\\; \\frac{11}{15}.\n$$\n- 对于 $t = 9$：时间 $2,4,5,7,8$ 有贡献，\n$$\n\\widehat{S}(9) \\;=\\; \\frac{11}{12} \\cdot \\frac{9}{10} \\cdot \\frac{8}{9} \\cdot \\frac{7 - 1}{7} \\cdot \\frac{6 - 1}{6}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{8}{10} \\cdot \\frac{6}{7} \\cdot \\frac{5}{6}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{4}{5} \\cdot \\frac{5}{7}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{4}{7}\n\\;=\\; \\frac{11}{21}.\n$$\n- 对于 $t = 12$：时间 $2,4,5,7,8,10,12$ 有贡献，\n$$\n\\widehat{S}(12) \\;=\\; \\widehat{S}(9) \\cdot \\frac{4 - 1}{4} \\cdot \\frac{3 - 1}{3}\n\\;=\\; \\frac{11}{21} \\cdot \\frac{3}{4} \\cdot \\frac{2}{3}\n\\;=\\; \\frac{11}{21} \\cdot \\frac{1}{2}\n\\;=\\; \\frac{11}{42}.\n$$\n\n为了使用 Greenwood 公式计算在 $t=12$ 时的标准误，我们使用乘积极限估计量的一个经过充分检验的方差估计量：\n$$\n\\widehat{\\mathrm{Var}}\\!\\left(\\widehat{S}(t)\\right) \\;=\\; \\widehat{S}(t)^{2} \\sum_{j: t_{(j)} \\le t} \\frac{d_j}{n_j \\left(n_j - d_j\\right)}.\n$$\n此处，每个事件时间点的 $d_j = 1$，所以对于 $t = 12$，总和为\n$$\n\\sum_{j} \\frac{1}{n_j \\left(n_j - 1\\right)} \\;=\\; \\frac{1}{12 \\cdot 11} \\;+\\; \\frac{1}{10 \\cdot 9} \\;+\\; \\frac{1}{9 \\cdot 8} \\;+\\; \\frac{1}{7 \\cdot 6} \\;+\\; \\frac{1}{6 \\cdot 5} \\;+\\; \\frac{1}{4 \\cdot 3} \\;+\\; \\frac{1}{3 \\cdot 2}.\n$$\n精确计算每一项并求和，\n$$\n\\frac{1}{132} \\;+\\; \\frac{1}{90} \\;+\\; \\frac{1}{72} \\;+\\; \\frac{1}{42} \\;+\\; \\frac{1}{30} \\;+\\; \\frac{1}{12} \\;+\\; \\frac{1}{6}\n\\;=\\; \\frac{3139}{9240}.\n$$\n因此，\n$$\n\\widehat{\\mathrm{Var}}\\!\\left(\\widehat{S}(12)\\right)\n\\;=\\; \\left(\\frac{11}{42}\\right)^{2} \\cdot \\frac{3139}{9240}\n\\;=\\; \\frac{121}{1764} \\cdot \\frac{3139}{9240}\n\\;=\\; \\frac{379819}{16299360}.\n$$\nGreenwood 标准误是方差的平方根：\n$$\n\\widehat{\\mathrm{SE}}\\!\\left(\\widehat{S}(12)\\right)\n\\;=\\; \\sqrt{\\frac{379819}{16299360}}.\n$$\n从数值上看，\n$$\n\\frac{379819}{16299360} \\approx 0.02330168,\n$$\n所以\n$$\n\\sqrt{0.02330168} \\approx 0.15265.\n$$\n四舍五入到四位有效数字，标准误为 $0.1527$。",
            "answer": "$$\\boxed{0.1527}$$"
        },
        {
            "introduction": "在描述了单组人群的生存模式后，流行病学家通常更关心不同因素（如暴露或治疗）如何影响生存。Cox比例风险模型是量化这些影响的黄金标准，它能估计风险比（Hazard Ratio）。本练习将带你处理一个常见的数据挑战——事件时间平局，并通过比较Breslow和Efron这两种近似方法，让你一窥统计软件在拟合Cox模型时的内部机制。",
            "id": "4640241",
            "problem": "在一项关于时间-事件结局的队列研究中，考虑使用 Cox 比例风险 (PH) 模型，其风险函数为 $h(t \\mid x) = h_{0}(t)\\exp(\\beta x)$，其中 $x \\in \\{0,1\\}$ 是一个二元暴露变量。观察到一个包含相同事件时间的小数据集，其受试者水平的信息 $(t_i, d_i, x_i)$ 如下：\n- 受试者 $1$：$(t_1 = 2, d_1 = 1, x_1 = 1)$\n- 受试者 $2$：$(t_2 = 2, d_2 = 1, x_2 = 0)$\n- 受试者 $3$：$(t_3 = 3, d_3 = 0, x_3 = 1)$\n- 受试者 $4$：$(t_4 = 5, d_4 = 1, x_4 = 1)$\n- 受试者 $5$：$(t_5 = 5, d_5 = 1, x_5 = 0)$\n- 受试者 $6$：$(t_6 = 7, d_6 = 0, x_6 = 0)$\n\n此处，$t_i$ 是观测时间，$d_i$ 是事件指示符（如果事件发生则为 $1$，如果删失则为 $0$），$x_i$ 是暴露情况。假设为独立非信息性删失。使用 Cox PH 偏似然法，分别通过 Breslow 近似法和 Efron 近似法处理相同事件时间，计算风险比 $\\exp(\\beta)$ 在每种近似法下的最大偏似然估计值。然后，计算这两个估计的风险比之比，定义为\n$$\nR \\equiv \\frac{\\widehat{\\exp(\\beta)}_{\\text{Efron}}}{\\widehat{\\exp(\\beta)}_{\\text{Breslow}}}.\n$$\n报告 $R$ 的值，四舍五入到四位有效数字。最终答案中不要包含任何单位。",
            "solution": "为了计算风险比的比值 $R$，我们首先需要使用Breslow近似法和Efron近似法，通过最大化偏似然函数来分别估计风险比 $\\theta = \\exp(\\beta)$。\n\n### 步骤 1：整理数据并确定事件时间\n\n首先，我们从数据中确定唯一的事件时间。当事件指示符 $d_i=1$ 时，事件发生。\n- 在时间 $t=2$ 时，受试者 1 和 2 发生事件。\n- 在时间 $t=5$ 时，受试者 4 和 5 发生事件。\n唯一的有序事件时间是 $\\tau_1 = 2$ 和 $\\tau_2 = 5$。\n\n令 $\\theta = \\exp(\\beta)$ 为风险比。得分函数 $U(\\beta)$ 是对数偏似然函数关于 $\\beta$ 的导数。最大偏似然估计 (MPLE) 是通过求解 $U(\\beta) = 0$ 得到的。\n\n### 步骤 2：分析每个事件时间\n\n我们需要在每个唯一事件时间 $\\tau_j$ 定义风险集 $R_j$ 和发生事件的个体集合 $D_j$。\n\n**事件时间 $\\tau_1 = 2$**：\n- 风险集 $R_1$ 包含所有在 $t=2$ 之前未失败或未删失的受试者。所有 6 名受试者都在风险集中：$R_1 = \\{1, 2, 3, 4, 5, 6\\}$。\n- 事件集 $D_1$ 包含在 $t=2$ 时失败的受试者：$D_1 = \\{1, 2\\}$。事件数量为 $m_1 = |D_1| = 2$。\n- 失败者的协变量之和为 $S_1 = \\sum_{i \\in D_1} x_i = x_1 + x_2 = 1 + 0 = 1$。\n- 让我们计算风险集和事件集上的风险贡献总和。令 $\\theta = \\exp(\\beta)$。\n  - 风险集 $R_1$ 上的总和：$\\sum_{k \\in R_1} \\theta^{x_k} = \\theta^1 + \\theta^0 + \\theta^1 + \\theta^1 + \\theta^0 + \\theta^0 = 3\\theta + 3$。\n  - 风险集 $R_1$ 上按风险加权的协变量总和：$\\sum_{k \\in R_1} x_k \\theta^{x_k} = 1\\cdot\\theta^1 + 0\\cdot\\theta^0 + 1\\cdot\\theta^1 + 1\\cdot\\theta^1 + 0\\cdot\\theta^0 + 0\\cdot\\theta^0 = 3\\theta$。\n  - 事件集 $D_1$ 上的总和：$\\sum_{i \\in D_1} \\theta^{x_i} = \\theta^1 + \\theta^0 = \\theta + 1$。\n  - 事件集 $D_1$ 上按风险加权的协变量总和：$\\sum_{i \\in D_1} x_i \\theta^{x_i} = 1\\cdot\\theta^1 + 0\\cdot\\theta^0 = \\theta$。\n\n**事件时间 $\\tau_2 = 5$**：\n- 风险集 $R_2$ 包含在 $t=5$ 之前未失败或未删失的受试者。受试者 1 和 2 在 $t=2$ 时失败，受试者 3 在 $t=3$ 时被删失。因此，$R_2 = \\{4, 5, 6\\}$。\n- 事件集 $D_2$ 包含在 $t=5$ 时失败的受试者：$D_2 = \\{4, 5\\}$。事件数量为 $m_2 = |D_2| = 2$。\n- 失败者的协变量之和为 $S_2 = \\sum_{i \\in D_2} x_i = x_4 + x_5 = 1 + 0 = 1$。\n- 让我们计算必要的总和。\n  - 风险集 $R_2$ 上的总和：$\\sum_{k \\in R_2} \\theta^{x_k} = \\theta^1 + \\theta^0 + \\theta^0 = \\theta + 2$。\n  - 风险集 $R_2$ 上按风险加权的协变量总和：$\\sum_{k \\in R_2} x_k \\theta^{x_k} = 1\\cdot\\theta^1 + 0\\cdot\\theta^0 + 0\\cdot\\theta^0 = \\theta$。\n  - 事件集 $D_2$ 上的总和：$\\sum_{i \\in D_2} \\theta^{x_i} = \\theta^1 + \\theta^0 = \\theta + 1$。\n  - 事件集 $D_2$ 上按风险加权的协变量总和：$\\sum_{i \\in D_2} x_i \\theta^{x_i} = 1\\cdot\\theta^1 + 0\\cdot\\theta^0 = \\theta$。\n\n### 步骤 3：Breslow 近似法\n\nBreslow 得分函数由下式给出：\n$$U_{\\text{Breslow}}(\\beta) = \\sum_{j} \\left[ S_j - m_j \\frac{\\sum_{k \\in R_j} x_k \\exp(\\beta x_k)}{\\sum_{k \\in R_j} \\exp(\\beta x_k)} \\right]$$\n我们令 $U_{\\text{Breslow}}(\\beta) = 0$ 并求解 $\\theta = \\exp(\\beta)$。\n$$\n\\left[ 1 - 2 \\frac{3\\theta}{3\\theta+3} \\right] + \\left[ 1 - 2 \\frac{\\theta}{\\theta+2} \\right] = 0\n$$\n$$\n2 = 2 \\frac{3\\theta}{3(\\theta+1)} + 2 \\frac{\\theta}{\\theta+2}\n$$\n两边除以 $2$ 并化简：\n$$\n1 = \\frac{\\theta}{\\theta+1} + \\frac{\\theta}{\\theta+2}\n$$\n$$\n1 = \\frac{\\theta(\\theta+2) + \\theta(\\theta+1)}{(\\theta+1)(\\theta+2)}\n$$\n$$\n(\\theta+1)(\\theta+2) = \\theta^2 + 2\\theta + \\theta^2 + \\theta\n$$\n$$\n\\theta^2 + 3\\theta + 2 = 2\\theta^2 + 3\\theta\n$$\n$$\n\\theta^2 = 2 \\implies \\theta = \\sqrt{2} \\quad (\\text{因为 } \\theta > 0)\n$$\n因此，使用 Breslow 近似法得到的风险比估计值为 $\\widehat{\\theta}_{\\text{Breslow}} = \\sqrt{2}$。\n\n### 步骤 4：Efron 近似法\n\nEfron 得分函数由下式给出：\n$$\nU_{\\text{Efron}}(\\beta) = \\sum_{j} \\left[ S_j - \\sum_{l=0}^{m_j-1} \\frac{\\sum_{k \\in R_j} x_k e^{\\beta x_k} - \\frac{l}{m_j}\\sum_{i \\in D_j} x_i e^{\\beta x_i}}{\\sum_{k \\in R_j} e^{\\beta x_k} - \\frac{l}{m_j}\\sum_{i \\in D_j} e^{\\beta x_i}} \\right]\n$$\n令 $U_{\\text{Efron}}(\\beta) = 0$ 可得：\n$$\n(S_1 - \\text{term for } \\tau_1) + (S_2 - \\text{term for } \\tau_2) = 0\n$$\n对于 $\\tau_1=2$，其中 $m_1=2$：\n$$\n\\sum_{l=0}^{1} \\frac{\\sum_{R_1} x_k \\theta^{x_k} - \\frac{l}{2}\\sum_{D_1} x_i \\theta^{x_i}}{\\sum_{R_1} \\theta^{x_k} - \\frac{l}{2}\\sum_{D_1} \\theta^{x_i}} = \\frac{3\\theta}{3\\theta+3} + \\frac{3\\theta - \\frac{1}{2}\\theta}{3\\theta+3 - \\frac{1}{2}(\\theta+1)} = \\frac{\\theta}{\\theta+1} + \\frac{5\\theta/2}{(5\\theta+5)/2} = \\frac{\\theta}{\\theta+1} + \\frac{\\theta}{\\theta+1} = \\frac{2\\theta}{\\theta+1}\n$$\n对于 $\\tau_2=5$，其中 $m_2=2$：\n$$\n\\sum_{l=0}^{1} \\frac{\\sum_{R_2} x_k \\theta^{x_k} - \\frac{l}{2}\\sum_{D_2} x_i \\theta^{x_i}}{\\sum_{R_2} \\theta^{x_k} - \\frac{l}{2}\\sum_{D_2} \\theta^{x_i}} = \\frac{\\theta}{\\theta+2} + \\frac{\\theta - \\frac{1}{2}\\theta}{\\theta+2 - \\frac{1}{2}(\\theta+1)} = \\frac{\\theta}{\\theta+2} + \\frac{\\theta/2}{(\\theta+3)/2} = \\frac{\\theta}{\\theta+2} + \\frac{\\theta}{\\theta+3}\n$$\n得分方程为：\n$$\n\\left(1 - \\frac{2\\theta}{\\theta+1}\\right) + \\left(1 - \\left(\\frac{\\theta}{\\theta+2} + \\frac{\\theta}{\\theta+3}\\right)\\right) = 0\n$$\n$$\n2 = \\frac{2\\theta}{\\theta+1} + \\frac{\\theta}{\\theta+2} + \\frac{\\theta}{\\theta+3}\n$$\n整理各项：\n$$\n2 - \\frac{2\\theta}{\\theta+1} = \\frac{2(\\theta+1)-2\\theta}{\\theta+1} = \\frac{2}{\\theta+1}\n$$\n因此我们有：\n$$\n\\frac{2}{\\theta+1} = \\frac{\\theta}{\\theta+2} + \\frac{\\theta}{\\theta+3} = \\frac{\\theta(\\theta+3) + \\theta(\\theta+2)}{(\\theta+2)(\\theta+3)} = \\frac{2\\theta^2+5\\theta}{\\theta^2+5\\theta+6}\n$$\n这给出了方程：\n$$\n2(\\theta^2+5\\theta+6) = (\\theta+1)(2\\theta^2+5\\theta)\n$$\n$$\n2\\theta^2 + 10\\theta + 12 = 2\\theta^3 + 2\\theta^2 + 5\\theta^2 + 5\\theta\n$$\n$$\n2\\theta^2 + 10\\theta + 12 = 2\\theta^3 + 7\\theta^2 + 5\\theta\n$$\n化简后得到三次方程：\n$$\n2\\theta^3 + 5\\theta^2 - 5\\theta - 12 = 0\n$$\n我们需要找到这个多项式的正实根。使用数值求解器，我们发现根约为 $\\theta \\approx 1.5615555$。\n因此，使用 Efron 近似法得到的风险比估计值为 $\\widehat{\\theta}_{\\text{Efron}} \\approx 1.5615555$。\n\n### 步骤 5：计算比值 R\n\n所要求的比值为 $R = \\frac{\\widehat{\\theta}_{\\text{Efron}}}{\\widehat{\\theta}_{\\text{Breslow}}}$。\n$$\nR = \\frac{1.5615555...}{\\sqrt{2}} \\approx \\frac{1.5615555...}{1.41421356...} \\approx 1.1041865...\n$$\n四舍五入到四位有效数字，我们得到 $1.104$。",
            "answer": "$$ \\boxed{1.104} $$"
        },
        {
            "introduction": "任何统计模型都建立在特定的假设之上，Cox模型的核心是比例风险（Proportional Hazards）假设，即协变量的效应（风险比）不随时间改变。如果这一假设不成立，模型的结论便可能产生误导。通过计算和分析Schoenfeld残差，你可以学习如何诊断模型是否满足比例风险假设，这是确保生存分析结果可靠性的关键一步。",
            "id": "4640222",
            "problem": "一位研究者在一个流行病学队列中拟合了一个包含单个协变量的 Cox 比例风险模型，其中受试者 $i$ 在时间 $t$ 的风险为 $h(t \\mid x_i) = h_0(t) \\exp(\\beta x_i)$。考虑以下包含 $5$ 名受试者的玩具数据集，每名受试者都有以月为单位的随访时间、一个事件指示符 $\\delta_i$（$1$ 表示事件，$0$ 表示右删失）和一个单一协变量 $x_i$：\n- 受试者 $1$：$(t_1, \\delta_1, x_1) = (1, 1, 0)$\n- 受试者 $2$：$(t_2, \\delta_2, x_2) = (2, 1, 1)$\n- 受试者 $3$：$(t_3, \\delta_3, x_3) = (3, 1, 2)$\n- 受试者 $4$：$(t_4, \\delta_4, x_4) = (4, 0, 1)$\n- 受试者 $5$：$(t_5, \\delta_5, x_5) = (5, 1, 0)$\n\n对这些数据拟合的 Cox 模型得出的估计对数风险比为 $\\hat{\\beta} = \\ln(2)$，估计方差为 $\\widehat{\\mathrm{Var}}(\\hat{\\beta}) = \\frac{1}{2}$。\n\n仅使用 Cox 偏似然和 Schoenfeld 残差的定义，完成以下操作：\n1) 对于每个事件时间 $t_i$（其中 $\\delta_i = 1$），计算 Schoenfeld 残差 $r_i = x_i - \\bar{x}(\\hat{\\beta}, t_i)$，其中 $\\bar{x}(\\hat{\\beta}, t_i)$ 是在拟合模型下，时间 $t_i$ 时 $x$ 的风险集加权平均值。然后计算缩放的 Schoenfeld 残差 $s_i = \\widehat{\\mathrm{Var}}(\\hat{\\beta}) \\, r_i$。\n2) 使用普通最小二乘法（无权重），将缩放的 Schoenfeld 残差 $s_i$ 对相应的事件时间 $t_i$ 进行回归，即在所有事件时间上拟合 $s_i = a + b \\, t_i + \\varepsilon_i$。计算斜率 $b$。\n3) 最后，用文字说明，一个统计上显著为正的斜率 $b$ 对比例风险假设和协变量效应的时间趋势意味着什么。\n\n仅报告斜率 $b$ 的数值作为最终答案，四舍五入到四位有效数字。斜率的单位为残差单位/月（最终答案框中不要包含单位）。",
            "solution": "我们从 Cox 模型和 Schoenfeld 残差的定义开始。Cox 模型指定 $h(t \\mid x) = h_0(t) \\exp(\\beta x)$。Cox 偏似然是基于风险集构建的。对于在时间 $t_i$ 观察到的事件，协变量 $x$ 在拟合参数 $\\hat{\\beta}$ 下的 Schoenfeld 残差为\n$$\nr_i = x_i - \\bar{x}(\\hat{\\beta}, t_i),\n$$\n其中\n$$\n\\bar{x}(\\hat{\\beta}, t_i) = \\frac{\\sum_{j \\in \\mathcal{R}(t_i)} x_j \\exp(\\hat{\\beta} x_j)}{\\sum_{j \\in \\mathcal{R}(t_i)} \\exp(\\hat{\\beta} x_j)},\n$$\n且 $\\mathcal{R}(t_i)$ 是紧邻 $t_i$ 之前的风险集。根据用于检验比例风险的 Grambsch–Therneau 缩放方法，缩放的 Schoenfeld 残差是通过将 Schoenfeld 残差乘以 $\\hat{\\beta}$ 的估计方差-协方差矩阵来定义的。对于单个协变量，这简化为\n$$\ns_i = \\widehat{\\mathrm{Var}}(\\hat{\\beta}) \\, r_i.\n$$\n\n给定 $\\hat{\\beta} = \\ln(2)$，我们有 $\\exp(\\hat{\\beta}) = 2$ 和 $\\exp(2 \\hat{\\beta}) = 4$。我们列举事件时间（$\\delta_i = 1$）并计算风险集加权平均值。\n\n事件发生在 $t_1 = 1$（受试者 $1$，$x_1 = 0$）：\n- 风险集 $\\mathcal{R}(t_1) = \\{1,2,3,4,5\\}$，其 $(x_1, x_2, x_3, x_4, x_5) = (0,1,2,1,0)$。\n- 在 $\\hat{\\beta}$ 下的风险得分为 $\\exp(\\hat{\\beta} x) = (1, 2, 4, 2, 1)$。\n- 分母 $D_1 = 1 + 2 + 4 + 2 + 1 = 10$。\n- 分子 $N_1 = 0 \\cdot 1 + 1 \\cdot 2 + 2 \\cdot 4 + 1 \\cdot 2 + 0 \\cdot 1 = 12$。\n- 加权平均值 $\\bar{x}(\\hat{\\beta}, t_1) = \\frac{12}{10} = 1.2$。\n- Schoenfeld 残差 $r_1 = x_1 - \\bar{x}(\\hat{\\beta}, t_1) = 0 - 1.2 = -1.2$。\n- 缩放残差 $s_1 = \\widehat{\\mathrm{Var}}(\\hat{\\beta}) r_1 = \\frac{1}{2} \\cdot (-1.2) = -0.6$。\n\n事件发生在 $t_2 = 2$（受试者 $2$，$x_2 = 1$）：\n- 风险集 $\\mathcal{R}(t_2) = \\{2,3,4,5\\}$。\n- 协变量 $(x_2, x_3, x_4, x_5) = (1,2,1,0)$，得分为 $(2,4,2,1)$。\n- 分母 $D_2 = 2 + 4 + 2 + 1 = 9$。\n- 分子 $N_2 = 1 \\cdot 2 + 2 \\cdot 4 + 1 \\cdot 2 + 0 \\cdot 1 = 12$。\n- 加权平均值 $\\bar{x}(\\hat{\\beta}, t_2) = \\frac{12}{9} = \\frac{4}{3}$。\n- Schoenfeld 残差 $r_2 = 1 - \\frac{4}{3} = -\\frac{1}{3}$。\n- 缩放残差 $s_2 = \\frac{1}{2} \\cdot \\left(-\\frac{1}{3}\\right) = -\\frac{1}{6}$。\n\n事件发生在 $t_3 = 3$（受试者 $3$，$x_3 = 2$）：\n- 风险集 $\\mathcal{R}(t_3) = \\{3,4,5\\}$。\n- 协变量 $(x_3, x_4, x_5) = (2,1,0)$，得分为 $(4,2,1)$。\n- 分母 $D_3 = 4 + 2 + 1 = 7$。\n- 分子 $N_3 = 2 \\cdot 4 + 1 \\cdot 2 + 0 \\cdot 1 = 10$。\n- 加权平均值 $\\bar{x}(\\hat{\\beta}, t_3) = \\frac{10}{7}$。\n- Schoenfeld 残差 $r_3 = 2 - \\frac{10}{7} = \\frac{4}{7}$。\n- 缩放残差 $s_3 = \\frac{1}{2} \\cdot \\frac{4}{7} = \\frac{2}{7}$。\n\n事件发生在 $t_5 = 5$（受试者 $5$，$x_5 = 0$；注意受试者 $4$ 在 $t_4 = 4$ 时删失）：\n- 风险集 $\\mathcal{R}(t_5) = \\{5\\}$。\n- 协变量 $x_5 = 0$，得分为 $1$。\n- 分母 $D_5 = 1$，分子 $N_5 = 0$。\n- 加权平均值 $\\bar{x}(\\hat{\\beta}, t_5) = 0$。\n- Schoenfeld 残差 $r_5 = 0 - 0 = 0$。\n- 缩放残差 $s_5 = \\frac{1}{2} \\cdot 0 = 0$。\n\n收集事件时间和缩放的 Schoenfeld 残差：\n- $(t_i, s_i) \\in \\{(1, -0.6), (2, -\\frac{1}{6}), (3, \\frac{2}{7}), (5, 0)\\}$.\n\n接下来，使用普通最小二乘法将 $s_i$ 对 $t_i$ 进行回归：$s_i = a + b \\, t_i + \\varepsilon_i$。斜率 $b$ 为\n$$\nb = \\frac{\\sum_{i} (t_i - \\bar{t})(s_i - \\bar{s})}{\\sum_{i} (t_i - \\bar{t})^2}.\n$$\n计算均值：\n$$\n\\bar{t} = \\frac{1 + 2 + 3 + 5}{4} = \\frac{11}{4} = 2.75, \\quad \\bar{s} = \\frac{-\\frac{3}{5} - \\frac{1}{6} + \\frac{2}{7} + 0}{4} = \\frac{-101}{840}.\n$$\n计算分子：\n- 对于 $(t_1, s_1)$: $(t_1 - \\bar{t})(s_1 - \\bar{s}) = \\left(1 - \\frac{11}{4}\\right)\\left(-\\frac{3}{5} + \\frac{101}{840}\\right) = \\left(-\\frac{7}{4}\\right)\\left(-\\frac{403}{840}\\right) = \\frac{2821}{3360}$。\n- 对于 $(t_2, s_2)$: $\\left(2 - \\frac{11}{4}\\right)\\left(-\\frac{1}{6} + \\frac{101}{840}\\right) = \\left(-\\frac{3}{4}\\right)\\left(-\\frac{13}{280}\\right) = \\frac{39}{1120} = \\frac{117}{3360}$。\n- 对于 $(t_3, s_3)$: $\\left(3 - \\frac{11}{4}\\right)\\left(\\frac{2}{7} + \\frac{101}{840}\\right) = \\left(\\frac{1}{4}\\right)\\left(\\frac{341}{840}\\right) = \\frac{341}{3360}$。\n- 对于 $(t_5, s_5)$: $\\left(5 - \\frac{11}{4}\\right)\\left(0 + \\frac{101}{840}\\right) = \\left(\\frac{9}{4}\\right)\\left(\\frac{101}{840}\\right) = \\frac{909}{3360}$。\n求和得到\n$$\n\\sum_{i} (t_i - \\bar{t})(s_i - \\bar{s}) = \\frac{2821 + 117 + 341 + 909}{3360} = \\frac{4188}{3360} = \\frac{349}{280}.\n$$\n计算分母：\n$$\n\\sum_{i} (t_i - \\bar{t})^2 = \\left(-\\frac{7}{4}\\right)^2 + \\left(-\\frac{3}{4}\\right)^2 + \\left(\\frac{1}{4}\\right)^2 + \\left(\\frac{9}{4}\\right)^2 = \\frac{49 + 9 + 1 + 81}{16} = \\frac{140}{16} = \\frac{35}{4}.\n$$\n因此，\n$$\nb = \\frac{\\frac{349}{280}}{\\frac{35}{4}} = \\frac{349}{280} \\cdot \\frac{4}{35} = \\frac{349}{2450} \\approx 0.1424489796.\n$$\n四舍五入到四位有效数字，得到 $b \\approx 0.1424$。\n\n解释：缩放的 Schoenfeld 残差对时间的回归中，一个统计上显著为正的斜率 $b$ 表明协变量对对数风险的影响随时间增加而增加，这违反了比例风险假设。在此背景下，它意味着对数风险比 $\\beta(t)$ 不是恒定的，而是倾向于随 $t$ 增加，表明存在时变协变量效应。",
            "answer": "$$\\boxed{0.1424}$$"
        }
    ]
}