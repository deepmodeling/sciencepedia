## 引言
在生存分析领域，我们常常关注从某个起点到特定事件发生所经历的时间。然而，在许多现实世界的研究中，个体可能经历多种不同类型的终点事件，这些事件相互排斥，一个事件的发生会阻止其他事件的发生。这种现象被称为“竞争风险”，是流行病学、临床研究和公共卫生领域普遍存在的一个核心挑战。简单地忽略或错误处理[竞争风险](@entry_id:173277)，例如使用标准的生存分析技术，会导致对事件发生概率的严重偏倚，从而得出误导性的结论。

本文旨在系统性地解决这一知识鸿沟，为读者提供一个关于[竞争风险分析](@entry_id:634319)与累积发生函数的全面指南。我们将深入探讨为何传统方法会失效，并详细介绍在存在[竞争风险](@entry_id:173277)时进行准确风险评估的正确统计工具。通过阅读本文，您将能够理解[竞争风险分析](@entry_id:634319)的底层逻辑，并学会如何选择和解释适当的模型来回答您的研究问题。

在接下来的章节中，我们将首先在“原理与机制”中奠定理论基础，详细阐述特定原因风险率和累积发生函数（CIF）等核心概念，并剖析误用[Kaplan-Meier](@entry_id:169317)方法所带来的问题。随后，在“应用与跨学科联系”一章，我们将通过肿瘤学、公共卫生、因果推断等领域的丰富案例，展示这些理论在实践中的强大应用。最后，“动手实践”部分将提供具体的计算练习，帮助您将理论知识转化为实践技能。

## 原理与机制

在[竞争风险分析](@entry_id:634319)中，核心挑战在于准确量化特定类型事件的发生概率，同时必须考虑到其他[互斥事件](@entry_id:265118)（即[竞争风险](@entry_id:173277)）的存在。这些竞争事件会将被试从感兴趣事件的风险集中移除，从而影响其发生概率。本章节将从基本原理出发，系统阐述[竞争风险分析](@entry_id:634319)中的核心概念、关键函数、估计方法以及常见的分析误区。

### 基本概念与定义

为了精确地描述竞争风险情景，我们首先需要建立一个数学框架。想象一下，对于研究中的每个个体，理论上都存在一组“潜在失败时间” (latent failure times)，记为 $\{T_1, T_2, \dots, T_K\}$，其中 $T_j$ 代表若只有第 $j$ 种原因存在时，该事件会发生的理论时间。然而，在实际观测中，我们只能观察到这些潜在时间中最早发生的那一个。

因此，对于一个经历了事件的个体，我们观察到两个量：首次事件的发生时间 $T$ 和事件的类型（或原因）$J$。它们与潜在失败时间的关系可以正式定义为：

$T = \min\{T_1, T_2, \dots, T_K\}$

$J = \arg\min_{j \in \{1, \dots, K\}} T_j$

这里的 $T$ 是所有潜在事件时间中的最小值，而 $J$ 则是对应于这个最小时间的事件类型索引。这就是“竞争”一词的根本含义：各种潜在的事件原因在“竞争”成为第一个发生的事件。一旦某个原因（例如 $J=j$）在时间 $T$ 获胜，该个体的首次事件观察期就此结束，我们再也无法观察到其他任何原因（$k \neq j$）的发生。因此，从流行病学角度看，一个原因的发生会使其余原因的观察被“截断”，该个体将从其他原因的风险集中被永久移除 。

**特定原因风险率**

在[竞争风险](@entry_id:173277)框架下，最基本的度量是**特定原因风险率 (cause-specific hazard function)**，记为 $\lambda_k(t)$。它量化了在时间 $t$ 仍然“事件待定”（event-free）的个体，在下一个瞬间发生第 $k$ 类事件的瞬时速率。其严格定义为：

$\lambda_k(t) = \lim_{\Delta t \to 0} \frac{P(t \le T \lt t+\Delta t, J=k \mid T \ge t)}{\Delta t}$

这里的条件 $T \ge t$至关重要，它明确了用于计算风险率的**风险集 (risk set)** 只包含那些直到时间 $t$ 尚未经历任何类型事件的个体。已经因为任何原因（包括竞争原因）发生事件的个体，都不再属于这个风险集。

例如，在一个队列研究中，若在时间点 $t=3$ 年时，有 $200$ 名个体仍未发生任何事件，而在接下来的一个极短的时间窗（如 $\Delta t = 0.005$ 年）内，有 $2$ 人发生了 $k=1$ 型事件，那么在 $t=3$ 时，原因 $1$ 的特定原因风险率可以近似估计为事件发生比例除以时间窗宽度，即 $\hat{\lambda}_1(3) \approx \frac{2/200}{0.005} = 2$ （每年）。

所有特定原因风险率的总和构成了**总风险率 (overall hazard function)** $\lambda(t) = \sum_{k=1}^K \lambda_k(t)$。它决定了研究对象保持“事件待定”状态的概率，即**总生存函数 (overall survival function)** $S(t) = P(T > t) = \exp(-\int_0^t \lambda(u)du)$。

### 累积发生函数：关键的衡量指标

虽然特定原因风险率是分析的基础，但它不是一个概率，对于临床预测和公共卫生决策而言不够直观。在这些应用场景中，我们更关心的是“到某个时间点，发生某类事件的累积概率是多少？” 回答这个问题的量就是**累积发生函数 (Cumulative Incidence Function, CIF)**，通常记为 $F_k(t)$。

$F_k(t)$ 定义为到时间 $t$ 为止，已经发生第 $k$ 类事件的概率：

$F_k(t) = P(T \le t, J=k)$

$F_k(t)$ 也常被称为**粗风险 (crude risk)** 或**绝对风险 (absolute risk)**，因为它是在所有其他竞争风险真实存在的情况下，特定事件发生的实际概率。

$F_k(t)$ 与特定原因风险率和总生存函数之间存在一个核心的数学关系。要在一个瞬间 $u$ 发生 $k$ 类事件，个体必须首先“存活”到那个时刻（即未发生任何事件），其概率为 $S(u)$，然后再乘以在该瞬间发生 $k$ 类事件的条件速率 $\lambda_k(u)du$。将这些瞬时概率从时间 $0$ 累积到 $t$，便得到了 CIF 的积分表达式：

$F_k(t) = \int_0^t S(u) \lambda_k(u) du$

这个公式清晰地表明，$F_k(t)$ 不仅依赖于其自身的[风险率](@entry_id:266388) $\lambda_k(u)$，还通过 $S(u)$ 依赖于所有其他竞争原因的风险率 $\lambda_j(u) (j \neq k)$ 。这是[竞争风险分析](@entry_id:634319)中最核心的洞见之一。如果任何一个竞争原因的风险率 $\lambda_j(u)$ 增加，总[风险率](@entry_id:266388) $\lambda(u)$ 就会增加，导致总生存概率 $S(u)$ 下降。进而，由于 $S(u)$ 是被积函数的一部分，整个积分值 $F_k(t)$ 也会随之减小。这意味着，**一个竞争性事件变得越普遍，你所关心的事件发生的累积概率就越低**。

一个有趣的特例是，当时间 $t$ 趋近于 $0$ 时，生存概率 $S(u)$ 近似为 $1$，此时 $F_k(t) \approx \int_0^t \lambda_k(u)du$。如果风险率是常数 $\lambda_k$，则 $F_k(t) \approx \lambda_k t$。这意味着在极短的时间内，一个事件的累积发生概率主要由其自身的[风险率](@entry_id:266388)决定，[竞争风险](@entry_id:173277)的影响尚未显现 。

为了更具体地理解，我们来看一个计算示例 。假设有两种失败原因，其特定原因风险率是分段常数：
-   $0 \le t  1$ 年: $\lambda_1(t) = 0.05$, $\lambda_2(t) = 0.10$
-   $1 \le t \le 2$ 年: $\lambda_1(t) = 0.02$, $\lambda_2(t) = 0.06$

要计算原因 $1$ 在 $2$ 年时的累积发生率 $F_1(2)$，我们需要分段积分。在每个区间内，一个简化的计算公式是 $F_{k, \text{interval}} = \frac{\lambda_k}{\lambda_k+\lambda_j} (S(t_{start}) - S(t_{end}))$。
1.  **区间 $[0, 1)$:**
    -   总风险率 $\lambda(t) = 0.05+0.10 = 0.15$。
    -   $S(1) = \exp(-0.15 \times 1) = \exp(-0.15)$。
    -   此区间的贡献为 $\frac{0.05}{0.15}(S(0) - S(1)) = \frac{1}{3}(1 - \exp(-0.15))$。
2.  **区间 $[1, 2]$:**
    -   总风险率 $\lambda(t) = 0.02+0.06 = 0.08$。
    -   $S(2) = S(1) \times \exp(-0.08 \times 1) = \exp(-0.15) \exp(-0.08) = \exp(-0.23)$。
    -   此区间的贡献为 $\frac{0.02}{0.08}(S(1) - S(2)) = \frac{1}{4}(\exp(-0.15) - \exp(-0.23))$。

将两部分相加，得到 $F_1(2) = \frac{1}{3}(1 - \exp(-0.15)) + \frac{1}{4}(\exp(-0.15) - \exp(-0.23)) \approx 0.063$。这表示在考虑了原因 $2$ 的竞争后，一个个体在两年内因原因 $1$ 发生事件的实际概率约为 $6.3\%$。

### 一个常见的误区：误用Kaplan-Meier方法

在[竞争风险分析](@entry_id:634319)中，最常见且最严重的错误之一，就是**将竞争性事件错误地当作删失 (censoring) 数据处理，然后使用标准的Kaplan-Meier (KM) 方法来估计特定原因的发生概率**。

删失指的是由于研究设计（如研究结束）或偶然原因（如失访）导致对个体事件时间的观察中断，我们只知道其事件时间大于某个观察时间。关键假设是删失与事件过程独立。然而，竞争性事件不是删失。它是一个确定的终点事件，发生后，个体将不再有风险经历我们感兴趣的事件 。

如果错误地将竞争事件（如原因 $2$）当作删失来分析原因 $1$ 的发生情况，KM方法估计的 $1 - S_{KM}(t)$ 实际上是在回答一个完全不同的、假设性的问题：“如果原因 $2$ 不存在（即 $\lambda_2(t)=0$），那么原因 $1$ 的发生概率是多少？” 这个量被称为**净风险 (net risk)**，其数学表达式为 $1 - \exp(-\int_0^t \lambda_1(u)du)$ 。

我们可以用一个例子来展示这种方法的偏差 。假设 $\lambda_1 = 0.10$ 和 $\lambda_2 = 0.20$ 保持不变。
-   **真实的CIF** at $t=2$ 是： $F_1(2) = \frac{\lambda_1}{\lambda_1+\lambda_2}(1 - \exp(-(\lambda_1+\lambda_2)t)) = \frac{0.10}{0.30}(1 - \exp(-0.30 \times 2)) \approx 0.150$。
-   **错误的KM方法** 得到的是净风险： $1 - S_{KM,1}(2) = 1 - \exp(-\lambda_1 t) = 1 - \exp(-0.10 \times 2) \approx 0.181$。

可以看到，$0.181  0.150$。KM方法高估了真实风险。这是因为该方法错误地假设那些因竞争事件而退出研究的个体，如果继续随访，仍会以某种速率经历我们感兴趣的事件。实际上他们已经不可能再经历该事件了。这种偏差会随着[竞争风险](@entry_id:173277)的增加而增大，并且不会随着时间的推移而消失。当 $t \to \infty$ 时，净风险趋近于 $1$，而CIF趋近于 $\frac{\lambda_1}{\lambda_1+\lambda_2}$。只有在不存在任何竞争风险（即所有 $\lambda_j(t)=0, j\neq k$）的特殊情况下，CIF才等同于净风险，此时KM方法才是正确的 。

### 实践中的估计与建模

既然标准的KM方法不适用，我们需要正确的工具来估计和建模[竞争风险](@entry_id:173277)数据。

#### 非[参数估计](@entry_id:139349)：Aalen-Johansen估计量

估计CIF的標準[非参数方法](@entry_id:138925)是**Aalen-Johansen (AJ) 估计量**。AJ估计量是上述CIF积分公式的经验模拟。它通过在每个事件时间点上，累加发生特定原因事件的条件概率，并用总生存概率加权。

使用[计数过程](@entry_id:260664)符号，其公式为：

$\hat{F}_k(t) = \sum_{u \le t} \hat{S}(u-) \frac{dN_k(u)}{Y(u)}$

其中：
-   $u$ 代表数据中出现事件的离散时间点。
-   $dN_k(u)$ 是在时间 $u$ 发生 $k$ 类事件的个体数量。
-   $Y(u)$ 是在时间 $u$ 之前瞬间处于风险集中的个体数量（即尚未发生任何事件或被删失）。
-   $\frac{dN_k(u)}{Y(u)}$ 是在时间 $u$ 发生 $k$ 类事件的条件概率的经验估计，即对 $\lambda_k(u)du$ 的估计。
-   $\hat{S}(u-)$ 是在时间 $u$ 之前瞬间的总生存概率的[Kaplan-Meier](@entry_id:169317)估计值。它代表了存活到该时间点以便有机会经历事件的概率。

AJ估计量正确地结合了所有事件类型的信息（通过 $\hat{S}(u-)$）来估计特定原因的累积发生率 。

#### [回归建模](@entry_id:170726)

当需要评估协变量对事件风险的影响时，我们通常采用回归模型。

**1. 特定原因风险模型 (Cause-Specific Hazard Models)**

最直接的建模方法是为每一种事件原因 $k$ 单独建立一个Cox比例风险模型，即**特定原因[Cox模型](@entry_id:164053) (cause-specific Cox model)**：

$\lambda_k(t \mid X) = \lambda_{k0}(t)\exp(\beta_k^\top X)$

这里，$\lambda_{k0}(t)$ 是原因 $k$ 的基线风险函数，$\beta_k$ 是与协变量 $X$ 对应的、特定于原因 $k$ 的对数风险比向量。

在实践中，拟合这一系列模型非常直接：对于原因 $k$ 的模型，我们将所有发生原因 $k$ 事件的个体作为“事件”，而将所有发生其他原因（$j \neq k$）事件的个体以及被常规删失的个体，都在其事件或删失时间点作为“删失”处理。然后，对每种原因分别运行标准的Cox回归程序即可。这种方法的优点是直观且易于实现，它直接模拟了协变量对瞬时事件发生率的影响 。

**2. 子分布风险模型 (Subdistribution Hazard Models)**

另一种方法是直接对CIF进行建模。这通过引入**子分布风险率 (subdistribution hazard)** $h_k^{SD}(t)$ 来实现，其定义为：

$h_k^{SD}(t) = \lim_{\Delta t \to 0} \frac{P(t \le T \lt t+\Delta t, J=k \mid T \ge t \text{ or } (T \le t, J \neq k))}{\Delta t}$

与特定原因风险率相比，子分布风险率的条件部分（即风险集）有本质区别。它的“伪风险集” (pseudo-risk set) 不仅包括那些在时间 $t$ 仍然事件待定的个体 ($T \ge t$)，还包括那些在时间 $t$ 之前已经发生了竞争事件的个体 ($T \le t, J \neq k$)。换言之，这些人虽然已经不可能再经历我们感兴趣的事件，但在数学上他们仍然保留在分母中，以确保模型直接关联到CIF。基于此定义的Fine-Gray模型可以直接估计协变量对CIF的影响 。

### 选择正确的工具：解读与应用

理解了不同的度量指标后，关键在于根据研究问题选择最合适的那个 。

-   **当你的问题是关于预后、绝对风险预测或资源规划时，应使用累积发生函数 (CIF)**。例如：
    -   向一位75岁的癌症患者告知其未来10年内死于该癌症的真实概率，同时考虑到他因其他老年疾病死亡的可能性。
    -   医院管理者需要了解病人入院后30天内院内死亡的实际概率，以评估医疗质量，此时“活着出院”是一个竞争性结局。
    -   公共卫生部门需要预测未来5年内死于[结直肠癌](@entry_id:264919)的实际人数，以配置姑息治疗资源，此时死于其他原因是必须考虑的现实。

-   **当你的问题是关于病因学、探索风险因素如何影响事件发生的瞬时速率或生物学机制时，应关注特定原因[风险率](@entry_id:266388) (Cause-Specific Hazard)**。例如：
    -   一项研究旨在探究某种暴露是否会增加个体在任何时间点（只要他们还未发生任何事件）发生中风的瞬时风险强度。

-   **当你的问题是纯粹的病因学，并且你想探讨在一个“理想世界”里（即没有其他死亡/事件原因）某个因素的“纯粹”效应时，可以使用净风险 (Net Risk)**。例如：
    -   一项关于吸烟的病因学研究，希望量化在剔除其他死亡原因（如心血管疾病）的干扰后，吸烟对致癌过程的“纯粹”影响。然而，必须谨记这是一种假设性分析，其结果的解释需格外小心。

综上所述，[竞争风险分析](@entry_id:634319)提供了一套严谨的工具，用于在复杂的现实世界中准确地评估和预测事件风险。理解CIF的中心地位以及它与特定原因[风险率](@entry_id:266388)的关系，并避免将竞争事件与删失混淆，是进行有效分析的关键。