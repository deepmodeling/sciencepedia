## 引言
在流行病学及更广泛的健康科学领域，一个核心的追求是从观察到的数据中辨别出真正的因果关系。我们每天都会遇到各种关联——某种生活方式似乎与某种疾病相伴，一种新药的使用与某种结局相关联——但关联本身并不能等同于因果。一个未经审视的关联很可能源于偏倚、机遇或潜在的混杂因素，基于此类关联做出的决策可能毫无效果，甚至有害。因此，建立一套严谨的框架，以区分偶然的[统计相关性](@entry_id:267552)和真实的因果效应，是科学研究与公共卫生实践的基石。

本文旨在系统性地介绍流行病学中因果推断的现代概念和方法，为读者构建一个从理论到实践的完整知识体系。通过学习本文，您将能够超越简单的关联分析，掌握进行严谨因果论证所需的工具和思维模式。

- 在“**原理与机制**”一章中，我们将奠定理论基础，从定义个体和平均因果效应的潜在结局框架出发，详细阐述实现因果识别所需的三个核心假设：一致性、[可交换性](@entry_id:263314)和正值性。同时，我们将引入强大的可视化工具——有向无环图（DAGs），以直观地理解和应对混杂与偏倚。

- 接着，在“**应用与跨学科联系**”一章，我们将把这些抽象的原则应用于解决现实世界的问题。通过案例分析，您将看到因果推断如何在临床研究、遗传学、[公共卫生政策](@entry_id:185037)和社会科学等多个领域中发挥关键作用，并学习如何使用[孟德尔随机化](@entry_id:147183)、目标试验模拟等高级方法应对复杂的挑战。

- 最后，在“**动手实践**”部分，我们提供了一系列互动练习，让您亲手运用标准化、[逆概率](@entry_id:196307)加权等核心技术来计算因果效应，将理论知识转化为可操作的技能。

现在，让我们从构建因果推断的基石开始，深入探讨其核心原理与机制。

## 原理与机制

流行病学研究的核心目标之一是识别和量化疾病的病因。然而，从观察数据中推断因果关系充满了挑战。我们观察到的暴露与结局之间的关联，可能真实反映了因果效应，也可能源于偏倚或机遇。本章节旨在深入探讨因果推断的基础原理与机制，为从关联迈向因果提供一个严谨的分析框架。我们将从潜在结局框架（potential outcomes framework）出发，阐明因果效应的定义，进而系统性地介绍识别因果效应所需的三个核心假设：一致性（consistency）、可交换性（exchangeability）和正值性（positivity）。随后，我们将引入[有向无环图](@entry_id:164045)（Directed Acyclic Graphs, DAGs）作为一种强大的可视化工具，用以理解和应对混杂（confounding）与选择偏倚（selection bias）等挑战。最后，本章将延伸至更复杂的场景，包括效应修饰（effect measure modification）、时变混杂（time-varying confounding）和中介分析（mediation analysis），为读者构建一个全面而深入的因果推断知识体系。

### 潜在结局框架：定义因果效应

为了精确地定义因果效应，我们必须超越观察数据，思考反事实（counterfactuals）——即在与事实相反的情况下可能发生什么。**潜在结局框架**，也称为 Neyman-Rubin 因果模型，为这种反事实推理提供了数学语言。

考虑一个二元暴露（或处理）$A$（例如，接受疫苗 $A=1$，未接受疫苗 $A=0$）和一个结局 $Y$（例如，是否感染[流感](@entry_id:190386)）。对于研究中的任何一个个体 $i$，我们设想存在两个**潜在结局**（potential outcomes）：$Y_i^1$ 和 $Y_i^0$。$Y_i^1$ 是指如果该个体接受了暴露（$A=1$），将会观察到的结局；$Y_i^0$ 则是指如果该同一个体未接受暴露（$A=0$），将会观察到的结局。这两个潜在结局是个体固有的属性，在暴露实际发生前就已经存在。

对于个体 $i$ 而言，暴露 $A$ 的**个体因果效应**（individual causal effect）被定义为这两个潜在结局的差值：$Y_i^1 - Y_i^0$。这个定义清晰地捕捉了因果关系的本质：它比较的是同一个体在接受暴露与未接受暴露两种情况下的结局差异。

然而，这一定义也立即揭示了**因果推断的根本难题**（Fundamental Problem of Causal Inference）：对于任何一个个体，我们最多只能观察到其两个潜在结局中的一个。如果个体 $i$ 实际上接受了暴露（$A_i=1$），我们会观察到 $Y_i=Y_i^1$，而其反事实结局 $Y_i^0$ 将永远无法被观测到。反之亦然。因此，我们永远无法直接计算出任何一个个体的因果效应 。

由于个体因果效应无法直接获知，流行病学研究转向估计**平均因果效应**（Average Treatment Effect, ATE），即在整个目标人群中，个体因果效应的平均值：$ATE = E[Y^1 - Y^0]$。通过[期望的线性](@entry_id:273513)性质，这也等于 $E[Y^1] - E[Y^0]$。ATE 回答了这样一个问题：“如果我们将整个人群从全部未暴露的状态切换到全部暴露的状态，人群的平均结局会发生多大变化？”

需要强调的是，这个因果参数 ATE 与我们在数据中直接计算的**关联性差异**（associational contrast）$E[Y|A=1] - E[Y|A=0]$ 有着本质的不同。关联性差异比较的是两个不同人群亚组（实际暴露者和实际未暴露者）的结局均值，而 ATE 比较的是同一个人群在两种不同（反事实）暴露情景下的结局均值。只有在满足特定条件下，我们才能用关联性差异来估计 ATE。接下来的部分将详细阐述这些“特定条件”。

### 因果识别的三大基石

为了从观测数据中识别（identify）或无偏地估计因果效应，我们需要依赖三个核心假设。这三个假设共同构建了一座桥梁，连接了我们能观察到的关联世界和我们希望了解的反事实因果世界。

#### 一致性（Consistency）

一致性假设是我们能将观察数据与潜在结局联系起来的纽带。其形式化表述为，对于任何一个个体，如果其接受的实际暴露水平为 $A=a$，那么其观察到的结局 $Y$ 就等于其在该暴露水平下的潜在结局 $Y^a$。我们可以简洁地写为 $Y = Y^A$。

这个假设看似不言自明，但它隐含了一个重要前提：我们所谈论的暴露 $A$ 必须是**明确定义的**（well-defined）。如果暴露水平 $A=1$ 内部存在多种不同版本或变体，且这些变体对结局有不同影响，那么一致性假设就可能被违背。例如，在一项评估物理治疗效果的研究中，如果数据库中所有接受治疗的患者都被记录为 $A=1$，但实际上他们接受的治疗强度有“高强度”和“低强度”之分（$v_{\text{high}}, v_{\text{low}}$），并且对于某些患者来说，$Y^{1, v_{\text{high}}} \neq Y^{1, v_{\text{low}}}$。在这种情况下，并不存在一个唯一的潜在结局 $Y^1$。我们观察到的 $E[Y|A=1]$ 实际上是两种不同治疗效果的混合体，它无法识别任何一个明确定义的因果效应 。

另一个破坏一致性的常见情况是**暴露测量误差**。假设我们想研究真实暴露 $A$ 的效应，但我们只能观察到一个错误分类的代理变量 $A^*$。此时，我们观察到的结局 $Y$ 仍然遵循 $Y=Y^A$，但我们试图建立的关联是基于 $A^*$ 的。由于 $A$ 和 $A^*$ 可能不同，那么 $Y = Y^{A^*}$ 这一等式通常不成立。例如，对于一个真实未暴露（$A=0$）但被错误地划分为暴露（$A^*=1$）的个体，其观察结局是 $Y=Y^0$，而我们期望的对应关系 $Y^{A^*}$ 却是 $Y^1$。由于 $Y^0$ 通常不等于 $Y^1$，一致性被破坏，导致使用 $E[Y|A^*=a]$ 估计 $E[Y^a]$ 时产生偏倚 。

一致性通常与**稳定单位治疗价值假设**（Stable Unit Treatment Value Assumption, SUTVA）联系在一起。SUTVA 包含两个子假设：
1.  **一致性**：如上所述，要求暴露定义明确。
2.  **无干扰**（No Interference）：即一个个体的潜在结局不受其他个体所接受的暴露水平的影响。这意味着我们可以将个体的潜在结局简洁地记为 $Y_i^a$，而不必使用更复杂的 $Y_i^{a, \mathbf{a}_{-i}}$，后者表示个体 $i$ 在自身暴露为 $a$ 且所有其他人的暴露为向量 $\mathbf{a}_{-i}$ 时的潜在结局。在许多情况下，无干扰假设是合理的。但在某些情境下（如[传染病](@entry_id:182324)疫苗研究或社交网络干预），一个人的暴露可能会影响他人，此时需要放宽此假设，例如考虑“群组内无干扰”或“部分干扰”等更复杂的模型 。

#### [可交换性](@entry_id:263314)（Exchangeability）

[可交换性](@entry_id:263314)，或称“无混杂”（no confounding），是因果推断的核心。其形式化表述为 $(Y^0, Y^1) \perp A$，即潜在结局向量与实际接受的暴露是相互独立的。直观地讲，这意味着暴露组和非暴露组在接受暴露之前是“可比较的”。如果暴露组的个体当初没有接受暴露，他们的平均结局会和非暴露组的个体一样；反之亦然。

在理想的**随机对照试验**（Randomized Controlled Trial, RCT）中，随机分配过程保证了暴露分配与所有基线特征（无论测量与否）的独立性，从而实现了可交换性。正因为如此，RCT 被视为因果推断的“金标准”。在 RCT 中，由于 $(Y^0, Y^1) \perp A$ 成立，我们可以推导出：
$E[Y|A=1] - E[Y|A=0] = E[Y^1|A=1] - E[Y^0|A=0]$ （根据一致性）
$= E[Y^1] - E[Y^0]$ （根据可交换性）
$= ATE$
这表明，在理想 RCT 中，简单的关联性差异就是无偏的 ATE 估计 。

然而，在**[观察性研究](@entry_id:174507)**中，暴露通常不是随机分配的。接受治疗的个体与未接受治疗的个体可能在许多影响结局的基线特征上存在系统性差异。例如，在评估一种新药的研究中，病情更严重的患者可能更倾向于尝试新药。这种情况下，暴露组和非暴露组就不是可交换的，直接比较会产生**混杂偏倚**（confounding bias）。

为了解决这个问题，我们引入了**条件可交换性**（Conditional Exchangeability）的假设：$(Y^0, Y^1) \perp A \mid L$。该假设声称，在控制了某些基线协变量（confounders）$L$ 的特定层内，暴露分配与潜在结局是独立的。换句话说，在具有相同 $L$ 值的个体中，接受暴露者和未接受暴露者是可交换的。如果我们能识别并测量所有这些[共同原因](@entry_id:266381)（即满足条件的 $L$），我们就可以通过分层或调整等统计方法来控制混杂，从而得到无偏的因果效应估计。

#### 正值性（Positivity）

正值性，有时也称为“重叠”（overlap）或“共同支持”（common support），是实现因果效应识别的第三个关键假设。它要求对于协变量 $L$ 的每一个存在于目标人群中的水平 $l$（即 $P(L=l) > 0$），任何暴露水平 $a$ 都有大于零的被分配概率。形式化表述为：若 $P(L=l) > 0$，则 $P(A=a \mid L=l) > 0$ 对所有 $a$ 成立。

这个假设的直观意义是，在由协变量定义的每个亚组内，我们都必须能实际观察到接受各种暴露水平的个体。如果我们想通过“在 $L$ 的各层内比较暴露者和非暴露者”来调整混杂，那么在每一层中都必须同时存在暴露者和非暴露者，否则比较无从谈起。

正值性的违背会导致因果效应的**不可识别性**。考虑一个研究，其中所有患有某种严重基础病（$L=1$）的患者都接受了治疗（$A=1$），即 $P(A=0|L=1)=0$。在这种情况下，我们永远无法在 $L=1$ 的人群中观察到未接受治疗的个体。因此，数据无法告诉我们任何关于 $E[Y|A=0, L=1]$ 的信息，这个量是计算 $E[Y^0]$ 所必需的。我们可以任意假设一个值 $\alpha \in [0,1]$ 作为 $P(Y=1|A=0, L=1)$，这不会与观测数据产生任何矛盾，但每一种假设都会导出一个不同的 ATE。由于 ATE 的值依赖于一个无法由数据确定的未知量，所以它是不可识别的。此时，任何关于因果效应的结论都必须依赖于无法验证的**模型外推**（extrapolation）假设，例如，假设 $L=1$ 亚组中未治疗者的结局风险与 $L=0$ 亚组中未治疗者相同 。

### 图形化方法：有向无环图 (DAGs)

潜在结局框架为因果效应提供了严谨的定义，但它在表达变量间的复杂依赖关系时可能显得不够直观。**[有向无环图](@entry_id:164045)**（Directed Acyclic Graphs, DAGs）提供了一种强大的可视化语言，用于明确陈述我们关于数据生成过程的因果假设，并基于这些假设来推断变量间的[统计独立性](@entry_id:150300)关系。

在 DAG 中，节点代表随机变量，有向箭头（$\to$）代表直接的因果效应。例如，$A \to Y$ 表示 $A$ 是 $Y$ 的一个直接原因。DAG 的一个关键特征是“无环”，即从任何一个节点出发，都无法沿着箭头的方向回到该节点，这反映了因果关系的时间顺序。

DAG 的核心价值在于它通过一个名为 **[d-分离](@entry_id:748152)**（d-separation）的图形法则，将因果假设与可检验的统计条件独立性联系起来。如果图中节点集 $X$ 和 $Y$ 被节点集 $Z$ [d-分离](@entry_id:748152)，那么在与该图兼容的所有概率分布中，随机变量 $X$ 和 $Y$ 在给定 $Z$ 的条件下是条件独立的（$X \perp Y \mid Z$）。

理解 [d-分离](@entry_id:748152)的关键是分析连接两个节点的所有**路径**（paths）。一条路径是指连接两个节点的一系列连续的边，无论箭头的方向如何。路径的状态（开放或阻塞）决定了关联是否能在其上传递。路径的状态取决于路径上的节点类型以及我们是否对它们进行了**条件化**（即统计调整）。

1.  **链（Chain）**: $X \to M \to Y$。关联沿路径传递。条件化中间节点 $M$ 会阻塞路径。
2.  **分叉（Fork）**: $X \leftarrow C \to Y$。$C$ 是 $X$ 和 $Y$ 的[共同原因](@entry_id:266381)。关联沿路径传递。条件化[共同原因](@entry_id:266381) $C$ 会阻塞路径。
3.  **对撞（Collider）**: $X \to S \leftarrow Y$。$S$ 是 $X$ 和 $Y$ 的共同效应，称为**对撞节点**。默认情况下，此路径是**阻塞的**，关联无法通过 $S$。然而，当我们**条件化对撞节点 $S$ 或其任何后[代时](@entry_id:173412)，该路径会变得开放**。

利用这些规则，DAGs 帮助我们清晰地识别和区分不同类型的偏倚。

#### 混杂 (Confounding)

在 DAG 框架下，混杂由连接暴露 $A$ 和结局 $Y$ 的**后门路径**（backdoor path）引起。后门路径是一条始于指向 $A$ 的箭头的路径（例如 $A \leftarrow L \to Y$）。这种路径代表了 $A$ 和 $Y$ 之间的[非因果性](@entry_id:194897)关联，因为它是由一个[共同原因](@entry_id:266381) $L$ 驱动的。为了估计 $A$ 对 $Y$ 的总因果效应，我们必须阻塞所有开放的后门路径。通过对后门路径上的非对撞节点（如 $L$）进行条件化，我们可以阻塞这些路径，从而消除混杂偏倚。这在图形上对应了在潜在结局框架中通过对协变量 $L$ 进行调整以实现条件可交换性的做法  。

#### 选择偏倚 (Selection Bias)

选择偏倚，尤其是**对撞分层偏倚**（collider-stratification bias），是一种更微妙的偏倚。它在我们对一个对撞节点进行条件化时产生。假设研究的纳入标准（$S=1$）同时受到暴露 $A$ 和结局 $Y$ 的影响，这就形成了对撞结构 $A \to S \leftarrow Y$。在整个人群中，即使 $A$ 和 $Y$ 之间没有因果关系也没有[共同原因](@entry_id:266381)，路径 $A \to S \leftarrow Y$ 也是阻塞的，因此 $A$ 和 $Y$ 不会关联。然而，如果我们的分析仅限于研究参与者（即条件化于 $S=1$），这条路径就会被打开，从而在 $A$ 和 $Y$ 之间人为地引入一种虚假的关联。

例如，假设在人群中，某种基因（$A$）和某种疾病（$Y$）是相互独立的。但是，同时拥有该基因和该疾病的个体会产生特殊的症状，导致他们更可能去就医并被纳入研究（$S=1$）。在研究样本中，我们会发现基因和疾病之间存在负相关，因为在已知一个人就医的情况下，如果他没有这种基因，那么他更有可能因为患有该疾病而来就医，反之亦然。这个数值例子可以被精确地计算出来，证明即使在源人群中 $A \perp Y$，在 $S=1$ 的亚群中也会出现 $A \not\perp Y$ 。因此，对共同效应进行条件化（或选择）会引入偏倚，而非消除偏倚 。

#### 过度调整偏倚 (Overadjustment Bias)

当估计暴露对结局的**总**因果效应时，我们不应该调整位于 $A$ 和 $Y$ 之间因果通路上的变量。这样的变量被称为**中介变量**（mediator），例如 $A \to T \to Y$ 中的 $T$。对中介变量 $T$ 进行条件化会阻塞 $A$ 通过 $T$ 影响 $Y$ 的那部分因果路径，导致我们估计的只是 $A$ 的直接效应，而非总效应，从而产生偏倚 。

### 高级主题与细微差别

掌握了因果推断的基础原理后，我们可以将其应用于更复杂但现实的场景。

#### 效应修饰 (Effect Measure Modification)

**效应修饰**（EMM）指的是暴露 $A$ 对结局 $Y$ 的因果效应的大小或方向，在第三个变量 $L$ 的不同水平上有所不同。此时，我们称 $L$ 是一个效应修饰物。效应修饰反映了生物学或社会学上的真实互动，是因果关系本身的一种特征，而非像混杂那样的偏倚。

一个关键的细微之处在于，效应修饰是**尺度依赖的**（scale-dependent）。同一个因果关系可能在某个效应度量尺度上表现出效应修饰，而在另一个尺度上则表现为效应均一。常见的效应度量包括加性尺度（如风险差，Risk Difference, RD）和乘性尺度（如风险比，Risk Ratio, RR）。

例如，考虑一项研究，其真实的、无混杂的层别因果效应如下 ：
- 在慢性病患者中（$L=1$）：治疗使风险从 $0.40$ 降至 $0.20$。
- 在健康人群中（$L=0$）：治疗使风险从 $0.10$ 降至 $0.05$。

在**加性尺度**上，效应大小分别为：
- $L=1$: $RD_1 = 0.20 - 0.40 = -0.20$
- $L=0$: $RD_0 = 0.05 - 0.10 = -0.05$
由于 $RD_1 \neq RD_0$，存在加性尺度上的效应修饰。

在**[乘性](@entry_id:187940)尺度**上，效应大小分别为：
- $L=1$: $RR_1 = 0.20 / 0.40 = 0.5$
- $L=0$: $RR_0 = 0.05 / 0.10 = 0.5$
由于 $RR_1 = RR_0$，在乘性尺度上不存在效应修饰。

这个例子清楚地表明，报告因果效应时必须指明所用的度量尺度，并且“是否存在效应修饰”这个问题的答案取决于所选的尺度。

#### 时变混杂 (Time-Varying Confounding)

在纵向研究中，当一个随时间变化的协变量 $L_t$ 既是未来暴露 $A_t$ 的一个原因（混杂因子），本身又受到过去暴露 $A_{t-1}$ 的影响时，就产生了**时变混杂**。例如，在 HIV 治疗研究中，患者的 CD4 细胞计数（$L_t$）会影响医生开具下阶段药物（$A_t$）的决策，而它本身又受到上一阶段药物（$A_{t-1}$）的影响。

这种情况对传统的统计调整方法提出了严峻挑战。如果我们为了控制 $A_t$ 的混杂而调整 $L_t$，我们会无意中阻塞 $A_{t-1}$ 通过 $L_t$ 影响结局的因果路径（$A_{t-1} \to L_t \to Y$），这属于过度调整偏倚。但如果我们不调整 $L_t$，又无法控制 $A_t$ 的混杂。这种两难困境使得标准回归模型（即使模型形式完全正确）在这种情况下会产生偏倚。解决时变混杂需要更高级的方法，如**g-公式**（g-formula）、**边际结构模型**（Marginal Structural Models, MSMs）的[逆概率](@entry_id:196307)加权（IPW）等，这些方法能够正确地模拟干预过程，从而估计出无偏的因果效应 。

#### 中介分析 (Mediation Analysis)

除了估计暴露的总效应外，我们常常还想了解该效应是通过哪些途径实现的。**中介分析**旨在将总因果效应（Total Causal Effect, TCE）分解为作用于**直接路径**和**间接路径**（通过中介变量 $M$）的部分。

为此，我们需要引入嵌套的潜在结局。$Y^{a, M^{a'}}$ 表示一个反事实的结局：如果我们将暴露设为 $a$，同时将中介变量设为它在暴露为 $a'$ 时本应达到的自然水平。基于此，我们可以定义：

- **自然直接效应**（Natural Direct Effect, NDE）：$NDE = E[Y^{a, M^{a'}}] - E[Y^{a', M^{a'}}]$。它衡量的是，在将中介变量固定在“参照暴露水平（$a'$）”下的自然值时，仅改变暴露从 $a'$ 到 $a$ 所带来的结局变化。

- **自然间接效应**（Natural Indirect Effect, NIE）：$NIE = E[Y^{a, M^{a}}] - E[Y^{a, M^{a'}}]$。它衡量的是，在将暴露的直接影响固定在“目标暴露水平（$a$）”时，仅让中介变量从“参照暴露（$a'$）”下的自然值变为“目标暴露（$a$）”下的自然值所带来的结局变化。

需要注意的是，NDE 和 NIE 的识别需要非常强的假设。除了常规的无混杂假设外，还需要一个关键的**跨世界独立性假设**（cross-world independence assumption），例如 $Y^{a,m} \perp M^{a'} \mid L$。这个假设涉及两个不同反事实世界下的变量（一个世界中 $A$ 被设为 $a$，另一个世界中 $A$ 被设为 $a'$）之间的独立性，这是无法通过数据直接检验的 。因此，中介分析的结果必须在理解其背后强大且不可验的假设前提下进行谨慎解释。