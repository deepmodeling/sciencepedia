{
    "hands_on_practices": [
        {
            "introduction": "横断面研究的一个主要优势是能够有效估计人群中的疾病患病率。然而，任何点估计都存在抽样误差，因此，报告结果时必须量化其不确定性。本练习将指导你为一个患病率估算值构建置信区间，并学习如何应用有限总体校正（finite population correction, FPC）来提高估计的精确度，这是严谨报告横断面调查结果的一项核心技能 。",
            "id": "4639611",
            "problem": "某市卫生部门进行了一项横断面调查，以估计在某一特定日历时间成年人中某种二元慢性病的点患病率。成年人口总数为 $N = 120{,}000$。在调查当天，该部门从一份完整名册中采用无放回简单随机抽样（SRS）的方式抽取了 $n = 2{,}400$ 名成年人。对每位抽中的成年人进行该病症的评估，发现有 $x = 312$ 人患有该病。将抽样视为无放回简单随机抽样，并假设测量是完美的（无错分），且无无应答情况。\n\n仅从患病率作为人口比例的定义、抽样机制为从有限总体中进行无放回简单随机抽样这一事实，以及独立或可交换二元变量均值的大样本正态近似出发，推导包含有限总体校正的样本患病率的近似标准误表达式。然后用此表达式构建人口患病率的近似双侧 $95\\%$ 置信区间（CI），并计算该置信区间的总宽度（上限减去下限）。\n\n仅报告置信区间的总宽度，以小数形式（而非百分比）表示。将你的答案四舍五入至四位有效数字。",
            "solution": "本题经过验证。\n\n### 步骤1：提取已知条件\n- 成年人口总数：$N = 120{,}000$\n- 简单随机抽样（SRS）样本量：$n = 2{,}400$\n- 抽样为无放回。\n- 样本中患有该病的成年人数：$x = 312$\n- 测量是完美的（无错分）。\n- 无无应答情况。\n- 任务是推导包含有限总体校正的样本患病率的标准误，构建人口患病率的近似双侧 $95\\%$ 置信区间（CI），并计算该置信区间的总宽度。推导必须从患病率的定义、无放回简单随机抽样机制以及大样本正态近似出发。\n- 置信区间宽度的最终答案必须是四舍五入到四位有效数字的小数。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是关于有限总体比例的统计推断的标准练习，是调查抽样和流行病学的核心主题。\n- **科学依据：** 该问题基于统计学和调查抽样理论的既定原则。患病率、简单随机抽样、置信区间和有限总体校正等概念是基础且科学合理的。\n- **问题适定：** 提供了所有必要信息（$N$、$n$、$x$ 和置信水平）。指令清晰，可导向唯一且有意义的解。\n- **客观性：** 问题以精确、客观的语言陈述，没有歧义或主观论断。\n\n该问题是自洽的、科学合理的且适定的。未发现任何缺陷。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整解答。\n\n### 解答推导与计算\n\n设 $P$ 为 $N$ 个成年人有限总体中该慢性病的真实未知患病率。这是我们感兴趣的参数。$P$ 是一个二元特征的比例，因此可以定义为指示变量的均值。令 $Y_i = 1$ 表示第 $i$ 个人患有该病，否则 $Y_i = 0$，其中 $i = 1, \\dots, N$。总体患病率为 $P = \\frac{1}{N} \\sum_{i=1}^{N} Y_i$。\n\n采用无放回方式抽取一个大小为 $n$ 的简单随机样本。令 $y_1, y_2, \\dots, y_n$ 为样本中个体的指示变量。样本患病率 $\\hat{p}$ 是 $P$ 的自然估计量。它是指示变量的样本均值：\n$$ \\hat{p} = \\frac{1}{n} \\sum_{j=1}^{n} y_j $$\n根据给定数据，在大小为 $n = 2{,}400$ 的样本中，共有 $x = 312$ 个个体患有该病。因此，样本患病率为：\n$$ \\hat{p} = \\frac{x}{n} = \\frac{312}{2{,}400} = 0.13 $$\n\n问题要求推导 $\\hat{p}$ 的标准误。根据无放回简单随机抽样理论，样本均值 $\\hat{p}$ 的方差为：\n$$ \\text{Var}(\\hat{p}) = \\left( \\frac{N-n}{N} \\right) \\frac{S^2}{n} $$\n其中 $S^2$ 是有限总体方差，定义为 $S^2 = \\frac{1}{N-1} \\sum_{i=1}^{N} (Y_i - P)^2$。项 $\\frac{N-n}{N} = 1 - \\frac{n}{N}$ 是有限总体校正（FPC）因子。对于二元变量 $Y_i$，总体方差 $S^2$ 简化为：\n$$ S^2 = \\frac{N}{N-1} P(1-P) $$\n因此 $\\hat{p}$ 的方差为 $\\text{Var}(\\hat{p}) = \\left( \\frac{N-n}{N} \\right) \\frac{1}{n} \\frac{N}{N-1} P(1-P) = \\frac{N-n}{n(N-1)} P(1-P)$。\n\n为了构建置信区间，我们需要该方差的估计值，这又需要其平方根，即标准误 $\\text{SE}(\\hat{p})$ 的估计值。我们可以使用样本数据来估计未知的方差项 $P(1-P)$。总体方差 $S^2$ 的一个一致估计量是样本方差 $s^2$：\n$$ s^2 = \\frac{1}{n-1} \\sum_{j=1}^{n} (y_j - \\hat{p})^2 $$\n对于二元数据，这简化为 $s^2 = \\frac{n}{n-1} \\hat{p}(1-\\hat{p})$。将 $s^2$ 代替 $S^2$ 入方差公式，我们得到 $\\hat{p}$ 方差的估计量：\n$$ \\widehat{\\text{Var}}(\\hat{p}) = \\left( 1 - \\frac{n}{N} \\right) \\frac{s^2}{n} = \\left( 1 - \\frac{n}{N} \\right) \\frac{1}{n} \\left( \\frac{n}{n-1} \\hat{p}(1-\\hat{p}) \\right) = \\left( 1 - \\frac{n}{N} \\right) \\frac{\\hat{p}(1-\\hat{p})}{n-1} $$\n样本患病率的近似标准误 $\\text{SE}(\\hat{p})$ 是这个估计方差的平方根：\n$$ \\text{SE}(\\hat{p}) = \\sqrt{\\widehat{\\text{Var}}(\\hat{p})} = \\sqrt{\\left( 1 - \\frac{n}{N} \\right) \\frac{\\hat{p}(1-\\hat{p})}{n-1}} $$\n该表达式按要求包含了有限总体校正。\n\n基于大样本正态近似，总体患病率 $P$ 的一个近似双侧 $95\\%$ 置信区间由下式给出：\n$$ \\hat{p} \\pm z_{1-0.05/2} \\times \\text{SE}(\\hat{p}) $$\n其中 $z_{1-0.05/2} = z_{0.975}$ 是标准正态分布的 $0.975$ 分位数。$z_{0.975}$ 的值约为 $1.96$。\n\n该置信区间的总宽度 $W$ 是上界与下界之差：\n$$ W = \\left( \\hat{p} + z_{0.975} \\text{SE}(\\hat{p}) \\right) - \\left( \\hat{p} - z_{0.975} \\text{SE}(\\hat{p}) \\right) = 2 z_{0.975} \\text{SE}(\\hat{p}) $$\n代入推导出的标准误表达式：\n$$ W = 2 z_{0.975} \\sqrt{\\left( 1 - \\frac{n}{N} \\right) \\frac{\\hat{p}(1-\\hat{p})}{n-1}} $$\n\n现在，我们代入给定的数值：\n- $N = 120{,}000$\n- $n = 2{,}400$\n- $\\hat{p} = 0.13$\n- $z_{0.975} \\approx 1.96$\n\n首先，计算FPC因子：\n$$ 1 - \\frac{n}{N} = 1 - \\frac{2{,}400}{120{,}000} = 1 - 0.02 = 0.98 $$\n接下来，计算方差分量：\n$$ \\frac{\\hat{p}(1-\\hat{p})}{n-1} = \\frac{0.13 \\times (1-0.13)}{2{,}400-1} = \\frac{0.13 \\times 0.87}{2{,}399} = \\frac{0.1131}{2{,}399} $$\n现在，计算标准误：\n$$ \\text{SE}(\\hat{p}) = \\sqrt{0.98 \\times \\frac{0.1131}{2{,}399}} = \\sqrt{0.98 \\times 0.00004714464...} = \\sqrt{0.00004620175...} \\approx 0.006797187 $$\n最后，计算置信区间的总宽度：\n$$ W = 2 \\times 1.96 \\times 0.006797187... = 3.92 \\times 0.006797187... \\approx 0.02664497... $$\n将结果四舍五入到四位有效数字，我们得到 $0.02664$。",
            "answer": "$$\n\\boxed{0.02664}\n$$"
        },
        {
            "introduction": "在解释横断面研究中的关联时，混杂偏倚是一个主要威胁。本练习通过一个经典的辛普森悖论（Simpson's paradox）案例，展示了在未校正混杂因素时，粗略的关联分析可能得出完全错误的结论。你将通过直接标准化方法，校正年龄这一混杂因素，从而揭示真实的关联强度，并掌握一项评估和控制混杂的关键流行病学技能 。",
            "id": "4639572",
            "problem": "一个公共卫生团队使用横断面调查来比较两种职业群体——接触溶剂的制造业工人（暴露组）和办公室职员（非暴露组）——之间某种慢性呼吸系统疾病的患病率。该调查将参与者分为两个年龄层：年轻组和年老组。横断面数据提供了调查时现有病例的数量，该团队旨在了解年龄结构的差异如何导致辛普森悖论，即在考虑分层后，粗关联的方向发生逆转。\n\n观察到的计数如下：\n- 暴露组，年轻：总共 $200$ 人，其中 $16$ 例病例。\n- 暴露组，年老：总共 $800$ 人，其中 $280$ 例病例。\n- 非暴露组，年轻：总共 $800$ 人，其中 $80$ 例病例。\n- 非暴露组，年老：总共 $200$ 人，其中 $80$ 例病例。\n\n仅使用核心定义：\n- 一个群体中的患病率是指该群体中现有病例的比例。\n- 某一层内的条件患病率是指该层内病例的比例。\n- 全概率定律指出，在分层权重为 $\\{w_{1}, w_{2}\\}$ 的人群中，总患病率等于 $w_{1} \\times \\text{(第1层患病率)} + w_{2} \\times \\text{(第2层患病率)}$。\n- 直接标准化法计算在两个暴露组共享一个共同的标准分层分布的情况下，每个暴露组的预期患病率。\n\n假设标准人口为每个年龄层分配相等的权重：$w_{\\text{young}} = 0.5$ 和 $w_{\\text{old}} = 0.5$。使用以上定义，计算比较暴露组与非暴露组的直接年龄标化患病率比。请将最终答案表示为十进制数，并四舍五入到三位有效数字。",
            "solution": "该问题要求计算直接年龄标化患病率比，以比较暴露组（接触溶剂的制造业工人）和非暴露组（办公室职员）之间某种慢性呼吸系统疾病的情况。分析必须考虑年龄的混杂作用，使用两个分层：年轻组和年老组。\n\n首先，我们必须验证问题陈述的有效性。\n**步骤1：提取已知条件**\n- 暴露组，年轻：总参与者 $N_{E,Y} = 200$ 人，病例数 $C_{E,Y} = 16$ 例。\n- 暴露组，年老：总参与者 $N_{E,O} = 800$ 人，病例数 $C_{E,O} = 280$ 例。\n- 非暴露组，年轻：总参与者 $N_{U,Y} = 800$ 人，病例数 $C_{U,Y} = 80$ 例。\n- 非暴露组，年老：总参与者 $N_{U,O} = 200$ 人，病例数 $C_{U,O} = 80$ 例。\n- 患病率的定义：一个群体中现有病例的比例。\n- 方法：使用对每个年龄层赋以相等权重的标准人口进行直接标准化。\n- 标准人口权重：$w_{\\text{young}} = 0.5$ 和 $w_{\\text{old}} = 0.5$。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在科学上基于标准的流行病学原理（横断面研究、患病率、混杂、标准化）。问题提法得当，为得出唯一解提供了所有必要的数据和定义。语言客观、精确。数据内部一致，不违反任何数学或逻辑原则。该情景，包括辛普森悖论的存在，是流行病学中一个经典且现实的教学案例。因此，该问题是有效的。\n\n**步骤3：结论与行动**\n该问题有效。我们着手解决它。\n\n解决方案需要计算暴露组和非暴露组的年龄标化患病率，然后求出它们的比值。这个过程从计算分层特异性患病率开始。\n\n设 $P(C|E, Y)$ 为年轻（$Y$）的暴露者（$E$）中该疾病（$C$）的患病率。类似地，我们为其他三个亚组定义 $P(C|E, O)$、$P(C|U, Y)$ 和 $P(C|U, O)$。\n\n分层特异性患病率计算如下：\n1.  暴露组，年轻组的患病率：\n    $$P(C|E, Y) = \\frac{C_{E,Y}}{N_{E,Y}} = \\frac{16}{200} = 0.08$$\n2.  暴露组，年老组的患病率：\n    $$P(C|E, O) = \\frac{C_{E,O}}{N_{E,O}} = \\frac{280}{800} = 0.35$$\n3.  非暴露组，年轻组的患病率：\n    $$P(C|U, Y) = \\frac{C_{U,Y}}{N_{U,Y}} = \\frac{80}{800} = 0.10$$\n4.  非暴露组，年老组的患病率：\n    $$P(C|U, O) = \\frac{C_{U,O}}{N_{U,O}} = \\frac{80}{200} = 0.40$$\n\n接下来，我们应用直接标准化法。这包括使用来自一个共同标准人口的权重，为每个暴露组的分层特异性患病率创建一个加权平均值。问题指定了一个标准人口，其年轻和年老分层的权重相等：$w_{\\text{young}} = 0.5$ 和 $w_{\\text{old}} = 0.5$。\n\n暴露组的年龄标化患病率 $P_{\\text{std, E}}$，是使用标准权重和全概率定律计算的：\n$$P_{\\text{std, E}} = w_{\\text{young}} \\times P(C|E, Y) + w_{\\text{old}} \\times P(C|E, O)$$\n$$P_{\\text{std, E}} = (0.5 \\times 0.08) + (0.5 \\times 0.35) = 0.040 + 0.175 = 0.215$$\n\n同样，非暴露组的年龄标化患病率 $P_{\\text{std, U}}$ 为：\n$$P_{\\text{std, U}} = w_{\\text{young}} \\times P(C|U, Y) + w_{\\text{old}} \\times P(C|U, O)$$\n$$P_{\\text{std, U}} = (0.5 \\times 0.10) + (0.5 \\times 0.40) = 0.050 + 0.200 = 0.250$$\n\n最后，直接年龄标化患病率比（SPR）是暴露组的标化患病率与非暴露组的标化患病率之比。\n$$\\text{SPR} = \\frac{P_{\\text{std, E}}}{P_{\\text{std, U}}}$$\n$$\\text{SPR} = \\frac{0.215}{0.250} = 0.86$$\n\n问题要求答案以四舍五入到三位有效数字的十进制数表示。数值 $0.86$ 有两位有效数字。为了用三位有效数字表示，我们在后面加一个零。\n$$\\text{SPR} = 0.860$$\n\n这一结果表明，在对两组不同的年龄结构进行调整后，暴露组的疾病患病率低于非暴露组，这与未经调整的粗略比较（会暗示存在有害关联）相反。这种逆转是辛普森悖论的一个标志性特征。",
            "answer": "$$\n\\boxed{0.860}\n$$"
        },
        {
            "introduction": "除了混杂，选择偏倚是影响横断面研究有效性的另一个关键限制，而缺失数据是导致选择偏倚的常见原因。此编程练习将探讨不同的数据缺失机制——完全随机缺失（Missing Completely At Random, MCAR）、随机缺失（Missing At Random, MAR）和非随机缺失（Missing Not At Random, MNAR）——如何系统性地影响患病率估计的准确性。通过这个实践，你将认识到，理解数据为何会缺失，对于评估研究结果的有效性至关重要 。",
            "id": "4639581",
            "problem": "一项横断面研究在目标人群中的单个时间点测量一个二元暴露 $X \\in \\{0,1\\}$ 和一个二元结局 $Y \\in \\{0,1\\}$。科学目标是估计结局 Y 的真实时点流行率，记为 $P(Y=1)$。设 $P(X=1) = p_X$，$P(Y=1 \\mid X=1) = p_1$，以及 $P(Y=1 \\mid X=0) = p_0$。根据全概率定律，真实流行率为 $P(Y=1) = p_X \\, p_1 + (1 - p_X)\\, p_0$。然而，由于无应答，结局 $Y$ 仅在部分个体中被观察到。设 $R \\in \\{0,1\\}$ 是一个指示变量，表示 $Y$ 是否被观察到（$R=1$）或缺失（$R=0$）。观察机制由条件概率 $P(R=1 \\mid X=x, Y=y) = r_{xy}$（其中 $x \\in \\{0,1\\}, y \\in \\{0,1\\}$）来刻画。你必须从第一性原理（仅使用总概率定律和条件概率等基本定义）出发，推导在指定的观察机制下两种估计量的期望值：\n\n- 完整病例估计量，它只使用 $R=1$ 的个体，并计算期望的观察结局比例 $P(Y=1 \\mid R=1)$。\n\n- 朴素暴露内单次插补估计量，它在每个暴露分层 $X=x$ 内，使用观察到的条件均值 $P(Y=1 \\mid R=1, X=x)$ 来插补缺失的 $Y$ 值，然后通过 $P(X=x)$ 对分层内的插补均值进行加权平均。\n\n对于每个指定的测试用例，你的程序必须：\n- 使用 $p_X$、$p_1$ 和 $p_0$ 计算真实流行率 $p = P(Y=1)$。\n- 在指定的 $r_{xy}$ 下，计算完整病例估计的期望值 $p_{\\mathrm{cc}} = P(Y=1 \\mid R=1)$。\n- 计算朴素暴露内单次插补估计的期望值 $p_{\\mathrm{imp}}$，其等于 $\\sum_{x \\in \\{0,1\\}} P(X=x) \\, P(Y=1 \\mid R=1, X=x)$，其中 $P(Y=1 \\mid R=1, X=x)$ 由观察机制和 $(X,Y)$ 的联合分布决定。\n- 计算偏差 $b_{\\mathrm{cc}} = p_{\\mathrm{cc}} - p$ 和 $b_{\\mathrm{imp}} = p_{\\mathrm{imp}} - p$。\n所有答案必须表示为小数（而非百分比）。\n\n在所有测试用例中使用以下公共参数：\n- $p_X = 0.4$\n- $p_1 = 0.3$\n- $p_0 = 0.1$\n\n使用以下观察机制测试套件（每行按顺序提供 $(r_{00}, r_{01}, r_{10}, r_{11})$）：\n- 测试用例 1（完全随机缺失 (MCAR)）：$(0.7, 0.7, 0.7, 0.7)$\n- 测试用例 2（随机缺失 (MAR)，仅依赖于 $X$）：$(0.5, 0.5, 0.9, 0.9)$\n- 测试用例 3（非随机缺失 (MNAR)，仅依赖于 $Y$；若 $Y=1$ 则应答率较低）：$(0.95, 0.6, 0.95, 0.6)$\n- 测试用例 4（无缺失边界情况）：$(1.0, 1.0, 1.0, 1.0)$\n- 测试用例 5（极端非随机缺失 (MNAR)；若 $Y=1$ 则应答率极低）：$(0.9, 0.1, 0.9, 0.1)$\n\n你的程序应为每个测试用例输出一个包含五个浮点数的有序列表 $[p, p_{\\mathrm{cc}}, b_{\\mathrm{cc}}, p_{\\mathrm{imp}}, b_{\\mathrm{imp}}]$，每个浮点数四舍五入到六位小数。将所有测试用例的结果按上述顺序汇总到一个列表中。\n\n最终输出格式：你的程序应生成单行文本，其中包含一个逗号分隔的列表，该列表由五个结果列表组成，并用方括号括起来。例如：$[[a_1,a_2,a_3,a_4,a_5],[\\dots],\\dots]$，其中每个 $a_i$ 都是一个四舍五入到六位小数的浮点数。不应打印任何额外文本。\n\n关于科学现实性和研究设计的说明：横断面研究估计单个时间点的 $P(Y=1)$，无法建立 $X$ 和 $Y$ 之间的时间顺序。它们在流行率估计方面的优势会因数据缺失而受到削弱。在 $R \\perp Y \\mid X$（即给定 $X$ 时为随机缺失）的情况下，使用观察到的条件均值进行朴素暴露内单次插补可以恢复无偏的流行率，而如果 $R$ 依赖于 $X$ 且 $X$ 与 $Y$ 相关，则完整病例估计量可能存在偏差。在 $R$ 依赖于 $Y$（非随机缺失）的情况下，两种方法都可能存在偏差，这说明了在存在不可忽略的缺失数据时，横断面设计的一个关键局限性。",
            "solution": "该问题要求推导并计算一个结局的真实流行率，以及在各种缺失数据机制下，该流行率的两种估计量的期望值。推导过程必须从第一性原理出发。\n\n设二元暴露为 $X \\in \\{0, 1\\}$，二元结局为 $Y \\in \\{0, 1\\}$。$Y$ 的观察情况由 $R \\in \\{0, 1\\}$ 指示，其中 $R=1$ 表示 $Y$ 被观察到。\n给定的参数为：\n- $P(X=1) = p_X$\n- $P(Y=1 \\mid X=1) = p_1$\n- $P(Y=1 \\mid X=0) = p_0$\n- $P(R=1 \\mid X=x, Y=y) = r_{xy}$\n\n由此，我们可以定义互补概率：\n- $P(X=0) = 1 - p_X$\n- $P(Y=0 \\mid X=1) = 1 - p_1$\n- $P(Y=0 \\mid X=0) = 1 - p_0$\n\n首先，我们使用条件概率的定义 $P(A, B) = P(A \\mid B)P(B)$ 来推导必要的联合概率 $P(X=x, Y=y)$：\n$$P(X=1, Y=1) = P(Y=1 \\mid X=1)P(X=1) = p_1 p_X$$\n$$P(X=1, Y=0) = P(Y=0 \\mid X=1)P(X=1) = (1 - p_1) p_X$$\n$$P(X=0, Y=1) = P(Y=1 \\mid X=0)P(X=0) = p_0 (1 - p_X)$$\n$$P(X=0, Y=0) = P(Y=0 \\mid X=0)P(X=0) = (1 - p_0) (1 - p_X)$$\n\n**1. 真实流行率 ($p$)**\n结局的真实流行率 $p = P(Y=1)$，使用全概率定律，通过对暴露 $X$ 进行边缘化来推导：\n$$p = P(Y=1) = \\sum_{x \\in \\{0,1\\}} P(Y=1 \\mid X=x)P(X=x)$$\n$$p = P(Y=1 \\mid X=1)P(X=1) + P(Y=1 \\mid X=0)P(X=0)$$\n$$p = p_1 p_X + p_0 (1 - p_X)$$\n这是用于与估计量进行比较的金标准值。\n\n**2. 完整病例估计量 ($p_{\\mathrm{cc}}$)**\n完整病例估计量的期望值是观察到的个体中的结局比例，即条件概率 $p_{\\mathrm{cc}} = P(Y=1 \\mid R=1)$。根据条件概率的定义：\n$$p_{\\mathrm{cc}} = P(Y=1 \\mid R=1) = \\frac{P(Y=1, R=1)}{P(R=1)}$$\n我们必须推导分子和分母的表达式。\n分子 $P(Y=1, R=1)$ 是同时具有该结局并被观察到的联合概率。我们通过对 $X$ 进行边缘化来求得：\n$$P(Y=1, R=1) = \\sum_{x \\in \\{0,1\\}} P(X=x, Y=1, R=1)$$\n使用链式法则 $P(A,B,C) = P(C \\mid A,B) P(A,B)$:\n$$P(Y=1, R=1) = P(R=1 \\mid X=1, Y=1)P(X=1, Y=1) + P(R=1 \\mid X=0, Y=1)P(X=0, Y=1)$$\n$$P(Y=1, R=1) = r_{11} (p_1 p_X) + r_{01} (p_0 (1 - p_X))$$\n分母 $P(R=1)$ 是被观察到的总概率。我们通过对 $X$ 和 $Y$ 同时进行边缘化来求得：\n$$P(R=1) = \\sum_{x \\in \\{0,1\\}} \\sum_{y \\in \\{0,1\\}} P(X=x, Y=y, R=1)$$\n$$P(R=1) = P(R=1 \\mid X=1, Y=1)P(X=1, Y=1) + P(R=1 \\mid X=1, Y=0)P(X=1, Y=0) + P(R=1 \\mid X=0, Y=1)P(X=0, Y=1) + P(R=1 \\mid X=0, Y=0)P(X=0, Y=0)$$\n$$P(R=1) = r_{11} p_1 p_X + r_{10} (1 - p_1) p_X + r_{01} p_0 (1 - p_X) + r_{00} (1 - p_0) (1 - p_X)$$\n将这些结合起来，完整病例估计量为：\n$$p_{\\mathrm{cc}} = \\frac{r_{11} p_1 p_X + r_{01} p_0 (1 - p_X)}{r_{11} p_1 p_X + r_{10} (1 - p_1) p_X + r_{01} p_0 (1 - p_X) + r_{00} (1 - p_0) (1 - p_X)}$$\n\n**3. 朴素暴露内单次插补估计量 ($p_{\\mathrm{imp}}$)**\n该估计量的期望值定义为 $p_{\\mathrm{imp}} = \\sum_{x \\in \\{0,1\\}} P(X=x) \\, P(Y=1 \\mid R=1, X=x)$。这需要计算在每个暴露分层内，仅限于观察对象的结局流行率。\n对于分层 $X=1$：\n$$P(Y=1 \\mid R=1, X=1) = \\frac{P(Y=1, R=1, X=1)}{P(R=1, X=1)}$$\n分子是 $P(R=1 \\mid Y=1, X=1)P(Y=1 \\mid X=1)P(X=1) = r_{11} p_1 p_X$。我们需要 $P(R=1, X=1)$，通过对 $Y$ 进行边缘化求得：\n$$P(R=1, X=1) = P(R=1 \\mid Y=1, X=1)P(Y=1,X=1) + P(R=1 \\mid Y=0, X=1)P(Y=0,X=1)$$\n$$P(R=1, X=1) = r_{11} p_1 p_X + r_{10} (1-p_1) p_X = p_X (r_{11} p_1 + r_{10} (1-p_1))$$\n因此，所求的条件概率为：\n$$P(Y=1 \\mid R=1, X=1) = \\frac{r_{11} p_1 p_X}{p_X (r_{11} p_1 + r_{10} (1-p_1))} = \\frac{r_{11} p_1}{r_{11} p_1 + r_{10}(1-p_1)}$$\n类似地，对于分层 $X=0$：\n$$P(Y=1 \\mid R=1, X=0) = \\frac{P(Y=1, R=1, X=0)}{P(R=1, X=0)}$$\n$$P(Y=1 \\mid R=1, X=0) = \\frac{r_{01} p_0 (1-p_X)}{(1-p_X)(r_{01} p_0 + r_{00}(1-p_0))} = \\frac{r_{01} p_0}{r_{01} p_0 + r_{00}(1-p_0)}$$\n将这些代入 $p_{\\mathrm{imp}}$ 的公式：\n$$p_{\\mathrm{imp}} = p_X \\left( \\frac{r_{11} p_1}{r_{11} p_1 + r_{10}(1-p_1)} \\right) + (1-p_X) \\left( \\frac{r_{01} p_0}{r_{01} p_0 + r_{00}(1-p_0)} \\right)$$\n这些关于 $p$、$p_{\\mathrm{cc}}$ 和 $p_{\\mathrm{imp}}$ 的表达式允许根据问题参数直接进行计算。\n\n**4. 偏差 ($b_{\\mathrm{cc}}$ 和 $b_{\\mathrm{imp}}$)**\n两种估计量的偏差定义为它们的期望值与真实流行率之间的差值：\n$$b_{\\mathrm{cc}} = p_{\\mathrm{cc}} - p$$\n$$b_{\\mathrm{imp}} = p_{\\mathrm{imp}} - p$$\n这些公式将被用于计算每个测试用例所需的值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the epidemiology missing data problem for all specified test cases.\n    \"\"\"\n    # Common parameters across all test cases\n    pX = 0.4  # P(X=1)\n    p1 = 0.3  # P(Y=1 | X=1)\n    p0 = 0.1  # P(Y=1 | X=0)\n\n    # Observation mechanism test suite: (r00, r01, r10, r11)\n    test_cases = [\n        (0.7, 0.7, 0.7, 0.7),  # 1. MCAR\n        (0.5, 0.5, 0.9, 0.9),  # 2. MAR on X\n        (0.95, 0.6, 0.95, 0.6), # 3. MNAR on Y\n        (1.0, 1.0, 1.0, 1.0),  # 4. No missingness\n        (0.9, 0.1, 0.9, 0.1),   # 5. Extreme MNAR on Y\n    ]\n\n    # --- Pre-calculate constant probabilities ---\n    pX0 = 1 - pX # P(X=0)\n    \n    # Joint probabilities P(X=x, Y=y)\n    p_x1_y1 = p1 * pX\n    p_x1_y0 = (1 - p1) * pX\n    p_x0_y1 = p0 * pX0\n    p_x0_y0 = (1 - p0) * pX0\n    \n    # 1. True Prevalence (p)\n    p_true = p_x1_y1 + p_x0_y1\n    # Alternative calculation: p_true = p1 * pX + p0 * pX0\n\n    all_results = []\n\n    for case in test_cases:\n        r00, r01, r10, r11 = case\n\n        # 2. Complete-Case Estimator (p_cc)\n        # Numerator: P(Y=1, R=1) = r11*P(X=1,Y=1) + r01*P(X=0,Y=1)\n        p_y1_r1 = r11 * p_x1_y1 + r01 * p_x0_y1\n        \n        # Denominator: P(R=1) = sum_{x,y} r_xy * P(X=x,Y=y)\n        p_r1 = (r11 * p_x1_y1 + \n                r10 * p_x1_y0 + \n                r01 * p_x0_y1 + \n                r00 * p_x0_y0)\n\n        if p_r1 == 0:\n            p_cc = np.nan  # Or other appropriate value for this undefined case\n        else:\n            p_cc = p_y1_r1 / p_r1\n\n        # 3. Naive Within-Exposure Single Imputation Estimator (p_imp)\n        # Stratum X=1: P(Y=1 | R=1, X=1)\n        denom_imp_x1 = r11 * p1 + r10 * (1 - p1)\n        if denom_imp_x1 == 0:\n            p_y1_cond_r1_x1 = 0 # No observed subjects in this stratum to impute from\n        else:\n            p_y1_cond_r1_x1 = (r11 * p1) / denom_imp_x1\n        \n        # Stratum X=0: P(Y=1 | R=1, X=0)\n        denom_imp_x0 = r01 * p0 + r00 * (1 - p0)\n        if denom_imp_x0 == 0:\n            p_y1_cond_r1_x0 = 0 # No observed subjects in this stratum to impute from\n        else:\n            p_y1_cond_r1_x0 = (r01 * p0) / denom_imp_x0\n            \n        p_imp = pX * p_y1_cond_r1_x1 + pX0 * p_y1_cond_r1_x0\n\n        # 4. Biases\n        b_cc = p_cc - p_true\n        b_imp = p_imp - p_true\n        \n        # Store results for this case\n        result_list = [p_true, p_cc, b_cc, p_imp, b_imp]\n        \n        # Format the list of floats into strings with 6 decimal places\n        formatted_list = [f\"{v:.6f}\" for v in result_list]\n        \n        all_results.append(result_list)\n\n    # Final print statement in the exact required format\n    print(f\"[[{','.join(map(str, all_results[0]))}],[{','.join(map(str, all_results[1]))}],[{','.join(map(str, all_results[2]))}],[{','.join(map(str, all_results[3]))}],[{','.join(map(str, all_results[4]))}]]\")\n\nsolve()\n\n```"
        }
    ]
}