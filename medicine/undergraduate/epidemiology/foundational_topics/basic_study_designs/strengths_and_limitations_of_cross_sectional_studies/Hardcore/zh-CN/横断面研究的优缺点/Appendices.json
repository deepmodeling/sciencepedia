{
    "hands_on_practices": [
        {
            "introduction": "横断面研究的一个核心优势是能够有效估计特定时间点上人群中某种疾病或状况的患病率。然而，任何基于样本的估计都伴随着不确定性。本练习将指导你完成一个基本但至关重要的任务：从一个横断面调查的样本数据出发，计算样本患病率，并为其构建一个95%置信区间，从而量化我们对总体患病率真实值的估计精度()。",
            "id": "4639611",
            "problem": "一个城市的卫生部门进行了一项横断面调查，以估计在单个日历时间点成年人中某种二元慢性病的点患病率。成年人口总数为 $N = 120{,}000$。在调查当天，该部门从一份完整的人员名册中，采用不放回简单随机抽样（SRS）的方式，抽取了 $n = 2{,}400$ 名成年人。每位被抽中的成年人都接受了该病症的评估，其中有 $x = 312$ 人被发现患有此病。将抽样视为不放回简单随机抽样，并假设测量是完美的（无错分），且不存在无应答情况。\n\n仅从患病率作为总体比例的定义、抽样机制为从有限总体中进行不放回简单随机抽样这一事实，以及独立或可交换二元变量均值的大样本正态近似出发，推导出一个包含有限总体校正的样本患病率近似标准误的表达式。然后，用此表达式构建总体患病率的近似双侧 $95\\%$ 置信区间（CI），并计算该置信区间的总宽度（上限减去下限）。\n\n仅以小数形式（而非百分比）报告置信区间的总宽度。将你的答案四舍五入到四位有效数字。",
            "solution": "此问题已经过验证。\n\n### 步骤1：提取已知条件\n- 成年人口总数：$N = 120{,}000$\n- 简单随机样本（SRS）大小：$n = 2{,}400$\n- 抽样为不放回抽样。\n- 样本中患有该病的成年人数量：$x = 312$\n- 测量是完美的（无错分）。\n- 不存在无应答情况。\n- 任务是推导包含有限总体校正的样本患病率的标准误，构建总体患病率的近似双侧 $95\\%$ 置信区间（CI），并计算该置信区间的总宽度。推导必须从患病率的定义、不放回简单随机抽样机制和大样本正态近似出发。\n- 置信区间宽度的最终答案必须是四舍五入到四位有效数字的小数。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是关于有限总体比例统计推断的一个标准练习，这是调查抽样和流行病学中的一个核心主题。\n- **科学依据：** 该问题基于已确立的统计学和调查抽样理论原则。患病率、简单随机抽样、置信区间和有限总体校正等概念都是基础且科学合理的。\n- **问题定义明确：** 提供了所有必要信息（$N$, $n$, $x$ 和置信水平）。指令清晰，能够导出一个唯一的、有意义的解。\n- **客观性：** 问题以精确、客观的语言陈述，没有歧义或主观论断。\n\n该问题是自洽的、科学合理的且定义明确。未发现任何缺陷。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整解答。\n\n### 解答推导与计算\n\n设 $P$ 为 $N$ 名成年人有限总体中该慢性病的真实未知患病率。这是我们感兴趣的参数。$P$ 是一个二元特征的比例，因此可以定义为指示变量的均值。设如果第 $i$ 个人患有该病，则 $Y_i = 1$，否则 $Y_i = 0$，其中 $i = 1, \\dots, N$。总体患病率为 $P = \\frac{1}{N} \\sum_{i=1}^{N} Y_i$。\n\n从总体中不放回地抽取一个大小为 $n$ 的简单随机样本。设 $y_1, y_2, \\dots, y_n$ 为样本中个体的指示变量。样本患病率 $\\hat{p}$ 是 $P$ 的自然估计量。它是指示变量的样本均值：\n$$ \\hat{p} = \\frac{1}{n} \\sum_{j=1}^{n} y_j $$\n根据给定数据，在大小为 $n = 2{,}400$ 的样本中，共有 $x = 312$ 人患有此病。因此，样本患病率为：\n$$ \\hat{p} = \\frac{x}{n} = \\frac{312}{2{,}400} = 0.13 $$\n\n问题要求推导 $\\hat{p}$ 的标准误。根据不放回简单随机抽样理论，样本均值 $\\hat{p}$ 的方差由下式给出：\n$$ \\text{Var}(\\hat{p}) = \\left( \\frac{N-n}{N} \\right) \\frac{S^2}{n} $$\n其中 $S^2$ 是有限总体方差，定义为 $S^2 = \\frac{1}{N-1} \\sum_{i=1}^{N} (Y_i - P)^2$。项 $\\frac{N-n}{N} = 1 - \\frac{n}{N}$ 是有限总体校正（FPC）因子。对于二元变量 $Y_i$，总体方差 $S^2$ 可简化为：\n$$ S^2 = \\frac{N}{N-1} P(1-P) $$\n因此，$\\hat{p}$ 的方差为 $\\text{Var}(\\hat{p}) = \\left( \\frac{N-n}{N} \\right) \\frac{1}{n} \\frac{N}{N-1} P(1-P) = \\frac{N-n}{n(N-1)} P(1-P)$。\n\n为了构建置信区间，我们需要该方差的估计值，而这又需要其平方根，即标准误 $\\text{SE}(\\hat{p})$ 的估计值。我们可以使用样本数据来估计未知的方差项 $P(1-P)$。总体方差 $S^2$ 的一个相合估计量是样本方差 $s^2$：\n$$ s^2 = \\frac{1}{n-1} \\sum_{j=1}^{n} (y_j - \\hat{p})^2 $$\n对于二元数据，这简化为 $s^2 = \\frac{n}{n-1} \\hat{p}(1-\\hat{p})$。将 $s^2$ 代替 $S^2$ 入方差公式，我们得到 $\\hat{p}$ 方差的估计量：\n$$ \\widehat{\\text{Var}}(\\hat{p}) = \\left( 1 - \\frac{n}{N} \\right) \\frac{s^2}{n} = \\left( 1 - \\frac{n}{N} \\right) \\frac{1}{n} \\left( \\frac{n}{n-1} \\hat{p}(1-\\hat{p}) \\right) = \\left( 1 - \\frac{n}{N} \\right) \\frac{\\hat{p}(1-\\hat{p})}{n-1} $$\n样本患病率的近似标准误 $\\text{SE}(\\hat{p})$ 是这个估计方差的平方根：\n$$ \\text{SE}(\\hat{p}) = \\sqrt{\\widehat{\\text{Var}}(\\hat{p})} = \\sqrt{\\left( 1 - \\frac{n}{N} \\right) \\frac{\\hat{p}(1-\\hat{p})}{n-1}} $$\n该表达式按要求包含了有限总体校正。\n\n基于大样本正态近似，总体患病率 $P$ 的一个近似双侧 $95\\%$ 置信区间由下式给出：\n$$ \\hat{p} \\pm z_{1-0.05/2} \\times \\text{SE}(\\hat{p}) $$\n其中 $z_{1-0.05/2} = z_{0.975}$ 是标准正态分布的 $0.975$ 分位数。$z_{0.975}$ 的值约等于 $1.96$。\n\n该置信区间的总宽度 $W$ 是上界与下界之差：\n$$ W = \\left( \\hat{p} + z_{0.975} \\text{SE}(\\hat{p}) \\right) - \\left( \\hat{p} - z_{0.975} \\text{SE}(\\hat{p}) \\right) = 2 z_{0.975} \\text{SE}(\\hat{p}) $$\n代入推导出的标准误表达式：\n$$ W = 2 z_{0.975} \\sqrt{\\left( 1 - \\frac{n}{N} \\right) \\frac{\\hat{p}(1-\\hat{p})}{n-1}} $$\n\n现在，我们代入给定的数值：\n- $N = 120{,}000$\n- $n = 2{,}400$\n- $\\hat{p} = 0.13$\n- $z_{0.975} \\approx 1.96$\n\n首先，计算 FPC 因子：\n$$ 1 - \\frac{n}{N} = 1 - \\frac{2{,}400}{120{,}000} = 1 - 0.02 = 0.98 $$\n接下来，计算方差分量：\n$$ \\frac{\\hat{p}(1-\\hat{p})}{n-1} = \\frac{0.13 \\times (1-0.13)}{2{,}400-1} = \\frac{0.13 \\times 0.87}{2{,}399} = \\frac{0.1131}{2{,}399} $$\n现在，计算标准误：\n$$ \\text{SE}(\\hat{p}) = \\sqrt{0.98 \\times \\frac{0.1131}{2{,}399}} = \\sqrt{0.98 \\times 0.00004714464...} = \\sqrt{0.00004620175...} \\approx 0.006797187 $$\n最后，计算置信区间的总宽度：\n$$ W = 2 \\times 1.96 \\times 0.006797187... = 3.92 \\times 0.006797187... \\approx 0.02664497... $$\n将结果四舍五入到四位有效数字，我们得到 $0.02664$。",
            "answer": "$$\n\\boxed{0.02664}\n$$"
        },
        {
            "introduction": "虽然横断面研究可以比较不同组间的患病率，但其主要局限之一是容易受到混杂因素的干扰，从而得出误导性结论。本练习通过一个经典的辛普森悖论场景，展示了年龄结构作为混杂因素如何能够完全扭转暴露与疾病之间的表面关联。你将通过计算分层特异的患病率和进行直接标准化，亲身体验如何识别和校正混杂，揭示出真实的关联方向()。",
            "id": "4639572",
            "problem": "一个公共卫生团队使用横断面调查来比较两种职业群体——接触溶剂的制造业工人（暴露组）和办公室职员（非暴露组）——之间一种慢性呼吸系统疾病的患病率。该调查将参与者分为两个年龄层：年轻组和年老组。横断面数据提供了调查时的现患病例数，该团队旨在了解年龄结构的差异如何导致辛普森悖论，即在考虑分层后，粗关联的方向发生逆转。\n\n观测到的计数如下：\n- 暴露组，年轻：总数 $200$ 人，其中 $16$ 例。\n- 暴露组，年老：总数 $800$ 人，其中 $280$ 例。\n- 非暴露组，年轻：总数 $800$ 人，其中 $80$ 例。\n- 非暴露组，年老：总数 $200$ 人，其中 $80$ 例。\n\n仅使用核心定义：\n- 一个群体中的患病率是指该群体中现患病例的比例。\n- 一个分层内的条件患病率是指该分层内病例的比例。\n- 全概率定律指出，在一个分层权重为 $\\{w_{1}, w_{2}\\}$ 的人群中，总患病率等于 $w_{1} \\times \\text{(stratum $1$ prevalence)} + w_{2} \\times \\text{(stratum $2$ prevalence)}$。\n- 直接标准化计算的是，如果两个暴露组共享一个共同的标准分层分布，那么每个暴露组的期望患病率。\n\n设标准人口为每个年龄分层分配相等权重：$w_{\\text{young}} = 0.5$ 和 $w_{\\text{old}} = 0.5$。使用以上定义，计算比较暴露组与非暴露组的直接年龄标准化患病率比。将最终答案表示为小数，并四舍五入到三位有效数字。",
            "solution": "该问题要求计算直接年龄标准化患病率比，以比较暴露组（接触溶剂的制造业工人）和非暴露组（办公室职员）之间的慢性呼吸系统疾病。分析必须使用年轻和年老两个分层来考虑年龄的混杂效应。\n\n首先，我们必须验证问题陈述的有效性。\n**步骤 1：提取给定信息**\n- 暴露组，年轻：$N_{E,Y} = 200$ 名总参与者，其中 $C_{E,Y} = 16$ 例。\n- 暴露组，年老：$N_{E,O} = 800$ 名总参与者，其中 $C_{E,O} = 280$ 例。\n- 非暴露组，年轻：$N_{U,Y} = 800$ 名总参与者，其中 $C_{U,Y} = 80$ 例。\n- 非暴露组，年老：$N_{U,O} = 200$ 名总参与者，其中 $C_{U,O} = 80$ 例。\n- 患病率定义：一个群体中现患病例的比例。\n- 方法论：使用对每个年龄分层具有相等权重的标准人口进行直接标准化。\n- 标准人口权重：$w_{\\text{young}} = 0.5$ 和 $w_{\\text{old}} = 0.5$。\n\n**步骤 2：使用提取的给定信息进行验证**\n该问题在科学上基于标准的流行病学原理（横断面研究、患病率、混杂、标准化）。问题提法得当，为得出唯一解提供了所有必要的数据和定义。语言客观、精确。数据内部一致，不违反任何数学或逻辑原则。该情景，包括辛普森悖论的存在，是流行病学中一个经典且现实的教学案例。因此，该问题是有效的。\n\n**步骤 3：结论与行动**\n问题是有效的。我们着手解决它。\n\n解决方案需要计算暴露组和非暴露组的年龄标准化患病率，然后求出它们的比率。此过程首先计算分层特异性患病率。\n\n设 $P(C|E, Y)$ 为年轻（$Y$）的暴露者（$E$）中该病症（$C$）的患病率。类似地，我们为其他三个亚组定义 $P(C|E, O)$、$P(C|U, Y)$ 和 $P(C|U, O)$。\n\n分层特异性患病率计算如下：\n1.  暴露组，年轻组的患病率：\n    $$P(C|E, Y) = \\frac{C_{E,Y}}{N_{E,Y}} = \\frac{16}{200} = 0.08$$\n2.  暴露组，年老组的患病率：\n    $$P(C|E, O) = \\frac{C_{E,O}}{N_{E,O}} = \\frac{280}{800} = 0.35$$\n3.  非暴露组，年轻组的患病率：\n    $$P(C|U, Y) = \\frac{C_{U,Y}}{N_{U,Y}} = \\frac{80}{800} = 0.10$$\n4.  非暴露组，年老组的患病率：\n    $$P(C|U, O) = \\frac{C_{U,O}}{N_{U,O}} = \\frac{80}{200} = 0.40$$\n\n接下来，我们应用直接标准化的方法。这涉及到对每个暴露组的分层特异性患病率进行加权平均，使用来自一个共同标准人口的权重。问题指定了一个标准人口，其年轻和年老分层的权重相等：$w_{\\text{young}} = 0.5$ 和 $w_{\\text{old}} = 0.5$。\n\n暴露组的年龄标准化患病率 $P_{\\text{std, E}}$ 使用标准权重和全概率定律计算得出：\n$$P_{\\text{std, E}} = w_{\\text{young}} \\times P(C|E, Y) + w_{\\text{old}} \\times P(C|E, O)$$\n$$P_{\\text{std, E}} = (0.5 \\times 0.08) + (0.5 \\times 0.35) = 0.040 + 0.175 = 0.215$$\n\n类似地，非暴露组的年龄标准化患病率 $P_{\\text{std, U}}$ 为：\n$$P_{\\text{std, U}} = w_{\\text{young}} \\times P(C|U, Y) + w_{\\text{old}} \\times P(C|U, O)$$\n$$P_{\\text{std, U}} = (0.5 \\times 0.10) + (0.5 \\times 0.40) = 0.050 + 0.200 = 0.250$$\n\n最后，直接年龄标准化患病率比（SPR）是暴露组的标准化患病率与非暴露组的标准化患病率之比。\n$$\\text{SPR} = \\frac{P_{\\text{std, E}}}{P_{\\text{std, U}}}$$\n$$\\text{SPR} = \\frac{0.215}{0.250} = 0.86$$\n\n问题要求答案表示为小数，并四舍五入到三位有效数字。数值 $0.86$ 有两位有效数字。为了表示为三位有效数字，我们在后面加一个零。\n$$\\text{SPR} = 0.860$$\n\n这一结果表明，在对两组不同的年龄结构进行调整后，暴露组的疾病患病率低于非暴露组，这与粗略（未经调整）的比较所显示的有害关联相反。这种逆转是辛普森悖论的一个标志。",
            "answer": "$$\n\\boxed{0.860}\n$$"
        },
        {
            "introduction": "在现实世界的研究中，数据几乎总是存在缺失。缺失数据是威胁横断面研究有效性的一个主要因素。本练习探讨了不同的数据缺失机制——完全随机缺失（MCAR）、随机缺失（MAR）和非随机缺失（MNAR）——如何影响患病率估计的准确性。通过推导和计算不同估计量（如完整病例分析和插补法）在不同缺失机制下的期望偏差，你将深刻理解为何缺失数据并非一个简单的技术问题，而是一个可能从根本上破坏研究结论的严重局限，特别是在缺失与你所测量的结果本身相关时()。",
            "id": "4639581",
            "problem": "一项横断面研究在目标人群中的单个时间点测量了一个二元暴露 $X \\in \\{0,1\\}$ 和一个二元结局 $Y \\in \\{0,1\\}$。其科学目标是估计结局 $Y$ 的真实时点患病率，记为 $P(Y=1)$。设 $P(X=1) = p_X$，$P(Y=1 \\mid X=1) = p_1$，以及 $P(Y=1 \\mid X=0) = p_0$。根据全概率定律，真实患病率为 $P(Y=1) = p_X \\, p_1 + (1 - p_X)\\, p_0$。然而，由于无应答，结局 $Y$ 仅对一部分个体被观测到。设 $R \\in \\{0,1\\}$ 是一个指示变量，表示 $Y$ 是否被观测到（$R=1$）或缺失（$R=0$）。观测机制由条件概率 $P(R=1 \\mid X=x, Y=y) = r_{xy}$（对于 $x \\in \\{0,1\\}, y \\in \\{0,1\\}$）来表征。您必须从基本原理出发（仅使用全概率定律和条件概率等基本定义），在指定的观测机制下推导出两种估计量的期望值：\n\n- 完整病例估计量，它只使用 $R=1$ 的个体，并计算观测到的结局比例期望值 $P(Y=1 \\mid R=1)$。\n\n- 暴露分层内朴素单一插补估计量，它在每个暴露层 $X=x$ 内，使用观测到的条件均值 $P(Y=1 \\mid R=1, X=x)$ 来插补缺失的 $Y$ 值，然后通过 $P(X=x)$ 对分层插补均值进行加权平均。\n\n您的程序必须针对每个指定的测试用例执行以下操作：\n- 使用 $p_X$、$p_1$ 和 $p_0$ 计算真实患病率 $p = P(Y=1)$。\n- 在指定的 $r_{xy}$ 下，计算完整病例估计期望值 $p_{\\mathrm{cc}} = P(Y=1 \\mid R=1)$。\n- 计算暴露分层内朴素单一插补估计期望值 $p_{\\mathrm{imp}}$，其等于 $\\sum_{x \\in \\{0,1\\}} P(X=x) \\, P(Y=1 \\mid R=1, X=x)$，其中 $P(Y=1 \\mid R=1, X=x)$ 由观测机制和 $(X,Y)$ 的联合分布决定。\n- 计算偏倚 $b_{\\mathrm{cc}} = p_{\\mathrm{cc}} - p$ 和 $b_{\\mathrm{imp}} = p_{\\mathrm{imp}} - p$。\n所有答案必须以小数（而非百分比）表示。\n\n在所有测试用例中使用以下通用参数：\n- $p_X = 0.4$\n- $p_1 = 0.3$\n- $p_0 = 0.1$\n\n使用以下观测机制测试套件（每行按顺序提供 $(r_{00}, r_{01}, r_{10}, r_{11})$）：\n- 测试用例 $1$（完全随机缺失 (MCAR)）：$(0.7, 0.7, 0.7, 0.7)$\n- 测试用例 $2$（仅依赖于 $X$ 的随机缺失 (MAR)）：$(0.5, 0.5, 0.9, 0.9)$\n- 测试用例 $3$（仅依赖于 $Y$ 的非随机缺失 (MNAR)；若 $Y=1$ 则应答率较低）：$(0.95, 0.6, 0.95, 0.6)$\n- 测试用例 $4$（无缺失边界情况）：$(1.0, 1.0, 1.0, 1.0)$\n- 测试用例 $5$（极端 MNAR；若 $Y=1$ 则应答率极低）：$(0.9, 0.1, 0.9, 0.1)$\n\n对于每个测试用例，您的程序应输出一个包含五个浮点数的有序列表 $[p, p_{\\mathrm{cc}}, b_{\\mathrm{cc}}, p_{\\mathrm{imp}}, b_{\\mathrm{imp}}]$，每个浮点数四舍五入到六位小数。将所有测试用例的结果按上述顺序汇总成一个单一列表。\n\n最终输出格式：您的程序应生成单行文本，其中包含一个逗号分隔的列表，列表由五个结果组成，每个结果本身都是一个方括号内的列表。例如：$[[a_1,a_2,a_3,a_4,a_5],[\\dots],\\dots]$，其中每个 $a_i$ 都是一个四舍五入到六位小数的浮点数。不应打印任何额外文本。\n\n关于科学真实性和研究设计的说明：横断面研究在单个时间点估计 $P(Y=1)$，无法确定 $X$ 和 $Y$ 之间的时间顺序。它们在患病率估计方面的优势会因数据缺失而受到削弱。在 $R \\perp Y \\mid X$（即给定 $X$ 为随机缺失）的情况下，使用观测到的条件均值进行暴露分层内朴素单一插补可以恢复无偏的患病率，而如果 $R$ 依赖于 $X$ 且 $X$ 与 $Y$ 相关，则完整病例估计量可能存在偏倚。在 $R$ 依赖于 $Y$（非随机缺失）的情况下，两种方法都可能存在偏倚，这说明了在存在不可忽略的缺失数据时，横断面设计的一个关键局限性。",
            "solution": "该问题要求在各种缺失数据机制下，推导并计算一个结局的真实患病率以及该患病率的两种估计量的期望值。推导过程必须从基本原理出发。\n\n设二元暴露为 $X \\in \\{0, 1\\}$，二元结局为 $Y \\in \\{0, 1\\}$。$Y$ 的观测情况由 $R \\in \\{0, 1\\}$ 指示，其中 $R=1$ 表示 $Y$ 被观测到。\n给定的参数是：\n- $P(X=1) = p_X$\n- $P(Y=1 \\mid X=1) = p_1$\n- $P(Y=1 \\mid X=0) = p_0$\n- $P(R=1 \\mid X=x, Y=y) = r_{xy}$\n\n由此，我们可以定义互补概率：\n- $P(X=0) = 1 - p_X$\n- $P(Y=0 \\mid X=1) = 1 - p_1$\n- $P(Y=0 \\mid X=0) = 1 - p_0$\n\n首先，我们使用条件概率的定义 $P(A, B) = P(A \\mid B)P(B)$ 推导必要的联合概率 $P(X=x, Y=y)$：\n$$P(X=1, Y=1) = P(Y=1 \\mid X=1)P(X=1) = p_1 p_X$$\n$$P(X=1, Y=0) = P(Y=0 \\mid X=1)P(X=1) = (1 - p_1) p_X$$\n$$P(X=0, Y=1) = P(Y=1 \\mid X=0)P(X=0) = p_0 (1 - p_X)$$\n$$P(X=0, Y=0) = P(Y=0 \\mid X=0)P(X=0) = (1 - p_0) (1 - p_X)$$\n\n**1. 真实患病率 ($p$)**\n结局的真实患病率 $p = P(Y=1)$ 是通过全概率定律，对暴露 $X$ 进行边缘化推导得出：\n$$p = P(Y=1) = \\sum_{x \\in \\{0,1\\}} P(Y=1 \\mid X=x)P(X=x)$$\n$$p = P(Y=1 \\mid X=1)P(X=1) + P(Y=1 \\mid X=0)P(X=0)$$\n$$p = p_1 p_X + p_0 (1 - p_X)$$\n这是用于与估计量进行比较的金标准值。\n\n**2. 完整病例估计量 ($p_{\\mathrm{cc}}$)**\n完整病例估计量的期望值是观测到的个体中结局的比例，即条件概率 $p_{\\mathrm{cc}} = P(Y=1 \\mid R=1)$。根据条件概率的定义：\n$$p_{\\mathrm{cc}} = P(Y=1 \\mid R=1) = \\frac{P(Y=1, R=1)}{P(R=1)}$$\n我们必须推导出分子和分母的表达式。\n分子 $P(Y=1, R=1)$ 是出现结局且被观测到的联合概率。我们通过对 $X$ 进行边缘化来求得此值：\n$$P(Y=1, R=1) = \\sum_{x \\in \\{0,1\\}} P(X=x, Y=1, R=1)$$\n使用链式法则 $P(A,B,C) = P(C \\mid A,B) P(A,B)$:\n$$P(Y=1, R=1) = P(R=1 \\mid X=1, Y=1)P(X=1, Y=1) + P(R=1 \\mid X=0, Y=1)P(X=0, Y=1)$$\n$$P(Y=1, R=1) = r_{11} (p_1 p_X) + r_{01} (p_0 (1 - p_X))$$\n分母 $P(R=1)$ 是被观测到的总概率。我们通过对 $X$ 和 $Y$ 进行边缘化来求得此值：\n$$P(R=1) = \\sum_{x \\in \\{0,1\\}} \\sum_{y \\in \\{0,1\\}} P(X=x, Y=y, R=1)$$\n$$P(R=1) = P(R=1 \\mid X=1, Y=1)P(X=1, Y=1) + P(R=1 \\mid X=1, Y=0)P(X=1, Y=0) + P(R=1 \\mid X=0, Y=1)P(X=0, Y=1) + P(R=1 \\mid X=0, Y=0)P(X=0, Y=0)$$\n$$P(R=1) = r_{11} p_1 p_X + r_{10} (1 - p_1) p_X + r_{01} p_0 (1 - p_X) + r_{00} (1 - p_0) (1 - p_X)$$\n综合这些，完整病例估计量为：\n$$p_{\\mathrm{cc}} = \\frac{r_{11} p_1 p_X + r_{01} p_0 (1 - p_X)}{r_{11} p_1 p_X + r_{10} (1 - p_1) p_X + r_{01} p_0 (1 - p_X) + r_{00} (1 - p_0) (1 - p_X)}$$\n\n**3. 暴露分层内朴素单一插补估计量 ($p_{\\mathrm{imp}}$)**\n此估计量的期望值定义为 $p_{\\mathrm{imp}} = \\sum_{x \\in \\{0,1\\}} P(X=x) \\, P(Y=1 \\mid R=1, X=x)$。这需要计算每个暴露分层内，仅限于观测对象的结局患病率。\n对于分层 $X=1$：\n$$P(Y=1 \\mid R=1, X=1) = \\frac{P(Y=1, R=1, X=1)}{P(R=1, X=1)}$$\n分子是 $P(R=1 \\mid Y=1, X=1)P(Y=1 \\mid X=1)P(X=1) = r_{11} p_1 p_X$。我们需要 $P(R=1, X=1)$，通过对 $Y$ 进行边缘化得到：\n$$P(R=1, X=1) = P(R=1 \\mid Y=1, X=1)P(Y=1,X=1) + P(R=1 \\mid Y=0, X=1)P(Y=0,X=1)$$\n$$P(R=1, X=1) = r_{11} p_1 p_X + r_{10} (1-p_1) p_X = p_X (r_{11} p_1 + r_{10} (1-p_1))$$\n因此，所需的条件概率是：\n$$P(Y=1 \\mid R=1, X=1) = \\frac{r_{11} p_1 p_X}{p_X (r_{11} p_1 + r_{10} (1-p_1))} = \\frac{r_{11} p_1}{r_{11} p_1 + r_{10}(1-p_1)}$$\n类似地，对于分层 $X=0$：\n$$P(Y=1 \\mid R=1, X=0) = \\frac{P(Y=1, R=1, X=0)}{P(R=1, X=0)}$$\n$$P(Y=1 \\mid R=1, X=0) = \\frac{r_{01} p_0 (1-p_X)}{(1-p_X)(r_{01} p_0 + r_{00}(1-p_0))} = \\frac{r_{01} p_0}{r_{01} p_0 + r_{00}(1-p_0)}$$\n将这些代入 $p_{\\mathrm{imp}}$ 的公式中：\n$$p_{\\mathrm{imp}} = p_X \\left( \\frac{r_{11} p_1}{r_{11} p_1 + r_{10}(1-p_1)} \\right) + (1-p_X) \\left( \\frac{r_{01} p_0}{r_{01} p_0 + r_{00}(1-p_0)} \\right)$$\n这些关于 $p$、$p_{\\mathrm{cc}}$ 和 $p_{\\mathrm{imp}}$ 的表达式允许根据问题参数直接进行计算。\n\n**4. 偏倚 ($b_{\\mathrm{cc}}$ 和 $b_{\\mathrm{imp}}$)**\n这两种估计量的偏倚定义为其期望值与真实患病率之间的差异：\n$$b_{\\mathrm{cc}} = p_{\\mathrm{cc}} - p$$\n$$b_{\\mathrm{imp}} = p_{\\mathrm{imp}} - p$$\n这些公式将被实施以计算每个测试用例所需的值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the epidemiology missing data problem for all specified test cases.\n    \"\"\"\n    # Common parameters across all test cases\n    pX = 0.4  # P(X=1)\n    p1 = 0.3  # P(Y=1 | X=1)\n    p0 = 0.1  # P(Y=1 | X=0)\n\n    # Observation mechanism test suite: (r00, r01, r10, r11)\n    test_cases = [\n        (0.7, 0.7, 0.7, 0.7),  # 1. MCAR\n        (0.5, 0.5, 0.9, 0.9),  # 2. MAR on X\n        (0.95, 0.6, 0.95, 0.6), # 3. MNAR on Y\n        (1.0, 1.0, 1.0, 1.0),  # 4. No missingness\n        (0.9, 0.1, 0.9, 0.1),   # 5. Extreme MNAR on Y\n    ]\n\n    # --- Pre-calculate constant probabilities ---\n    pX0 = 1 - pX # P(X=0)\n    \n    # Joint probabilities P(X=x, Y=y)\n    p_x1_y1 = p1 * pX\n    p_x1_y0 = (1 - p1) * pX\n    p_x0_y1 = p0 * pX0\n    p_x0_y0 = (1 - p0) * pX0\n    \n    # 1. True Prevalence (p)\n    p_true = p_x1_y1 + p_x0_y1\n    # Alternative calculation: p_true = p1 * pX + p0 * pX0\n\n    all_results = []\n\n    for case in test_cases:\n        r00, r01, r10, r11 = case\n\n        # 2. Complete-Case Estimator (p_cc)\n        # Numerator: P(Y=1, R=1) = r11*P(X=1,Y=1) + r01*P(X=0,Y=1)\n        p_y1_r1 = r11 * p_x1_y1 + r01 * p_x0_y1\n        \n        # Denominator: P(R=1) = sum_{x,y} r_xy * P(X=x,Y=y)\n        p_r1 = (r11 * p_x1_y1 + \n                r10 * p_x1_y0 + \n                r01 * p_x0_y1 + \n                r00 * p_x0_y0)\n\n        if p_r1 == 0:\n            p_cc = np.nan  # Or other appropriate value for this undefined case\n        else:\n            p_cc = p_y1_r1 / p_r1\n\n        # 3. Naive Within-Exposure Single Imputation Estimator (p_imp)\n        # Stratum X=1: P(Y=1 | R=1, X=1)\n        denom_imp_x1 = r11 * p1 + r10 * (1 - p1)\n        if denom_imp_x1 == 0:\n            p_y1_cond_r1_x1 = 0 # No observed subjects in this stratum to impute from\n        else:\n            p_y1_cond_r1_x1 = (r11 * p1) / denom_imp_x1\n        \n        # Stratum X=0: P(Y=1 | R=1, X=0)\n        denom_imp_x0 = r01 * p0 + r00 * (1 - p0)\n        if denom_imp_x0 == 0:\n            p_y1_cond_r1_x0 = 0 # No observed subjects in this stratum to impute from\n        else:\n            p_y1_cond_r1_x0 = (r01 * p0) / denom_imp_x0\n            \n        p_imp = pX * p_y1_cond_r1_x1 + pX0 * p_y1_cond_r1_x0\n\n        # 4. Biases\n        b_cc = p_cc - p_true\n        b_imp = p_imp - p_true\n        \n        # Store results for this case\n        result_list = [p_true, p_cc, b_cc, p_imp, b_imp]\n        \n        # Format the list of floats into strings with 6 decimal places\n        formatted_list = [f\"{v:.6f}\" for v in result_list]\n        \n        # Append the formatted list as a string \"[v1,v2,...]\"\n        all_results.append(f\"[{','.join(formatted_list)}]\")\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}