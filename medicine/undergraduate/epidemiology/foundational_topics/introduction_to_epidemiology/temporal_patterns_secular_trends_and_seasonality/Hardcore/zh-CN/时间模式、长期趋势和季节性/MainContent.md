## 引言
疾病的发生并非随机散布于时间长河中，而是常常遵循着可识别的模式。在流行病学中，理解这些时间模式——特别是持续数十年的长期趋势（secular trends）和年复一年的季节性（seasonality）——对于监测疾病动态、探究病因以及评估公共卫生干预的效果至关重要。然而，从原始数据中准确分离并解释这些模式充满了挑战；简单的观察可能被[人口结构](@entry_id:148599)变化所误导，而暴露与结局之间的关联也可能因共同的时间节律而产生混淆。本文旨在系统性地解决这些问题。

在接下来的内容中，读者将踏上一段从理论到实践的旅程。我们将首先在“原理与机制”一章中，解构时间序列的基本组成部分，并介绍用于建模趋势和季节性的核心统计工具。接着，在“应用与跨学科联系”一章，我们将通过丰富的案例，展示这些方法如何在[公共卫生监测](@entry_id:170581)、环境流行病学研究和政策评估中发挥关键作用。最后，通过“动手实践”部分，读者将有机会亲手应用所学知识解决具体问题。让我们从深入理解构成这些时间模式的基本原理与机制开始。

## 原理与机制

在流行病学研究中，疾病的发生率和死亡率常常随时间呈现出系统性的模式。理解这些时间模式对于疾病监测、病因推断和公共卫生干预评估至关重要。本章将深入探讨构成这些模式的两个核心组成部分：长期趋势（secular trends）和季节性（seasonality）。我们将从基本定义出发，介绍识别、量化和建模这些模式的原理与方法，并讨论在分析过程中遇到的关键挑战，如混杂和模型设定问题。

### 解构时间序列数据

流行病学的[时间序列数据](@entry_id:262935)，如按天、周或月记录的疾病计数值，通常可以被看作是几个潜在（无法直接观测）部分的叠加。经典的时间序列分解将一个观测序列 $Y_t$（在时间点 $t$ 的观测值）视为三个主要部分的组合：长期趋势（$T_t$ 或 $\mu_t$）、季节性成分（$S_t$ 或 $s_t$）和不规则变异或残差（$R_t$ 或 $\epsilon_t$）。

-   **长期趋势（Secular Trend）**：指时间序列在多年或数十年的长时间跨度内表现出的平滑、缓慢的总体变化方向。这种趋势反映了疾病发生率的根本性长期变化，其驱动因素可能包括[人口结构](@entry_id:148599)变迁（如老龄化）、生活方式的改变、环境的长期演变、医疗技术的进步以及大规模公共卫生干预措施的实施。

-   **季节性（Seasonality）**：指在固定周期内（如一年）反复出现的、可预测的模式性波动。对于按月记录的数据，周期通常是 $12$ 个月；对于按周记录的数据，周期约为 $52$ 周。季节性模式通常与气候因素（温度、湿度）、宿主行为（如学年日历、节假日旅行）或病媒生物的生命周期（如蚊子）密切相关。

-   **不规则变异（Irregular Variation）**：也称为残差或噪声，是指在剔除长期趋势和季节性成分后剩余的、不可预测的随机波动。它可能源于数据报告中的[随机误差](@entry_id:144890)、短暂的局部性暴发，或其他未被模型捕捉的短期随机事件。

将这三个部分组合起来的基本模型有两种形式：加法模型和乘法模型 。

**加法分解模型** 的形式为：
$Y_t = \mu_t + s_t + \epsilon_t$

在这个模型中，季节性成分 $s_t$ 和不规则变异 $\epsilon_t$ 被视为对长期趋势 $\mu_t$ 的加性偏离。为了使各成分在概念上可分离，通常会施加约束。不规则变异 $\epsilon_t$ 被假定为一个均值为零的[随机过程](@entry_id:268487)，即 $\mathbb{E}[\epsilon_t] = 0$。季节性成分 $s_t$ 则代表围绕趋势的振荡，因此在一个完整的周期 $m$ 内（例如 $m=12$ 个月），其影响应相互抵消。这一约束的数学表达为 $\sum_{k=0}^{m-1} s_{t+k} = 0$。加法模型适用于季节性波动的绝对幅度不随长期趋势水平变化的情景。例如，无论基线发病率是高还是低，季节性高峰带来的病例数增加量大致相同。

**[乘法分解](@entry_id:199514)模型** 的形式为：
$Y_t = \mu_t \times S_t \times \epsilon_t$

在流行病学计数资料中，通常观察到方差随均值增大而增大的现象（即过度离散，详见后文）。乘法模型能更好地捕捉这种特性，因为它假设季节性效应是与趋势水平成比例的。在这里，季节性成分 $S_t$ 是一个调节趋势的乘法因子。相应的约束条件是，在一个完整周期内，季节性因子的平均值为 $1$，即 $\frac{1}{m}\sum_{k=0}^{m-1} S_{t+k} = 1$。同时，不规则变异项 $\epsilon_t$ 的[期望值](@entry_id:150961)为 $1$，即 $\mathbb{E}[\epsilon_t] = 1$。乘法模型可以通过对数变换转化为加法模型：$\ln(Y_t) = \ln(\mu_t) + \ln(S_t) + \ln(\epsilon_t)$，这在实际建模中非常有用。

### 长期趋势的特征与建模

长期趋势反映了疾病风险的根本性变化，但其表象也可能受到人口构成变化的影响。准确地分离和建模长期趋势是理解疾病动态和评估长期干预效果的基础。

#### 作为人口构成变化产物的表观趋势

在分析一个群体多年的粗发病率或粗死亡率时，观察到的长期趋势可能并非完全由个体风险的变化引起，而可能是由于人口构成的变化所致，其中最典型的是**年龄结构的变化**。例如，对于一种在老年人群中发病率远高于年轻人群的疾病，如果总人口在观察期内逐渐老龄化（即老年人占比增加），即使每个年龄组的真实发病率（年龄别率）保持不变，总体的粗发病率也会呈现出上升的趋势。这种由人口构成变化驱动的趋势是一种“表观趋势”，因为它掩盖了潜在风险的真实动态 。

为了校正这种构成性混杂，流行病学采用**率的标准化**方法。**直接标准化（Direct Standardization）**是一种常用技术，它通过将各时期（或各地区）的年龄别率应用于一个固定的“标准人口”的[年龄结构](@entry_id:197671)，来计算标准化率。具体而言，若 $r_i(t)$ 为时间 $t$ 时年龄组 $i$ 的发病率，而 $w_i^\star$ 为标准人口中年龄组 $i$ 的占比，则时间 $t$ 的标准化率 $R_s(t)$ 计算如下：
$R_s(t) = \sum_{i} r_i(t) \cdot w_i^\star$

通过这种方式计算得到的标准化率时间序列，$R_s(t)$ 的任何变化都只能归因于年龄别率 $r_i(t)$ 的变化，因为年龄结构 $w_i^\star$ 已经被固定。比较原始的粗率趋势 $R_c(t) = \sum_{i} r_i(t) \cdot w_i(t)$ 与标准化率趋势 $R_s(t)$，可以揭示人口结构变化在多大程度上驱动了观察到的长期趋势。如果粗率显著上升而标准化率保持平稳，则表明观测到的趋势主要是人口老龄化的结果 。

#### 长期趋势的建模策略

在[回归模型](@entry_id:163386)中，为了将长期趋势与季节性等其他成分分离开，必须对趋势的形态做出合理的假设。核心原则是，趋势是一个**平滑的、低频的**函数，其变化尺度远大于季节性周期 。

有效的建模策略包括：
1.  **低阶多项式函数**：用时间的线性（$t$）或二次（$t^2$）项来捕捉简单的单调上升、下降或简单的弧形趋势。
2.  **[平滑样条](@entry_id:637498)函数（Splines）**：样条函数，特别是自然样条（natural splines），是通过在时间轴上设定少量“节点”（knots）并将多项式片段光滑连接而成的。通过控制节点的数量和位置（例如，在长达10年的数据中每3-5年设一个节点），可以构建出足够灵活以捕捉复杂非线性趋势，但又足够平滑以避免拟合季节性波动的函数。这是一种在现代流行病学时间序列分析中非常强大和灵活的方法。
3.  **[移动平均](@entry_id:203766)（Moving Average）**：通过计算一个滑动时间窗口内的平均值来平滑序列。例如，对于月度数据，一个12个月的中心化[移动平均](@entry_id:203766)可以有效地滤除季节性，从而揭示潜在的趋势。

与此相对，一些策略是错误的，因为它们违反了[尺度分离](@entry_id:270204)的原则 ：
-   使用**高阶多项式**（例如，对10年的数据使用12阶多项式）会导致模型过度拟合，使得估计的“趋势”曲线扭曲以追踪季节性波动甚至随机噪声。
-   使用**季节性项**（如周期为12个月的正弦/余弦函数）来代表长期趋势是概念上的混淆，因为这些项天生就是用来描述年度内重复模式的。

### 季节性的理解与建模

季节性是流行病学数据中最显著的特征之一。准确地刻画季节性有助于识别高风险时期，并为季节性预防措施（如疫苗接种时机）提供依据。

#### 季节性的形式化定义与流行病学基础

从统计学上讲，一个时间序列 $Y_t$ 具有季节性，可以形式化地表述为其[期望值](@entry_id:150961) $E[Y_t]$ 是一个周期函数 $f(t)$，满足 $f(t+P) = f(t)$，其中 $P$ 是已知的周期 。这意味着，在相隔一个完整周期的不同时间点，疾病的平均发生水平是相同的。例如，对于温带地区的流感，每年冬季都是高发期，其月度病例数的[期望值](@entry_id:150961)会呈现出以 $P=12$ 个月为周期的模式。

许多疾病的季节性模式都有其生物学、环境或行为学基础 ：
-   **呼吸道传染病**（如流感、呼吸道合胞病毒感染）在温带地区的冬季达到高峰，这与较低的温度和湿度、以及人们更多地聚集在室内等因素有关。
-   **过敏性疾病**（如由花粉引起过敏性鼻炎）的高峰期与特定植物的开花季节（春季或秋季）同步，呈现明显的年度周期。
-   **肠道传染病**（如沙门氏菌病）在夏季更为常见，这可能与温暖天气有利于细菌在食物中繁殖，以及户外餐饮活动增加有关。

#### 季节性的识别方法

在建模之前，需要确认数据中是否存在季节性并刻画其特征。主要有两种途径：[时域分析](@entry_id:755979)和[频域分析](@entry_id:265642)。

1.  **[时域分析](@entry_id:755979)：[自相关函数](@entry_id:138327)（ACF）**
    **[自相关函数](@entry_id:138327)（Autocorrelation Function, ACF）** 衡量一个时间序列在不同时间点之间的相关性。对于一个弱[平稳序列](@entry_id:144560) $X_t$（即均值和方差恒定，且协方差只依赖于时间差），其在滞后 $h$ 时的自相关系数 $\rho(h)$ 定义为：
    $\rho(h) = \text{Corr}(X_t, X_{t+h}) = \frac{\text{Cov}(X_t, X_{t+h})}{\text{Var}(X_t)}$
    如果一个序列存在周期为 $P$ 的季节性，那么在时间点 $t$ 的值会与在时间点 $t+P, t+2P, \dots$ 的值相似（例如，今年1月的高病例数预示着明年1月可能也是高病例数）。这种相似性表现为正相关。因此，季节性序列的ACF图会在滞后 $h=P, 2P, 3P, \dots$ 的位置上出现显著的峰值 。对于周期为52周的[流感](@entry_id:190386)数据，其ACF图应在滞后52周、104周等位置出现高峰。

2.  **[频域分析](@entry_id:265642)：[周期图](@entry_id:194101)（Periodogram）**
    **[周期图](@entry_id:194101)**是一种将序列的[方差分解](@entry_id:272134)到不同频率上的工具，用于识别数据中隐藏的周期性成分。对于一个经过中心化和去趋势处理的均匀采样序列 $x_t$，其[周期图](@entry_id:194101) $I(\omega)$ 在角频率 $\omega$ 处的值正比于数据在该频率下的“能量”或方差贡献。它的计算基于序列的[离散傅里叶变换](@entry_id:144032) ：
    $I(\omega) = \frac{1}{N} \left| \sum_{t=0}^{N-1} x_t e^{-i\omega t \Delta t} \right|^2$
    其中 $N$ 是观测点数，$\Delta t$ 是采样间隔。周期与频率的关系是 $T = 2\pi/\omega$。如果数据中存在一个强烈的年度周期（$P=52$ 周），那么周期图就会在对应的频率 $\omega \approx 2\pi/52$ 处显示一个显著的峰值。
    
    对于存在数据缺失或采样不均匀的时间序列，直接应用标准周期图是不合适的。此时应使用**[Lomb-Scargle周期图](@entry_id:181077)**。该方法在本质上等同于在每个频率 $\omega$ 下，通过[最小二乘法](@entry_id:137100)将数据拟合到正弦和余弦函数 $a\cos(\omega t) + b\sin(\omega t)$，并根据拟合优度（残差平方和的减少量）来定义该频率的“功率”。这种方法无需对[缺失数据](@entry_id:271026)进行插值（插值会扭曲[频谱](@entry_id:276824)结构），从而能够稳健地识别不均匀采样数据中的周期性 。

#### 季节性的建模策略

在回归模型中，通常使用以下两种方法来控制季节性：
-   **指示变量（Indicator Variables）**：为每个季节性单位（如一年中的12个月份，或52个星期中的某个）创建一个[虚拟变量](@entry_id:138900)。这种方法是非参数的，可以灵活地拟合任何形状的季节模式，但需要的参数较多。
-   **[谐波](@entry_id:170943)项（Harmonic Terms）**：使用成对的正弦和余弦函数（傅里叶项）来表示季节模式，如：
    $\sum_{k=1}^{K} \left\{ \alpha_k \cos\left(\frac{2\pi k t}{P}\right) + \beta_k \sin\left(\frac{2\pi k t}{P}\right) \right\}$
    其中 $P$ 是主周期。$k=1$ 的项捕捉基频（如年度周期），$k>1$ 的项捕捉[谐波](@entry_id:170943)（如半年度周期）。这种方法通常更节约参数，并假设季节模式是平滑的 。

### 综合方法与实践挑战

在实际分析中，趋势和季节性通常是同时存在且需要一并处理的。此外，流行病学计数数据还带来了特定的统计挑战。

#### 综合分解方法：STL

**基于Loess的季节-趋势分解（Seasonal-Trend decomposition using Loess, STL）**是一种强大而灵活的分解方法 。STL通过一个迭代过程，将序列 $Y_t$ 分解为趋势 $T_t$、季节 $S_t$ 和残差 $R_t$ 三个部分。其核心是**Loess（局部加权散点平滑）**，一种基于局部[多项式回归](@entry_id:176102)的[平滑技术](@entry_id:634779)。STL有两个关键的平滑窗口参数需要设定：
-   **趋势窗口（`t.window`）**：用于提取趋势成分的Loess平滑窗口宽度。该窗口必须**远大于**季节周期 $P$，以确保估计的趋势线足够平滑，不会错误地捕捉季节性波动。例如，对于周期为52周的数据，趋势窗口可以设为1.5到2倍年长（如79或105周）。
-   **季节窗口（`s.window`）**：用于平滑每个周期子序列（如所有第一周的数据，所有第二周的数据，等等），以允许季节模式随时间缓慢演变。

一个重要的特性是STL可以进行**稳健性拟合（robust fitting）**。在面对像异常猛烈的大规模暴发这样的离群值时，标准[平滑方法](@entry_id:754982)会受到严重影响，导致趋势和季节模式的估计失真。启用稳健性选项后，STL会迭代地识别并降低大残差的权重，从而将这些异常事件隔离到残差项 $R_t$ 中，保护了对常规趋势和季节模式的准确估计 。

#### 时间序列的[平稳性](@entry_id:143776)与差分

一个包含长期趋势或季节性的时间序列，其均值 $E[Y_t]$ 随时间 $t$ 变化，因而是**非平稳的（non-stationary）**。许多经典的时间序列模型（如[ARIMA模型](@entry_id:146503)）要求数据是平稳的。**差分（Differencing）**是将非[平稳序列](@entry_id:144560)转换为[平稳序列](@entry_id:144560)的常用工具 。
-   **[一阶差分](@entry_id:275675)（Lag-1 Differencing）**：通过计算相邻观测值之差 $\Delta Y_t = Y_t - Y_{t-1}$ 来实现。如果原始序列的趋势是线性的（$\mu_t = \alpha + \beta t$），那么[一阶差分](@entry_id:275675)序列的均值将是一个常数 $\beta$，从而消除了趋势。
-   **季节性差分（Seasonal Differencing）**：通过计算相隔一个季节周期的观测值之差 $\Delta_P Y_t = Y_t - Y_{t-P}$ 来实现。由于季节性成分满足 $S_t = S_{t-P}$，进行季节性差分后，季节项 $(S_t - S_{t-P})$ 将被消除。

#### 计数数据的[过度离散](@entry_id:263748)问题

流行病学数据通常是计数资料，如每周的病例数。标准的泊松（Poisson）回归模型假设计数的方差等于其均值（$\text{Var}(Y_t) = E(Y_t)$），这一性质称为“等离散”。然而，在实际数据中，方差往往远大于均值（$\text{Var}(Y_t) > E(Y_t)$），这种现象称为**[过度离散](@entry_id:263748)（overdispersion）** 。[过度离散](@entry_id:263748)可能源于群体异质性、事件的聚集性或未被模型捕捉的变异。

若在存在[过度离散](@entry_id:263748)的情况下仍使用泊松模型，虽然系数的点估计可能仍是无偏的，但其[标准误](@entry_id:635378)会被严重低估，导致[置信区间](@entry_id:138194)过窄和p值过小，从而做出错误的[统计推断](@entry_id:172747)。为了获得有效的推断，必须采用能处理过度离散的模型 ：
1.  **准泊松回归（Quasi-Poisson Regression）**：该模型假定方差与均值成正比，$\text{Var}(Y_t) = \phi E(Y_t)$，其中 $\phi$ 是一个从数据中估计的离散参数。然后，模型用 $\sqrt{\hat{\phi}}$ 来校正（放大）[标准误](@entry_id:635378)。
2.  **负二项回归（Negative Binomial Regression）**：[负二项分布](@entry_id:262151)是泊松分布的一个推广，它本身包含一个额外的参数来描述过度离散。其方差通常被建模为均值的二次函数，$\text{Var}(Y_t) = E(Y_t) + \alpha (E(Y_t))^2$。这是一种完全[参数化](@entry_id:265163)的、基于似然的方法，在流行病学计数数据分析中被广泛应用。

因此，一个用于[分析流行病学](@entry_id:178115)计数时间序列的稳健模型，不仅需要包含控制趋势和季节性的项，还应采用负二项或准泊松分布来恰当处理[过度离散](@entry_id:263748)问题。

### 时间分析中的混杂与可识别性

在利用[时间序列数据](@entry_id:262935)进行病因推断时，时间本身会引入独特的混杂和可识别性问题。

#### 季节性混杂

在环境流行病学的时间序列研究中，一个核心挑战是**季节性混杂（seasonal confounding）** 。当一个季节性变化的环境暴露（如冬季较高的空气污染PM$_{2.5}$水平）和一个同样具有季节性模式的健康结局（如冬季高发的心血管病急诊入院）被研究时，就会出现这个问题。

在这种情况下，“季节”本身扮演了[混杂变量](@entry_id:199777)的角色。它与暴露（PM$_{2.5}$）和结局（心血管入院）都相关。如果在回归模型中只包含暴露 $X_t$ 来预测结局 $Y_t$，而不对共同的季节性模式进行调整，那么观察到的 $X_t$ 和 $Y_t$ 之间的关联可能完全或部分是虚假的。这种虚假关联仅仅反映了两者都碰巧在同一季节达到高峰或低谷。为了得到暴露的真实因果效应，必须在模型中**充分控制时间**，即加入灵活的函数（如[样条](@entry_id:143749)或[谐波](@entry_id:170943)项）来对季节性和长期趋势进行建模。只有这样，估计出的暴露效应才是剔除了季节性混杂影响后的净效应。

#### 年龄-时期-队列（APC）可识别性问题

在分析跨越多年的年龄别发病率数据时，研究者往往希望区分三种时间效应：
-   **年龄效应（Age effects）**：与生理[老化](@entry_id:198459)、风险因素累积暴露等相关的风险变化。
-   **时期效应（Period effects）**：影响所有年龄组在同一日历时期（period）的风险因素，如新的疗法问世、大规模筛查项目或环境灾难。这与我们之前讨论的长期趋势密切相关。
-   **队列效应（Cohort effects）**：影响在同一年份出生（birth cohort）的一整代人的风险因素，如童年时期的营养状况、疫苗接种政策或早期生活暴露。

这三个时间维度由一个确切的线性关系所束缚：**时期 = 年龄 + 出生队列** ($P = A + C$)。这种完美的[共线性](@entry_id:270224)导致了所谓的**APC可识别性问题**：在标准的线性或[广义线性模型](@entry_id:171019)中，不可能从数据中唯一地分离出这三个效应的线性趋势部分 。例如，一个观察到的发病率[线性增长](@entry_id:157553)，可以被解释为时期效应（所有人的风险随时间增加）、年龄效应（风险随年龄增长）或队列效应（后出生队列的风险更高），或者这三者的任意[线性组合](@entry_id:155091)。

这个问题是数学上的，而非统计上的，因此增加样本量或延长观察时间无法解决。任何声称无需约束就能唯一识别APC效应的方法都存在谬误。有效的解决方案必须承认这一内在局限性，并采用明确的策略来获得一个可解释的模型 ：
-   **约束法**：对三个效应中的一个或两个施加约束。例如，可以假设队列效应没有线性趋势，或假设时期效应的线性趋势为零。这样得到的解是可识别的，但必须明确，效应的线性趋势部分是约束的产物，而不是数据的直接反映。
-   **正则化/贝叶斯方法**：通过对效应的非线性部分（即曲率，或二阶差分）施加先验分布，可以稳健地估计这些可识别的成分。例如，贝叶斯模型可以惩罚效应曲线的剧烈弯曲，从而平滑地估计年龄、时期和队列的曲率模式。然而，对于不可识别的线性趋势部分，其估计结果仍将由先验设定或外加约束决定。

理解APC问题提醒我们，在试图从监测数据中 disentangle 复杂的时间动态时，必须对模型的内在假设和局限性保持审慎。