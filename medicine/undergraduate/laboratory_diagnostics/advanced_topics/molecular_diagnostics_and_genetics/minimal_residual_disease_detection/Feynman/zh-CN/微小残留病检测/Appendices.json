{
    "hands_on_practices": [
        {
            "introduction": "实时定量PCR（qPCR）是分子水平MRD检测的基石技术之一。然而，要从原始荧光信号中获得精确的癌细胞数量，我们必须首先通过已知浓度的标准品来校准检测系统。本练习将指导你如何利用标准曲线数据，推导出PCR扩增效率（$E$）这一关键参数，它直接决定了MRD定量的准确性与可靠性。",
            "id": "5231553",
            "problem": "在微小残留病（MRD）的实验室诊断中，实时定量聚合酶链式反应（qPCR）通过将患者样本的循环阈值与由已知标准品构建的校准曲线进行比较，来推断样本中的初始目标拷贝数。假设以下基本事实：在qPCR中，目标扩增子群体每个循环以一个恒定因子倍增，荧光阈值在不同运行中是固定的，而循环阈值 $C_t$ 是累积的扩增子首次超过该固定阈值的循环数。对一个每个反应中具有已知初始目标拷贝数 $N_0$ 的标准品进行了十倍系列稀释，并进行了三次重复实验，得到了以下平均校准数据（本练习中每个稀释度只给出一个值）：\n\n- $N_0$：$1.00 \\times 10^5$, $1.00 \\times 10^4$, $1.00 \\times 10^3$, $1.00 \\times 10^2$, $1.00 \\times 10^1$\n- $C_t$：$16.50$, $19.95$, $23.40$, $26.85$, $30.30$\n\n从指数扩增模型和固定荧光阈值下 $C_t$ 的定义出发，推导出 $C_t$ 与 $\\log_{10}(N_0)$ 之间的线性关系，并用每循环效率 $E$ 表示斜率 $m$。然后，利用给定的校准数据，通过最小二乘法线性回归计算 $C_t$ 相对于 $\\log_{10}(N_0)$ 的最佳拟合斜率 $m$，再使用你推导的关系式计算qPCR效率 $E$，并将最终的 $E$ 值四舍五入至四位有效数字。将最终效率表示为小数形式（不要使用百分号）。",
            "solution": "该问题是有效的，因为它科学上基于实时定量PCR（qPCR）的原理，提法明确且数据充分，可得出唯一解，并以客观、正式的语言表述。我们可以开始解题。\n\n第一步是推导循环阈值 $C_t$ 和初始目标分子数 $N_0$ 之间的理论关系。qPCR中目标DNA的扩增遵循指数模型。设 $N_c$ 为经过 $c$ 个循环后的目标分子数。如果 $N_0$ 是初始分子数，而 $E$ 是每循环扩增效率（其中 $0 \\le E \\le 1$），则经过 $c$ 个循环后的分子数由下式给出：\n$$N_c = N_0 (1+E)^c$$\n在此方程中，效率 $E=1$ 对应于产物在每个循环中的完美倍增。\n\n循环阈值 $C_t$ 定义为荧光信号（与扩增的DNA量成正比）穿过一个固定阈值时的分数循环数。设 $N_T$ 为穿过此荧光阈值所需的DNA分子数。在循环阈值处，即 $c=C_t$ 时，我们有 $N_{C_t} = N_T$。将此代入扩增方程：\n$$N_T = N_0 (1+E)^{C_t}$$\n为了建立 $C_t$ 与 $N_0$ 之间的关系，我们重新整理此方程。首先，我们分离出包含 $C_t$ 的项：\n$$\\frac{N_T}{N_0} = (1+E)^{C_t}$$\n接下来，我们对两边取以10为底的对数，因为题目要求建立与 $\\log_{10}(N_0)$ 的关系：\n$$\\log_{10}\\left(\\frac{N_T}{N_0}\\right) = \\log_{10}\\left((1+E)^{C_t}\\right)$$\n利用对数的性质 $\\log(a/b) = \\log(a) - \\log(b)$ 和 $\\log(a^b) = b\\log(a)$，我们得到：\n$$\\log_{10}(N_T) - \\log_{10}(N_0) = C_t \\log_{10}(1+E)$$\n现在，我们解出 $C_t$：\n$$C_t = \\frac{\\log_{10}(N_T) - \\log_{10}(N_0)}{\\log_{10}(1+E)}$$\n这可以写成线性方程 $y = mx + b$ 的形式，其中 $y = C_t$，$x = \\log_{10}(N_0)$：\n$$C_t = \\left(-\\frac{1}{\\log_{10}(1+E)}\\right) \\log_{10}(N_0) + \\left(\\frac{\\log_{10}(N_T)}{\\log_{10}(1+E)}\\right)$$\n从这个推导出的形式中，我们可以识别出 $C_t$ 相对于 $\\log_{10}(N_0)$ 的直线斜率 $m$：\n$$m = -\\frac{1}{\\log_{10}(1+E)}$$\n这就完成了问题的第一部分。\n\n第二部分是使用提供的实验数据计算最佳拟合斜率 $m$。我们将使用最小二乘法线性回归直线的斜率公式。设我们的数据点为 $(x_i, y_i)$，其中 $x_i = \\log_{10}(N_{0,i})$ 且 $y_i = C_{t,i}$。数据点数量为 $n=5$。\n\n数据如下：\n- $N_0$：$1.00 \\times 10^5, 1.00 \\times 10^4, 1.00 \\times 10^3, 1.00 \\times 10^2, 1.00 \\times 10^1$\n- $x = \\log_{10}(N_0)$：$5, 4, 3, 2, 1$\n- $y = C_t$：$16.50, 19.95, 23.40, 26.85, 30.30$\n\n斜率 $m$ 的公式是：\n$$m = \\frac{n(\\sum_{i=1}^{n} x_i y_i) - (\\sum_{i=1}^{n} x_i)(\\sum_{i=1}^{n} y_i)}{n(\\sum_{i=1}^{n} x_i^2) - (\\sum_{i=1}^{n} x_i)^2}$$\n我们计算必要的总和：\n$$ \\sum_{i=1}^{5} x_i = 5 + 4 + 3 + 2 + 1 = 15 $$\n$$ \\sum_{i=1}^{5} y_i = 16.50 + 19.95 + 23.40 + 26.85 + 30.30 = 117.00 $$\n$$ \\sum_{i=1}^{5} x_i^2 = 5^2 + 4^2 + 3^2 + 2^2 + 1^2 = 25 + 16 + 9 + 4 + 1 = 55 $$\n$$ \\sum_{i=1}^{5} x_i y_i = (5)(16.50) + (4)(19.95) + (3)(23.40) + (2)(26.85) + (1)(30.30) $$\n$$ \\sum_{i=1}^{5} x_i y_i = 82.50 + 79.80 + 70.20 + 53.70 + 30.30 = 316.50 $$\n现在，我们将这些总和代入 $m$ 的公式中：\n$$ m = \\frac{5(316.50) - (15)(117.00)}{5(55) - (15)^2} = \\frac{1582.5 - 1755}{275 - 225} = \\frac{-172.5}{50} = -3.45 $$\n校准曲线的最佳拟合斜率是 $m = -3.45$。\n\n最后，我们使用推导出的 $m$ 和 $E$ 之间的关系来计算qPCR效率。\n$$ m = -3.45 = -\\frac{1}{\\log_{10}(1+E)} $$\n解出 $\\log_{10}(1+E)$：\n$$ \\log_{10}(1+E) = \\frac{-1}{m} = \\frac{-1}{-3.45} = \\frac{1}{3.45} $$\n为了求出 $E$，我们首先取反对数（10的幂）：\n$$ 1+E = 10^{(1/3.45)} $$\n然后，我们解出 $E$：\n$$ E = 10^{(1/3.45)} - 1 $$\n现在我们计算数值：\n$$ \\frac{1}{3.45} \\approx 0.28985507 $$\n$$ 1+E \\approx 10^{0.28985507} \\approx 1.94916005 $$\n$$ E \\approx 1.94916005 - 1 = 0.94916005 $$\n题目要求将最终的 $E$ 值四舍五入至四位有效数字。\n$$ E \\approx 0.9492 $$\nqPCR效率大约是 $0.9492$，即 $94.92\\%$。",
            "answer": "$$\\boxed{0.9492}$$"
        },
        {
            "introduction": "在学会如何定量后，一个更根本的问题随之而来：为了有把握地发现那些极其罕见的残留癌细胞，我们到底需要分析多少细胞？本练习将带你深入MRD检测的统计学核心，通过将细胞抽样视为伯努利试验，你将学会如何计算达到特定检测灵敏度所需的最小样本量（$n$）。这是设计任何MRD检测方案前都必须回答的关键问题。",
            "id": "5231515",
            "problem": "一个临床实验室正在验证一种用于检测血液系统恶性肿瘤中微小残留病（MRD）的分析方法。假设在一个大的、充分混合的细胞群体中，每个独立检测的细胞是恶性细胞的概率为 $f$。该分析方法对于任何进入测量的恶性细胞都是分析上完美的（即，如果待测细胞组中存在恶性细胞，其被检测到的概率为 $1$），并且细胞是独立同分布（i.i.d.）采样的。将实验成功事件定义为在 $n$ 个被检测的细胞中观察到至少一个恶性细胞。实验室要求，当恶性细胞比例为 $f$ 时，实验成功的置信度为 $1-\\alpha$。\n\n从伯努利试验模型和零次成功概率的定义出发，推导出一个关于 $n$（用 $f$ 和 $\\alpha$ 表示）的明确条件，该条件能够保证所需的置信度，且不使用任何专门针对MRD的简化公式。然后，使用小 $f$ 极限下的一阶近似，获得一个易于处理的闭式近似解，确定满足目标比例 $f = 1.0 \\times 10^{-5}$ 和置信度参数 $\\alpha = 0.05$ 的精确条件的最小整数 $n$。如果在中间步骤中使用了任何近似，请验证您最终的 $n$ 满足从第一性原理推导出的精确条件。\n\n将最终结果表示为所需检测的最小整数细胞数。不要四舍五入到指定的有效数字位数；报告在精确的伯努利模型下保证所需置信度的最小整数 $n$。",
            "solution": "此MRD检测任务的基础概率模型是伯努利试验框架。每个被检测的细胞都是一次独立的试验，其为恶性（即“成功”）的概率为 $f$。设 $X$ 为 $n$ 个被检测细胞中的恶性细胞数量。在独立且成功概率恒为 $f$ 的条件下，$X$ 的分布是二项分布：\n$$\nX \\sim \\mathrm{Binomial}(n, f).\n$$\n样本中没有恶性细胞的概率，即 $n$ 次伯努利试验中零次成功的概率，由下式给出\n$$\n\\mathbb{P}(X=0) = (1 - f)^{n}.\n$$\n分析方法检测到MRD的事件（在假设对任何存在的恶性细胞都具有完美分析检测能力的前提下）是 $n$ 个被检测细胞中包含至少一个恶性细胞的事件，即 $X \\geq 1$。根据补集法则，\n$$\n\\mathbb{P}(X \\geq 1) = 1 - \\mathbb{P}(X=0) = 1 - (1 - f)^{n}.\n$$\n实验室要求这个概率至少为 $1 - \\alpha$，这导出了不等式\n$$\n1 - (1 - f)^{n} \\geq 1 - \\alpha \\quad \\Longleftrightarrow \\quad (1 - f)^{n} \\leq \\alpha.\n$$\n对两边取自然对数。因为对于 $0  f  1$，有 $0  1 - f  1$，所以 $\\ln(1 - f)  0$；又因为 $0  \\alpha  1$，所以 $\\ln(\\alpha)  0$。在小心处理除以负数的情况时，应用 $\\ln$ 运算并不改变不等式方向：\n$$\nn \\ln(1 - f) \\leq \\ln(\\alpha).\n$$\n由于 $\\ln(1 - f)  0$，两边同时除以 $\\ln(1 - f)$ 会使不等号反向，从而得到精确的充要条件\n$$\nn \\geq \\frac{\\ln(\\alpha)}{\\ln(1 - f)}.\n$$\n该表达式给出了在给定的 $f$ 和 $\\alpha$ 下，达到所需置信度的最小实数值 $n$。因为 $n$ 必须是被检测细胞的整数数量，所以最小整数为\n$$\nn_{\\min} = \\left\\lceil \\frac{\\ln(\\alpha)}{\\ln(1 - f)} \\right\\rceil,\n$$\n其中 $\\lceil \\cdot \\rceil$ 表示向上取整函数。\n\n为了在 $f$ 很小时获得一个易于处理的闭式近似，我们使用自然对数在 $0$ 附近的一阶泰勒展开：\n$$\n\\ln(1 - f) = -f - \\frac{f^{2}}{2} - \\frac{f^{3}}{3} - \\cdots \\approx -f \\quad \\text{for small } f.\n$$\n将此代入精确条件，得到广泛使用的小 $f$ 近似\n$$\nn \\approx -\\frac{\\ln(\\alpha)}{f}.\n$$\n现在将这些结果应用于指定值 $f = 1.0 \\times 10^{-5}$ 和 $\\alpha = 0.05$。\n\n首先计算精确的实数值阈值：\n$$\nn_{\\ast} = \\frac{\\ln(0.05)}{\\ln(1 - 1.0 \\times 10^{-5})}.\n$$\n我们对分子和分母进行数值计算：\n$$\n\\ln(0.05) = -2.995732273553991\\ldots,\n$$\n$$\n\\ln(1 - 1.0 \\times 10^{-5}) = \\ln(0.99999) = -1.0000050000333335 \\times 10^{-5}\\ldots\n$$\n因此，\n$$\nn_{\\ast} = \\frac{-2.995732273553991\\ldots}{-1.0000050000333335 \\times 10^{-5}} \\approx 299\\,571.729\\ldots\n$$\n因此，满足精确二项条件的最小整数是\n$$\nn_{\\min} = \\lceil 299\\,571.729\\ldots \\rceil = 299\\,572.\n$$\n\n为了交叉验证，小 $f$ 近似给出的结果是\n$$\nn_{\\text{approx}} = -\\frac{\\ln(0.05)}{1.0 \\times 10^{-5}} \\approx 299\\,573.227\\ldots,\n$$\n这个值略大（偏于保守），这是因为对于 $f  0$，一阶近似 $\\ln(1 - f) \\approx -f$ 满足 $|\\ln(1 - f)|  f$。验证 $n = 299\\,572$ 确实满足精确条件：\n$$\n(1 - f)^{n} = (1 - 1.0 \\times 10^{-5})^{299\\,572} = \\exp\\!\\big(n \\ln(1 - f)\\big) \\approx \\exp\\!\\big(299\\,572 \\cdot (-1.0000050000333335 \\times 10^{-5})\\big) \\approx \\exp(-2.995747) \\approx 0.0500\\ldots \\leq 0.05,\n$$\n这证实了 $n = 299\\,572$ 满足 $(1 - f)^{n} \\leq \\alpha$，因此在精确的伯努利模型下保证了 $1 - \\alpha$ 的置信度。\n\n所要求的最终结果是被检测细胞的最小整数数量。",
            "answer": "$$\\boxed{299572}$$"
        },
        {
            "introduction": "MRD检测的最大价值在于其动态监测能力。这个综合性练习模拟了一个真实的临床情景：你将对一位患者的纵向MRD数据进行建模，估算其衰减速率，并利用该模型预测未来的复发风险。这个实践不仅将定量分析与统计建模融为一体，展示了MRD数据如何直接指导临床决策，还让你掌握了实用的编程技能。",
            "id": "5231541",
            "problem": "给定一个用于实验室诊断中微小残留病 (MRD) 的测量模型。微小残留病 (MRD) 是指治疗后残留的恶性细胞的比例，在有效治疗下，其通常被建模为随时间呈指数衰减。假设真实的潜在 MRD 比例遵循指数衰减，并且测量值在自然对数尺度上受到独立的加性高斯噪声的影响。形式上，对于以天为单位的观测时间 $t_i$ 和测量的 MRD 比例 $y_i$（无量纲小数），该模型为\n$$\n\\ln(y_i) = a - k t_i + \\varepsilon_i,\n$$\n其中 $a = \\ln(y_0)$ 是初始 MRD 比例的对数，$k$ 是单位为 天$^{-1}$ 的衰减率（如果 MRD 增加，则 $k$ 可能为负），$\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$ 是独立同分布的高斯误差。\n\n从高斯似然和指数衰减模型的核心定义出发，在 $\\ln(y_i)$ 上存在独立高斯噪声的假设下，推导出 $a$、$k$ 和 $\\sigma^2$ 的最大似然估计量。然后，使用这些估计量计算在未来时间 $t_{\\mathrm{future}}$ 的复发风险，该风险定义为下一次观测到的 MRD 测量值超过临床阈值 $y_{\\mathrm{thr}}$ 的概率，即\n$$\n\\text{risk} = \\mathbb{P} \\left( \\ln(Y_{\\mathrm{future}})  \\ln(y_{\\mathrm{thr}}) \\right),\n$$\n其中 $Y_{\\mathrm{future}}$ 表示在时间 $t_{\\mathrm{future}}$ 观测到的未来 MRD 值。在高斯噪声假设下，$\\ln(Y_{\\mathrm{future}})$ 的预测分布是正态分布，其均值为 $\\hat{\\mu} = \\hat{a} - \\hat{k} \\, t_{\\mathrm{future}}$，方差为 $\\hat{\\sigma}^2$。因此，请用标准正态分布的累积分布函数来表示该风险。在构建预测分布时，假设误差独立，并忽略参数估计的不确定性。\n\n你的任务是编写一个完整、可运行的程序，该程序能够：\n- 根据数据 $\\{(t_i,y_i)\\}_{i=1}^n$ 实现 $a$、$k$ 和 $\\sigma^2$ 的最大似然估计。\n- 使用关于 $\\ln(Y_{\\mathrm{future}})$ 的预测正态模型，计算在给定阈值 $y_{\\mathrm{thr}}$ 下，于 $t_{\\mathrm{future}}$ 时的复发风险。\n- 处理 $\\hat{\\sigma} = 0$ 的边缘情况，此时返回一个确定性风险：如果 $\\hat{\\mu}  \\ln(y_{\\mathrm{thr}})$，则为 $1$，否则为 $0$。\n\n物理单位和数值要求：\n- 时间 $t_i$ 和 $t_{\\mathrm{future}}$ 必须以天为单位处理。\n- MRD 比例 $y_i$ 和 $y_{\\mathrm{thr}}$ 必须作为无量纲小数（而非百分比）处理。\n- 程序必须以浮点小数形式输出复发风险值，并四舍五入到六位小数。\n\n测试套件：\n使用以下四个测试用例，每个用例是一个元组 $(\\text{times}, \\text{observed MRD fractions}, t_{\\mathrm{future}}, y_{\\mathrm{thr}})$：\n1. 用例 A（一般衰减，中度噪声）：时间 $[0,30,60,90]$，MRD 比例 $[0.0105,0.0060,0.0028,0.0017]$，$t_{\\mathrm{future}}=120$，$y_{\\mathrm{thr}}=0.0010$。\n2. 用例 B（两点构成的边界情况，产生近乎确定性的拟合）：时间 $[0,60]$，MRD 比例 $[0.0010,0.0009]$，$t_{\\mathrm{future}}=30$，$y_{\\mathrm{thr}}=0.0008$。\n3. 用例 C（MRD 上升，预示潜在复发）：时间 $[0,30,60,90]$，MRD 比例 $[0.0008,0.0010,0.0014,0.0022]$，$t_{\\mathrm{future}}=120$，$y_{\\mathrm{thr}}=0.0015$。\n4. 用例 D（接近检测极限，高噪声）：时间 $[0,90,180]$，MRD 比例 $[0.000010,0.000012,0.000009]$，$t_{\\mathrm{future}}=270$，$y_{\\mathrm{thr}}=0.000010$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4]”）。每个结果必须是对应测试用例的复发风险，并四舍五入到六位小数。",
            "solution": "该问题要求推导一个指数衰减模型的参数的最大似然估计量 (MLEs)，该模型在测量数量的对数上具有加性高斯噪声，并随后应用这些估计量来计算复发风险概率。\n\n在时间 $t_i$ 测得的微小残留病 (MRD) 比例 $y_i$ 的模型由下式给出\n$$\n\\ln(y_i) = a - k t_i + \\varepsilon_i\n$$\n其中 $a = \\ln(y_0)$ 是初始 MRD 比例的对数，$k$ 是衰减率，$\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$ 是独立同分布 (i.i.d.) 的高斯误差。\n\n为简化表示，令 $z_i = \\ln(y_i)$。该模型可以表示为 $z_i$ 关于 $t_i$ 的简单线性回归：\n$$\nz_i = a - k t_i + \\varepsilon_i\n$$\n需要估计的参数是截距 $a$、速率 $k$ 和误差方差 $\\sigma^2$。\n\n**1. $a$ 和 $k$ 的最大似然估计**\n\n对于单个观测值 $z_i$，给定参数的概率密度函数 (PDF) 是一个均值为 $\\mu_i = a - k t_i$、方差为 $\\sigma^2$ 的正态分布：\n$$\nf(z_i | a, k, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left( -\\frac{(z_i - (a - k t_i))^2}{2\\sigma^2} \\right)\n$$\n假设 $n$ 个观测值是独立的，整个数据集 $\\{ (t_i, z_i) \\}_{i=1}^n$ 的似然函数 $L$ 是各个 PDF 的乘积：\n$$\nL(a, k, \\sigma^2) = \\prod_{i=1}^{n} f(z_i | a, k, \\sigma^2) = \\left( \\frac{1}{2\\pi\\sigma^2} \\right)^{n/2} \\exp\\left( -\\frac{1}{2\\sigma^2} \\sum_{i=1}^{n} (z_i - a + k t_i)^2 \\right)\n$$\n最大化似然函数等同于最大化其自然对数，即对数似然函数 $\\ell = \\ln(L)$：\n$$\n\\ell(a, k, \\sigma^2) = -\\frac{n}{2} \\ln(2\\pi) - \\frac{n}{2} \\ln(\\sigma^2) - \\frac{1}{2\\sigma^2} \\sum_{i=1}^{n} (z_i - a + k t_i)^2\n$$\n为了找到 $a$ 和 $k$ 的最大似然估计量，我们将 $\\ell$ 分别对 $a$ 和 $k$求偏导数，并令其等于零。这等同于最小化误差平方和（或残差平方和）$S(a, k) = \\sum_{i=1}^{n} (z_i - a + k t_i)^2$。\n$$\n\\frac{\\partial S}{\\partial a} = \\sum_{i=1}^{n} 2(z_i - a + k t_i)(-1) = -2\\left(\\sum_{i=1}^{n} z_i - na + k\\sum_{i=1}^{n} t_i\\right) = 0\n$$\n$$\n\\frac{\\partial S}{\\partial k} = \\sum_{i=1}^{n} 2(z_i - a + k t_i)(t_i) = 2\\left(\\sum_{i=1}^{n} z_i t_i - a\\sum_{i=1}^{n} t_i + k\\sum_{i=1}^{n} t_i^2\\right) = 0\n$$\n由此可得估计量 $\\hat{a}$ 和 $\\hat{k}$ 的正规方程：\n$$\n\\sum z_i - n\\hat{a} + \\hat{k}\\sum t_i = 0\n$$\n$$\n\\sum z_i t_i - \\hat{a}\\sum t_i + \\hat{k}\\sum t_i^2 = 0\n$$\n根据第一个方程，定义样本均值 $\\bar{t} = \\frac{1}{n}\\sum t_i$ 和 $\\bar{z} = \\frac{1}{n}\\sum z_i$：\n$$\nn\\bar{z} - n\\hat{a} + n\\hat{k}\\bar{t} = 0 \\implies \\hat{a} = \\bar{z} + \\hat{k}\\bar{t}\n$$\n将 $\\hat{a}$ 的这个表达式代入第二个正规方程，可得 $\\hat{k}$ 的解：\n$$\n\\sum z_i t_i - (\\bar{z} + \\hat{k}\\bar{t})\\sum t_i + \\hat{k}\\sum t_i^2 = 0\n$$\n$$\n\\hat{k}\\left(\\sum t_i^2 - \\bar{t}\\sum t_i\\right) = \\sum z_i t_i - \\bar{z}\\sum t_i\n$$\n注意到 $\\sum t_i^2 - \\bar{t}\\sum t_i = \\sum (t_i - \\bar{t})^2$ 以及 $\\sum z_i t_i - \\bar{z}\\sum t_i = \\sum (z_i - \\bar{z})(t_i-\\bar{t})$，我们得到：\n$$\n\\hat{k} = \\frac{\\sum (z_i - \\bar{z})(t_i - \\bar{t})}{\\sum (t_i - \\bar{t})^2}\n$$\n注意，在传统的线性模型 $z_i = \\beta_0 + \\beta_1 t_i$ 中，斜率为 $\\beta_1$。这里，$t_i$ 的系数是 $-k$，所以 $\\beta_1 = -k$。斜率的标准普通最小二乘法 (OLS) 估计量是 $\\hat{\\beta}_1 = \\frac{\\sum (t_i - \\bar{t})(z_i - \\bar{z})}{\\sum (t_i - \\bar{t})^2}$。因此，$k$ 的最大似然估计量为：\n$$\n\\hat{k} = - \\frac{\\sum_{i=1}^{n} (t_i - \\bar{t})(z_i - \\bar{z})}{\\sum_{i=1}^{n} (t_i - \\bar{t})^2}\n$$\n而 $a$ 的最大似然估计量为：\n$$\n\\hat{a} = \\bar{z} - (-\\hat{k})\\bar{t} = \\bar{z} + \\hat{k}\\bar{t}\n$$\n\n**2. $\\sigma^2$ 的最大似然估计**\n\n为了找到 $\\sigma^2$ 的最大似然估计量，我们将对数似然函数 $\\ell$ 对 $\\sigma^2$ 求导，并令导数等于零，同时代入最大似然估计量 $\\hat{a}$ 和 $\\hat{k}$：\n$$\n\\frac{\\partial \\ell}{\\partial(\\sigma^2)} = -\\frac{n}{2\\sigma^2} + \\frac{1}{2(\\sigma^2)^2} \\sum_{i=1}^{n} (z_i - a + k t_i)^2 = 0\n$$\n$$\n-\\frac{n}{2\\hat{\\sigma}^2} + \\frac{1}{2(\\hat{\\sigma}^2)^2} \\sum_{i=1}^{n} (z_i - \\hat{a} + \\hat{k} t_i)^2 = 0\n$$\n求解 $\\hat{\\sigma}^2$：\n$$\n\\hat{\\sigma}^2 = \\frac{1}{n} \\sum_{i=1}^{n} (z_i - (\\hat{a} - \\hat{k} t_i))^2\n$$\n这是残差平方的均值。\n\n**3. 复发风险计算**\n\n在未来时间 $t_{\\mathrm{future}}$ 的复发风险定义为未来测量值 $Y_{\\mathrm{future}}$ 超过阈值 $y_{\\mathrm{thr}}$ 的概率：\n$$\n\\text{risk} = \\mathbb{P} \\left( \\ln(Y_{\\mathrm{future}})  \\ln(y_{\\mathrm{thr}}) \\right)\n$$\n问题指出，$\\ln(Y_{\\mathrm{future}})$ 的预测分布是正态分布，其均值由回归线给出，方差由估计的误差方差给出（忽略参数不确定性）：\n$$\n\\ln(Y_{\\mathrm{future}}) \\sim \\mathcal{N}(\\hat{\\mu}, \\hat{\\sigma}^2)\n$$\n其中 $\\hat{\\mu} = \\hat{a} - \\hat{k} t_{\\mathrm{future}}$ 且 $\\hat{\\sigma}^2$ 是上文推导出的最大似然估计量。令 $Z_{\\mathrm{future}} = \\ln(Y_{\\mathrm{future}})$ 和 $z_{\\mathrm{thr}} = \\ln(y_{\\mathrm{thr}})$。我们需要计算 $\\mathbb{P}(Z_{\\mathrm{future}}  z_{\\mathrm{thr}})$。\n\n为了评估这个概率，我们对随机变量 $Z_{\\mathrm{future}}$ 进行标准化。令 $W = (Z_{\\mathrm{future}} - \\hat{\\mu})/\\hat{\\sigma}$，它服从标准正态分布 $\\mathcal{N}(0,1)$。该概率变为：\n$$\n\\text{risk} = \\mathbb{P}\\left( \\frac{Z_{\\mathrm{future}} - \\hat{\\mu}}{\\hat{\\sigma}}  \\frac{z_{\\mathrm{thr}} - \\hat{\\mu}}{\\hat{\\sigma}} \\right) = \\mathbb{P}\\left( W  \\frac{z_{\\mathrm{thr}} - \\hat{\\mu}}{\\hat{\\sigma}} \\right)\n$$\n设 $\\Phi(\\cdot)$ 为标准正态分布的累积分布函数 (CDF)。那么 $\\mathbb{P}(W  x) = 1 - \\mathbb{P}(W \\le x) = 1 - \\Phi(x)$。因此，风险为：\n$$\n\\text{risk} = 1 - \\Phi\\left( \\frac{\\ln(y_{\\mathrm{thr}}) - (\\hat{a} - \\hat{k} t_{\\mathrm{future}})}{\\hat{\\sigma}} \\right)\n$$\n在 $\\hat{\\sigma} = 0$ 的特殊情况下，预测分布是在 $\\hat{\\mu}$ 处的一个点质量。概率是确定性的：如果 $\\hat{\\mu}  \\ln(y_{\\mathrm{thr}})$，风险为 $1$；否则为 $0$。当数据点完美地落在一条直线上时（例如，当有 $n=2$ 个观测值时），就会发生这种情况。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Implements the full solution pipeline for MRD relapse risk calculation.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (times, observed MRD fractions, t_future, y_thr)\n    test_cases = [\n        # Case A (general decay, moderate noise)\n        (\n            [0, 30, 60, 90],\n            [0.0105, 0.0060, 0.0028, 0.0017],\n            120,\n            0.0010,\n        ),\n        # Case B (boundary with two points yielding near-deterministic fit)\n        (\n            [0, 60],\n            [0.0010, 0.0009],\n            30,\n            0.0008,\n        ),\n        # Case C (rising MRD indicating potential relapse)\n        (\n            [0, 30, 60, 90],\n            [0.0008, 0.0010, 0.0014, 0.0022],\n            120,\n            0.0015,\n        ),\n        # Case D (near detection limit, high noise)\n        (\n            [0, 90, 180],\n            [0.000010, 0.000012, 0.000009],\n            270,\n            0.000010,\n        ),\n    ]\n\n    results = []\n    for case in test_cases:\n        times, mrd_fractions, t_future, y_thr = case\n\n        # Convert to numpy arrays for vectorized calculations\n        t = np.array(times, dtype=np.float64)\n        y = np.array(mrd_fractions, dtype=np.float64)\n        \n        # Transform the model to a linear form: z = a - k*t\n        # where z = ln(y)\n        z = np.log(y)\n        n = len(t)\n        \n        # Calculate maximum likelihood estimators for a, k, and sigma^2\n        # These are equivalent to ordinary least squares (OLS) estimators\n        \n        # Calculate sample means\n        t_mean = np.mean(t)\n        z_mean = np.mean(z)\n        \n        # Calculate k_hat\n        # Using the covariance/variance formula for the slope of the regression of z on t\n        # The slope is -k.\n        # Handle the case where var_t is zero to avoid division by zero,\n        # although this won't happen for the given test cases.\n        var_t = np.sum((t - t_mean)**2)\n        if np.isclose(var_t, 0):\n             # When all time points are the same, k is undefined.\n             # This scenario is not physically meaningful for this problem.\n             # We can set k to 0 and proceed, as there's no trend.\n            k_hat = 0.0\n        else:\n            cov_tz = np.sum((t - t_mean) * (z - z_mean))\n            k_hat = -cov_tz / var_t\n\n        # Calculate a_hat\n        a_hat = z_mean + k_hat * t_mean\n        \n        # Calculate the predicted z values and residuals\n        z_predicted = a_hat - k_hat * t\n        residuals = z - z_predicted\n        \n        # Calculate sigma_hat (MLE for standard deviation)\n        # The MLE for variance is the mean of squared residuals.\n        sigma_sq_hat = np.mean(residuals**2)\n        sigma_hat = np.sqrt(sigma_sq_hat)\n        \n        # Calculate the relapse risk\n        \n        # Predicted mean for ln(Y_future)\n        mu_hat_future = a_hat - k_hat * t_future\n        \n        # Log of the clinical threshold\n        z_thr = np.log(y_thr)\n        \n        # Handle edge case where sigma_hat is zero (perfect fit)\n        if np.isclose(sigma_hat, 0):\n            risk = 1.0 if mu_hat_future > z_thr else 0.0\n        else:\n            # Standardize the variable to use the standard normal CDF\n            arg = (z_thr - mu_hat_future) / sigma_hat\n            # The risk is P(Z > z_thr) = 1 - P(Z = z_thr)\n            # which is the survival function (sf) of the normal distribution.\n            risk = norm.sf(arg)\n\n        results.append(f\"{risk:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}