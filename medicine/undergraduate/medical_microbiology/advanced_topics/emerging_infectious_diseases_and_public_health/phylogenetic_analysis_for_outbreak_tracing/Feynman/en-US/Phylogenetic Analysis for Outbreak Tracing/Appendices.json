{
    "hands_on_practices": [
        {
            "introduction": "The foundation of phylogenetic outbreak tracing is the pairwise genetic distance between pathogen genomes. However, observed distances are not always the true evolutionary distances due to technical artifacts like sequencing or alignment errors. This exercise guides you through a first-principles derivation to understand how a constant, per-base error rate $\\epsilon$ can systematically inflate the observed distance, providing a crucial lesson in data quality and its impact on inference . Mastering this concept helps build a critical eye for the data that underpins any phylogenetic conclusion.",
            "id": "4661470",
            "problem": "A hospital is investigating a cluster of infections caused by a bacterial pathogen using Whole Genome Sequencing (WGS). For outbreak tracing, a common approach is to compute the pairwise Hamming distance between two patient isolates across $L$ aligned genomic sites, defined as the fraction of sites at which the two sequences differ. Let the true mismatch fraction be $d_{\\text{true}} \\in [0,1]$, representing the proportion of sites that are genuinely different due to evolution, not technical artifacts. Suppose the alignment pipeline introduces a per-base alignment error at rate $\\epsilon \\in (0,1)$ in each sequence independently. Assume the following independence and small-error regime:\n\n- Errors at a site occur independently in the two sequences with probability $\\epsilon$ per sequence.\n- When a site is truly matching between the two sequences, any error in one sequence at that site yields an observed mismatch at that site.\n- Errors are rare enough that events involving two simultaneous errors at the same site are of order $\\epsilon^{2}$ and can be neglected in a first-order approximation.\n- Errors at truly mismatching sites do not restore matches to first order.\n\nUsing the law of total probability and the definition of pairwise Hamming distance, derive an approximate expression for the expected observed pairwise mismatch fraction $d_{\\text{obs}}$ as a function of $d_{\\text{true}}$ and $\\epsilon$ under these assumptions. Express your final answer as a single simplified analytic expression. No numerical evaluation or rounding is required.",
            "solution": "The problem requires the derivation of an expression for the expected observed pairwise mismatch fraction, $d_{\\text{obs}}$, as a function of the true mismatch fraction, $d_{\\text{true}}$, and the per-base alignment error rate, $\\epsilon$. The derivation will be based on the law of total probability, applied to a single genomic site.\n\nLet us define the following events for a randomly selected site from the alignment:\n- $M$: The event that the site is an observed mismatch. The probability of this event, $P(M)$, is the quantity we seek, $d_{\\text{obs}}$.\n- $T^c$: The event that the site is a true mismatch (i.e., the nucleotides are genuinely different). The probability of this event is given as the true mismatch fraction, $P(T^c) = d_{\\text{true}}$.\n- $T$: The event that the site is a true match (i.e., the nucleotides are identical). This is the complement of $T^c$, so its probability is $P(T) = 1 - P(T^c) = 1 - d_{\\text{true}}$.\n\nAccording to the law of total probability, the probability of observing a mismatch can be expressed as:\n$$d_{\\text{obs}} = P(M) = P(M | T) P(T) + P(M | T^c) P(T^c)$$\nHere, $P(M|T)$ is the conditional probability of observing a mismatch given that the site is a true match, and $P(M|T^c)$ is the conditional probability of observing a mismatch given that the site is a true mismatch. We must now determine these conditional probabilities based on the problem's stated assumptions.\n\nFirst, let us analyze the case of a true match (event $T$). A mismatch will be observed if at least one of the two sequences has an alignment error at that site. Let $E_1$ be the event of an error in the first sequence at the site, and $E_2$ be the event of an error in the second sequence at the site. The problem states that errors occur independently in each sequence with probability $\\epsilon$. Thus, we have:\n- $P(E_1) = \\epsilon$\n- $P(E_2) = \\epsilon$\n- $P(E_1 \\cap E_2) = P(E_1)P(E_2) = \\epsilon^2$ due to independence.\n\nThe event of an observed mismatch, given a true match, is the union of $E_1$ and $E_2$. The probability is:\n$$P(M|T) = P(E_1 \\cup E_2) = P(E_1) + P(E_2) - P(E_1 \\cap E_2) = \\epsilon + \\epsilon - \\epsilon^2 = 2\\epsilon - \\epsilon^2$$\nThe problem specifies that we should neglect terms of order $\\epsilon^2$ in a first-order approximation. Therefore, we approximate this conditional probability as:\n$$P(M|T) \\approx 2\\epsilon$$\n\nSecond, let us analyze the case of a true mismatch (event $T^c$). In this scenario, the site is already different. An observed match would only occur if an error coincidentally changes one nucleotide to match the other. The problem states that \"Errors at truly mismatching sites do not restore matches to first order.\" This is a simplifying assumption that means the probability of an error event causing an observed match, given a true mismatch, is considered negligible (e.g., of order $\\epsilon$ or higher, but specifically ruled out of first-order effects that create mismatches). Thus, if a site is a true mismatch, it will be observed as a mismatch. This implies:\n$$P(M|T^c) \\approx 1$$\n\nNow we substitute these conditional probabilities back into the equation for the law of total probability:\n$$d_{\\text{obs}} \\approx (2\\epsilon)P(T) + (1)P(T^c)$$\nSubstituting the probabilities of $T$ and $T^c$:\n$$d_{\\text{obs}} \\approx 2\\epsilon (1 - d_{\\text{true}}) + 1 \\cdot d_{\\text{true}}$$\nExpanding and rearranging the terms gives the final expression:\n$$d_{\\text{obs}} \\approx 2\\epsilon - 2\\epsilon d_{\\text{true}} + d_{\\text{true}}$$\n$$d_{\\text{obs}} \\approx d_{\\text{true}} + 2\\epsilon (1 - d_{\\text{true}})$$\nThis expression relates the observed mismatch fraction to the true mismatch fraction and the alignment error rate, consistent with all the assumptions provided in the problem statement.",
            "answer": "$$\n\\boxed{d_{\\text{true}} + 2\\epsilon(1-d_{\\text{true}})}\n$$"
        },
        {
            "introduction": "Once we have a matrix of pairwise distances, the next step is to reconstruct the evolutionary relationships in the form of a phylogenetic tree. The Neighbor-Joining (NJ) algorithm is a powerful and widely used distance-based method for this task. This hands-on practice will take you through a complete, step-by-step execution of the NJ algorithm on a small dataset, demystifying the process of how a simple distance matrix is converted into a fully resolved tree with branch lengths . This skill is fundamental to creating the visual and quantitative framework for tracing an outbreak.",
            "id": "4661528",
            "problem": "A suspected hospital outbreak of a bacterial pathogen yields four whole-genome consensus sequences from patients, labeled $A$, $B$, $C$, and $D$. Pairwise genetic distances, corrected under the Jukesâ€“Cantor (JC) model of nucleotide substitution, are estimated in substitutions per site and compiled into the symmetric $4 \\times 4$ distance matrix $D$ below (zeros on the diagonal):\n$$\nD \\;=\\;\n\\begin{pmatrix}\n0  0.004  0.020  0.018 \\\\\n0.004  0  0.022  0.019 \\\\\n0.020  0.022  0  0.005 \\\\\n0.018  0.019  0.005  0\n\\end{pmatrix}.\n$$\nUsing first principles of phylogenetic distance-based inference, and without assuming any provided shortcut formulas, execute the Neighbor-Joining (NJ) algorithm to reconstruct the unrooted tree topology and branch lengths from $D$. After completing the reconstruction, compute the total tree length, defined as the sum of all branch lengths in the unrooted NJ tree. Express the final total branch length in substitutions per site and round your answer to four significant figures.",
            "solution": "The problem of reconstructing a phylogenetic tree from a distance matrix is a standard task in computational biology. The provided problem statement is valid.\n\n**Problem Validation:**\n1.  **Givens:** A symmetric $4 \\times 4$ pairwise distance matrix $D$ for four taxa $A$, $B$, $C$, and $D$ is provided. The task is to use the Neighbor-Joining (NJ) algorithm to find the unrooted tree topology and branch lengths, and then to calculate the total tree length.\n2.  **Scientific Grounding:** The problem is scientifically sound. The Neighbor-Joining algorithm is a cornerstone of distance-based phylogenetic inference. The use of Jukes-Cantor corrected distances is standard practice. The scenario of tracing a hospital outbreak is a primary application of this methodology.\n3.  **Well-Posedness:** The problem is well-posed. For any given distance matrix, the NJ algorithm yields a unique unrooted tree topology and a corresponding set of branch lengths. The problem is self-contained and free of contradictions.\n4.  **Verdict:** The problem is valid.\n\n**Solution using the Neighbor-Joining Algorithm:**\nThe Neighbor-Joining (NJ) algorithm is an agglomerative clustering method that iteratively joins pairs of taxa that are topological neighbors. The selection criterion is based on the principle of minimum evolution, which aims to find the tree with the smallest total branch length.\n\nThe initial set of taxa is $S = \\{A, B, C, D\\}$, so the number of taxa is $L = 4$. The distance matrix is:\n$$\nD \\;=\\;\n\\begin{pmatrix}\n0  0.004  0.020  0.018 \\\\\n0.004  0  0.022  0.019 \\\\\n0.020  0.022  0  0.005 \\\\\n0.018  0.019  0.005  0\n\\end{pmatrix}\n$$\n\n**Iteration 1: $L=4$ taxa**\n\n**Step 1: Compute the $Q$-matrix**\nFirst, for each taxon $i$, we compute its net divergence, $r_i$, which is the sum of its distances to all other taxa:\n$$r_i = \\sum_{k \\in S} d_{ik}$$\n$r_A = d_{AB} + d_{AC} + d_{AD} = 0.004 + 0.020 + 0.018 = 0.042$\n$r_B = d_{BA} + d_{BC} + d_{BD} = 0.004 + 0.022 + 0.019 = 0.045$\n$r_C = d_{CA} + d_{CB} + d_{CD} = 0.020 + 0.022 + 0.005 = 0.047$\n$r_D = d_{DA} + d_{DB} + d_{DC} = 0.018 + 0.019 + 0.005 = 0.042$\n\nNext, we construct the $Q$-matrix, where the entry $Q_{ij}$ determines which pair of taxa to join. The pair $(i, j)$ that minimizes $Q_{ij}$ is chosen. The formula for $Q_{ij}$ is:\n$$Q_{ij} = (L-2)d_{ij} - r_i - r_j$$\nFor $L=4$, this becomes $Q_{ij} = 2d_{ij} - r_i - r_j$. We compute this for all pairs:\n$Q_{AB} = 2(0.004) - (0.042 + 0.045) = 0.008 - 0.087 = -0.079$\n$Q_{AC} = 2(0.020) - (0.042 + 0.047) = 0.040 - 0.089 = -0.049$\n$Q_{AD} = 2(0.018) - (0.042 + 0.042) = 0.036 - 0.084 = -0.048$\n$Q_{BC} = 2(0.022) - (0.045 + 0.047) = 0.044 - 0.092 = -0.048$\n$Q_{BD} = 2(0.019) - (0.045 + 0.042) = 0.038 - 0.087 = -0.049$\n$Q_{CD} = 2(0.005) - (0.047 + 0.042) = 0.010 - 0.089 = -0.079$\n\nThe minimum value in the $Q$-matrix is $-0.079$, which corresponds to pairs $(A, B)$ and $(C, D)$. In case of a tie, any of the minimizing pairs can be chosen. We arbitrarily choose to join the pair $(A, B)$.\n\n**Step 2: Compute Branch Lengths and Define a New Node**\nWe define a new internal node $U$ that is the parent of $A$ and $B$. The lengths of the branches connecting $A$ and $B$ to $U$ are calculated as:\n$$d_{iU} = \\frac{1}{2}d_{ij} + \\frac{1}{2(L-2)}(r_i - r_j)$$\nFor the pair $(A, B)$ with $L=4$:\n$d_{AU} = \\frac{1}{2}d_{AB} + \\frac{1}{2(4-2)}(r_A - r_B) = \\frac{1}{2}(0.004) + \\frac{1}{4}(0.042 - 0.045) = 0.002 - 0.00075 = 0.00125$\nThe length of the branch connecting $B$ to $U$ can be found either by symmetry or by the property that $d_{AU} + d_{BU} = d_{AB}$:\n$d_{BU} = d_{AB} - d_{AU} = 0.004 - 0.00125 = 0.00275$\n\n**Step 3: Update the Distance Matrix**\nWe now have a new set of taxa, $S' = \\{U, C, D\\}$, where $U$ represents the cluster $(A,B)$. We compute the distances from the remaining taxa ($C$ and $D$) to the new node $U$. The formula is:\n$$d_{kU} = \\frac{1}{2}(d_{kA} + d_{kB} - d_{AB})$$\n$d_{CU} = \\frac{1}{2}(d_{CA} + d_{CB} - d_{AB}) = \\frac{1}{2}(0.020 + 0.022 - 0.004) = \\frac{1}{2}(0.038) = 0.019$\n$d_{DU} = \\frac{1}{2}(d_{DA} + d_{DB} - d_{AB}) = \\frac{1}{2}(0.018 + 0.019 - 0.004) = \\frac{1}{2}(0.033) = 0.0165$\n\nThe new, reduced distance matrix $D'$ for taxa $\\{U, C, D\\}$ is:\n$$\nD' \\;=\\;\n\\begin{pmatrix}\n0  0.019  0.0165 \\\\\n0.019  0  0.005 \\\\\n0.0165  0.005  0\n\\end{pmatrix}\n$$\nThe distance $d_{CD}$ remains $0.005$ from the original matrix $D$.\n\n**Iteration 2: $L=3$ taxa**\n\nThe algorithm terminates when only three taxa remain. The unrooted tree topology is now fully resolved. The three remaining taxa, $\\{U, C, D\\}$, connect to a central internal node, which we will label $V$.\nThe lengths of the three final branches connecting $U, C, D$ to $V$ are calculated using the formula for a 3-taxon tree:\n$$d_{iV} = \\frac{1}{2}(d_{ij} + d_{ik} - d_{jk})$$\n$d_{UV} = \\frac{1}{2}(d_{UC} + d_{UD} - d_{CD}) = \\frac{1}{2}(0.019 + 0.0165 - 0.005) = \\frac{1}{2}(0.0305) = 0.01525$\n$d_{CV} = \\frac{1}{2}(d_{CU} + d_{CD} - d_{UD}) = \\frac{1}{2}(0.019 + 0.005 - 0.0165) = \\frac{1}{2}(0.0075) = 0.00375$\n$d_{DV} = \\frac{1}{2}(d_{DU} + d_{DC} - d_{UC}) = \\frac{1}{2}(0.0165 + 0.005 - 0.019) = \\frac{1}{2}(0.0025) = 0.00125$\n\n**Final Tree and Total Length**\nThe reconstruction is complete. The unrooted tree topology is $((A,B),(C,D))$, with two internal nodes $U$ and $V$.\nThe branch lengths are:\n- Terminal branch $A \\to U$: $d_{AU} = 0.00125$\n- Terminal branch $B \\to U$: $d_{BU} = 0.00275$\n- Terminal branch $C \\to V$: $d_{CV} = 0.00375$\n- Terminal branch $D \\to V$: $d_{DV} = 0.00125$\n- Internal branch $U \\leftrightarrow V$: $d_{UV} = 0.01525$\n\nThe total tree length is the sum of all five branch lengths:\n$$L_{\\text{total}} = d_{AU} + d_{BU} + d_{CV} + d_{DV} + d_{UV}$$\n$$L_{\\text{total}} = 0.00125 + 0.00275 + 0.00375 + 0.00125 + 0.01525$$\n$$L_{\\text{total}} = 0.00400 + 0.00500 + 0.01525$$\n$$L_{\\text{total}} = 0.02425$$\n\nThe problem asks for the answer to be rounded to four significant figures. The calculated value $0.02425$ has exactly four significant figures ($2$, $4$, $2$, $5$). Therefore, no rounding is necessary. The value is presented as is.",
            "answer": "$$\\boxed{0.02425}$$"
        },
        {
            "introduction": "A reconstructed phylogeny provides a hypothesis of relationships, but linking it to specific transmission events requires careful calibration. Given the rapid evolution of many pathogens, how much genetic difference do we actually expect to see between a donor and a recipient? This practice problem bridges the gap between phylogenetics and epidemiology by using the concept of a molecular clock to calculate the expected number of new mutations per transmission event . This calculation provides a vital probabilistic framework for interpreting short branches on a tree and assessing the likelihood of direct transmission.",
            "id": "4661525",
            "problem": "A hospital is investigating a cluster of infections by a positive-sense single-stranded RNA virus. Genomes are sequenced at high coverage and consensus sequences are compared to infer likely transmission links. Assume that mutations arise as a time-homogeneous Poisson process with a constant per-site substitution (fixation) rate consistent with a molecular clock. Let the per-site clock rate be $\\mu$ (in substitutions per site per year), the genome length be $L$ (in nucleotides), and the mean generation time between donor infection and recipient infection be $g$ (in days). Using only the foundational definition that, under a Poisson process with constant rate, the expected number of events over time is the product of rate and time, and that the numbers of events across independent sites add, derive from first principles an expression for the expected number of new Single Nucleotide Polymorphisms (SNPs) per transmission event. Then evaluate this expectation numerically for $\\mu = 9.5 \\times 10^{-4}$, $L = 29{,}903$, and $g = 5.2$, taking a year to be $365$ days. Express the final expected number of new SNPs per transmission event as a decimal rounded to three significant figures. In your reasoning, briefly explain the implications of your result for distinguishing true transmission pairs using consensus genome comparisons, assuming the number of new SNPs per transmission follows a Poisson distribution.",
            "solution": "The problem asks for the derivation of the expected number of new Single Nucleotide Polymorphisms (SNPs) per transmission event, its numerical evaluation, and a discussion of the implications. The problem is scientifically grounded and well-posed, providing all necessary parameters and assumptions for a unique solution.\n\nFirst, we derive the expression for the expected number of new SNPs per transmission event, which we denote as $E[N_{SNP}]$. The derivation will strictly follow the principles stipulated in the problem statement.\n\nThe problem provides the following parameters:\n- The per-site substitution rate is $\\mu$, with units of substitutions per site per year.\n- The genome length is $L$ nucleotides.\n- The mean generation time is $g$ days.\n\nThe time interval over which mutations accumulate during a single transmission event is the generation time, $g$. The rate $\\mu$ is given in units involving years, while $g$ is in days. To maintain consistent units, we must convert the generation time to years. Using the provided conversion factor of $365$ days per year, the generation time in years, $t$, is:\n$$t = \\frac{g}{365}$$\n\nThe problem states to use the foundational definition that for a Poisson process with a constant rate, the expected number of events is the product of the rate and the time interval. Let us first consider a single nucleotide site. The rate of substitution at this site is $\\mu$. Over the time interval $t$, the expected number of substitutions at this single site, $E[N_{site}]$, is:\n$$E[N_{site}] = \\mu \\times t = \\mu \\frac{g}{365}$$\n\nThe problem further states that the number of events (substitutions) across independent sites add. The genome consists of $L$ sites. Assuming that substitutions at each site occur independently, the total expected number of new SNPs across the entire genome is the sum of the expected numbers of substitutions at each of the $L$ sites. Since the rate $\\mu$ is assumed to be constant across all sites, this sum is simply $L$ multiplied by the single-site expectation:\n$$E[N_{SNP}] = \\sum_{i=1}^{L} E[N_{site}] = L \\times E[N_{site}]$$\nSubstituting the expression for $E[N_{site}]$, we arrive at the final symbolic expression for the expected number of new SNPs per transmission event:\n$$E[N_{SNP}] = L \\mu \\frac{g}{365}$$\n\nNext, we evaluate this expression numerically using the provided values:\n- $\\mu = 9.5 \\times 10^{-4}$ substitutions per site per year\n- $L = 29{,}903$ nucleotides\n- $g = 5.2$ days\n\nSubstituting these values into our derived expression:\n$$E[N_{SNP}] = 29{,}903 \\times (9.5 \\times 10^{-4}) \\times \\frac{5.2}{365}$$\nPerforming the calculation:\n$$E[N_{SNP}] \\approx 28.40785 \\times \\frac{5.2}{365}$$\n$$E[N_{SNP}] \\approx 28.40785 \\times 0.014246575...$$\n$$E[N_{SNP}] \\approx 0.404674...$$\n\nThe problem requires the final answer to be rounded to three significant figures. Rounding $0.404674...$ to three significant figures gives $0.405$.\n\nFinally, we consider the implications of this result. The problem asks us to assume the number of new SNPs per transmission, $N_{SNP}$, follows a Poisson distribution. The expected value of a Poisson-distributed random variable is its rate parameter, $\\lambda$. Thus, we have $N_{SNP} \\sim \\text{Poisson}(\\lambda)$ with $\\lambda = E[N_{SNP}] \\approx 0.405$.\n\nThe probability mass function of the Poisson distribution is $P(N_{SNP}=k) = \\frac{\\lambda^k \\exp(-\\lambda)}{k!}$, where $k$ is the number of observed SNPs. We can calculate the probabilities for small values of $k$:\n- Probability of observing $k=0$ SNPs: $P(N_{SNP}=0) = \\frac{(0.405)^0 \\exp(-0.405)}{0!} = \\exp(-0.405) \\approx 0.667$.\n- Probability of observing $k=1$ SNP: $P(N_{SNP}=1) = \\frac{(0.405)^1 \\exp(-0.405)}{1!} \\approx 0.405 \\times 0.667 \\approx 0.270$.\n- Probability of observing $k=2$ SNPs: $P(N_{SNP}=2) = \\frac{(0.405)^2 \\exp(-0.405)}{2!} \\approx \\frac{0.164025}{2} \\times 0.667 \\approx 0.0547$.\n\nThe key implication is that for a true, direct transmission event, it is most likely (approximately $67\\%$) that the consensus genomes of the donor and recipient will be identical (zero SNPs). There is also a substantial probability (approximately $27\\%$) of observing exactly one SNP. The probability of observing two or more SNPs is relatively small ($1 - 0.667 - 0.270 = 0.063$, or about $6.3\\%$). Therefore, observing zero or one SNP is highly consistent with a direct transmission link. However, a zero-SNP difference is not conclusive proof of direct transmission, as it is the most common outcome. Conversely, observing a larger number of SNPs (e.g., $3$ or more) makes a direct transmission link highly improbable and suggests the presence of un-sampled intermediate hosts or a more distant epidemiological relationship. The low expected value of SNPs per transmission highlights the difficulty in definitively resolving transmission chains using only consensus genomes, as distinct transmission events cannot be reliably distinguished from one another if they both result in zero new mutations.",
            "answer": "$$\n\\boxed{0.405}\n$$"
        }
    ]
}