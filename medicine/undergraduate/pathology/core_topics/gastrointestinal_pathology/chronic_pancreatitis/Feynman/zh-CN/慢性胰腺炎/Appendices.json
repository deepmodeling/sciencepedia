{
    "hands_on_practices": [
        {
            "introduction": "慢性胰腺炎的一个核心临床特征是外分泌功能不全，导致脂肪吸收不良和脂肪泻。通过定量分析，我们可以精确评估吸收障碍的严重程度，这对于指导胰酶替代疗法至关重要。本练习将引导你运用质量守恒的基本原理，根据饮食摄入量和粪便排泄量计算脂肪吸收系数，从而将临床检测数据转化为一个有明确生理意义的指标 。",
            "id": "4608472",
            "problem": "一名 $48$ 岁的男性患有钙化性慢性胰腺炎，尽管接受了胰酶替代疗法 (Pancreatic Enzyme Replacement Therapy, PERT)，仍表现为持续性脂肪泻。在每日摄入含 $100$ 克脂肪的膳食的同时，他接受了一项标准化的粪便脂肪定量检测。在 $72$ 小时的收集期间，测得的总粪便脂肪为 $63$ 克。假设患者处于代谢稳态，非粪便的脂肪损失可以忽略不计，并且测量是准确的。根据膳食脂肪的质量守恒以及“摄入营养素的吸收分数等于吸收量除以摄入量”这一定义，从第一性原理推导脂肪的吸收系数，并计算其无单位小数值。将您的答案四舍五入到三位有效数字。不要使用百分号。",
            "solution": "相关的框架是在稳态下处理营养物质的质量守恒。令 $I$ 表示每日摄入的脂肪， $F$ 表示每日粪便排泄的脂肪， $A$ 表示每日吸收的脂肪。在稳态条件下并忽略非粪便损失，吸收量满足\n$$\nA = I - F.\n$$\n脂肪吸收系数是摄入脂肪中被吸收的部分，定义为\n$$\nC = \\frac{A}{I}.\n$$\n将质量平衡代入定义中，得到\n$$\nC = \\frac{I - F}{I} = 1 - \\frac{F}{I}.\n$$\n根据数据，标准化的膳食摄入量为 $I = 100$ 克/天。$72$ 小时的粪便脂肪为 $63$ 克，因此每日粪便脂肪排泄量为\n$$\nF = \\frac{63\\ \\text{g}}{3\\ \\text{days}} = 21\\ \\text{g/day}.\n$$\n因此，\n$$\nC = 1 - \\frac{21}{100} = 1 - 0.21 = 0.79.\n$$\n四舍五入到三位有效数字，无单位小数值为 $0.790$。\n\n在慢性胰腺炎的临床背景下解读此结果：在每日摄入 $100$ 克脂肪的膳食下，典型的正常值约为 $C \\geq 0.93$，轻度吸收不良通常被认为在 $0.85$ 至 $0.93$ 之间，而低于 $0.85$ 的值与中度至重度脂肪吸收不良一致。$0.79$ 的值表明存在中度至重度吸收不良，支持升级胰酶替代疗法 (PERT)，例如通过增加每餐的脂肪酶单位并考虑使用抑酸剂来优化腔内酶活性，同时进行营养干预。手术治疗仍然保留给诸如伴有导管梗阻或并发症的顽固性疼痛等适应症，而不是单纯针对吸收不良。",
            "answer": "$$\\boxed{0.790}$$"
        },
        {
            "introduction": "慢性胰腺炎的病理生理学不仅涉及消化酶的缺乏，还包括关键的碳酸氢盐分泌障碍，导致胰管内液体酸性化。这个问题将让你应用亨德森-哈塞尔巴赫方程（Henderson-Hasselbalch equation），模拟一个关键的分子缺陷（CFTR通道功能下降）如何直接导致胰管内$pH$值的改变 。这种定量方法揭示了从分子功能障碍到生理后果的关键联系，是理解胰管结石等并发症形成机制的基础。",
            "id": "4345266",
            "problem": "在慢性胰腺炎中，胰管上皮中的囊性纤维化跨膜电导调节因子 (CFTR) 通道功能减弱，损害了富含碳酸氢盐的液体分泌，从而降低了胰管液的碱度。考虑一段处于稳态的胰管，其中碳酸氢盐的分泌主要由CFTR介导的阴离子电导所主导。使用以下数据和假设：\n\n- 在持续的胰泌素刺激下，基线胰管碳酸氢盐浓度为 $[\\text{HCO}_{3}^{-}]_{0} = 120$ mmol/L，此时CFTR单通道开放概率为 $P_{o,0} = 0.70$。\n- 胰管液中溶解的二氧化碳浓度恒定为 $[\\text{CO}_{2}] = 1.2$ mmol/L。\n- 在 $37\\,^{\\circ}\\text{C}$ 时，$\\text{CO}_{2}$–$\\text{HCO}_{3}^{-}$ 缓冲系统的有效酸解离常数为 $pK_{a} = 6.1$。\n- CFTR通道的数量和驱动力保持不变；CFTR“活性”与开放概率 $P_{o}$ 成正比。在线性工作范围内，稳态胰管碳酸氢盐浓度与CFTR活性成比例变化，因此 $[\\text{HCO}_{3}^{-}] \\propto P_{o}$，且所有其他转运体和流速保持不变。\n\n一次疾病发作导致CFTR活性相对于基线水平降低了 $50\\%$。\n\n仅使用基本的酸碱平衡原理和上述假设，计算此次降低后的新胰管液 $pH$ 值。答案以纯数字形式表示（无单位），并将答案四舍五入至四位有效数字。",
            "solution": "问题要求计算在囊性纤维化跨膜电导调节因子 (CFTR) 通道活性发生病理性降低之后的新胰管液pH值。该解答基于应用于碳酸氢盐缓冲系统的酸碱平衡原理，而该系统遵循亨德森-哈塞尔巴赫方程。\n\n使用溶解二氧化碳浓度 $[\\text{CO}_{2}]$ 时，碳酸氢盐缓冲系统的亨德森-哈塞尔巴赫方程表示为：\n$$\npH = pK_{a} + \\log_{10}\\left(\\frac{[\\text{HCO}_{3}^{-}]}{[\\text{CO}_{2}]}\\right)\n$$\n其中 $[\\text{HCO}_{3}^{-}]$ 是碳酸氢盐的摩尔浓度，$[\\text{CO}_{2}]$ 是溶解二氧化碳的摩尔浓度，而 $pK_{a}$ 是有效酸解离常数。\n\n问题提供了以下常数和初始条件：\n- 有效酸解离常数：$pK_{a} = 6.1$。\n- 溶解二氧化碳的浓度，保持恒定：$[\\text{CO}_{2}] = 1.2 \\text{ mmol/L}$。\n- 基线碳酸氢盐浓度：$[\\text{HCO}_{3}^{-}]_{0} = 120 \\text{ mmol/L}$。\n- 基线CFTR单通道开放概率：$P_{o,0} = 0.70$。\n\n问题的一个关键前提是，稳态胰管碳酸氢盐浓度 $[\\text{HCO}_{3}^{-}]$ 与CFTR活性成正比。设CFTR活性由变量 $A$ 表示。其关系为：\n$$\n[\\text{HCO}_{3}^{-}] \\propto A\n$$\n这可以用一个比例常数 $k$ 表示为：\n$$\n[\\text{HCO}_{3}^{-}] = k \\cdot A\n$$\n在基线状态下，我们有：\n$$\n[\\text{HCO}_{3}^{-}]_{0} = k \\cdot A_{0}\n$$\n其中 $A_{0}$ 是基线CFTR活性。\n\n问题指出，一次疾病发作使CFTR活性相对于基线降低了 $50\\%$。因此，新的活性 $A_{1}$ 为：\n$$\nA_{1} = (1 - 0.50) \\cdot A_{0} = 0.50 \\cdot A_{0}\n$$\n根据正比关系，新的碳酸氢盐浓度 $[\\text{HCO}_{3}^{-}]_{1}$ 与新的活性 $A_{1}$ 相关：\n$$\n[\\text{HCO}_{3}^{-}]_{1} = k \\cdot A_{1} = k \\cdot (0.50 \\cdot A_{0}) = 0.50 \\cdot (k \\cdot A_{0})\n$$\n通过代入 $[\\text{HCO}_{3}^{-}]_{0} = k \\cdot A_{0}$，我们可以用基线浓度来表示新的碳酸氢盐浓度：\n$$\n[\\text{HCO}_{3}^{-}]_{1} = 0.50 \\cdot [\\text{HCO}_{3}^{-}]_{0}\n$$\n使用给定的基线值，我们可以计算出新碳酸氢盐浓度的数值：\n$$\n[\\text{HCO}_{3}^{-}]_{1} = 0.50 \\times 120 \\text{ mmol/L} = 60 \\text{ mmol/L}\n$$\n现在，我们可以通过将新的碳酸氢盐浓度代入亨德森-哈塞尔巴赫方程，来计算新的胰管液pH值，我们将其记为 $pH_{1}$。新状态的参数如下：\n- $[\\text{HCO}_{3}^{-}]_{1} = 60 \\text{ mmol/L}$\n- $[\\text{CO}_{2}] = 1.2 \\text{ mmol/L}$ (恒定)\n- $pK_{a} = 6.1$\n\n新pH值的计算如下：\n$$\npH_{1} = pK_{a} + \\log_{10}\\left(\\frac{[\\text{HCO}_{3}^{-}]_{1}}{[\\text{CO}_{2}]}\\right)\n$$\n$$\npH_{1} = 6.1 + \\log_{10}\\left(\\frac{60}{1.2}\\right)\n$$\n浓度之比如下：\n$$\n\\frac{60}{1.2} = 50\n$$\n将此比值代回pH方程中：\n$$\npH_{1} = 6.1 + \\log_{10}(50)\n$$\n为计算该表达式，我们计算 $50$ 的以10为底的对数：\n$$\n\\log_{10}(50) \\approx 1.69897\n$$\n因此，新的pH值为：\n$$\npH_{1} \\approx 6.1 + 1.69897 = 7.79897\n$$\n问题要求答案四舍五入至四位有效数字。对计算值进行四舍五入得到：\n$$\npH_{1} \\approx 7.799\n$$\n这一结果表明，CFTR介导的碳酸氢盐分泌减少 $50\\%$ 会导致胰管液的碱度显著下降，而这是慢性胰腺炎病理生理学的一个关键特征。",
            "answer": "$$\\boxed{7.799}$$"
        },
        {
            "introduction": "慢性胰腺炎是一种进展性疾病，了解其病程演变对于临床预后判断和医疗资源规划至关重要。我们可以运用像马尔可夫链（Markov chain）这样的数学模型来描述和预测疾病在不同严重程度阶段之间的演进。这项高级练习将引导你接触临床医学中的计算建模方法，通过从纵向患者数据中构建一个马尔可夫模型，你将学会如何估算疾病状态之间的转移概率，从而为理解慢性胰腺炎的自然病程提供一个定量框架 。",
            "id": "4345250",
            "problem": "您的任务是为慢性胰腺炎在不同疾病状态下的进展构建一个离散时间马尔可夫链模型，并根据纵向患者轨迹估计其状态转移概率矩阵。其生物学背景是，慢性胰腺炎通常从早期疾病发展到并发症，偶尔会停留在同一状态；疾病状态的逆转很少见，除非数据中明确显示，否则在此不作此假设。您的实现必须从第一性原理出发：使用一阶马尔可夫链的定义，并从独立转移中推导出相应的似然函数，然后通过有原则的优化或合理的贝叶斯正则化来获得参数估计。不要套用任何现成的公式；相反，应从定义出发进行推理，以得到一个正确的估计器。\n\n模型规范：\n- 状态：有 $4$ 个状态，依次为早期 ($\\mathsf{E}$)、中期 ($\\mathsf{M}$)、重度 ($\\mathsf{S}$) 和并发症 ($\\mathsf{C}$)。请按顺序将这些状态编码为整数 $\\{0,1,2,3\\}$。\n- 时间：观测是在离散时间上等间隔进行的。对于每个患者，您会得到一个在连续时间点上访问的状态码序列。从每个患者序列中，提取所有连续的有序对 $(s_t \\to s_{t+1})$ 以构成观测到的单步转移。没有后继状态的序列的最终状态不构成一次转移。\n\n估计目标：\n- 估计一个 $4 \\times 4$ 的转移概率矩阵 $P$，其条目 $p_{ij}$ 等于在时间 $t$ 从状态 $i$ 转移到时间 $t+1$ 的状态 $j$ 的概率，其中 $i,j \\in \\{0,1,2,3\\}$，并满足每行之和为 $1$。\n- 您的估计器应基于以下基本原则：\n  - 一阶马尔可夫性质：$\\mathbb{P}(s_{t+1} = j \\mid s_t = i, \\text{history}) = \\mathbb{P}(s_{t+1} = j \\mid s_t = i) = p_{ij}$。\n  - 在当前状态的条件下，跨患者和时间的转移是独立抽样的。\n  - 最大似然估计 (MLE)：选择在行随机约束条件下，能最大化观测到的转移的联合似然的参数。\n  - 通过 Laplace 平滑进行可选的正则化：当指定时，在重新归一化之前，为一行中每个可能的目标状态加入一个对称的伪计数 $\\alpha$。\n  - 可选的吸收态强制执行：当指定时，通过将状态 $\\mathsf{C}$（状态码 $3$）所在行设置为在状态 $3$ 处的点质量，来强制其成为吸收态。\n\n边缘情况处理：\n- 如果某一行没有观测到传出转移，并且指定的伪计数 $\\alpha$ 为 $0$，则将该行定义为在 $4$ 个状态上的均匀分布，以保持其为有效的随机行。如果吸收态强制执行被激活，并且该行对应于状态 $3$，则将该行覆盖为吸收态，即 $[0,0,0,1]$。\n\n您的程序必须实现符合这些原则的估计器，并将其应用于以下测试套件。对于每种情况，计算 $4 \\times 4$ 的转移矩阵，其条目四舍五入到四位小数。\n\n测试套件（每种情况都指定了患者轨迹列表（以整数编码的状态列表形式）、伪计数 $\\alpha$ 以及是否将状态 $\\mathsf{C}$ 强制为吸收态）：\n\n- 情况 1（一般性进展，不强制执行吸收态）：\n  - 轨迹：\n    - $[0,1,1,2,2,3]$\n    - $[0,0,1,1,2,3]$\n    - $[1,1,2,2,2,3]$\n    - $[0,1,2,2,3,3]$\n    - $[0,0,0,1,1,2]$\n  - 伪计数 $\\alpha = 0$\n  - 对状态 3 强制执行吸收态：false\n\n- 情况 2（包括从并发症状态出现的明显好转；强制并发症为吸收态）：\n  - 轨迹：\n    - $[0,1,2,3,2,2]$\n    - $[1,2,3,3]$\n    - $[0,0,1,2,3]$\n    - $[2,2,3]$\n  - 伪计数 $\\alpha = 0$\n  - 对状态 3 强制执行吸收态：true\n\n- 情况 3（稀疏数据，没有观测到重度或并发症状态的转移；使用平滑）：\n  - 轨迹：\n    - $[0,0,0]$\n    - $[0,1,1]$\n    - $[1,1]$\n  - 伪计数 $\\alpha = 0.5$\n  - 对状态 3 强制执行吸收态：false\n\n输出要求：\n- 对于每种情况，返回估计的 $4 \\times 4$ 矩阵，形式为一个包含 $4$ 个行列表的列表，每个行列表包含 $4$ 个四舍五入到四位小数的浮点数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、逗号分隔的结果列表，其中第一个元素是情况 1 的矩阵，第二个是情况 2 的矩阵，第三个是情况 3 的矩阵。例如，打印的结构必须看起来像一个包含 3 个矩阵的列表：`[[[\\cdot,\\cdot,\\cdot,\\cdot],\\ldots],[[\\cdot,\\cdot,\\cdot,\\cdot],\\ldots],[[\\cdot,\\cdot,\\cdot,\\cdot],\\ldots]]`。不要包含任何解释性文本，也不要打印多行。",
            "solution": "该问题要求为一个描述慢性胰腺炎进展的离散时间一阶马尔可夫链模型估计其状态转移概率矩阵。该估计需要从基本原理推导得出，特别是最大似然估计（MLE），并实现以处理具有特定变化的几个测试用例。\n\n### 问题表述与模型规范\n\n该系统被建模为一个具有有限状态空间 $S = \\{0, 1, 2, 3\\}$ 的马尔可夫链，对应于疾病状态：早期 ($\\mathsf{E}$)、中期 ($\\mathsf{M}$)、重度 ($\\mathsf{S}$) 和并发症 ($\\mathsf{C}$)。系统的演化由一个 $4 \\times 4$ 的转移概率矩阵 $P$ 控制，其中每个条目 $p_{ij} = \\mathbb{P}(X_{t+1} = j \\mid X_t = i)$ 表示在单个时间步内从状态 $i$ 转移到状态 $j$ 的概率。根据定义，$P$ 的每一行之和必须为 $1$，即对所有 $i \\in S$ 都有 $\\sum_{j=0}^{3} p_{ij} = 1$。\n\n输入数据包含一组患者轨迹，这些轨迹是在离散、等间隔时间点观测到的状态序列。\n\n### 最大似然估计器 (MLE) 的推导\n\n转移概率 $p_{ij}$ 的估计是基于最大化观测到的转移数据的似然函数。\n\n1.  **转移计数**：首先，我们处理原始轨迹数据以获得转移计数。设 $N_{ij}$ 为所有患者中观测到的从状态 $i$ 到状态 $j$ 的单步转移总数。设 $N_i = \\sum_{j=0}^{3} N_{ij}$ 为观测到的从状态 $i$ 出发的转移总数。\n\n2.  **似然函数**：核心假设是一阶马尔可夫性质和在起始状态条件下转移的独立性。从给定状态 $i$ 出发的转移可以建模为一系列独立试验，这导致计数 $(N_{i0}, N_{i1}, N_{i2}, N_{i3})$ 服从多项分布。在给定概率 $(p_{i0}, p_{i1}, p_{i2}, p_{i3})$ 的情况下，观测到这些计数的似然与 $\\prod_{j=0}^{3} p_{ij}^{N_{ij}}$ 成正比。\n\n    所有观测到的转移的总似然 $L(P)$ 是每个起始状态的似然的乘积：\n    $$\n    L(P) = \\prod_{i=0}^{3} \\prod_{j=0}^{3} p_{ij}^{N_{ij}}\n    $$\n\n3.  **对数似然与优化**：最大化似然等同于最大化对数似然 $\\ell(P) = \\log L(P)$，这是一个更易于处理的函数：\n    $$\n    \\ell(P) = \\sum_{i=0}^{3} \\sum_{j=0}^{3} N_{ij} \\log p_{ij}\n    $$\n    这个优化问题受到每行必须是有效概率分布的约束：$\\sum_{j=0}^{3} p_{ij} = 1$ 和 $p_{ij} \\ge 0$ 对所有 $i, j$ 成立。\n\n    对数似然函数是各项之和，其中每一项仅依赖于单行的参数。因此，我们可以独立地为每一行 $i$ 最大化似然。对于给定的行 $i$，我们必须在约束 $\\sum_{j=0}^{3} p_{ij} = 1$ 下最大化 $\\sum_{j=0}^{3} N_{ij} \\log p_{ij}$。\n\n    使用拉格朗日乘数法，我们定义第 $i$ 行的拉格朗日函数：\n    $$\n    \\mathcal{L}_i(p_{i0}, \\dots, p_{i3}, \\lambda_i) = \\left( \\sum_{j=0}^{3} N_{ij} \\log p_{ij} \\right) - \\lambda_i \\left( \\left( \\sum_{j=0}^{3} p_{ij} \\right) - 1 \\right)\n    $$\n    对任意 $p_{ik}$ 求偏导数并令其为零，得到：\n    $$\n    \\frac{\\partial \\mathcal{L}_i}{\\partial p_{ik}} = \\frac{N_{ik}}{p_{ik}} - \\lambda_i = 0 \\implies p_{ik} = \\frac{N_{ik}}{\\lambda_i}\n    $$\n    对 $k$ 求和并应用约束 $\\sum_{k=0}^{3} p_{ik} = 1$：\n    $$\n    \\sum_{k=0}^{3} \\frac{N_{ik}}{\\lambda_i} = 1 \\implies \\frac{1}{\\lambda_i} \\sum_{k=0}^{3} N_{ik} = 1 \\implies \\lambda_i = \\sum_{k=0}^{3} N_{ik} = N_i\n    $$\n    将 $\\lambda_i = N_i$ 代回，得到转移概率 $p_{ij}$ 的 MLE：\n    $$\n    \\hat{p}_{ij}^{\\text{MLE}} = \\frac{N_{ij}}{N_i} = \\frac{N_{ij}}{\\sum_{k=0}^{3} N_{ik}}\n    $$\n    这个基本结果表明，转移概率的最大似然估计就是该转移的观测频率。\n\n### 使用 Laplace 平滑进行正则化\n\n问题指定了一种通过伪计数 $\\alpha$ 进行的可选正则化，该技术也称为 Laplace 平滑或加性平滑。这等同于在浓度参数为 $\\alpha$ 的对称狄利克雷先验下，寻找最大后验 (MAP) 估计。通过将伪计数 $\\alpha$ 添加到每个观测计数中来修改估计器：\n$$\n\\hat{p}_{ij}^{\\text{MAP}} = \\frac{N_{ij} + \\alpha}{\\sum_{k=0}^{3} (N_{ik} + \\alpha)} = \\frac{N_{ij} + \\alpha}{N_i + 4\\alpha}\n$$\n这可以防止未观测到的转移概率为零，在处理稀疏数据时尤其有用。\n\n### 算法实现\n\n估计过程如下：\n\n1.  **计数转移**：初始化一个 $4 \\times 4$ 的整数矩阵 $N$ 为零。遍历每个患者轨迹。对于轨迹中的每一对连续状态 $(s_t, s_{t+1})$，增加计数 $N_{s_t, s_{t+1}}$。\n\n2.  **估计概率**：初始化一个 $4 \\times 4$ 的浮点数矩阵 $P$。对于每一行 $i \\in \\{0, 1, 2, 3\\}$：\n    a. 计算总传出计数 $N_i = \\sum_{j=0}^{3} N_{ij}$。\n    b. **处理边缘情况**：如果 $N_i = 0$（即没有观测到从状态 $i$ 出发的转移）且伪计数 $\\alpha = 0$，则标准公式无定义。在这种特定情况下，问题要求将第 $i$ 行设置为均匀分布：$p_{ij} = 1/4 = 0.25$，其中 $j=0,1,2,3$。\n    c. **标准计算**：否则（如果 $N_i > 0$ 或 $\\alpha > 0$），使用正则化估计器计算该行的每个元素 $p_{ij}$：\n       $$\n       p_{ij} = \\frac{N_{ij} + \\alpha}{N_i + 4\\alpha}\n       $$\n\n3.  **强制吸收态**：根据上述步骤计算完整个矩阵 $P$ 后，检查状态 $3$ 的 `enforce_absorbing` 标志是否激活。如果是，则无条件地将矩阵的第 $3$ 行覆盖为 $[0, 0, 0, 1]$。此规则优先于上一步中对第 $3$ 行执行的任何计算。问题陈述中包含一个针对 $N_i=0, \\alpha=0$ 情况的特定子规则，即如果 `enforce_absorbing` 为真且 $i=3$，则该行变为 $[0,0,0,1]$ 而不是均匀分布。一个更简洁的实现方式是，首先将所有 $N_i=0, \\alpha=0$ 的行处理为均匀分布，然后在最后，如果需要，对第 $3$ 行应用吸收态覆盖，因为这涵盖了第 $3$ 行的所有情况。\n\n4.  **最终格式化**：将最终矩阵 $P$ 中的所有条目四舍五入到四位小数。\n\n这个过程提供了一种从第一性原理估计转移矩阵的稳健方法，它包含了指定的正则化并处理了所有定义的边缘情况。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef estimate_transition_matrix(trajectories, alpha, enforce_absorbing):\n    \"\"\"\n    Estimates the state transition probability matrix for a discrete-time Markov chain.\n\n    Args:\n        trajectories (list[list[int]]): A list of patient trajectories.\n        alpha (float): The pseudocount for Laplace smoothing.\n        enforce_absorbing (bool): If True, state 3 is enforced as absorbing.\n\n    Returns:\n        list[list[float]]: The 4x4 estimated transition matrix, rounded to 4 decimals.\n    \"\"\"\n    num_states = 4\n    counts = np.zeros((num_states, num_states), dtype=int)\n\n    # Step 1: Count transitions from the data\n    for trajectory in trajectories:\n        for i in range(len(trajectory) - 1):\n            from_state = trajectory[i]\n            to_state = trajectory[i+1]\n            if 0 = from_state  num_states and 0 = to_state  num_states:\n                counts[from_state, to_state] += 1\n\n    # Step 2: Estimate probabilities from counts\n    P = np.zeros((num_states, num_states), dtype=float)\n    for i in range(num_states):\n        n_i = np.sum(counts[i, :])\n\n        # Handle the edge case of no outgoing transitions and zero alpha\n        if n_i == 0 and alpha == 0.0:\n            # Per problem spec, assign uniform distribution for this row.\n            # A special sub-case for state 3 is handled by the global override later.\n            P[i, :] = np.ones(num_states) / num_states\n        else:\n            # Standard calculation using MLE with Laplace smoothing\n            denominator = n_i + num_states * alpha\n            for j in range(num_states):\n                numerator = counts[i, j] + alpha\n                P[i, j] = numerator / denominator\n\n    # Step 3: Enforce absorbing state for state 3 if specified\n    if enforce_absorbing:\n        P[3, :] = 0.0\n        P[3, 3] = 1.0\n\n    # Step 4: Round to four decimal places\n    P_rounded = np.round(P, 4)\n    return P_rounded.tolist()\n\ndef solve():\n    \"\"\"\n    Runs the estimation for all test cases and prints the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (\n            [\n                [0, 1, 1, 2, 2, 3],\n                [0, 0, 1, 1, 2, 3],\n                [1, 1, 2, 2, 2, 3],\n                [0, 1, 2, 2, 3, 3],\n                [0, 0, 0, 1, 1, 2],\n            ],\n            0.0,\n            False,\n        ),\n        # Case 2\n        (\n            [\n                [0, 1, 2, 3, 2, 2],\n                [1, 2, 3, 3],\n                [0, 0, 1, 2, 3],\n                [2, 2, 3],\n            ],\n            0.0,\n            True,\n        ),\n        # Case 3\n        (\n            [\n                [0, 0, 0],\n                [0, 1, 1],\n                [1, 1],\n            ],\n            0.5,\n            False,\n        ),\n    ]\n\n    results = []\n    for trajectories, alpha, enforce_absorbing in test_cases:\n        matrix = estimate_transition_matrix(trajectories, alpha, enforce_absorbing)\n        results.append(matrix)\n\n    # Format the final output string manually to avoid spaces\n    # Example format: [[[d,d,d,d],[d,d,d,d],...],[[...]],...]\n    matrix_strings = []\n    for matrix in results:\n        row_strings = []\n        for row in matrix:\n            row_strings.append(f\"[{','.join(map(str, row))}]\")\n        matrix_strings.append(f\"[{','.join(row_strings)}]\")\n    \n    print(f\"[{','.join(matrix_strings)}]\")\n\nsolve()\n```"
        }
    ]
}