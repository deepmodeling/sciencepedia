{
    "hands_on_practices": [
        {
            "introduction": "健康差异研究的一个基本步骤是量化不同群体之间健康结果差异的程度。风险比（$RR$）是流行病学中用于此目的的基石，它比较一个群体与另一个群体中发生某一事件（如疾病诊断）的概率。这个练习  提供了从研究数据中计算风险比及其置信区间的实践机会，让你能将原始数据转化为衡量健康不平等的有意义指标。",
            "id": "4745902",
            "problem": "一项医学心理学的队列研究旨在考察居住在同一都市区的$25$–$55$岁非裔成年人，在为期$12$个月的周期内，发生重度抑郁发作的健康差异。为集中研究社会经济地位（SES），研究人员将样本限制在单一族裔群体中，并比较了低社会经济地位（low SES）和高社会经济地位（high SES）个体之间的事件风险。根据经过验证的指标评估，低社会经济地位（SES）指处于收入最低四分位数且社区剥夺程度高的个体，而高社会经济地位（SES）指处于收入最高四分位数且社区剥夺程度低的个体。在低社会经济地位组中，有$a=48$名个体经历了重度抑郁发作，有$b=192$名个体没有。在高社会经济地位组中，有$c=30$名个体经历了重度抑郁发作，有$d=270$名个体没有。请使用风险的基本定义（即风险人群中事件发生的比例）和风险比的定义（即两组风险的比率），并应用作用于风险比自然对数的大样本Wald方法构建$95\\%$置信区间，计算比较低社会经济地位组与高社会经济地位组的风险比及其$95\\%$的置信区间。将所求的每个量四舍五入至四位有效数字。最终数值答案无需单位。",
            "solution": "该问题陈述被评估为有效。它提出了一个标准的生物统计计算任务，基于明确定义的术语、完整且一致的数据以及成熟的方法论。其背景在流行病学和医学心理学方面具有科学依据。一个适定问题的所有条件均已满足。\n\n该问题要求计算比较低社会经济地位（SES）组与高社会经济地位（SES）组的重度抑郁发作风险比（$RR$）及其$95\\%$置信区间（$CI$）。\n\n提供的数据如下：\n对于低社会经济地位组（第1组，暴露组）：\n- 患有重度抑郁发作的个体数量（事件数）：$a = 48$。\n- 未患有重度抑郁发作的个体数量（非事件数）：$b = 192$。\n\n对于高社会经济地位组（第2组，非暴露组）：\n- 患有重度抑郁发作的个体数量（事件数）：$c = 30$。\n- 未患有重度抑郁发作的个体数量（非事件数）：$d = 270$。\n\n首先，我们计算每组的总人数。\n低社会经济地位组总人数：$N_1 = a + b = 48 + 192 = 240$。\n高社会经济地位组总人数：$N_2 = c + d = 30 + 270 = 300$。\n\n接下来，我们计算每组的风险，定义为事件的比例。\n低社会经济地位组的风险：\n$$R_1 = \\frac{a}{N_1} = \\frac{48}{240} = 0.2$$\n高社会经济地位组的风险：\n$$R_2 = \\frac{c}{N_2} = \\frac{30}{300} = 0.1$$\n\n风险比（$RR$）是暴露组（$R_1$）的风险与非暴露组（$R_2$）的风险之比。\n$$RR = \\frac{R_1}{R_2} = \\frac{0.2}{0.1} = 2.0$$\n\n为了构建$95\\%$的置信区间，我们使用应用于风险比的自然对数$\\ln(RR)$的大样本Wald方法。\n$\\ln(RR)$的标准误（$SE$）由以下公式给出：\n$$SE(\\ln(RR)) = \\sqrt{\\frac{b}{a N_1} + \\frac{d}{c N_2}} = \\sqrt{\\frac{b}{a(a+b)} + \\frac{d}{c(c+d)}}$$\n代入给定值：\n$$SE(\\ln(RR)) = \\sqrt{\\frac{192}{48(240)} + \\frac{270}{30(300)}} = \\sqrt{\\frac{192}{11520} + \\frac{270}{9000}}$$\n简化分数：\n$$SE(\\ln(RR)) = \\sqrt{\\frac{1}{60} + \\frac{3}{100}} = \\sqrt{\\frac{5}{300} + \\frac{9}{300}} = \\sqrt{\\frac{14}{300}} = \\sqrt{\\frac{7}{150}}$$\n数值上，\n$$SE(\\ln(RR)) \\approx \\sqrt{0.046666...} \\approx 0.21602469$$\n\n$\\ln(RR)$的$95\\%$置信区间构建为 $\\ln(RR) \\pm Z_{1-\\alpha/2} \\times SE(\\ln(RR))$。对于$95\\%$的置信区间，显著性水平为$\\alpha = 0.05$，相应的标准正态分布临界值为$Z_{0.975} \\approx 1.96$。\n\n首先，我们计算$\\ln(RR)$的值：\n$$\\ln(RR) = \\ln(2.0) \\approx 0.693147$$\n现在我们求$\\ln(RR)$置信区间的下限和上限：\n$$LL_{\\ln(RR)} = \\ln(RR) - Z_{0.975} \\times SE(\\ln(RR)) \\approx 0.693147 - 1.96 \\times 0.21602469$$\n$$LL_{\\ln(RR)} \\approx 0.693147 - 0.42340839 \\approx 0.26973861$$\n$$UL_{\\ln(RR)} = \\ln(RR) + Z_{0.975} \\times SE(\\ln(RR)) \\approx 0.693147 + 1.96 \\times 0.21602469$$\n$$UL_{\\ln(RR)} \\approx 0.693147 + 0.42340839 \\approx 1.11655539$$\n\n为了得到风险比$RR$的置信区间，我们对这些限值取指数：\n$$LL_{RR} = \\exp(LL_{\\ln(RR)}) \\approx \\exp(0.26973861) \\approx 1.30963$$\n$$UL_{RR} = \\exp(UL_{\\ln(RR)}) \\approx \\exp(1.11655539) \\approx 3.05435$$\n\n题目要求将所求的量（风险比及其置信区间的下限和上限）四舍五入到四位有效数字。\n- 风险比：$RR = 2.0$。四舍五入到四位有效数字，为$2.000$。\n- 置信区间下限：$LL_{RR} \\approx 1.30963$。四舍五入到四位有效数字，为$1.310$。\n- 置信区间上限：$UL_{RR} \\approx 3.05435$。四舍五入到四位有效数字，为$3.054$。\n\n因此，风险比为$2.000$，其$95\\%$置信区间为（$1.310$，$3.054$）。这表明，低社会经济地位组的个体经历重度抑郁发作的风险大约是高社会经济地位组个体的两倍，并且在$95\\%$的置信度下，真实的风险比位于$1.310$和$3.054$之间。由于该区间不包含$1.0$，因此在$\\alpha = 0.05$的显著性水平上，观察到的关联具有统计显著性。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.000  1.310  3.054 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "除了简单地询问是否存在差异，研究人员还会探究风险因素与健康之间的关系在不同人群中是如何变化的。效应修饰（effect modification）的概念，在统计上通过交互项进行检验，对于这种更深入的分析至关重要，它揭示了社会经济地位等因素的影响是否因种族等群体身份而异。本实践问题  挑战你解释回归模型中的交互项，这是理解那些探讨社会经济地位和种族等因素如何共同影响健康的细致研究的关键技能。",
            "id": "4745878",
            "problem": "一个医学心理学研究团队正在研究社会经济地位 ($SES$) 与抑郁症状严重程度（以患者健康问卷-9 (PHQ-9) 得分衡量）之间的关系，以及这种关系是否因种族而异。设 $Eth$ 为一个二元指示变量，其中 $Eth=0$ 代表多数族裔群体，$Eth=1$ 代表一个少数族裔群体。假设 $SES$ 被标准化为均值为 $0$，标准差为 $1$。研究人员为抑郁症状的条件均值拟合了以下线性回归模型：\n$$\nY \\;=\\; \\beta_0 \\;+\\; \\beta_1\\,SES \\;+\\; \\beta_2\\,Eth \\;+\\; \\beta_3\\,(SES\\times Eth) \\;+\\; \\epsilon,\n$$\n其中 $Y$ 是 PHQ-9 得分，$SES\\times Eth$ 是乘积（交互）项，误差项满足 $\\mathbb{E}[\\epsilon\\mid SES,Eth]=0$。根据线性回归作为条件期望 $\\mathbb{E}[Y\\mid SES,Eth]$ 模型的基木定义，以及效应修饰作为 $SES$ 的效应在不同 $Eth$ 水平上对模型结果尺度影响的变化这一概念，下列哪项是 $\\beta_3$ 作为种族对 $SES$ 在指定（相加）尺度上的效应修饰的正确解释？\n\nA. 在相加结果尺度上，$\\beta_3$ 等于当 $SES$ 每增加1个单位时，$Y$ 的预期变化量在 $Eth=1$ 和 $Eth=0$ 之间的差异。\n\nB. $\\beta_3$ 等于在 $SES=0$ 时，$Y$ 的期望值在 $Eth=1$ 和 $Eth=0$ 之间的差异。\n\nC. $\\exp(\\beta_3)$ 等于当 $SES$ 每增加1个单位时，$Y$ 的预期变化量在 $Eth=1$ 与 $Eth=0$ 之间的比率。\n\nD. $\\beta_3$ 捕捉了 $SES$ 和 $Eth$ 之间的混杂，并且不改变 $SES$ 对 $Y$ 的斜率。\n\nE. $\\beta_3$ 代表了不同族裔群体之间 $\\epsilon$ 方差的差异。",
            "solution": "用户要求对问题陈述进行严格验证，然后为一个关于医学心理学中线性回归和效应修饰的问题提供详细的解决方案和选项评估。\n\n### 问题验证\n\n**第1步：提取已知信息**\n\n*   **模型：** 一个用于抑郁症状条件均值（$Y$，由 PHQ-9 衡量）的线性回归模型由以下公式给出：\n    $Y = \\beta_0 + \\beta_1\\,SES + \\beta_2\\,Eth + \\beta_3\\,(SES\\times Eth) + \\epsilon$。\n*   **因变量 ($Y$):** 抑郁症状严重程度（PHQ-9 得分）。\n*   **自变量：**\n    *   $SES$：社会经济地位，已标准化为均值为 $0$，标准差为 $1$。\n    *   $Eth$：一个二元指示变量，其中 $Eth=0$ 代表多数族裔群体，$Eth=1$ 代表少数族裔群体。\n    *   $SES \\times Eth$：一个交互项，即 $SES$ 和 $Eth$ 的乘积。\n*   **误差项 ($\\epsilon$):** 条件均值为零，即 $\\mathbb{E}[\\epsilon\\mid SES,Eth]=0$。\n*   **问题：** 用户希望基于线性回归作为条件期望 $\\mathbb{E}[Y\\mid SES,Eth]$ 的定义，得到系数 $\\beta_3$ 作为种族对 $SES$ 在相加尺度上的效应修饰的正确解释。\n\n**第2步：使用提取的已知信息进行验证**\n\n1.  **科学或事实上的不合理性：** 该问题在科学上是合理的。它采用了一个带有交互项的标准线性回归模型，这是在相加尺度上评估效应修饰（交互作用）的经典方法。这种方法在生物统计学、流行病学和定量心理学中是基础性的。\n2.  **非形式化或不相关：** 该问题是一个数理统计中的形式化问题，与所述的医学心理学和健康差异主题直接相关。\n3.  **不完整或矛盾的设置：** 该问题提供了所有必要的信息。模型方程、变量的定义以及关于误差项的关键假设（$\\mathbb{E}[\\epsilon\\mid SES,Eth]=0$）都已明确陈述。这个假设允许我们将回归方程（不含误差项）等同于 $Y$ 的条件期望。没有矛盾之处。\n4.  **不现实或不可行：** 所描述的情景在社会科学和医学科学中是一种高度现实的研究设计。\n5.  **问题设置不当或结构不佳：** 该问题设置得当。它要求在一个明确定义的模型中解释一个特定参数（$\\beta_3$）的含义，该参数具有唯一且标准的统计解释。\n6.  **伪深刻、微不足道或同义反复：** 该问题测试了回归建模中一个基础性的、非微不足道的概念：交互系数的解释。这是一个标准但重要的问题。\n\n**第3步：结论与行动**\n\n问题陈述是**有效的**，因为它在科学上是合理的，问题设置得当且完整。我现在将进行解题推导。\n\n### 解题推导\n\n该问题要求在给定线性模型的背景下解释参数 $\\beta_3$。基本假设 $\\mathbb{E}[\\epsilon\\mid SES,Eth]=0$ 意味着回归方程代表了在给定 $SES$ 和 $Eth$ 的条件下 $Y$ 的条件期望。\n$$\n\\mathbb{E}[Y \\mid SES, Eth] = \\beta_0 + \\beta_1\\,SES + \\beta_2\\,Eth + \\beta_3\\,(SES\\times Eth)\n$$\n$SES$ 对预期结果 $Y$ 的影响是 $\\mathbb{E}[Y \\mid SES, Eth]$ 相对于 $SES$ 的变化率。在线性模型中，这是条件期望相对于 $SES$ 的偏导数。\n$$\n\\frac{\\partial}{\\partial SES} \\mathbb{E}[Y \\mid SES, Eth] = \\frac{\\partial}{\\partial SES} \\left( \\beta_0 + \\beta_1\\,SES + \\beta_2\\,Eth + \\beta_3\\,SES\\cdot Eth \\right)\n$$\n应用微分法则，我们得到：\n$$\n\\frac{\\partial}{\\partial SES} \\mathbb{E}[Y \\mid SES, Eth] = 0 + \\beta_1 + 0 + \\beta_3 \\cdot Eth = \\beta_1 + \\beta_3\\,Eth\n$$\n这个表达式 $\\beta_1 + \\beta_3\\,Eth$ 代表了在给定 $Eth$ 值的情况下，$SES$ 与预期 $Y$ 之间关系的斜率。这个斜率依赖于 $Eth$ 的事实，正是交互作用或效应修饰的含义。\n\n为了解释 $\\beta_3$，我们必须考察当 $Eth$ 变化时这个斜率如何变化。我们为两个族裔群体分别评估斜率：\n\n1.  **对于多数群体 ($Eth=0$):**\n    $SES$ 每增加1个单位对 $Y$ 期望值的影响，通过将 $Eth=0$ 代入斜率表达式得到：\n    $$\n    \\text{当 } Eth=0 \\text{ 时的斜率} \\quad \\rightarrow \\quad \\beta_1 + \\beta_3(0) = \\beta_1\n    $$\n    所以，对于多数群体， $SES$ 每增加1个单位，PHQ-9 得分的预期变化为 $\\beta_1$。\n\n2.  **对于少数群体 ($Eth=1$):**\n    $SES$ 每增加1个单位对 $Y$ 期望值的影响，通过将 $Eth=1$ 代入斜率表达式得到：\n    $$\n    \\text{当 } Eth=1 \\text{ 时的斜率} \\quad \\rightarrow \\quad \\beta_1 + \\beta_3(1) = \\beta_1 + \\beta_3\n    $$\n    所以，对于少数群体， $SES$ 每增加1个单位，PHQ-9 得分的预期变化为 $\\beta_1 + \\beta_3$。\n\n$Eth$ 对 $SES$ 效应的效应修饰被定义为 $SES$ 的效应在不同 $Eth$ 水平上的差异。在结果 $Y$ 的相加尺度上，这是上面计算出的两个斜率之间的算术差。\n\n斜率差异 $= (\\text{当 } Eth=1 \\text{ 时的斜率}) - (\\text{当 } Eth=0 \\text{ 时的斜率})$\n$$\n\\text{斜率差异} = (\\beta_1 + \\beta_3) - (\\beta_1) = \\beta_3\n$$\n因此，$\\beta_3$ 代表了在比较少数群体（$Eth=1$）与多数群体（$Eth=0$）时，$SES$ 每增加1个单位所带来的 $Y$ 预期变化的差异。\n\n### 逐项分析\n\n**A. 在相加结果尺度上，$\\beta_3$ 等于当 $SES$ 每增加1个单位时，$Y$ 的预期变化量在 $Eth=1$ 和 $Eth=0$ 之间的差异。**\n这个陈述与我们的推导完全吻合。术语“当 $SES$ 每增加1个单位时，$Y$ 的预期变化量”指的是 $SES$ 的斜率。我们的推导表明，$\\beta_3$ 正是 $Eth=1$ 群体的斜率与 $Eth=0$ 群体的斜率之间的差异。“相加结果尺度”正确地描述了效应是相加的线性模型。\n**结论：正确。**\n\n**B. $\\beta_3$ 等于在 $SES=0$ 时，$Y$ 的期望值在 $Eth=1$ 和 $Eth=0$ 之间的差异。**\n让我们计算这个差异。\n对于 $Eth=1$ 和 $SES=0$：$\\mathbb{E}[Y \\mid SES=0, Eth=1] = \\beta_0 + \\beta_1(0) + \\beta_2(1) + \\beta_3(0 \\cdot 1) = \\beta_0 + \\beta_2$。\n对于 $Eth=0$ 和 $SES=0$：$\\mathbb{E}[Y \\mid SES=0, Eth=0] = \\beta_0 + \\beta_1(0) + \\beta_2(0) + \\beta_3(0 \\cdot 0) = \\beta_0$。\n差异是 $(\\beta_0 + \\beta_2) - \\beta_0 = \\beta_2$。\n这个差异等于 $\\beta_2$，而不是 $\\beta_3$。$\\beta_2$ 代表了当 $SES$ 在其均值0时，两个族裔群体之间平均结果的差异。\n**结论：不正确。**\n\n**C. $\\exp(\\beta_3)$ 等于当 $SES$ 每增加1个单位时，$Y$ 的预期变化量在 $Eth=1$ 与 $Eth=0$ 之间的比率。**\n这描述的是一个乘法模型（例如，逻辑回归或泊松回归）的解释，而不是一个相加的线性模型。当 $SES$ 每增加1个单位时，$Y$ 的预期变化量对于 $Eth=1$ 是 $\\beta_1 + \\beta_3$，对于 $Eth=0$ 是 $\\beta_1$。其比率为 $(\\beta_1 + \\beta_3) / \\beta_1$。这不等于 $\\exp(\\beta_3)$。线性模型中的比较是差异，而不是比率。\n**结论：不正确。**\n\n**D. $\\beta_3$ 捕捉了 $SES$ 和 $Eth$ 之间的混杂，并且不改变 $SES$ 对 $Y$ 的斜率。**\n这个陈述在两点上是错误的。首先，混杂和效应修饰是两个不同的统计概念。$\\beta_3$ 衡量的是效应修饰（交互作用）。混杂问题会通过包含主效应 $\\beta_1\\,SES$ 和 $\\beta_2\\,Eth$ 来处理。其次，交互项 $\\beta_3(SES \\times Eth)$ 的目的正是为了让 $SES$ 对 $Y$ 的斜率能够根据 $Eth$ 的值而改变。它“不改变斜率”的说法直接与交互项的定义相矛盾。\n**结论：不正确。**\n\n**E. $\\beta_3$ 代表了不同族裔群体之间 $\\epsilon$ 方差的差异。**\n系数 $\\beta_3$ 是 $Y$ 的条件**均值**模型中的一个参数。误差项 $\\epsilon$ 的方差与 $Y$ 的条件**方差**有关。各组之间 $\\epsilon$ 方差的差异被称为异方差性。虽然这是数据中一个需要检查的重要特征，但它不是 $\\beta_3$ 所衡量的。\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "为了设计有效的干预措施，我们必须了解健康差异的来源。Oaxaca-Blinder 分解法是一种强大的统计方法，它将基于群体的结果差距分解为两个关键部分：一个是由可衡量的特征（如教育和收入）差异所“解释”的部分，另一个是反映这些特征与结果之间关系差异的“未解释”部分。这项动手编码练习  将指导你完成这种分解的实现，为你提供一个强有力的视角来分析健康不平等的驱动因素。",
            "id": "4745933",
            "problem": "给定两个族裔群体，索引为 $g \\in \\{A,B\\}$，每个群体都有一个由个体组成的样本。对于每个群体，我们观察到一个健康结果（例如，经过验证的心理困扰量表上的得分）$y$ 和一组协变量 $x$。假设每个群体内部都存在一个线性数据生成结构，使得结果可以用模型 $y_g = x_g^{\\top}\\beta_g + \\varepsilon_g$ 来表示，其中 $x_g \\in \\mathbb{R}^p$ 包含一个作为其第一分量的截距项，$\\beta_g \\in \\mathbb{R}^p$ 是特定于群体的系数，扰动项 $\\varepsilon_g$ 满足 $E[\\varepsilon_g \\mid x_g] = 0$。在普通最小二乘法 (OLS) 下，群体 $g$ 的平均结果为 $E[y_g] \\approx \\mu_{X_g}^{\\top}\\hat{\\beta}_g$，其中 $\\mu_{X_g}$ 是群体 $g$ 中协变量的样本均值，$\\hat{\\beta}_g$ 是在群体 $g$ 内部计算的 OLS 估计值。为了将群体间平均结果的差异归因于协变量的差异与系数的差异，请使用一个通过对两个群体的合并样本进行 OLS 估计得到的非歧视性结构 $\\hat{\\beta}^*$。\n\n你的任务是实现一个程序，该程序：\n- 在每个群体内部和合并样本上拟合 OLS，以获得 $\\hat{\\beta}_A$、$\\hat{\\beta}_B$ 和 $\\hat{\\beta}^*$。\n- 计算样本均值协变量向量 $\\mu_{X_A}$ 和 $\\mu_{X_B}$。\n- 将群体间结果的平均差异划分为两个部分：一个是由 $\\hat{\\beta}^*$ 下协变量均值差异导致的可解释部分，另一个是由系数差异导致的不可解释部分，该部分在群体均值协变量处进行评估。\n- 对下面列出的每个测试用例，生成其可解释部分和不可解释部分。\n\n所有输出必须表示为健康结果量表上的得分，以实值浮点数的形式呈现。\n\n使用以下测试用例数据集，每个数据集由一个设计矩阵 $X$（第一列为 1，代表截距）和一个结果向量 $y$ 指定。对于每个案例，都提供了 A 组和 B 组。\n\n测试用例 1（一般情况，$p=3$）：\n- A 组：\n$$\nX_A = \\begin{bmatrix}\n1  4  12\\\\\n1  5  12\\\\\n1  6  13\\\\\n1  3  11\\\\\n1  7  14\n\\end{bmatrix},\\quad\ny_A = \\begin{bmatrix}\n36\\\\\n35.5\\\\\n34\\\\\n37.5\\\\\n32.5\n\\end{bmatrix}.\n$$\n- B 组：\n$$\nX_B = \\begin{bmatrix}\n1  3  11\\\\\n1  4  12\\\\\n1  5  12\\\\\n1  2  10\\\\\n1  6  13\n\\end{bmatrix},\\quad\ny_B = \\begin{bmatrix}\n42.3\\\\\n41.2\\\\\n40.9\\\\\n43.4\\\\\n39.8\n\\end{bmatrix}.\n$$\n\n测试用例 2（边界情况：群体间协变量相同，$p=3$）：\n- A 组和 B 组共享 $X$：\n$$\nX_A = X_B = \\begin{bmatrix}\n1  4  12\\\\\n1  5  12\\\\\n1  6  13\\\\\n1  3  11\n\\end{bmatrix}.\n$$\n- 结果：\n$$\ny_A = \\begin{bmatrix}\n40\\\\\n39\\\\\n37.5\\\\\n41.5\n\\end{bmatrix},\\quad\ny_B = \\begin{bmatrix}\n36.8\\\\\n36.6\\\\\n35.2\\\\\n38.2\n\\end{bmatrix}.\n$$\n\n测试用例 3（边界情况：系数相同但协变量不同，$p=3$）：\n- A 组：\n$$\nX_A = \\begin{bmatrix}\n1  2  12\\\\\n1  3  12\\\\\n1  2  11\\\\\n1  4  13\n\\end{bmatrix},\\quad\ny_A = \\begin{bmatrix}\n35\\\\\n34.5\\\\\n36\\\\\n33\n\\end{bmatrix}.\n$$\n- B 组：\n$$\nX_B = \\begin{bmatrix}\n1  6  16\\\\\n1  5  15\\\\\n1  7  16\\\\\n1  6  15\n\\end{bmatrix},\\quad\ny_B = \\begin{bmatrix}\n29\\\\\n30.5\\\\\n28.5\\\\\n30\n\\end{bmatrix}.\n$$\n\n测试用例 4（边缘情况：仅截距模型，$p=1$）：\n- A 组：\n$$\nX_A = \\begin{bmatrix}\n1\\\\\n1\\\\\n1\\\\\n1\n\\end{bmatrix},\\quad\ny_A = \\begin{bmatrix}\n40\\\\\n41\\\\\n39\\\\\n40\n\\end{bmatrix}.\n$$\n- B 组：\n$$\nX_B = \\begin{bmatrix}\n1\\\\\n1\\\\\n1\\\\\n1\n\\end{bmatrix},\\quad\ny_B = \\begin{bmatrix}\n43\\\\\n42\\\\\n44\\\\\n43\n\\end{bmatrix}.\n$$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果都是一个有序对 $[\\text{explained},\\text{unexplained}]$。顺序必须是测试用例 1、2、3、4。例如：$[[e_1,u_1],[e_2,u_2],[e_3,u_3],[e_4,u_4]]$。",
            "solution": "该问题陈述经过了严格验证，被确定为有效。它具有科学依据、问题明确、客观，并为标准统计程序提供了完整且一致的设置。\n\n该问题要求实现 Blinder-Oaxaca 分解法，将两个群体 A 和 B 之间平均健康结果的差异划分为两个部分：一个由群体特征（协变量）差异解释的部分，另一个是无法解释的、归因于这些特征与结果关联方式（系数）差异的部分。\n\n此问题的给定条件如下：\n1.  每个群体 $g \\in \\{A, B\\}$ 中健康结果 $y$ 的线性模型：$y_g = x_g^{\\top}\\beta_g + \\varepsilon_g$，其中 $x_g$ 是一个 $p$ 维协变量向量（包括一个截距项），$\\beta_g$ 是一个特定于群体的系数向量，$\\varepsilon_g$ 是一个零均值误差项。\n2.  使用普通最小二乘法 (OLS) 进行估计。对于给定的设计矩阵 $X$ 和结果向量 $y$，$\\beta$ 的 OLS 估计值为 $\\hat{\\beta} = (X^{\\top}X)^{-1}X^{\\top}y$。\n3.  平均结果差异将使用一个非歧视性参考系数向量 $\\hat{\\beta}^*$ 进行分解，该向量通过对两个群体的合并样本进行 OLS 估计得到。\n4.  四个具体的测试用例，每个用例都有数据矩阵 $X_A, y_A, X_B, y_B$。\n\nB 组和 A 组之间预测平均结果的总体差异由下式给出：\n$$\n\\Delta\\bar{y} = \\bar{y}_B - \\bar{y}_A = \\mu_{X_B}^{\\top}\\hat{\\beta}_B - \\mu_{X_A}^{\\top}\\hat{\\beta}_A\n$$\n其中 $\\mu_{X_g}$ 是群体 $g$ 的协变量样本均值向量，$\\hat{\\beta}_g$ 是在群体 $g$ 内部估计的 OLS 系数向量。\n\nBlinder-Oaxaca 分解法将此总差异划分为一个可解释部分 ($E$) 和一个不可解释部分 ($U$)。这是通过加减涉及参考系数向量 $\\hat{\\beta}^*$ 的反事实项来实现的。总差异可以表示为：\n$$\n\\Delta\\bar{y} = (\\mu_{X_B}^{\\top}\\hat{\\beta}_B - \\mu_{X_A}^{\\top}\\hat{\\beta}_A) = E + U\n$$\n问题陈述所要求的具体分解构造如下。我们加减项 $\\mu_{X_B}^{\\top}\\hat{\\beta}^*$ 和 $\\mu_{X_A}^{\\top}\\hat{\\beta}^*$：\n$$\n\\Delta\\bar{y} = (\\mu_{X_B}^{\\top}\\hat{\\beta}^* - \\mu_{X_A}^{\\top}\\hat{\\beta}^*) + (\\mu_{X_B}^{\\top}\\hat{\\beta}_B - \\mu_{X_B}^{\\top}\\hat{\\beta}^*) - (\\mu_{X_A}^{\\top}\\hat{\\beta}_A - \\mu_{X_A}^{\\top}\\hat{\\beta}^*)\n$$\n整理这些项可得到所需的两个部分：\n\n1.  **可解释部分 ($E$)**：这部分表示结果差距中由于两组之间平均协变量水平的差异所导致的部分，该差异以非歧视性（合并）系数 $\\hat{\\beta}^*$ 进行估值。\n    $$\n    E = (\\mu_{X_B} - \\mu_{X_A})^{\\top}\\hat{\\beta}^*\n    $$\n\n2.  **不可解释部分 ($U$)**：这部分捕捉了差距的其余部分，归因于估计系数的群体差异。它反映了每个群体协变量的差异化“回报”，包括与合并参考结构的任何差异。它通常被解释为歧视或其他未观察到的群体特定因素的代理变量。\n    $$\n    U = \\mu_{X_B}^{\\top}(\\hat{\\beta}_B - \\hat{\\beta}^*) + \\mu_{X_A}^{\\top}(\\hat{\\beta}^* - \\hat{\\beta}_A)\n    $$\n$E + U$ 的和正确地重构了总差异 $\\Delta\\bar{y}$。\n\n为解决该问题，将对每个测试用例执行以下计算步骤：\n1.  根据提供的数据定义矩阵 $X_A, y_A, X_B, y_B$。结果向量 $y_A$ 和 $y_B$ 被视为列向量。\n2.  通过分别计算 $X_A$ 和 $X_B$ 每列的均值，来计算特定于群体的均值协变量向量 $\\mu_{X_A}$ 和 $\\mu_{X_B}$。\n3.  计算 OLS 系数估计值：\n    -   $\\hat{\\beta}_A = (X_A^{\\top}X_A)^{-1}X_A^{\\top}y_A$\n    -   $\\hat{\\beta}_B = (X_B^{\\top}X_B)^{-1}X_B^{\\top}y_B$\n    -   $\\hat{\\beta}^* = (X_{\\text{pool}}^{\\top}X_{\\text{pool}})^{-1}X_{\\text{pool}}^{\\top}y_{\\text{pool}}$，其中 $X_{\\text{pool}} = \\begin{bmatrix} X_A \\\\ X_B \\end{bmatrix}$ 且 $y_{\\text{pool}} = \\begin{bmatrix} y_A \\\\ y_B \\end{bmatrix}$。\n    在数值上，这些是通过求解线性系统 $(X^{\\top}X)\\beta = X^{\\top}y$ 来找到 $\\beta$ 的，这比直接计算矩阵的逆更稳定。\n4.  将计算出的向量 ($\\mu_{X_A}, \\mu_{X_B}$) 和系数 ($\\hat{\\beta}_A, \\hat{\\beta}_B, \\hat{\\beta}^*$) 代入 $E$ 和 $U$ 的公式，以获得最终的可解释和不可解释部分。\n5.  收集所有测试用例的这些值对，并按规定格式化。\n\n实现将使用 `numpy` 库进行所有数值和矩阵运算。",
            "answer": "```python\nimport numpy as np\n\ndef fit_ols(X, y):\n    \"\"\"\n    Computes the Ordinary Least Squares (OLS) coefficient estimates.\n\n    Args:\n        X (np.ndarray): The design matrix of shape (n_samples, p_features).\n        y (np.ndarray): The outcome vector of shape (n_samples,).\n\n    Returns:\n        np.ndarray: The estimated coefficient vector of shape (p_features,).\n    \"\"\"\n    # Numerically stable way to solve the normal equations (X'X)b = X'y\n    xtx = X.T @ X\n    xty = X.T @ y\n    try:\n        beta = np.linalg.solve(xtx, xty)\n    except np.linalg.LinAlgError:\n        # For cases where X'X is singular, use the pseudoinverse\n        beta = np.linalg.pinv(xtx) @ xty\n    return beta\n\ndef decompose_difference(X_A, y_A, X_B, y_B):\n    \"\"\"\n    Performs the Blinder-Oaxaca decomposition.\n\n    Args:\n        X_A (np.ndarray): Design matrix for group A.\n        y_A (np.ndarray): Outcome vector for group A.\n        X_B (np.ndarray): Design matrix for group B.\n        y_B (np.ndarray): Outcome vector for group B.\n\n    Returns:\n        tuple[float, float]: A tuple containing the explained and unexplained components.\n    \"\"\"\n    # 1. Compute mean covariate vectors\n    mu_XA = X_A.mean(axis=0)\n    mu_XB = X_B.mean(axis=0)\n\n    # 2. Compute OLS coefficients for each group and the pooled sample\n    beta_A = fit_ols(X_A, y_A)\n    beta_B = fit_ols(X_B, y_B)\n\n    X_pool = np.vstack((X_A, X_B))\n    y_pool = np.concatenate((y_A, y_B))\n    beta_star = fit_ols(X_pool, y_pool)\n    \n    # 3. Calculate explained and unexplained components\n    # The difference in mean outcomes between group B and A can be positive or negative.\n    # The direction (B-A) is chosen by convention.\n    \n    # Explained component: (mu_B - mu_A)' @ beta*\n    explained = (mu_XB - mu_XA).T @ beta_star\n\n    # Unexplained component: mu_B' @ (beta_B - beta*) + mu_A' @ (beta* - beta_A)\n    unexplained = mu_XB.T @ (beta_B - beta_star) + mu_XA.T @ (beta_star - beta_A)\n\n    return explained, unexplained\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (general case, p=3)\n        {\n            'X_A': np.array([[1, 4, 12], [1, 5, 12], [1, 6, 13], [1, 3, 11], [1, 7, 14]]),\n            'y_A': np.array([36, 35.5, 34, 37.5, 32.5]),\n            'X_B': np.array([[1, 3, 11], [1, 4, 12], [1, 5, 12], [1, 2, 10], [1, 6, 13]]),\n            'y_B': np.array([42.3, 41.2, 40.9, 43.4, 39.8]),\n        },\n        # Test case 2 (boundary: identical covariates across groups, p=3)\n        {\n            'X_A': np.array([[1, 4, 12], [1, 5, 12], [1, 6, 13], [1, 3, 11]]),\n            'y_A': np.array([40, 39, 37.5, 41.5]),\n            'X_B': np.array([[1, 4, 12], [1, 5, 12], [1, 6, 13], [1, 3, 11]]),\n            'y_B': np.array([36.8, 36.6, 35.2, 38.2]),\n        },\n        # Test case 3 (boundary: identical coefficients but different covariates, p=3)\n        {\n            'X_A': np.array([[1, 2, 12], [1, 3, 12], [1, 2, 11], [1, 4, 13]]),\n            'y_A': np.array([35, 34.5, 36, 33]),\n            'X_B': np.array([[1, 6, 16], [1, 5, 15], [1, 7, 16], [1, 6, 15]]),\n            'y_B': np.array([29, 30.5, 28.5, 30]),\n        },\n        # Test case 4 (edge: intercept-only model, p=1)\n        {\n            'X_A': np.array([[1], [1], [1], [1]]),\n            'y_A': np.array([40, 41, 39, 40]),\n            'X_B': np.array([[1], [1], [1], [1]]),\n            'y_B': np.array([43, 42, 44, 43]),\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        explained, unexplained = decompose_difference(\n            case['X_A'], case['y_A'], case['X_B'], case['y_B']\n        )\n        results.append([round(explained, 10), round(unexplained, 10)])\n    \n    # Format according to the specification: [[e1,u1],[e2,u2],...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}